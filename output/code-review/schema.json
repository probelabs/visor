{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "code-review",
  "title": "Code Review",
  "description": "Structured format for code review issues",
  "type": "object",
  "required": ["issues"],
  "properties": {
    "issues": {
      "type": "array",
      "description": "List of issues found during code review",
      "items": {
        "type": "object",
        "required": ["file", "line", "ruleId", "message", "severity"],
        "properties": {
          "file": {
            "type": "string",
            "description": "File path relative to repository root"
          },
          "line": {
            "type": "integer",
            "description": "Line number where issue starts",
            "minimum": 1
          },
          "endLine": {
            "type": "integer",
            "description": "Line number where issue ends",
            "minimum": 1
          },
          "ruleId": {
            "type": "string",
            "description": "Rule identifier (e.g., 'security/sql-injection')",
            "pattern": "^[a-z-]+/[a-z-]+$"
          },
          "message": {
            "type": "string",
            "description": "Clear description of the issue"
          },
          "severity": {
            "type": "string",
            "enum": ["info", "warning", "error", "critical"],
            "description": "Issue severity level based on the NEW CODE being introduced: info (suggestions/improvements), warning (should fix), error (must fix), critical (NEW security vulnerabilities, data loss risks, or breaking changes that block deployment). IMPORTANT: Use 'critical' ONLY when NEW problematic code is INTRODUCED, NOT when existing issues are being FIXED. Fixes and improvements should use 'info' or 'warning' severity."
          },
          "category": {
            "type": "string",
            "description": "Issue category",
            "enum": ["security", "performance", "style", "logic", "documentation", "architecture"]
          },
          "suggestion": {
            "type": "string",
            "description": "How to fix the issue"
          },
          "replacement": {
            "type": "string",
            "description": "Code to replace the problematic lines"
          }
        }
      }
    },
    "suggestions": {
      "type": "array",
      "description": "General suggestions for the entire changeset",
      "items": {
        "type": "string"
      }
    },
    "metrics": {
      "type": "object",
      "description": "Optional metrics about the review",
      "properties": {
        "filesAnalyzed": {
          "type": "integer"
        },
        "linesAnalyzed": {
          "type": "integer"
        },
        "executionTime": {
          "type": "number",
          "description": "Time in milliseconds"
        }
      }
    }
  }
}