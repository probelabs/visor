# Test config that imports jira-context workflow from defaults
version: "1.0"

# Import the jira-context workflow
extends:
  - ../defaults/jira-context.yaml

steps:
  # Test step that uses the jira-context workflow in on_init
  test-jira-context:
    type: command
    on_init:
      run:
        - workflow: jira-context
          with:
            text: "Fix auth bug PROJ-123, also related to DEV-456 and API-789"
            custom_field_aliases:
              customfield_10001: "Story Points"
              customfield_10002: "Sprint"
              customfield_10016: "Epic Link"
          as: jira-context

    exec: |
      echo "=== JIRA CONTEXT TEST ==="
      echo ""
      echo "Issue count: {{ outputs['jira-context'].issue_count }}"
      echo ""
      echo "=== XML Output ==="
      echo '{{ outputs["jira-context"].jira_context_xml }}'
      echo ""
      echo "=== Raw Issues JSON ==="
      echo '{{ outputs["jira-context"].issues | json }}'

    on: [manual]
