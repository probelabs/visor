{"version":3,"sources":["../../src/providers/check-provider.interface.ts","../../src/utils/diff-processor.ts","../../src/utils/comment-metadata.ts","../../src/ai-review-service.ts","../../src/utils/env-resolver.ts","../../src/issue-filter.ts","../../src/telemetry/state-capture.ts","../../src/providers/custom-tool-executor.ts","../../src/providers/workflow-tool-executor.ts","../../src/scheduler/store/sqlite-store.ts","../../src/scheduler/store/index.ts","../../src/scheduler/store/json-migrator.ts","../../src/scheduler/schedule-store.ts","../../src/scheduler/schedule-parser.ts","../../src/scheduler/schedule-tool.ts","../../src/state-machine/states/init.ts","../../src/state-machine/states/plan-ready.ts","../../src/state-machine/states/wave-planning.ts","../../src/utils/mermaid-telemetry.ts","../../src/state-machine/context/workflow-inputs.ts","../../src/sandbox/env-filter.ts","../../src/sandbox/sandbox-telemetry.ts","../../src/sandbox/trace-ingester.ts","../../src/sandbox/check-runner.ts","../../src/state-machine/dispatch/sandbox-routing.ts","../../src/state-machine/dispatch/policy-gate.ts","../../src/state-machine/dispatch/history-snapshot.ts","../../src/state-machine/dispatch/dependency-gating.ts","../../src/state-machine/dispatch/template-renderer.ts","../../src/state-machine/dispatch/stats-manager.ts","../../src/state-machine/dispatch/foreach-processor.ts","../../src/state-machine/dispatch/on-init-handlers.ts","../../src/state-machine/dispatch/execution-invoker.ts","../../src/state-machine/states/level-dispatch.ts","../../src/state-machine/states/check-running.ts","../../src/state-machine/states/completed.ts","../../src/state-machine/states/error.ts","../../src/state-machine/runner.ts","../../src/sandbox/docker-image-sandbox.ts","../../src/sandbox/docker-compose-sandbox.ts","../../src/sandbox/cache-volume-manager.ts","../../src/sandbox/sandbox-manager.ts","../../src/utils/workspace-manager.ts","../../src/state-machine/context/build-engine-context.ts","../../src/state-machine/execution/summary.ts","../../src/state-machine-execution-engine.ts","../../src/scheduler/scheduler.ts","../../src/scheduler/cli-handler.ts","../../src/scheduler/index.ts","../../src/slack/schedule-tool-handler.ts","../../src/providers/mcp-custom-sse-server.ts","../../src/providers/ai-check-provider.ts","../../src/providers/http-check-provider.ts","../../src/providers/http-input-provider.ts","../../src/utils/template-context.ts","../../src/providers/http-client-provider.ts","../../src/providers/noop-check-provider.ts","../../src/providers/log-check-provider.ts","../../src/test-runner/recorders/global-recorder.ts","../../src/providers/github-ops-provider.ts","../../src/providers/claude-code-types.ts","../../src/providers/claude-code-check-provider.ts","../../src/utils/env-exposure.ts","../../src/providers/command-check-provider.ts","../../src/utils/script-memory-ops.ts","../../src/providers/memory-check-provider.ts","../../node_modules/undici/lib/core/symbols.js","../../node_modules/undici/lib/core/errors.js","../../node_modules/undici/lib/core/constants.js","../../node_modules/undici/lib/core/util.js","../../node_modules/undici/lib/timers.js","../../node_modules/@fastify/busboy/deps/streamsearch/sbmh.js","../../node_modules/@fastify/busboy/deps/dicer/lib/PartStream.js","../../node_modules/@fastify/busboy/lib/utils/getLimit.js","../../node_modules/@fastify/busboy/deps/dicer/lib/HeaderParser.js","../../node_modules/@fastify/busboy/deps/dicer/lib/Dicer.js","../../node_modules/@fastify/busboy/lib/utils/decodeText.js","../../node_modules/@fastify/busboy/lib/utils/parseParams.js","../../node_modules/@fastify/busboy/lib/utils/basename.js","../../node_modules/@fastify/busboy/lib/types/multipart.js","../../node_modules/@fastify/busboy/lib/utils/Decoder.js","../../node_modules/@fastify/busboy/lib/types/urlencoded.js","../../node_modules/@fastify/busboy/lib/main.js","../../node_modules/undici/lib/fetch/constants.js","../../node_modules/undici/lib/fetch/global.js","../../node_modules/undici/lib/fetch/util.js","../../node_modules/undici/lib/fetch/symbols.js","../../node_modules/undici/lib/fetch/webidl.js","../../node_modules/undici/lib/fetch/dataURL.js","../../node_modules/undici/lib/fetch/file.js","../../node_modules/undici/lib/fetch/formdata.js","../../node_modules/undici/lib/fetch/body.js","../../node_modules/undici/lib/core/request.js","../../node_modules/undici/lib/dispatcher.js","../../node_modules/undici/lib/dispatcher-base.js","../../node_modules/undici/lib/core/connect.js","../../node_modules/undici/src/llhttp/utils.ts","../../node_modules/undici/src/llhttp/constants.ts","../../node_modules/undici/lib/handler/RedirectHandler.js","../../node_modules/undici/lib/interceptor/redirectInterceptor.js","../../node_modules/undici/lib/llhttp/llhttp-wasm.js","../../node_modules/undici/lib/llhttp/llhttp_simd-wasm.js","../../node_modules/undici/lib/client.js","../../node_modules/undici/lib/node/fixed-queue.js","../../node_modules/undici/lib/pool-stats.js","../../node_modules/undici/lib/pool-base.js","../../node_modules/undici/lib/pool.js","../../node_modules/undici/lib/balanced-pool.js","../../node_modules/undici/lib/compat/dispatcher-weakref.js","../../node_modules/undici/lib/agent.js","../../node_modules/undici/lib/api/readable.js","../../node_modules/undici/lib/api/util.js","../../node_modules/undici/lib/api/abort-signal.js","../../node_modules/undici/lib/api/api-request.js","../../node_modules/undici/lib/api/api-stream.js","../../node_modules/undici/lib/api/api-pipeline.js","../../node_modules/undici/lib/api/api-upgrade.js","../../node_modules/undici/lib/api/api-connect.js","../../node_modules/undici/lib/api/index.js","../../node_modules/undici/lib/mock/mock-errors.js","../../node_modules/undici/lib/mock/mock-symbols.js","../../node_modules/undici/lib/mock/mock-utils.js","../../node_modules/undici/lib/mock/mock-interceptor.js","../../node_modules/undici/lib/mock/mock-client.js","../../node_modules/undici/lib/mock/mock-pool.js","../../node_modules/undici/lib/mock/pluralizer.js","../../node_modules/undici/lib/mock/pending-interceptors-formatter.js","../../node_modules/undici/lib/mock/mock-agent.js","../../node_modules/undici/lib/proxy-agent.js","../../node_modules/undici/lib/handler/RetryHandler.js","../../node_modules/undici/lib/global.js","../../node_modules/undici/lib/handler/DecoratorHandler.js","../../node_modules/undici/lib/fetch/headers.js","../../node_modules/undici/lib/fetch/response.js","../../node_modules/undici/lib/fetch/request.js","../../node_modules/undici/lib/fetch/index.js","../../node_modules/undici/lib/fileapi/symbols.js","../../node_modules/undici/lib/fileapi/progressevent.js","../../node_modules/undici/lib/fileapi/encoding.js","../../node_modules/undici/lib/fileapi/util.js","../../node_modules/undici/lib/fileapi/filereader.js","../../node_modules/undici/lib/cache/symbols.js","../../node_modules/undici/lib/cache/util.js","../../node_modules/undici/lib/cache/cache.js","../../node_modules/undici/lib/cache/cachestorage.js","../../node_modules/undici/lib/cookies/constants.js","../../node_modules/undici/lib/cookies/util.js","../../node_modules/undici/lib/cookies/parse.js","../../node_modules/undici/lib/cookies/index.js","../../node_modules/undici/lib/websocket/constants.js","../../node_modules/undici/lib/websocket/symbols.js","../../node_modules/undici/lib/websocket/events.js","../../node_modules/undici/lib/websocket/util.js","../../node_modules/undici/lib/websocket/connection.js","../../node_modules/undici/lib/websocket/frame.js","../../node_modules/undici/lib/websocket/receiver.js","../../node_modules/undici/lib/websocket/websocket.js","../../node_modules/undici/index.js","../../src/providers/mcp-check-provider.ts","../../src/utils/interactive-prompt.ts","../../src/utils/stdin-reader.ts","../../src/providers/human-input-check-provider.ts","../../src/providers/script-check-provider.ts","../../src/utils/worktree-manager.ts","../../src/providers/git-checkout-provider.ts","../../src/providers/check-provider-registry.ts","../../src/workflow-executor.ts","../../src/state-machine/workflow-projection.ts","../../src/providers/workflow-check-provider.ts"],"sourcesContent":["import { PRInfo } from '../pr-analyzer';\nimport { ReviewSummary } from '../reviewer';\nimport { EnvConfig, HumanInputRequest } from '../types/config';\n\n/**\n * Configuration for a check provider\n */\nexport interface CheckProviderConfig {\n  type: string;\n  prompt?: string;\n  eventContext?: Record<string, unknown>;\n  focus?: string;\n  command?: string; // For PR comment triggers\n  exec?: string; // For command execution (supports Liquid templates)\n  stdin?: string; // Optional stdin input (supports Liquid templates)\n  args?: string[] | Record<string, unknown>; // string[] deprecated for command args; Record for workflow inputs\n  command_args?: string[]; // MCP stdio command arguments\n  interpreter?: string;\n  url?: string;\n  method?: string;\n  headers?: Record<string, string>;\n  timeout?: number;\n  metadata?: Record<string, unknown>;\n  workingDirectory?: string;\n  env?: EnvConfig;\n  ai?: import('../types/config').AIProviderConfig;\n  /** AI model to use for this check - overrides global setting */\n  ai_model?: string;\n  /** AI provider to use for this check - overrides global setting */\n  ai_provider?: 'google' | 'anthropic' | 'openai' | string;\n  /** Check name for sessionID and logging purposes */\n  checkName?: string;\n  /** Session ID for AI session management */\n  sessionId?: string;\n  /** Script content for 'script' provider */\n  content?: string;\n  [key: string]: unknown;\n}\n\n/**\n * Execution context passed to check providers\n */\nexport interface ExecutionContext {\n  /** Session information for AI session reuse */\n  parentSessionId?: string;\n  reuseSession?: boolean;\n  /** CLI message value (from --message argument) */\n  cliMessage?: string;\n  /** Conversation context - unified access to user message across transports (CLI, Slack, etc.) */\n  conversation?: import('../types/bot').ConversationContext;\n  /**\n   * Stage-local baseline of output history lengths per check name.\n   * When present, providers should expose an `outputs_history_stage` object in\n   * Liquid/JS contexts that slices the global history from this baseline.\n   * This enables stage-scoped assertions in the YAML test runner without\n   * relying on global execution history.\n   */\n  stageHistoryBase?: Record<string, number>;\n  /** Workflow inputs - available when executing within a workflow */\n  workflowInputs?: Record<string, unknown>;\n  /** Custom arguments passed from on_init 'with' directive */\n  args?: Record<string, unknown>;\n  /** SDK hooks for human input and check completion */\n  hooks?: {\n    onHumanInput?: (request: HumanInputRequest) => Promise<string>;\n    onPromptCaptured?: (info: { step: string; provider: string; prompt: string }) => void;\n    mockForStep?: (step: string) => unknown | undefined;\n    /** Called when a check completes - useful for streaming TUI updates */\n    onCheckComplete?: (info: {\n      checkId: string;\n      result: { output?: unknown; content?: string };\n      checkConfig?: { type?: string; group?: string; criticality?: string; schema?: unknown };\n    }) => void;\n  };\n  /**\n   * Optional execution mode hints. The core engine does not read environment\n   * variables directly; callers (CLI, test runner) can set these flags to\n   * request certain behaviors without polluting core logic with test-specific\n   * branches.\n   */\n  mode?: {\n    /** true when running under the YAML test runner */\n    test?: boolean;\n    /** post review comments from grouped execution paths (used by tests) */\n    postGroupedComments?: boolean;\n    /** reset per-run guard state before grouped execution */\n    resetPerRunState?: boolean;\n  };\n  /** Optional event bus for emitting integration events (e.g., HumanInputRequested) */\n  eventBus?: import('../event-bus/event-bus').EventBus;\n  /** Optional webhook context (e.g., Slack Events API payload) */\n  webhookContext?: { webhookData?: Map<string, unknown>; eventType?: string };\n  /**\n   * Callback for capturing AI responses - used by scheduler to store previousResponse\n   * for recurring reminders. The text passed is the AI response before mrkdwn formatting.\n   */\n  responseCapture?: (text: string) => void;\n}\n\n/**\n * Abstract base class for all check providers\n * Implementing classes provide specific check functionality (AI, tool, script, etc.)\n */\nexport abstract class CheckProvider {\n  /**\n   * Get the unique name/type of this provider\n   */\n  abstract getName(): string;\n\n  /**\n   * Get a human-readable description of this provider\n   */\n  abstract getDescription(): string;\n\n  /**\n   * Validate provider-specific configuration\n   * @param config The configuration to validate\n   * @returns true if configuration is valid, false otherwise\n   */\n  abstract validateConfig(config: unknown): Promise<boolean>;\n\n  /**\n   * Execute the check on the given PR information\n   * @param prInfo Information about the pull request\n   * @param config Provider-specific configuration\n   * @param dependencyResults Optional results from dependency checks that this check depends on\n   * @param context Optional execution context with session info, hooks, and CLI state\n   * @returns Review summary with scores, issues, and comments\n   */\n  abstract execute(\n    prInfo: PRInfo,\n    config: CheckProviderConfig,\n    dependencyResults?: Map<string, ReviewSummary>,\n    context?: ExecutionContext\n  ): Promise<ReviewSummary>;\n\n  /**\n   * Get the list of configuration keys this provider supports\n   * Used for documentation and validation\n   */\n  abstract getSupportedConfigKeys(): string[];\n\n  /**\n   * Check if this provider is available (e.g., has required API keys)\n   * @returns true if provider can be used, false otherwise\n   */\n  abstract isAvailable(): Promise<boolean>;\n\n  /**\n   * Get provider requirements (e.g., environment variables needed)\n   */\n  abstract getRequirements(): string[];\n\n  /**\n   * Set webhook context for providers that need access to webhook data\n   * This is optional and only used by http_input providers\n   * @param webhookContext Map of endpoint paths to webhook data\n   */\n  setWebhookContext?(webhookContext: Map<string, unknown>): void;\n}\n","import { extract } from '@probelabs/probe';\nimport * as path from 'path';\n\n/**\n * Process diff content using the outline-diff format from @probelabs/probe\n * This extracts a structured outline from the diff without requiring a temporary file\n */\nexport async function processDiffWithOutline(diffContent: string): Promise<string> {\n  if (!diffContent || diffContent.trim().length === 0) {\n    return diffContent;\n  }\n\n  try {\n    // Set PROBE_PATH to use the bundled binary with outline-diff support\n    // The SDK by default may download an older binary that doesn't support outline-diff\n    const originalProbePath = process.env.PROBE_PATH;\n\n    // Try multiple possible locations for the probe binary\n    // When bundled with ncc, __dirname may not be reliable\n    const fs = require('fs');\n    const possiblePaths = [\n      // Relative to current working directory (most common in production)\n      path.join(process.cwd(), 'node_modules/@probelabs/probe/bin/probe-binary'),\n      // Relative to __dirname (for unbundled development)\n      path.join(__dirname, '../..', 'node_modules/@probelabs/probe/bin/probe-binary'),\n      // Relative to dist directory (for bundled CLI)\n      path.join(__dirname, 'node_modules/@probelabs/probe/bin/probe-binary'),\n    ];\n\n    let probeBinaryPath: string | undefined;\n    for (const candidatePath of possiblePaths) {\n      if (fs.existsSync(candidatePath)) {\n        probeBinaryPath = candidatePath;\n        break;\n      }\n    }\n\n    // Only process if binary exists, otherwise fall back to original diff\n    if (!probeBinaryPath) {\n      if (process.env.DEBUG === '1' || process.env.VERBOSE === '1') {\n        console.error('Probe binary not found. Tried:', possiblePaths);\n      }\n      return diffContent;\n    }\n\n    process.env.PROBE_PATH = probeBinaryPath;\n\n    // Use extract with content parameter (can be string or Buffer)\n    // The TypeScript types haven't been updated yet, but the runtime supports it\n    // Add timeout to avoid hanging\n    const extractPromise = (extract as any)({\n      content: diffContent,\n      format: 'outline-diff',\n      allowTests: true, // Allow test files and test code blocks in extraction results\n    });\n\n    const timeoutPromise = new Promise((_, reject) => {\n      setTimeout(() => reject(new Error('Extract timeout after 30s')), 30000);\n    });\n\n    const result = await Promise.race([extractPromise, timeoutPromise]);\n\n    // Restore original PROBE_PATH\n    if (originalProbePath !== undefined) {\n      process.env.PROBE_PATH = originalProbePath;\n    } else {\n      delete process.env.PROBE_PATH;\n    }\n\n    // Return the processed outline diff\n    return typeof result === 'string' ? result : JSON.stringify(result);\n  } catch (error) {\n    // If outline-diff processing fails, fall back to the original diff\n    // Use console.error instead of console.warn to avoid polluting JSON output\n    if (process.env.DEBUG === '1' || process.env.VERBOSE === '1') {\n      console.error('Failed to process diff with outline-diff format:', error);\n    }\n    return diffContent;\n  }\n}\n","/**\n * Utility functions for parsing and handling Visor comment metadata\n */\n\n/**\n * Parse visor:thread metadata from a comment body\n * Reuses the same regex pattern from github-frontend.ts for consistency\n */\nexport function parseVisorThreadMetadata(\n  commentBody: string\n): { group?: string; [key: string]: any } | null {\n  const headerRe = /<!--\\s*visor:thread=(\\{[\\s\\S]*?\\})\\s*-->/m;\n  const match = headerRe.exec(commentBody);\n\n  if (!match) {\n    return null;\n  }\n\n  try {\n    const metadata = JSON.parse(match[1]);\n    return metadata && typeof metadata === 'object' && !Array.isArray(metadata) ? metadata : null;\n  } catch {\n    // If parsing fails, return null (graceful handling)\n    return null;\n  }\n}\n\n/**\n * Check if a comment should be filtered out when building AI context for code reviews.\n * This filters Visor's own review comments to avoid bias, while keeping user comments\n * and non-review Visor comments (like overview).\n *\n * @param commentBody - The body text of the comment\n * @returns true if the comment should be filtered out (excluded from AI context)\n */\nexport function shouldFilterVisorReviewComment(commentBody: string | undefined): boolean {\n  if (!commentBody) {\n    return false;\n  }\n\n  // Old format: check for visor-comment-id:pr-review- pattern\n  if (commentBody.includes('visor-comment-id:pr-review-')) {\n    return true;\n  }\n\n  // New format: check for visor:thread metadata with group=\"review\"\n  const metadata = parseVisorThreadMetadata(commentBody);\n  if (metadata && metadata.group === 'review') {\n    return true;\n  }\n\n  return false;\n}\n","import { ProbeAgent } from '@probelabs/probe';\nimport type { ProbeAgentOptions } from '@probelabs/probe';\nimport { PRInfo } from './pr-analyzer';\nimport { ReviewSummary, ReviewIssue } from './reviewer';\nimport { SessionRegistry } from './session-registry';\nimport { logger } from './logger';\nimport { trace as otTrace } from './telemetry/lazy-otel';\nimport { withActiveSpan } from './telemetry/trace-helpers';\nimport { initializeTracer } from './utils/tracer-init';\nimport { processDiffWithOutline } from './utils/diff-processor';\nimport { shouldFilterVisorReviewComment } from './utils/comment-metadata';\n\n/**\n * Helper function to log debug messages using the centralized logger\n */\nfunction log(...args: unknown[]): void {\n  logger.debug(args.join(' '));\n}\n\n/**\n * Generate current date XML tag for AI context\n */\nfunction getCurrentDateXml(): string {\n  const now = new Date();\n  return `<current_date>${now.toISOString().split('T')[0]}</current_date>`;\n}\n\nfunction createProbeTracerAdapter(fallbackTracer?: any) {\n  const fallback = fallbackTracer && typeof fallbackTracer === 'object' ? fallbackTracer : null;\n  const emitEvent = (name: string, attrs?: Record<string, unknown>) => {\n    try {\n      const span = otTrace.getActiveSpan();\n      if (span && typeof span.addEvent === 'function') {\n        span.addEvent(name, attrs as Record<string, unknown>);\n      }\n    } catch {}\n  };\n  return {\n    withSpan: async (\n      name: string,\n      fn: (...args: any[]) => Promise<any>,\n      attrs?: Record<string, unknown>\n    ) =>\n      withActiveSpan(name, attrs as Record<string, unknown>, async span => {\n        if (fallback && typeof fallback.withSpan === 'function') {\n          return await fallback.withSpan(name, async () => fn(span), attrs);\n        }\n        return await fn(span);\n      }),\n    recordEvent: (name: string, attrs?: Record<string, unknown>) => {\n      emitEvent(name, attrs);\n      if (fallback && typeof fallback.recordEvent === 'function') {\n        try {\n          fallback.recordEvent(name, attrs);\n        } catch {}\n      }\n    },\n    addEvent: (name: string, attrs?: Record<string, unknown>) => {\n      // Alias for ProbeAgent versions that call tracer.addEvent directly.\n      emitEvent(name, attrs);\n      if (fallback && typeof fallback.addEvent === 'function') {\n        try {\n          fallback.addEvent(name, attrs);\n        } catch {}\n      } else if (fallback && typeof fallback.recordEvent === 'function') {\n        try {\n          fallback.recordEvent(name, attrs);\n        } catch {}\n      }\n    },\n    recordDelegationEvent: (phase: string, attrs?: Record<string, unknown>) => {\n      emitEvent(`delegation.${phase}`, attrs);\n      if (fallback && typeof fallback.recordDelegationEvent === 'function') {\n        try {\n          fallback.recordDelegationEvent(phase, attrs);\n        } catch {}\n      }\n    },\n    recordMermaidValidationEvent: (phase: string, attrs?: Record<string, unknown>) => {\n      emitEvent(`mermaid.${phase}`, attrs);\n      if (fallback && typeof fallback.recordMermaidValidationEvent === 'function') {\n        try {\n          fallback.recordMermaidValidationEvent(phase, attrs);\n        } catch {}\n      }\n    },\n    recordJsonValidationEvent: (phase: string, attrs?: Record<string, unknown>) => {\n      emitEvent(`json.${phase}`, attrs);\n      if (fallback && typeof fallback.recordJsonValidationEvent === 'function') {\n        try {\n          fallback.recordJsonValidationEvent(phase, attrs);\n        } catch {}\n      }\n    },\n    createDelegationSpan: (sessionId: string, task: string) => {\n      let fallbackSpan: any = null;\n      if (fallback && typeof fallback.createDelegationSpan === 'function') {\n        try {\n          fallbackSpan = fallback.createDelegationSpan(sessionId, task);\n        } catch {}\n      }\n      let span: any = null;\n      try {\n        const tracer = otTrace.getTracer('visor');\n        span = tracer.startSpan('probe.delegation', {\n          attributes: {\n            'delegation.session_id': sessionId,\n            'delegation.task': task,\n          },\n        });\n      } catch {}\n      if (!span && fallbackSpan) return fallbackSpan;\n      if (!span) return null;\n      return {\n        setAttributes: (attrs?: Record<string, unknown>) => {\n          try {\n            if (attrs) span.setAttributes(attrs as Record<string, unknown>);\n          } catch {}\n          if (fallbackSpan && typeof fallbackSpan.setAttributes === 'function') {\n            try {\n              fallbackSpan.setAttributes(attrs);\n            } catch {}\n          }\n        },\n        setStatus: (status: unknown) => {\n          try {\n            span.setStatus(status as never);\n          } catch {}\n          if (fallbackSpan && typeof fallbackSpan.setStatus === 'function') {\n            try {\n              fallbackSpan.setStatus(status);\n            } catch {}\n          }\n        },\n        end: () => {\n          try {\n            span.end();\n          } catch {}\n          if (fallbackSpan && typeof fallbackSpan.end === 'function') {\n            try {\n              fallbackSpan.end();\n            } catch {}\n          }\n        },\n      };\n    },\n    flush: async () => {\n      if (fallback && typeof fallback.flush === 'function') {\n        await fallback.flush();\n      }\n    },\n    shutdown: async () => {\n      if (fallback && typeof fallback.shutdown === 'function') {\n        await fallback.shutdown();\n      }\n    },\n  };\n}\n\n/**\n * Extended ProbeAgent interface that includes tracing properties\n */\ninterface TracedProbeAgent extends ProbeAgent {\n  tracer?: unknown; // SimpleTelemetry tracer (probe removed AppTracer)\n  _telemetryConfig?: unknown; // SimpleTelemetry config (probe removed TelemetryConfig)\n  _traceFilePath?: string;\n}\n\n/**\n * Extended ProbeAgentOptions interface that includes tracing properties\n */\ninterface TracedProbeAgentOptions extends ProbeAgentOptions {\n  tracer?: unknown; // SimpleTelemetry tracer\n  _telemetryConfig?: unknown; // SimpleTelemetry config\n  _traceFilePath?: string;\n  customPrompt?: string;\n  maxIterations?: number;\n}\n\nexport interface AIReviewConfig {\n  apiKey?: string; // From env: GOOGLE_API_KEY, ANTHROPIC_API_KEY, OPENAI_API_KEY, CLAUDE_CODE_API_KEY, or AWS credentials\n  model?: string; // From env: MODEL_NAME (e.g., gemini-2.5-pro-preview-06-05)\n  timeout?: number; // Default: 1800000ms (30 minutes)\n  maxIterations?: number; // Maximum tool iterations for ProbeAgent\n  provider?: 'google' | 'anthropic' | 'openai' | 'bedrock' | 'mock' | 'claude-code';\n  debug?: boolean; // Enable debug mode\n  tools?: Array<{ name: string; [key: string]: unknown }>; // (unused) Legacy tool listing\n  // Pass-through MCP server configuration for ProbeAgent\n  mcpServers?: Record<string, import('./types/config').McpServerConfig>;\n  // Enable delegate tool for task distribution to subagents\n  enableDelegate?: boolean;\n  // Enable task management for tracking multi-goal requests\n  enableTasks?: boolean;\n  // ProbeAgent persona/prompt family (e.g., 'engineer', 'code-review', 'architect')\n  promptType?: string;\n  // System prompt to prepend (baseline/preamble). Replaces legacy customPrompt\n  systemPrompt?: string;\n  // Backward-compat: legacy key still accepted internally\n  customPrompt?: string;\n  // Retry configuration for AI provider calls\n  retry?: import('./types/config').AIRetryConfig;\n  // Fallback configuration for provider failures\n  fallback?: import('./types/config').AIFallbackConfig;\n  // Enable Edit and Create tools for file modification\n  allowEdit?: boolean;\n  // Filter allowed tools - supports whitelist, exclusion (!prefix), or raw AI mode (empty array)\n  allowedTools?: string[];\n  // Disable all tools for raw AI mode (alternative to allowedTools: [])\n  disableTools?: boolean;\n  // Enable bash command execution (shorthand for bashConfig.enabled)\n  allowBash?: boolean;\n  // Advanced bash command execution configuration\n  bashConfig?: import('./types/config').BashConfig;\n  // Optional workspace root and allowed folders for ProbeAgent.\n  // When provided, these are forwarded to ProbeAgent so tools like search/query\n  // operate inside the isolated workspace/projects instead of the Visor repo root.\n  path?: string;\n  allowedFolders?: string[];\n  // Completion prompt for post-completion validation/review (runs after attempt_completion)\n  completionPrompt?: string;\n  /** Shared concurrency limiter for global AI call gating */\n  concurrencyLimiter?: any;\n}\n\nexport interface AIDebugInfo {\n  /** The prompt sent to the AI */\n  prompt: string;\n  /** Raw response from the AI service */\n  rawResponse: string;\n  /** Provider used (google, anthropic, openai) */\n  provider: string;\n  /** Model used */\n  model: string;\n  /** API key source (for privacy, just show which env var) */\n  apiKeySource: string;\n  /** Processing time in milliseconds */\n  processingTime: number;\n  /** Prompt length in characters */\n  promptLength: number;\n  /** Response length in characters */\n  responseLength: number;\n  /** Any errors encountered */\n  errors?: string[];\n  /** Whether JSON parsing succeeded */\n  jsonParseSuccess: boolean;\n  /** Schema used for response validation */\n  schema?: string;\n  /** Schema name/type requested */\n  schemaName?: string;\n  /** Checks executed during this review */\n  checksExecuted?: string[];\n  /** Whether parallel execution was used */\n  parallelExecution?: boolean;\n  /** Timestamp when request was made */\n  timestamp: string;\n  /** Total API calls made */\n  totalApiCalls?: number;\n  /** Details about API calls made */\n  apiCallDetails?: Array<{\n    checkName: string;\n    provider: string;\n    model: string;\n    processingTime: number;\n    success: boolean;\n  }>;\n}\n\n// REMOVED: ReviewFocus type - only use custom prompts from .visor.yaml\n\ninterface AIResponseFormat {\n  // Array of issues for code review\n  issues?: Array<{\n    file: string;\n    line: number;\n    endLine?: number;\n    ruleId: string;\n    message: string;\n    severity: 'info' | 'warning' | 'error' | 'critical';\n    category: 'security' | 'performance' | 'style' | 'logic' | 'documentation';\n    suggestion?: string;\n    replacement?: string;\n  }>;\n}\n\nexport class AIReviewService {\n  private config: AIReviewConfig;\n  private sessionRegistry: SessionRegistry;\n\n  constructor(config: AIReviewConfig = {}) {\n    this.config = {\n      timeout: 1800000, // Increased timeout to 30 minutes for AI responses\n      ...config,\n    };\n\n    this.sessionRegistry = SessionRegistry.getInstance();\n\n    // If debug was not explicitly provided, honor standard env flags so tests/CLI\n    // can enable provider-level debug without modifying per-check configs.\n    if (typeof this.config.debug === 'undefined') {\n      try {\n        if (process.env.VISOR_PROVIDER_DEBUG === 'true' || process.env.VISOR_DEBUG === 'true') {\n          this.config.debug = true;\n        }\n      } catch {}\n    }\n\n    // Respect explicit provider if set (e.g., 'mock' during tests) â€” do not override from env\n    const providerExplicit =\n      typeof this.config.provider === 'string' && this.config.provider.length > 0;\n\n    // Auto-detect provider and API key from environment only when provider not explicitly set\n    if (!providerExplicit) {\n      if (!this.config.apiKey) {\n        if (process.env.CLAUDE_CODE_API_KEY) {\n          this.config.apiKey = process.env.CLAUDE_CODE_API_KEY;\n          this.config.provider = 'claude-code';\n        } else if (process.env.GOOGLE_API_KEY) {\n          this.config.apiKey = process.env.GOOGLE_API_KEY;\n          this.config.provider = 'google';\n        } else if (process.env.ANTHROPIC_API_KEY) {\n          this.config.apiKey = process.env.ANTHROPIC_API_KEY;\n          this.config.provider = 'anthropic';\n        } else if (process.env.OPENAI_API_KEY) {\n          this.config.apiKey = process.env.OPENAI_API_KEY;\n          this.config.provider = 'openai';\n        } else if (\n          // Check for AWS Bedrock credentials\n          (process.env.AWS_ACCESS_KEY_ID && process.env.AWS_SECRET_ACCESS_KEY) ||\n          process.env.AWS_BEDROCK_API_KEY\n        ) {\n          // For Bedrock, we don't set apiKey as it uses AWS credentials\n          // ProbeAgent will handle the authentication internally\n          this.config.provider = 'bedrock';\n          // Set a placeholder to pass validation\n          this.config.apiKey = 'AWS_CREDENTIALS';\n        }\n      }\n    }\n\n    // Auto-detect model from environment\n    if (!this.config.model && process.env.MODEL_NAME) {\n      this.config.model = process.env.MODEL_NAME;\n    }\n  }\n\n  // NOTE: per request, no additional redaction/encryption helpers are used.\n\n  /**\n   * Execute AI review using probe agent\n   */\n  async executeReview(\n    prInfo: PRInfo,\n    customPrompt: string,\n    schema?: string | Record<string, unknown>,\n    checkName?: string,\n    sessionId?: string\n  ): Promise<ReviewSummary> {\n    const startTime = Date.now();\n    const timestamp = new Date().toISOString();\n\n    // Build prompt from custom instructions\n    // Respect provider-level skip_code_context by skipping PR context wrapper when requested\n    const cfgAny: any = this.config as any;\n    const skipTransport = cfgAny?.skip_transport_context === true;\n    const skipPRContext =\n      cfgAny?.skip_code_context === true || (skipTransport && cfgAny?.skip_code_context !== false);\n    const skipSlackContext =\n      cfgAny?.skip_slack_context === true ||\n      (skipTransport && cfgAny?.skip_slack_context !== false);\n\n    const prompt = await this.buildCustomPrompt(prInfo, customPrompt, schema, {\n      skipPRContext,\n      skipSlackContext,\n    });\n\n    log(`Executing AI review with ${this.config.provider} provider...`);\n    log(`ðŸ”§ Debug: Raw schema parameter: ${JSON.stringify(schema)} (type: ${typeof schema})`);\n    log(`Schema type: ${schema || 'none (no schema)'}`);\n\n    let debugInfo: AIDebugInfo | undefined;\n    if (this.config.debug) {\n      debugInfo = {\n        prompt,\n        rawResponse: '',\n        provider: this.config.provider || 'unknown',\n        model: this.config.model || 'default',\n        apiKeySource: this.getApiKeySource(),\n        processingTime: 0,\n        promptLength: prompt.length,\n        responseLength: 0,\n        errors: [],\n        jsonParseSuccess: false,\n        timestamp,\n        schemaName: typeof schema === 'object' ? 'custom' : schema,\n        schema: undefined, // Will be populated when schema is loaded\n      };\n    }\n\n    // Handle mock model/provider first (no API key needed)\n    if (this.config.model === 'mock' || this.config.provider === 'mock') {\n      log('ðŸŽ­ Using mock AI model/provider for testing - skipping API key validation');\n    } else {\n      // Hydrate API key from environment even when provider is explicitly set\n      if (!this.config.apiKey) {\n        try {\n          if (this.config.provider === 'google' && process.env.GOOGLE_API_KEY) {\n            this.config.apiKey = process.env.GOOGLE_API_KEY;\n          } else if (this.config.provider === 'anthropic' && process.env.ANTHROPIC_API_KEY) {\n            this.config.apiKey = process.env.ANTHROPIC_API_KEY;\n          } else if (this.config.provider === 'openai' && process.env.OPENAI_API_KEY) {\n            this.config.apiKey = process.env.OPENAI_API_KEY;\n          } else if (this.config.provider === 'claude-code' && process.env.CLAUDE_CODE_API_KEY) {\n            this.config.apiKey = process.env.CLAUDE_CODE_API_KEY;\n          }\n        } catch {}\n      }\n      // Check if API key is available for real AI models\n      // Note: If no API key, ProbeAgent.initialize() will attempt CLI fallback (claude-code/codex)\n      if (!this.config.apiKey) {\n        log('âš ï¸ No API key configured - ProbeAgent will attempt CLI fallback (claude-code/codex)');\n        if (debugInfo) {\n          debugInfo.errors = debugInfo.errors || [];\n          debugInfo.errors.push('No API key configured - attempting CLI fallback');\n        }\n      }\n    }\n\n    try {\n      const call = this.callProbeAgent(prompt, schema, debugInfo, checkName, sessionId);\n      const timeoutMs = Math.max(0, this.config.timeout || 0);\n      const {\n        response,\n        effectiveSchema,\n        sessionId: usedSessionId,\n      } = timeoutMs > 0 ? await this.withTimeout(call, timeoutMs, 'AI review') : await call;\n      const processingTime = Date.now() - startTime;\n\n      if (debugInfo) {\n        debugInfo.rawResponse = response;\n        debugInfo.responseLength = response.length;\n        debugInfo.processingTime = processingTime;\n      }\n\n      const result = this.parseAIResponse(response, debugInfo, effectiveSchema);\n\n      // Expose the session ID used for this call so the engine can reuse it later\n      try {\n        (result as any).sessionId = usedSessionId;\n      } catch {}\n\n      if (debugInfo) {\n        result.debug = debugInfo;\n      }\n\n      return result;\n    } catch (error) {\n      if (debugInfo) {\n        debugInfo.errors = [error instanceof Error ? error.message : String(error)];\n        debugInfo.processingTime = Date.now() - startTime;\n\n        // In debug mode, return a review with the error captured\n        return {\n          issues: [\n            {\n              file: 'system',\n              line: 0,\n              ruleId: 'system/ai-execution-error',\n              message: error instanceof Error ? error.message : String(error),\n              severity: 'error',\n              category: 'logic',\n            },\n          ],\n          debug: debugInfo,\n        };\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * Execute AI review using session reuse - reuses an existing ProbeAgent session\n   * @param sessionMode - 'clone' (default) clones history, 'append' shares history\n   */\n  async executeReviewWithSessionReuse(\n    prInfo: PRInfo,\n    customPrompt: string,\n    parentSessionId: string,\n    schema?: string | Record<string, unknown>,\n    checkName?: string,\n    sessionMode: 'clone' | 'append' = 'clone'\n  ): Promise<ReviewSummary> {\n    const startTime = Date.now();\n    const timestamp = new Date().toISOString();\n\n    // Ensure API key is hydrated from environment for explicit providers\n    if (!this.config.apiKey) {\n      try {\n        if (this.config.provider === 'google' && process.env.GOOGLE_API_KEY) {\n          this.config.apiKey = process.env.GOOGLE_API_KEY;\n        } else if (this.config.provider === 'anthropic' && process.env.ANTHROPIC_API_KEY) {\n          this.config.apiKey = process.env.ANTHROPIC_API_KEY;\n        } else if (this.config.provider === 'openai' && process.env.OPENAI_API_KEY) {\n          this.config.apiKey = process.env.OPENAI_API_KEY;\n        } else if (this.config.provider === 'claude-code' && process.env.CLAUDE_CODE_API_KEY) {\n          this.config.apiKey = process.env.CLAUDE_CODE_API_KEY;\n        }\n      } catch {}\n    }\n    // Get the existing session\n    const existingAgent = this.sessionRegistry.getSession(parentSessionId);\n    if (!existingAgent) {\n      throw new Error(\n        `Session not found for reuse: ${parentSessionId}. Ensure the parent check completed successfully.`\n      );\n    }\n\n    // Build prompt from custom instructions\n    // When reusing session, skip PR context since it's already in the conversation history\n    const cfgAny: any = this.config as any;\n    const skipTransport = cfgAny?.skip_transport_context === true;\n    const skipSlackContext =\n      cfgAny?.skip_slack_context === true ||\n      (skipTransport && cfgAny?.skip_slack_context !== false);\n\n    const prompt = await this.buildCustomPrompt(prInfo, customPrompt, schema, {\n      // When reusing sessions we always skip PR context, regardless of flags\n      skipPRContext: true,\n      skipSlackContext,\n    });\n\n    // Determine which agent to use based on session mode\n    let agentToUse: typeof existingAgent;\n    let currentSessionId: string;\n\n    if (sessionMode === 'clone') {\n      // Clone the session - creates a new agent with copied history\n      // Include check name in the session ID for better tracing\n      currentSessionId = `${checkName}-session-${Date.now()}`;\n      log(\n        `ðŸ“‹ Cloning AI session ${parentSessionId} â†’ ${currentSessionId} for ${checkName} check...`\n      );\n\n      const clonedAgent = await this.sessionRegistry.cloneSession(\n        parentSessionId,\n        currentSessionId,\n        checkName // Pass checkName for tracing\n      );\n      if (!clonedAgent) {\n        throw new Error(`Failed to clone session ${parentSessionId}`);\n      }\n      agentToUse = clonedAgent;\n    } else {\n      // Append mode - use the same agent instance\n      log(`ðŸ”„ Appending to AI session ${parentSessionId} (shared history)...`);\n      agentToUse = existingAgent;\n      currentSessionId = parentSessionId;\n    }\n\n    log(`ðŸ”§ Debug: Raw schema parameter: ${JSON.stringify(schema)} (type: ${typeof schema})`);\n    log(`ðŸ“‹ Schema for this check: ${schema || 'none (no schema)'}`);\n    if (sessionMode === 'clone') {\n      log(`âœ… Cloned agent will use NEW schema (${schema}) - parent schema does not persist`);\n      log(`ðŸ”„ Clone operation ensures fresh agent with copied history but new configuration`);\n    } else {\n      log(`ðŸ”„ Append mode - using existing agent instance with shared history and configuration`);\n    }\n\n    let debugInfo: AIDebugInfo | undefined;\n    if (this.config.debug) {\n      debugInfo = {\n        prompt,\n        rawResponse: '',\n        provider: this.config.provider || 'unknown',\n        model: this.config.model || 'default',\n        apiKeySource: this.getApiKeySource(),\n        processingTime: 0,\n        promptLength: prompt.length,\n        responseLength: 0,\n        errors: [],\n        jsonParseSuccess: false,\n        timestamp,\n        schemaName: typeof schema === 'object' ? 'custom' : schema,\n        schema: undefined, // Will be populated when schema is loaded\n      };\n    }\n\n    try {\n      // Use the determined agent (cloned or original)\n      const call = this.callProbeAgentWithExistingSession(\n        agentToUse,\n        prompt,\n        schema,\n        debugInfo,\n        checkName\n      );\n      const timeoutMs = Math.max(0, this.config.timeout || 0);\n      const { response, effectiveSchema } =\n        timeoutMs > 0 ? await this.withTimeout(call, timeoutMs, 'AI review (session)') : await call;\n      const processingTime = Date.now() - startTime;\n\n      if (debugInfo) {\n        debugInfo.rawResponse = response;\n        debugInfo.responseLength = response.length;\n        debugInfo.processingTime = processingTime;\n      }\n\n      const result = this.parseAIResponse(response, debugInfo, effectiveSchema);\n\n      // Expose the session ID used for this call so the engine can clean it up\n      try {\n        (result as any).sessionId = currentSessionId;\n      } catch {}\n\n      if (debugInfo) {\n        result.debug = debugInfo;\n      }\n\n      // Include the session ID in the result for cleanup tracking\n      // Only include if we created a new cloned session\n      if (sessionMode === 'clone' && currentSessionId !== parentSessionId) {\n        result.sessionId = currentSessionId;\n      }\n\n      return result;\n    } catch (error) {\n      if (debugInfo) {\n        debugInfo.errors = [error instanceof Error ? error.message : String(error)];\n        debugInfo.processingTime = Date.now() - startTime;\n\n        // In debug mode, return a review with the error captured\n        return {\n          issues: [\n            {\n              file: 'system',\n              line: 0,\n              ruleId: 'system/ai-session-reuse-error',\n              message: error instanceof Error ? error.message : String(error),\n              severity: 'error',\n              category: 'logic',\n            },\n          ],\n          debug: debugInfo,\n        };\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * Promise timeout helper that rejects after ms if unresolved\n   */\n  private async withTimeout<T>(p: Promise<T>, ms: number, label = 'operation'): Promise<T> {\n    let timer: NodeJS.Timeout | undefined;\n    try {\n      const timeout = new Promise<never>((_, reject) => {\n        timer = setTimeout(() => reject(new Error(`${label} timed out after ${ms}ms`)), ms);\n      });\n      return (await Promise.race([p, timeout])) as T;\n    } finally {\n      if (timer) clearTimeout(timer);\n    }\n  }\n\n  /**\n   * Register a new AI session in the session registry\n   */\n  registerSession(sessionId: string, agent: TracedProbeAgent): void {\n    this.sessionRegistry.registerSession(sessionId, agent);\n  }\n\n  /**\n   * Cleanup a session from the registry\n   */\n  cleanupSession(sessionId: string): void {\n    this.sessionRegistry.unregisterSession(sessionId);\n  }\n\n  /**\n   * Build a custom prompt for AI review with XML-formatted data\n   */\n  private async buildCustomPrompt(\n    prInfo: PRInfo,\n    customInstructions: string,\n    schema?: string | Record<string, unknown>,\n    options?: { skipPRContext?: boolean; checkName?: string; skipSlackContext?: boolean }\n  ): Promise<string> {\n    // When reusing sessions, skip PR context to avoid sending duplicate diff data\n    const skipPRContext = options?.skipPRContext === true;\n    const skipSlackContext = options?.skipSlackContext === true;\n\n    // Check if we're using the code-review schema\n    const isCodeReviewSchema = schema === 'code-review';\n\n    const prContext = skipPRContext ? '' : await this.formatPRContext(prInfo, isCodeReviewSchema);\n    const slackContextXml =\n      skipSlackContext === true ? '' : this.formatSlackContextFromPRInfo(prInfo);\n    const traceIdXml = (prInfo as any).otelTraceId\n      ? `\\n    <trace_id>${this.escapeXml(String((prInfo as any).otelTraceId))}</trace_id>`\n      : '';\n    const isIssue = (prInfo as PRInfo & { isIssue?: boolean }).isIssue === true;\n\n    if (isIssue) {\n      // Issue context - no code analysis needed\n      if (skipPRContext && !slackContextXml) {\n        // Session reuse: just send new instructions (no context at all)\n        return `<instructions>\n${customInstructions}\n</instructions>`;\n      }\n\n      return `<review_request>\n  <instructions>\n${customInstructions}\n  </instructions>\n\n  <context>\n    ${getCurrentDateXml()}${traceIdXml}\n${prContext}${slackContextXml}\n  </context>\n\n  <rules>\n    <rule>Understand the issue context and requirements from the XML data structure</rule>\n    <rule>Provide helpful, actionable guidance based on the issue details</rule>\n    <rule>Be constructive and supportive in your analysis</rule>\n    <rule>Consider project conventions and patterns when making recommendations</rule>\n    <rule>Suggest practical solutions or next steps that address the specific concern</rule>\n    <rule>Focus on addressing the specific concern raised in the issue</rule>\n    <rule>Reference relevant XML elements like metadata, description, labels, assignees when providing context</rule>\n  </rules>\n</review_request>`;\n    }\n\n    // Only add review_request wrapper and PR-specific rules for code-review schema\n    if (isCodeReviewSchema) {\n      // PR context with code-review schema - structured XML format\n      const analysisType = prInfo.isIncremental ? 'INCREMENTAL' : 'FULL';\n\n      if (skipPRContext && !slackContextXml) {\n        // Session reuse: just send new instructions without repeating the context\n        return `<instructions>\n${customInstructions}\n</instructions>\n\n<reminder>\n  <rule>The code context and diff were provided in the previous message</rule>\n  <rule>Focus on the new analysis instructions above</rule>\n  <rule>Only analyze code that appears with + (additions) or - (deletions) in the diff sections</rule>\n  <rule>STRICT OUTPUT POLICY: Report only actual problems, risks, or deficiencies</rule>\n  <rule>SEVERITY ASSIGNMENT: Assign severity ONLY to problems introduced or left unresolved by this change</rule>\n</reminder>`;\n      }\n\n      return `<review_request>\n  <analysis_type>${analysisType}</analysis_type>\n\n  <analysis_focus>\n    ${\n      analysisType === 'INCREMENTAL'\n        ? 'You are analyzing a NEW COMMIT added to an existing PR. Focus on the changes in the commit_diff section for this specific commit.'\n        : 'You are analyzing the COMPLETE PR. Review all changes in the full_diff section.'\n    }\n  </analysis_focus>\n\n  <instructions>\n${customInstructions}\n  </instructions>\n\n  <context>\n    ${getCurrentDateXml()}${traceIdXml}\n${prContext}${slackContextXml}\n  </context>\n\n  <rules>\n    <rule>Only analyze code that appears with + (additions) or - (deletions) in the diff sections</rule>\n    <rule>Ignore unchanged code unless directly relevant to understanding a change</rule>\n    <rule>Line numbers in your response should match actual file line numbers from the diff</rule>\n    <rule>Focus on real issues, not nitpicks or cosmetic concerns</rule>\n    <rule>Provide actionable, specific feedback with clear remediation steps</rule>\n    <rule>For INCREMENTAL analysis, ONLY review changes in commit_diff section</rule>\n    <rule>For FULL analysis, review all changes in full_diff section</rule>\n    <rule>Reference specific XML elements like files_summary, metadata when providing context</rule>\n    <rule>STRICT OUTPUT POLICY: Report only actual problems, risks, or deficiencies. Do not write praise, congratulations, or celebratory text. Do not create issues that merely restate improvements or say \"no action needed\".</rule>\n    <rule>SEVERITY ASSIGNMENT: Assign severity ONLY to problems introduced or left unresolved by this change (critical/error/warning/info as appropriate). Do NOT create issue entries solely to acknowledge improvements; if no problems exist, return zero issues.</rule>\n  </rules>\n</review_request>`;\n    }\n\n    // For non-code-review schemas, just provide instructions and context without review-specific wrapper\n    if (skipPRContext && !slackContextXml) {\n      // Session reuse: just send new instructions (no context)\n      return `<instructions>\n${customInstructions}\n</instructions>`;\n    }\n\n    return `<instructions>\n${customInstructions}\n</instructions>\n\n<context>\n  ${getCurrentDateXml()}${traceIdXml}\n${prContext}${slackContextXml}\n</context>`;\n  }\n\n  // REMOVED: Built-in prompts - only use custom prompts from .visor.yaml\n\n  // REMOVED: getFocusInstructions - only use custom prompts from .visor.yaml\n\n  /**\n   * Format PR or Issue context for the AI using XML structure\n   */\n  private async formatPRContext(prInfo: PRInfo, isCodeReviewSchema?: boolean): Promise<string> {\n    // Check if this is an issue (not a PR)\n    const prContextInfo = prInfo as PRInfo & {\n      isPRContext?: boolean;\n      includeCodeContext?: boolean;\n      slackConversation?: unknown;\n    };\n    const isIssue = prContextInfo.isIssue === true;\n\n    // Check if we should include code context (diffs)\n    const isPRContext = prContextInfo.isPRContext === true;\n    const isSlackMode = prContextInfo.slackConversation !== undefined;\n\n    // Determine whether to include code context:\n    // - In explicit PR context (GitHub PR events), always include diffs\n    // - In Slack mode, default to NO code context unless explicitly requested\n    // - Otherwise, include code context unless explicitly disabled\n    let includeCodeContext: boolean;\n    if (isPRContext) {\n      includeCodeContext = true;\n    } else if (isSlackMode) {\n      // In Slack mode, only include code context if explicitly set to true\n      includeCodeContext = prContextInfo.includeCodeContext === true;\n    } else {\n      // Default: include unless explicitly disabled\n      includeCodeContext = prContextInfo.includeCodeContext !== false;\n    }\n\n    // Log the decision for transparency (debug level)\n    if (isPRContext) {\n      log('ðŸ” Including full code diffs in AI context (PR mode)');\n    } else if (isSlackMode && !includeCodeContext) {\n      log('ðŸ’¬ Slack mode: excluding code diffs (use includeCodeContext: true to enable)');\n    } else if (!includeCodeContext) {\n      log('ðŸ“Š Including only file summary in AI context (no diffs)');\n    } else {\n      log('ðŸ” Including code diffs in AI context');\n    }\n\n    if (isIssue) {\n      // Format as issue context\n      let context = `<issue>\n  <!-- Core issue metadata including identification, status, and timeline information -->\n  <metadata>\n    <number>${prInfo.number}</number>\n    <title>${this.escapeXml(prInfo.title)}</title>\n    <author>${prInfo.author}</author>\n    <state>${(prInfo as PRInfo & { eventContext?: { issue?: { state?: string; created_at?: string; updated_at?: string; comments?: number } } }).eventContext?.issue?.state || 'open'}</state>\n    <created_at>${(prInfo as PRInfo & { eventContext?: { issue?: { state?: string; created_at?: string; updated_at?: string; comments?: number } } }).eventContext?.issue?.created_at || ''}</created_at>\n    <updated_at>${(prInfo as PRInfo & { eventContext?: { issue?: { state?: string; updated_at?: string; comments?: number } } }).eventContext?.issue?.updated_at || ''}</updated_at>\n    <comments_count>${(prInfo as PRInfo & { eventContext?: { issue?: { comments?: number } } }).eventContext?.issue?.comments || 0}</comments_count>\n  </metadata>`;\n\n      // Add issue body/description if available\n      if (prInfo.body) {\n        context += `\n  <!-- Full issue description and body text provided by the issue author -->\n  <description>\n${this.escapeXml(prInfo.body)}\n  </description>`;\n      }\n\n      // Add labels if available\n      const eventContext = prInfo as PRInfo & {\n        eventContext?: { issue?: { labels?: Array<{ name?: string } | string> } };\n      };\n      const labels = eventContext.eventContext?.issue?.labels;\n      if (labels && labels.length > 0) {\n        context += `\n  <!-- Applied labels for issue categorization and organization -->\n  <labels>`;\n        labels.forEach((label: { name?: string } | string) => {\n          const labelName = typeof label === 'string' ? label : label.name || 'unknown';\n          context += `\n    <label>${this.escapeXml(labelName)}</label>`;\n        });\n        context += `\n  </labels>`;\n      }\n\n      // Add assignees if available\n      const assignees = (\n        prInfo as PRInfo & {\n          eventContext?: { issue?: { assignees?: Array<{ login?: string } | string> } };\n        }\n      ).eventContext?.issue?.assignees;\n      if (assignees && assignees.length > 0) {\n        context += `\n  <!-- Users assigned to work on this issue -->\n  <assignees>`;\n        assignees.forEach((assignee: { login?: string } | string) => {\n          const assigneeName =\n            typeof assignee === 'string' ? assignee : assignee.login || 'unknown';\n          context += `\n    <assignee>${this.escapeXml(assigneeName)}</assignee>`;\n        });\n        context += `\n  </assignees>`;\n      }\n\n      // Add milestone if available\n      const milestone = (\n        prInfo as PRInfo & {\n          eventContext?: {\n            issue?: { milestone?: { title?: string; state?: string; due_on?: string } };\n          };\n        }\n      ).eventContext?.issue?.milestone;\n      if (milestone) {\n        context += `\n  <!-- Associated project milestone information -->\n  <milestone>\n    <title>${this.escapeXml(milestone.title || '')}</title>\n    <state>${milestone.state || 'open'}</state>\n    <due_on>${milestone.due_on || ''}</due_on>\n  </milestone>`;\n      }\n\n      // Add current/triggering comment if this is a comment event\n      const triggeringComment = (\n        prInfo as PRInfo & {\n          eventContext?: {\n            comment?: {\n              user?: { login?: string };\n              created_at?: string;\n              body?: string;\n              id?: number;\n            };\n          };\n        }\n      ).eventContext?.comment;\n      if (triggeringComment) {\n        context += `\n  <!-- The comment that triggered this analysis -->\n  <triggering_comment>\n    <author>${this.escapeXml(triggeringComment.user?.login || 'unknown')}</author>\n    <created_at>${triggeringComment.created_at || ''}</created_at>\n    <body>${this.escapeXml(triggeringComment.body || '')}</body>\n  </triggering_comment>`;\n      }\n\n      // Add comment history (excluding the current comment if it exists)\n      const issueComments = (\n        prInfo as PRInfo & {\n          comments?: Array<{ id?: number; author?: string; body?: string; createdAt?: string }>;\n        }\n      ).comments;\n      if (issueComments && issueComments.length > 0) {\n        // Filter out the triggering comment from history if present\n        let historicalComments = triggeringComment\n          ? issueComments.filter(c => c.id !== triggeringComment.id)\n          : issueComments;\n\n        // For code-review schema checks, filter out previous Visor code-review comments to avoid self-bias\n        // Old format: <!-- visor-comment-id:pr-review-244-review -->\n        // New format: <!-- visor:thread={\"key\":\"...\",\"group\":\"review\",...} -->\n        if (isCodeReviewSchema) {\n          historicalComments = historicalComments.filter(\n            c => !shouldFilterVisorReviewComment(c.body)\n          );\n        }\n\n        if (historicalComments.length > 0) {\n          context += `\n  <!-- Previous comments in chronological order (excluding triggering comment) -->\n  <comment_history>`;\n          historicalComments.forEach(comment => {\n            context += `\n    <comment>\n      <author>${this.escapeXml(comment.author || 'unknown')}</author>\n      <created_at>${comment.createdAt || ''}</created_at>\n      <body>${this.escapeXml(comment.body || '')}</body>\n    </comment>`;\n          });\n          context += `\n  </comment_history>`;\n        }\n      }\n\n      // Close the issue tag\n      context += `\n</issue>`;\n\n      return context;\n    }\n\n    // Original PR context formatting\n    let context = `<pull_request>\n  <!-- Core pull request metadata including identification, branches, and change statistics -->\n  <metadata>\n    <number>${prInfo.number}</number>\n    <title>${this.escapeXml(prInfo.title)}</title>\n    <author>${prInfo.author}</author>\n    <base_branch>${prInfo.base}</base_branch>\n    <target_branch>${prInfo.head}</target_branch>\n    <total_additions>${prInfo.totalAdditions}</total_additions>\n    <total_deletions>${prInfo.totalDeletions}</total_deletions>\n    <files_changed_count>${prInfo.files.length}</files_changed_count>\n  </metadata>`;\n\n    // Include a small raw diff header snippet for compatibility with tools/tests\n    try {\n      const firstFile = (prInfo.files || [])[0];\n      if (firstFile && firstFile.filename) {\n        context += `\\n  <raw_diff_header>\\n${this.escapeXml(`diff --git a/${firstFile.filename} b/${firstFile.filename}`)}\\n  </raw_diff_header>`;\n      }\n    } catch {}\n\n    // Add PR description if available\n    if (prInfo.body) {\n      context += `\n  <!-- Full pull request description provided by the author -->\n  <description>\n${this.escapeXml(prInfo.body)}\n  </description>`;\n    }\n\n    // Add diffs only if includeCodeContext is true (or in PR mode)\n    if (includeCodeContext) {\n      // Add full diff if available (for complete PR review)\n      if (prInfo.fullDiff) {\n        // Process the diff with outline-diff format for better structure\n        const processedFullDiff = await processDiffWithOutline(prInfo.fullDiff);\n        context += `\n  <!-- Complete unified diff showing all changes in the pull request (processed with outline-diff) -->\n  <full_diff>\n${this.escapeXml(processedFullDiff)}\n  </full_diff>`;\n      }\n\n      // Add incremental commit diff if available (for new commit analysis)\n      if (prInfo.isIncremental) {\n        if (prInfo.commitDiff && prInfo.commitDiff.length > 0) {\n          // Process the commit diff with outline-diff format for better structure\n          const processedCommitDiff = await processDiffWithOutline(prInfo.commitDiff);\n          context += `\n  <!-- Diff of only the latest commit for incremental analysis (processed with outline-diff) -->\n  <commit_diff>\n${this.escapeXml(processedCommitDiff)}\n  </commit_diff>`;\n        } else {\n          // Process the fallback full diff with outline-diff format\n          const processedFallbackDiff = prInfo.fullDiff\n            ? await processDiffWithOutline(prInfo.fullDiff)\n            : '';\n          context += `\n  <!-- Commit diff could not be retrieved - falling back to full diff analysis (processed with outline-diff) -->\n  <commit_diff>\n${this.escapeXml(processedFallbackDiff)}\n  </commit_diff>`;\n        }\n      }\n    } else {\n      // When not including diffs, add a note about it\n      context += `\n  <!-- Code diffs excluded to reduce token usage (no code-review schema detected or disabled by flag) -->`;\n    }\n\n    // Add file summary for context\n    if (prInfo.files.length > 0) {\n      context += `\n  <!-- Summary of all files changed with statistics -->\n  <files_summary>`;\n      prInfo.files.forEach(file => {\n        context += `\n    <file>\n      <filename>${this.escapeXml(file.filename)}</filename>\n      <status>${file.status}</status>\n      <additions>${file.additions}</additions>\n      <deletions>${file.deletions}</deletions>\n    </file>`;\n      });\n      context += `\n  </files_summary>`;\n    }\n\n    // Add current/triggering comment if this is a comment event\n    const triggeringComment = (\n      prInfo as PRInfo & {\n        eventContext?: {\n          comment?: { user?: { login?: string }; created_at?: string; body?: string; id?: number };\n        };\n      }\n    ).eventContext?.comment;\n    if (triggeringComment) {\n      context += `\n  <!-- The comment that triggered this analysis -->\n  <triggering_comment>\n    <author>${this.escapeXml(triggeringComment.user?.login || 'unknown')}</author>\n    <created_at>${triggeringComment.created_at || ''}</created_at>\n    <body>${this.escapeXml(triggeringComment.body || '')}</body>\n  </triggering_comment>`;\n    }\n\n    // Add comment history (excluding the current comment if it exists)\n    const prComments = (\n      prInfo as PRInfo & {\n        comments?: Array<{ id?: number; author?: string; body?: string; createdAt?: string }>;\n      }\n    ).comments;\n    if (prComments && prComments.length > 0) {\n      // Filter out the triggering comment from history if present\n      let historicalComments = triggeringComment\n        ? prComments.filter(c => c.id !== triggeringComment.id)\n        : prComments;\n\n      // For code-review schema checks, filter out previous Visor code-review comments to avoid self-bias\n      // Old format: <!-- visor-comment-id:pr-review-244-review -->\n      // New format: <!-- visor:thread={\"key\":\"...\",\"group\":\"review\",...} -->\n      if (isCodeReviewSchema) {\n        historicalComments = historicalComments.filter(\n          c => !shouldFilterVisorReviewComment(c.body)\n        );\n      }\n\n      if (historicalComments.length > 0) {\n        context += `\n  <!-- Previous PR comments in chronological order (excluding triggering comment) -->\n  <comment_history>`;\n        historicalComments.forEach(comment => {\n          context += `\n    <comment>\n      <author>${this.escapeXml(comment.author || 'unknown')}</author>\n      <created_at>${comment.createdAt || ''}</created_at>\n      <body>${this.escapeXml(comment.body || '')}</body>\n    </comment>`;\n        });\n        context += `\n  </comment_history>`;\n      }\n    }\n\n    context += `\n</pull_request>`;\n\n    return context;\n  }\n\n  /**\n   * Format Slack conversation context (if attached to PRInfo) as XML\n   */\n  private formatSlackContextFromPRInfo(prInfo: PRInfo): string {\n    try {\n      const anyInfo: any = prInfo as any;\n      const conv = anyInfo.slackConversation;\n      if (!conv || typeof conv !== 'object') return '';\n\n      const transport = conv.transport || 'slack';\n      const thread = conv.thread || {};\n      const messages = Array.isArray(conv.messages) ? conv.messages : [];\n      const current = conv.current || {};\n      const attrs = conv.attributes || {};\n\n      let xml = `\n<slack_context>\n  <transport>${this.escapeXml(String(transport))}</transport>\n  <thread>\n    <id>${this.escapeXml(String(thread.id || ''))}</id>\n    <url>${this.escapeXml(String(thread.url || ''))}</url>\n  </thread>`;\n\n      // Attributes (channel, user, thread_ts, etc.)\n      const attrKeys = Object.keys(attrs);\n      if (attrKeys.length > 0) {\n        xml += `\n  <attributes>`;\n        for (const k of attrKeys) {\n          const v = attrs[k];\n          xml += `\n    <attribute>\n      <key>${this.escapeXml(String(k))}</key>\n      <value>${this.escapeXml(String(v ?? ''))}</value>\n    </attribute>`;\n        }\n        xml += `\n  </attributes>`;\n      }\n\n      // Message history\n      if (messages.length > 0) {\n        xml += `\n  <messages>`;\n        for (const m of messages) {\n          xml += `\n    <message>\n      <role>${this.escapeXml(String(m.role || 'user'))}</role>\n      <user>${this.escapeXml(String((m as any).user || ''))}</user>\n      <text>${this.escapeXml(String(m.text || ''))}</text>\n      <timestamp>${this.escapeXml(String(m.timestamp || ''))}</timestamp>\n      <origin>${this.escapeXml(String(m.origin || ''))}</origin>\n    </message>`;\n        }\n        xml += `\n  </messages>`;\n      }\n\n      // Current message (the one that triggered this run)\n      xml += `\n  <current>\n    <role>${this.escapeXml(String(current.role || 'user'))}</role>\n    <user>${this.escapeXml(String((current as any).user || ''))}</user>\n    <text>${this.escapeXml(String(current.text || ''))}</text>\n    <timestamp>${this.escapeXml(String(current.timestamp || ''))}</timestamp>\n    <origin>${this.escapeXml(String(current.origin || ''))}</origin>\n  </current>\n</slack_context>`;\n\n      return xml;\n    } catch {\n      return '';\n    }\n  }\n\n  /**\n   * Build a normalized ConversationContext for GitHub (PR/issue + comments)\n   * using the same contract as Slack's ConversationContext. This is exposed\n   * to templates via the unified `conversation` object.\n   */\n  private buildGitHubConversationFromPRInfo(\n    prInfo: PRInfo\n  ): import('./types/bot').ConversationContext | undefined {\n    try {\n      const anyInfo: any = prInfo as any;\n      const eventCtx: any = anyInfo.eventContext || {};\n      const comments: Array<import('./pr-analyzer').PRComment> = anyInfo.comments || [];\n\n      // Basic repo + thread identity from eventContext if available\n      const repoOwner: string | undefined =\n        eventCtx.repository?.owner?.login || process.env.GITHUB_REPOSITORY?.split('/')?.[0];\n      const repoName: string | undefined =\n        eventCtx.repository?.name || process.env.GITHUB_REPOSITORY?.split('/')?.[1];\n\n      const number = prInfo.number;\n      const threadId =\n        repoOwner && repoName ? `${repoOwner}/${repoName}#${number}` : `github#${number}`;\n      const threadUrl =\n        eventCtx.issue?.html_url ||\n        eventCtx.pull_request?.html_url ||\n        (repoOwner && repoName\n          ? `https://github.com/${repoOwner}/${repoName}/pull/${number}`\n          : undefined);\n\n      const messages: import('./types/bot').NormalizedMessage[] = [];\n\n      // Synthetic root message: PR/issue body\n      if (prInfo.body && prInfo.body.trim().length > 0) {\n        messages.push({\n          role: 'user',\n          user: prInfo.author || 'unknown',\n          text: prInfo.body,\n          timestamp: (eventCtx.pull_request?.created_at ||\n            eventCtx.issue?.created_at ||\n            '') as string,\n          origin: 'github',\n        });\n      }\n\n      // Historical comments in chronological order (already sorted by PRAnalyzer)\n      for (const c of comments) {\n        messages.push({\n          role: 'user',\n          user: c.author || 'unknown',\n          text: c.body || '',\n          timestamp: c.createdAt || '',\n          origin: 'github',\n        });\n      }\n\n      // Current / triggering comment, if present\n      const triggeringComment = eventCtx.comment as\n        | { user?: { login?: string }; created_at?: string; body?: string }\n        | undefined;\n\n      let current: import('./types/bot').NormalizedMessage;\n      if (triggeringComment) {\n        current = {\n          role: 'user',\n          user: (triggeringComment.user && triggeringComment.user.login) || 'unknown',\n          text: triggeringComment.body || '',\n          timestamp: triggeringComment.created_at || '',\n          origin: 'github',\n        };\n      } else if (messages.length > 0) {\n        current = messages[messages.length - 1];\n      } else {\n        // Fallback synthetic current message from title if body/comments are empty\n        current = {\n          role: 'user',\n          user: prInfo.author || 'unknown',\n          text: prInfo.title || '',\n          timestamp: '',\n          origin: 'github',\n        };\n      }\n\n      // Attributes: useful metadata for templates/tooling\n      const attributes: Record<string, string> = {};\n      if (repoOwner) attributes.owner = repoOwner;\n      if (repoName) attributes.repo = repoName;\n      attributes.number = String(number);\n      if (eventCtx.event_name) attributes.event_name = String(eventCtx.event_name);\n      if (eventCtx.action) attributes.action = String(eventCtx.action);\n\n      const ctx: import('./types/bot').ConversationContext = {\n        transport: 'github',\n        thread: { id: threadId, url: threadUrl },\n        messages,\n        current,\n        attributes,\n      };\n      return ctx;\n    } catch {\n      return undefined;\n    }\n  }\n\n  /**\n   * No longer escaping XML - returning text as-is\n   */\n  private escapeXml(text: string): string {\n    return text;\n  }\n\n  /**\n   * Call ProbeAgent with an existing session\n   */\n  private async callProbeAgentWithExistingSession(\n    agent: TracedProbeAgent,\n    prompt: string,\n    schema?: string | Record<string, unknown>,\n    debugInfo?: AIDebugInfo,\n    _checkName?: string\n  ): Promise<{ response: string; effectiveSchema?: string }> {\n    // Handle mock model/provider for testing\n    if (this.config.model === 'mock' || this.config.provider === 'mock') {\n      log('ðŸŽ­ Using mock AI model/provider for testing (session reuse)');\n      const response = await this.generateMockResponse(prompt, _checkName, schema);\n      return { response, effectiveSchema: typeof schema === 'object' ? 'custom' : schema };\n    }\n\n    log('ðŸ”„ Reusing existing ProbeAgent session for AI review...');\n    log(`ðŸ“ Prompt length: ${prompt.length} characters`);\n    log(`âš™ï¸ Model: ${this.config.model || 'default'}, Provider: ${this.config.provider || 'auto'}`);\n\n    try {\n      log('ðŸš€ Calling existing ProbeAgent with answer()...');\n\n      // Load and pass the actual schema content if provided (skip for plain schema)\n      let schemaString: string | undefined = undefined;\n      let effectiveSchema: string | undefined = typeof schema === 'object' ? 'custom' : schema;\n\n      if (schema && schema !== 'plain') {\n        try {\n          schemaString = await this.loadSchemaContent(schema);\n          log(`ðŸ“‹ Loaded schema content for: ${schema}`);\n          log(`ðŸ“„ Raw schema JSON:\\n${schemaString}`);\n        } catch (error) {\n          log(`âš ï¸ Failed to load schema ${schema}, proceeding without schema:`, error);\n          schemaString = undefined;\n          effectiveSchema = undefined; // Schema loading failed, treat as no schema\n          if (debugInfo && debugInfo.errors) {\n            debugInfo.errors.push(`Failed to load schema: ${error}`);\n          }\n        }\n      } else if (schema === 'plain') {\n        log(`ðŸ“‹ Using plain schema - no JSON validation will be applied`);\n      }\n\n      // Pass schema in options object with 'schema' property\n      const schemaOptions = schemaString ? { schema: schemaString } : undefined;\n\n      // Store the exact schema options being passed to ProbeAgent in debug info\n      if (debugInfo && schemaOptions) {\n        debugInfo.schema = JSON.stringify(schemaOptions, null, 2);\n      }\n\n      // Log the schema options being passed to ProbeAgent\n      if (schemaOptions) {\n        log(`ðŸŽ¯ Schema options passed to ProbeAgent.answer() (session reuse):`);\n        log(JSON.stringify(schemaOptions, null, 2));\n      }\n\n      // Save prompt and debug info for session reuse too (only if debug enabled)\n      if (process.env.VISOR_DEBUG_AI_SESSIONS === 'true') {\n        try {\n          const fs = require('fs');\n          const path = require('path');\n          const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n          const provider = this.config.provider || 'auto';\n          const model = this.config.model || 'default';\n\n          // Try to extract conversation history from ProbeAgent\n          let conversationHistory: any[] = [];\n          try {\n            // ProbeAgent stores history in different ways depending on version\n            const agentAny = agent as any;\n            if (agentAny.history) {\n              conversationHistory = agentAny.history;\n            } else if (agentAny.messages) {\n              conversationHistory = agentAny.messages;\n            } else if (agentAny._messages) {\n              conversationHistory = agentAny._messages;\n            }\n          } catch {\n            // Ignore if we can't access history\n          }\n\n          const debugData = {\n            timestamp: timestamp,\n            checkName: _checkName || 'unknown',\n            provider: provider,\n            model: model,\n            schema: effectiveSchema,\n            schemaOptions: schemaOptions || 'none',\n            sessionInfo: {\n              isSessionReuse: true,\n              historyMessageCount: conversationHistory.length,\n            },\n            currentPromptLength: prompt.length,\n            currentPrompt: prompt,\n            conversationHistory: conversationHistory,\n          };\n\n          const debugJson = JSON.stringify(debugData, null, 2);\n\n          // Also create a human-readable version with clear separators\n          let readableVersion = `=============================================================\\n`;\n          readableVersion += `VISOR DEBUG REPORT - SESSION REUSE\\n`;\n          readableVersion += `=============================================================\\n`;\n          readableVersion += `Timestamp: ${timestamp}\\n`;\n          readableVersion += `Check Name: ${_checkName || 'unknown'}\\n`;\n          readableVersion += `Provider: ${provider}\\n`;\n          readableVersion += `Model: ${model}\\n`;\n          readableVersion += `Schema: ${effectiveSchema}\\n`;\n          readableVersion += `Schema Options: ${schemaOptions ? 'provided' : 'none'}\\n`;\n          readableVersion += `History Messages: ${conversationHistory.length}\\n`;\n          readableVersion += `=============================================================\\n\\n`;\n\n          // Add schema details if provided\n          if (schemaOptions) {\n            readableVersion += `\\n${'='.repeat(60)}\\n`;\n            readableVersion += `SCHEMA CONFIGURATION\\n`;\n            readableVersion += `${'='.repeat(60)}\\n`;\n            readableVersion += JSON.stringify(schemaOptions, null, 2);\n            readableVersion += `\\n`;\n          }\n\n          // Add conversation history with clear separators\n          if (conversationHistory.length > 0) {\n            readableVersion += `\\n${'='.repeat(60)}\\n`;\n            readableVersion += `CONVERSATION HISTORY (${conversationHistory.length} messages)\\n`;\n            readableVersion += `${'='.repeat(60)}\\n`;\n            conversationHistory.forEach((msg: any, index: number) => {\n              readableVersion += `\\n${'-'.repeat(60)}\\n`;\n              readableVersion += `MESSAGE #${index + 1}\\n`;\n              readableVersion += `Role: ${msg.role || 'unknown'}\\n`;\n              if (msg.content) {\n                const contentStr =\n                  typeof msg.content === 'string'\n                    ? msg.content\n                    : JSON.stringify(msg.content, null, 2);\n                readableVersion += `Length: ${contentStr.length} characters\\n`;\n                readableVersion += `${'-'.repeat(60)}\\n`;\n                readableVersion += `${contentStr}\\n`;\n              }\n            });\n          }\n\n          // Add current prompt\n          readableVersion += `\\n${'='.repeat(60)}\\n`;\n          readableVersion += `CURRENT PROMPT (NEW MESSAGE)\\n`;\n          readableVersion += `${'='.repeat(60)}\\n`;\n          readableVersion += `Length: ${prompt.length} characters\\n`;\n          readableVersion += `${'-'.repeat(60)}\\n`;\n          readableVersion += `${prompt}\\n`;\n          readableVersion += `\\n${'='.repeat(60)}\\n`;\n          readableVersion += `END OF DEBUG REPORT\\n`;\n          readableVersion += `${'='.repeat(60)}\\n`;\n\n          const debugArtifactsDir =\n            process.env.VISOR_DEBUG_ARTIFACTS || path.join(process.cwd(), 'debug-artifacts');\n          if (!fs.existsSync(debugArtifactsDir)) {\n            fs.mkdirSync(debugArtifactsDir, { recursive: true });\n          }\n\n          // Save JSON version\n          const debugFile = path.join(\n            debugArtifactsDir,\n            `prompt-${_checkName || 'unknown'}-${timestamp}.json`\n          );\n          fs.writeFileSync(debugFile, debugJson, 'utf-8');\n\n          // Save readable version\n          const readableFile = path.join(\n            debugArtifactsDir,\n            `prompt-${_checkName || 'unknown'}-${timestamp}.txt`\n          );\n          fs.writeFileSync(readableFile, readableVersion, 'utf-8');\n\n          log(`\\nðŸ’¾ Full debug info saved to:`);\n          log(`   JSON: ${debugFile}`);\n          log(`   TXT:  ${readableFile}`);\n          log(`   - Includes: full conversation history, schema, current prompt`);\n        } catch (error) {\n          log(`âš ï¸ Could not save debug file: ${error}`);\n        }\n      }\n\n      // Use existing agent's answer method - this reuses the conversation context\n      // Wrap in a span for hierarchical tracing\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const agentAny = agent as any;\n      // Ensure Probe spans are emitted as children of the active Visor span.\n      agentAny.tracer = createProbeTracerAdapter(agentAny.tracer);\n      let response: string;\n      if (agentAny.tracer && typeof agentAny.tracer.withSpan === 'function') {\n        response = await agentAny.tracer.withSpan(\n          'visor.ai_check_reuse',\n          async () => {\n            return await agent.answer(prompt, undefined, schemaOptions);\n          },\n          {\n            'check.name': _checkName || 'unknown',\n            'check.mode': 'session_reuse',\n            'prompt.length': prompt.length,\n            'schema.type': effectiveSchema || 'none',\n          }\n        );\n      } else {\n        response = schemaOptions\n          ? await agent.answer(prompt, undefined, schemaOptions)\n          : await agent.answer(prompt);\n      }\n\n      log('âœ… ProbeAgent session reuse completed successfully');\n      log(`ðŸ“¤ Response length: ${response.length} characters`);\n\n      // Save COMPLETE conversation history AFTER AI response (only if debug enabled)\n      if (process.env.VISOR_DEBUG_AI_SESSIONS === 'true') {\n        try {\n          const fs = require('fs');\n          const path = require('path');\n          const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n\n          // Extract FULL conversation history AFTER the AI call\n          const agentAny = agent as any;\n          let fullHistory: any[] = [];\n\n          // Try multiple properties to get complete history\n          if (agentAny.history) {\n            fullHistory = agentAny.history;\n          } else if (agentAny.messages) {\n            fullHistory = agentAny.messages;\n          } else if (agentAny._messages) {\n            fullHistory = agentAny._messages;\n          }\n\n          const debugArtifactsDir =\n            process.env.VISOR_DEBUG_ARTIFACTS || path.join(process.cwd(), 'debug-artifacts');\n          // do not enforce directory perms here\n\n          // Save complete session history (all messages sent and received)\n          const sessionBase = path.join(\n            debugArtifactsDir,\n            `session-${_checkName || 'unknown'}-${timestamp}`\n          );\n          const sessionData = {\n            timestamp,\n            checkName: _checkName || 'unknown',\n            provider: this.config.provider || 'auto',\n            model: this.config.model || 'default',\n            schema: effectiveSchema,\n            totalMessages: fullHistory.length,\n          };\n          fs.writeFileSync(sessionBase + '.json', JSON.stringify(sessionData, null, 2), 'utf-8');\n\n          // Redacted textual summary\n          let readable = `=============================================================\n`;\n          readable += `COMPLETE AI SESSION HISTORY (AFTER RESPONSE)\n`;\n          readable += `=============================================================\n`;\n          readable += `Timestamp: ${timestamp}\n`;\n          readable += `Check: ${_checkName || 'unknown'}\n`;\n          readable += `Total Messages: ${fullHistory.length}\n`;\n          readable += `=============================================================\n\n`;\n          fullHistory.forEach((msg: any, idx: number) => {\n            const role = msg.role || 'unknown';\n            const content =\n              typeof msg.content === 'string' ? msg.content : JSON.stringify(msg.content, null, 2);\n            readable += `\n${'='.repeat(60)}\nMESSAGE ${idx + 1}/${fullHistory.length}\nRole: ${role}\n${'='.repeat(60)}\n`;\n            readable += content + '\\n';\n          });\n          fs.writeFileSync(sessionBase + '.summary.txt', readable, 'utf-8');\n\n          log(`ðŸ’¾ Complete session history saved:`);\n          // (paths omitted)\n          log(`   - Contains ALL ${fullHistory.length} messages (prompts + responses)`);\n        } catch (error) {\n          log(`âš ï¸ Could not save complete session history: ${error}`);\n        }\n      }\n\n      // Save response if debug is enabled\n      if (process.env.VISOR_DEBUG_AI_SESSIONS === 'true') {\n        try {\n          const fs = require('fs');\n          const path = require('path');\n          const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n\n          const debugArtifactsDir =\n            process.env.VISOR_DEBUG_ARTIFACTS || path.join(process.cwd(), 'debug-artifacts');\n\n          // Create a response file with the same timestamp pattern\n          const responseFile = path.join(\n            debugArtifactsDir,\n            `response-${_checkName || 'unknown'}-${timestamp}.txt`\n          );\n\n          let responseContent = `=============================================================\\n`;\n          responseContent += `VISOR AI RESPONSE - SESSION REUSE\\n`;\n          responseContent += `=============================================================\\n`;\n          responseContent += `Timestamp: ${timestamp}\\n`;\n          responseContent += `Check Name: ${_checkName || 'unknown'}\\n`;\n          responseContent += `Response Length: ${response.length} characters\\n`;\n          responseContent += `=============================================================\\n\\n`;\n          responseContent += `${'='.repeat(60)}\\n`;\n          responseContent += `AI RESPONSE\\n`;\n          responseContent += `${'='.repeat(60)}\\n`;\n          responseContent += response;\n          responseContent += `\\n${'='.repeat(60)}\\n`;\n          responseContent += `END OF RESPONSE\\n`;\n          responseContent += `${'='.repeat(60)}\\n`;\n\n          fs.writeFileSync(responseFile, responseContent, 'utf-8');\n          log(`ðŸ’¾ Response saved to: ${responseFile}`);\n        } catch (error) {\n          log(`âš ï¸ Could not save response file: ${error}`);\n        }\n      }\n\n      // Finalize and save trace if this is a cloned session with tracing enabled\n      // Properly flush and shutdown OpenTelemetry to ensure all spans are exported\n      if (agentAny._traceFilePath && agentAny._telemetryConfig) {\n        try {\n          // First flush the tracer to export pending spans\n          if (agentAny.tracer && typeof agentAny.tracer.flush === 'function') {\n            await agentAny.tracer.flush();\n            log(`ðŸ”„ Flushed tracer spans for cloned session`);\n          }\n\n          // Then shutdown the telemetry config to finalize all exporters\n          if (\n            agentAny._telemetryConfig &&\n            typeof agentAny._telemetryConfig.shutdown === 'function'\n          ) {\n            await agentAny._telemetryConfig.shutdown();\n            log(`ðŸ“Š OpenTelemetry trace saved to: ${agentAny._traceFilePath}`);\n\n            // In GitHub Actions, also log file size for verification\n            if (process.env.GITHUB_ACTIONS) {\n              const fs = require('fs');\n              if (fs.existsSync(agentAny._traceFilePath)) {\n                const stats = fs.statSync(agentAny._traceFilePath);\n                console.log(\n                  `::notice title=AI Trace Saved::${agentAny._traceFilePath} (${stats.size} bytes)`\n                );\n              }\n            }\n          } else if (agentAny.tracer && typeof agentAny.tracer.shutdown === 'function') {\n            // Fallback for SimpleTelemetry\n            await agentAny.tracer.shutdown();\n            log(`ðŸ“Š Trace saved to: ${agentAny._traceFilePath}`);\n          }\n        } catch (exportError) {\n          logger.warn(`âš ï¸  Warning: Failed to export trace for cloned session: ${exportError}`);\n        }\n      }\n\n      return { response, effectiveSchema };\n    } catch (error) {\n      logger.error(\n        `âŒ ProbeAgent session reuse failed: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n      throw new Error(\n        `ProbeAgent session reuse failed: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n    }\n  }\n\n  /**\n   * Call ProbeAgent SDK with built-in schema validation\n   */\n  private async callProbeAgent(\n    prompt: string,\n    schema?: string | Record<string, unknown>,\n    debugInfo?: AIDebugInfo,\n    _checkName?: string,\n    providedSessionId?: string\n  ): Promise<{ response: string; effectiveSchema?: string; sessionId: string }> {\n    // Derive a stable session ID for this call so the engine can reuse it later\n    const sessionId =\n      providedSessionId ||\n      (() => {\n        const timestamp = new Date().toISOString();\n        return `visor-${timestamp.replace(/[:.]/g, '-')}-${_checkName || 'unknown'}`;\n      })();\n\n    // Handle mock model/provider\n    if (this.config.model === 'mock' || this.config.provider === 'mock') {\n      const inJest = !!process.env.JEST_WORKER_ID;\n      log('ðŸŽ­ Using mock AI model/provider');\n      if (!inJest) {\n        // Fast path for CLI/integration: synthesize a mock response without invoking ProbeAgent\n        const response = await this.generateMockResponse(prompt, _checkName, schema);\n        return {\n          response,\n          effectiveSchema: typeof schema === 'object' ? 'custom' : schema,\n          sessionId,\n        };\n      }\n      // In unit tests, still invoke ProbeAgent so tests can assert on options (schema) passed in\n      // Fall through to normal flow below\n    }\n\n    // Create ProbeAgent instance with proper options\n\n    log('ðŸ¤– Creating ProbeAgent for AI review...');\n    log(`ðŸ†” Session ID: ${sessionId}`);\n    log(`ðŸ“ Prompt length: ${prompt.length} characters`);\n    log(`âš™ï¸ Model: ${this.config.model || 'default'}, Provider: ${this.config.provider || 'auto'}`);\n\n    // Store original env vars to restore later\n    const originalEnv: Record<string, string | undefined> = {\n      CLAUDE_CODE_API_KEY: process.env.CLAUDE_CODE_API_KEY,\n      GOOGLE_API_KEY: process.env.GOOGLE_API_KEY,\n      ANTHROPIC_API_KEY: process.env.ANTHROPIC_API_KEY,\n      OPENAI_API_KEY: process.env.OPENAI_API_KEY,\n    };\n\n    try {\n      // Set environment variables for ProbeAgent\n      // ProbeAgent SDK expects these to be in the environment\n      if (this.config.provider === 'claude-code' && this.config.apiKey) {\n        process.env.CLAUDE_CODE_API_KEY = this.config.apiKey;\n        // Also set ANTHROPIC_API_KEY as fallback since Claude Code uses Anthropic API\n        process.env.ANTHROPIC_API_KEY = this.config.apiKey;\n      } else if (this.config.provider === 'google' && this.config.apiKey) {\n        process.env.GOOGLE_API_KEY = this.config.apiKey;\n      } else if (this.config.provider === 'anthropic' && this.config.apiKey) {\n        process.env.ANTHROPIC_API_KEY = this.config.apiKey;\n      } else if (this.config.provider === 'openai' && this.config.apiKey) {\n        process.env.OPENAI_API_KEY = this.config.apiKey;\n      } else if (this.config.provider === 'bedrock') {\n        // For Bedrock, ProbeAgent will use AWS credentials from environment\n        // No need to set apiKey as it uses AWS SDK authentication\n        // ProbeAgent will check for AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, etc.\n      }\n      const explicitPromptType = (process.env.VISOR_PROMPT_TYPE || '').trim();\n\n      // Derive a default system prompt for non-code-review flows when none is configured.\n      // This keeps code-review schema using its specialized prompt template.\n      let systemPrompt = this.config.systemPrompt;\n      if (!systemPrompt && schema !== 'code-review') {\n        systemPrompt = 'You are general assistant, follow user instructions.';\n      }\n\n      const options: TracedProbeAgentOptions = {\n        sessionId: sessionId,\n        // Prefer config promptType, then env override, else fallback to code-review when schema is set\n        promptType:\n          this.config.promptType && this.config.promptType.trim()\n            ? (this.config.promptType.trim() as any)\n            : explicitPromptType\n              ? (explicitPromptType as any)\n              : schema === 'code-review'\n                ? ('code-review-template' as any)\n                : undefined,\n        allowEdit: false, // We don't want the agent to modify files\n        debug: this.config.debug || false,\n        // Use systemPrompt (native in rc168+) with fallback to customPrompt for backward compat\n        systemPrompt: systemPrompt || this.config.systemPrompt || this.config.customPrompt,\n      };\n      if (this.config.maxIterations !== undefined) {\n        options.maxIterations = this.config.maxIterations;\n      }\n\n      // Enable tracing in debug mode for better diagnostics\n      // This uses SimpleTelemetry for lightweight tracing\n      let traceFilePath = '';\n      let telemetryConfig: unknown = null;\n      let probeFileTracer: unknown = null;\n      if (this.config.debug) {\n        const tracerResult = await initializeTracer(sessionId, _checkName);\n        if (tracerResult) {\n          probeFileTracer = tracerResult.tracer;\n          telemetryConfig = tracerResult.telemetryConfig;\n          traceFilePath = tracerResult.filePath;\n        }\n      }\n      options.tracer = createProbeTracerAdapter(probeFileTracer);\n\n      // Wire MCP configuration when provided\n      if (this.config.mcpServers && Object.keys(this.config.mcpServers).length > 0) {\n        (options as any).enableMcp = true;\n        (options as any).mcpConfig = { mcpServers: this.config.mcpServers };\n      }\n\n      // Enable delegate tool if configured\n      if (this.config.enableDelegate !== undefined) {\n        (options as any).enableDelegate = this.config.enableDelegate;\n      }\n\n      // Enable task management if configured\n      if (this.config.enableTasks !== undefined) {\n        (options as any).enableTasks = this.config.enableTasks;\n      }\n\n      // Pass retry configuration to ProbeAgent\n      if (this.config.retry) {\n        (options as any).retry = this.config.retry;\n      }\n\n      // Pass fallback configuration to ProbeAgent\n      if (this.config.fallback) {\n        (options as any).fallback = this.config.fallback;\n      }\n\n      // Enable Edit and Create tools if configured\n      if (this.config.allowEdit !== undefined) {\n        (options as any).allowEdit = this.config.allowEdit;\n      }\n\n      // Pass tool filtering options to ProbeAgent (native in rc168+)\n      if (this.config.allowedTools !== undefined) {\n        options.allowedTools = this.config.allowedTools;\n        log(`ðŸ”§ Setting allowedTools: ${JSON.stringify(this.config.allowedTools)}`);\n      }\n      if (this.config.disableTools !== undefined) {\n        options.disableTools = this.config.disableTools;\n        log(`ðŸ”§ Setting disableTools: ${this.config.disableTools}`);\n      }\n\n      // Pass bash command execution configuration to ProbeAgent\n      // Pass enableBash and bashConfig separately (following allowEdit pattern)\n      // Note: Probe expects 'enableBash' property, not 'allowBash'\n      if (this.config.allowBash !== undefined) {\n        (options as any).enableBash = this.config.allowBash;\n      }\n      if (this.config.bashConfig !== undefined) {\n        (options as any).bashConfig = this.config.bashConfig;\n      }\n\n      // Pass completion prompt for post-completion validation/review\n      if (this.config.completionPrompt !== undefined) {\n        (options as any).completionPrompt = this.config.completionPrompt;\n      }\n\n      // Pass shared concurrency limiter for global AI call gating\n      if (this.config.concurrencyLimiter) {\n        (options as any).concurrencyLimiter = this.config.concurrencyLimiter;\n      }\n\n      // Propagate workspace / allowed folders to ProbeAgent so that tools\n      // operate inside the isolated workspace and project checkouts instead\n      // of the Visor repository root.\n      try {\n        const cfgAny: any = this.config as any;\n        const allowedFolders = cfgAny.allowedFolders as string[] | undefined;\n        const preferredPath =\n          cfgAny.workspacePath ||\n          (Array.isArray(allowedFolders) && allowedFolders.length > 0\n            ? allowedFolders[0]\n            : undefined) ||\n          cfgAny.path;\n        if (Array.isArray(allowedFolders) && allowedFolders.length > 0) {\n          (options as any).allowedFolders = allowedFolders;\n          if (!options.path && preferredPath) {\n            (options as any).path = preferredPath;\n          }\n          log(`ðŸ—‚ï¸ ProbeAgent workspace config:`);\n          log(`   path (cwd): ${(options as any).path}`);\n          log(`   allowedFolders[0]: ${allowedFolders[0]}`);\n        } else if (preferredPath) {\n          (options as any).path = preferredPath;\n          log(`ðŸ—‚ï¸ ProbeAgent path: ${preferredPath} (no allowedFolders)`);\n        }\n      } catch {\n        // Best-effort only; fall back to ProbeAgent defaults on error.\n      }\n\n      // Add provider-specific options if configured\n      if (this.config.provider) {\n        // Map claude-code to anthropic for ProbeAgent compatibility\n        // Map bedrock to anthropic temporarily until ProbeAgent adds bedrock type\n        const providerOverride: ProbeAgentOptions['provider'] | undefined =\n          this.config.provider === 'claude-code' || this.config.provider === 'bedrock'\n            ? 'anthropic'\n            : this.config.provider === 'anthropic' ||\n                this.config.provider === 'openai' ||\n                this.config.provider === 'google'\n              ? this.config.provider\n              : undefined;\n\n        if (providerOverride) {\n          options.provider = providerOverride;\n        }\n      }\n      if (this.config.model) {\n        options.model = this.config.model;\n      }\n\n      const agent = new ProbeAgent(options);\n\n      // Initialize agent to enable CLI fallback detection (claude-code/codex)\n      // This must be called before agent.answer() for auto-fallback to work.\n      // Newer ProbeAgent versions may not expose initialize(); guard to avoid crash.\n      if (typeof (agent as any).initialize === 'function') {\n        await (agent as any).initialize();\n      }\n\n      log('ðŸš€ Calling ProbeAgent...');\n      // Load and pass the actual schema content if provided (skip for plain schema)\n      let schemaString: string | undefined = undefined;\n      let effectiveSchema: string | undefined = typeof schema === 'object' ? 'custom' : schema;\n\n      if (schema && schema !== 'plain') {\n        try {\n          schemaString = await this.loadSchemaContent(schema);\n          log(`ðŸ“‹ Loaded schema content for: ${schema}`);\n          log(`ðŸ“„ Raw schema JSON:\\n${schemaString}`);\n        } catch (error) {\n          log(`âš ï¸ Failed to load schema ${schema}, proceeding without schema:`, error);\n          schemaString = undefined;\n          effectiveSchema = undefined; // Schema loading failed, treat as no schema\n          if (debugInfo && debugInfo.errors) {\n            debugInfo.errors.push(`Failed to load schema: ${error}`);\n          }\n        }\n      } else if (schema === 'plain') {\n        log(`ðŸ“‹ Using plain schema - no JSON validation will be applied`);\n      }\n\n      // ProbeAgent now handles schema formatting internally!\n      // Pass schema in options object with 'schema' property\n      const schemaOptions = schemaString ? { schema: schemaString } : undefined;\n\n      // Store the exact schema options being passed to ProbeAgent in debug info\n      if (debugInfo && schemaOptions) {\n        debugInfo.schema = JSON.stringify(schemaOptions, null, 2);\n      }\n\n      // Log the schema options being passed to ProbeAgent\n      if (schemaOptions) {\n        log(`ðŸŽ¯ Schema options passed to ProbeAgent.answer():`);\n        log(JSON.stringify(schemaOptions, null, 2));\n      }\n\n      // Log the equivalent CLI command for local reproduction\n      const provider = this.config.provider || 'auto';\n      const model = this.config.model || 'default';\n\n      // Save prompt to a temp file AND debug artifacts for easier reproduction (only if debug enabled)\n      if (process.env.VISOR_DEBUG_AI_SESSIONS === 'true') {\n        try {\n          const fs = require('fs');\n          const path = require('path');\n          const os = require('os');\n          const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n\n          // Prepare debug info with full details\n          const debugData = {\n            timestamp,\n            checkName: _checkName || 'unknown',\n            provider,\n            model,\n            schema: effectiveSchema,\n            schemaOptions: schemaOptions || 'none',\n            sessionInfo: {\n              isSessionReuse: false,\n              isNewSession: true,\n            },\n            promptLength: prompt.length,\n            prompt: prompt,\n          };\n\n          const debugJson = JSON.stringify(debugData, null, 2);\n\n          // Create human-readable version with clear separators\n          let readableVersion = `=============================================================\\n`;\n          readableVersion += `VISOR DEBUG REPORT - NEW SESSION\\n`;\n          readableVersion += `=============================================================\\n`;\n          readableVersion += `Timestamp: ${timestamp}\\n`;\n          readableVersion += `Check Name: ${_checkName || 'unknown'}\\n`;\n          readableVersion += `Provider: ${provider}\\n`;\n          readableVersion += `Model: ${model}\\n`;\n          readableVersion += `Schema: ${effectiveSchema}\\n`;\n          readableVersion += `Schema Options: ${schemaOptions ? 'provided' : 'none'}\\n`;\n          readableVersion += `Session Type: New Session (no history)\\n`;\n          readableVersion += `=============================================================\\n\\n`;\n\n          // Add schema details if provided\n          if (schemaOptions) {\n            readableVersion += `\\n${'='.repeat(60)}\\n`;\n            readableVersion += `SCHEMA CONFIGURATION\\n`;\n            readableVersion += `${'='.repeat(60)}\\n`;\n            readableVersion += JSON.stringify(schemaOptions, null, 2);\n            readableVersion += `\\n`;\n          }\n\n          // Add prompt\n          readableVersion += `\\n${'='.repeat(60)}\\n`;\n          readableVersion += `PROMPT\\n`;\n          readableVersion += `${'='.repeat(60)}\\n`;\n          readableVersion += `Length: ${prompt.length} characters\\n`;\n          readableVersion += `${'-'.repeat(60)}\\n`;\n          readableVersion += `${prompt}\\n`;\n          readableVersion += `\\n${'='.repeat(60)}\\n`;\n          readableVersion += `END OF DEBUG REPORT\\n`;\n          readableVersion += `${'='.repeat(60)}\\n`;\n\n          // Save to temp directory\n          const tempDir = os.tmpdir();\n          const promptFile = path.join(tempDir, `visor-prompt-${timestamp}.txt`);\n          fs.writeFileSync(promptFile, prompt, 'utf-8');\n          log(`\\nðŸ’¾ Prompt saved to: ${promptFile}`);\n\n          // Also save to debug-artifacts directory if available\n          const debugArtifactsDir =\n            process.env.VISOR_DEBUG_ARTIFACTS || path.join(process.cwd(), 'debug-artifacts');\n          try {\n            // do not enforce fs permissions here\n            const base = path.join(\n              debugArtifactsDir,\n              `prompt-${_checkName || 'unknown'}-${timestamp}`\n            );\n            fs.writeFileSync(base + '.json', debugJson, 'utf-8');\n            fs.writeFileSync(base + '.summary.txt', readableVersion, 'utf-8');\n            log(`\nðŸ’¾ Full debug info saved to directory: ${debugArtifactsDir}`);\n          } catch {\n            // Ignore if we can't write to debug-artifacts\n          }\n\n          log(`\\nðŸ“ To reproduce locally, run:`);\n\n          let cliCommand = `npx @probelabs/probe@latest agent`;\n          cliCommand += ` --provider ${provider}`;\n          if (model !== 'default') {\n            cliCommand += ` --model ${model}`;\n          }\n          if (schema) {\n            cliCommand += ` --schema output/${schema}/schema.json`;\n          }\n          cliCommand += ` \"${promptFile}\"`;\n\n          log(`\\n$ ${cliCommand}\\n`);\n        } catch (error) {\n          log(`âš ï¸ Could not save prompt file: ${error}`);\n        }\n      }\n\n      // Wrap the agent.answer() call in a span for hierarchical tracing\n      // This creates a parent span that will contain all ProbeAgent's child spans\n      let response: string;\n      const tracer = options.tracer as {\n        withSpan?: (\n          name: string,\n          fn: () => Promise<string>,\n          attrs?: Record<string, unknown>\n        ) => Promise<string>;\n      };\n      if (tracer && typeof tracer.withSpan === 'function') {\n        response = await tracer.withSpan(\n          'visor.ai_check',\n          async () => {\n            return await agent.answer(prompt, undefined, schemaOptions);\n          },\n          {\n            'check.name': _checkName || 'unknown',\n            'check.session_id': sessionId,\n            'prompt.length': prompt.length,\n            'schema.type': effectiveSchema || 'none',\n          }\n        );\n      } else {\n        response = schemaOptions\n          ? await agent.answer(prompt, undefined, schemaOptions)\n          : await agent.answer(prompt);\n      }\n\n      log('âœ… ProbeAgent completed successfully');\n      log(`ðŸ“¤ Response length: ${response.length} characters`);\n\n      // Save COMPLETE conversation history AFTER AI response (only if debug enabled)\n      if (process.env.VISOR_DEBUG_AI_SESSIONS === 'true') {\n        try {\n          const fs = require('fs');\n          const path = require('path');\n          const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n\n          // Extract FULL conversation history AFTER the AI call\n          const agentAny = agent as any;\n          let fullHistory: any[] = [];\n\n          // Try multiple properties to get complete history\n          if (agentAny.history) {\n            fullHistory = agentAny.history;\n          } else if (agentAny.messages) {\n            fullHistory = agentAny.messages;\n          } else if (agentAny._messages) {\n            fullHistory = agentAny._messages;\n          }\n\n          const debugArtifactsDir =\n            process.env.VISOR_DEBUG_ARTIFACTS || path.join(process.cwd(), 'debug-artifacts');\n          // do not enforce fs permissions here\n\n          // Save complete session history (all messages sent and received)\n          const sessionBase = path.join(\n            debugArtifactsDir,\n            `session-${_checkName || 'unknown'}-${timestamp}`\n          );\n          const sessionData = {\n            timestamp,\n            checkName: _checkName || 'unknown',\n            provider: this.config.provider || 'auto',\n            model: this.config.model || 'default',\n            schema: effectiveSchema,\n            totalMessages: fullHistory.length,\n          };\n          fs.writeFileSync(sessionBase + '.json', JSON.stringify(sessionData, null, 2), 'utf-8');\n\n          // Redacted textual summary\n          let readable = `=============================================================\n`;\n          readable += `COMPLETE AI SESSION HISTORY (AFTER RESPONSE)\n`;\n          readable += `=============================================================\n`;\n          readable += `Timestamp: ${timestamp}\n`;\n          readable += `Check: ${_checkName || 'unknown'}\n`;\n          readable += `Total Messages: ${fullHistory.length}\n`;\n          readable += `=============================================================\n\n`;\n          fullHistory.forEach((msg: any, idx: number) => {\n            const role = msg.role || 'unknown';\n            const content =\n              typeof msg.content === 'string' ? msg.content : JSON.stringify(msg.content, null, 2);\n            readable += `\n${'='.repeat(60)}\nMESSAGE ${idx + 1}/${fullHistory.length}\nRole: ${role}\n${'='.repeat(60)}\n`;\n            readable += content + '\\n';\n          });\n          fs.writeFileSync(sessionBase + '.summary.txt', readable, 'utf-8');\n\n          log(`ðŸ’¾ Complete session history saved:`);\n          // (paths omitted)\n          log(`   - Contains ALL ${fullHistory.length} messages (prompts + responses)`);\n        } catch (error) {\n          log(`âš ï¸ Could not save complete session history: ${error}`);\n        }\n      }\n\n      // Save response if debug is enabled\n      if (process.env.VISOR_DEBUG_AI_SESSIONS === 'true') {\n        try {\n          const fs = require('fs');\n          const path = require('path');\n          const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n\n          const debugArtifactsDir =\n            process.env.VISOR_DEBUG_ARTIFACTS || path.join(process.cwd(), 'debug-artifacts');\n\n          // Create a response file\n          const responseFile = path.join(\n            debugArtifactsDir,\n            `response-${_checkName || 'unknown'}-${timestamp}.txt`\n          );\n\n          let responseContent = `=============================================================\\n`;\n          responseContent += `VISOR AI RESPONSE - NEW SESSION\\n`;\n          responseContent += `=============================================================\\n`;\n          responseContent += `Timestamp: ${timestamp}\\n`;\n          responseContent += `Check Name: ${_checkName || 'unknown'}\\n`;\n          responseContent += `Response Length: ${response.length} characters\\n`;\n          responseContent += `=============================================================\\n\\n`;\n          responseContent += `${'='.repeat(60)}\\n`;\n          responseContent += `AI RESPONSE\\n`;\n          responseContent += `${'='.repeat(60)}\\n`;\n          responseContent += response;\n          responseContent += `\\n${'='.repeat(60)}\\n`;\n          responseContent += `END OF RESPONSE\\n`;\n          responseContent += `${'='.repeat(60)}\\n`;\n\n          fs.writeFileSync(responseFile, responseContent, 'utf-8');\n          log(`ðŸ’¾ Response saved to: ${responseFile}`);\n        } catch (error) {\n          log(`âš ï¸ Could not save response file: ${error}`);\n        }\n      }\n\n      // Finalize and save trace if enabled\n      // Properly flush and shutdown telemetry to ensure all spans are exported\n      if (traceFilePath && telemetryConfig) {\n        try {\n          // Cast telemetryConfig to have optional methods\n          const telemetry = telemetryConfig as {\n            flush?: () => Promise<void>;\n            shutdown?: () => Promise<void>;\n          };\n          const tracerWithMethods = tracer as {\n            flush?: () => Promise<void>;\n            shutdown?: () => Promise<void>;\n          };\n\n          // First flush the tracer to export pending spans\n          if (tracerWithMethods && typeof tracerWithMethods.flush === 'function') {\n            await tracerWithMethods.flush();\n            log(`ðŸ”„ Flushed tracer spans`);\n          }\n\n          // Then shutdown the telemetry config to finalize all exporters\n          if (telemetry && typeof telemetry.shutdown === 'function') {\n            await telemetry.shutdown();\n            log(`ðŸ“Š OpenTelemetry trace saved to: ${traceFilePath}`);\n\n            // In GitHub Actions, also log file size for verification\n            if (process.env.GITHUB_ACTIONS) {\n              const fs = require('fs');\n              if (fs.existsSync(traceFilePath)) {\n                const stats = fs.statSync(traceFilePath);\n                console.log(\n                  `::notice title=AI Trace Saved::OpenTelemetry trace file size: ${stats.size} bytes`\n                );\n              }\n            }\n          } else if (tracerWithMethods && typeof tracerWithMethods.shutdown === 'function') {\n            // Fallback for SimpleTelemetry\n            await tracerWithMethods.shutdown();\n            log(`ðŸ“Š Trace saved to: ${traceFilePath}`);\n          }\n        } catch (exportError) {\n          logger.warn(`âš ï¸  Warning: Failed to export trace: ${exportError}`);\n        }\n      }\n\n      // Register the session for potential reuse by dependent checks\n      if (_checkName) {\n        // ProbeAgent.clone() will handle history filtering when this session is cloned\n        this.registerSession(sessionId, agent);\n        log(`ðŸ”§ Debug: Registered AI session for potential reuse: ${sessionId}`);\n      }\n\n      return { response, effectiveSchema, sessionId };\n    } catch (error) {\n      console.error('âŒ ProbeAgent failed:', error);\n      throw new Error(\n        `ProbeAgent execution failed: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n    } finally {\n      // Restore original environment variables\n      Object.keys(originalEnv).forEach(key => {\n        if (originalEnv[key] === undefined) {\n          delete process.env[key];\n        } else {\n          process.env[key] = originalEnv[key];\n        }\n      });\n    }\n  }\n\n  /**\n   * Load schema content from schema files or inline definitions\n   */\n  private async loadSchemaContent(schema: string | Record<string, unknown>): Promise<string> {\n    const fs = require('fs').promises;\n    const path = require('path');\n\n    // Check if schema is already an object (inline definition from YAML)\n    if (typeof schema === 'object' && schema !== null) {\n      // It's already a schema object, convert to JSON string\n      log('ðŸ“‹ Using inline schema object from configuration');\n      return JSON.stringify(schema);\n    }\n\n    // Check if schema string is already a JSON schema (inline JSON string)\n    // This happens when a schema is passed directly as JSON instead of a reference\n    try {\n      const parsed = JSON.parse(schema);\n      if (typeof parsed === 'object' && parsed !== null) {\n        // It's already a valid JSON schema, return it as-is\n        log('ðŸ“‹ Using inline schema JSON string');\n        return schema;\n      }\n    } catch {\n      // Not JSON, treat as schema name reference or file path\n    }\n\n    // Check if it's a file path (starts with ./ or contains .json but not absolute paths)\n    if ((schema.startsWith('./') || schema.includes('.json')) && !path.isAbsolute(schema)) {\n      // It's a relative file path to a custom schema\n      // Validate the path to prevent traversal attacks\n      if (schema.includes('..') || schema.includes('\\x00')) {\n        throw new Error('Invalid schema path: path traversal not allowed');\n      }\n\n      try {\n        const schemaPath = path.resolve(process.cwd(), schema);\n        log(`ðŸ“‹ Loading custom schema from file: ${schemaPath}`);\n        const schemaContent = await fs.readFile(schemaPath, 'utf-8');\n        return schemaContent.trim();\n      } catch (error) {\n        throw new Error(\n          `Failed to load custom schema from ${schema}: ${error instanceof Error ? error.message : 'Unknown error'}`\n        );\n      }\n    }\n\n    // Otherwise, treat as a built-in schema name\n    // Sanitize schema name to prevent path traversal attacks\n    const sanitizedSchemaName = schema.replace(/[^a-zA-Z0-9-]/g, '');\n    if (!sanitizedSchemaName || sanitizedSchemaName !== schema) {\n      throw new Error('Invalid schema name');\n    }\n\n    // Built-in schemas are bundled under dist/output when running as a GitHub Action.\n    // In local dev (ts-node/jest), schemas may live under project/output.\n    // Try dist-relative first, then fall back to CWD.\n    const candidatePaths = [\n      // GitHub Action bundle location\n      path.join(__dirname, 'output', sanitizedSchemaName, 'schema.json'),\n      // Historical fallback when src/output was inadvertently bundled as output1/\n      path.join(__dirname, 'output1', sanitizedSchemaName, 'schema.json'),\n      // Local dev (repo root)\n      path.join(process.cwd(), 'output', sanitizedSchemaName, 'schema.json'),\n    ];\n\n    for (const schemaPath of candidatePaths) {\n      try {\n        const schemaContent = await fs.readFile(schemaPath, 'utf-8');\n        return schemaContent.trim();\n      } catch {\n        // try next\n      }\n    }\n\n    // If neither path works, surface a helpful error\n    const distPath = path.join(__dirname, 'output', sanitizedSchemaName, 'schema.json');\n    const distAltPath = path.join(__dirname, 'output1', sanitizedSchemaName, 'schema.json');\n    const cwdPath = path.join(process.cwd(), 'output', sanitizedSchemaName, 'schema.json');\n    throw new Error(\n      `Failed to load schema '${sanitizedSchemaName}'. Tried: ${distPath}, ${distAltPath}, and ${cwdPath}. ` +\n        `Ensure build copies 'output/' into dist (build:cli), or provide a custom schema file/path.`\n    );\n  }\n\n  /**\n   * Parse AI response JSON\n   */\n  private parseAIResponse(\n    response: string,\n    debugInfo?: AIDebugInfo,\n    _schema?: string\n  ): ReviewSummary & { output?: unknown } {\n    log('ðŸ” Parsing AI response...');\n    log(`ðŸ“Š Raw response length: ${response.length} characters`);\n\n    // Log first and last 200 chars for debugging\n    if (response.length > 400) {\n      log('ðŸ“‹ Response preview (first 200 chars):', response.substring(0, 200));\n      log('ðŸ“‹ Response preview (last 200 chars):', response.substring(response.length - 200));\n    } else {\n      log('ðŸ“‹ Full response preview:', response);\n    }\n\n    // Note: Removed overly aggressive Liquid template check that was causing false positives\n    // JSON parsing below will catch actual malformed responses\n\n    try {\n      // Handle different schema types differently\n      let reviewData: AIResponseFormat;\n\n      // Handle plain schema or no schema - no JSON parsing, treat as assistant-style text output\n      if (_schema === 'plain' || !_schema) {\n        log(\n          `ðŸ“‹ ${_schema === 'plain' ? 'Plain' : 'No'} schema detected - treating raw response as text output`\n        );\n\n        // For plain schema / no schema, return the raw response as a text-like output\n        // instead of a synthetic AI_RESPONSE issue. This is more natural for chat-style\n        // integrations (Slack, GitHub comments, CLI assistant mode).\n        const trimmed = typeof response === 'string' ? response.trim() : '';\n        const out: any = trimmed ? { text: trimmed } : {};\n\n        return {\n          issues: [],\n          // Expose assistant-style content via output.text so downstream formatters\n          // (Slack frontend, CLI \"Assistant Response\" section, templates) can render it.\n          output: out,\n          debug: debugInfo,\n        };\n      }\n\n      {\n        // For other schemas (code-review, etc.), extract and parse JSON with boundary detection\n        log('ðŸ” Extracting JSON from AI response...');\n\n        // Sanitize response: strip BOM, zero-width chars, and other invisible characters\n        // that can cause JSON parsing to fail even when the text looks valid\n        const sanitizedResponse = response\n          .replace(/^\\uFEFF/, '') // BOM\n          .replace(/[\\u200B-\\u200D\\uFEFF\\u00A0]/g, '') // Zero-width chars, NBSP\n          .replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F]/g, '') // Control chars (except \\t \\n \\r)\n          .trim();\n\n        // Try direct JSON parsing - no bracket-matching extraction\n        // JSON validation is offloaded to Probe agent when schema is provided\n        try {\n          reviewData = JSON.parse(sanitizedResponse);\n          log('âœ… Successfully parsed direct JSON response');\n          if (debugInfo) debugInfo.jsonParseSuccess = true;\n        } catch (parseErr) {\n          const errMsg = parseErr instanceof Error ? parseErr.message : String(parseErr);\n          log(`ðŸ” Direct JSON parsing failed: ${errMsg}`);\n\n          // If the response indicates refusal, return it as plain text output\n          if (\n            response.toLowerCase().includes('i cannot') ||\n            response.toLowerCase().includes('unable to')\n          ) {\n            console.error('ðŸš« AI refused to analyze - returning refusal as output');\n            const trimmed = response.trim();\n            return {\n              issues: [],\n              output: trimmed ? { text: trimmed } : {},\n              debug: debugInfo,\n            };\n          }\n\n          // Not valid JSON - treat entire response as text output\n          // This allows Probe (or other AI providers) to handle JSON validation\n          // and avoids false positives from bracket-matching (e.g., mermaid diagrams)\n          log('ðŸ”§ Treating response as plain text (no JSON extraction)');\n          const trimmed = response.trim();\n          return {\n            issues: [],\n            output: { text: trimmed },\n            debug: debugInfo,\n          };\n        }\n      }\n\n      // Decide how to interpret the parsed JSON based on the effective schema and the shape of data\n      // Built-ins:\n      //  - 'code-review' â†’ expects { issues: [...] }\n      //  - 'overview' / assistants â†’ expects { text: string, ... }\n      //  - 'plain' â†’ handled earlier\n      //  - custom (object/file path) â†’ free-form object, ensure output.text fallback\n      const looksLikeTextOutput =\n        reviewData &&\n        typeof reviewData === 'object' &&\n        typeof (reviewData as any).text === 'string' &&\n        String((reviewData as any).text).trim().length > 0;\n\n      // Treat as custom/text-style when:\n      //  - explicit custom schema\n      //  - schema is any non code-review built-in like 'overview', 'issue-assistant', 'comment-assistant'\n      //  - or schema is unknown/undefined but the payload clearly contains a text field\n      const isCustomSchema =\n        _schema === 'custom' ||\n        (_schema && (_schema.startsWith('./') || _schema.endsWith('.json'))) ||\n        (_schema && _schema !== 'code-review' && !_schema.includes('output/')) ||\n        (!_schema && looksLikeTextOutput);\n\n      const _debugSchemaLogging =\n        this.config.debug === true || process.env.VISOR_DEBUG_AI_SESSIONS === 'true';\n      if (_debugSchemaLogging) {\n        const details = {\n          schema: _schema,\n          isCustomSchema,\n          isCustomLiteral: _schema === 'custom',\n          startsWithDotSlash: typeof _schema === 'string' ? _schema.startsWith('./') : false,\n          endsWithJson: typeof _schema === 'string' ? _schema.endsWith('.json') : false,\n          notCodeReview: _schema !== 'code-review',\n          noOutputPrefix: typeof _schema === 'string' ? !_schema.includes('output/') : false,\n        };\n        try {\n          log(`ðŸ” Schema detection: ${JSON.stringify(details)}`);\n        } catch {\n          // Fallback if JSON.stringify throws on unexpected values\n          log(\n            `ðŸ” Schema detection: _schema=\"${String(_schema)}\", isCustomSchema=${isCustomSchema}`\n          );\n        }\n      }\n\n      if (isCustomSchema) {\n        // For custom schemas, preserve ALL fields from the parsed JSON and make sure\n        // we always have something renderable in templates (e.g., output.text).\n        log('ðŸ“‹ Custom schema detected - preserving all fields from parsed JSON');\n        log(`ðŸ“Š Schema: ${_schema}`);\n        try {\n          log(`ðŸ“Š Custom schema keys: ${Object.keys(reviewData).join(', ')}`);\n        } catch {}\n\n        // Ensure \"output\" is an object and has a sensible text fallback for templates\n        const out: Record<string, unknown> =\n          reviewData && typeof reviewData === 'object' ? (reviewData as any) : ({} as any);\n\n        const hasText =\n          typeof (out as any).text === 'string' && String((out as any).text).trim().length > 0;\n        if (!hasText) {\n          // Build a fallback string from the raw response or issue messages if available\n          let fallbackText = '';\n          try {\n            if (\n              Array.isArray((reviewData as any)?.issues) &&\n              (reviewData as any).issues.length > 0\n            ) {\n              // Join issue messages into a readable block\n              fallbackText = (reviewData as any).issues\n                .map((i: any) => (i && (i.message || i.text || i.response)) as string)\n                .filter((s: any) => typeof s === 'string' && s.trim().length > 0)\n                .join('\\n');\n            }\n          } catch {}\n          if (!fallbackText && typeof response === 'string' && response.trim()) {\n            // Use raw provider response (trim and bound length for safety)\n            fallbackText = response.trim().slice(0, 60000);\n          }\n          if (fallbackText) {\n            (out as any).text = fallbackText;\n          }\n        }\n\n        const result: ReviewSummary & { output?: unknown } = {\n          // Keep issues empty for custom-schema rendering; consumers read from output.*\n          issues: [],\n          output: out,\n        };\n\n        log(\n          'âœ… Successfully created ReviewSummary with custom schema output (with fallback text when needed)'\n        );\n        return result;\n      }\n\n      // Standard code-review schema processing (only when schema is explicitly code-review\n      // or when the payload clearly has an issues array)\n      log('ðŸ” Validating parsed review data...');\n      log(`ðŸ“Š Overall score: ${0}`);\n      log(`ðŸ“‹ Total issues: ${reviewData.issues?.length || 0}`);\n      log(\n        `ðŸš¨ Critical issues: ${reviewData.issues?.filter((i: { severity?: string }) => i.severity === 'critical').length || 0}`\n      );\n      log(`ðŸ’¬ Comments count: ${Array.isArray(reviewData.issues) ? reviewData.issues.length : 0}`);\n\n      // Process issues from the simplified format; if we don't have issues and the\n      // data looks like a text-style output, route through the custom path above.\n      const processedIssues = Array.isArray((reviewData as any).issues)\n        ? (reviewData as any).issues.map((issue: any, index: number) => {\n            log(`ðŸ” Processing issue ${index + 1}:`, issue);\n            return {\n              file: issue.file || 'unknown',\n              line: issue.line || 1,\n              endLine: issue.endLine,\n              ruleId: issue.ruleId || `${issue.category || 'general'}/unknown`,\n              message: issue.message || '',\n              severity: issue.severity,\n              category: issue.category,\n              suggestion: issue.suggestion,\n              replacement: issue.replacement,\n            } as ReviewIssue;\n          })\n        : [];\n\n      // Validate and convert to ReviewSummary format\n      const result: ReviewSummary = {\n        issues: processedIssues,\n      };\n\n      // Log issue counts\n      const criticalCount = (result.issues || []).filter(i => i.severity === 'critical').length;\n      if (criticalCount > 0) {\n        log(`ðŸš¨ Found ${criticalCount} critical severity issue(s)`);\n      }\n      log(`ðŸ“ˆ Total issues: ${(result.issues || []).length}`);\n\n      log('âœ… Successfully created ReviewSummary');\n      return result;\n    } catch (error) {\n      const detailed = this.config.debug === true || process.env.VISOR_DEBUG_AI_SESSIONS === 'true';\n      const message = error instanceof Error ? error.message : String(error);\n\n      if (detailed) {\n        logger.debug(`âŒ Failed to parse AI response: ${message}`);\n        logger.debug('ðŸ“„ FULL RAW RESPONSE:');\n        logger.debug('='.repeat(80));\n        logger.debug(response);\n        logger.debug('='.repeat(80));\n        logger.debug(`ðŸ“ Response length: ${response.length} characters`);\n\n        if (error instanceof SyntaxError) {\n          logger.debug('ðŸ” JSON parsing error - the response may not be valid JSON');\n          logger.debug(`ðŸ” Error details: ${error.message}`);\n\n          const errorMatch = error.message.match(/position (\\d+)/);\n          if (errorMatch) {\n            const position = parseInt(errorMatch[1]);\n            logger.debug(`ðŸ” Error at position ${position}:`);\n            const start = Math.max(0, position - 50);\n            const end = Math.min(response.length, position + 50);\n            logger.debug(`ðŸ” Context: \"${response.substring(start, end)}\"`);\n            logger.debug(`ðŸ” Response beginning: \"${response.substring(0, 100)}\"`);\n          }\n\n          if (response.includes('I cannot')) {\n            logger.debug('ðŸ” Response appears to be a refusal/explanation rather than JSON');\n          }\n          if (response.includes('```')) {\n            logger.debug('ðŸ” Response appears to contain markdown code blocks');\n          }\n          if (response.startsWith('<')) {\n            logger.debug('ðŸ” Response appears to start with XML/HTML');\n          }\n        }\n      } else {\n        logger.error(`âŒ Failed to parse AI response: ${message}`);\n      }\n\n      throw new Error(\n        `Invalid AI response format: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n    }\n  }\n\n  /**\n   * Generate mock response for testing\n   */\n  private async generateMockResponse(\n    _prompt: string,\n    _checkName?: string,\n    _schema?: string | Record<string, unknown>\n  ): Promise<string> {\n    // Simulate some processing time\n    await new Promise(resolve => setTimeout(resolve, 500));\n\n    // Schema-accurate mocks for default flows\n    const name = (_checkName || '').toLowerCase();\n    if (name.includes('extract-facts')) {\n      const arr = Array.from({ length: 6 }, (_, i) => ({\n        id: `fact-${i + 1}`,\n        category: 'Feature',\n        claim: `claim-${i + 1}`,\n        verifiable: true,\n        refs: [{ path: 'src/check-execution-engine.ts', lines: '6400-6460' }],\n      }));\n      return JSON.stringify(arr);\n    }\n    if (name.includes('validate-fact')) {\n      const idMatch = _prompt.match(/Fact ID:\\s*([\\w\\-]+)/i);\n      const claimMatch = _prompt.match(/\\*\\*Claim:\\*\\*\\s*(.+)/i);\n      const attemptMatch = _prompt.match(/Attempt:\\s*(\\d+)/i);\n      const factId = idMatch ? idMatch[1] : 'fact-1';\n      const claim = claimMatch ? claimMatch[1].trim() : 'unknown-claim';\n      const n = Number(factId.split('-')[1] || '0');\n      const attempt = attemptMatch ? Number(attemptMatch[1]) : 0;\n      const isValid = attempt >= 1 ? true : !(n >= 1 && n <= 3);\n      return JSON.stringify({\n        fact_id: factId,\n        claim,\n        is_valid: isValid,\n        confidence: 'high',\n        evidence: isValid ? 'verified' : 'not found',\n        correction: isValid ? null : `correct ${claim}`,\n      });\n    }\n    if (name.includes('issue-assistant') || name.includes('comment-assistant')) {\n      const text = '### Assistant Reply';\n      const intent = name.includes('issue') ? 'issue_triage' : 'comment_reply';\n      return JSON.stringify({ text, intent });\n    }\n    // Fallback\n    const mockResponse = { content: JSON.stringify({ issues: [], summary: { totalIssues: 0 } }) };\n    return JSON.stringify(mockResponse);\n  }\n\n  /**\n   * Get the API key source for debugging (without revealing the key)\n   */\n  private getApiKeySource(): string {\n    if (process.env.CLAUDE_CODE_API_KEY && this.config.provider === 'claude-code') {\n      return 'CLAUDE_CODE_API_KEY';\n    }\n    if (process.env.GOOGLE_API_KEY && this.config.provider === 'google') {\n      return 'GOOGLE_API_KEY';\n    }\n    if (process.env.ANTHROPIC_API_KEY && this.config.provider === 'anthropic') {\n      return 'ANTHROPIC_API_KEY';\n    }\n    if (process.env.OPENAI_API_KEY && this.config.provider === 'openai') {\n      return 'OPENAI_API_KEY';\n    }\n    if (this.config.provider === 'bedrock') {\n      if (process.env.AWS_BEDROCK_API_KEY) {\n        return 'AWS_BEDROCK_API_KEY';\n      }\n      if (process.env.AWS_ACCESS_KEY_ID && process.env.AWS_SECRET_ACCESS_KEY) {\n        return 'AWS_ACCESS_KEY_ID/AWS_SECRET_ACCESS_KEY';\n      }\n    }\n    return 'unknown';\n  }\n}\n","/**\n * Environment variable resolution utilities\n * Supports GitHub Actions-like syntax for referencing environment variables\n */\n\nimport { EnvConfig } from '../types/config';\n\n/**\n * Resolves environment variables in configuration values\n * Supports the following syntaxes:\n * - ${{ env.VARIABLE_NAME }} (GitHub Actions style)\n * - ${VARIABLE_NAME} (shell style)\n * - $VARIABLE_NAME (simple shell style)\n * - Direct environment variable names\n */\nexport class EnvironmentResolver {\n  /**\n   * Resolves a single configuration value that may contain environment variable references\n   */\n  static resolveValue(value: string | number | boolean): string | number | boolean {\n    if (typeof value !== 'string') {\n      return value;\n    }\n\n    // GitHub Actions style: ${{ env.VARIABLE_NAME }}\n    let resolved = value.replace(/\\$\\{\\{\\s*env\\.([A-Z_][A-Z0-9_]*)\\s*\\}\\}/g, (match, envVar) => {\n      return process.env[envVar] || match;\n    });\n\n    // Shell style: ${VARIABLE_NAME}\n    resolved = resolved.replace(/\\$\\{([A-Z_][A-Z0-9_]*)\\}/g, (match, envVar) => {\n      return process.env[envVar] || match;\n    });\n\n    // Simple shell style: $VARIABLE_NAME\n    resolved = resolved.replace(/\\$([A-Z_][A-Z0-9_]*)/g, (match, envVar) => {\n      return process.env[envVar] || match;\n    });\n\n    return resolved;\n  }\n\n  /**\n   * Resolves all environment variables in an EnvConfig object\n   */\n  static resolveEnvConfig(envConfig: EnvConfig): EnvConfig {\n    const resolved: EnvConfig = {};\n\n    for (const [key, value] of Object.entries(envConfig)) {\n      resolved[key] = this.resolveValue(value);\n    }\n\n    return resolved;\n  }\n\n  /**\n   * Applies environment configuration to the process environment\n   * This allows checks to access their specific environment variables\n   */\n  static applyEnvConfig(envConfig: EnvConfig): void {\n    const resolved = this.resolveEnvConfig(envConfig);\n\n    for (const [key, value] of Object.entries(resolved)) {\n      if (value !== undefined) {\n        process.env[key] = String(value);\n      }\n    }\n  }\n\n  /**\n   * Creates a temporary environment for a specific check execution\n   * Returns a cleanup function to restore the original environment\n   */\n  static withTemporaryEnv<T>(envConfig: EnvConfig, callback: () => T | Promise<T>): T | Promise<T> {\n    const resolved = this.resolveEnvConfig(envConfig);\n    const originalValues: Record<string, string | undefined> = {};\n\n    // Store original values and apply new ones\n    for (const [key, value] of Object.entries(resolved)) {\n      originalValues[key] = process.env[key];\n      if (value !== undefined) {\n        process.env[key] = String(value);\n      }\n    }\n\n    try {\n      const result = callback();\n\n      // If callback returns a promise, handle cleanup after it resolves\n      if (result instanceof Promise) {\n        return result.finally(() => {\n          // Restore original values\n          for (const [key, originalValue] of Object.entries(originalValues)) {\n            if (originalValue === undefined) {\n              delete process.env[key];\n            } else {\n              process.env[key] = originalValue;\n            }\n          }\n        });\n      }\n\n      // Restore original values immediately for sync callbacks\n      for (const [key, originalValue] of Object.entries(originalValues)) {\n        if (originalValue === undefined) {\n          delete process.env[key];\n        } else {\n          process.env[key] = originalValue;\n        }\n      }\n\n      return result;\n    } catch (error) {\n      // Restore original values on error\n      for (const [key, originalValue] of Object.entries(originalValues)) {\n        if (originalValue === undefined) {\n          delete process.env[key];\n        } else {\n          process.env[key] = originalValue;\n        }\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * Validates that all required environment variables are available\n   */\n  static validateRequiredEnvVars(envConfig: EnvConfig, requiredVars: string[]): string[] {\n    const resolved = this.resolveEnvConfig(envConfig);\n    const missing: string[] = [];\n\n    for (const varName of requiredVars) {\n      const value = resolved[varName] || process.env[varName];\n      if (!value) {\n        missing.push(varName);\n      }\n    }\n\n    return missing;\n  }\n\n  /**\n   * Resolves environment variables in HTTP headers\n   * Each header value is processed through resolveValue to replace env var references\n   */\n  static resolveHeaders(headers: Record<string, string>): Record<string, string> {\n    const resolved: Record<string, string> = {};\n    for (const [key, value] of Object.entries(headers)) {\n      resolved[key] = String(this.resolveValue(value));\n    }\n    return resolved;\n  }\n\n  /**\n   * Sanitizes headers for logging/telemetry by redacting sensitive values\n   * Headers like Authorization, API keys, and cookies are replaced with [REDACTED]\n   */\n  static sanitizeHeaders(headers: Record<string, string>): Record<string, string> {\n    const sensitiveHeaders = ['authorization', 'x-api-key', 'cookie', 'set-cookie'];\n    const sanitized: Record<string, string> = {};\n\n    for (const [key, value] of Object.entries(headers)) {\n      if (sensitiveHeaders.includes(key.toLowerCase())) {\n        sanitized[key] = '[REDACTED]';\n      } else {\n        sanitized[key] = value;\n      }\n    }\n\n    return sanitized;\n  }\n}\n","import * as fs from 'fs';\nimport * as path from 'path';\nimport { ReviewIssue } from './reviewer';\n\n/**\n * Filter for suppressing Visor issues based on special comments in code\n */\nexport class IssueFilter {\n  private fileCache: Map<string, string[]> = new Map();\n  private suppressionEnabled: boolean;\n\n  constructor(suppressionEnabled: boolean = true) {\n    this.suppressionEnabled = suppressionEnabled;\n  }\n\n  /**\n   * Filter out issues that have suppression comments\n   * @param issues Array of issues to filter\n   * @param workingDir Working directory for resolving file paths\n   * @returns Filtered array of issues with suppressed ones removed\n   */\n  public filterIssues(issues: ReviewIssue[], workingDir: string = process.cwd()): ReviewIssue[] {\n    if (!this.suppressionEnabled || !issues || issues.length === 0) {\n      return issues;\n    }\n\n    const filteredIssues: ReviewIssue[] = [];\n    const suppressedCount: { [file: string]: number } = {};\n\n    for (const issue of issues) {\n      if (this.shouldSuppressIssue(issue, workingDir)) {\n        // Track suppressed issues for logging\n        suppressedCount[issue.file] = (suppressedCount[issue.file] || 0) + 1;\n      } else {\n        filteredIssues.push(issue);\n      }\n    }\n\n    // Log suppression summary if any issues were suppressed\n    const totalSuppressed = Object.values(suppressedCount).reduce((sum, count) => sum + count, 0);\n    if (totalSuppressed > 0) {\n      console.log(`ðŸ”‡ Suppressed ${totalSuppressed} issue(s) via visor-disable comments:`);\n      for (const [file, count] of Object.entries(suppressedCount)) {\n        console.log(`   - ${file}: ${count} issue(s)`);\n      }\n    }\n\n    return filteredIssues;\n  }\n\n  /**\n   * Check if an issue should be suppressed based on comments in the file\n   */\n  private shouldSuppressIssue(issue: ReviewIssue, workingDir: string): boolean {\n    // Skip system-level issues or issues without file/line info\n    if (!issue.file || issue.file === 'system' || issue.file === 'webhook' || issue.line === 0) {\n      return false;\n    }\n\n    const lines = this.getFileLines(issue.file, workingDir);\n    if (!lines || lines.length === 0) {\n      return false;\n    }\n\n    // Check for file-level suppression (visor-disable-file in first 5 lines)\n    const firstFiveLines = lines.slice(0, 5).join('\\n').toLowerCase();\n    if (firstFiveLines.includes('visor-disable-file')) {\n      return true;\n    }\n\n    // Check for line-level suppression (visor-disable within Â±2 lines)\n    const lineIndex = issue.line - 1; // Convert to 0-based index\n    const startLine = Math.max(0, lineIndex - 2);\n    const endLine = Math.min(lines.length - 1, lineIndex + 2);\n\n    for (let i = startLine; i <= endLine; i++) {\n      if (lines[i].toLowerCase().includes('visor-disable')) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Get file lines from cache or read from disk\n   */\n  private getFileLines(filePath: string, workingDir: string): string[] | null {\n    // Check cache first\n    if (this.fileCache.has(filePath)) {\n      return this.fileCache.get(filePath)!;\n    }\n\n    try {\n      // Resolve the file path\n      const resolvedPath = path.isAbsolute(filePath) ? filePath : path.join(workingDir, filePath);\n\n      if (!fs.existsSync(resolvedPath)) {\n        // Try without working directory if the file doesn't exist\n        if (fs.existsSync(filePath)) {\n          const content = fs.readFileSync(filePath, 'utf8');\n          const lines = content.split('\\n');\n          this.fileCache.set(filePath, lines);\n          return lines;\n        }\n        return null;\n      }\n\n      const content = fs.readFileSync(resolvedPath, 'utf8');\n      const lines = content.split('\\n');\n      this.fileCache.set(filePath, lines);\n      return lines;\n    } catch {\n      // Silently skip files that can't be read\n      return null;\n    }\n  }\n\n  /**\n   * Clear the file cache (useful for testing or long-running processes)\n   */\n  public clearCache(): void {\n    this.fileCache.clear();\n  }\n}\n","/**\n * Enhanced state capture for OTEL spans to enable interactive debugging.\n *\n * This module provides utilities to capture complete execution state in span\n * attributes, enabling time-travel debugging and full state inspection.\n */\n\nimport { Span } from './lazy-otel';\n\nconst MAX_ATTRIBUTE_LENGTH = 10000; // Truncate large values\nconst MAX_ARRAY_ITEMS = 100; // Limit array size in attributes\n\n// Patterns that indicate sensitive environment variables (case-insensitive)\nconst SENSITIVE_ENV_PATTERNS = [\n  /api[_-]?key/i,\n  /secret/i,\n  /token/i,\n  /password/i,\n  /auth/i,\n  /credential/i,\n  /private[_-]?key/i,\n  /^sk-/i, // OpenAI-style keys\n  /^AIza/i, // Google API keys\n];\n\n/**\n * Check if an environment variable name is sensitive\n */\nfunction isSensitiveEnvVar(name: string): boolean {\n  return SENSITIVE_ENV_PATTERNS.some(pattern => pattern.test(name));\n}\n\n/**\n * Sanitize context for telemetry by redacting sensitive environment variables.\n * Returns a new object with env values redacted (keys preserved).\n */\nexport function sanitizeContextForTelemetry(\n  context: Record<string, unknown>\n): Record<string, unknown> {\n  if (!context || typeof context !== 'object') return context;\n\n  const sanitized = { ...context };\n\n  // Sanitize env object if present\n  if (sanitized.env && typeof sanitized.env === 'object') {\n    const sanitizedEnv: Record<string, string> = {};\n    for (const [key, value] of Object.entries(sanitized.env as Record<string, unknown>)) {\n      if (isSensitiveEnvVar(key)) {\n        sanitizedEnv[key] = '[REDACTED]';\n      } else {\n        sanitizedEnv[key] = String(value);\n      }\n    }\n    sanitized.env = sanitizedEnv;\n  }\n\n  return sanitized;\n}\n\n/**\n * Safely serialize a value for OTEL span attributes.\n * Handles truncation, circular refs, and type conversions.\n */\nfunction safeSerialize(value: unknown, maxLength = MAX_ATTRIBUTE_LENGTH): string {\n  try {\n    if (value === undefined || value === null) return String(value);\n\n    // Detect circular references\n    const seen = new WeakSet();\n    const json = JSON.stringify(value, (key, val) => {\n      if (typeof val === 'object' && val !== null) {\n        if (seen.has(val)) return '[Circular]';\n        seen.add(val);\n      }\n      // Truncate long strings\n      if (typeof val === 'string' && val.length > maxLength) {\n        return val.substring(0, maxLength) + '...[truncated]';\n      }\n      return val;\n    });\n\n    if (json.length > maxLength) {\n      return json.substring(0, maxLength) + '...[truncated]';\n    }\n    return json;\n  } catch (err) {\n    return `[Error serializing: ${err instanceof Error ? err.message : String(err)}]`;\n  }\n}\n\n/**\n * Capture check input context (Liquid template variables) in span.\n */\nexport function captureCheckInputContext(span: Span, context: Record<string, unknown>): void {\n  try {\n    // Sanitize context to redact sensitive env vars before capturing\n    const sanitizedContext = sanitizeContextForTelemetry(context);\n\n    // Capture key context variables\n    const keys = Object.keys(sanitizedContext);\n    span.setAttribute('visor.check.input.keys', keys.join(','));\n    span.setAttribute('visor.check.input.count', keys.length);\n\n    // Capture full context as JSON (with size limit) - now sanitized\n    span.setAttribute('visor.check.input.context', safeSerialize(sanitizedContext));\n\n    // Capture specific important variables separately for easy querying\n    // Use sanitizedContext consistently to avoid leaking sensitive data\n    if (sanitizedContext.pr) {\n      span.setAttribute('visor.check.input.pr', safeSerialize(sanitizedContext.pr, 1000));\n    }\n    if (sanitizedContext.outputs) {\n      span.setAttribute('visor.check.input.outputs', safeSerialize(sanitizedContext.outputs, 5000));\n    }\n    if (sanitizedContext.env) {\n      span.setAttribute(\n        'visor.check.input.env_keys',\n        Object.keys(sanitizedContext.env as object).join(',')\n      );\n    }\n  } catch (err) {\n    try {\n      span.setAttribute('visor.check.input.error', String(err));\n    } catch {\n      // Ignore if we can't even set the error attribute\n    }\n  }\n}\n\n/**\n * Capture check output in span.\n */\nexport function captureCheckOutput(span: Span, output: unknown): void {\n  try {\n    span.setAttribute('visor.check.output.type', typeof output);\n\n    if (Array.isArray(output)) {\n      span.setAttribute('visor.check.output.length', output.length);\n      // Store first few items for preview\n      const preview = output.slice(0, 10);\n      span.setAttribute('visor.check.output.preview', safeSerialize(preview, 2000));\n    }\n\n    // Full output (truncated if needed)\n    span.setAttribute('visor.check.output', safeSerialize(output));\n  } catch (err) {\n    try {\n      span.setAttribute('visor.check.output.error', String(err));\n    } catch {\n      // Ignore if we can't even set the error attribute\n    }\n  }\n}\n\n/**\n * Capture forEach iteration state.\n */\nexport function captureForEachState(\n  span: Span,\n  items: unknown[],\n  index: number,\n  currentItem: unknown\n): void {\n  try {\n    span.setAttribute('visor.foreach.total', items.length);\n    span.setAttribute('visor.foreach.index', index);\n    span.setAttribute('visor.foreach.current_item', safeSerialize(currentItem, 500));\n\n    // Store all items if not too large\n    if (items.length <= MAX_ARRAY_ITEMS) {\n      span.setAttribute('visor.foreach.items', safeSerialize(items));\n    } else {\n      span.setAttribute(\n        'visor.foreach.items.preview',\n        safeSerialize(items.slice(0, MAX_ARRAY_ITEMS))\n      );\n      span.setAttribute('visor.foreach.items.truncated', true);\n    }\n  } catch (err) {\n    span.setAttribute('visor.foreach.error', String(err));\n  }\n}\n\n/**\n * Capture Liquid template evaluation details.\n */\nexport function captureLiquidEvaluation(\n  span: Span,\n  template: string,\n  context: Record<string, unknown>,\n  result: string\n): void {\n  try {\n    span.setAttribute('visor.liquid.template', template.substring(0, 1000));\n    span.setAttribute('visor.liquid.template.length', template.length);\n    span.setAttribute('visor.liquid.result', result.substring(0, 2000));\n    span.setAttribute('visor.liquid.result.length', result.length);\n    span.setAttribute('visor.liquid.context', safeSerialize(context, 3000));\n  } catch (err) {\n    span.setAttribute('visor.liquid.error', String(err));\n  }\n}\n\n/**\n * Capture JavaScript transform execution.\n */\nexport function captureTransformJS(\n  span: Span,\n  code: string,\n  input: unknown,\n  output: unknown\n): void {\n  try {\n    // Truncate long code while keeping plain string (no JSON quoting)\n    const codePreview = code.length > 2000 ? code.substring(0, 2000) + '...[truncated]' : code;\n    span.setAttribute('visor.transform.code', codePreview);\n    span.setAttribute('visor.transform.code.length', code.length);\n    span.setAttribute('visor.transform.input', safeSerialize(input, 2000));\n    span.setAttribute('visor.transform.output', safeSerialize(output, 2000));\n  } catch (err) {\n    span.setAttribute('visor.transform.error', String(err));\n  }\n}\n\n/**\n * Capture provider request/response summary (safe, no raw AI content).\n */\nexport function captureProviderCall(\n  span: Span,\n  providerType: string,\n  request: { prompt?: string; model?: string; [key: string]: unknown },\n  response: { content?: string; tokens?: number; [key: string]: unknown }\n): void {\n  try {\n    span.setAttribute('visor.provider.type', providerType);\n    const fullCapture =\n      process.env.VISOR_TELEMETRY_FULL_CAPTURE === 'true' ||\n      process.env.VISOR_TELEMETRY_FULL_CAPTURE === '1';\n\n    // Request summary\n    if (request.model) span.setAttribute('visor.provider.request.model', String(request.model));\n    if (request.prompt) {\n      span.setAttribute('visor.provider.request.prompt.length', request.prompt.length);\n      span.setAttribute('visor.provider.request.prompt.preview', request.prompt.substring(0, 500));\n      if (fullCapture) {\n        span.setAttribute('visor.provider.request.prompt', safeSerialize(request.prompt));\n      }\n    }\n\n    // Response summary\n    if (response.content) {\n      span.setAttribute('visor.provider.response.length', response.content.length);\n      span.setAttribute('visor.provider.response.preview', response.content.substring(0, 500));\n      if (fullCapture) {\n        span.setAttribute('visor.provider.response.content', safeSerialize(response.content));\n      }\n    }\n    if (response.tokens) {\n      span.setAttribute('visor.provider.response.tokens', response.tokens);\n    }\n  } catch (err) {\n    span.setAttribute('visor.provider.error', String(err));\n  }\n}\n\n/**\n * Capture conditional evaluation (if/fail_if).\n */\nexport function captureConditionalEvaluation(\n  span: Span,\n  condition: string,\n  result: boolean,\n  context: Record<string, unknown>\n): void {\n  try {\n    span.setAttribute('visor.condition.expression', condition.substring(0, 500));\n    span.setAttribute('visor.condition.result', result);\n    span.setAttribute('visor.condition.context', safeSerialize(context, 2000));\n  } catch (err) {\n    span.setAttribute('visor.condition.error', String(err));\n  }\n}\n\n/**\n * Capture routing decision (retry/goto/run).\n */\nexport function captureRoutingDecision(\n  span: Span,\n  action: 'retry' | 'goto' | 'run',\n  target: string | string[],\n  condition?: string\n): void {\n  try {\n    span.setAttribute('visor.routing.action', action);\n    span.setAttribute('visor.routing.target', Array.isArray(target) ? target.join(',') : target);\n    if (condition) {\n      span.setAttribute('visor.routing.condition', condition.substring(0, 500));\n    }\n  } catch (err) {\n    span.setAttribute('visor.routing.error', String(err));\n  }\n}\n\n/**\n * Create a snapshot of the entire execution state at a point in time.\n * This is added as a span event for time-travel debugging.\n */\nexport function captureStateSnapshot(\n  span: Span,\n  checkId: string,\n  outputs: Record<string, unknown>,\n  memory: Record<string, unknown>\n): void {\n  try {\n    span.addEvent('state.snapshot', {\n      'visor.snapshot.check_id': checkId,\n      'visor.snapshot.outputs': safeSerialize(outputs, 5000),\n      'visor.snapshot.memory': safeSerialize(memory, 5000),\n      'visor.snapshot.timestamp': new Date().toISOString(),\n    });\n  } catch (err) {\n    span.setAttribute('visor.snapshot.error', String(err));\n  }\n}\n","import { CustomToolDefinition } from '../types/config';\nimport { Liquid } from 'liquidjs';\nimport { createExtendedLiquid } from '../liquid-extensions';\nimport { createSecureSandbox, compileAndRun } from '../utils/sandbox';\nimport Sandbox from '@nyariv/sandboxjs';\nimport { logger } from '../logger';\nimport { commandExecutor } from '../utils/command-executor';\nimport Ajv from 'ajv';\n\n/**\n * Executes custom tools defined in YAML configuration\n * These tools can be used in MCP blocks as if they were native MCP tools\n */\nexport class CustomToolExecutor {\n  private liquid: Liquid;\n  private sandbox?: Sandbox;\n  private tools: Map<string, CustomToolDefinition>;\n  private ajv: Ajv;\n\n  constructor(tools?: Record<string, CustomToolDefinition>) {\n    this.liquid = createExtendedLiquid({\n      cache: false,\n      strictFilters: false,\n      strictVariables: false,\n    });\n    this.tools = new Map(Object.entries(tools || {}));\n    this.ajv = new Ajv({ allErrors: true, verbose: true });\n  }\n\n  /**\n   * Register a custom tool\n   */\n  registerTool(tool: CustomToolDefinition): void {\n    if (!tool.name) {\n      throw new Error('Tool must have a name');\n    }\n    this.tools.set(tool.name, tool);\n  }\n\n  /**\n   * Register multiple tools\n   */\n  registerTools(tools: Record<string, CustomToolDefinition>): void {\n    for (const [name, tool] of Object.entries(tools)) {\n      // Ensure tool has the correct name\n      tool.name = tool.name || name;\n      this.registerTool(tool);\n    }\n  }\n\n  /**\n   * Get all registered tools\n   */\n  getTools(): CustomToolDefinition[] {\n    return Array.from(this.tools.values());\n  }\n\n  /**\n   * Get a specific tool by name\n   */\n  getTool(name: string): CustomToolDefinition | undefined {\n    return this.tools.get(name);\n  }\n\n  /**\n   * Validate tool input against schema using ajv\n   */\n  private validateInput(tool: CustomToolDefinition, input: Record<string, unknown>): void {\n    if (!tool.inputSchema) {\n      return;\n    }\n\n    // Compile and cache the schema validator for this tool\n    const validate = this.ajv.compile(tool.inputSchema);\n\n    // Validate the input\n    const valid = validate(input);\n\n    if (!valid) {\n      // Format validation errors for better readability\n      const errors = validate.errors\n        ?.map(err => {\n          if (err.instancePath) {\n            return `${err.instancePath}: ${err.message}`;\n          }\n          return err.message;\n        })\n        .join(', ');\n\n      throw new Error(`Input validation failed for tool '${tool.name}': ${errors}`);\n    }\n  }\n\n  /**\n   * Execute a custom tool\n   */\n  async execute(\n    toolName: string,\n    args: Record<string, unknown>,\n    context?: {\n      pr?: {\n        number: number;\n        title: string;\n        author: string;\n        branch: string;\n        base: string;\n      };\n      files?: unknown[];\n      outputs?: Record<string, unknown>;\n      env?: Record<string, string>;\n    }\n  ): Promise<unknown> {\n    const tool = this.tools.get(toolName);\n    if (!tool) {\n      throw new Error(`Tool not found: ${toolName}`);\n    }\n\n    // Validate input\n    this.validateInput(tool, args);\n\n    // Build template context\n    const templateContext = {\n      ...context,\n      args,\n      input: args,\n    };\n\n    // Render command with Liquid\n    const command = await this.liquid.parseAndRender(tool.exec, templateContext);\n\n    // Render stdin if provided\n    let stdin: string | undefined;\n    if (tool.stdin) {\n      stdin = await this.liquid.parseAndRender(tool.stdin, templateContext);\n    }\n\n    // Execute the command using shared executor\n    const env = commandExecutor.buildEnvironment(process.env, tool.env, context?.env);\n    const result = await commandExecutor.execute(command, {\n      stdin,\n      cwd: tool.cwd,\n      env,\n      timeout: tool.timeout || 30000,\n    });\n\n    // Check if command failed (non-zero exit code)\n    if (result.exitCode !== 0) {\n      const errorOutput = result.stderr || result.stdout || 'Command failed';\n      throw new Error(\n        `Tool '${toolName}' execution failed with exit code ${result.exitCode}: ${errorOutput}`\n      );\n    }\n\n    // Parse JSON if requested\n    let output: unknown = result.stdout;\n    if (tool.parseJson) {\n      try {\n        output = JSON.parse(result.stdout);\n      } catch (e) {\n        const err = e instanceof Error ? e : new Error(String(e));\n        logger.warn(`Failed to parse tool output as JSON: ${err.message}`);\n        // Only throw if there's no transform that might fix it\n        if (!tool.transform && !tool.transform_js) {\n          throw new Error(`Tool '${toolName}' output could not be parsed as JSON: ${err.message}`);\n        }\n      }\n    }\n\n    // Apply transform if specified\n    if (tool.transform) {\n      const transformContext = {\n        ...templateContext,\n        output,\n        stdout: result.stdout,\n        stderr: result.stderr,\n        exitCode: result.exitCode,\n      };\n      const transformed = await this.liquid.parseAndRender(tool.transform, transformContext);\n      // Try to parse as JSON if it looks like JSON\n      if (typeof transformed === 'string' && transformed.trim().startsWith('{')) {\n        try {\n          output = JSON.parse(transformed);\n        } catch {\n          output = transformed;\n        }\n      } else {\n        output = transformed;\n      }\n    }\n\n    // Apply JavaScript transform if specified\n    if (tool.transform_js) {\n      output = await this.applyJavaScriptTransform(tool.transform_js, output, {\n        ...templateContext,\n        stdout: result.stdout,\n        stderr: result.stderr,\n        exitCode: result.exitCode,\n      });\n    }\n\n    return output;\n  }\n\n  /**\n   * Apply JavaScript transform to output\n   */\n  private async applyJavaScriptTransform(\n    transformJs: string,\n    output: unknown,\n    context: Record<string, unknown>\n  ): Promise<unknown> {\n    this.sandbox = createSecureSandbox();\n\n    const code = `\n      const output = ${JSON.stringify(output)};\n      const context = ${JSON.stringify(context)};\n      const args = context.args || {};\n      const pr = context.pr || {};\n      const files = context.files || [];\n      const outputs = context.outputs || {};\n      const env = context.env || {};\n\n      ${transformJs}\n    `;\n\n    try {\n      return await compileAndRun(this.sandbox, code, { timeout: 5000 });\n    } catch (error) {\n      logger.error(`JavaScript transform error: ${error}`);\n      throw error;\n    }\n  }\n\n  /**\n   * Convert custom tools to MCP tool format\n   */\n  toMcpTools(): Array<{\n    name: string;\n    description?: string;\n    inputSchema?: Record<string, unknown>;\n    handler: (args: Record<string, unknown>) => Promise<unknown>;\n  }> {\n    return Array.from(this.tools.values()).map(tool => ({\n      name: tool.name,\n      description: tool.description,\n      inputSchema: tool.inputSchema as Record<string, unknown>,\n      handler: async (args: Record<string, unknown>) => {\n        return this.execute(tool.name, args);\n      },\n    }));\n  }\n}\n","/**\n * Workflow Tool Executor - enables workflows to be used as AI custom tools\n *\n * This module provides functions to:\n * 1. Convert workflow inputs to JSON Schema for tool definitions\n * 2. Create synthetic tool definitions from workflows\n * 3. Check if a tool is a workflow wrapper\n * 4. Execute workflows as tools\n */\n\nimport { CustomToolDefinition } from '../types/config';\nimport type { WorkflowDefinition, WorkflowInputParam } from '../types/workflow';\nimport { WorkflowRegistry } from '../workflow-registry';\nimport { PRInfo } from '../pr-analyzer';\nimport { ReviewSummary } from '../reviewer';\nimport { ExecutionContext } from './check-provider.interface';\nimport { logger } from '../logger';\n\n/**\n * Marker interface for workflow-based tools\n */\nexport interface WorkflowToolDefinition extends CustomToolDefinition {\n  /** Indicates this is a workflow tool */\n  __isWorkflowTool: true;\n  /** The workflow ID */\n  __workflowId: string;\n  /** Pre-filled args to merge with tool call args */\n  __argsOverrides?: Record<string, unknown>;\n}\n\n/**\n * Context for workflow tool execution\n */\nexport interface WorkflowToolContext {\n  prInfo: PRInfo;\n  outputs?: Map<string, ReviewSummary>;\n  executionContext?: ExecutionContext;\n  /** Workspace manager for reference counting during async operations */\n  workspace?: import('../utils/workspace-manager').WorkspaceManager;\n}\n\n/**\n * Workflow tool reference in ai_custom_tools config\n */\nexport interface WorkflowToolReference {\n  workflow: string;\n  args?: Record<string, unknown>;\n}\n\n/**\n * Convert workflow input parameters to JSON Schema for tool definition\n */\nexport function workflowInputsToJsonSchema(\n  inputs?: WorkflowInputParam[]\n): CustomToolDefinition['inputSchema'] {\n  if (!inputs || inputs.length === 0) {\n    return {\n      type: 'object',\n      properties: {},\n      required: [],\n    };\n  }\n\n  const properties: Record<string, unknown> = {};\n  const required: string[] = [];\n\n  for (const input of inputs) {\n    // Convert workflow JsonSchema to tool inputSchema property\n    const propSchema: Record<string, unknown> = {};\n\n    if (input.schema) {\n      // Copy schema properties\n      propSchema.type = input.schema.type || 'string';\n      if (input.schema.description) propSchema.description = input.schema.description;\n      if (input.schema.enum) propSchema.enum = input.schema.enum;\n      if (input.schema.default !== undefined) propSchema.default = input.schema.default;\n      if (input.schema.minimum !== undefined) propSchema.minimum = input.schema.minimum;\n      if (input.schema.maximum !== undefined) propSchema.maximum = input.schema.maximum;\n      if (input.schema.minLength !== undefined) propSchema.minLength = input.schema.minLength;\n      if (input.schema.maxLength !== undefined) propSchema.maxLength = input.schema.maxLength;\n      if (input.schema.pattern) propSchema.pattern = input.schema.pattern;\n      if (input.schema.format) propSchema.format = input.schema.format;\n      if (input.schema.properties) propSchema.properties = input.schema.properties;\n      if (input.schema.items) propSchema.items = input.schema.items;\n      if (input.schema.additionalProperties !== undefined) {\n        propSchema.additionalProperties = input.schema.additionalProperties;\n      }\n    } else {\n      // Default to string type\n      propSchema.type = 'string';\n    }\n\n    // Use input-level description if schema doesn't have one\n    if (!propSchema.description && input.description) {\n      propSchema.description = input.description;\n    }\n\n    // Use input-level default if schema doesn't have one\n    if (propSchema.default === undefined && input.default !== undefined) {\n      propSchema.default = input.default;\n    }\n\n    properties[input.name] = propSchema;\n\n    // Check if required (default is true if not specified)\n    if (input.required !== false && input.default === undefined) {\n      required.push(input.name);\n    }\n  }\n\n  return {\n    type: 'object',\n    properties,\n    required: required.length > 0 ? required : undefined,\n  };\n}\n\n/**\n * Create a synthetic tool definition from a workflow\n *\n * Note: This function creates a new schema object and does not mutate the input.\n */\nexport function createWorkflowToolDefinition(\n  workflow: WorkflowDefinition,\n  argsOverrides?: Record<string, unknown>\n): WorkflowToolDefinition {\n  const baseSchema = workflowInputsToJsonSchema(workflow.inputs);\n\n  // Create a copy of the schema to avoid mutating the original\n  // This ensures the same workflow can be used to create multiple tool definitions\n  let inputSchema = baseSchema;\n\n  // Remove properties that are pre-filled via argsOverrides\n  if (argsOverrides && baseSchema && typeof baseSchema === 'object') {\n    const baseProperties = baseSchema.properties as Record<string, unknown> | undefined;\n    const baseRequired = baseSchema.required as string[] | undefined;\n\n    // Create shallow copies to avoid mutation\n    const filteredProperties = baseProperties ? { ...baseProperties } : {};\n    for (const key of Object.keys(argsOverrides)) {\n      delete filteredProperties[key];\n    }\n\n    const filteredRequired = baseRequired\n      ? baseRequired.filter((r: string) => !argsOverrides[r])\n      : undefined;\n\n    inputSchema = {\n      ...baseSchema,\n      properties: filteredProperties,\n      required: filteredRequired && filteredRequired.length > 0 ? filteredRequired : undefined,\n    };\n  }\n\n  return {\n    name: workflow.id,\n    description: workflow.description || `Execute the ${workflow.name} workflow`,\n    inputSchema,\n    // Workflow tools don't have an exec command - they're executed specially\n    exec: '',\n    // Marker properties\n    __isWorkflowTool: true,\n    __workflowId: workflow.id,\n    __argsOverrides: argsOverrides,\n  };\n}\n\n/**\n * Check if a tool definition is a workflow tool wrapper\n */\nexport function isWorkflowTool(tool: CustomToolDefinition): tool is WorkflowToolDefinition {\n  return (tool as WorkflowToolDefinition).__isWorkflowTool === true;\n}\n\n/**\n * Check if a custom tool reference is a workflow reference\n */\nexport function isWorkflowToolReference(\n  item: string | WorkflowToolReference\n): item is WorkflowToolReference {\n  return typeof item === 'object' && item !== null && 'workflow' in item;\n}\n\n/**\n * Execute a workflow as a tool\n */\nexport async function executeWorkflowAsTool(\n  workflowId: string,\n  args: Record<string, unknown>,\n  context: WorkflowToolContext,\n  argsOverrides?: Record<string, unknown>\n): Promise<unknown> {\n  const registry = WorkflowRegistry.getInstance();\n  const workflow = registry.get(workflowId);\n\n  if (!workflow) {\n    throw new Error(`Workflow '${workflowId}' not found in registry`);\n  }\n\n  logger.debug(`[WorkflowToolExecutor] Executing workflow '${workflowId}' as tool`);\n\n  // Merge args with overrides (overrides take precedence for pre-filled values)\n  const mergedArgs = {\n    ...args,\n    ...argsOverrides,\n  };\n\n  // Dynamically import WorkflowCheckProvider to avoid circular dependencies\n  const { WorkflowCheckProvider } = await import('./workflow-check-provider');\n  const provider = new WorkflowCheckProvider();\n\n  // Build the check config for the workflow provider\n  const checkConfig = {\n    type: 'workflow',\n    workflow: workflowId,\n    args: mergedArgs,\n    checkName: `workflow-tool-${workflowId}`,\n  };\n\n  // Execute the workflow\n  const result = await provider.execute(\n    context.prInfo,\n    checkConfig,\n    context.outputs,\n    context.executionContext\n  );\n\n  // Return the output from the workflow execution\n  // The workflow output is the most useful part for AI tools\n  const output = (result as any).output;\n\n  // Log what we're returning (important for debugging MCP tool results)\n  const outputKeys = output ? Object.keys(output) : [];\n  const outputPreview = output ? JSON.stringify(output).substring(0, 500) : 'undefined';\n  logger.info(\n    `[WorkflowToolExecutor] Workflow '${workflowId}' completed. Output keys: [${outputKeys.join(', ')}]`\n  );\n  logger.debug(`[WorkflowToolExecutor] Workflow '${workflowId}' output preview: ${outputPreview}`);\n\n  if (output !== undefined) {\n    return output;\n  }\n\n  // Fall back to content if no structured output\n  if ((result as any).content) {\n    logger.debug(`[WorkflowToolExecutor] Using content fallback for '${workflowId}'`);\n    return (result as any).content;\n  }\n\n  // Fall back to the full result\n  logger.debug(`[WorkflowToolExecutor] Using full result fallback for '${workflowId}'`);\n  return result;\n}\n\n/**\n * Resolve an ai_custom_tools item to a tool definition\n * Returns undefined if the item is not a workflow reference\n */\nexport function resolveWorkflowToolFromItem(\n  item: string | WorkflowToolReference\n): WorkflowToolDefinition | undefined {\n  const registry = WorkflowRegistry.getInstance();\n\n  if (typeof item === 'string') {\n    // Check if string matches a registered workflow\n    if (registry.has(item)) {\n      const workflow = registry.get(item)!;\n      return createWorkflowToolDefinition(workflow);\n    }\n    return undefined;\n  }\n\n  if (isWorkflowToolReference(item)) {\n    const workflow = registry.get(item.workflow);\n    if (!workflow) {\n      logger.warn(`[WorkflowToolExecutor] Workflow '${item.workflow}' not found in registry`);\n      return undefined;\n    }\n    return createWorkflowToolDefinition(workflow, item.args);\n  }\n\n  return undefined;\n}\n","/**\n * SQLite-backed schedule store (OSS default)\n *\n * Uses better-sqlite3 loaded via createRequire to avoid ncc bundling the native addon.\n * Schema migration is inline (no external migration files â€” ncc-safe).\n * WAL mode is enabled for better concurrent read performance.\n *\n * HA locking is in-memory (Map-based) since SQLite is single-node only.\n */\nimport path from 'path';\nimport fs from 'fs';\nimport { v4 as uuidv4 } from 'uuid';\nimport { logger } from '../../logger';\nimport type { Schedule, ScheduleLimits } from '../schedule-store';\nimport type { ScheduleStoreBackend, ScheduleStoreStats } from './types';\n\n// Type declarations for better-sqlite3 (avoid importing the module at compile time)\ninterface BetterSqliteDatabase {\n  pragma(source: string): unknown;\n  exec(source: string): void;\n  prepare(source: string): BetterSqliteStatement;\n  close(): void;\n}\n\ninterface BetterSqliteStatement {\n  run(...params: unknown[]): { changes: number };\n  get(...params: unknown[]): unknown;\n  all(...params: unknown[]): unknown[];\n}\n\n/**\n * Database row shape (snake_case)\n */\ninterface ScheduleRow {\n  id: string;\n  creator_id: string;\n  creator_context: string | null;\n  creator_name: string | null;\n  timezone: string;\n  schedule_expr: string;\n  run_at: number | null;\n  is_recurring: number; // SQLite boolean: 0/1\n  original_expression: string;\n  workflow: string | null;\n  workflow_inputs: string | null; // JSON\n  output_context: string | null; // JSON\n  status: string;\n  created_at: number;\n  last_run_at: number | null;\n  next_run_at: number | null;\n  run_count: number;\n  failure_count: number;\n  last_error: string | null;\n  previous_response: string | null;\n}\n\n/**\n * Convert a Schedule object to a database row\n */\nfunction toDbRow(schedule: Schedule): ScheduleRow {\n  return {\n    id: schedule.id,\n    creator_id: schedule.creatorId,\n    creator_context: schedule.creatorContext ?? null,\n    creator_name: schedule.creatorName ?? null,\n    timezone: schedule.timezone,\n    schedule_expr: schedule.schedule,\n    run_at: schedule.runAt ?? null,\n    is_recurring: schedule.isRecurring ? 1 : 0,\n    original_expression: schedule.originalExpression,\n    workflow: schedule.workflow ?? null,\n    workflow_inputs: schedule.workflowInputs ? JSON.stringify(schedule.workflowInputs) : null,\n    output_context: schedule.outputContext ? JSON.stringify(schedule.outputContext) : null,\n    status: schedule.status,\n    created_at: schedule.createdAt,\n    last_run_at: schedule.lastRunAt ?? null,\n    next_run_at: schedule.nextRunAt ?? null,\n    run_count: schedule.runCount,\n    failure_count: schedule.failureCount,\n    last_error: schedule.lastError ?? null,\n    previous_response: schedule.previousResponse ?? null,\n  };\n}\n\nfunction safeJsonParse<T = unknown>(value: string | null): T | undefined {\n  if (!value) return undefined;\n  try {\n    return JSON.parse(value) as T;\n  } catch {\n    return undefined;\n  }\n}\n\n/**\n * Convert a database row to a Schedule object\n */\nfunction fromDbRow(row: ScheduleRow): Schedule {\n  return {\n    id: row.id,\n    creatorId: row.creator_id,\n    creatorContext: row.creator_context ?? undefined,\n    creatorName: row.creator_name ?? undefined,\n    timezone: row.timezone,\n    schedule: row.schedule_expr,\n    runAt: row.run_at ?? undefined,\n    isRecurring: row.is_recurring === 1,\n    originalExpression: row.original_expression,\n    workflow: row.workflow ?? undefined,\n    workflowInputs: safeJsonParse(row.workflow_inputs),\n    outputContext: safeJsonParse(row.output_context),\n    status: row.status as Schedule['status'],\n    createdAt: row.created_at,\n    lastRunAt: row.last_run_at ?? undefined,\n    nextRunAt: row.next_run_at ?? undefined,\n    runCount: row.run_count,\n    failureCount: row.failure_count,\n    lastError: row.last_error ?? undefined,\n    previousResponse: row.previous_response ?? undefined,\n  };\n}\n\n/**\n * SQLite implementation of ScheduleStoreBackend\n */\nexport class SqliteStoreBackend implements ScheduleStoreBackend {\n  private db: BetterSqliteDatabase | null = null;\n  private dbPath: string;\n\n  // In-memory locks (single-node only; SQLite doesn't support distributed locking)\n  private locks = new Map<string, { nodeId: string; token: string; expiresAt: number }>();\n\n  constructor(filename?: string) {\n    this.dbPath = filename || '.visor/schedules.db';\n  }\n\n  async initialize(): Promise<void> {\n    // Resolve and ensure directory exists\n    const resolvedPath = path.resolve(process.cwd(), this.dbPath);\n    const dir = path.dirname(resolvedPath);\n    fs.mkdirSync(dir, { recursive: true });\n\n    // Load better-sqlite3 via createRequire (ncc-safe)\n    const { createRequire } = require('module') as typeof import('module');\n    const runtimeRequire = createRequire(__filename);\n    let Database: new (filename: string) => BetterSqliteDatabase;\n    try {\n      Database = runtimeRequire('better-sqlite3');\n    } catch (err: unknown) {\n      const code = (err as { code?: string })?.code;\n      if (code === 'MODULE_NOT_FOUND' || code === 'ERR_MODULE_NOT_FOUND') {\n        throw new Error(\n          'better-sqlite3 is required for SQLite schedule storage. ' +\n            'Install it with: npm install better-sqlite3'\n        );\n      }\n      throw err;\n    }\n\n    this.db = new Database(resolvedPath);\n\n    // Enable WAL mode for better concurrent reads\n    this.db.pragma('journal_mode = WAL');\n\n    // Run schema migration (idempotent)\n    this.migrateSchema();\n\n    logger.info(`[SqliteStore] Initialized at ${this.dbPath}`);\n  }\n\n  async shutdown(): Promise<void> {\n    if (this.db) {\n      this.db.close();\n      this.db = null;\n    }\n    this.locks.clear();\n  }\n\n  // --- Schema Migration ---\n\n  private migrateSchema(): void {\n    const db = this.getDb();\n\n    db.exec(`\n      CREATE TABLE IF NOT EXISTS schedules (\n        id              VARCHAR(36)  PRIMARY KEY,\n        creator_id      VARCHAR(255) NOT NULL,\n        creator_context VARCHAR(255),\n        creator_name    VARCHAR(255),\n        timezone        VARCHAR(64)  NOT NULL DEFAULT 'UTC',\n        schedule_expr   VARCHAR(255),\n        run_at          BIGINT,\n        is_recurring    BOOLEAN      NOT NULL,\n        original_expression TEXT,\n        workflow        VARCHAR(255),\n        workflow_inputs TEXT,\n        output_context  TEXT,\n        status          VARCHAR(20)  NOT NULL,\n        created_at      BIGINT       NOT NULL,\n        last_run_at     BIGINT,\n        next_run_at     BIGINT,\n        run_count       INTEGER      NOT NULL DEFAULT 0,\n        failure_count   INTEGER      NOT NULL DEFAULT 0,\n        last_error      TEXT,\n        previous_response TEXT,\n        claimed_by      VARCHAR(255),\n        claimed_at      BIGINT,\n        lock_token      VARCHAR(36)\n      );\n\n      CREATE INDEX IF NOT EXISTS idx_schedules_creator_id\n        ON schedules(creator_id);\n\n      CREATE INDEX IF NOT EXISTS idx_schedules_status\n        ON schedules(status);\n\n      CREATE INDEX IF NOT EXISTS idx_schedules_status_next_run\n        ON schedules(status, next_run_at);\n\n      CREATE TABLE IF NOT EXISTS scheduler_locks (\n        lock_id     VARCHAR(255) PRIMARY KEY,\n        node_id     VARCHAR(255) NOT NULL,\n        lock_token  VARCHAR(36)  NOT NULL,\n        acquired_at BIGINT       NOT NULL,\n        expires_at  BIGINT       NOT NULL\n      );\n    `);\n  }\n\n  // --- Helpers ---\n\n  private getDb(): BetterSqliteDatabase {\n    if (!this.db) {\n      throw new Error('[SqliteStore] Database not initialized. Call initialize() first.');\n    }\n    return this.db;\n  }\n\n  // --- CRUD ---\n\n  async create(\n    schedule: Omit<Schedule, 'id' | 'createdAt' | 'runCount' | 'failureCount' | 'status'>\n  ): Promise<Schedule> {\n    const db = this.getDb();\n\n    const newSchedule: Schedule = {\n      ...schedule,\n      id: uuidv4(),\n      createdAt: Date.now(),\n      runCount: 0,\n      failureCount: 0,\n      status: 'active',\n    };\n\n    const row = toDbRow(newSchedule);\n\n    db.prepare(\n      `\n      INSERT INTO schedules (\n        id, creator_id, creator_context, creator_name, timezone,\n        schedule_expr, run_at, is_recurring, original_expression,\n        workflow, workflow_inputs, output_context,\n        status, created_at, last_run_at, next_run_at,\n        run_count, failure_count, last_error, previous_response\n      ) VALUES (\n        ?, ?, ?, ?, ?,\n        ?, ?, ?, ?,\n        ?, ?, ?,\n        ?, ?, ?, ?,\n        ?, ?, ?, ?\n      )\n    `\n    ).run(\n      row.id,\n      row.creator_id,\n      row.creator_context,\n      row.creator_name,\n      row.timezone,\n      row.schedule_expr,\n      row.run_at,\n      row.is_recurring,\n      row.original_expression,\n      row.workflow,\n      row.workflow_inputs,\n      row.output_context,\n      row.status,\n      row.created_at,\n      row.last_run_at,\n      row.next_run_at,\n      row.run_count,\n      row.failure_count,\n      row.last_error,\n      row.previous_response\n    );\n\n    logger.info(\n      `[SqliteStore] Created schedule ${newSchedule.id} for user ${newSchedule.creatorId}`\n    );\n\n    return newSchedule;\n  }\n\n  async importSchedule(schedule: Schedule): Promise<void> {\n    const db = this.getDb();\n    const row = toDbRow(schedule);\n\n    db.prepare(\n      `\n      INSERT OR IGNORE INTO schedules (\n        id, creator_id, creator_context, creator_name, timezone,\n        schedule_expr, run_at, is_recurring, original_expression,\n        workflow, workflow_inputs, output_context,\n        status, created_at, last_run_at, next_run_at,\n        run_count, failure_count, last_error, previous_response\n      ) VALUES (\n        ?, ?, ?, ?, ?,\n        ?, ?, ?, ?,\n        ?, ?, ?,\n        ?, ?, ?, ?,\n        ?, ?, ?, ?\n      )\n    `\n    ).run(\n      row.id,\n      row.creator_id,\n      row.creator_context,\n      row.creator_name,\n      row.timezone,\n      row.schedule_expr,\n      row.run_at,\n      row.is_recurring,\n      row.original_expression,\n      row.workflow,\n      row.workflow_inputs,\n      row.output_context,\n      row.status,\n      row.created_at,\n      row.last_run_at,\n      row.next_run_at,\n      row.run_count,\n      row.failure_count,\n      row.last_error,\n      row.previous_response\n    );\n  }\n\n  async get(id: string): Promise<Schedule | undefined> {\n    const db = this.getDb();\n    const row = db.prepare('SELECT * FROM schedules WHERE id = ?').get(id) as\n      | ScheduleRow\n      | undefined;\n    return row ? fromDbRow(row) : undefined;\n  }\n\n  async update(id: string, patch: Partial<Schedule>): Promise<Schedule | undefined> {\n    const db = this.getDb();\n\n    // Get current row\n    const existing = db.prepare('SELECT * FROM schedules WHERE id = ?').get(id) as\n      | ScheduleRow\n      | undefined;\n    if (!existing) return undefined;\n\n    const current = fromDbRow(existing);\n    const updated: Schedule = { ...current, ...patch, id: current.id }; // ID cannot change\n    const row = toDbRow(updated);\n\n    db.prepare(\n      `\n      UPDATE schedules SET\n        creator_id = ?, creator_context = ?, creator_name = ?, timezone = ?,\n        schedule_expr = ?, run_at = ?, is_recurring = ?, original_expression = ?,\n        workflow = ?, workflow_inputs = ?, output_context = ?,\n        status = ?, last_run_at = ?, next_run_at = ?,\n        run_count = ?, failure_count = ?, last_error = ?, previous_response = ?\n      WHERE id = ?\n    `\n    ).run(\n      row.creator_id,\n      row.creator_context,\n      row.creator_name,\n      row.timezone,\n      row.schedule_expr,\n      row.run_at,\n      row.is_recurring,\n      row.original_expression,\n      row.workflow,\n      row.workflow_inputs,\n      row.output_context,\n      row.status,\n      row.last_run_at,\n      row.next_run_at,\n      row.run_count,\n      row.failure_count,\n      row.last_error,\n      row.previous_response,\n      row.id\n    );\n\n    return updated;\n  }\n\n  async delete(id: string): Promise<boolean> {\n    const db = this.getDb();\n    const result = db.prepare('DELETE FROM schedules WHERE id = ?').run(id);\n    if (result.changes > 0) {\n      logger.info(`[SqliteStore] Deleted schedule ${id}`);\n      return true;\n    }\n    return false;\n  }\n\n  // --- Queries ---\n\n  async getByCreator(creatorId: string): Promise<Schedule[]> {\n    const db = this.getDb();\n    const rows = db\n      .prepare('SELECT * FROM schedules WHERE creator_id = ?')\n      .all(creatorId) as ScheduleRow[];\n    return rows.map(fromDbRow);\n  }\n\n  async getActiveSchedules(): Promise<Schedule[]> {\n    const db = this.getDb();\n    const rows = db\n      .prepare(\"SELECT * FROM schedules WHERE status = 'active'\")\n      .all() as ScheduleRow[];\n    return rows.map(fromDbRow);\n  }\n\n  async getDueSchedules(now?: number): Promise<Schedule[]> {\n    const ts = now ?? Date.now();\n    const db = this.getDb();\n    const rows = db\n      .prepare(\n        `SELECT * FROM schedules\n         WHERE status = 'active'\n         AND (\n           (is_recurring = 0 AND run_at IS NOT NULL AND run_at <= ?)\n           OR\n           (is_recurring = 1 AND next_run_at IS NOT NULL AND next_run_at <= ?)\n         )`\n      )\n      .all(ts, ts) as ScheduleRow[];\n    return rows.map(fromDbRow);\n  }\n\n  async findByWorkflow(creatorId: string, workflowName: string): Promise<Schedule[]> {\n    const db = this.getDb();\n    const escaped = workflowName.toLowerCase().replace(/[%_\\\\]/g, '\\\\$&');\n    const pattern = `%${escaped}%`;\n    const rows = db\n      .prepare(\n        `SELECT * FROM schedules\n         WHERE creator_id = ? AND status = 'active'\n         AND LOWER(workflow) LIKE ? ESCAPE '\\\\'`\n      )\n      .all(creatorId, pattern) as ScheduleRow[];\n    return rows.map(fromDbRow);\n  }\n\n  async getAll(): Promise<Schedule[]> {\n    const db = this.getDb();\n    const rows = db.prepare('SELECT * FROM schedules').all() as ScheduleRow[];\n    return rows.map(fromDbRow);\n  }\n\n  async getStats(): Promise<ScheduleStoreStats> {\n    const db = this.getDb();\n\n    const row = db\n      .prepare(\n        `SELECT\n          COUNT(*) as total,\n          SUM(CASE WHEN status = 'active' THEN 1 ELSE 0 END) as active,\n          SUM(CASE WHEN status = 'paused' THEN 1 ELSE 0 END) as paused,\n          SUM(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) as completed,\n          SUM(CASE WHEN status = 'failed' THEN 1 ELSE 0 END) as failed,\n          SUM(CASE WHEN is_recurring = 1 THEN 1 ELSE 0 END) as recurring,\n          SUM(CASE WHEN is_recurring = 0 THEN 1 ELSE 0 END) as one_time\n        FROM schedules`\n      )\n      .get() as {\n      total: number;\n      active: number;\n      paused: number;\n      completed: number;\n      failed: number;\n      recurring: number;\n      one_time: number;\n    };\n\n    return {\n      total: row.total,\n      active: row.active,\n      paused: row.paused,\n      completed: row.completed,\n      failed: row.failed,\n      recurring: row.recurring,\n      oneTime: row.one_time,\n    };\n  }\n\n  async validateLimits(\n    creatorId: string,\n    isRecurring: boolean,\n    limits: ScheduleLimits\n  ): Promise<void> {\n    const db = this.getDb();\n\n    // Global limit\n    if (limits.maxGlobal) {\n      const row = db.prepare('SELECT COUNT(*) as cnt FROM schedules').get() as { cnt: number };\n      if (row.cnt >= limits.maxGlobal) {\n        throw new Error(`Global schedule limit reached (${limits.maxGlobal})`);\n      }\n    }\n\n    // Per-user limit\n    if (limits.maxPerUser) {\n      const row = db\n        .prepare('SELECT COUNT(*) as cnt FROM schedules WHERE creator_id = ?')\n        .get(creatorId) as { cnt: number };\n      if (row.cnt >= limits.maxPerUser) {\n        throw new Error(`You have reached the maximum number of schedules (${limits.maxPerUser})`);\n      }\n    }\n\n    // Per-user recurring limit\n    if (isRecurring && limits.maxRecurringPerUser) {\n      const row = db\n        .prepare('SELECT COUNT(*) as cnt FROM schedules WHERE creator_id = ? AND is_recurring = 1')\n        .get(creatorId) as { cnt: number };\n      if (row.cnt >= limits.maxRecurringPerUser) {\n        throw new Error(\n          `You have reached the maximum number of recurring schedules (${limits.maxRecurringPerUser})`\n        );\n      }\n    }\n  }\n\n  // --- HA Locking (in-memory for SQLite â€” single-node only) ---\n\n  async tryAcquireLock(\n    scheduleId: string,\n    nodeId: string,\n    ttlSeconds: number\n  ): Promise<string | null> {\n    const now = Date.now();\n    const existing = this.locks.get(scheduleId);\n\n    // Check if an unexpired lock exists\n    if (existing && existing.expiresAt > now) {\n      if (existing.nodeId === nodeId) {\n        // Same node: return existing token\n        return existing.token;\n      }\n      // Another node holds the lock\n      return null;\n    }\n\n    // Acquire lock\n    const token = uuidv4();\n    this.locks.set(scheduleId, {\n      nodeId,\n      token,\n      expiresAt: now + ttlSeconds * 1000,\n    });\n    return token;\n  }\n\n  async releaseLock(scheduleId: string, lockToken: string): Promise<void> {\n    const existing = this.locks.get(scheduleId);\n    if (existing && existing.token === lockToken) {\n      this.locks.delete(scheduleId);\n    }\n  }\n\n  async renewLock(scheduleId: string, lockToken: string, ttlSeconds: number): Promise<boolean> {\n    const existing = this.locks.get(scheduleId);\n    if (!existing || existing.token !== lockToken) {\n      return false;\n    }\n    existing.expiresAt = Date.now() + ttlSeconds * 1000;\n    return true;\n  }\n\n  async flush(): Promise<void> {\n    // No-op for SQLite â€” writes are synchronous\n  }\n}\n","/**\n * Store backend factory\n *\n * Creates the appropriate ScheduleStoreBackend based on configuration:\n * - 'sqlite' (default) â†’ SqliteStoreBackend (OSS, zero-config)\n * - 'postgresql' / 'mysql' â†’ Enterprise KnexStoreBackend (requires license)\n */\nimport { logger } from '../../logger';\nimport type {\n  ScheduleStoreBackend,\n  StorageConfig,\n  HAConfig,\n  SqliteConnectionConfig,\n} from './types';\nimport { SqliteStoreBackend } from './sqlite-store';\n\nexport type { ScheduleStoreBackend, ScheduleStoreStats, StorageConfig, HAConfig } from './types';\n\n/**\n * Create a store backend based on configuration\n */\nexport async function createStoreBackend(\n  storageConfig?: StorageConfig,\n  haConfig?: HAConfig\n): Promise<ScheduleStoreBackend> {\n  const driver = storageConfig?.driver || 'sqlite';\n\n  switch (driver) {\n    case 'sqlite': {\n      const conn = storageConfig?.connection as SqliteConnectionConfig | undefined;\n      return new SqliteStoreBackend(conn?.filename);\n    }\n\n    case 'postgresql':\n    case 'mysql':\n    case 'mssql': {\n      // Enterprise-only: dynamic import to keep OSS code clean\n      try {\n        // Variable path prevents ncc from tracing into enterprise/ (stashed during OSS builds)\n        const loaderPath = '../../enterprise/loader';\n        // @ts-ignore â€” enterprise/ may not exist in OSS builds (caught at runtime)\n        const { loadEnterpriseStoreBackend } = await import(loaderPath);\n        return await loadEnterpriseStoreBackend(driver, storageConfig!, haConfig);\n      } catch (err) {\n        const msg = err instanceof Error ? err.message : String(err);\n        logger.error(`[StoreFactory] Failed to load enterprise ${driver} backend: ${msg}`);\n        throw new Error(\n          `The ${driver} schedule storage driver requires a Visor Enterprise license. ` +\n            `Install the enterprise package or use driver: 'sqlite' (default). ` +\n            `Original error: ${msg}`\n        );\n      }\n    }\n\n    default:\n      throw new Error(`Unknown schedule storage driver: ${driver}`);\n  }\n}\n","/**\n * One-time migration from .visor/schedules.json to a SQL backend\n *\n * - Reads the JSON file, inserts each schedule into the backend\n * - Skips schedules whose ID already exists (idempotent)\n * - Renames the JSON file to .json.migrated as a backup\n * - Called automatically during ScheduleStore.initialize() when the JSON file exists\n */\nimport fs from 'fs/promises';\nimport path from 'path';\nimport { logger } from '../../logger';\nimport type { Schedule } from '../schedule-store';\nimport type { ScheduleStoreBackend } from './types';\n\n/**\n * Migrate schedules from a JSON file into a ScheduleStoreBackend.\n *\n * @param jsonPath Path to the JSON file (absolute or relative to cwd)\n * @param backend  Already-initialized store backend to migrate into\n * @returns Number of schedules migrated (0 if file doesn't exist or already migrated)\n */\nexport async function migrateJsonToBackend(\n  jsonPath: string,\n  backend: ScheduleStoreBackend\n): Promise<number> {\n  const resolvedPath = path.resolve(process.cwd(), jsonPath);\n\n  // Check if JSON file exists\n  let content: string;\n  try {\n    content = await fs.readFile(resolvedPath, 'utf-8');\n  } catch (err) {\n    if ((err as NodeJS.ErrnoException).code === 'ENOENT') {\n      // No file to migrate â€” nothing to do\n      return 0;\n    }\n    throw err;\n  }\n\n  // Parse the JSON\n  let data: { schedules?: Schedule[] };\n  try {\n    data = JSON.parse(content);\n  } catch {\n    logger.warn(`[JsonMigrator] Failed to parse ${jsonPath}, skipping migration`);\n    return 0;\n  }\n\n  const schedules = data.schedules;\n  if (!Array.isArray(schedules) || schedules.length === 0) {\n    logger.debug('[JsonMigrator] No schedules to migrate');\n    // Still rename to mark as processed\n    await renameToMigrated(resolvedPath);\n    return 0;\n  }\n\n  let migrated = 0;\n\n  for (const schedule of schedules) {\n    if (!schedule.id) {\n      logger.warn('[JsonMigrator] Skipping schedule without ID');\n      continue;\n    }\n\n    // Check if already migrated (idempotent)\n    const existing = await backend.get(schedule.id);\n    if (existing) {\n      logger.debug(`[JsonMigrator] Schedule ${schedule.id} already exists, skipping`);\n      continue;\n    }\n\n    try {\n      // Import preserving original ID (idempotent â€” skips if ID already exists)\n      await backend.importSchedule(schedule);\n      migrated++;\n    } catch (err) {\n      logger.warn(\n        `[JsonMigrator] Failed to migrate schedule ${schedule.id}: ${\n          err instanceof Error ? err.message : err\n        }`\n      );\n    }\n  }\n\n  // Rename original file as backup\n  await renameToMigrated(resolvedPath);\n\n  logger.info(`[JsonMigrator] Migrated ${migrated}/${schedules.length} schedules from ${jsonPath}`);\n  return migrated;\n}\n\n/**\n * Rename the JSON file to .migrated as a backup\n */\nasync function renameToMigrated(resolvedPath: string): Promise<void> {\n  const migratedPath = `${resolvedPath}.migrated`;\n  try {\n    await fs.rename(resolvedPath, migratedPath);\n    logger.info(`[JsonMigrator] Backed up ${resolvedPath} â†’ ${migratedPath}`);\n  } catch (err) {\n    logger.warn(\n      `[JsonMigrator] Failed to rename ${resolvedPath}: ${err instanceof Error ? err.message : err}`\n    );\n  }\n}\n","/**\n * Generic persistent storage for scheduled workflows\n *\n * Delegates all persistence to a ScheduleStoreBackend (default: SQLite).\n * The in-memory Map and JSON file I/O have been replaced by the backend abstraction\n * to support SQLite (OSS) and PostgreSQL/MySQL (Enterprise) storage.\n */\nimport { logger } from '../logger';\nimport type {\n  ScheduleStoreBackend,\n  StorageConfig,\n  HAConfig,\n  ScheduleStoreStats,\n} from './store/types';\nimport { createStoreBackend } from './store/index';\nimport { migrateJsonToBackend } from './store/json-migrator';\n\n/**\n * Output context for schedule execution results\n */\nexport interface ScheduleOutputContext {\n  /** Output destination type */\n  type: 'slack' | 'github' | 'webhook' | 'none';\n  /** Target identifier (channel ID, repo name, webhook URL, etc.) */\n  target?: string;\n  /** Thread/issue/PR identifier for threaded outputs */\n  threadId?: string;\n  /** Additional destination-specific metadata */\n  metadata?: Record<string, unknown>;\n}\n\n/**\n * Represents a scheduled workflow execution\n */\nexport interface Schedule {\n  id: string; // UUID v4\n\n  // Creator\n  creatorId: string; // Generic user ID (e.g., Slack user ID, GitHub user, CLI user)\n  creatorContext?: string; // Context identifier: \"slack:U123\", \"github:user\", \"cli\"\n  creatorName?: string; // Display name (cached)\n  timezone: string; // IANA timezone\n\n  // Scheduling\n  schedule: string; // Cron expression (for recurring)\n  runAt?: number; // Unix timestamp (for one-time)\n  isRecurring: boolean;\n  originalExpression: string; // User's natural language input\n\n  // What to execute\n  workflow?: string; // Workflow/check ID to run (undefined for simple text reminders)\n  workflowInputs?: Record<string, unknown>; // Input parameters for the workflow\n\n  // Output routing (optional - workflows can handle their own output)\n  outputContext?: ScheduleOutputContext;\n\n  // State\n  status: 'active' | 'paused' | 'completed' | 'failed';\n  createdAt: number;\n  lastRunAt?: number;\n  nextRunAt?: number; // Computed next execution time\n  runCount: number;\n  failureCount: number;\n  lastError?: string;\n\n  // Previous execution response (for recurring reminders)\n  previousResponse?: string; // The AI response from the last execution\n}\n\n/**\n * Configuration for the schedule store\n */\nexport interface ScheduleStoreConfig {\n  /** Path to the JSON file for persistence (legacy, triggers auto-migration) */\n  path?: string;\n  /** Auto-save after changes (default: true) â€” ignored for SQL backends */\n  autoSave?: boolean;\n  /** Debounce save operations in ms (default: 1000) â€” ignored for SQL backends */\n  saveDebounceMs?: number;\n  /** SQL storage configuration */\n  storage?: StorageConfig;\n  /** High-availability configuration */\n  ha?: HAConfig;\n}\n\n/**\n * Limits configuration for schedules\n */\nexport interface ScheduleLimits {\n  maxPerUser?: number; // Default: 25\n  maxRecurringPerUser?: number; // Default: 10\n  maxGlobal?: number; // Default: 1000\n}\n\n/**\n * Storage class for scheduled workflows with pluggable backend persistence\n */\nexport class ScheduleStore {\n  private static instance: ScheduleStore | undefined;\n  private backend: ScheduleStoreBackend | null = null;\n  private initialized = false;\n  private limits: ScheduleLimits;\n  private config: ScheduleStoreConfig;\n  private externalBackend: ScheduleStoreBackend | null = null;\n\n  private constructor(\n    config?: ScheduleStoreConfig,\n    limits?: ScheduleLimits,\n    backend?: ScheduleStoreBackend\n  ) {\n    this.config = config || {};\n    this.limits = {\n      maxPerUser: limits?.maxPerUser ?? 25,\n      maxRecurringPerUser: limits?.maxRecurringPerUser ?? 10,\n      maxGlobal: limits?.maxGlobal ?? 1000,\n    };\n    if (backend) {\n      this.externalBackend = backend;\n    }\n  }\n\n  /**\n   * Get singleton instance\n   *\n   * Note: Config and limits are only applied on first call. Subsequent calls\n   * with different parameters will log a warning and return the existing instance.\n   * Use createIsolated() for testing with different configurations.\n   */\n  static getInstance(config?: ScheduleStoreConfig, limits?: ScheduleLimits): ScheduleStore {\n    if (!ScheduleStore.instance) {\n      ScheduleStore.instance = new ScheduleStore(config, limits);\n    } else if (config || limits) {\n      logger.warn(\n        '[ScheduleStore] getInstance() called with config/limits but instance already exists. ' +\n          'Parameters ignored. Use createIsolated() for testing or resetInstance() first.'\n      );\n    }\n    return ScheduleStore.instance;\n  }\n\n  /**\n   * Create a new isolated instance (for testing)\n   */\n  static createIsolated(\n    config?: ScheduleStoreConfig,\n    limits?: ScheduleLimits,\n    backend?: ScheduleStoreBackend\n  ): ScheduleStore {\n    return new ScheduleStore(config, limits, backend);\n  }\n\n  /**\n   * Reset singleton instance (for testing)\n   */\n  static resetInstance(): void {\n    if (ScheduleStore.instance) {\n      // Best-effort shutdown\n      if (ScheduleStore.instance.backend) {\n        ScheduleStore.instance.backend.shutdown().catch(() => {});\n      }\n    }\n    ScheduleStore.instance = undefined;\n  }\n\n  /**\n   * Initialize the store - creates backend and runs migrations\n   */\n  async initialize(): Promise<void> {\n    if (this.initialized) {\n      return;\n    }\n\n    // Create backend (or use the externally provided one)\n    if (this.externalBackend) {\n      this.backend = this.externalBackend;\n    } else {\n      this.backend = await createStoreBackend(this.config.storage, this.config.ha);\n    }\n\n    await this.backend.initialize();\n\n    // Auto-migrate from JSON if a legacy path is configured or default JSON file exists\n    const jsonPath = this.config.path || '.visor/schedules.json';\n    try {\n      await migrateJsonToBackend(jsonPath, this.backend);\n    } catch (err) {\n      logger.warn(\n        `[ScheduleStore] JSON migration failed (non-fatal): ${\n          err instanceof Error ? err.message : err\n        }`\n      );\n    }\n\n    this.initialized = true;\n  }\n\n  /**\n   * Create a new schedule (async, persists immediately)\n   */\n  async createAsync(\n    schedule: Omit<Schedule, 'id' | 'createdAt' | 'runCount' | 'failureCount' | 'status'>\n  ): Promise<Schedule> {\n    const backend = this.getBackend();\n    await backend.validateLimits(schedule.creatorId, schedule.isRecurring, this.limits);\n    return backend.create(schedule);\n  }\n\n  /**\n   * Get a schedule by ID\n   */\n  async getAsync(id: string): Promise<Schedule | undefined> {\n    return this.getBackend().get(id);\n  }\n\n  /**\n   * Update a schedule\n   */\n  async updateAsync(id: string, patch: Partial<Schedule>): Promise<Schedule | undefined> {\n    return this.getBackend().update(id, patch);\n  }\n\n  /**\n   * Delete a schedule\n   */\n  async deleteAsync(id: string): Promise<boolean> {\n    return this.getBackend().delete(id);\n  }\n\n  /**\n   * Get all schedules for a specific creator\n   */\n  async getByCreatorAsync(creatorId: string): Promise<Schedule[]> {\n    return this.getBackend().getByCreator(creatorId);\n  }\n\n  /**\n   * Get all active schedules\n   */\n  async getActiveSchedulesAsync(): Promise<Schedule[]> {\n    return this.getBackend().getActiveSchedules();\n  }\n\n  /**\n   * Get all schedules due for execution\n   * @param now Current timestamp in milliseconds\n   */\n  async getDueSchedulesAsync(now: number = Date.now()): Promise<Schedule[]> {\n    return this.getBackend().getDueSchedules(now);\n  }\n\n  /**\n   * Find schedules by workflow name\n   */\n  async findByWorkflowAsync(creatorId: string, workflowName: string): Promise<Schedule[]> {\n    return this.getBackend().findByWorkflow(creatorId, workflowName);\n  }\n\n  /**\n   * Get schedule count statistics\n   */\n  async getStatsAsync(): Promise<ScheduleStoreStats> {\n    return this.getBackend().getStats();\n  }\n\n  /**\n   * Force immediate save (useful for shutdown)\n   */\n  async flush(): Promise<void> {\n    if (this.backend) {\n      await this.backend.flush();\n    }\n  }\n\n  /**\n   * Check if initialized\n   */\n  isInitialized(): boolean {\n    return this.initialized;\n  }\n\n  /**\n   * Check if there are unsaved changes\n   */\n  hasPendingChanges(): boolean {\n    return false; // SQL backends persist immediately\n  }\n\n  /**\n   * Get all schedules\n   */\n  async getAllAsync(): Promise<Schedule[]> {\n    return this.getBackend().getAll();\n  }\n\n  /**\n   * Get the underlying backend (for HA lock operations)\n   */\n  getBackend(): ScheduleStoreBackend {\n    if (!this.backend) {\n      throw new Error('[ScheduleStore] Not initialized. Call initialize() first.');\n    }\n    return this.backend;\n  }\n\n  /**\n   * Shut down the backend cleanly\n   */\n  async shutdown(): Promise<void> {\n    if (this.backend) {\n      await this.backend.shutdown();\n      this.backend = null;\n    }\n    this.initialized = false;\n  }\n}\n","/**\n * Schedule parsing utilities\n * Note: Natural language parsing is handled by the AI which generates\n * cron expressions or ISO timestamps directly. This module provides\n * validation and helper functions.\n */\n\n/**\n * Parsed schedule result\n */\nexport interface ParsedSchedule {\n  type: 'one-time' | 'recurring';\n  cronExpression?: string; // For recurring schedules\n  runAt?: Date; // For one-time schedules\n  timezone: string;\n  description: string; // Human-readable description\n}\n\n/**\n * Day of week mapping for cron expressions\n */\nconst DAYS_OF_WEEK: Record<string, number> = {\n  sunday: 0,\n  sun: 0,\n  monday: 1,\n  mon: 1,\n  tuesday: 2,\n  tue: 2,\n  wednesday: 3,\n  wed: 3,\n  thursday: 4,\n  thu: 4,\n  friday: 5,\n  fri: 5,\n  saturday: 6,\n  sat: 6,\n};\n\n/**\n * Recurring pattern detection\n */\ninterface RecurringPattern {\n  frequency:\n    | 'minute'\n    | 'hourly'\n    | 'daily'\n    | 'weekly'\n    | 'monthly'\n    | 'yearly'\n    | 'weekday'\n    | 'weekend';\n  daysOfWeek?: number[];\n  dayOfMonth?: number;\n  hour?: number;\n  minute?: number;\n  interval?: number;\n}\n\n/**\n * Parse a natural language schedule expression\n *\n * @param expression Natural language time expression (e.g., \"every Monday at 9am\", \"in 2 hours\")\n * @param userTimezone IANA timezone string (e.g., \"America/New_York\")\n * @param referenceDate Optional reference date for parsing (defaults to now)\n * @returns Parsed schedule information\n */\nexport function parseScheduleExpression(\n  expression: string,\n  userTimezone: string = 'UTC',\n  _referenceDate?: Date\n): ParsedSchedule {\n  const trimmedExpr = expression.trim();\n  const normalizedExpr = trimmedExpr.toLowerCase();\n\n  // First check if it's a standard cron expression (5 space-separated parts)\n  if (isValidCronExpression(trimmedExpr)) {\n    return {\n      type: 'recurring',\n      cronExpression: trimmedExpr,\n      timezone: userTimezone,\n      description: describeCronExpression(trimmedExpr),\n    };\n  }\n\n  // Check for natural language recurring patterns\n  const recurring = detectRecurringPattern(normalizedExpr);\n  if (recurring) {\n    const cronExpr = buildCronExpression(recurring);\n    return {\n      type: 'recurring',\n      cronExpression: cronExpr,\n      timezone: userTimezone,\n      description: buildRecurringDescription(recurring),\n    };\n  }\n\n  // Try to parse as ISO 8601 timestamp for one-time schedules\n  const isoDate = new Date(expression);\n  if (!isNaN(isoDate.getTime())) {\n    // Valid ISO date\n    if (isoDate.getTime() <= Date.now()) {\n      throw new Error(`Schedule time must be in the future: \"${expression}\"`);\n    }\n    return {\n      type: 'one-time',\n      runAt: isoDate,\n      timezone: userTimezone,\n      description: formatOneTimeDescription(isoDate),\n    };\n  }\n\n  // Could not parse - provide helpful error\n  throw new Error(\n    `Could not parse schedule expression: \"${expression}\". ` +\n      `Use a cron expression (e.g., \"0 9 * * 1\" for Monday 9am) or ISO timestamp (e.g., \"2026-02-08T15:00:00Z\").`\n  );\n}\n\n/**\n * Detect recurring patterns in the expression\n */\nfunction detectRecurringPattern(expr: string): RecurringPattern | null {\n  // Check for keywords that indicate recurring schedules\n  if (\n    !expr.includes('every') &&\n    !expr.includes('daily') &&\n    !expr.includes('weekly') &&\n    !expr.includes('monthly')\n  ) {\n    return null;\n  }\n\n  // Extract time component\n  const timeMatch = expr.match(/at\\s+(\\d{1,2})(?::(\\d{2}))?\\s*(am|pm)?/i);\n  let hour: number | undefined;\n  let minute: number | undefined;\n\n  if (timeMatch) {\n    hour = parseInt(timeMatch[1], 10);\n    minute = timeMatch[2] ? parseInt(timeMatch[2], 10) : 0;\n\n    // Convert to 24-hour format\n    const ampm = timeMatch[3]?.toLowerCase();\n    if (ampm === 'pm' && hour !== 12) {\n      hour += 12;\n    } else if (ampm === 'am' && hour === 12) {\n      hour = 0;\n    }\n  } else {\n    // Check for special times\n    if (expr.includes('noon')) {\n      hour = 12;\n      minute = 0;\n    } else if (expr.includes('midnight')) {\n      hour = 0;\n      minute = 0;\n    } else if (expr.includes('morning')) {\n      hour = 9;\n      minute = 0;\n    } else if (expr.includes('evening')) {\n      hour = 18;\n      minute = 0;\n    }\n  }\n\n  // Every minute (singular, no number)\n  if (expr.match(/every\\s+minute\\b/i) && !expr.match(/every\\s+\\d+\\s+minute/i)) {\n    return {\n      frequency: 'minute',\n      interval: 1,\n      minute: 0,\n    };\n  }\n\n  // Every hour (singular, no number)\n  if (expr.match(/every\\s+hour\\b/i) && !expr.match(/every\\s+\\d+\\s+hour/i)) {\n    return {\n      frequency: 'hourly',\n      interval: 1,\n      minute: minute ?? 0,\n    };\n  }\n\n  // Every N minutes/hours\n  const intervalMatch = expr.match(/every\\s+(\\d+)\\s+(minute|hour)s?/i);\n  if (intervalMatch) {\n    const interval = parseInt(intervalMatch[1], 10);\n    const unit = intervalMatch[2].toLowerCase();\n\n    if (unit === 'minute') {\n      return {\n        frequency: 'minute',\n        interval,\n        minute: 0,\n      };\n    } else {\n      return {\n        frequency: 'hourly',\n        interval,\n        minute: minute ?? 0,\n      };\n    }\n  }\n\n  // Every day / daily\n  if (expr.includes('every day') || expr.includes('daily')) {\n    return {\n      frequency: 'daily',\n      hour: hour ?? 9,\n      minute: minute ?? 0,\n    };\n  }\n\n  // Every weekday\n  if (\n    expr.includes('weekday') ||\n    (expr.includes('monday') && expr.includes('friday') && expr.includes('through'))\n  ) {\n    return {\n      frequency: 'weekday',\n      hour: hour ?? 9,\n      minute: minute ?? 0,\n    };\n  }\n\n  // Every weekend\n  if (expr.includes('weekend')) {\n    return {\n      frequency: 'weekend',\n      hour: hour ?? 10,\n      minute: minute ?? 0,\n    };\n  }\n\n  // Monthly - check before day of week to avoid false matches\n  if (expr.includes('monthly') || expr.includes('every month')) {\n    const dayOfMonthMatch = expr.match(/(?:on the\\s+)?(\\d{1,2})(?:st|nd|rd|th)?/);\n    const dayOfMonth = dayOfMonthMatch ? parseInt(dayOfMonthMatch[1], 10) : 1;\n    return {\n      frequency: 'monthly',\n      dayOfMonth,\n      hour: hour ?? 9,\n      minute: minute ?? 0,\n    };\n  }\n\n  // Weekly on specific day(s)\n  if (expr.includes('weekly') || expr.includes('every week')) {\n    // Default to Monday if no day specified\n    const daysOfWeek = extractDaysOfWeek(expr);\n    return {\n      frequency: 'weekly',\n      daysOfWeek: daysOfWeek.length > 0 ? daysOfWeek : [1],\n      hour: hour ?? 9,\n      minute: minute ?? 0,\n    };\n  }\n\n  // Every [day of week]\n  const daysOfWeek = extractDaysOfWeek(expr);\n  if (daysOfWeek.length > 0) {\n    return {\n      frequency: 'weekly',\n      daysOfWeek,\n      hour: hour ?? 9,\n      minute: minute ?? 0,\n    };\n  }\n\n  // If we detected \"every\" but couldn't parse the pattern, default to daily\n  if (expr.includes('every')) {\n    return {\n      frequency: 'daily',\n      hour: hour ?? 9,\n      minute: minute ?? 0,\n    };\n  }\n\n  return null;\n}\n\n/**\n * Extract days of week from expression\n */\nfunction extractDaysOfWeek(expr: string): number[] {\n  const days: Set<number> = new Set();\n\n  for (const [dayName, dayNum] of Object.entries(DAYS_OF_WEEK)) {\n    if (expr.includes(dayName)) {\n      days.add(dayNum);\n    }\n  }\n\n  return Array.from(days).sort((a, b) => a - b);\n}\n\n/**\n * Build a cron expression from a recurring pattern\n *\n * Cron format: minute hour day-of-month month day-of-week\n */\nfunction buildCronExpression(pattern: RecurringPattern): string {\n  const minute = pattern.minute ?? 0;\n  const hour = pattern.hour ?? 9;\n\n  switch (pattern.frequency) {\n    case 'minute':\n      // Every N minutes\n      if (pattern.interval && pattern.interval > 1) {\n        return `*/${pattern.interval} * * * *`;\n      }\n      return '* * * * *';\n\n    case 'hourly':\n      // Every N hours\n      if (pattern.interval && pattern.interval > 1) {\n        return `${minute} */${pattern.interval} * * *`;\n      }\n      return `${minute} * * * *`;\n\n    case 'daily':\n      return `${minute} ${hour} * * *`;\n\n    case 'weekday':\n      return `${minute} ${hour} * * 1-5`;\n\n    case 'weekend':\n      return `${minute} ${hour} * * 0,6`;\n\n    case 'weekly':\n      const days = pattern.daysOfWeek?.join(',') ?? '1';\n      return `${minute} ${hour} * * ${days}`;\n\n    case 'monthly':\n      const dayOfMonth = pattern.dayOfMonth ?? 1;\n      return `${minute} ${hour} ${dayOfMonth} * *`;\n\n    case 'yearly':\n      return `${minute} ${hour} 1 1 *`;\n\n    default:\n      return `${minute} ${hour} * * *`;\n  }\n}\n\n/**\n * Build a human-readable description for recurring schedules\n */\nfunction buildRecurringDescription(pattern: RecurringPattern): string {\n  const timeStr = formatTime(pattern.hour ?? 9, pattern.minute ?? 0);\n\n  switch (pattern.frequency) {\n    case 'minute':\n      if (pattern.interval && pattern.interval > 1) {\n        return `Every ${pattern.interval} minutes`;\n      }\n      return 'Every minute';\n\n    case 'hourly':\n      if (pattern.interval && pattern.interval > 1) {\n        return `Every ${pattern.interval} hours at :${String(pattern.minute ?? 0).padStart(2, '0')}`;\n      }\n      return `Every hour at :${String(pattern.minute ?? 0).padStart(2, '0')}`;\n\n    case 'daily':\n      return `Daily at ${timeStr}`;\n\n    case 'weekday':\n      return `Weekdays at ${timeStr}`;\n\n    case 'weekend':\n      return `Weekends at ${timeStr}`;\n\n    case 'weekly':\n      const dayNames = (pattern.daysOfWeek ?? [1])\n        .map(d => Object.entries(DAYS_OF_WEEK).find(([, v]) => v === d)?.[0] ?? String(d))\n        .map(n => n.charAt(0).toUpperCase() + n.slice(1, 3));\n      return `Every ${dayNames.join(', ')} at ${timeStr}`;\n\n    case 'monthly':\n      return `Monthly on the ${ordinal(pattern.dayOfMonth ?? 1)} at ${timeStr}`;\n\n    case 'yearly':\n      return `Yearly on January 1st at ${timeStr}`;\n\n    default:\n      return `At ${timeStr}`;\n  }\n}\n\n/**\n * Format time in 12-hour format\n */\nfunction formatTime(hour: number, minute: number): string {\n  const h = hour % 12 || 12;\n  const m = String(minute).padStart(2, '0');\n  const ampm = hour >= 12 ? 'PM' : 'AM';\n  return `${h}:${m} ${ampm}`;\n}\n\n/**\n * Format a one-time schedule description\n */\nfunction formatOneTimeDescription(date: Date): string {\n  const now = new Date();\n  const diffMs = date.getTime() - now.getTime();\n  const diffMins = Math.round(diffMs / 60000);\n  const diffHours = Math.round(diffMs / 3600000);\n  const diffDays = Math.round(diffMs / 86400000);\n\n  // Format the actual time\n  const timeStr = date.toLocaleTimeString('en-US', {\n    hour: 'numeric',\n    minute: '2-digit',\n    hour12: true,\n  });\n\n  // Format the date\n  const dateOptions: Intl.DateTimeFormatOptions = {\n    weekday: 'long',\n    month: 'short',\n    day: 'numeric',\n  };\n\n  if (date.getFullYear() !== now.getFullYear()) {\n    dateOptions.year = 'numeric';\n  }\n\n  const dateStr = date.toLocaleDateString('en-US', dateOptions);\n\n  // Add relative time if within 24 hours\n  if (diffMins < 60) {\n    return `In ${diffMins} minute${diffMins !== 1 ? 's' : ''} (${dateStr} at ${timeStr})`;\n  } else if (diffHours < 24) {\n    return `In ${diffHours} hour${diffHours !== 1 ? 's' : ''} (${dateStr} at ${timeStr})`;\n  } else if (diffDays === 1) {\n    return `Tomorrow at ${timeStr}`;\n  } else if (diffDays < 7) {\n    return `${dateStr} at ${timeStr}`;\n  }\n\n  return `${dateStr} at ${timeStr}`;\n}\n\n/**\n * Calculate the next run time for a cron expression\n */\nexport function getNextRunTime(cronExpression: string, _timezone: string = 'UTC'): Date {\n  // Note: Full timezone support would require a library like luxon or date-fns-tz\n  // For now, calculations are done in local time\n  // Simple cron parser for next run calculation\n  // For production, consider using a library like 'cron-parser'\n  const parts = cronExpression.split(' ');\n  if (parts.length !== 5) {\n    throw new Error(`Invalid cron expression: ${cronExpression}`);\n  }\n\n  const [minute, hour, dayOfMonth, month, dayOfWeek] = parts;\n  const now = new Date();\n\n  // Start from the next minute\n  const next = new Date(now);\n  next.setSeconds(0, 0);\n  next.setMinutes(next.getMinutes() + 1);\n\n  // Try to find the next matching time (within 1 year)\n  const maxAttempts = 365 * 24 * 60; // 1 year of minutes\n  for (let i = 0; i < maxAttempts; i++) {\n    if (\n      matchesCronPart(next.getMinutes(), minute) &&\n      matchesCronPart(next.getHours(), hour) &&\n      matchesCronPart(next.getDate(), dayOfMonth) &&\n      matchesCronPart(next.getMonth() + 1, month) &&\n      matchesCronPart(next.getDay(), dayOfWeek)\n    ) {\n      return next;\n    }\n    next.setMinutes(next.getMinutes() + 1);\n  }\n\n  // Fallback to tomorrow at the specified time\n  const fallback = new Date(now);\n  fallback.setDate(fallback.getDate() + 1);\n  fallback.setHours(parseInt(hour, 10) || 9);\n  fallback.setMinutes(parseInt(minute, 10) || 0);\n  fallback.setSeconds(0, 0);\n  return fallback;\n}\n\n/**\n * Check if a value matches a cron part\n */\nfunction matchesCronPart(value: number, cronPart: string): boolean {\n  if (cronPart === '*') return true;\n\n  // Handle step values (*/n)\n  if (cronPart.startsWith('*/')) {\n    const step = parseInt(cronPart.slice(2), 10);\n    return value % step === 0;\n  }\n\n  // Handle ranges (n-m)\n  if (cronPart.includes('-')) {\n    const [start, end] = cronPart.split('-').map(n => parseInt(n, 10));\n    return value >= start && value <= end;\n  }\n\n  // Handle lists (n,m,o)\n  if (cronPart.includes(',')) {\n    return cronPart\n      .split(',')\n      .map(n => parseInt(n, 10))\n      .includes(value);\n  }\n\n  // Handle exact value\n  return parseInt(cronPart, 10) === value;\n}\n\n/**\n * Get ordinal suffix for a number\n */\nfunction ordinal(n: number): string {\n  const s = ['th', 'st', 'nd', 'rd'];\n  const v = n % 100;\n  return n + (s[(v - 20) % 10] || s[v] || s[0]);\n}\n\n/**\n * Validate a cron expression\n */\nexport function isValidCronExpression(expr: string): boolean {\n  if (!expr || typeof expr !== 'string') return false;\n\n  const parts = expr.trim().split(/\\s+/);\n  if (parts.length !== 5) return false;\n\n  const ranges: [number, number][] = [\n    [0, 59], // minute\n    [0, 23], // hour\n    [1, 31], // day of month\n    [1, 12], // month\n    [0, 7], // day of week (0 and 7 are Sunday)\n  ];\n\n  return parts.every((part, i) => {\n    if (part === '*') return true;\n    if (part.startsWith('*/')) {\n      const step = parseInt(part.slice(2), 10);\n      return !isNaN(step) && step > 0;\n    }\n    if (part.includes('-')) {\n      const [start, end] = part.split('-').map(n => parseInt(n, 10));\n      return !isNaN(start) && !isNaN(end) && start >= ranges[i][0] && end <= ranges[i][1];\n    }\n    if (part.includes(',')) {\n      return part.split(',').every(n => {\n        const val = parseInt(n, 10);\n        return !isNaN(val) && val >= ranges[i][0] && val <= ranges[i][1];\n      });\n    }\n    const val = parseInt(part, 10);\n    return !isNaN(val) && val >= ranges[i][0] && val <= ranges[i][1];\n  });\n}\n\n/**\n * Generate a human-readable description for a cron expression\n */\nfunction describeCronExpression(cronExpr: string): string {\n  const parts = cronExpr.trim().split(/\\s+/);\n  if (parts.length !== 5) return `Cron: ${cronExpr}`;\n\n  const [minute, hour, dayOfMonth, month, dayOfWeek] = parts;\n  const descriptions: string[] = [];\n\n  // Time description\n  if (minute === '*' && hour === '*') {\n    descriptions.push('Every minute');\n  } else if (minute.startsWith('*/')) {\n    const interval = parseInt(minute.slice(2), 10);\n    descriptions.push(`Every ${interval} minute${interval > 1 ? 's' : ''}`);\n  } else if (hour.startsWith('*/')) {\n    const interval = parseInt(hour.slice(2), 10);\n    const m = minute === '*' ? 0 : parseInt(minute, 10);\n    descriptions.push(\n      `Every ${interval} hour${interval > 1 ? 's' : ''} at :${String(m).padStart(2, '0')}`\n    );\n  } else {\n    const h = hour === '*' ? null : parseInt(hour, 10);\n    const m = minute === '*' ? 0 : parseInt(minute, 10);\n    if (h !== null) {\n      descriptions.push(`At ${formatTime(h, m)}`);\n    } else {\n      descriptions.push(`At :${String(m).padStart(2, '0')}`);\n    }\n  }\n\n  // Day of week description\n  if (dayOfWeek !== '*') {\n    const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n    if (dayOfWeek === '1-5') {\n      descriptions.push('on weekdays');\n    } else if (dayOfWeek === '0,6' || dayOfWeek === '6,0') {\n      descriptions.push('on weekends');\n    } else if (dayOfWeek.includes(',')) {\n      const days = dayOfWeek.split(',').map(d => dayNames[parseInt(d, 10) % 7]);\n      descriptions.push(`on ${days.join(', ')}`);\n    } else if (dayOfWeek.includes('-')) {\n      const [start, end] = dayOfWeek.split('-').map(d => parseInt(d, 10) % 7);\n      descriptions.push(`on ${dayNames[start]}-${dayNames[end]}`);\n    } else {\n      const dayNum = parseInt(dayOfWeek, 10) % 7;\n      descriptions.push(`on ${dayNames[dayNum]}`);\n    }\n  }\n\n  // Day of month description\n  if (dayOfMonth !== '*' && dayOfWeek === '*') {\n    if (dayOfMonth.includes(',')) {\n      const days = dayOfMonth.split(',');\n      descriptions.push(`on day${days.length > 1 ? 's' : ''} ${days.join(', ')} of the month`);\n    } else {\n      descriptions.push(`on day ${dayOfMonth} of the month`);\n    }\n  }\n\n  // Month description\n  if (month !== '*') {\n    const monthNames = [\n      '',\n      'Jan',\n      'Feb',\n      'Mar',\n      'Apr',\n      'May',\n      'Jun',\n      'Jul',\n      'Aug',\n      'Sep',\n      'Oct',\n      'Nov',\n      'Dec',\n    ];\n    if (month.includes(',')) {\n      const months = month.split(',').map(m => monthNames[parseInt(m, 10)]);\n      descriptions.push(`in ${months.join(', ')}`);\n    } else {\n      descriptions.push(`in ${monthNames[parseInt(month, 10)]}`);\n    }\n  }\n\n  return descriptions.join(' ');\n}\n","/**\n * Generic AI Tool for scheduling and managing workflow executions\n * This tool is frontend-agnostic and can work with any context (Slack, CLI, GitHub, etc.)\n */\nimport { CustomToolDefinition } from '../types/config';\nimport { ScheduleStore, Schedule, ScheduleOutputContext } from './schedule-store';\nimport { isValidCronExpression, getNextRunTime } from './schedule-parser';\nimport { logger } from '../logger';\n\n/**\n * Simple glob-style pattern matching for workflow names\n * Supports * (any characters) and ? (single character)\n */\nfunction matchGlobPattern(pattern: string, value: string): boolean {\n  // Escape regex special chars except * and ?\n  const regexPattern = pattern\n    .replace(/[.+^${}()|[\\]\\\\]/g, '\\\\$&')\n    .replace(/\\*/g, '.*')\n    .replace(/\\?/g, '.');\n  return new RegExp(`^${regexPattern}$`).test(value);\n}\n\n/**\n * Check if a workflow is allowed by patterns\n */\nfunction isWorkflowAllowedByPatterns(\n  workflow: string,\n  allowedPatterns?: string[],\n  deniedPatterns?: string[]\n): { allowed: boolean; reason?: string } {\n  // If denied patterns exist and workflow matches any, deny\n  if (deniedPatterns && deniedPatterns.length > 0) {\n    for (const pattern of deniedPatterns) {\n      if (matchGlobPattern(pattern, workflow)) {\n        return {\n          allowed: false,\n          reason: `Workflow \"${workflow}\" matches denied pattern \"${pattern}\"`,\n        };\n      }\n    }\n  }\n\n  // If allowed patterns exist, workflow must match at least one\n  if (allowedPatterns && allowedPatterns.length > 0) {\n    for (const pattern of allowedPatterns) {\n      if (matchGlobPattern(pattern, workflow)) {\n        return { allowed: true };\n      }\n    }\n    return {\n      allowed: false,\n      reason: `Workflow \"${workflow}\" does not match any allowed patterns: ${allowedPatterns.join(', ')}`,\n    };\n  }\n\n  // No patterns defined - allow by default\n  return { allowed: true };\n}\n\n/**\n * Check permissions for creating a schedule\n */\nfunction checkSchedulePermissions(\n  context: ScheduleToolContext,\n  workflow: string,\n  requestedScheduleType?: ScheduleType\n): { allowed: boolean; reason?: string } {\n  const permissions = context.permissions;\n  const scheduleType = requestedScheduleType || context.scheduleType || 'personal';\n\n  // Enforce context-based restrictions first\n  // From a DM, can only create personal schedules\n  // From a channel, can only create channel schedules\n  // From a group DM, can only create dm/group schedules\n  if (context.allowedScheduleType && scheduleType !== context.allowedScheduleType) {\n    const contextNames: Record<ScheduleType, string> = {\n      personal: 'a direct message (DM)',\n      channel: 'a channel',\n      dm: 'a group DM',\n    };\n    const targetNames: Record<ScheduleType, string> = {\n      personal: 'personal',\n      channel: 'channel',\n      dm: 'group',\n    };\n    return {\n      allowed: false,\n      reason: `From ${contextNames[context.allowedScheduleType]}, you can only create ${targetNames[context.allowedScheduleType]} schedules. To create a ${targetNames[scheduleType]} schedule, please use the appropriate context.`,\n    };\n  }\n\n  // No permissions configured - allow everything (backwards compatible)\n  if (!permissions) {\n    return { allowed: true };\n  }\n\n  // Check schedule type permission\n  switch (scheduleType) {\n    case 'personal':\n      if (permissions.allowPersonal === false) {\n        return {\n          allowed: false,\n          reason: 'Personal schedules are not allowed in this configuration',\n        };\n      }\n      break;\n    case 'channel':\n      if (permissions.allowChannel === false) {\n        return {\n          allowed: false,\n          reason: 'Channel schedules are not allowed in this configuration',\n        };\n      }\n      break;\n    case 'dm':\n      if (permissions.allowDm === false) {\n        return {\n          allowed: false,\n          reason: 'DM schedules are not allowed in this configuration',\n        };\n      }\n      break;\n  }\n\n  // Check workflow patterns\n  return isWorkflowAllowedByPatterns(\n    workflow,\n    permissions.allowedWorkflows,\n    permissions.deniedWorkflows\n  );\n}\n\n/**\n * Tool action types\n */\nexport type ScheduleAction = 'create' | 'list' | 'cancel' | 'pause' | 'resume';\n\n/**\n * Target type for where to send the reminder/output\n */\nexport type TargetType = 'channel' | 'dm' | 'thread' | 'user';\n\n/**\n * Tool input arguments - AI provides structured data, no parsing needed\n */\nexport interface ScheduleToolArgs {\n  action: ScheduleAction;\n\n  // For create action - AI extracts and structures all of this:\n  /** What to say/do when the schedule fires */\n  reminder_text?: string;\n  /** Where to send: channel, dm (to self), thread, or user (DM to specific user) */\n  target_type?: TargetType;\n  /** The Slack channel ID (C... for channels, D... for DMs) */\n  target_id?: string;\n  /** For thread replies: the thread_ts to reply to */\n  thread_ts?: string;\n  /** Is this a recurring schedule? */\n  is_recurring?: boolean;\n  /** For recurring: cron expression (AI generates this, e.g., \"* * * * *\" for every minute) */\n  cron?: string;\n  /** For one-time: ISO 8601 timestamp when to run */\n  run_at?: string;\n  /** Original natural language expression (for display only) */\n  original_expression?: string;\n  /** Optional workflow to run instead of just sending reminder_text */\n  workflow?: string;\n  /** Optional workflow inputs */\n  workflow_inputs?: Record<string, unknown>;\n\n  // For cancel/pause/resume actions:\n  schedule_id?: string;\n}\n\n/**\n * Schedule type for permission checking\n */\nexport type ScheduleType = 'personal' | 'channel' | 'dm';\n\n/**\n * Permissions configuration for dynamic schedules\n */\nexport interface SchedulePermissions {\n  /** Allow personal schedules (via DM or CLI) */\n  allowPersonal?: boolean;\n  /** Allow channel schedules (in Slack channels) */\n  allowChannel?: boolean;\n  /** Allow DM schedules (to specific users) */\n  allowDm?: boolean;\n  /** List of allowed workflow patterns (glob-style, e.g., \"report-*\") */\n  allowedWorkflows?: string[];\n  /** List of denied workflow patterns */\n  deniedWorkflows?: string[];\n}\n\n/**\n * Context passed to the tool handler\n * This is generic and works with any frontend\n */\nexport interface ScheduleToolContext {\n  /** Generic user ID (can be Slack user, GitHub user, CLI user, etc.) */\n  userId: string;\n  /** User display name (optional) */\n  userName?: string;\n  /** Context identifier: \"slack:U123\", \"github:user\", \"cli\", etc. */\n  contextType: string;\n  /** User's timezone (IANA format) */\n  timezone?: string;\n  /** Available workflows in the current config */\n  availableWorkflows?: string[];\n  /** Schedule type being created (for permission checking) */\n  scheduleType?: ScheduleType;\n  /** Permissions for dynamic schedule creation */\n  permissions?: SchedulePermissions;\n  /**\n   * Allowed schedule type based on originating context.\n   * When set, only schedules of this type can be created/managed.\n   * - From DM: only 'personal' allowed\n   * - From channel: only 'channel' allowed\n   * - From group DM: only 'dm' allowed (targeting the group)\n   */\n  allowedScheduleType?: ScheduleType;\n}\n\n/**\n * Tool execution result\n */\nexport interface ScheduleToolResult {\n  success: boolean;\n  message: string;\n  schedule?: Schedule;\n  schedules?: Schedule[];\n  error?: string;\n}\n\n/**\n * Format a schedule for display\n */\nfunction formatSchedule(schedule: Schedule): string {\n  const time = schedule.isRecurring\n    ? schedule.originalExpression\n    : new Date(schedule.runAt!).toLocaleString();\n  const status = schedule.status !== 'active' ? ` (${schedule.status})` : '';\n  // For simple reminders, show the reminder text; for workflows, show the workflow name\n  const displayName =\n    schedule.workflow || (schedule.workflowInputs?.text as string) || 'scheduled message';\n  const truncatedName =\n    displayName.length > 30 ? displayName.substring(0, 27) + '...' : displayName;\n  const output = schedule.outputContext?.type || 'none';\n\n  return `\\`${schedule.id.substring(0, 8)}\\` - \"${truncatedName}\" - ${time} (â†’ ${output})${status}`;\n}\n\n/**\n * Format confirmation message for a new schedule\n */\nfunction formatCreateConfirmation(schedule: Schedule): string {\n  const outputDesc = schedule.outputContext?.type\n    ? `${schedule.outputContext.type}${schedule.outputContext.target ? `:${schedule.outputContext.target}` : ''}`\n    : 'none';\n\n  // For simple reminders, show the reminder text; for workflows, show the workflow name\n  const displayName =\n    schedule.workflow || (schedule.workflowInputs?.text as string) || 'scheduled message';\n\n  if (schedule.isRecurring) {\n    const nextRun = schedule.nextRunAt\n      ? new Date(schedule.nextRunAt).toLocaleString('en-US', {\n          weekday: 'long',\n          month: 'short',\n          day: 'numeric',\n          hour: 'numeric',\n          minute: '2-digit',\n        })\n      : 'calculating...';\n\n    return `**Schedule created!**\n\n**${schedule.workflow ? 'Workflow' : 'Reminder'}**: ${displayName}\n**When**: ${schedule.originalExpression}\n**Output**: ${outputDesc}\n**Next run**: ${nextRun}\n\nID: \\`${schedule.id.substring(0, 8)}\\``;\n  } else {\n    const when = new Date(schedule.runAt!).toLocaleString('en-US', {\n      weekday: 'long',\n      month: 'short',\n      day: 'numeric',\n      hour: 'numeric',\n      minute: '2-digit',\n    });\n\n    return `**Schedule created!**\n\n**${schedule.workflow ? 'Workflow' : 'Reminder'}**: ${displayName}\n**When**: ${when}\n**Output**: ${outputDesc}\n\nID: \\`${schedule.id.substring(0, 8)}\\``;\n  }\n}\n\n/**\n * Format the list of schedules\n */\nfunction formatScheduleList(schedules: Schedule[]): string {\n  if (schedules.length === 0) {\n    return `You don't have any active schedules.\n\nTo create one: \"remind me every Monday at 9am to check PRs\" or \"schedule %daily-report every Monday at 9am\"`;\n  }\n\n  const lines = schedules.map((s, i) => `${i + 1}. ${formatSchedule(s)}`);\n\n  return `**Your active schedules:**\n\n${lines.join('\\n')}\n\nTo cancel: \"cancel schedule <id>\"\nTo pause: \"pause schedule <id>\"`;\n}\n\n/**\n * Handle schedule tool actions\n */\nexport async function handleScheduleAction(\n  args: ScheduleToolArgs,\n  context: ScheduleToolContext\n): Promise<ScheduleToolResult> {\n  const store = ScheduleStore.getInstance();\n\n  // Ensure store is initialized\n  if (!store.isInitialized()) {\n    await store.initialize();\n  }\n\n  switch (args.action) {\n    case 'create':\n      return handleCreate(args, context, store);\n\n    case 'list':\n      return handleList(context, store);\n\n    case 'cancel':\n      return handleCancel(args, context, store);\n\n    case 'pause':\n      return handlePauseResume(args, context, store, 'paused');\n\n    case 'resume':\n      return handlePauseResume(args, context, store, 'active');\n\n    default:\n      return {\n        success: false,\n        message: `Unknown action: ${args.action}`,\n        error: `Supported actions: create, list, cancel, pause, resume`,\n      };\n  }\n}\n\n/**\n * Handle create action - AI provides structured data, minimal parsing needed\n */\nasync function handleCreate(\n  args: ScheduleToolArgs,\n  context: ScheduleToolContext,\n  store: ScheduleStore\n): Promise<ScheduleToolResult> {\n  // Validate: need either reminder_text or workflow\n  if (!args.reminder_text && !args.workflow) {\n    return {\n      success: false,\n      message: 'Missing reminder content',\n      error: 'Please specify either reminder_text (what to say) or workflow (what to run)',\n    };\n  }\n\n  // Validate: need either cron (recurring) or run_at (one-time)\n  if (!args.cron && !args.run_at) {\n    return {\n      success: false,\n      message: 'Missing schedule timing',\n      error:\n        'Please specify either cron (for recurring, e.g., \"* * * * *\") or run_at (ISO timestamp for one-time)',\n    };\n  }\n\n  // Validate cron format if provided\n  if (args.cron && !isValidCronExpression(args.cron)) {\n    return {\n      success: false,\n      message: 'Invalid cron expression',\n      error: `\"${args.cron}\" is not a valid cron expression. Format: \"minute hour day-of-month month day-of-week\"`,\n    };\n  }\n\n  // Validate run_at format if provided\n  let runAtTimestamp: number | undefined;\n  if (args.run_at) {\n    const parsed = new Date(args.run_at);\n    if (isNaN(parsed.getTime())) {\n      return {\n        success: false,\n        message: 'Invalid run_at timestamp',\n        error: `\"${args.run_at}\" is not a valid ISO 8601 timestamp`,\n      };\n    }\n    if (parsed.getTime() <= Date.now()) {\n      return {\n        success: false,\n        message: 'run_at must be in the future',\n        error: 'Cannot schedule a reminder in the past',\n      };\n    }\n    runAtTimestamp = parsed.getTime();\n  }\n\n  // Validate target_id is provided when target_type is specified\n  if (args.target_type && !args.target_id) {\n    return {\n      success: false,\n      message: 'Missing target_id',\n      error: `target_type \"${args.target_type}\" requires a target_id (channel ID, user ID, or thread_ts)`,\n    };\n  }\n\n  // Determine schedule type from target\n  // 'channel' -> channel schedule, 'user' -> dm schedule, 'dm' or 'thread' -> personal\n  let scheduleType: ScheduleType = 'personal';\n  if (args.target_type === 'channel') {\n    scheduleType = 'channel';\n  } else if (args.target_type === 'user') {\n    scheduleType = 'dm'; // Sending to a specific user is a DM schedule\n  }\n\n  // Check permissions\n  const workflowName = args.workflow || 'reminder';\n  const permissionCheck = checkSchedulePermissions(context, workflowName, scheduleType);\n  if (!permissionCheck.allowed) {\n    logger.warn(\n      `[ScheduleTool] Permission denied for user ${context.userId}: ${permissionCheck.reason}`\n    );\n    return {\n      success: false,\n      message: 'Permission denied',\n      error: permissionCheck.reason || 'You do not have permission to create this schedule',\n    };\n  }\n\n  // Validate workflow exists if specified and we have available workflows\n  if (\n    args.workflow &&\n    context.availableWorkflows &&\n    !context.availableWorkflows.includes(args.workflow)\n  ) {\n    return {\n      success: false,\n      message: `Workflow \"${args.workflow}\" not found`,\n      error: `Available workflows: ${context.availableWorkflows.slice(0, 5).join(', ')}${context.availableWorkflows.length > 5 ? '...' : ''}`,\n    };\n  }\n\n  try {\n    const timezone = context.timezone || 'UTC';\n    const isRecurring = args.is_recurring === true || !!args.cron;\n\n    // Build output context from AI-provided target info\n    let outputContext: ScheduleOutputContext | undefined;\n    if (args.target_type && args.target_id) {\n      outputContext = {\n        type: 'slack', // Currently only Slack supported\n        target: args.target_id, // Channel ID (C... or D...)\n        threadId: args.thread_ts, // Thread timestamp for replies\n        metadata: {\n          targetType: args.target_type,\n          reminderText: args.reminder_text,\n        },\n      };\n    }\n\n    // Calculate next run time\n    let nextRunAt: number | undefined;\n    if (isRecurring && args.cron) {\n      nextRunAt = getNextRunTime(args.cron, timezone).getTime();\n    } else if (runAtTimestamp) {\n      nextRunAt = runAtTimestamp;\n    }\n\n    // Create the schedule - AI has done all the parsing\n    // workflow is only set when explicitly provided (e.g., from YAML cron jobs)\n    // For simple reminders, workflow is undefined and scheduler posts text directly\n    const schedule = await store.createAsync({\n      creatorId: context.userId,\n      creatorContext: context.contextType,\n      creatorName: context.userName,\n      timezone,\n      schedule: args.cron || '',\n      runAt: runAtTimestamp,\n      isRecurring,\n      originalExpression: args.original_expression || args.cron || args.run_at || '',\n      workflow: args.workflow, // Only set if explicitly provided\n      workflowInputs:\n        args.workflow_inputs || (args.reminder_text ? { text: args.reminder_text } : undefined),\n      outputContext,\n      nextRunAt,\n    });\n\n    const displayText = args.reminder_text || args.workflow || 'scheduled task';\n    logger.info(\n      `[ScheduleTool] Created schedule ${schedule.id} for user ${context.userId}: \"${displayText}\"`\n    );\n\n    return {\n      success: true,\n      message: formatCreateConfirmation(schedule),\n      schedule,\n    };\n  } catch (error) {\n    const errorMsg = error instanceof Error ? error.message : 'Unknown error';\n    logger.warn(`[ScheduleTool] Failed to create schedule: ${errorMsg}`);\n\n    return {\n      success: false,\n      message: `Failed to create schedule: ${errorMsg}`,\n      error: errorMsg,\n    };\n  }\n}\n\n/**\n * Handle list action\n * Users can only see their own schedules to protect privacy\n */\nasync function handleList(\n  context: ScheduleToolContext,\n  store: ScheduleStore\n): Promise<ScheduleToolResult> {\n  // Only show schedules created by this user - protects privacy of personal schedules\n  const allUserSchedules = await store.getByCreatorAsync(context.userId);\n  const schedules = allUserSchedules.filter(s => s.status !== 'completed');\n\n  // If in a specific context, optionally filter to show only relevant schedules\n  let filteredSchedules = schedules;\n  if (context.allowedScheduleType) {\n    // Map schedule output context to schedule type for filtering\n    filteredSchedules = schedules.filter(s => {\n      const scheduleOutputType = s.outputContext?.type;\n      if (!scheduleOutputType || scheduleOutputType === 'none') {\n        return context.allowedScheduleType === 'personal';\n      }\n      if (scheduleOutputType === 'slack') {\n        const target = s.outputContext?.target || '';\n        if (target.startsWith('#') || target.match(/^C[A-Z0-9]+$/)) {\n          return context.allowedScheduleType === 'channel';\n        }\n        if (target.startsWith('@') || target.match(/^U[A-Z0-9]+$/)) {\n          return context.allowedScheduleType === 'dm';\n        }\n      }\n      return context.allowedScheduleType === 'personal';\n    });\n  }\n\n  return {\n    success: true,\n    message: formatScheduleList(filteredSchedules),\n    schedules: filteredSchedules,\n  };\n}\n\n/**\n * Handle cancel action\n * Only the creator can cancel their own schedules\n */\nasync function handleCancel(\n  args: ScheduleToolArgs,\n  context: ScheduleToolContext,\n  store: ScheduleStore\n): Promise<ScheduleToolResult> {\n  // Try to find by ID - only search in user's own schedules\n  let schedule: Schedule | undefined;\n\n  if (args.schedule_id) {\n    // Only search in schedules created by this user\n    const userSchedules = await store.getByCreatorAsync(context.userId);\n\n    // Try exact match first\n    schedule = userSchedules.find(s => s.id === args.schedule_id);\n\n    // Try partial ID match (first 8 chars)\n    if (!schedule) {\n      schedule = userSchedules.find(s => s.id.startsWith(args.schedule_id!));\n    }\n  }\n\n  if (!schedule) {\n    return {\n      success: false,\n      message: 'Schedule not found',\n      error: `Could not find schedule with ID \"${args.schedule_id}\" in your schedules. Use \"list my schedules\" to see your schedules.`,\n    };\n  }\n\n  // Double-check ownership (defensive - already filtered above)\n  if (schedule.creatorId !== context.userId) {\n    logger.warn(\n      `[ScheduleTool] Attempted cross-user schedule cancellation: ${context.userId} tried to cancel ${schedule.id} owned by ${schedule.creatorId}`\n    );\n    return {\n      success: false,\n      message: 'Not your schedule',\n      error: 'You can only cancel your own schedules.',\n    };\n  }\n\n  // Delete the schedule\n  await store.deleteAsync(schedule.id);\n\n  logger.info(`[ScheduleTool] Cancelled schedule ${schedule.id} for user ${context.userId}`);\n\n  return {\n    success: true,\n    message: `**Schedule cancelled!**\n\nWas: \"${schedule.workflow}\" scheduled for ${schedule.originalExpression}`,\n  };\n}\n\n/**\n * Handle pause/resume actions\n * Only the creator can pause/resume their own schedules\n */\nasync function handlePauseResume(\n  args: ScheduleToolArgs,\n  context: ScheduleToolContext,\n  store: ScheduleStore,\n  newStatus: 'active' | 'paused'\n): Promise<ScheduleToolResult> {\n  if (!args.schedule_id) {\n    return {\n      success: false,\n      message: 'Missing schedule ID',\n      error: 'Please specify which schedule to pause/resume.',\n    };\n  }\n\n  // Only search in schedules created by this user\n  const userSchedules = await store.getByCreatorAsync(context.userId);\n\n  // Try exact match first\n  let schedule = userSchedules.find(s => s.id === args.schedule_id);\n\n  // Try partial ID match (first 8 chars)\n  if (!schedule) {\n    schedule = userSchedules.find(s => s.id.startsWith(args.schedule_id!));\n  }\n\n  if (!schedule) {\n    return {\n      success: false,\n      message: 'Schedule not found',\n      error: `Could not find schedule with ID \"${args.schedule_id}\" in your schedules.`,\n    };\n  }\n\n  // Double-check ownership (defensive - already filtered above)\n  if (schedule.creatorId !== context.userId) {\n    logger.warn(\n      `[ScheduleTool] Attempted cross-user schedule modification: ${context.userId} tried to modify ${schedule.id} owned by ${schedule.creatorId}`\n    );\n    return {\n      success: false,\n      message: 'Not your schedule',\n      error: 'You can only modify your own schedules.',\n    };\n  }\n\n  // Update status\n  const updated = await store.updateAsync(schedule.id, { status: newStatus });\n\n  const action = newStatus === 'paused' ? 'paused' : 'resumed';\n  logger.info(`[ScheduleTool] ${action} schedule ${schedule.id} for user ${context.userId}`);\n\n  return {\n    success: true,\n    message: `**Schedule ${action}!**\n\n\"${schedule.workflow}\" - ${schedule.originalExpression}`,\n    schedule: updated,\n  };\n}\n\n/**\n * Get the schedule tool definition for registration with AI providers\n *\n * The AI is responsible for:\n * 1. Extracting the target (channel ID, user ID, thread_ts) from the conversation context\n * 2. Determining if the schedule is recurring or one-time\n * 3. Generating the cron expression OR ISO timestamp\n * 4. Extracting the reminder text or workflow name\n */\nexport function getScheduleToolDefinition(): CustomToolDefinition {\n  return {\n    name: 'schedule',\n    description: `Schedule, list, and manage reminders or workflow executions.\n\nYOU (the AI) must extract and structure all scheduling parameters. Do NOT pass natural language time expressions - convert them to cron or ISO timestamps.\n\nCRITICAL WORKFLOW RULE:\n- To schedule a WORKFLOW, the user MUST use a '%' prefix (e.g., \"schedule %my-workflow daily\").\n- If the '%' prefix is present, extract the word following it as the 'workflow' parameter (without the '%').\n- If the '%' prefix is NOT present, the request is a simple text reminder. The ENTIRE user request (excluding the schedule expression) MUST be placed in the 'reminder_text' parameter.\n- DO NOT guess or infer a workflow name from a user's request without the '%' prefix.\n\nACTIONS:\n- create: Schedule a new reminder or workflow\n- list: Show user's active schedules\n- cancel: Remove a schedule by ID\n- pause/resume: Temporarily disable/enable a schedule\n\nFOR CREATE ACTION - Extract these from user's request:\n1. WHAT:\n   - If user says \"schedule %some-workflow ...\", populate 'workflow' with \"some-workflow\".\n   - Otherwise, populate 'reminder_text' with the user's full request text.\n2. WHERE: Use the CURRENT channel from context\n   - target_id: The channel ID from context (C... for channels, D... for DMs)\n   - target_type: \"channel\" for public/private channels, \"dm\" for direct messages\n   - ONLY use target_type=\"thread\" with thread_ts if user is INSIDE a thread\n   - When NOT in a thread, reminders post as NEW messages (not thread replies)\n3. WHEN: Either cron (for recurring) OR run_at (ISO 8601 for one-time)\n   - Recurring: Generate cron expression (minute hour day-of-month month day-of-week)\n   - One-time: Generate ISO 8601 timestamp\n\nCRON EXAMPLES:\n- \"every minute\" â†’ cron: \"* * * * *\"\n- \"every hour\" â†’ cron: \"0 * * * *\"\n- \"every day at 9am\" â†’ cron: \"0 9 * * *\"\n- \"every Monday at 9am\" â†’ cron: \"0 9 * * 1\"\n- \"weekdays at 8:30am\" â†’ cron: \"30 8 * * 1-5\"\n- \"every 5 minutes\" â†’ cron: \"*/5 * * * *\"\n\nONE-TIME EXAMPLES:\n- \"in 2 hours\" â†’ run_at: \"<ISO timestamp 2 hours from now>\"\n- \"tomorrow at 3pm\" â†’ run_at: \"2026-02-08T15:00:00Z\"\n\nUSAGE EXAMPLES:\n\nUser in DM: \"remind me to check builds every day at 9am\"\nâ†’ {\n    \"action\": \"create\",\n    \"reminder_text\": \"check builds\",\n    \"is_recurring\": true,\n    \"cron\": \"0 9 * * *\",\n    \"target_type\": \"dm\",\n    \"target_id\": \"<DM channel ID from context, e.g., D09SZABNLG3>\",\n    \"original_expression\": \"every day at 9am\"\n  }\n\nUser in #security channel: \"schedule %security-scan every Monday at 10am\"\nâ†’ {\n    \"action\": \"create\",\n    \"workflow\": \"security-scan\",\n    \"is_recurring\": true,\n    \"cron\": \"0 10 * * 1\",\n    \"target_type\": \"channel\",\n    \"target_id\": \"<channel ID from context, e.g., C05ABC123>\",\n    \"original_expression\": \"every Monday at 10am\"\n  }\n\nUser in #security channel: \"run security-scan every Monday at 10am\" (NO % prefix!)\nâ†’ {\n    \"action\": \"create\",\n    \"reminder_text\": \"run security-scan every Monday at 10am\",\n    \"is_recurring\": true,\n    \"cron\": \"0 10 * * 1\",\n    \"target_type\": \"channel\",\n    \"target_id\": \"<channel ID from context, e.g., C05ABC123>\",\n    \"original_expression\": \"every Monday at 10am\"\n  }\n\nUser in DM: \"remind me in 2 hours to review the PR\"\nâ†’ {\n    \"action\": \"create\",\n    \"reminder_text\": \"review the PR\",\n    \"is_recurring\": false,\n    \"run_at\": \"2026-02-07T18:00:00Z\",\n    \"target_type\": \"dm\",\n    \"target_id\": \"<DM channel ID from context>\",\n    \"original_expression\": \"in 2 hours\"\n  }\n\nUser inside a thread: \"remind me about this tomorrow\"\nâ†’ {\n    \"action\": \"create\",\n    \"reminder_text\": \"Check this thread\",\n    \"is_recurring\": false,\n    \"run_at\": \"2026-02-08T09:00:00Z\",\n    \"target_type\": \"thread\",\n    \"target_id\": \"<channel ID>\",\n    \"thread_ts\": \"<thread_ts from context>\",\n    \"original_expression\": \"tomorrow\"\n  }\n\nUser: \"list my schedules\"\nâ†’ { \"action\": \"list\" }\n\nUser: \"cancel schedule abc123\"\nâ†’ { \"action\": \"cancel\", \"schedule_id\": \"abc123\" }`,\n    inputSchema: {\n      type: 'object',\n      properties: {\n        action: {\n          type: 'string',\n          enum: ['create', 'list', 'cancel', 'pause', 'resume'],\n          description: 'What to do: create new, list existing, cancel/pause/resume by ID',\n        },\n        // WHAT to do\n        reminder_text: {\n          type: 'string',\n          description: 'For create: the message/reminder text to send when triggered',\n        },\n        workflow: {\n          type: 'string',\n          description:\n            'For create: workflow ID to run. ONLY populate this if the user used the % prefix (e.g., \"%my-workflow\"). Extract the name without the % symbol. If no % prefix, use reminder_text instead.',\n        },\n        workflow_inputs: {\n          type: 'object',\n          description: 'For create: optional inputs to pass to the workflow',\n        },\n        // WHERE to send\n        target_type: {\n          type: 'string',\n          enum: ['channel', 'dm', 'thread', 'user'],\n          description:\n            'For create: where to send output. channel=public/private channel, dm=DM to self (current DM channel), user=DM to specific user, thread=reply in current thread',\n        },\n        target_id: {\n          type: 'string',\n          description:\n            'For create: Slack channel ID. Channels start with C, DMs start with D. Always use the channel ID from the current context.',\n        },\n        thread_ts: {\n          type: 'string',\n          description:\n            'For create with target_type=thread: the thread timestamp to reply to. Get this from the current thread context.',\n        },\n        // WHEN to run\n        is_recurring: {\n          type: 'boolean',\n          description:\n            'For create: true for recurring schedules (cron), false for one-time (run_at)',\n        },\n        cron: {\n          type: 'string',\n          description:\n            'For create recurring: cron expression (minute hour day-of-month month day-of-week). Examples: \"0 9 * * *\" (daily 9am), \"* * * * *\" (every minute), \"0 9 * * 1\" (Mondays 9am)',\n        },\n        run_at: {\n          type: 'string',\n          description:\n            'For create one-time: ISO 8601 timestamp when to run (e.g., \"2026-02-07T15:00:00Z\")',\n        },\n        original_expression: {\n          type: 'string',\n          description:\n            'For create: the original natural language expression from user (for display only)',\n        },\n        // For cancel/pause/resume\n        schedule_id: {\n          type: 'string',\n          description:\n            'For cancel/pause/resume: the schedule ID to act on (first 8 chars is enough)',\n        },\n      },\n      required: ['action'],\n    },\n    exec: '', // Not used - this tool has a custom handler\n  };\n}\n\n/**\n * Check if this is the schedule tool and should be handled specially\n */\nexport function isScheduleTool(toolName: string): boolean {\n  return toolName === 'schedule';\n}\n\n/**\n * Determine schedule type from context\n */\nfunction determineScheduleType(\n  contextType: string,\n  outputType?: 'slack' | 'github' | 'webhook' | 'none',\n  outputTarget?: string\n): ScheduleType {\n  // If output is to a Slack channel (starts with # or C), it's a channel schedule\n  if (outputType === 'slack' && outputTarget) {\n    if (outputTarget.startsWith('#') || outputTarget.match(/^C[A-Z0-9]+$/)) {\n      return 'channel';\n    }\n    // If output is to a Slack user (starts with @ or U), it's a DM schedule\n    if (outputTarget.startsWith('@') || outputTarget.match(/^U[A-Z0-9]+$/)) {\n      return 'dm';\n    }\n  }\n\n  // CLI and GitHub are personal schedules\n  if (contextType === 'cli' || contextType.startsWith('github:')) {\n    return 'personal';\n  }\n\n  // Default to personal for Slack DM context\n  return 'personal';\n}\n\n/**\n * Map Slack channel type to allowed schedule type\n */\nfunction slackChannelTypeToScheduleType(channelType: 'channel' | 'dm' | 'group'): ScheduleType {\n  switch (channelType) {\n    case 'channel':\n      return 'channel';\n    case 'group':\n      return 'dm'; // Group DMs map to 'dm' schedule type\n    case 'dm':\n    default:\n      return 'personal';\n  }\n}\n\n/**\n * Build schedule tool context from various sources\n */\nexport function buildScheduleToolContext(\n  sources: {\n    slackContext?: {\n      userId: string;\n      userName?: string;\n      timezone?: string;\n      channelType?: 'channel' | 'dm' | 'group';\n    };\n    cliContext?: { userId?: string };\n    githubContext?: { login: string };\n  },\n  availableWorkflows?: string[],\n  permissions?: SchedulePermissions,\n  outputInfo?: { outputType?: 'slack' | 'github' | 'webhook' | 'none'; outputTarget?: string }\n): ScheduleToolContext {\n  // Prefer Slack context, then GitHub, then CLI\n  if (sources.slackContext) {\n    const contextType = `slack:${sources.slackContext.userId}`;\n    const scheduleType = determineScheduleType(\n      contextType,\n      outputInfo?.outputType,\n      outputInfo?.outputTarget\n    );\n\n    // Determine allowed schedule type based on originating Slack context\n    // This enforces that from a DM you can only create personal schedules, etc.\n    let allowedScheduleType: ScheduleType | undefined;\n    if (sources.slackContext.channelType) {\n      allowedScheduleType = slackChannelTypeToScheduleType(sources.slackContext.channelType);\n    }\n\n    // Override schedule type based on Slack channel type if no explicit output\n    let finalScheduleType = scheduleType;\n    if (!outputInfo?.outputType && sources.slackContext.channelType) {\n      finalScheduleType = slackChannelTypeToScheduleType(sources.slackContext.channelType);\n    }\n\n    return {\n      userId: sources.slackContext.userId,\n      userName: sources.slackContext.userName,\n      contextType,\n      timezone: sources.slackContext.timezone,\n      availableWorkflows,\n      scheduleType: finalScheduleType,\n      permissions,\n      allowedScheduleType,\n    };\n  }\n\n  if (sources.githubContext) {\n    return {\n      userId: sources.githubContext.login,\n      contextType: `github:${sources.githubContext.login}`,\n      timezone: 'UTC', // GitHub doesn't provide timezone\n      availableWorkflows,\n      scheduleType: 'personal',\n      permissions,\n      allowedScheduleType: 'personal', // GitHub context only allows personal schedules\n    };\n  }\n\n  // CLI/default context\n  return {\n    userId: sources.cliContext?.userId || process.env.USER || 'cli-user',\n    contextType: 'cli',\n    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone || 'UTC',\n    availableWorkflows,\n    scheduleType: 'personal',\n    permissions,\n    allowedScheduleType: 'personal', // CLI context only allows personal schedules\n  };\n}\n","/**\n * Init State Handler\n *\n * Responsibilities:\n * - Validate configuration\n * - Initialize services (journal, memory, GitHub checks)\n * - Transition to PlanReady\n */\n\nimport type { EngineContext, RunState, EngineState } from '../../types/engine';\nimport { logger } from '../../logger';\n\nexport async function handleInit(\n  context: EngineContext,\n  state: RunState,\n  transition: (newState: EngineState) => void\n): Promise<void> {\n  if (context.debug) {\n    logger.info('[Init] Initializing state machine...');\n  }\n\n  // Validate configuration\n  if (!context.config) {\n    throw new Error('Configuration is required');\n  }\n\n  // Initialize memory store if needed\n  if (context.memory) {\n    await context.memory.initialize();\n  }\n\n  // Initialize GitHub checks if configured\n  if (context.gitHubChecks) {\n    // GitHub check initialization happens in the main engine\n    // We just validate it's available here\n    if (context.debug) {\n      logger.info('[Init] GitHub checks service available');\n    }\n  }\n\n  // Reset journal for this session\n  if (context.debug) {\n    logger.info(`[Init] Session ID: ${context.sessionId}`);\n  }\n\n  // Transition to PlanReady\n  transition('PlanReady');\n}\n","/**\n * PlanReady State Handler\n *\n * Responsibilities:\n * - Build dependency graph using DependencyResolver\n * - Validate graph (check for cycles)\n * - Compute check metadata (tags, sessions, triggers)\n * - Transition to WavePlanning\n */\n\nimport type { EngineContext, RunState, EngineState } from '../../types/engine';\nimport { DependencyResolver } from '../../dependency-resolver';\nimport { logger } from '../../logger';\n\nexport async function handlePlanReady(\n  context: EngineContext,\n  state: RunState,\n  transition: (newState: EngineState) => void\n): Promise<void> {\n  if (context.debug) {\n    logger.info('[PlanReady] Building dependency graph...');\n    if (context.requestedChecks) {\n      logger.info(`[PlanReady] Requested checks: ${context.requestedChecks.join(', ')}`);\n    }\n    if (context.config.tag_filter) {\n      logger.info(\n        `[PlanReady] Tag filter: include=${JSON.stringify(context.config.tag_filter.include)}, exclude=${JSON.stringify(context.config.tag_filter.exclude)}`\n      );\n    } else {\n      logger.info('[PlanReady] No tag filter specified - will include only untagged checks');\n    }\n  }\n\n  // Filter checks based on requested checks list, event triggers, and tags BEFORE building dependency graph\n  //\n  // Filtering order (matches legacy engine):\n  // 1. Explicit check list (requestedChecks) - if provided, expand with transitive dependencies first\n  // 2. Event filtering: Only include checks where:\n  //    - checkConfig.on is undefined (runs on any event), OR\n  //    - checkConfig.on includes context.event\n  // 3. Tag filtering (matches legacy engine behavior):\n  //    - When no tag filter is specified, include only untagged checks by default\n  //    - Tagged checks are opt-in unless tag_filter is provided\n  //    - If exclude tags specified, exclude checks with any matching tag\n  //    - If include tags specified, include checks with at least one matching tag OR untagged checks\n  const eventTrigger = context.event;\n  const tagFilter = context.config.tag_filter;\n\n  // Expand requested checks with transitive dependencies (matches legacy engine)\n  const expandWithTransitives = (rootChecks: string[]): Set<string> | null => {\n    const expanded = new Set<string>(rootChecks);\n\n    const allowByTags = (checkId: string): boolean => {\n      if (!tagFilter) return true;\n      const cfg = context.config.checks?.[checkId];\n      const tags: string[] = cfg?.tags || [];\n      if (tagFilter.exclude && tagFilter.exclude.some(t => tags.includes(t))) return false;\n      if (tagFilter.include && tagFilter.include.length > 0) {\n        return tagFilter.include.some(t => tags.includes(t));\n      }\n      return true;\n    };\n\n    const allowByEvent = (checkId: string): boolean => {\n      const cfg = context.config.checks?.[checkId];\n      const triggers = cfg?.on || [];\n      if (!triggers || triggers.length === 0) return true;\n      const current = eventTrigger || 'manual';\n      return triggers.includes(current as any);\n    };\n\n    const visit = (checkId: string): string | null => {\n      const cfg = context.config.checks?.[checkId];\n      if (!cfg || !cfg.depends_on) return null;\n\n      const depTokens = Array.isArray(cfg.depends_on) ? cfg.depends_on : [cfg.depends_on];\n      const expandDep = (tok: string): string[] => {\n        if (tok.includes('|')) {\n          return tok\n            .split('|')\n            .map(s => s.trim())\n            .filter(Boolean);\n        }\n        return [tok];\n      };\n\n      const deps = depTokens.flatMap(expandDep);\n      for (const depId of deps) {\n        // Check if dependency exists - if not, return error\n        if (!context.config.checks?.[depId]) {\n          return `Check \"${checkId}\" depends on \"${depId}\" but \"${depId}\" is not defined`;\n        }\n        if (!allowByTags(depId)) continue;\n        if (!allowByEvent(depId)) continue;\n        if (!expanded.has(depId)) {\n          expanded.add(depId);\n          const err = visit(depId);\n          if (err) return err;\n        }\n      }\n      return null;\n    };\n\n    for (const checkId of rootChecks) {\n      const err = visit(checkId);\n      if (err) {\n        // Record validation error\n        const validationIssue: any = {\n          file: 'system',\n          line: 0,\n          message: err,\n          category: 'logic',\n          severity: 'error',\n          ruleId: 'system/error',\n        };\n\n        context.journal.commitEntry({\n          sessionId: context.sessionId,\n          scope: [],\n          checkId: 'system',\n          result: {\n            issues: [validationIssue],\n            output: undefined,\n          },\n        });\n\n        return null; // Signal error by returning null\n      }\n    }\n\n    return expanded;\n  };\n\n  const requestedChecksSet = context.requestedChecks\n    ? expandWithTransitives(context.requestedChecks)\n    : undefined;\n\n  // Check if dependency validation failed during expansion\n  if (context.requestedChecks && requestedChecksSet === null) {\n    logger.error(`[PlanReady] Dependency validation failed during expansion`);\n    // Transition to Completed since error was already recorded\n    state.currentState = 'Completed';\n    return;\n  }\n\n  if (context.debug && requestedChecksSet && context.requestedChecks) {\n    const added = Array.from(requestedChecksSet).filter(c => !context.requestedChecks!.includes(c));\n    if (added.length > 0) {\n      logger.info(\n        `[PlanReady] Expanded requested checks with transitive dependencies: ${added.join(', ')}`\n      );\n    }\n  }\n\n  const filteredChecks: Record<string, import('../../types/config').CheckConfig> = {};\n\n  // Identify checks that are only meant to run via routing (on_* .run targets).\n  // These should not be part of the initial graph unless explicitly requested.\n  const routingRunTargets = new Set<string>();\n  for (const [, cfg] of Object.entries(context.config.checks || {})) {\n    const onFinish = (cfg as any).on_finish || {};\n    const onSuccess = (cfg as any).on_success || {};\n    const onFail = (cfg as any).on_fail || {};\n    const collect = (arr?: string[]) => {\n      if (Array.isArray(arr)) {\n        for (const t of arr) if (typeof t === 'string' && t) routingRunTargets.add(t);\n      }\n    };\n    collect(onFinish.run);\n    collect(onSuccess.run);\n    collect(onFail.run);\n  }\n\n  for (const [checkId, checkConfig] of Object.entries(context.config.checks || {})) {\n    // 1. Filter by explicit check list (if provided, now includes transitive dependencies)\n    if (requestedChecksSet && !requestedChecksSet.has(checkId)) {\n      if (context.debug) {\n        logger.info(\n          `[PlanReady] Skipping check '${checkId}': not in expanded requested checks list`\n        );\n      }\n      continue;\n    }\n    // 1b. Exclude checks that are intended to be started by routing (run targets)\n    // unless they were explicitly requested. This avoids running aggregators/routers\n    // at wave 0; they will be scheduled by ForwardRunRequested from on_* handlers.\n    if (!requestedChecksSet && routingRunTargets.has(checkId)) {\n      if (context.debug) {\n        logger.info(\n          `[PlanReady] Skipping check '${checkId}': routing-run target (will be scheduled by on_*.run)`\n        );\n      }\n      continue;\n    }\n    // Check if event trigger matches (same logic as event-mapper.ts shouldRunCheck)\n    // If 'on' is not specified, the check can run on any event\n    if (checkConfig.on && eventTrigger && !checkConfig.on.includes(eventTrigger)) {\n      if (context.debug) {\n        logger.info(\n          `[PlanReady] Skipping check '${checkId}': on=${JSON.stringify(checkConfig.on)}, event=${eventTrigger}`\n        );\n      }\n      continue;\n    }\n\n    // Tag filtering (matches legacy CheckExecutionEngine.filterChecksByTags logic)\n    const checkTags = checkConfig.tags || [];\n    const isTagged = checkTags.length > 0;\n\n    if (tagFilter) {\n      // Check exclude tags first (if any exclude tag matches, skip the check)\n      if (tagFilter.exclude && tagFilter.exclude.length > 0) {\n        const hasExcludedTag = tagFilter.exclude.some(tag => checkTags.includes(tag));\n        if (hasExcludedTag) {\n          if (context.debug) {\n            logger.info(`[PlanReady] Skipping check '${checkId}': excluded by tag filter`);\n          }\n          continue;\n        }\n      }\n\n      // Check include tags (if specified, at least one must match OR check is untagged)\n      if (tagFilter.include && tagFilter.include.length > 0) {\n        const hasIncludedTag = tagFilter.include.some(tag => checkTags.includes(tag));\n        if (!hasIncludedTag && isTagged) {\n          if (context.debug) {\n            logger.info(`[PlanReady] Skipping check '${checkId}': not included by tag filter`);\n          }\n          continue;\n        }\n      }\n    } else {\n      // No tag filter specified: include only untagged checks by default\n      // Tagged checks are opt-in unless tag_filter is provided\n      if (isTagged) {\n        if (context.debug) {\n          logger.info(\n            `[PlanReady] Skipping check '${checkId}': tagged but no tag filter specified`\n          );\n        }\n        continue;\n      }\n    }\n\n    filteredChecks[checkId] = checkConfig;\n  }\n\n  if (context.debug) {\n    const totalChecks = Object.keys(context.config.checks || {}).length;\n    const filteredCount = Object.keys(filteredChecks).length;\n    logger.info(\n      `[PlanReady] Filtered ${totalChecks} checks to ${filteredCount} based on event=${eventTrigger}`\n    );\n  }\n\n  // Forward-closure across dependents is useful when running â€œallâ€ checks with no explicit roots,\n  // but it must NOT run when the caller provided an explicit requested list (tests that expect\n  // only a subset would be surprised). Only apply this when no requestedChecks are set.\n  if (!context.requestedChecks || context.requestedChecks.length === 0) {\n    const dependentsMap = new Map<string, string[]>();\n    for (const [cid, cfg] of Object.entries(context.config.checks || {})) {\n      const deps = (cfg.depends_on || []) as string[];\n      const depList = Array.isArray(deps) ? deps : [deps];\n      for (const raw of depList) {\n        if (typeof raw !== 'string') continue;\n        const tokens = raw.includes('|')\n          ? raw\n              .split('|')\n              .map(s => s.trim())\n              .filter(Boolean)\n          : [raw];\n        for (const dep of tokens) {\n          if (!dependentsMap.has(dep)) dependentsMap.set(dep, []);\n          dependentsMap.get(dep)!.push(cid);\n        }\n      }\n    }\n\n    const queue: string[] = Object.keys(filteredChecks);\n    const seenForward = new Set(queue);\n    while (queue.length > 0) {\n      const cur = queue.shift()!;\n      const kids = dependentsMap.get(cur) || [];\n      for (const child of kids) {\n        if (seenForward.has(child)) continue;\n        // Only add child if it passes event/tag filtering (reuse policy)\n        const cfg = context.config.checks?.[child];\n        if (!cfg) continue;\n        if (cfg.on && eventTrigger && !cfg.on.includes(eventTrigger)) continue;\n        const tags = cfg.tags || [];\n        const isTagged = tags.length > 0;\n        if (!tagFilter && isTagged) continue;\n        if (tagFilter) {\n          if (tagFilter.exclude && tagFilter.exclude.length > 0) {\n            const hasExcluded = tagFilter.exclude.some(t => tags.includes(t));\n            if (hasExcluded) continue;\n          }\n          if (tagFilter.include && tagFilter.include.length > 0) {\n            const hasIncluded = tagFilter.include.some(t => tags.includes(t));\n            if (!hasIncluded && isTagged) continue;\n          }\n        }\n        filteredChecks[child] = cfg;\n        seenForward.add(child);\n        queue.push(child);\n        if (context.debug)\n          logger.info(`[PlanReady] Added dependent '${child}' via forward-closure from '${cur}'`);\n      }\n    }\n  }\n\n  // Helper to check if dependencies are satisfied\n  // For OR dependencies (pipe syntax), at least one must be in filteredChecks\n  const areDependenciesSatisfied = (dependencies: string[]): boolean => {\n    for (const dep of dependencies) {\n      // Check for OR dependency (pipe syntax)\n      if (dep.includes('|')) {\n        const orOptions = dep\n          .split('|')\n          .map(s => s.trim())\n          .filter(Boolean);\n        // At least one option must exist in filtered checks\n        const hasAtLeastOne = orOptions.some(opt => filteredChecks[opt] !== undefined);\n        if (!hasAtLeastOne) {\n          return false;\n        }\n      } else {\n        // Regular dependency - must exist in filtered checks\n        if (filteredChecks[dep] === undefined) {\n          return false;\n        }\n      }\n    }\n    return true;\n  };\n\n  // Second pass: Remove checks whose dependencies are not satisfied\n  // Note: When tag filtering is active, we allow soft dependencies - checks can run\n  // even if some dependencies are filtered out by tags. They just won't have those outputs.\n  const finalChecks: Record<string, import('../../types/config').CheckConfig> = {};\n  for (const [checkId, checkConfig] of Object.entries(filteredChecks)) {\n    const depRaw = (checkConfig as any).depends_on as unknown;\n    const dependencies: string[] = Array.isArray(depRaw)\n      ? (depRaw as string[])\n      : typeof depRaw === 'string'\n        ? [depRaw]\n        : [];\n\n    // Only enforce dependency satisfaction when NO tag filter is active\n    // When tag filtering is active, allow checks to run with partial dependencies (soft dependencies)\n    if (dependencies.length > 0 && !tagFilter && !areDependenciesSatisfied(dependencies)) {\n      if (context.debug) {\n        logger.info(\n          `[PlanReady] Skipping check '${checkId}': unsatisfied dependencies ${JSON.stringify(dependencies)}`\n        );\n      }\n      continue;\n    }\n    finalChecks[checkId] = checkConfig;\n  }\n\n  if (context.debug && Object.keys(finalChecks).length !== Object.keys(filteredChecks).length) {\n    logger.info(\n      `[PlanReady] Removed ${Object.keys(filteredChecks).length - Object.keys(finalChecks).length} checks due to unsatisfied dependencies`\n    );\n  }\n\n  // Extract dependencies from final filtered check configurations\n  const checkDependencies: Record<string, string[]> = {};\n\n  for (const [checkId, checkConfig] of Object.entries(finalChecks)) {\n    // Expand OR groups (pipe syntax) for dependency resolution\n    // For OR groups, only include options that exist in finalChecks\n    // e.g., \"issue-assistant|comment-assistant\" becomes [\"comment-assistant\"] if issue-assistant was filtered out\n    // For regular dependencies, also filter to only include checks that exist (soft dependencies when tag filtering)\n    const depsRaw2 = (checkConfig as any).depends_on as unknown;\n    const depList: string[] = Array.isArray(depsRaw2)\n      ? (depsRaw2 as string[])\n      : typeof depsRaw2 === 'string'\n        ? [depsRaw2]\n        : [];\n    const dependencies = depList.flatMap((d: string) => {\n      if (typeof d === 'string' && d.includes('|')) {\n        // OR dependency - filter to only include available checks\n        const orOptions = d\n          .split('|')\n          .map(s => s.trim())\n          .filter(Boolean)\n          .filter(opt => finalChecks[opt] !== undefined); // Only include if check exists\n        return orOptions;\n      } else {\n        // Regular dependency - when tag filtering is active, filter to only available checks (soft dependencies)\n        // When no tag filtering, include all dependencies (validation happens in graph builder)\n        if (tagFilter && finalChecks[d] === undefined) {\n          if (context.debug) {\n            logger.info(\n              `[PlanReady] Soft dependency '${d}' of check '${checkId}' filtered out by tags - check will run without it`\n            );\n          }\n          return []; // Filter out unavailable dependency\n        }\n        return [d];\n      }\n    });\n    checkDependencies[checkId] = dependencies;\n  }\n\n  // Build dependency graph\n  let graph;\n  try {\n    graph = DependencyResolver.buildDependencyGraph(checkDependencies);\n  } catch (error) {\n    const errorMsg = error instanceof Error ? error.message : String(error);\n    logger.error(`[PlanReady] Dependency validation failed: ${errorMsg}`);\n\n    // Record validation error as an issue\n    const validationIssue: any = {\n      file: 'system',\n      line: 0,\n      message: errorMsg,\n      category: 'logic',\n      severity: 'error',\n      ruleId: 'system/error',\n    };\n\n    // Record in journal as a system check\n    context.journal.commitEntry({\n      sessionId: context.sessionId,\n      scope: [],\n      checkId: 'system',\n      result: {\n        issues: [validationIssue],\n        output: undefined,\n      },\n    });\n\n    // Transition to Completed\n    state.currentState = 'Completed';\n    return;\n  }\n\n  // Validate graph - check for cycles\n  if (graph.hasCycles) {\n    const cycleNodes = graph.cycleNodes?.join(' -> ') || 'unknown';\n    const errorMsg = `Dependency cycle detected: ${cycleNodes}`;\n    logger.error(`[PlanReady] ${errorMsg}`);\n\n    // Record cycle error as an issue\n    const cycleIssue: any = {\n      file: 'system',\n      line: 0,\n      message: errorMsg,\n      category: 'logic',\n      severity: 'error',\n      ruleId: 'system/error',\n    };\n\n    // Record in journal as a system check\n    context.journal.commitEntry({\n      sessionId: context.sessionId,\n      scope: [],\n      checkId: 'system',\n      result: {\n        issues: [cycleIssue],\n        output: undefined,\n      },\n    });\n\n    // Transition to Completed\n    state.currentState = 'Completed';\n    return;\n  }\n\n  if (context.debug) {\n    logger.info(\n      `[PlanReady] Graph built with ${graph.nodes.size} checks, ${graph.executionOrder.length} levels`\n    );\n  }\n\n  // Store graph in context (mutate for now, can refactor later)\n  (context as any).dependencyGraph = graph;\n\n  // Initialize wave 0\n  state.wave = 0;\n\n  // Transition to WavePlanning\n  transition('WavePlanning');\n}\n","/**\n * WavePlanning State Handler\n *\n * Responsibilities:\n * - Inspect event queue for forward runs, goto events, etc.\n * - Determine next wave's execution levels\n * - Queue topological levels for execution\n * - Transition to LevelDispatch or Completed\n *\n * M2: Adds goto/on_finish/on_fail routing with deduplication\n */\n\nimport type { EngineContext, RunState, EngineState, EngineEvent } from '../../types/engine';\nimport { logger } from '../../logger';\nimport { DependencyResolver } from '../../dependency-resolver';\n\nexport async function handleWavePlanning(\n  context: EngineContext,\n  state: RunState,\n  transition: (newState: EngineState) => void\n): Promise<void> {\n  if (context.debug) {\n    logger.info(`[WavePlanning] Planning wave ${state.wave}...`);\n  }\n\n  // Reset forward-run active flag at the beginning of each planning cycle.\n  // It will be set to true only when we schedule a wave spawned by a forward-run request.\n  try {\n    (state as any).flags = (state as any).flags || {};\n    (state as any).flags.forwardRunActive = false;\n  } catch {}\n\n  // If a previous level hit an \"awaiting human input\" checkpoint (e.g. Slack\n  // human-input in pause mode), terminate execution cleanly instead of\n  // continuing to schedule downstream checks or forward-run waves.\n  try {\n    const flags = (state as any).flags || {};\n    logger.info(\n      `[WavePlanning] Checking awaitingHumanInput flag: ${!!flags.awaitingHumanInput} (wave=${state.wave})`\n    );\n    if (flags.awaitingHumanInput) {\n      logger.info('[WavePlanning] Awaiting human input â€“ finishing run without further waves');\n      state.levelQueue = [];\n      state.eventQueue = [];\n      transition('Completed');\n      return;\n    }\n  } catch (e) {\n    logger.warn(`[WavePlanning] Failed to check awaitingHumanInput flag: ${e}`);\n  }\n\n  // Check if we have a dependency graph\n  // For fresh runs, PlanReady always initializes dependencyGraph before\n  // entering WavePlanning. However, resumed runs (from snapshots) may not\n  // hydrate this field. In that case, allow WavePlanning to proceed as long\n  // as we're not at the initial wave (wave > 0) where we would need the\n  // full graph to queue the first levels.\n  if (!context.dependencyGraph) {\n    if (state.wave === 0 && state.levelQueue.length === 0) {\n      throw new Error('Dependency graph not available');\n    }\n  }\n\n  // M3: Process bubbled events from child workflows\n  const bubbledEvents = (context as any)._bubbledEvents || [];\n  if (bubbledEvents.length > 0) {\n    if (context.debug) {\n      logger.info(\n        `[WavePlanning] Processing ${bubbledEvents.length} bubbled events from child workflows`\n      );\n    }\n\n    // Merge bubbled events into our event queue\n    for (const event of bubbledEvents) {\n      state.eventQueue.push(event);\n    }\n\n    // Clear bubbled events\n    (context as any)._bubbledEvents = [];\n  }\n\n  // M2: Process event queue for forward run requests\n  // IMPORTANT: Only process forward run requests if the current wave's levelQueue is empty\n  // This ensures we complete all scheduled checks before processing routing events\n  const forwardRunRequests = state.eventQueue.filter(\n    e => e.type === 'ForwardRunRequested'\n  ) as Array<Extract<EngineEvent, { type: 'ForwardRunRequested' }>>;\n\n  // Process forward-run requests.\n  // - GOTO-originated requests (goto/goto_js) preempt remaining work to jump back.\n  // - RUN-originated requests (run/run_js) are processed after the current wave drains,\n  //   so dependents in this wave (e.g., validate-fact after extract-facts) still run first.\n  if (\n    forwardRunRequests.length > 0 &&\n    (state.levelQueue.length === 0 ||\n      forwardRunRequests.some(r => r.origin === 'goto' || r.origin === 'goto_js'))\n  ) {\n    if (state.levelQueue.length > 0) {\n      if (context.debug) {\n        logger.info(\n          `[WavePlanning] Preempting ${state.levelQueue.length} remaining levels due to goto forward-run request`\n        );\n      }\n      // Clear remaining work; the next wave will be rebuilt\n      state.levelQueue = [];\n    }\n    if (context.debug) {\n      logger.info(`[WavePlanning] Processing ${forwardRunRequests.length} forward run requests`);\n    }\n\n    // Clear processed events from queue\n    state.eventQueue = state.eventQueue.filter(e => e.type !== 'ForwardRunRequested');\n\n    // Build set of checks to execute with deduplication\n    const checksToRun = new Set<string>();\n    // Collect per-check scopes for map-fanout runs\n    if (!state.pendingRunScopes) state.pendingRunScopes = new Map();\n    const eventOverrides = new Map<string, string>();\n\n    for (const request of forwardRunRequests) {\n      const { target, gotoEvent } = request;\n\n      // Deduplication: check if we've already requested this target in this wave\n      const scopeKey =\n        (request as any).scope && Array.isArray((request as any).scope)\n          ? JSON.stringify((request as any).scope)\n          : 'root';\n      const dedupeKey = `${target}:${gotoEvent || 'default'}:${state.wave}:${scopeKey}`;\n      if (state.forwardRunGuards.has(dedupeKey)) {\n        if (context.debug) {\n          logger.info(`[WavePlanning] Skipping duplicate forward run: ${target}`);\n        }\n        continue;\n      }\n\n      // Add to dedupe guard\n      state.forwardRunGuards.add(dedupeKey);\n\n      // Add target to execution set\n      checksToRun.add(target);\n\n      // Record requested scope (if any) for per-item fanout scheduling\n      try {\n        const scope = (request as any).scope as\n          | import('../../snapshot-store').ScopePath\n          | undefined;\n        if (scope && scope.length > 0) {\n          const arr = state.pendingRunScopes.get(target) || [];\n          // Deduplicate scopes\n          const key = (s: any[]) => JSON.stringify(s);\n          if (!arr.some(s => key(s) === key(scope))) arr.push(scope);\n          state.pendingRunScopes.set(target, arr);\n        }\n      } catch {}\n\n      // Store args (if any) for passing to the target check\n      try {\n        const args = request.args as Record<string, unknown> | undefined;\n        if (args && Object.keys(args).length > 0) {\n          if (!state.pendingRunArgs) state.pendingRunArgs = new Map();\n          // Merge with existing args if any (later events override earlier)\n          const existingArgs = state.pendingRunArgs.get(target) || {};\n          state.pendingRunArgs.set(target, { ...existingArgs, ...args });\n          if (context.debug) {\n            logger.info(`[WavePlanning] Storing args for ${target}: ${JSON.stringify(args)}`);\n          }\n        }\n      } catch {}\n\n      // Store event override if specified\n      if (gotoEvent) {\n        eventOverrides.set(target, gotoEvent);\n      }\n\n      // Track allowed failed dependencies from on_fail.run triggers\n      // When a check is triggered via on_fail.run, its dependency on the failed check\n      // should be allowed to have failed (that's the whole point of on_fail.run)\n      const sourceCheck = (request as any).sourceCheck as string | undefined;\n      if (sourceCheck && (request as any).origin === 'run') {\n        if (!state.allowedFailedDeps) {\n          state.allowedFailedDeps = new Map<string, Set<string>>();\n        }\n        const allowedSet = state.allowedFailedDeps.get(target) || new Set<string>();\n        allowedSet.add(sourceCheck);\n        state.allowedFailedDeps.set(target, allowedSet);\n        if (context.debug) {\n          logger.info(\n            `[WavePlanning] Allowing ${target} to run despite failed dependency ${sourceCheck}`\n          );\n        }\n      }\n\n      // Find all transitive dependencies (parents) of target.\n      // Forward-run MUST NOT blindly re-run parent checks that already executed\n      // successfully in this run; `depends_on` is an ordering/data contract,\n      // not an instruction to re-run ancestors every time a child is targeted.\n      //\n      // IMPORTANT: When origin is 'run' (from on_fail.run), we should NOT re-run\n      // failed dependencies. The whole point of on_fail.run is to execute a fix\n      // step that handles the failure case - the fix step needs access to the\n      // failed output, and should execute BEFORE any retry of the failed check.\n      const origin = (request as any).origin as string | undefined;\n      const dependencies = findTransitiveDependencies(target, context);\n      for (const dep of dependencies) {\n        const stats = state.stats.get(dep);\n        const hasSucceeded = !!stats && (stats.successfulRuns || 0) > 0;\n        const hasRun = !!stats && (stats.totalRuns || 0) > 0;\n        // For 'run' origin (on_fail.run), don't re-run dependencies that have already run\n        // (even if they failed). The fix step should execute with the failed output.\n        if (origin === 'run' && hasRun) {\n          continue;\n        }\n        if (!hasSucceeded) {\n          checksToRun.add(dep);\n        }\n      }\n\n      // Find all transitive dependents (children) of target.\n      // For goto/goto_js-originated forward runs targeting human-input checks\n      // (e.g., Slack ask loops), we deliberately DO NOT auto-schedule\n      // dependents. The expectation is that a human-input step resumes on the\n      // next external event (new Slack message / CLI input), and its\n      // dependents will be scheduled by the normal initial plan, not as part\n      // of the same forward-run wave.\n      let shouldIncludeDependents = true;\n      try {\n        const origin = (request as any).origin as string | undefined;\n        const cfg = context.config.checks?.[target] as any;\n        const targetType = String(cfg?.type || '').toLowerCase();\n        // Only treat gotoâ†’human-input as a pause boundary for event-driven\n        // runs (e.g., Slack SocketMode) where human-input is asynchronous and\n        // resumes on the next external message. CLI/manual flows (no\n        // webhookContext) should still immediately schedule dependents so\n        // on_fail.goto loops behave synchronously.\n        const execCtx: any = (context as any).executionContext || {};\n        const hasWebhook = !!execCtx.webhookContext;\n        if (\n          hasWebhook &&\n          (origin === 'goto' || origin === 'goto_js') &&\n          targetType === 'human-input'\n        ) {\n          shouldIncludeDependents = false;\n        }\n      } catch {\n        // best-effort; fall back to including dependents\n      }\n\n      if (shouldIncludeDependents) {\n        const dependents = findTransitiveDependents(target, context, gotoEvent);\n        for (const dep of dependents) {\n          checksToRun.add(dep);\n        }\n      }\n    }\n\n    if (checksToRun.size > 0) {\n      // Build subgraph for checks to run\n      const subgraphChecks = Array.from(checksToRun);\n\n      // Build dependency map for subgraph (expand OR tokens)\n      const subDeps: Record<string, string[]> = {};\n      for (const checkId of subgraphChecks) {\n        const checkConfig = context.config.checks?.[checkId];\n        if (!checkConfig) continue;\n\n        const deps = checkConfig.depends_on || [];\n        const depList = Array.isArray(deps) ? deps : [deps];\n\n        // Expand OR tokens (e.g., \"A|B\") and include only dependencies present in the subgraph\n        const expanded = depList.flatMap((d: string) =>\n          typeof d === 'string' && d.includes('|')\n            ? d\n                .split('|')\n                .map(s => s.trim())\n                .filter(Boolean)\n            : [d]\n        );\n\n        subDeps[checkId] = expanded.filter((d: string) => checksToRun.has(d));\n      }\n\n      // Build execution order for subgraph\n      const subGraph = DependencyResolver.buildDependencyGraph(subDeps);\n\n      // Check for cycles in forward-run subset\n      if (subGraph.hasCycles) {\n        const cycleNodes = subGraph.cycleNodes?.join(' -> ') || 'unknown';\n        const errorMsg = `Cycle detected in forward-run dependency subset: ${cycleNodes}`;\n        logger.error(`[WavePlanning] ${errorMsg}`);\n\n        // Mark execution as failed by adding a failed check to stats\n        // This allows tests to detect the cycle via statistics.failedExecutions\n        const firstCycleCheck = subGraph.cycleNodes?.[0];\n        if (firstCycleCheck) {\n          const checkStats: any = {\n            checkName: firstCycleCheck,\n            totalRuns: 1, // Count as 1 execution attempt\n            successfulRuns: 0,\n            failedRuns: 1,\n            skippedRuns: 0,\n            skipped: false,\n            totalDuration: 0,\n            issuesFound: 0,\n            issuesBySeverity: {\n              critical: 0,\n              error: 1,\n              warning: 0,\n              info: 0,\n            },\n            errorMessage: errorMsg,\n          };\n          state.stats.set(firstCycleCheck, checkStats);\n        }\n\n        // Transition to Completed (nothing more to execute)\n        transition('Completed');\n        return;\n      }\n\n      // Queue levels for execution\n      state.levelQueue = [...subGraph.executionOrder];\n\n      if (context.debug) {\n        const planned = subgraphChecks.join(', ');\n        logger.info(\n          `[WavePlanning] Forward-run planning: checks=[${planned}] levels=${state.levelQueue.length}`\n        );\n      }\n\n      if (context.debug) {\n        logger.info(\n          `[WavePlanning] Queued ${state.levelQueue.length} levels for ${checksToRun.size} checks (forward run)`\n        );\n      }\n\n      // Increment wave counter\n      state.wave++;\n\n      // Reset wave-scoped state to allow routing retries\n      (state as any).currentWaveCompletions = new Set<string>();\n      (state as any).failedChecks = new Set<string>();\n\n      // Clear forward run flag since we're processing them\n      state.flags.forwardRunRequested = false;\n\n      // Mark this wave as a forward-run wave so guards (if/assume) may consult\n      // prior outputs from the journal when evaluating conditions.\n      try {\n        (state as any).flags.forwardRunActive = true;\n        (state as any).flags.waveKind = 'forward';\n      } catch {}\n\n      // Transition to LevelDispatch\n      transition('LevelDispatch');\n      return;\n    }\n  }\n\n  // M2: Check for WaveRetry events (from on_finish)\n  const waveRetryEvents = state.eventQueue.filter(e => e.type === 'WaveRetry');\n  if (\n    waveRetryEvents.length > 0 &&\n    state.levelQueue.length === 0 &&\n    !state.eventQueue.some(e => e.type === 'ForwardRunRequested')\n  ) {\n    logger.info(`[WavePlanning] Processing wave retry requests (${waveRetryEvents.length} events)`);\n\n    // Clear wave retry events\n    state.eventQueue = state.eventQueue.filter(e => e.type !== 'WaveRetry');\n\n    // Strategy: Only re-run checks that were previously skipped due to `if`\n    // gating. This avoids re-running forEach parents and heavy dependency\n    // trees while allowing post-aggregation checks to re-evaluate.\n    const skippedIfChecks = new Set<string>();\n    logger.info(`[WavePlanning] Scanning ${state.stats.size} stat entries for skipped-if checks`);\n    for (const [name, stats] of state.stats.entries()) {\n      logger.info(\n        `[WavePlanning] Check ${name}: skipped=${(stats as any).skipped}, skipReason=${(stats as any).skipReason}`\n      );\n      if ((stats as any).skipped === true && (stats as any).skipReason === 'if_condition') {\n        skippedIfChecks.add(name);\n        logger.info(`[WavePlanning] Found skipped-if check for retry: ${name}`);\n      }\n    }\n    logger.info(`[WavePlanning] Total skipped-if checks: ${skippedIfChecks.size}`);\n\n    if (skippedIfChecks.size === 0) {\n      // Nothing to retry; mark completed\n      transition('Completed');\n      return;\n    }\n\n    // Build subgraph only for the skipped-if checks; do not include forEach parents.\n    const checksToRun = Array.from(skippedIfChecks).filter(\n      id => !(context.config.checks?.[id] as any)?.forEach\n    );\n    const subDeps: Record<string, string[]> = {};\n    for (const id of checksToRun) {\n      // Only include dependencies that are within the same subset (often none).\n      const cfg = context.config.checks?.[id];\n      // Normalize depends_on to array (supports string | string[])\n      const rawDeps = cfg?.depends_on;\n      const depsArray = Array.isArray(rawDeps) ? rawDeps : rawDeps ? [rawDeps] : [];\n      const deps = depsArray.filter((d: string) => checksToRun.includes(d));\n      subDeps[id] = deps;\n    }\n\n    const subGraph = DependencyResolver.buildDependencyGraph(subDeps);\n\n    state.levelQueue = [...subGraph.executionOrder];\n\n    if (context.debug) {\n      logger.info(\n        `[WavePlanning] Wave retry queued ${checksToRun.length} skipped-if check(s) in ${state.levelQueue.length} level(s)`\n      );\n    }\n\n    // Increment wave and reset wave-scoped state\n    state.wave++;\n\n    // Reset wave-scoped state to allow retry evaluation\n    (state as any).currentWaveCompletions = new Set<string>();\n    (state as any).failedChecks = new Set<string>();\n\n    // Mark this wave as a forward-style evaluation wave so guards (if/assume)\n    // can consult latest outputs/memory across the journal. This mirrors the\n    // behavior we enable for forward runs, and is necessary for patterns like\n    // on_finish.run â†’ aggregate sets memory flags â†’ skipped-if checks re-run.\n    try {\n      (state as any).flags = (state as any).flags || {};\n      (state as any).flags.forwardRunActive = true;\n      (state as any).flags.waveKind = 'retry';\n    } catch {}\n\n    transition('LevelDispatch');\n    return;\n  }\n\n  // (Removed) opportunistic on_finish processing; handled in LevelDispatch and routing.\n\n  // Initial wave: queue all execution levels\n  if (state.wave === 0 && state.levelQueue.length === 0) {\n    // At this point we must have a dependency graph; if it's still missing,\n    // fail fast to avoid undefined behavior.\n    if (!context.dependencyGraph) {\n      throw new Error('Dependency graph not available');\n    }\n\n    state.levelQueue = [...context.dependencyGraph.executionOrder];\n\n    if (context.debug) {\n      logger.info(\n        `[WavePlanning] Queued ${state.levelQueue.length} levels for execution (initial wave)`\n      );\n    }\n\n    // Increment wave to prevent re-queueing the same levels\n    state.wave++;\n\n    // Initialize current wave state\n    (state as any).currentWaveCompletions = new Set<string>();\n    (state as any).failedChecks = new Set<string>();\n    try {\n      (state as any).flags = (state as any).flags || {};\n      (state as any).flags.waveKind = 'initial';\n    } catch {}\n  }\n\n  // Check if there are levels to execute\n  if (state.levelQueue.length > 0) {\n    // Transition to LevelDispatch\n    transition('LevelDispatch');\n  } else {\n    // No more work - check if we have pending events\n    if (state.eventQueue.length > 0) {\n      if (context.debug) {\n        logger.warn(\n          `[WavePlanning] Event queue not empty (${state.eventQueue.length} events) but no work scheduled`\n        );\n      }\n    }\n\n    // All work complete\n    if (context.debug) {\n      logger.info('[WavePlanning] All waves complete');\n    }\n    transition('Completed');\n  }\n}\n\n/**\n * Find all transitive dependencies (parents) of a check\n */\nfunction findTransitiveDependencies(target: string, context: EngineContext): Set<string> {\n  const dependencies = new Set<string>();\n  const checks = context.config.checks || {};\n  const visited = new Set<string>();\n\n  const dfs = (checkId: string) => {\n    if (visited.has(checkId)) return;\n    visited.add(checkId);\n\n    const checkConfig = checks[checkId];\n    if (!checkConfig) return;\n\n    const deps = checkConfig.depends_on || [];\n    const depList = Array.isArray(deps) ? deps : [deps];\n\n    for (const depId of depList) {\n      if (typeof depId !== 'string') continue;\n\n      // Handle OR dependencies (pipe syntax) - add all options\n      if (depId.includes('|')) {\n        const orOptions = depId\n          .split('|')\n          .map(s => s.trim())\n          .filter(Boolean);\n        for (const opt of orOptions) {\n          if (checks[opt]) {\n            const optCfg: any = checks[opt];\n            // Exclude pure memory initializers from forward-run dependency subset\n            if (\n              String(optCfg?.type || '').toLowerCase() === 'memory' &&\n              String(optCfg?.operation || '').toLowerCase() === 'set'\n            ) {\n              continue;\n            }\n            dependencies.add(opt);\n            dfs(opt);\n          }\n        }\n      } else {\n        if (checks[depId]) {\n          const dCfg: any = checks[depId];\n          // Exclude pure memory initializers from forward-run dependency subset\n          if (\n            String(dCfg?.type || '').toLowerCase() === 'memory' &&\n            String(dCfg?.operation || '').toLowerCase() === 'set'\n          ) {\n            continue;\n          }\n          dependencies.add(depId);\n          dfs(depId);\n        }\n      }\n    }\n  };\n\n  dfs(target);\n  return dependencies;\n}\n\n/**\n * Find all transitive dependents of a check that should run for a given event\n */\nfunction findTransitiveDependents(\n  target: string,\n  context: EngineContext,\n  gotoEvent?: string\n): Set<string> {\n  const dependents = new Set<string>();\n  const checks = context.config.checks || {};\n\n  if (context.debug) {\n    logger.info(\n      `[WavePlanning] findTransitiveDependents called for target=${target}, gotoEvent=${gotoEvent}`\n    );\n  }\n\n  // Helper to check if a check depends on another\n  const dependsOn = (checkId: string, depId: string): boolean => {\n    const visited = new Set<string>();\n\n    const dfs = (current: string): boolean => {\n      if (visited.has(current)) return false;\n      visited.add(current);\n\n      const checkConfig = checks[current];\n      if (!checkConfig) return false;\n\n      const deps = checkConfig.depends_on || [];\n      const depList = Array.isArray(deps) ? deps : [deps];\n\n      // Check direct dependency or OR dependency (pipe syntax)\n      for (const dep of depList) {\n        if (typeof dep !== 'string') continue;\n\n        // Handle OR dependencies (pipe syntax)\n        if (dep.includes('|')) {\n          const orOptions = dep.split('|').map(s => s.trim());\n          if (orOptions.includes(depId)) return true;\n        } else {\n          if (dep === depId) return true;\n        }\n      }\n\n      for (const d of depList) {\n        if (dfs(d)) return true;\n      }\n\n      return false;\n    };\n\n    return dfs(checkId);\n  };\n\n  // Find all checks that depend on target\n  for (const checkId of Object.keys(checks)) {\n    if (checkId === target) continue;\n\n    const checkConfig = checks[checkId];\n    if (!checkConfig) continue;\n\n    // Check if this check depends on target\n    const isDep = dependsOn(checkId, target);\n    if (context.debug && isDep) {\n      logger.info(`[WavePlanning] findTransitiveDependents: ${checkId} depends on ${target}`);\n    }\n    if (!isDep) continue;\n\n    // If gotoEvent specified, filter by event triggers\n    if (gotoEvent) {\n      const triggers = checkConfig.on;\n      if (Array.isArray(triggers) && triggers.length > 0) {\n        if (!triggers.includes(gotoEvent as any)) {\n          // This check doesn't run for the specified event\n          if (context.debug) {\n            logger.info(`[WavePlanning] Skipping ${checkId}: doesn't run for event ${gotoEvent}`);\n          }\n          continue;\n        }\n      }\n    }\n\n    // Add to dependents\n    dependents.add(checkId);\n    if (context.debug) {\n      logger.info(`[WavePlanning] Added dependent: ${checkId}`);\n    }\n  }\n\n  return dependents;\n}\n","import { addEvent } from '../telemetry/trace-helpers';\nimport { addDiagramBlock } from '../telemetry/metrics';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\nconst MERMAID_RE = /```mermaid\\s*\\n([\\s\\S]*?)\\n```/gi;\n\nexport type DiagramOrigin = 'content' | 'issue';\n\nexport function emitMermaidFromMarkdown(\n  checkName: string,\n  markdown: string,\n  origin: DiagramOrigin\n): number {\n  if (!markdown || typeof markdown !== 'string') return 0;\n  let m: RegExpExecArray | null;\n  let count = 0;\n  MERMAID_RE.lastIndex = 0;\n  while ((m = MERMAID_RE.exec(markdown)) != null) {\n    const code = (m[1] || '').trim();\n    if (code) {\n      try {\n        addEvent('diagram.block', { check: checkName, origin, code });\n        addDiagramBlock(origin);\n        // Fallback writer for environments where OTel SDK isn't active\n        if (process.env.VISOR_TRACE_REPORT === 'true') {\n          const outDir =\n            process.env.VISOR_TRACE_DIR || path.join(process.cwd(), 'output', 'traces');\n          try {\n            if (!fs.existsSync(outDir)) fs.mkdirSync(outDir, { recursive: true });\n            const ts = new Date().toISOString().replace(/[:.]/g, '-');\n            const jsonPath = path.join(outDir, `${ts}.trace.json`);\n            const htmlPath = path.join(outDir, `${ts}.report.html`);\n            // Append or create minimal trace JSON\n            let data: {\n              spans: Array<{ events: Array<{ name: string; attrs: Record<string, unknown> }> }>;\n            } = { spans: [] };\n            if (fs.existsSync(jsonPath)) {\n              try {\n                data = JSON.parse(fs.readFileSync(jsonPath, 'utf8'));\n              } catch {\n                data = { spans: [] };\n              }\n            }\n            data.spans.push({\n              events: [{ name: 'diagram.block', attrs: { check: checkName, origin, code } }],\n            });\n            fs.writeFileSync(jsonPath, JSON.stringify(data, null, 2), 'utf8');\n            // Ensure minimal HTML report exists\n            if (!fs.existsSync(htmlPath)) {\n              fs.writeFileSync(\n                htmlPath,\n                '<!doctype html><html><head><meta charset=\"utf-8\"/><title>Visor Trace Report</title></head><body><h2>Visor Trace Report</h2></body></html>',\n                'utf8'\n              );\n            }\n          } catch {}\n        }\n        count++;\n      } catch {\n        // ignore telemetry failures\n      }\n    }\n  }\n  return count;\n}\n","/**\n * Utility functions for resolving workflow inputs from various context sources.\n *\n * This centralizes the workflow inputs resolution logic that was duplicated\n * across execution-invoker.ts, foreach-processor.ts, and level-dispatch.ts.\n */\n\nimport type { EngineContext } from '../../types/engine';\nimport type { CheckConfig } from '../../types/config';\n\n/**\n * Resolve workflow inputs from multiple sources with priority order:\n * 1. Check config (for nested workflows with inline inputs)\n * 2. Config-level workflow_inputs (for standalone workflow execution)\n * 3. Execution context workflowInputs (for programmatic invocation)\n *\n * @param checkConfig - The check configuration (may contain workflowInputs)\n * @param context - The engine context\n * @returns Resolved workflow inputs or undefined\n */\nexport function resolveWorkflowInputs(\n  checkConfig: CheckConfig | undefined,\n  context: EngineContext\n): Record<string, unknown> | undefined {\n  // Check config first (for nested workflows with inline inputs)\n  if ((checkConfig as any)?.workflowInputs) {\n    return (checkConfig as any).workflowInputs;\n  }\n\n  // Then check config-level workflow_inputs (for standalone workflow execution)\n  if ((context.config as any)?.workflow_inputs) {\n    return (context.config as any).workflow_inputs;\n  }\n\n  // Finally check execution context (for programmatic invocation)\n  if ((context.executionContext as any)?.workflowInputs) {\n    return (context.executionContext as any).workflowInputs;\n  }\n\n  return undefined;\n}\n","/**\n * Environment variable filtering for sandbox execution.\n * Filters host environment variables based on passthrough patterns\n * before forwarding them into sandbox containers.\n */\n\n/** Built-in env vars forwarded into sandboxes (used when no workspace defaults are set) */\nexport const BUILTIN_PASSTHROUGH = ['PATH', 'HOME', 'USER', 'CI', 'NODE_ENV', 'LANG'];\n\n/**\n * Test if a string matches a glob-like pattern with * wildcards.\n * Only supports trailing wildcards (e.g., \"GITHUB_*\").\n */\nfunction matchesPattern(name: string, pattern: string): boolean {\n  if (pattern === name) return true;\n  if (pattern.endsWith('*')) {\n    const prefix = pattern.slice(0, -1);\n    return name.startsWith(prefix);\n  }\n  return false;\n}\n\n/**\n * Filter environment variables for sandbox forwarding.\n *\n * @param checkEnv - Check-level env overrides (always included)\n * @param hostEnv - Host process.env to filter\n * @param passthroughPatterns - Glob patterns from sandbox config env_passthrough\n * @param defaultPatterns - Workspace-level defaults from sandbox_defaults.env_passthrough\n *                          (replaces BUILTIN_PASSTHROUGH when provided)\n * @returns Merged environment variables safe for the sandbox\n */\nexport function filterEnvForSandbox(\n  checkEnv: Record<string, string | number | boolean> | undefined,\n  hostEnv: Record<string, string | undefined>,\n  passthroughPatterns?: string[],\n  defaultPatterns?: string[]\n): Record<string, string> {\n  const result: Record<string, string> = {};\n\n  // If workspace-level defaults provided, use those instead of builtins\n  const defaults = defaultPatterns !== undefined ? defaultPatterns : BUILTIN_PASSTHROUGH;\n  const patterns = [...defaults, ...(passthroughPatterns || [])];\n\n  // Filter host env vars by patterns\n  for (const [key, value] of Object.entries(hostEnv)) {\n    if (value === undefined) continue;\n    if (patterns.some(pattern => matchesPattern(key, pattern))) {\n      result[key] = value;\n    }\n  }\n\n  // Check-level env always overrides (convert non-string values)\n  if (checkEnv) {\n    for (const [key, value] of Object.entries(checkEnv)) {\n      result[key] = String(value);\n    }\n  }\n\n  return result;\n}\n","/**\n * Telemetry helpers for sandbox modules.\n * Wraps imports from ../telemetry/trace-helpers with graceful fallback\n * when the telemetry module is not available (e.g., before merging with main).\n */\n\ntype SpanFn<T> = (span: unknown) => Promise<T>;\n\nlet _traceHelpers: {\n  withActiveSpan: <T>(\n    name: string,\n    attrs: Record<string, unknown> | undefined,\n    fn: SpanFn<T>\n  ) => Promise<T>;\n  addEvent: (name: string, attrs?: Record<string, unknown>) => void;\n  setSpanError: (err: unknown) => void;\n} | null = null;\n\nlet _attempted = false;\n\nfunction getTraceHelpers() {\n  if (_attempted) return _traceHelpers;\n  _attempted = true;\n  try {\n    _traceHelpers = require('../telemetry/trace-helpers');\n  } catch {\n    _traceHelpers = null;\n  }\n  return _traceHelpers;\n}\n\nexport async function withActiveSpan<T>(\n  name: string,\n  attrs: Record<string, unknown> | undefined,\n  fn: (span: unknown) => Promise<T>\n): Promise<T> {\n  const helpers = getTraceHelpers();\n  if (helpers) {\n    return helpers.withActiveSpan(name, attrs, fn);\n  }\n  // No-op: just run the function with a dummy span\n  return fn({});\n}\n\nexport function addEvent(name: string, attrs?: Record<string, unknown>): void {\n  const helpers = getTraceHelpers();\n  if (helpers) {\n    helpers.addEvent(name, attrs);\n  }\n}\n\nexport function setSpanError(err: unknown): void {\n  const helpers = getTraceHelpers();\n  if (helpers) {\n    helpers.setSpanError(err);\n  }\n}\n","/**\n * Read child visor NDJSON trace file and re-emit spans\n * into the parent's telemetry context as proper child spans.\n *\n * NDJSON format from FileSpanExporter:\n *   { traceId, spanId, parentSpanId?, name, startTime: [s,ns], endTime: [s,ns],\n *     status: { code, message? }, attributes, events?, kind }\n */\n\nimport { readFileSync } from 'fs';\nimport { logger } from '../logger';\n\ninterface ChildSpanRecord {\n  traceId?: string;\n  spanId?: string;\n  parentSpanId?: string;\n  name: string;\n  startTime?: [number, number];\n  endTime?: [number, number];\n  status?: { code?: number; message?: string };\n  attributes?: Record<string, unknown>;\n  events?: Array<{\n    name: string;\n    time?: [number, number];\n    attributes?: Record<string, unknown>;\n    attrs?: Record<string, unknown>; // fallback-ndjson uses 'attrs'\n  }>;\n  kind?: number;\n}\n\n/**\n * Try to obtain the OTel tracer. Returns null if OTel is not available.\n */\nfunction getTracer(): any {\n  try {\n    const helpers = require('../telemetry/trace-helpers');\n    return helpers.getTracer();\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Try to get the OTel context module for active span context.\n */\nfunction getOtelContext(): any {\n  try {\n    return require('../telemetry/lazy-otel');\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Ingest child trace NDJSON file and re-emit each span as a proper\n * child span under the current active parent span.\n *\n * Spans are created with their original startTime/endTime so they\n * appear with correct timing in the trace viewer.\n *\n * Gracefully degrades to no-op if OTel is not available.\n */\nexport function ingestChildTrace(filePath: string): void {\n  let content: string;\n  try {\n    content = readFileSync(filePath, 'utf8');\n  } catch {\n    return;\n  }\n\n  const lines = content.split('\\n');\n  const spans: ChildSpanRecord[] = [];\n  for (const line of lines) {\n    const trimmed = line.trim();\n    if (!trimmed) continue;\n    try {\n      spans.push(JSON.parse(trimmed));\n    } catch {\n      // Ignore malformed lines\n    }\n  }\n\n  if (spans.length === 0) return;\n\n  const tracer = getTracer();\n  if (!tracer) {\n    // No OTel â€” fall back to logging\n    logger.info(`[trace-ingester] ${spans.length} child spans (OTel unavailable)`);\n    return;\n  }\n\n  const otel = getOtelContext();\n\n  // Re-emit each child span as a proper child span of the current parent\n  for (const child of spans) {\n    if (!child.name) continue;\n\n    // Skip fallback markers and fallback-ndjson duplicates (no traceId = fallback emitter)\n    if (child.name === 'visor.run' || child.name === 'visor.event') continue;\n    if (!child.traceId && !child.startTime) continue; // fallback-ndjson record, skip\n\n    try {\n      const spanOptions: Record<string, any> = {\n        attributes: {\n          'visor.sandbox.child_span': true,\n          ...(child.attributes || {}),\n        },\n      };\n\n      // Preserve original timing if available\n      if (child.startTime) {\n        spanOptions.startTime = child.startTime;\n      }\n\n      const span = tracer.startSpan(`child: ${child.name}`, spanOptions);\n\n      // Re-emit child events\n      if (Array.isArray(child.events)) {\n        for (const evt of child.events) {\n          const evtAttrs = evt.attributes || evt.attrs || {};\n          if (evt.time) {\n            span.addEvent(evt.name, evtAttrs, evt.time);\n          } else {\n            span.addEvent(evt.name, evtAttrs);\n          }\n        }\n      }\n\n      // Set status if error\n      if (child.status && child.status.code === 2) {\n        try {\n          const { SpanStatusCode } = otel || {};\n          span.setStatus({\n            code: SpanStatusCode?.ERROR || 2,\n            message: child.status.message,\n          });\n        } catch {}\n      }\n\n      // End with original endTime if available\n      if (child.endTime) {\n        span.end(child.endTime);\n      } else {\n        span.end();\n      }\n    } catch {\n      // Non-fatal: skip individual span re-emission errors\n    }\n  }\n}\n","/**\n * CheckRunner â€” serializes check execution into a sandbox container.\n * Builds the CheckRunPayload, invokes child visor via sandbox exec,\n * and parses the JSON result from stdout.\n */\n\nimport { writeFileSync, existsSync, unlinkSync } from 'fs';\nimport { join } from 'path';\nimport { randomUUID } from 'crypto';\nimport { PRInfo } from '../pr-analyzer';\nimport { ReviewSummary } from '../reviewer';\nimport { CheckConfig } from '../types/config';\nimport { CheckRunPayload, CheckRunResult, SerializedPRInfo } from './types';\nimport { SandboxManager } from './sandbox-manager';\nimport { filterEnvForSandbox } from './env-filter';\nimport { SandboxConfig } from './types';\nimport { logger } from '../logger';\nimport { withActiveSpan, setSpanError } from './sandbox-telemetry';\nimport { ingestChildTrace } from './trace-ingester';\n\n/**\n * Serialize PRInfo to a plain JSON-safe object\n */\nfunction serializePRInfo(prInfo: PRInfo): SerializedPRInfo {\n  return {\n    number: prInfo.number,\n    title: prInfo.title,\n    body: prInfo.body,\n    author: prInfo.author,\n    base: prInfo.base,\n    head: prInfo.head,\n    files: (prInfo.files || []).map(f => ({\n      filename: f.filename,\n      status: f.status,\n      additions: f.additions,\n      deletions: f.deletions,\n      changes: f.changes,\n      patch: f.patch,\n    })),\n    totalAdditions: prInfo.totalAdditions,\n    totalDeletions: prInfo.totalDeletions,\n    eventType: prInfo.eventType,\n    fullDiff: prInfo.fullDiff,\n    commitDiff: prInfo.commitDiff,\n    isIncremental: prInfo.isIncremental,\n    isIssue: prInfo.isIssue,\n    eventContext: prInfo.eventContext,\n  };\n}\n\nexport class CheckRunner {\n  /**\n   * Execute a check inside a sandbox container.\n   *\n   * 1. Build CheckRunPayload JSON\n   * 2. Filter env vars through EnvFilter\n   * 3. Exec `node <visor_path>/cli-main.js --run-check` inside the sandbox\n   * 4. Parse CheckRunResult from stdout JSON\n   * 5. Return as ReviewSummary\n   */\n  static async runCheck(\n    sandboxManager: SandboxManager,\n    sandboxName: string,\n    sandboxConfig: SandboxConfig,\n    checkConfig: CheckConfig,\n    prInfo: PRInfo,\n    dependencyResults?: Map<string, ReviewSummary>,\n    timeoutMs?: number,\n    workspaceDefaults?: { env_passthrough?: string[] }\n  ): Promise<ReviewSummary> {\n    return withActiveSpan(\n      'visor.sandbox.runCheck',\n      {\n        'visor.sandbox.name': sandboxName,\n        'visor.check.name': (checkConfig as any).name || 'unknown',\n      },\n      async () => {\n        // Build the payload\n        const dependencyOutputs: Record<string, unknown> = {};\n        if (dependencyResults) {\n          for (const [key, value] of dependencyResults) {\n            dependencyOutputs[key] = value;\n          }\n        }\n\n        const payload: CheckRunPayload = {\n          check: checkConfig,\n          prInfo: serializePRInfo(prInfo),\n          dependencyOutputs:\n            Object.keys(dependencyOutputs).length > 0 ? dependencyOutputs : undefined,\n        };\n\n        // Filter environment variables\n        const env = filterEnvForSandbox(\n          checkConfig.env as Record<string, string | number | boolean> | undefined,\n          process.env,\n          sandboxConfig.env_passthrough,\n          workspaceDefaults?.env_passthrough\n        );\n\n        // Set up child trace file relay (skip for read-only sandboxes)\n        const workdir = sandboxConfig.workdir || '/workspace';\n        let hostTracePath: string | undefined;\n        if (!sandboxConfig.read_only) {\n          const traceFileName = `.visor-trace-${randomUUID().slice(0, 8)}.ndjson`;\n          hostTracePath = join(sandboxManager.getRepoPath(), traceFileName);\n          const containerTracePath = `${workdir}/${traceFileName}`;\n          try {\n            writeFileSync(hostTracePath, '', 'utf8'); // Create empty file (inside mounted workspace)\n          } catch {\n            hostTracePath = undefined; // Can't write â€” skip trace relay\n          }\n          if (hostTracePath) {\n            env['VISOR_FALLBACK_TRACE_FILE'] = containerTracePath;\n            env['VISOR_TELEMETRY_ENABLED'] = 'true';\n            env['VISOR_TELEMETRY_SINK'] = 'file';\n          }\n        }\n\n        // Build the command (validate visorPath to prevent shell injection inside container)\n        const visorPath = sandboxConfig.visor_path || '/opt/visor';\n        if (!/^[a-zA-Z0-9/_.-]+$/.test(visorPath) || /\\.\\./.test(visorPath)) {\n          throw new Error(\n            `Invalid visor_path '${visorPath}': must be a safe absolute path without '..' traversal`\n          );\n        }\n        const payloadJson = JSON.stringify(payload);\n\n        // Allow child visor to resolve externalized npm packages (e.g. @opentelemetry/*)\n        // from the workspace's node_modules (ncc doesn't bundle dynamic requires)\n        env['NODE_PATH'] = `${workdir}/node_modules`;\n\n        // Base64-encode payload to avoid shell quoting issues (the command goes\n        // through two layers of sh -c quoting: check-runner â†’ docker exec).\n        // Base64 output is guaranteed to only contain [A-Za-z0-9+/=] which are shell-safe.\n        const b64Payload = Buffer.from(payloadJson).toString('base64');\n        if (!/^[A-Za-z0-9+/=]+$/.test(b64Payload)) {\n          throw new Error('Unexpected characters in base64-encoded payload');\n        }\n        const command = `echo ${b64Payload} | base64 -d | node ${visorPath}/index.js --run-check -`;\n\n        logger.info(`Executing check in sandbox '${sandboxName}'`);\n\n        const result = await sandboxManager.exec(sandboxName, {\n          command,\n          env,\n          timeoutMs: timeoutMs || 600000,\n          maxBuffer: 50 * 1024 * 1024,\n        });\n\n        // Ingest child trace file if it exists\n        if (hostTracePath) {\n          try {\n            if (existsSync(hostTracePath)) {\n              ingestChildTrace(hostTracePath);\n              unlinkSync(hostTracePath);\n            }\n          } catch {\n            // Non-fatal: child trace ingestion failure shouldn't affect check result\n            try {\n              if (existsSync(hostTracePath)) unlinkSync(hostTracePath);\n            } catch {}\n          }\n        }\n\n        // Parse the result from stdout\n        const stdout = result.stdout.trim();\n\n        if (result.exitCode !== 0 && !stdout) {\n          // Complete failure - no JSON output\n          setSpanError(new Error(`Sandbox execution failed (exit ${result.exitCode})`));\n          return {\n            issues: [\n              {\n                severity: 'error',\n                message: `Sandbox execution failed (exit ${result.exitCode}): ${result.stderr.slice(0, 500)}`,\n                file: '',\n                line: 0,\n                ruleId: 'sandbox-execution-error',\n                category: 'logic',\n              },\n            ],\n          };\n        }\n\n        // Find the last line that looks like JSON (the result)\n        const lines = stdout.split('\\n');\n        let jsonLine: string | undefined;\n        for (let i = lines.length - 1; i >= 0; i--) {\n          const line = lines[i].trim();\n          if (line.startsWith('{')) {\n            jsonLine = line;\n            break;\n          }\n        }\n\n        if (!jsonLine) {\n          setSpanError(new Error('No JSON output from sandboxed check'));\n          return {\n            issues: [\n              {\n                severity: 'error',\n                message: `No JSON output from sandboxed check. Stdout: ${stdout.slice(0, 500)}`,\n                file: '',\n                line: 0,\n                ruleId: 'sandbox-parse-error',\n                category: 'logic',\n              },\n            ],\n          };\n        }\n\n        let checkRunResult: CheckRunResult;\n        try {\n          checkRunResult = JSON.parse(jsonLine);\n        } catch (parseErr) {\n          setSpanError(parseErr);\n          return {\n            issues: [\n              {\n                severity: 'error',\n                message: `Invalid JSON from sandboxed check: ${jsonLine.slice(0, 200)}`,\n                file: '',\n                line: 0,\n                ruleId: 'sandbox-parse-error',\n                category: 'logic',\n              },\n            ],\n          };\n        }\n\n        // Convert CheckRunResult back to ReviewSummary\n        const summary: ReviewSummary & { output?: unknown; content?: string } = {\n          issues: checkRunResult.issues || [],\n          debug: checkRunResult.debug as ReviewSummary['debug'],\n        };\n\n        if (checkRunResult.output !== undefined) {\n          summary.output = checkRunResult.output;\n        }\n        if (checkRunResult.content !== undefined) {\n          summary.content = checkRunResult.content;\n        }\n\n        return summary;\n      }\n    );\n  }\n}\n","/**\n * Sandbox routing utility for check execution.\n *\n * Decides whether a check should run inside a Docker sandbox (via CheckRunner)\n * or directly on the host (via provider.execute()).\n */\n\nimport type { EngineContext } from '../../types/engine';\nimport type { CheckConfig } from '../../types/config';\nimport type { ReviewSummary } from '../../reviewer';\nimport type { PRInfo } from '../../pr-analyzer';\nimport { logger } from '../../logger';\n\n/**\n * Execute a check either in a sandbox container or on the host.\n *\n * When the check is configured with a sandbox (check-level or workspace-level default),\n * and a SandboxManager is available on the engine context, the check is serialized\n * and executed inside the sandbox via CheckRunner.runCheck().\n *\n * Otherwise, falls back to the normal provider.execute() path via the provided callback.\n */\nexport async function executeWithSandboxRouting(\n  checkId: string,\n  checkConfig: CheckConfig,\n  context: EngineContext,\n  prInfo: PRInfo | any,\n  dependencyResults: Map<string, ReviewSummary>,\n  timeout: number | undefined,\n  hostExecute: () => Promise<ReviewSummary>\n): Promise<ReviewSummary> {\n  const sandboxManager = context.sandboxManager;\n  if (!sandboxManager) {\n    return hostExecute();\n  }\n\n  // Resolve which sandbox this check should use\n  const sandboxName = sandboxManager.resolveSandbox(\n    checkConfig.sandbox,\n    context.config.sandbox as string | undefined\n  );\n\n  if (!sandboxName) {\n    return hostExecute();\n  }\n\n  // Get sandbox configuration\n  const sandboxConfig = context.config.sandboxes?.[sandboxName];\n  if (!sandboxConfig) {\n    throw new Error(`Sandbox '${sandboxName}' not found in sandboxes configuration`);\n  }\n\n  // Execute in sandbox via CheckRunner\n  logger.info(`[SandboxRouting] Routing check '${checkId}' to sandbox '${sandboxName}'`);\n  const { CheckRunner } = require('../../sandbox/check-runner');\n  return CheckRunner.runCheck(\n    sandboxManager,\n    sandboxName,\n    sandboxConfig,\n    checkConfig,\n    prInfo,\n    dependencyResults.size > 0 ? dependencyResults : undefined,\n    timeout,\n    context.config.sandbox_defaults\n  );\n}\n","/**\n * Shared policy engine gating logic.\n *\n * Used by both execution-invoker and level-dispatch to evaluate whether\n * a check is allowed to run according to the policy engine.\n */\n\nimport type { PolicyEngine, PolicyDecision } from '../../policy/types';\nimport { logger } from '../../logger';\n\nexport interface PolicyGateResult {\n  /** Whether the check should be skipped (policy denied and not in warn-only mode) */\n  skip: boolean;\n  /** Human-readable reason for the decision */\n  reason?: string;\n  /** Whether a warn/audit message was emitted (allowed but flagged) */\n  warn?: boolean;\n  /** The audit reason string when warn is true */\n  auditReason?: string;\n}\n\n/**\n * Evaluate the policy engine for a given check and return a gating result.\n *\n * This function:\n * - Calls policyEngine.evaluateCheckExecution\n * - On evaluation error, treats the check as denied\n * - Logs audit warnings when decision.warn is true\n * - Returns a simple result indicating skip/allow and any audit info\n */\nexport async function applyPolicyGate(\n  checkId: string,\n  checkConfig: unknown,\n  policyEngine: PolicyEngine\n): Promise<PolicyGateResult> {\n  let decision: PolicyDecision;\n  try {\n    decision = await policyEngine.evaluateCheckExecution(checkId, checkConfig);\n  } catch (err) {\n    const msg = err instanceof Error ? err.message : String(err);\n    logger.warn(`[PolicyEngine] Evaluation failed for check '${checkId}': ${msg}`);\n    decision = { allowed: false, reason: 'policy evaluation error' };\n  }\n\n  const auditReason = decision.reason || 'policy violation';\n\n  if (decision.warn) {\n    logger.warn(`[PolicyEngine] Audit: check '${checkId}' would be denied: ${auditReason}`);\n  }\n\n  if (!decision.allowed) {\n    logger.info(`â›” Skipped (policy: ${decision.reason || 'denied'})`);\n    return {\n      skip: true,\n      reason: decision.reason || 'policy denied',\n      warn: !!decision.warn,\n      auditReason: decision.warn ? auditReason : undefined,\n    };\n  }\n\n  return {\n    skip: false,\n    warn: !!decision.warn,\n    auditReason: decision.warn ? auditReason : undefined,\n  };\n}\n","import type { EngineContext } from '../../types/engine';\nimport { logger } from '../../logger';\n\nfunction getHistoryLimit(): number | undefined {\n  const raw = process.env.VISOR_TEST_HISTORY_LIMIT || process.env.VISOR_OUTPUT_HISTORY_LIMIT;\n  if (!raw) return undefined;\n  const n = parseInt(raw, 10);\n  return Number.isFinite(n) && n > 0 ? n : undefined;\n}\n\n/**\n * Build output history Map from journal for template rendering\n * This matches the format expected by AI providers.\n * Moved from LevelDispatch to reduce file size and improve reuse.\n */\nexport function buildOutputHistoryFromJournal(context: EngineContext): Map<string, unknown[]> {\n  const outputHistory = new Map<string, unknown[]>();\n  const limit = getHistoryLimit();\n\n  try {\n    const snapshot = context.journal.beginSnapshot();\n    const allEntries = context.journal.readVisible(context.sessionId, snapshot, undefined);\n\n    for (const entry of allEntries) {\n      const checkId = entry.checkId;\n      if (!outputHistory.has(checkId)) {\n        outputHistory.set(checkId, []);\n      }\n      // Skip skip-stubs committed for visibility in stats\n      try {\n        if (entry && typeof entry.result === 'object' && (entry.result as any).__skipped) {\n          continue;\n        }\n      } catch {}\n\n      // Prefer explicit output; fall back to full result to preserve access to\n      // fields like `issues` for code-review style checks. Filter out aggregated\n      // forEach metadata objects to keep history aligned with per-item outputs\n      // for consumers like reducers and post-aggregation scripts.\n      const payload =\n        entry.result.output !== undefined ? entry.result.output : (entry.result as unknown);\n      try {\n        if (\n          payload &&\n          typeof payload === 'object' &&\n          (payload as any).forEachItems &&\n          Array.isArray((payload as any).forEachItems)\n        ) {\n          continue;\n        }\n      } catch {}\n      if (payload !== undefined) {\n        const arr = outputHistory.get(checkId)!;\n        arr.push(payload);\n        if (limit && arr.length > limit) {\n          arr.splice(0, arr.length - limit);\n        }\n      }\n    }\n  } catch (error) {\n    logger.debug(`[LevelDispatch] Error building output history: ${error}`);\n  }\n\n  return outputHistory;\n}\n","import type { EngineContext, RunState } from '../../types/engine';\nimport type { ReviewSummary } from '../../reviewer';\n\n/**\n * Build dependency results for a check with a specific scope.\n * Extracted from LevelDispatch to centralize dependency resolution logic.\n */\nexport function buildDependencyResultsWithScope(\n  checkId: string,\n  checkConfig: any,\n  context: EngineContext,\n  scope: Array<{ check: string; index: number }>\n): Map<string, ReviewSummary> {\n  const dependencyResults = new Map<string, ReviewSummary>();\n\n  const dependencies = checkConfig.depends_on || [];\n  const depList = Array.isArray(dependencies) ? dependencies : [dependencies];\n\n  const currentIndex = scope.length > 0 ? scope[scope.length - 1].index : undefined;\n\n  for (const depId of depList) {\n    if (!depId) continue;\n    try {\n      const snapshotId = context.journal.beginSnapshot();\n      const visible = context.journal.readVisible(\n        context.sessionId,\n        snapshotId,\n        context.event as any\n      );\n      const sameScope = (\n        a: Array<{ check: string; index: number }>,\n        b: Array<{ check: string; index: number }>\n      ): boolean => {\n        if (a.length !== b.length) return false;\n        for (let i = 0; i < a.length; i++)\n          if (a[i].check !== b[i].check || a[i].index !== b[i].index) return false;\n        return true;\n      };\n      const matches = visible.filter(e => e.checkId === depId && sameScope(e.scope as any, scope));\n      let journalResult = (\n        matches.length > 0 ? matches[matches.length - 1].result : undefined\n      ) as any;\n\n      if (\n        journalResult &&\n        Array.isArray(journalResult.forEachItems) &&\n        currentIndex !== undefined\n      ) {\n        const perItemSummary: any = (journalResult.forEachItemResults &&\n          journalResult.forEachItemResults[currentIndex]) || { issues: [] };\n        const perItemOutput = journalResult.forEachItems[currentIndex];\n        const combined = { ...perItemSummary, output: perItemOutput } as ReviewSummary;\n        dependencyResults.set(depId, combined);\n        continue;\n      }\n\n      if (!journalResult) {\n        try {\n          const { ContextView } = require('../../snapshot-store');\n          const rawContextView = new ContextView(\n            context.journal,\n            context.sessionId,\n            snapshotId,\n            [],\n            context.event\n          );\n          const raw = rawContextView.get(depId);\n          if (raw && Array.isArray((raw as any).forEachItems) && currentIndex !== undefined) {\n            const perItemSummary: any = ((raw as any).forEachItemResults &&\n              (raw as any).forEachItemResults[currentIndex]) || { issues: [] };\n            const perItemOutput = (raw as any).forEachItems[currentIndex];\n            journalResult = { ...perItemSummary, output: perItemOutput } as ReviewSummary;\n          }\n        } catch {\n          // ignore\n        }\n      }\n\n      if (journalResult) {\n        dependencyResults.set(depId, journalResult as ReviewSummary);\n      }\n    } catch {\n      // ignore individual dep failures\n    }\n  }\n\n  // Also expose raw outputs for all checks as a best-effort convenience\n  try {\n    const snapshotId = context.journal.beginSnapshot();\n    const allEntries = context.journal.readVisible(\n      context.sessionId,\n      snapshotId,\n      context.event as any\n    );\n    const allCheckNames = Array.from(new Set(allEntries.map((e: any) => e.checkId)));\n\n    for (const checkName of allCheckNames) {\n      try {\n        const { ContextView } = require('../../snapshot-store');\n        const rawContextView = new ContextView(\n          context.journal,\n          context.sessionId,\n          snapshotId,\n          scope,\n          context.event\n        );\n        const jr = rawContextView.get(checkName);\n        if (jr) dependencyResults.set(checkName, jr as ReviewSummary);\n      } catch {}\n    }\n\n    for (const checkName of allCheckNames) {\n      const checkCfg = context.config.checks?.[checkName];\n      if (checkCfg?.forEach) {\n        try {\n          const { ContextView } = require('../../snapshot-store');\n          const rawContextView = new ContextView(\n            context.journal,\n            context.sessionId,\n            snapshotId,\n            [],\n            context.event\n          );\n          const rawResult = rawContextView.get(checkName);\n          if (rawResult && (rawResult as any).forEachItems) {\n            const rawKey = `${checkName}-raw`;\n            dependencyResults.set(rawKey, {\n              issues: [],\n              output: (rawResult as any).forEachItems,\n            } as ReviewSummary);\n          }\n        } catch {}\n      }\n    }\n  } catch {}\n\n  return dependencyResults;\n}\n\nexport function buildDependencyResults(\n  checkId: string,\n  checkConfig: any,\n  context: EngineContext,\n  _state: RunState\n): Map<string, ReviewSummary> {\n  return buildDependencyResultsWithScope(checkId, checkConfig, context, []);\n}\n","import { logger } from '../../logger';\nimport type { ReviewSummary } from '../../reviewer';\n\n/**\n * Render template content for a check using our extended Liquid environment.\n * Extracted from LevelDispatch for reuse and testability.\n */\nexport async function renderTemplateContent(\n  checkId: string,\n  checkConfig: any,\n  reviewSummary: ReviewSummary\n): Promise<string | undefined> {\n  try {\n    const { createExtendedLiquid } = await import('../../liquid-extensions');\n    const fs = await import('fs/promises');\n    const path = await import('path');\n\n    const schemaRaw = checkConfig.schema || 'plain';\n    const schema = typeof schemaRaw === 'string' ? schemaRaw : 'code-review';\n\n    let templateContent: string | undefined;\n\n    if (checkConfig.template && checkConfig.template.content) {\n      templateContent = String(checkConfig.template.content);\n    } else if (checkConfig.template && checkConfig.template.file) {\n      const file = String(checkConfig.template.file);\n      const resolved = path.resolve(process.cwd(), file);\n      templateContent = await fs.readFile(resolved, 'utf-8');\n    } else if (schema && schema !== 'plain') {\n      const sanitized = String(schema).replace(/[^a-zA-Z0-9-]/g, '');\n      if (sanitized) {\n        // When bundled with ncc, __dirname is dist/ and output/ is at dist/output/\n        // When running from source, __dirname is src/state-machine/dispatch/ and output/ is at output/\n        const candidatePaths = [\n          path.join(__dirname, 'output', sanitized, 'template.liquid'), // bundled: dist/output/\n          path.join(__dirname, '..', '..', 'output', sanitized, 'template.liquid'), // source: output/\n          path.join(process.cwd(), 'output', sanitized, 'template.liquid'), // fallback: cwd/output/\n          path.join(process.cwd(), 'dist', 'output', sanitized, 'template.liquid'), // fallback: cwd/dist/output/\n        ];\n        for (const p of candidatePaths) {\n          try {\n            templateContent = await fs.readFile(p, 'utf-8');\n            if (templateContent) break;\n          } catch {\n            // try next\n          }\n        }\n      }\n    }\n\n    if (!templateContent) return undefined;\n\n    const liquid = createExtendedLiquid({\n      trimTagLeft: false,\n      trimTagRight: false,\n      trimOutputLeft: false,\n      trimOutputRight: false,\n      greedy: false,\n    });\n\n    // Ensure output is an object, not a JSON string\n    // If output is a string that looks like JSON, parse it\n    let output = (reviewSummary as any).output;\n    if (typeof output === 'string') {\n      const trimmed = output.trim();\n      if (trimmed.startsWith('{') || trimmed.startsWith('[')) {\n        try {\n          output = JSON.parse(trimmed);\n        } catch {\n          // Not valid JSON, keep as string\n        }\n      }\n    }\n\n    const templateData: Record<string, unknown> = {\n      issues: reviewSummary.issues || [],\n      checkName: checkId,\n      output,\n    };\n\n    const rendered = await liquid.parseAndRender(templateContent, templateData);\n    return rendered.trim();\n  } catch (error) {\n    const msg = error instanceof Error ? error.message : String(error);\n    logger.error(`[LevelDispatch] Failed to render template for ${checkId}: ${msg}`);\n    return undefined;\n  }\n}\n","import type { ReviewSummary } from '../../reviewer';\nimport type { RunState } from '../../types/engine';\nimport type { CheckExecutionStats } from '../../types/execution';\n\nexport function hasFatalIssues(result: ReviewSummary): boolean {\n  if (!result.issues) return false;\n  return result.issues.some(issue => {\n    const ruleId = issue.ruleId || '';\n    return (\n      ruleId.endsWith('/error') ||\n      ruleId.includes('/execution_error') ||\n      ruleId.includes('timeout') ||\n      ruleId.endsWith('_fail_if')\n    );\n  });\n}\n\nexport function shouldFailFast(\n  results: Array<{ checkId: string; result: ReviewSummary; error?: Error }>\n): boolean {\n  for (const { result } of results) {\n    if (!result || !result.issues) continue;\n    if (hasFatalIssues(result)) return true;\n  }\n  return false;\n}\n\nexport function updateStats(\n  results: Array<{ checkId: string; result: ReviewSummary; error?: Error; duration?: number }>,\n  state: RunState,\n  isForEachIteration: boolean = false\n): void {\n  for (const { checkId, result, error, duration } of results) {\n    const existing = state.stats.get(checkId);\n\n    const stats: CheckExecutionStats = existing || {\n      checkName: checkId,\n      totalRuns: 0,\n      successfulRuns: 0,\n      failedRuns: 0,\n      skippedRuns: 0,\n      skipped: false,\n      totalDuration: 0,\n      issuesFound: 0,\n      issuesBySeverity: { critical: 0, error: 0, warning: 0, info: 0 },\n    };\n\n    // Respect explicit skip markers on the result (set by LevelDispatch).\n    const skippedMarker = (result as any).__skipped;\n    if (skippedMarker) {\n      stats.skipped = true;\n      stats.skipReason =\n        typeof skippedMarker === 'string'\n          ? (skippedMarker as any)\n          : (stats.skipReason as any) || 'if_condition';\n      // A skipped result should not contribute to run counters; reset\n      // them explicitly to guard against any prior values lingering\n      // from earlier runs of the same check.\n      stats.totalRuns = 0;\n      stats.successfulRuns = 0;\n      stats.failedRuns = 0;\n      stats.skippedRuns++;\n      // Do not count this as a run; keep totalRuns/failed/success unchanged.\n      state.stats.set(checkId, stats);\n      continue;\n    }\n\n    // If this check was previously marked as skipped and now executed,\n    // clear the skipped flag and any skip counters to ensure the run is visible.\n    if (stats.skipped) {\n      stats.skipped = false;\n      stats.skippedRuns = 0;\n      (stats as any).skipReason = undefined;\n      (stats as any).skipCondition = undefined;\n    }\n\n    stats.totalRuns++;\n    if (typeof duration === 'number' && Number.isFinite(duration)) {\n      stats.totalDuration += duration;\n    }\n\n    const hasExecutionFailure = !!error || hasFatalIssues(result);\n    if (error) {\n      stats.failedRuns++;\n      // Note: do not set errorMessage; caller aggregates a single top-level issue.\n    } else if (hasExecutionFailure) {\n      stats.failedRuns++;\n      // Marking complete failure for non-forEach\n      // Per-iteration failures are handled in foreach path.\n      if (!isForEachIteration) {\n        (state as any).failedChecks = (state as any).failedChecks || new Set<string>();\n        (state as any).failedChecks.add(checkId);\n      }\n    } else {\n      stats.successfulRuns++;\n    }\n\n    if (result.issues) {\n      stats.issuesFound += result.issues.length;\n      for (const issue of result.issues) {\n        if (issue.severity === 'critical') stats.issuesBySeverity.critical++;\n        else if (issue.severity === 'error') stats.issuesBySeverity.error++;\n        else if (issue.severity === 'warning') stats.issuesBySeverity.warning++;\n        else if (issue.severity === 'info') stats.issuesBySeverity.info++;\n      }\n    }\n\n    if (stats.outputsProduced === undefined) {\n      const forEachItems = (result as any).forEachItems;\n      if (Array.isArray(forEachItems)) stats.outputsProduced = forEachItems.length;\n      else if ((result as any).output !== undefined) stats.outputsProduced = 1;\n    }\n\n    state.stats.set(checkId, stats);\n  }\n}\n","import type { EngineContext, EngineEvent, EngineState, RunState } from '../../types/engine';\nimport type { ReviewIssue, ReviewSummary } from '../../reviewer';\nimport { logger } from '../../logger';\nimport { emitNdjsonSpanWithEvents } from '../../telemetry/fallback-ndjson';\nimport { withActiveSpan } from '../../telemetry/trace-helpers';\nimport { captureCheckOutput } from '../../telemetry/state-capture';\nimport type { CheckProviderConfig } from '../../providers/check-provider.interface';\nimport { buildOutputHistoryFromJournal } from './history-snapshot';\nimport { buildDependencyResultsWithScope } from './dependency-gating';\nimport { updateStats, hasFatalIssues } from './stats-manager';\nimport { handleRouting, checkLoopBudget, evaluateGoto } from '../states/routing';\nimport { resolveWorkflowInputs } from '../context/workflow-inputs';\nimport { executeWithSandboxRouting } from './sandbox-routing';\n\n/**\n * Execute a check once per forEach item (map fanout path).\n * Extracted from LevelDispatch without behavior change.\n */\nexport async function executeCheckWithForEachItems(\n  checkId: string,\n  forEachParent: string,\n  forEachItems: unknown[],\n  context: EngineContext,\n  state: RunState,\n  emitEvent: (event: EngineEvent) => void,\n  transition: (newState: EngineState) => void\n): Promise<ReviewSummary> {\n  // Tactical correctness fix: re-read the parent's aggregated forEachItems\n  try {\n    const snapId = context.journal.beginSnapshot();\n    const visible = context.journal.readVisible(context.sessionId, snapId, context.event as any);\n    let latestItems: unknown[] | undefined;\n    for (let i = visible.length - 1; i >= 0; i--) {\n      const e = visible[i];\n      if (e.checkId === forEachParent && Array.isArray(e.scope) && e.scope.length === 0) {\n        const r: any = e.result;\n        if (r && Array.isArray(r.forEachItems)) {\n          latestItems = r.forEachItems as unknown[];\n          break;\n        }\n      }\n    }\n    if (Array.isArray(latestItems)) {\n      if (context.debug) {\n        try {\n          const prevLen = Array.isArray(forEachItems) ? (forEachItems as any[]).length : 0;\n          const newLen = latestItems.length;\n          if (prevLen !== newLen) {\n            logger.info(\n              `[LevelDispatch] Refreshing forEachItems for ${checkId}: from parent '${forEachParent}' latestItems=${newLen} (was ${prevLen})`\n            );\n          }\n        } catch {}\n      }\n      forEachItems = latestItems as unknown[];\n    }\n  } catch (e) {\n    if (context.debug) {\n      logger.warn(\n        `[LevelDispatch] Failed to refresh forEachItems from journal for ${forEachParent}: ${e}`\n      );\n    }\n  }\n\n  const checkConfig = context.config.checks?.[checkId];\n  if (!checkConfig) {\n    throw new Error(`Check configuration not found: ${checkId}`);\n  }\n\n  logger.info(\n    `[LevelDispatch][DEBUG] executeCheckWithForEachItems: checkId=${checkId}, forEachParent=${forEachParent}, items=${forEachItems.length}`\n  );\n  logger.info(\n    `[LevelDispatch][DEBUG] forEachItems: ${JSON.stringify(forEachItems).substring(0, 200)}`\n  );\n\n  const allIssues: ReviewIssue[] = [];\n  const perItemResults: ReviewSummary[] = [];\n  const allOutputs: unknown[] = [];\n  const allContents: string[] = [];\n  const perIterationDurations: number[] = [];\n\n  // Emit a banner for the forEach parent so logs clearly show when we are\n  // entering the aggregated execution for that step.\n  try {\n    const wave = state.wave;\n    const lvl = (state as any).currentLevel ?? '?';\n    const banner = `â”â”â” CHECK ${checkId} (wave ${wave}, level ${lvl}, forEach parent) â”â”â”`;\n    const isTTY = typeof process !== 'undefined' ? !!process.stderr.isTTY : false;\n    const outputFormat = process.env.VISOR_OUTPUT_FORMAT || '';\n    const isJsonLike = outputFormat === 'json' || outputFormat === 'sarif';\n    if (isTTY && !isJsonLike) {\n      const cyan = '\\x1b[36m';\n      const reset = '\\x1b[0m';\n      logger.info(`${cyan}${banner}${reset}`);\n    } else {\n      logger.info(banner);\n    }\n  } catch {\n    // best-effort only\n  }\n\n  for (let itemIndex = 0; itemIndex < forEachItems.length; itemIndex++) {\n    const iterationStartMs = Date.now();\n    const scope: Array<{ check: string; index: number }> = [\n      { check: forEachParent, index: itemIndex },\n    ];\n\n    const forEachItem = forEachItems[itemIndex];\n    logger.info(\n      `[LevelDispatch][DEBUG] Starting iteration ${itemIndex} of ${checkId}, parent=${forEachParent}, item=${JSON.stringify(forEachItem)?.substring(0, 100)}`\n    );\n\n    const shouldSkipDueToParentFailure =\n      (forEachItem as any)?.__failed === true || (forEachItem as any)?.__skip === true;\n    if (shouldSkipDueToParentFailure) {\n      logger.info(\n        `â­  Skipped ${checkId} iteration ${itemIndex} (forEach parent \"${forEachParent}\" iteration ${itemIndex} marked as failed)`\n      );\n      const iterationDurationMs = Date.now() - iterationStartMs;\n      perIterationDurations.push(iterationDurationMs);\n      perItemResults.push({ issues: [] });\n      allOutputs.push({ __skip: true });\n      continue;\n    }\n\n    try {\n      emitNdjsonSpanWithEvents(\n        'visor.foreach.item',\n        {\n          'visor.check.id': checkId,\n          'visor.foreach.index': itemIndex,\n          'visor.foreach.total': forEachItems.length,\n        },\n        []\n      );\n    } catch (error) {\n      logger.warn(`[LevelDispatch] Failed to emit foreach.item span: ${error}`);\n    }\n\n    emitEvent({ type: 'CheckScheduled', checkId, scope });\n\n    const dispatch = {\n      id: `${checkId}-${itemIndex}-${Date.now()}`,\n      checkId,\n      scope,\n      provider: context.checks[checkId]?.providerType || 'unknown',\n      startMs: Date.now(),\n      attempts: 1,\n      foreachIndex: itemIndex,\n    };\n    state.activeDispatches.set(`${checkId}-${itemIndex}`, dispatch as any);\n\n    try {\n      const providerType = checkConfig.type || 'ai';\n      const providerRegistry =\n        require('../../providers/check-provider-registry').CheckProviderRegistry.getInstance();\n      const provider = providerRegistry.getProviderOrThrow(providerType);\n\n      const outputHistory = buildOutputHistoryFromJournal(context);\n\n      // Resolve workflow inputs from config or context (centralized logic)\n      const workflowInputs = resolveWorkflowInputs(checkConfig, context);\n\n      const providerConfig: CheckProviderConfig = {\n        type: providerType,\n        checkName: checkId,\n        prompt: checkConfig.prompt,\n        exec: checkConfig.exec,\n        schema: checkConfig.schema,\n        group: checkConfig.group,\n        focus:\n          checkConfig.focus ||\n          ((): string => {\n            const focusMap: Record<string, string> = {\n              security: 'security',\n              performance: 'performance',\n              style: 'style',\n              architecture: 'architecture',\n            };\n            return focusMap[checkId] || 'all';\n          })(),\n        transform: checkConfig.transform,\n        transform_js: checkConfig.transform_js,\n        env: checkConfig.env,\n        forEach: checkConfig.forEach,\n        ...checkConfig,\n        eventContext: (context.prInfo as any)?.eventContext || {},\n        __outputHistory: outputHistory,\n        // Propagate workflow inputs for template access via {{ inputs.* }}\n        workflowInputs,\n        ai: {\n          ...(checkConfig.ai || {}),\n          timeout: checkConfig.ai?.timeout || 1800000,\n          debug: !!context.debug,\n        },\n      };\n\n      const dependencyResults = buildDependencyResultsWithScope(\n        checkId,\n        checkConfig,\n        context,\n        scope\n      );\n\n      // Per-item dependency gating for map fanout\n      try {\n        const rawDeps = (checkConfig as any)?.depends_on || [];\n        const depList = Array.isArray(rawDeps) ? rawDeps : [rawDeps];\n        if (depList.length > 0) {\n          const groupSatisfied = (token: string): boolean => {\n            if (typeof token !== 'string') return true;\n            const orOptions = token.includes('|')\n              ? token\n                  .split('|')\n                  .map(s => s.trim())\n                  .filter(Boolean)\n              : [token];\n            for (const opt of orOptions) {\n              const dr = dependencyResults.get(opt) as ReviewSummary | undefined;\n              const depCfg = context.config.checks?.[opt];\n              const cont = !!(depCfg && (depCfg as any).continue_on_failure === true);\n              let failed = false;\n              let skipped = false;\n              if (!dr) failed = true;\n              else {\n                const out: any = (dr as any).output;\n                const fatal = hasFatalIssues(dr as any);\n                failed = fatal || (!!out && typeof out === 'object' && out.__failed === true);\n                skipped = !!(out && typeof out === 'object' && out.__skip === true);\n              }\n              const satisfied = !skipped && (!failed || cont);\n              if (satisfied) return true;\n            }\n            return false;\n          };\n\n          let allSatisfied = true;\n          for (const token of depList) {\n            if (!groupSatisfied(token as any)) {\n              allSatisfied = false;\n              break;\n            }\n          }\n\n          if (!allSatisfied) {\n            if (context.debug) {\n              logger.info(\n                `[LevelDispatch] Skipping ${checkId} iteration ${itemIndex} due to unsatisfied dependency group(s)`\n              );\n            }\n            const iterationDurationMs = Date.now() - iterationStartMs;\n            perIterationDurations.push(iterationDurationMs);\n            perItemResults.push({ issues: [] });\n            allOutputs.push({ __skip: true });\n            continue;\n          }\n        }\n      } catch {}\n\n      const prInfo: any = context.prInfo || {\n        number: 1,\n        title: 'State Machine Execution',\n        author: 'system',\n        eventType: context.event || 'manual',\n        eventContext: {},\n        files: [],\n        commits: [],\n      };\n      const executionContext = {\n        ...context.executionContext,\n        _engineMode: context.mode,\n        _parentContext: context,\n        _parentState: state,\n      };\n\n      const result = await withActiveSpan(\n        `visor.check.${checkId}`,\n        {\n          'visor.check.id': checkId,\n          'visor.check.type': providerType,\n          session_id: context.sessionId,\n          wave: state.wave,\n        },\n        async span => {\n          const res = await executeWithSandboxRouting(\n            checkId,\n            checkConfig,\n            context,\n            prInfo,\n            dependencyResults,\n            checkConfig.ai?.timeout || 1800000,\n            () => provider.execute(prInfo, providerConfig, dependencyResults, executionContext)\n          );\n          try {\n            captureCheckOutput(span, (res as any).output);\n          } catch {}\n          return res;\n        }\n      );\n\n      const enrichedIssues = (result.issues || []).map((issue: ReviewIssue) => ({\n        ...issue,\n        checkName: checkId,\n        ruleId: `${checkId}/${issue.ruleId || 'unknown'}`,\n        group: checkConfig.group,\n        schema: typeof checkConfig.schema === 'object' ? 'custom' : checkConfig.schema,\n        template: checkConfig.template,\n        timestamp: Date.now(),\n      }));\n\n      const enrichedResult: any = { ...result, issues: enrichedIssues };\n\n      // Update stats for this iteration\n      const iterationDurationMs = Date.now() - iterationStartMs;\n      perIterationDurations.push(iterationDurationMs);\n      updateStats(\n        [{ checkId, result: enrichedResult as any, duration: iterationDurationMs }],\n        state,\n        true\n      );\n\n      // Commit per-iteration journal result (scoped)\n      try {\n        context.journal.commitEntry({\n          sessionId: context.sessionId,\n          checkId,\n          result: enrichedResult as any,\n          event: context.event || 'manual',\n          scope,\n        });\n        logger.info(\n          `[LevelDispatch][DEBUG] Committing to journal: checkId=${checkId}, scope=${JSON.stringify(scope)}, hasOutput=${enrichedResult.output !== undefined}`\n        );\n      } catch (error) {\n        logger.warn(`[LevelDispatch] Failed to commit per-iteration result to journal: ${error}`);\n      }\n\n      // Record per-item summary and aggregate outputs/contents\n      perItemResults.push(enrichedResult);\n      if ((enrichedResult as any).content)\n        allContents.push(String((enrichedResult as any).content));\n      if ((enrichedResult as any).output !== undefined)\n        allOutputs.push((enrichedResult as any).output);\n      allIssues.push(...(enrichedResult.issues || []));\n\n      // Emit completion for iteration\n      emitEvent({ type: 'CheckCompleted', checkId, scope, result: enrichedResult });\n    } catch (error) {\n      const iterationDurationMs = Date.now() - iterationStartMs;\n      perIterationDurations.push(iterationDurationMs);\n      const err = error instanceof Error ? error : new Error(String(error));\n      logger.error(\n        `[LevelDispatch] Error executing ${checkId} iteration ${itemIndex}: ${err.message}`\n      );\n      updateStats(\n        [\n          {\n            checkId,\n            result: {\n              issues: [\n                {\n                  severity: 'error',\n                  category: 'logic',\n                  ruleId: `${checkId}/error`,\n                  file: 'system',\n                  line: 0,\n                  message: err.message,\n                  timestamp: Date.now(),\n                } as any,\n              ],\n            } as any,\n            error: err,\n            duration: iterationDurationMs,\n          },\n        ],\n        state,\n        true\n      );\n      allOutputs.push({ __failed: true });\n      perItemResults.push({\n        issues: [\n          {\n            severity: 'error',\n            category: 'logic',\n            ruleId: `${checkId}/error`,\n            file: 'system',\n            line: 0,\n            message: err.message,\n            timestamp: Date.now(),\n          } as any,\n        ],\n      });\n      emitEvent({\n        type: 'CheckErrored',\n        checkId,\n        scope,\n        error: { message: err.message, stack: err.stack, name: err.name },\n      });\n    } finally {\n      state.activeDispatches.delete(`${checkId}-${itemIndex}`);\n    }\n  }\n\n  // Update forEach metadata in stats (same behavior)\n  const checkStats = state.stats.get(checkId);\n  if (checkStats) {\n    checkStats.outputsProduced = allOutputs.length;\n    checkStats.perIterationDuration = perIterationDurations;\n    const previewItems = allOutputs.slice(0, 3).map(item => {\n      const str = typeof item === 'string' ? item : (JSON.stringify(item) ?? 'undefined');\n      return str.length > 50 ? str.substring(0, 50) + '...' : str;\n    });\n    checkStats.forEachPreview =\n      allOutputs.length > 3 ? [...previewItems, `...${allOutputs.length - 3} more`] : previewItems;\n    state.stats.set(checkId, checkStats);\n    if (checkStats.totalRuns > 0 && checkStats.failedRuns === checkStats.totalRuns) {\n      logger.info(\n        `[LevelDispatch] forEach check ${checkId} failed completely (${checkStats.failedRuns}/${checkStats.totalRuns} iterations failed)`\n      );\n      (state as any).failedChecks = (state as any).failedChecks || new Set<string>();\n      (state as any).failedChecks.add(checkId);\n    }\n  }\n\n  // Aggregated result\n  const aggregatedResult: any = {\n    issues: allIssues,\n    isForEach: true,\n    forEachItems: allOutputs,\n    forEachItemResults: perItemResults,\n    ...(allContents.length > 0 ? { content: allContents.join('\\n') } : {}),\n  };\n\n  logger.info(\n    `[LevelDispatch][DEBUG] Aggregated result for ${checkId}: forEachItems.length=${allOutputs.length}, results=${perItemResults.length}`\n  );\n  logger.info(`[LevelDispatch][DEBUG] allOutputs: ${JSON.stringify(allOutputs).substring(0, 200)}`);\n\n  // Route aggregated child before commit\n  try {\n    logger.info(`[LevelDispatch] Calling handleRouting for ${checkId}`);\n  } catch {}\n  let wasHalted = false;\n  try {\n    state.completedChecks.add(checkId);\n    const currentWaveCompletions = (state as any).currentWaveCompletions as Set<string> | undefined;\n    if (currentWaveCompletions) currentWaveCompletions.add(checkId);\n\n    wasHalted = await handleRouting(context, state, transition, emitEvent, {\n      checkId,\n      scope: [],\n      result: aggregatedResult as any,\n      checkConfig: checkConfig as any,\n      success: !hasFatalIssues(aggregatedResult as any),\n    });\n  } catch (error) {\n    logger.warn(`[LevelDispatch] Routing error for aggregated forEach ${checkId}: ${error}`);\n  }\n\n  // If execution was halted, return the aggregated result (with halt issue added)\n  if (wasHalted) {\n    logger.info(`[LevelDispatch] Execution halted after routing for aggregated forEach ${checkId}`);\n    return aggregatedResult as ReviewSummary;\n  }\n\n  try {\n    context.journal.commitEntry({\n      sessionId: context.sessionId,\n      checkId,\n      result: aggregatedResult as any,\n      event: context.event || 'manual',\n      scope: [],\n    });\n    logger.info(`[LevelDispatch][DEBUG] Committed aggregated result to journal with scope=[]`);\n  } catch (error) {\n    logger.warn(`[LevelDispatch] Failed to commit aggregated forEach result to journal: ${error}`);\n  }\n\n  emitEvent({ type: 'CheckCompleted', checkId, scope: [], result: aggregatedResult });\n\n  // on_finish for forEach parent after children complete (as before)\n  const parentCheckConfig = context.config.checks?.[forEachParent];\n  logger.info(\n    `[LevelDispatch][DEBUG] Checking on_finish for forEach parent ${forEachParent}: has_on_finish=${!!parentCheckConfig?.on_finish}, is_forEach=${!!parentCheckConfig?.forEach}`\n  );\n\n  if (parentCheckConfig?.on_finish && parentCheckConfig.forEach) {\n    logger.info(\n      `[LevelDispatch] Processing on_finish for forEach parent ${forEachParent} after children complete`\n    );\n    try {\n      const snapshotId = context.journal.beginSnapshot();\n      const { ContextView } = require('../../snapshot-store');\n      const contextView = new ContextView(\n        context.journal,\n        context.sessionId,\n        snapshotId,\n        [],\n        context.event\n      );\n      const parentResult = contextView.get(forEachParent);\n\n      if (parentResult) {\n        logger.info(\n          `[LevelDispatch] Found parent result for ${forEachParent}, evaluating on_finish`\n        );\n\n        const onFinish = parentCheckConfig.on_finish;\n\n        let queuedForward = false;\n        logger.info(\n          `[LevelDispatch] on_finish.run: ${onFinish.run?.length || 0} targets, targets=${JSON.stringify(onFinish.run || [])}`\n        );\n        if (onFinish.run && onFinish.run.length > 0) {\n          for (const targetCheck of onFinish.run) {\n            logger.info(`[LevelDispatch] Processing on_finish.run target: ${targetCheck}`);\n            logger.info(\n              `[LevelDispatch] Loop budget check: routingLoopCount=${state.routingLoopCount}, max_loops=${context.config.routing?.max_loops ?? 10}`\n            );\n            if (checkLoopBudget(context, state, 'on_finish', 'run')) {\n              const errorIssue: ReviewIssue = {\n                file: 'system',\n                line: 0,\n                ruleId: `${forEachParent}/routing/loop_budget_exceeded`,\n                message: `Routing loop budget exceeded (max_loops=${context.config.routing?.max_loops ?? 10}) during on_finish run`,\n                severity: 'error',\n                category: 'logic',\n              };\n              parentResult.issues = [...(parentResult.issues || []), errorIssue];\n              try {\n                context.journal.commitEntry({\n                  sessionId: context.sessionId,\n                  checkId: forEachParent,\n                  result: parentResult as any,\n                  event: context.event || 'manual',\n                  scope: [],\n                });\n              } catch (err) {\n                logger.warn(\n                  `[LevelDispatch] Failed to commit parent result with loop budget error: ${err}`\n                );\n              }\n              return aggregatedResult;\n            }\n            state.routingLoopCount++;\n            emitEvent({\n              type: 'ForwardRunRequested',\n              target: targetCheck,\n              scope: [],\n              origin: 'run',\n            });\n            queuedForward = true;\n          }\n        }\n\n        // Debug for goto_js (guarded)\n        if (context.debug) {\n          logger.info(\n            `[LevelDispatch] Evaluating on_finish.goto_js for forEach parent: ${forEachParent}`\n          );\n          if (onFinish.goto_js)\n            logger.info(`[LevelDispatch] goto_js code: ${onFinish.goto_js.substring(0, 200)}`);\n          try {\n            const snapshotId2 = context.journal.beginSnapshot();\n            const all = context.journal.readVisible(context.sessionId, snapshotId2, undefined);\n            const keys = Array.from(new Set(all.map((e: any) => e.checkId)));\n            logger.info(`[LevelDispatch] history keys: ${keys.join(', ')}`);\n          } catch {}\n        }\n\n        const gotoTarget = await (evaluateGoto as any)(\n          onFinish.goto_js,\n          onFinish.goto,\n          forEachParent,\n          parentCheckConfig,\n          parentResult,\n          context,\n          state\n        );\n        if (context.debug)\n          logger.info(`[LevelDispatch] goto_js evaluation result: ${gotoTarget || 'null'}`);\n\n        if (gotoTarget) {\n          if (queuedForward && gotoTarget === forEachParent) {\n            logger.info(\n              `[LevelDispatch] on_finish.goto to self (${gotoTarget}) deferred, will process after WaveRetry`\n            );\n            emitEvent({ type: 'WaveRetry', reason: 'on_finish' });\n          } else {\n            if (checkLoopBudget(context, state, 'on_finish', 'goto')) {\n              const errorIssue: ReviewIssue = {\n                file: 'system',\n                line: 0,\n                ruleId: `${forEachParent}/routing/loop_budget_exceeded`,\n                message: `Routing loop budget exceeded (max_loops=${context.config.routing?.max_loops ?? 10}) during on_finish goto`,\n                severity: 'error',\n                category: 'logic',\n              };\n              parentResult.issues = [...(parentResult.issues || []), errorIssue];\n              try {\n                context.journal.commitEntry({\n                  sessionId: context.sessionId,\n                  checkId: forEachParent,\n                  result: parentResult as any,\n                  event: context.event || 'manual',\n                  scope: [],\n                });\n              } catch {}\n              return aggregatedResult;\n            }\n            state.routingLoopCount++;\n            emitEvent({ type: 'ForwardRunRequested', target: gotoTarget, origin: 'goto' });\n          }\n        }\n\n        // If we enqueued any on_finish.run targets, request a WaveRetry so the\n        // next wave re-evaluates guards/ifs across the full plan. Guard to\n        // avoid duplicate retries for the same parent within the same wave.\n        if (queuedForward) {\n          const guardKey = `waveRetry:on_finish:${forEachParent}:wave:${state.wave}`;\n          logger.info(\n            `[LevelDispatch] Checking WaveRetry guard: ${guardKey}, has=${!!(state as any).forwardRunGuards?.has(guardKey)}`\n          );\n          if (!(state as any).forwardRunGuards?.has(guardKey)) {\n            (state as any).forwardRunGuards?.add(guardKey);\n            logger.info(`[LevelDispatch] Emitting WaveRetry event for on_finish.run targets`);\n            emitEvent({ type: 'WaveRetry', reason: 'on_finish' });\n          }\n        }\n      }\n    } catch {}\n  }\n\n  return aggregatedResult;\n}\n","/**\n * on_init Invocation Handlers\n *\n * Responsibilities:\n * - Execute tool invocations (from tools: section via MCP)\n * - Execute step invocations (regular checks)\n * - Execute workflow invocations (reusable workflows)\n * - Handle argument passing via 'with' directive\n * - Store outputs with custom names via 'as' directive\n *\n * forEach Integration:\n * - on_init is called ONCE before forEach loops start (in level-dispatch.ts)\n * - Outputs from on_init are shared across all forEach iterations\n * - This allows efficient preprocessing without redundant work per item\n */\n\nimport type { EngineContext } from '../../types/engine';\nimport type {\n  OnInitToolInvocation,\n  OnInitStepInvocation,\n  OnInitWorkflowInvocation,\n  CheckConfig,\n} from '../../types/config';\nimport { logger } from '../../logger';\nimport { createExtendedLiquid } from '../../liquid-extensions';\n\n/**\n * Scope type for forEach context\n */\nexport type Scope = Array<{ check: string; index: number }>;\n\n/**\n * Union type for all invocation types\n */\ntype OnInitInvocation = OnInitToolInvocation | OnInitStepInvocation | OnInitWorkflowInvocation;\n\n/**\n * Render template expressions in 'with' arguments\n */\nasync function renderTemplateArguments(\n  args: Record<string, unknown> | undefined,\n  prInfo: any,\n  dependencyResults: Record<string, unknown>,\n  executionContext: any\n): Promise<Record<string, unknown>> {\n  const renderedArgs: Record<string, unknown> = {};\n\n  if (!args) {\n    return renderedArgs;\n  }\n\n  const liquid = createExtendedLiquid();\n  for (const [key, value] of Object.entries(args)) {\n    if (typeof value === 'string') {\n      try {\n        renderedArgs[key] = await liquid.parseAndRender(value, {\n          pr: prInfo,\n          outputs: dependencyResults,\n          env: process.env,\n          args: executionContext.args || {},\n        });\n      } catch (error) {\n        logger.warn(`[OnInit] Failed to render template for ${key}: ${error}`);\n        renderedArgs[key] = value;\n      }\n    } else {\n      renderedArgs[key] = value;\n    }\n  }\n\n  return renderedArgs;\n}\n\n/**\n * Execute a unified on_init invocation (tool, step, or workflow)\n *\n * This function consolidates all invocation types into a single handler that:\n * 1. Determines the invocation type (tool, step, workflow)\n * 2. Renders template arguments\n * 3. Creates appropriate check configuration\n * 4. Executes via the CheckProviderRegistry\n *\n * @param item - Invocation configuration (tool, step, or workflow)\n * @param context - Engine context\n * @param scope - Current forEach scope\n * @param prInfo - PR information for provider execution\n * @param dependencyResults - Dependency outputs from parent check\n * @param executionContext - Execution context\n * @returns Invocation output\n */\nasync function executeInvocation(\n  item: OnInitInvocation,\n  context: EngineContext,\n  scope: Scope,\n  prInfo: any,\n  dependencyResults: Record<string, unknown>,\n  executionContext: any\n): Promise<unknown> {\n  const CheckProviderRegistry =\n    require('../../providers/check-provider-registry').CheckProviderRegistry;\n  const providerRegistry = CheckProviderRegistry.getInstance();\n\n  // Render template arguments\n  const renderedArgs = await renderTemplateArguments(\n    item.with,\n    prInfo,\n    dependencyResults,\n    executionContext\n  );\n\n  // Determine invocation type and execute\n  if ('tool' in item) {\n    // Tool invocation\n    const toolName = item.tool;\n    const toolDef = context.config.tools?.[toolName];\n\n    if (!toolDef) {\n      throw new Error(`Tool '${toolName}' not found in tools: section`);\n    }\n\n    logger.info(`[OnInit] Executing tool: ${toolName}`);\n\n    const tempCheckConfig: any = {\n      type: 'mcp',\n      method: toolName,\n      transport: 'custom',\n      args: renderedArgs,\n    };\n\n    const provider = providerRegistry.getProviderOrThrow('mcp');\n    const result = await provider.execute(\n      prInfo,\n      tempCheckConfig,\n      dependencyResults,\n      executionContext\n    );\n    const output = (result as any).output;\n\n    logger.info(`[OnInit] Tool ${toolName} completed`);\n    return output;\n  } else if ('step' in item) {\n    // Step invocation\n    const stepName = item.step;\n    const stepConfig = context.config.checks?.[stepName];\n\n    if (!stepConfig) {\n      throw new Error(`Step '${stepName}' not found in checks: section`);\n    }\n\n    logger.info(`[OnInit] Executing step: ${stepName}`);\n\n    // Inject args into execution context\n    const enrichedExecutionContext = {\n      ...executionContext,\n      args: renderedArgs,\n    };\n\n    // Get provider for this step's type\n    const providerType = stepConfig.type || 'ai';\n    const provider = providerRegistry.getProviderOrThrow(providerType);\n\n    // Build output history from journal for template context\n    const { buildOutputHistoryFromJournal } = require('./history-snapshot');\n    const outputHistory = buildOutputHistoryFromJournal(context);\n\n    // Create provider config\n    const providerConfig: any = {\n      type: providerType,\n      checkName: stepName,\n      prompt: stepConfig.prompt,\n      exec: stepConfig.exec,\n      schema: stepConfig.schema,\n      group: stepConfig.group,\n      transform: stepConfig.transform,\n      transform_js: stepConfig.transform_js,\n      env: stepConfig.env,\n      ...stepConfig,\n      eventContext: (prInfo as any)?.eventContext || {},\n      __outputHistory: outputHistory,\n      ai: {\n        ...(stepConfig.ai || {}),\n        timeout: stepConfig.ai?.timeout || 1800000,\n        debug: !!context.debug,\n      },\n    };\n\n    const result = await provider.execute(\n      prInfo,\n      providerConfig,\n      dependencyResults,\n      enrichedExecutionContext\n    );\n    const output = (result as any).output;\n\n    logger.info(`[OnInit] Step ${stepName} completed`);\n    return output;\n  } else if ('workflow' in item) {\n    // Workflow invocation\n    const workflowName = item.workflow;\n\n    if (!workflowName) {\n      throw new Error('Workflow name is required in on_init workflow invocation');\n    }\n\n    logger.info(`[OnInit] Executing workflow: ${workflowName}`);\n\n    const tempCheckConfig: CheckConfig = {\n      type: 'workflow',\n      workflow: workflowName,\n      args: renderedArgs,\n      overrides: item.overrides,\n      output_mapping: item.output_mapping,\n    };\n\n    const provider = providerRegistry.getProviderOrThrow('workflow');\n    const result = await provider.execute(\n      prInfo,\n      tempCheckConfig,\n      dependencyResults,\n      executionContext\n    );\n    const output = (result as any).output;\n\n    logger.info(`[OnInit] Workflow ${workflowName} completed`);\n    return output;\n  }\n\n  throw new Error('Invalid on_init invocation: must specify tool, step, or workflow');\n}\n\n/**\n * Execute a tool invocation from on_init.run\n *\n * @deprecated Use executeInvocation instead for better code reuse\n */\nexport async function executeToolInvocation(\n  item: OnInitToolInvocation,\n  context: EngineContext,\n  scope: Scope,\n  prInfo: any,\n  dependencyResults: Record<string, unknown>,\n  executionContext: any\n): Promise<unknown> {\n  return executeInvocation(item, context, scope, prInfo, dependencyResults, executionContext);\n}\n\n/**\n * Execute a step invocation from on_init.run\n *\n * @deprecated Use executeInvocation instead for better code reuse\n */\nexport async function executeStepInvocation(\n  item: OnInitStepInvocation,\n  context: EngineContext,\n  scope: Scope,\n  prInfo: any,\n  dependencyResults: Record<string, unknown>,\n  executionContext: any\n): Promise<unknown> {\n  return executeInvocation(item, context, scope, prInfo, dependencyResults, executionContext);\n}\n\n/**\n * Execute a workflow invocation from on_init.run\n *\n * @deprecated Use executeInvocation instead for better code reuse\n */\nexport async function executeWorkflowInvocation(\n  item: OnInitWorkflowInvocation,\n  context: EngineContext,\n  scope: Scope,\n  prInfo: any,\n  dependencyResults: Record<string, unknown>,\n  executionContext: any\n): Promise<unknown> {\n  return executeInvocation(item, context, scope, prInfo, dependencyResults, executionContext);\n}\n","import type { EngineContext, EngineEvent, EngineState, RunState } from '../../types/engine';\nimport type { ReviewIssue, ReviewSummary } from '../../reviewer';\nimport type { CheckExecutionStats } from '../../types/execution';\nimport type { CheckConfig } from '../../types/config';\nimport { logger } from '../../logger';\nimport { withActiveSpan } from '../../telemetry/trace-helpers';\nimport { captureCheckOutput } from '../../telemetry/state-capture';\nimport { emitMermaidFromMarkdown } from '../../utils/mermaid-telemetry';\nimport { emitNdjsonFallback } from '../../telemetry/fallback-ndjson';\nimport { buildOutputHistoryFromJournal } from './history-snapshot';\nimport { buildDependencyResultsWithScope } from './dependency-gating';\nimport { renderTemplateContent } from './template-renderer';\nimport { hasFatalIssues } from './stats-manager';\nimport { handleRouting } from '../states/routing';\nimport { executeCheckWithForEachItems } from './foreach-processor';\nimport { updateStats } from './stats-manager';\nimport type { OnInitConfig, OnInitRunItem } from '../../types/config';\nimport {\n  executeToolInvocation,\n  executeStepInvocation,\n  executeWorkflowInvocation,\n  type Scope,\n} from './on-init-handlers';\nimport { createSecureSandbox, compileAndRun } from '../../utils/sandbox';\nimport { resolveWorkflowInputs } from '../context/workflow-inputs';\nimport { executeWithSandboxRouting } from '../dispatch/sandbox-routing';\nimport { applyPolicyGate } from './policy-gate';\n\n/**\n * Normalize on_init.run items to array format\n * Supports backward compatibility with string arrays\n */\nfunction normalizeRunItems(run: OnInitRunItem[]): OnInitRunItem[] {\n  if (!Array.isArray(run)) return [];\n  return run.filter(Boolean);\n}\n\n/**\n * Detect the type of on_init invocation\n * @returns 'tool' | 'step' | 'workflow'\n */\nfunction detectInvocationType(item: OnInitRunItem): 'tool' | 'step' | 'workflow' {\n  if (typeof item === 'string') return 'step'; // Backward compat: plain step name\n  if ('tool' in item) return 'tool';\n  if ('workflow' in item) return 'workflow';\n  if ('step' in item) return 'step';\n  // Throw error for unknown types instead of silently falling back\n  throw new Error(\n    `Invalid on_init item type: ${JSON.stringify(item)}. Must specify tool, step, or workflow.`\n  );\n}\n\n/**\n * Execute a single on_init item (tool, step, or workflow)\n */\nasync function executeOnInitItem(\n  item: OnInitRunItem,\n  context: EngineContext,\n  scope: Scope,\n  prInfo: any,\n  dependencyResults: Record<string, unknown>,\n  executionContext: any\n): Promise<{ output: unknown; outputName: string }> {\n  const itemType = detectInvocationType(item);\n\n  let output: unknown;\n  let outputName: string;\n\n  switch (itemType) {\n    case 'tool': {\n      const toolItem = item as { tool: string; with?: Record<string, unknown>; as?: string };\n      output = await executeToolInvocation(\n        toolItem,\n        context,\n        scope,\n        prInfo,\n        dependencyResults,\n        executionContext\n      );\n      outputName = toolItem.as || toolItem.tool;\n      break;\n    }\n\n    case 'step': {\n      if (typeof item === 'string') {\n        // Backward compat: plain step name\n        const stepItem = { step: item, with: undefined, as: item };\n        output = await executeStepInvocation(\n          stepItem,\n          context,\n          scope,\n          prInfo,\n          dependencyResults,\n          executionContext\n        );\n        outputName = item;\n      } else {\n        const stepItem = item as { step: string; with?: Record<string, unknown>; as?: string };\n        output = await executeStepInvocation(\n          stepItem,\n          context,\n          scope,\n          prInfo,\n          dependencyResults,\n          executionContext\n        );\n        outputName = stepItem.as || stepItem.step;\n      }\n      break;\n    }\n\n    case 'workflow': {\n      const workflowItem = item as {\n        workflow: string;\n        with?: Record<string, unknown>;\n        as?: string;\n      };\n      output = await executeWorkflowInvocation(\n        workflowItem,\n        context,\n        scope,\n        prInfo,\n        dependencyResults,\n        executionContext\n      );\n      outputName = workflowItem.as || workflowItem.workflow;\n      break;\n    }\n\n    default:\n      throw new Error(`Unknown on_init item type: ${itemType}`);\n  }\n\n  return { output, outputName };\n}\n\n/**\n * Handle on_init lifecycle hook\n *\n * Executes preprocessing/setup tasks BEFORE the main check execution.\n * Supports:\n * - Static run items (on_init.run)\n * - Dynamic run items (on_init.run_js)\n * - Tool, step, and workflow invocations\n * - Custom argument passing via 'with'\n * - Custom output naming via 'as'\n *\n * Outputs are stored in dependencyResults and available as {{ outputs[\"name\"] }}\n */\n// Maximum number of on_init items to prevent abuse\nconst MAX_ON_INIT_ITEMS = 50;\n\nasync function handleOnInit(\n  checkId: string,\n  onInit: OnInitConfig,\n  context: EngineContext,\n  scope: Scope,\n  prInfo: any,\n  dependencyResults: Record<string, unknown>,\n  executionContext: any\n): Promise<void> {\n  logger.info(`[OnInit] Processing on_init for check: ${checkId}`);\n\n  // Prevent nested on_init execution to avoid recursion\n  if (executionContext.__onInitDepth && executionContext.__onInitDepth > 0) {\n    logger.warn(\n      `[OnInit] Skipping nested on_init for ${checkId} (depth: ${executionContext.__onInitDepth})`\n    );\n    return;\n  }\n\n  let runItems: OnInitRunItem[] = [];\n\n  // Evaluate run_js if provided (takes precedence over run)\n  if (onInit.run_js) {\n    logger.info(`[OnInit] Evaluating run_js for ${checkId}`);\n\n    try {\n      const sandbox = createSecureSandbox();\n\n      const result = await compileAndRun<OnInitRunItem[]>(\n        sandbox,\n        onInit.run_js,\n        {\n          pr: prInfo,\n          outputs: dependencyResults,\n          env: process.env,\n          args: executionContext.args || {},\n        },\n        { injectLog: true, wrapFunction: false }\n      );\n      if (Array.isArray(result)) {\n        runItems = result;\n      } else {\n        logger.warn(`[OnInit] run_js for ${checkId} did not return an array, got ${typeof result}`);\n      }\n    } catch (error) {\n      const err = error instanceof Error ? error : new Error(String(error));\n      logger.error(`[OnInit] Error evaluating run_js for ${checkId}: ${err.message}`);\n      // Preserve original error with context\n      const wrappedError = new Error(`on_init.run_js evaluation failed: ${err.message}`);\n      wrappedError.stack = err.stack;\n      throw wrappedError;\n    }\n  } else if (onInit.run) {\n    // Use static run items\n    runItems = normalizeRunItems(onInit.run);\n  }\n\n  if (runItems.length === 0) {\n    logger.info(`[OnInit] No items to run for ${checkId}`);\n    return;\n  }\n\n  // Check for excessive number of items\n  if (runItems.length > MAX_ON_INIT_ITEMS) {\n    const msg = `on_init for ${checkId} has ${runItems.length} items, exceeding maximum of ${MAX_ON_INIT_ITEMS}`;\n    logger.error(`[OnInit] ${msg}`);\n    throw new Error(msg);\n  }\n\n  logger.info(`[OnInit] Running ${runItems.length} items for ${checkId}`);\n\n  // Track depth to prevent nested on_init execution\n  const originalDepth = executionContext.__onInitDepth || 0;\n  executionContext.__onInitDepth = originalDepth + 1;\n\n  try {\n    // Execute items sequentially (preserves ordering)\n    for (let i = 0; i < runItems.length; i++) {\n      const item = runItems[i];\n      const itemType = detectInvocationType(item);\n      const itemName =\n        typeof item === 'string'\n          ? item\n          : 'tool' in item\n            ? item.tool\n            : 'step' in item\n              ? item.step\n              : 'workflow' in item\n                ? item.workflow\n                : 'unknown';\n\n      logger.info(`[OnInit] [${i + 1}/${runItems.length}] Executing ${itemType}: ${itemName}`);\n\n      try {\n        const { output, outputName } = await executeOnInitItem(\n          item,\n          context,\n          scope,\n          prInfo,\n          dependencyResults,\n          executionContext\n        );\n\n        // Store output in dependencyResults for subsequent items and main check\n        dependencyResults[outputName] = output;\n        logger.info(`[OnInit] Stored output as: ${outputName}`);\n      } catch (error) {\n        const err = error instanceof Error ? error : new Error(String(error));\n        logger.error(\n          `[OnInit] Error executing ${itemType} ${itemName} for ${checkId}: ${err.message}`\n        );\n        // Preserve original error with context\n        const wrappedError = new Error(`on_init ${itemType} '${itemName}' failed: ${err.message}`);\n        wrappedError.stack = err.stack;\n        throw wrappedError;\n      }\n    }\n\n    logger.info(`[OnInit] Completed all on_init items for ${checkId}`);\n  } finally {\n    // Restore original depth\n    executionContext.__onInitDepth = originalDepth;\n  }\n}\n\n/**\n * Execute a single check with provider integration (non-forEach path, but handles forEach parent outputs\n * and can redirect to forEach processor upstream).\n *\n * Note: for deciding whether to run, this function relies on the provided evaluateIf callback.\n */\nexport async function executeSingleCheck(\n  checkId: string,\n  context: EngineContext,\n  state: RunState,\n  emitEvent: (event: EngineEvent) => void,\n  transition: (newState: EngineState) => void,\n  evaluateIf: (\n    checkId: string,\n    checkConfig: CheckConfig,\n    context: EngineContext,\n    state: RunState\n  ) => Promise<boolean>,\n  scopeOverride?: Array<{ check: string; index: number }>\n): Promise<ReviewSummary> {\n  const checkConfig = context.config.checks?.[checkId];\n\n  // Evaluate 'if' condition before execution\n  if (checkConfig?.if) {\n    const shouldRun = await evaluateIf(checkId, checkConfig, context, state);\n    if (!shouldRun) {\n      logger.info(\n        `â­  Skipped (if: ${checkConfig.if.substring(0, 40)}${checkConfig.if.length > 40 ? '...' : ''})`\n      );\n      const emptyResult: ReviewSummary = { issues: [] };\n      try {\n        Object.defineProperty(emptyResult as any, '__skipped', {\n          value: 'if_condition',\n          enumerable: false,\n        });\n      } catch {}\n      state.completedChecks.add(checkId);\n      const stats: CheckExecutionStats = {\n        checkName: checkId,\n        totalRuns: 0,\n        successfulRuns: 0,\n        failedRuns: 0,\n        skippedRuns: 0,\n        skipped: true,\n        skipReason: 'if_condition',\n        skipCondition: checkConfig.if,\n        totalDuration: 0,\n        issuesFound: 0,\n        issuesBySeverity: { critical: 0, error: 0, warning: 0, info: 0 },\n      };\n      state.stats.set(checkId, stats);\n      logger.info(`[LevelDispatch] Recorded skip stats for ${checkId}: skipReason=if_condition`);\n      try {\n        context.journal.commitEntry({\n          sessionId: context.sessionId,\n          checkId,\n          result: emptyResult as any,\n          event: context.event || 'manual',\n          scope: [],\n        });\n      } catch (error) {\n        logger.warn(`[LevelDispatch] Failed to commit skipped result to journal: ${error}`);\n      }\n      emitEvent({ type: 'CheckCompleted', checkId, scope: [], result: emptyResult });\n      return emptyResult;\n    }\n  }\n\n  // Policy engine gating â€” after if-condition, before dependency gating\n  if (context.policyEngine && checkConfig) {\n    const gate = await applyPolicyGate(checkId, checkConfig, context.policyEngine);\n    if (gate.skip) {\n      const emptyResult: ReviewSummary = { issues: [] };\n      try {\n        Object.defineProperty(emptyResult as any, '__skipped', {\n          value: 'policy_denied',\n          enumerable: false,\n        });\n      } catch {}\n      state.completedChecks.add(checkId);\n      const stats: CheckExecutionStats = {\n        checkName: checkId,\n        totalRuns: 0,\n        successfulRuns: 0,\n        failedRuns: 0,\n        skippedRuns: 0,\n        skipped: true,\n        skipReason: 'policy_denied',\n        skipCondition: gate.reason || 'policy denied',\n        totalDuration: 0,\n        issuesFound: 0,\n        issuesBySeverity: { critical: 0, error: 0, warning: 0, info: 0 },\n      };\n      state.stats.set(checkId, stats);\n      logger.info(`[LevelDispatch] Recorded skip stats for ${checkId}: skipReason=policy_denied`);\n      try {\n        context.journal.commitEntry({\n          sessionId: context.sessionId,\n          checkId,\n          result: emptyResult as any,\n          event: context.event || 'manual',\n          scope: [],\n        });\n      } catch (error) {\n        logger.warn(`[LevelDispatch] Failed to commit policy-skipped result to journal: ${error}`);\n      }\n      emitEvent({ type: 'CheckCompleted', checkId, scope: [], result: emptyResult });\n      return emptyResult;\n    }\n  }\n\n  const dependencies = checkConfig?.depends_on || [];\n  const depList = Array.isArray(dependencies) ? dependencies : [dependencies];\n\n  // Dependency gating with continue_on_failure and OR groups\n  const failedChecks = (state as any).failedChecks as Set<string> | undefined;\n  const tokens = depList.filter(Boolean) as string[];\n  const groupSatisfied = (token: string): boolean => {\n    const options = token.includes('|')\n      ? token\n          .split('|')\n          .map(s => s.trim())\n          .filter(Boolean)\n      : [token];\n    for (const opt of options) {\n      const depCfg: any = context.config.checks?.[opt];\n      const cont = !!(depCfg && depCfg.continue_on_failure === true);\n      const st = state.stats.get(opt);\n      const skipped = !!(st && (st as any).skipped === true);\n      const skipReason = (st as any)?.skipReason;\n      // forEach_empty is not a failure - it means there was nothing to process, which is valid\n      // The dependent step should still run (with empty data from the forEach step)\n      const skippedDueToEmptyForEach = skipped && skipReason === 'forEach_empty';\n      // Don't treat forEach_empty as a failure even if it's in failedChecks\n      // (forEach_empty checks are added to failedChecks for cascading within forEach chains,\n      // but should not be treated as failures for non-forEach dependents)\n      const wasMarkedFailed =\n        !!(failedChecks && failedChecks.has(opt)) && !skippedDueToEmptyForEach;\n      const failedOnly = !!(st && (st.failedRuns || 0) > 0 && (st.successfulRuns || 0) === 0);\n      const satisfied =\n        (!skipped || skippedDueToEmptyForEach) && ((!failedOnly && !wasMarkedFailed) || cont);\n      if (satisfied) return true;\n    }\n    return false;\n  };\n\n  if (tokens.length > 0) {\n    let allOk = true;\n    for (const t of tokens) {\n      if (!groupSatisfied(t)) {\n        allOk = false;\n        break;\n      }\n    }\n    if (!allOk) {\n      const emptyResult: ReviewSummary = { issues: [] };\n      try {\n        Object.defineProperty(emptyResult as any, '__skipped', {\n          value: 'dependency_failed',\n          enumerable: false,\n        });\n      } catch {}\n      state.completedChecks.add(checkId);\n      (state as any).failedChecks = (state as any).failedChecks || new Set<string>();\n      (state as any).failedChecks.add(checkId);\n      const stats: CheckExecutionStats = {\n        checkName: checkId,\n        totalRuns: 0,\n        successfulRuns: 0,\n        failedRuns: 0,\n        skippedRuns: 0,\n        skipped: true,\n        skipReason: 'dependency_failed',\n        totalDuration: 0,\n        issuesFound: 0,\n        issuesBySeverity: { critical: 0, error: 0, warning: 0, info: 0 },\n      };\n      state.stats.set(checkId, stats);\n      try {\n        context.journal.commitEntry({\n          sessionId: context.sessionId,\n          checkId,\n          result: emptyResult as any,\n          event: context.event || 'manual',\n          scope: [],\n        });\n      } catch (error) {\n        logger.warn(`[LevelDispatch] Failed to commit empty result to journal: ${error}`);\n      }\n      emitEvent({ type: 'CheckCompleted', checkId, scope: [], result: emptyResult });\n      return emptyResult;\n    }\n  }\n\n  // Banner-style log when a check actually starts executing. This is emitted\n  // after all gating (if/depends_on) has passed so it only appears for real\n  // runs, and gives a clear visual separator in the logs between checks.\n  try {\n    const wave = state.wave;\n    const level = (state as any).currentLevel ?? '?';\n    const banner = `â”â”â” CHECK ${checkId} (wave ${wave}, level ${level}) â”â”â”`;\n\n    // When running in a TTY, colour the entire banner line for extra\n    // visibility; keep plain text for JSON/SARIF or non-TTY environments.\n    const isTTY = typeof process !== 'undefined' ? !!process.stderr.isTTY : false;\n    const outputFormat = process.env.VISOR_OUTPUT_FORMAT || '';\n    const isJsonLike = outputFormat === 'json' || outputFormat === 'sarif';\n\n    if (isTTY && !isJsonLike) {\n      const cyan = '\\x1b[36m';\n      const reset = '\\x1b[0m';\n      logger.info(`${cyan}${banner}${reset}`);\n    } else {\n      logger.info(banner);\n    }\n  } catch {\n    // best-effort only\n  }\n\n  let forEachParent: string | undefined;\n  let forEachItems: unknown[] | undefined;\n  for (const depId of depList) {\n    if (!depId) continue;\n    try {\n      const snapshotId = context.journal.beginSnapshot();\n      const { ContextView } = require('../../snapshot-store');\n      const contextView = new ContextView(\n        context.journal,\n        context.sessionId,\n        snapshotId,\n        [],\n        context.event\n      );\n      const depResult: any = contextView.get(depId);\n      if (depResult?.forEachItems && Array.isArray(depResult.forEachItems)) {\n        forEachParent = depId;\n        forEachItems = depResult.forEachItems;\n        break;\n      }\n    } catch {}\n  }\n\n  // If there's a forEach parent and items, decide fanout here (map vs reduce)\n  if (forEachParent && forEachItems !== undefined) {\n    let fanoutMode: 'map' | 'reduce' = 'reduce';\n    const explicit = (checkConfig as any)?.fanout as 'map' | 'reduce' | undefined;\n    if (explicit === 'map' || explicit === 'reduce') fanoutMode = explicit;\n    else {\n      const providerType = context.checks[checkId]?.providerType || '';\n      const reduceProviders = new Set(['log', 'memory', 'script', 'workflow', 'noop']);\n      fanoutMode = reduceProviders.has(providerType) ? 'reduce' : 'map';\n    }\n    if (fanoutMode === 'map') {\n      if ((forEachItems as unknown[]).length === 0) {\n        logger.info(`â­  Skipped (forEach parent \"${forEachParent}\" has 0 items)`);\n        const emptyResult: ReviewSummary = { issues: [] };\n        try {\n          Object.defineProperty(emptyResult as any, '__skipped', {\n            value: 'forEach_empty',\n            enumerable: false,\n          });\n        } catch {}\n        state.completedChecks.add(checkId);\n        // Mark as failed for dependents if parent failed\n        let derivedSkipReason: 'forEach_empty' | 'dependency_failed' = 'forEach_empty';\n        try {\n          const parentFailed =\n            !!((state as any).failedChecks && (state as any).failedChecks.has(forEachParent)) ||\n            (() => {\n              const s = state.stats.get(forEachParent);\n              return !!(s && (s.failedRuns || 0) > 0);\n            })();\n          if (parentFailed) derivedSkipReason = 'dependency_failed';\n        } catch {}\n        const stats: CheckExecutionStats = {\n          checkName: checkId,\n          totalRuns: 0,\n          successfulRuns: 0,\n          failedRuns: 0,\n          skippedRuns: 0,\n          skipped: true,\n          skipReason: derivedSkipReason,\n          totalDuration: 0,\n          issuesFound: 0,\n          issuesBySeverity: { critical: 0, error: 0, warning: 0, info: 0 },\n        };\n        state.stats.set(checkId, stats);\n        try {\n          context.journal.commitEntry({\n            sessionId: context.sessionId,\n            checkId,\n            result: emptyResult as any,\n            event: context.event || 'manual',\n            scope: [],\n          });\n        } catch (error) {\n          logger.warn(`[LevelDispatch] Failed to commit empty result to journal: ${error}`);\n        }\n        emitEvent({ type: 'CheckCompleted', checkId, scope: [], result: emptyResult });\n        return emptyResult;\n      }\n      return await executeCheckWithForEachItems(\n        checkId,\n        forEachParent,\n        forEachItems as unknown[],\n        context,\n        state,\n        emitEvent,\n        transition\n      );\n    }\n    // fanout reduce â†’ fall through to normal single execution\n  }\n\n  // Normal execution without forEach\n  const scope: Array<{ check: string; index: number }> = scopeOverride || [];\n  emitEvent({ type: 'CheckScheduled', checkId, scope });\n\n  const startTime = Date.now();\n  const dispatch: any = {\n    id: `${checkId}-${Date.now()}`,\n    checkId,\n    scope,\n    provider: context.checks[checkId]?.providerType || 'unknown',\n    startMs: startTime,\n    attempts: 1,\n  };\n  state.activeDispatches.set(checkId, dispatch);\n\n  try {\n    if (!checkConfig) throw new Error(`Check configuration not found: ${checkId}`);\n    const providerType = checkConfig.type || 'ai';\n    const providerRegistry =\n      require('../../providers/check-provider-registry').CheckProviderRegistry.getInstance();\n    const provider = providerRegistry.getProviderOrThrow(providerType);\n\n    const outputHistory = buildOutputHistoryFromJournal(context);\n    // Resolve workflow inputs from config or context (centralized logic)\n    const workflowInputs = resolveWorkflowInputs(checkConfig, context);\n\n    const providerConfig: any = {\n      type: providerType,\n      checkName: checkId,\n      prompt: checkConfig.prompt,\n      exec: checkConfig.exec,\n      schema: checkConfig.schema,\n      group: checkConfig.group,\n      focus: checkConfig.focus || mapCheckNameToFocus(checkId),\n      transform: checkConfig.transform,\n      transform_js: checkConfig.transform_js,\n      env: checkConfig.env,\n      forEach: checkConfig.forEach,\n      ...checkConfig,\n      eventContext: (context.prInfo as any)?.eventContext || {},\n      __outputHistory: outputHistory,\n      // Propagate workflow inputs for template access via {{ inputs.* }}\n      workflowInputs,\n      ai: {\n        ...(checkConfig.ai || {}),\n        timeout: checkConfig.ai?.timeout || 1800000,\n        debug: !!context.debug,\n      },\n    };\n\n    const dependencyResults = buildDependencyResultsWithScope(checkId, checkConfig, context, scope);\n    const prInfo: any = context.prInfo || {\n      number: 1,\n      title: 'State Machine Execution',\n      author: 'system',\n      eventType: context.event || 'manual',\n      eventContext: {},\n      files: [],\n      commits: [],\n    };\n    // Derive AI session reuse context for this check (self-mode only for now).\n    // When reuse_ai_session: 'self' is configured, look up the last root-scope\n    // journal entry for this check in the current engine session and expose its\n    // sessionId via ExecutionContext so ai-check-provider can call\n    // executeReviewWithSessionReuse() against the same ProbeAgent session.\n    let parentSessionId: string | undefined;\n    let reuseSession = false;\n    try {\n      const reuseCfg: unknown = (checkConfig as any).reuse_ai_session;\n      if (reuseCfg === 'self') {\n        const snapshotId = context.journal.beginSnapshot();\n        const visible = context.journal.readVisible(\n          context.sessionId,\n          snapshotId,\n          context.event as any\n        );\n        // Prefer the most recent root-scope result for this check\n        const prior = visible.filter(\n          e => e.checkId === checkId && (!e.scope || e.scope.length === 0)\n        );\n        if (prior.length > 0) {\n          const last = prior[prior.length - 1];\n          const sess = (last.result as any)?.sessionId;\n          if (typeof sess === 'string' && sess.length > 0) {\n            parentSessionId = sess;\n            reuseSession = true;\n          }\n        }\n      }\n    } catch {\n      // Best-effort only â€“ fall back to normal (non-reuse) execution on error.\n      parentSessionId = undefined;\n      reuseSession = false;\n    }\n\n    const executionContext = {\n      ...context.executionContext,\n      _engineMode: context.mode,\n      _parentContext: context,\n      _parentState: state,\n      // Explicitly propagate workspace reference for nested workflows\n      workspace: context.workspace,\n    };\n\n    // Attach session reuse hints for providers that support them (AI, Claude Code, etc).\n    if (reuseSession && parentSessionId) {\n      (executionContext as any).parentSessionId = parentSessionId;\n      (executionContext as any).reuseSession = true;\n    }\n\n    // Handle on_init lifecycle hook BEFORE main execution\n    if (checkConfig.on_init) {\n      try {\n        // Convert Map to Record for on_init handlers\n        const dependencyResultsMap: Record<string, unknown> = {};\n        for (const [key, value] of dependencyResults.entries()) {\n          dependencyResultsMap[key] = value;\n        }\n\n        await handleOnInit(\n          checkId,\n          checkConfig.on_init,\n          context,\n          scope,\n          prInfo,\n          dependencyResultsMap,\n          executionContext\n        );\n\n        // Merge on_init outputs back into dependencyResults Map\n        for (const [key, value] of Object.entries(dependencyResultsMap)) {\n          if (!dependencyResults.has(key)) {\n            // Only add new outputs from on_init\n            dependencyResults.set(key, value as any);\n          }\n        }\n      } catch (error) {\n        const err = error instanceof Error ? error : new Error(String(error));\n        logger.error(`[LevelDispatch] on_init failed for ${checkId}: ${err.message}`);\n        // Rethrow to fail the check execution\n        throw err;\n      }\n    }\n\n    try {\n      emitNdjsonFallback('visor.provider', {\n        'visor.check.id': checkId,\n        'visor.provider.type': providerType,\n      });\n    } catch {}\n\n    const result = await withActiveSpan(\n      `visor.check.${checkId}`,\n      {\n        'visor.check.id': checkId,\n        'visor.check.type': providerType,\n        session_id: context.sessionId,\n        wave: state.wave,\n      },\n      async span => {\n        const res = await executeWithSandboxRouting(\n          checkId,\n          checkConfig,\n          context,\n          prInfo,\n          dependencyResults,\n          checkConfig.ai?.timeout || 1800000,\n          () => provider.execute(prInfo, providerConfig, dependencyResults, executionContext)\n        );\n        // Capture output in span for trace visualization\n        try {\n          captureCheckOutput(span, (res as any).output);\n        } catch {}\n        return res;\n      }\n    );\n\n    const enrichedIssues = (result.issues || []).map((issue: ReviewIssue) => ({\n      ...issue,\n      checkName: checkId,\n      ruleId: `${checkId}/${issue.ruleId || 'unknown'}`,\n      group: checkConfig.group,\n      schema: typeof checkConfig.schema === 'object' ? 'custom' : checkConfig.schema,\n      template: checkConfig.template,\n      timestamp: Date.now(),\n    }));\n    const enrichedResult: any = { ...result, issues: enrichedIssues };\n\n    // Handle forEach:true output from provider (convert to items)\n    let isForEach = false;\n    let forEachItemsLocal: unknown[] | undefined;\n    if (checkConfig.forEach) {\n      const output = (result as any).output;\n      if (Array.isArray(output)) {\n        isForEach = true;\n        forEachItemsLocal = output;\n        enrichedResult.isForEach = true;\n        enrichedResult.forEachItems = output;\n      } else {\n        if (context.debug)\n          logger.warn(\n            `[LevelDispatch] Check ${checkId} has forEach:true but output is not an array: ${typeof output}, converting to single-item array`\n          );\n        isForEach = true;\n        forEachItemsLocal = [output];\n        enrichedResult.isForEach = true;\n        enrichedResult.forEachItems = [output];\n      }\n    }\n    if ((result as any).isForEach) enrichedResult.isForEach = true;\n    if ((result as any).forEachItems) enrichedResult.forEachItems = (result as any).forEachItems;\n    if ((result as any).forEachItemResults)\n      enrichedResult.forEachItemResults = (result as any).forEachItemResults;\n    if ((result as any).forEachFatalMask)\n      enrichedResult.forEachFatalMask = (result as any).forEachFatalMask;\n\n    let renderedContent: string | undefined;\n    try {\n      renderedContent = await renderTemplateContent(checkId, checkConfig, enrichedResult);\n      if (renderedContent) emitMermaidFromMarkdown(checkId, renderedContent, 'content');\n    } catch (error) {\n      logger.warn(`[LevelDispatch] Failed to render template for ${checkId}: ${error}`);\n    }\n\n    let outputWithTimestamp: any = undefined;\n    if ((result as any).output !== undefined) {\n      const output = (result as any).output;\n      if (output !== null && typeof output === 'object' && !Array.isArray(output))\n        outputWithTimestamp = { ...output, ts: Date.now() };\n      else outputWithTimestamp = output;\n    }\n\n    const enrichedResultWithContent = renderedContent\n      ? { ...enrichedResult, content: renderedContent }\n      : enrichedResult;\n    const enrichedResultWithTimestamp =\n      outputWithTimestamp !== undefined\n        ? { ...enrichedResultWithContent, output: outputWithTimestamp }\n        : enrichedResultWithContent;\n\n    state.completedChecks.add(checkId);\n    const currentWaveCompletions = (state as any).currentWaveCompletions as Set<string> | undefined;\n    if (currentWaveCompletions) currentWaveCompletions.add(checkId);\n\n    // Process routing (fail_if, on_success, on_fail) BEFORE storing in journal\n    // Same behavior as inlined version in LevelDispatch so routing errors are captured.\n    try {\n      logger.info(`[LevelDispatch] Calling handleRouting for ${checkId}`);\n    } catch {}\n    const wasHalted = await handleRouting(context, state, transition, emitEvent, {\n      checkId,\n      scope,\n      result: enrichedResult,\n      checkConfig: checkConfig as CheckConfig,\n      success: !hasFatalIssues(enrichedResult),\n    });\n\n    // If execution was halted, return the current result (with halt issue added)\n    if (wasHalted) {\n      logger.info(`[LevelDispatch] Execution halted after routing for ${checkId}`);\n      return enrichedResult;\n    }\n\n    try {\n      const commitResult: any = {\n        ...enrichedResult,\n        ...(renderedContent ? { content: renderedContent } : {}),\n        ...((result as any).output !== undefined\n          ? outputWithTimestamp !== undefined\n            ? { output: outputWithTimestamp }\n            : { output: (result as any).output }\n          : {}),\n      };\n      context.journal.commitEntry({\n        sessionId: context.sessionId,\n        checkId,\n        result: commitResult,\n        event: context.event || 'manual',\n        scope,\n      });\n    } catch (error) {\n      logger.warn(`[LevelDispatch] Failed to commit to journal: ${error}`);\n    }\n\n    // Update stats for this single-run execution to ensure visibility\n    try {\n      const duration = Date.now() - startTime;\n      updateStats([{ checkId, result: enrichedResult as any, duration }], state, false);\n    } catch {}\n\n    if (isForEach) {\n      try {\n        const existing = state.stats.get(checkId);\n        const aggStats: CheckExecutionStats = existing || {\n          checkName: checkId,\n          totalRuns: 0,\n          successfulRuns: 0,\n          failedRuns: 0,\n          skippedRuns: 0,\n          skipped: false,\n          totalDuration: 0,\n          issuesFound: 0,\n          issuesBySeverity: { critical: 0, error: 0, warning: 0, info: 0 },\n        };\n        aggStats.totalRuns++;\n        const hasFatal = hasFatalIssues(enrichedResultWithTimestamp as any);\n        if (hasFatal) aggStats.failedRuns++;\n        else aggStats.successfulRuns++;\n        const items = (enrichedResultWithTimestamp as any).forEachItems;\n        if (Array.isArray(items)) aggStats.outputsProduced = items.length;\n        state.stats.set(checkId, aggStats);\n      } catch {}\n    }\n\n    if (isForEach && forEachItemsLocal && Array.isArray(forEachItemsLocal)) {\n      for (let itemIndex = 0; itemIndex < forEachItemsLocal.length; itemIndex++) {\n        const itemScope: Array<{ check: string; index: number }> = [\n          { check: checkId, index: itemIndex },\n        ];\n        const item = forEachItemsLocal[itemIndex];\n        try {\n          context.journal.commitEntry({\n            sessionId: context.sessionId,\n            checkId,\n            result: { issues: [], output: item } as any,\n            event: context.event || 'manual',\n            scope: itemScope,\n          });\n        } catch (error) {\n          logger.warn(\n            `[LevelDispatch] Failed to commit per-item journal for ${checkId} item ${itemIndex}: ${error}`\n          );\n        }\n      }\n    }\n\n    state.activeDispatches.delete(checkId);\n    emitEvent({\n      type: 'CheckCompleted',\n      checkId,\n      scope,\n      result: {\n        ...enrichedResult,\n        output: (result as any).output,\n        content: renderedContent || (result as any).content,\n      },\n    });\n    return enrichedResult;\n  } catch (error) {\n    const err = error instanceof Error ? error : new Error(String(error));\n    logger.error(`[LevelDispatch] Error executing check ${checkId}: ${err.message}`);\n    state.activeDispatches.delete(checkId);\n    emitEvent({\n      type: 'CheckErrored',\n      checkId,\n      scope,\n      error: { message: err.message, stack: err.stack, name: err.name },\n    });\n    throw err;\n  }\n}\n\nfunction mapCheckNameToFocus(checkName: string): string {\n  const focusMap: Record<string, string> = {\n    security: 'security',\n    performance: 'performance',\n    style: 'style',\n    architecture: 'architecture',\n  };\n  return focusMap[checkName] || 'all';\n}\n","/**\n * LevelDispatch State Handler\n *\n * Responsibilities:\n * - Pop next topological level from queue\n * - Spawn tasks up to maxParallelism\n * - Handle session reuse barriers\n * - Support fail-fast\n * - Support debug pause\n * - Execute actual provider logic\n * - Transition back to WavePlanning or handle errors\n *\n * M2: Integrates actual provider execution and routing\n */\n\nimport type {\n  EngineContext,\n  RunState,\n  EngineState,\n  EngineEvent,\n  DispatchRecord,\n} from '../../types/engine';\nimport { logger } from '../../logger';\nimport type { ReviewSummary, ReviewIssue } from '../../reviewer';\nimport type { CheckExecutionStats } from '../../types/execution';\nimport type { CheckProviderConfig } from '../../providers/check-provider.interface';\nimport type { CheckConfig } from '../../types/config';\nimport { handleRouting, checkLoopBudget } from './routing';\nimport { withActiveSpan, setSpanAttributes, addEvent } from '../../telemetry/trace-helpers';\nimport { captureCheckOutput } from '../../telemetry/state-capture';\nimport { emitMermaidFromMarkdown } from '../../utils/mermaid-telemetry';\nimport { emitNdjsonSpanWithEvents, emitNdjsonFallback } from '../../telemetry/fallback-ndjson';\nimport { FailureConditionEvaluator } from '../../failure-condition-evaluator';\nimport { resolveWorkflowInputs } from '../context/workflow-inputs';\nimport { executeWithSandboxRouting } from '../dispatch/sandbox-routing';\nimport { applyPolicyGate } from '../dispatch/policy-gate';\nimport { createExtendedLiquid } from '../../liquid-extensions';\n\n/**\n * Render Liquid template expressions in 'with' arguments.\n * This is used to process args from on_success.run with directives.\n */\nasync function renderTemplateArgs(\n  args: Record<string, unknown> | undefined,\n  dependencyResults: Record<string, unknown>,\n  context: EngineContext\n): Promise<Record<string, unknown> | undefined> {\n  if (!args || Object.keys(args).length === 0) {\n    return args;\n  }\n\n  const liquid = createExtendedLiquid();\n  const renderedArgs: Record<string, unknown> = {};\n\n  // Build template context with outputs\n  const templateContext = {\n    outputs: dependencyResults,\n    output: dependencyResults, // Alias for convenience\n    env: process.env,\n    inputs: (context.executionContext as any)?.workflowInputs || {},\n  };\n\n  for (const [key, value] of Object.entries(args)) {\n    if (typeof value === 'string' && value.includes('{{')) {\n      try {\n        renderedArgs[key] = await liquid.parseAndRender(value, templateContext);\n      } catch (error) {\n        logger.warn(`[LevelDispatch] Failed to render template for arg ${key}: ${error}`);\n        renderedArgs[key] = value;\n      }\n    } else {\n      renderedArgs[key] = value;\n    }\n  }\n\n  return renderedArgs;\n}\n\n/**\n * Map check name to focus for AI provider\n * This is a fallback when focus is not explicitly configured\n */\nfunction mapCheckNameToFocus(checkName: string): string {\n  const focusMap: Record<string, string> = {\n    security: 'security',\n    performance: 'performance',\n    style: 'style',\n    architecture: 'architecture',\n  };\n\n  return focusMap[checkName] || 'all';\n}\n\nfunction formatScopeLabel(scope: Array<{ check: string; index: number }> | undefined): string {\n  if (!scope || scope.length === 0) return '';\n  return scope.map(item => `${item.check}:${item.index}`).join('|');\n}\n\nfunction recordOnFinishRoutingEvent(args: {\n  checkId: string;\n  action: 'run' | 'goto';\n  target: string;\n  source: 'run' | 'goto' | 'goto_js' | 'transitions';\n  scope?: Array<{ check: string; index: number }>;\n  gotoEvent?: string;\n}): void {\n  const attrs: Record<string, unknown> = {\n    check_id: args.checkId,\n    trigger: 'on_finish',\n    action: args.action,\n    target: args.target,\n    source: args.source,\n  };\n  const scopeLabel = formatScopeLabel(args.scope);\n  if (scopeLabel) attrs.scope = scopeLabel;\n  if (args.gotoEvent) attrs.goto_event = args.gotoEvent;\n  addEvent('visor.routing', attrs);\n}\n\nfunction getHistoryLimit(): number | undefined {\n  const raw = process.env.VISOR_TEST_HISTORY_LIMIT || process.env.VISOR_OUTPUT_HISTORY_LIMIT;\n  if (!raw) return undefined;\n  const n = parseInt(raw, 10);\n  return Number.isFinite(n) && n > 0 ? n : undefined;\n}\n\n/**\n * Build output history Map from journal for template rendering\n * This matches the format expected by AI providers\n */\nfunction buildOutputHistoryFromJournal(context: EngineContext): Map<string, unknown[]> {\n  const outputHistory = new Map<string, unknown[]>();\n  const limit = getHistoryLimit();\n\n  try {\n    const snapshot = context.journal.beginSnapshot();\n    const allEntries = context.journal.readVisible(context.sessionId, snapshot, undefined);\n\n    // Group by checkId and extract outputs\n    for (const entry of allEntries) {\n      const checkId = entry.checkId;\n      if (!outputHistory.has(checkId)) {\n        outputHistory.set(checkId, []);\n      }\n      // Prefer explicit output; otherwise use the full result (for schemas like\n      // code-review where issues are returned directly). This ensures\n      // outputs_history['security'].last.issues[...] works in prompts and tests.\n      const payload =\n        entry.result.output !== undefined ? entry.result.output : (entry.result as unknown);\n      if (payload !== undefined) {\n        const arr = outputHistory.get(checkId)!;\n        arr.push(payload);\n        if (limit && arr.length > limit) {\n          arr.splice(0, arr.length - limit);\n        }\n      }\n    }\n  } catch (error) {\n    // Silently fail - return empty map\n    logger.debug(`[LevelDispatch] Error building output history: ${error}`);\n  }\n\n  return outputHistory;\n}\n\n/**\n * Evaluate 'if' condition for a check\n *\n * Note: For routing loops to work correctly, 'outputs' should only include\n * results from the CURRENT wave, not from previous waves. This allows\n * checks to re-execute after routing (goto/on_fail/on_success) triggers.\n */\nasync function evaluateIfCondition(\n  checkId: string,\n  checkConfig: CheckConfig,\n  context: EngineContext,\n  state: RunState\n): Promise<boolean> {\n  const ifExpression = checkConfig.if;\n  if (!ifExpression) {\n    return true; // No condition means always run\n  }\n\n  try {\n    const evaluator = new FailureConditionEvaluator();\n\n    // Build previous results for condition evaluation\n    // Default: include only results from the CURRENT wave. This prevents\n    // stale data from causing routing loops in normal execution.\n    const previousResults = new Map<string, ReviewSummary>();\n\n    const currentWaveCompletions = (state as any).currentWaveCompletions as Set<string> | undefined;\n    const useGlobalOutputsFlag = !!((state as any).flags && (state as any).flags.forwardRunActive);\n    const waveKind = ((state as any).flags && (state as any).flags.waveKind) || undefined;\n    // Heuristic: only allow global outputs for guards on checks that actually\n    // have dependencies. Checks without deps (e.g., top-level prompts like\n    // 'ask') should continue to see an empty outputs set so they can re-run\n    // during forward-run waves triggered by goto/on_fail.\n    const hasDeps = (() => {\n      try {\n        const deps = (checkConfig as any)?.depends_on;\n        if (!deps) return false;\n        if (Array.isArray(deps)) return deps.length > 0;\n        return typeof deps === 'string' ? deps.trim().length > 0 : false;\n      } catch {\n        return false;\n      }\n    })();\n    // Steps with dependencies should always see outputs from all completed steps.\n    // In forward-run waves (from on_success/on_fail goto), guards should see the\n    // latest global outputs even if the check has no explicit dependencies.\n    // In wave-retry (from on_finish), restrict to checks with dependencies to\n    // avoid wrongly skipping top-level prompts like 'ask'.\n    const useGlobalOutputs = hasDeps || (useGlobalOutputsFlag && waveKind === 'forward');\n\n    if (useGlobalOutputs) {\n      // Forward-run wave: allow guards to consult latest outputs from the entire\n      // journal so follow-up steps (e.g., post-verified after run-review) can\n      // see the outputs produced in the prior wave that scheduled this forward-run.\n      try {\n        const snapshotId = context.journal.beginSnapshot();\n        const ContextView = require('../../snapshot-store').ContextView;\n        const contextView = new ContextView(\n          context.journal,\n          context.sessionId,\n          snapshotId,\n          [],\n          context.event\n        );\n        for (const key of Object.keys(context.checks || {})) {\n          const jr = contextView.get(key);\n          if (jr) previousResults.set(key, jr as ReviewSummary);\n        }\n      } catch {\n        // Fallback to current-wave only if any error occurs\n      }\n    } else if (currentWaveCompletions) {\n      // Current-wave-only results\n      for (const key of currentWaveCompletions) {\n        try {\n          const snapshotId = context.journal.beginSnapshot();\n          const ContextView = require('../../snapshot-store').ContextView;\n          const contextView = new ContextView(\n            context.journal,\n            context.sessionId,\n            snapshotId,\n            [],\n            context.event\n          );\n          const journalResult = contextView.get(key);\n          if (journalResult) {\n            previousResults.set(key, journalResult as ReviewSummary);\n          }\n        } catch {\n          // Silently skip - will use empty result\n        }\n      }\n    }\n    // Fallback: if no wave tracking, use empty outputs (allows all checks to run)\n\n    // Build context data for if condition evaluation\n    // Create a snapshot of process.env to ensure current values are captured\n    // This is critical for test stages that set environment variables dynamically\n    const envSnapshot: Record<string, string> = {};\n    for (const [key, value] of Object.entries(process.env)) {\n      if (value !== undefined) {\n        envSnapshot[key] = value;\n      }\n    }\n\n    // Merge config.env into environment (config.env takes precedence)\n    if (context.config.env) {\n      for (const [key, value] of Object.entries(context.config.env)) {\n        if (value !== undefined && value !== null) {\n          envSnapshot[key] = String(value);\n        }\n      }\n    }\n\n    const contextData = {\n      previousResults,\n      event: context.event || 'manual',\n      branch: (context.prInfo as any)?.branch,\n      baseBranch: (context.prInfo as any)?.baseBranch,\n      filesChanged: context.prInfo?.files?.map(f => f.filename),\n      environment: envSnapshot,\n      workflowInputs: (context.config as any).workflow_inputs || {},\n    };\n\n    const shouldRun = await evaluator.evaluateIfCondition(checkId, ifExpression, contextData);\n    return shouldRun;\n  } catch (error) {\n    const msg = error instanceof Error ? error.message : String(error);\n    logger.error(`Failed to evaluate if expression for check '${checkId}': ${msg}`);\n    // Fail-secure: if condition evaluation fails, skip execution\n    return false;\n  }\n}\n\nexport async function handleLevelDispatch(\n  context: EngineContext,\n  state: RunState,\n  transition: (newState: EngineState) => void,\n  emitEvent: (event: EngineEvent) => void\n): Promise<void> {\n  // Pop next level from queue\n  const level = state.levelQueue.shift();\n\n  if (!level) {\n    // No more levels - go back to wave planning\n    if (context.debug) {\n      logger.info('[LevelDispatch] No more levels in queue');\n    }\n    transition('WavePlanning');\n    return;\n  }\n\n  if (context.debug) {\n    logger.info(\n      `[LevelDispatch] Executing level ${level.level} with ${level.parallel.length} checks`\n    );\n  }\n\n  // Update current level tracking\n  state.currentLevel = level.level;\n  state.currentLevelChecks = new Set(level.parallel);\n  const levelChecksPreview = level.parallel.slice(0, 5).join(',');\n  setSpanAttributes({\n    level_size: level.parallel.length,\n    level_checks_preview: levelChecksPreview,\n  });\n\n  // Emit level ready event\n  emitEvent({ type: 'LevelReady', level, wave: state.wave });\n\n  const maxParallelism = context.maxParallelism || 10;\n  const results: Array<{ checkId: string; result: ReviewSummary; error?: Error }> = [];\n\n  // Group checks by session provider to enforce session reuse barriers\n  const sessionGroups = groupBySession(level.parallel, context);\n\n  // Execute each session group sequentially, but checks within group in parallel\n  for (const group of sessionGroups) {\n    const groupResults = await executeCheckGroup(\n      group,\n      context,\n      state,\n      maxParallelism,\n      emitEvent,\n      transition\n    );\n    results.push(...groupResults);\n\n    // Check fail-fast\n    if (context.failFast && shouldFailFast(results)) {\n      logger.warn('[LevelDispatch] Fail-fast triggered');\n      state.flags.failFastTriggered = true;\n      break;\n    }\n  }\n\n  // Emit level depleted event\n  emitEvent({ type: 'LevelDepleted', level: level.level, wave: state.wave });\n\n  // Update stats - exclude only aggregated forEach results and explicit skip stubs\n  // Previously skipped checks that now execute must be included so updateStats can\n  // clear the skipped flag and count this run.\n  const nonForEachResults = results.filter(r => {\n    if ((r.result as any).isForEach) return false;\n    if ((r.result as any).__skipped) return false;\n    return true;\n  });\n  updateStats(nonForEachResults, state);\n\n  // Check if fail-fast was triggered\n  if (state.flags.failFastTriggered) {\n    // Skip remaining levels\n    state.levelQueue = [];\n    if (context.debug) {\n      logger.info('[LevelDispatch] Fail-fast triggered, clearing level queue');\n    }\n  }\n\n  // Clear current level tracking\n  state.currentLevelChecks.clear();\n\n  // Only transition to WavePlanning if we're not already in Error state\n  // (halt_execution may have triggered Error state during routing)\n  if (state.currentState !== 'Error') {\n    transition('WavePlanning');\n  } else {\n    logger.info('[LevelDispatch] Skipping transition to WavePlanning - already in Error state');\n  }\n}\n\n/**\n * Group checks by session provider to enforce sequential execution\n */\nfunction groupBySession(checks: string[], context: EngineContext): string[][] {\n  // M2: Group checks that share a session provider\n  const sessionProviderMap = new Map<string, string[]>();\n  const noSessionChecks: string[] = [];\n\n  for (const checkId of checks) {\n    const metadata = context.checks[checkId];\n    const sessionProvider = metadata?.sessionProvider;\n\n    if (sessionProvider) {\n      const group = sessionProviderMap.get(sessionProvider) || [];\n      group.push(checkId);\n      sessionProviderMap.set(sessionProvider, group);\n    } else {\n      noSessionChecks.push(checkId);\n    }\n  }\n\n  // Return groups: first all session groups (sequential), then independent checks\n  const groups: string[][] = [];\n\n  // Add session groups (each group runs sequentially relative to other session groups)\n  for (const group of sessionProviderMap.values()) {\n    groups.push(group);\n  }\n\n  // Add independent checks as one group (can run in parallel)\n  if (noSessionChecks.length > 0) {\n    groups.push(noSessionChecks);\n  }\n\n  return groups;\n}\n\n/**\n * Execute a group of checks in parallel (up to maxParallelism)\n */\nasync function executeCheckGroup(\n  checks: string[],\n  context: EngineContext,\n  state: RunState,\n  maxParallelism: number,\n  emitEvent: (event: EngineEvent) => void,\n  transition: (newState: EngineState) => void\n): Promise<Array<{ checkId: string; result: ReviewSummary; error?: Error; duration?: number }>> {\n  const results: Array<{\n    checkId: string;\n    result: ReviewSummary;\n    error?: Error;\n    duration?: number;\n  }> = [];\n\n  // Deduplicate checks within the same level to avoid double execution when\n  // routing or OR-dependency expansion accidentally introduces duplicates.\n  const seen = new Set<string>();\n  const uniqueChecks: string[] = [];\n  for (const id of checks) {\n    if (!seen.has(id)) {\n      seen.add(id);\n      uniqueChecks.push(id);\n    }\n  }\n\n  // Execute with limited parallelism\n  const pool: Promise<void>[] = [];\n\n  for (const checkId of uniqueChecks) {\n    // If forward-run provided explicit per-item scopes, schedule one execution per scope\n    const scopedRuns: Array<Array<{ check: string; index: number }>> =\n      (state.pendingRunScopes && state.pendingRunScopes.get(checkId)) || [];\n    // Guard: do not execute the same check more than once within a single wave\n    try {\n      const currentWaveCompletions = (state as any).currentWaveCompletions as\n        | Set<string>\n        | undefined;\n      if (currentWaveCompletions && currentWaveCompletions.has(checkId)) {\n        if (context.debug) {\n          logger.info(`[LevelDispatch] Skipping ${checkId}: already completed in current wave`);\n        }\n        continue;\n      }\n    } catch {}\n\n    // Wait if pool is full\n    if (pool.length >= maxParallelism) {\n      await Promise.race(pool);\n      // Remove completed promises\n      pool.splice(\n        0,\n        pool.length,\n        ...pool.filter(p => {\n          const settled = (p as any)._settled;\n          return !settled;\n        })\n      );\n    }\n\n    const runOnce = async (scopeOverride?: Array<{ check: string; index: number }>) => {\n      const startTime = Date.now();\n      try {\n        const result = await executeSingleCheck(\n          checkId,\n          context,\n          state,\n          emitEvent,\n          transition,\n          scopeOverride\n        );\n        const duration = Date.now() - startTime;\n        results.push({ checkId, result, duration });\n      } catch (error) {\n        const duration = Date.now() - startTime;\n        const err = error instanceof Error ? error : new Error(String(error));\n        logger.error(`[LevelDispatch] Error executing check ${checkId}: ${err.message}`);\n        results.push({ checkId, result: { issues: [] }, error: err, duration });\n      }\n    };\n\n    // If we have explicit scopes, schedule one run per scope; otherwise run once (default scope)\n    const promise = (async () => {\n      if (scopedRuns.length > 0) {\n        for (const sc of scopedRuns) {\n          await runOnce(sc);\n        }\n        // Clear consumed scopes and args\n        try {\n          state.pendingRunScopes?.delete(checkId);\n          state.pendingRunArgs?.delete(checkId);\n        } catch {}\n      } else {\n        await runOnce();\n      }\n    })();\n\n    // Mark promise as settled when done\n    promise\n      .then(() => {\n        (promise as any)._settled = true;\n      })\n      .catch(() => {\n        (promise as any)._settled = true;\n      });\n\n    pool.push(promise);\n  }\n\n  // Wait for all remaining checks\n  await Promise.all(pool);\n\n  return results;\n}\n\n/**\n * Execute a check multiple times for forEach items\n */\nasync function executeCheckWithForEachItems(\n  checkId: string,\n  forEachParent: string,\n  forEachItems: unknown[],\n  context: EngineContext,\n  state: RunState,\n  emitEvent: (event: EngineEvent) => void,\n  transition: (newState: EngineState) => void\n): Promise<ReviewSummary> {\n  // Tactical correctness fix: re-read the parent's aggregated forEachItems\n  // from a fresh journal snapshot to avoid stale items during goto/on_finish\n  // retries. Prefer the shallowest (root-scope) entry via getRaw().\n  try {\n    const snapId = context.journal.beginSnapshot();\n    // Read latest aggregated (root-scope) parent entry directly from journal.\n    // ContextView.getRaw() returns the shallowest entry but not necessarily the latest;\n    // here we explicitly pick the last committed root-scope entry for correctness.\n    const visible = context.journal.readVisible(context.sessionId, snapId, context.event as any);\n    let latestItems: unknown[] | undefined;\n    for (let i = visible.length - 1; i >= 0; i--) {\n      const e = visible[i];\n      if (e.checkId === forEachParent && Array.isArray(e.scope) && e.scope.length === 0) {\n        const r: any = e.result;\n        if (r && Array.isArray(r.forEachItems)) {\n          latestItems = r.forEachItems as unknown[];\n          break;\n        }\n      }\n    }\n    if (Array.isArray(latestItems)) {\n      if (context.debug) {\n        try {\n          const prevLen = Array.isArray(forEachItems) ? (forEachItems as any[]).length : 0;\n          const newLen = latestItems.length;\n          if (prevLen !== newLen) {\n            logger.info(\n              `[LevelDispatch] Refreshing forEachItems for ${checkId}: ` +\n                `from parent '${forEachParent}' latestItems=${newLen} (was ${prevLen})`\n            );\n          }\n        } catch {}\n      }\n      forEachItems = latestItems as unknown[];\n    }\n  } catch (e) {\n    // Non-fatal: proceed with provided forEachItems\n    if (context.debug) {\n      logger.warn(\n        `[LevelDispatch] Failed to refresh forEachItems from journal for ${forEachParent}: ${e}`\n      );\n    }\n  }\n  const checkConfig = context.config.checks?.[checkId];\n  if (!checkConfig) {\n    throw new Error(`Check configuration not found: ${checkId}`);\n  }\n\n  // DEBUG: Log forEach execution\n  logger.info(\n    `[LevelDispatch][DEBUG] executeCheckWithForEachItems: checkId=${checkId}, forEachParent=${forEachParent}, items=${forEachItems.length}`\n  );\n  logger.info(\n    `[LevelDispatch][DEBUG] forEachItems: ${JSON.stringify(forEachItems).substring(0, 200)}`\n  );\n\n  const allIssues: ReviewIssue[] = [];\n  const perItemResults: ReviewSummary[] = [];\n  const allOutputs: unknown[] = [];\n  const allContents: string[] = [];\n  const perIterationDurations: number[] = [];\n\n  // Handle on_init lifecycle hook ONCE before forEach loop\n  // (not per-item - runs before all iterations)\n  const scope: Array<{ check: string; index: number }> = [];\n  const sharedDependencyResults = buildDependencyResultsWithScope(\n    checkId,\n    checkConfig,\n    context,\n    scope\n  );\n\n  if (checkConfig.on_init) {\n    try {\n      const { handleOnInit } = require('../dispatch/execution-invoker');\n\n      // Convert Map to Record for on_init handlers\n      const dependencyResultsMap: Record<string, unknown> = {};\n      for (const [key, value] of sharedDependencyResults.entries()) {\n        dependencyResultsMap[key] = value;\n      }\n\n      const prInfo = context.prInfo;\n      const executionContext = {\n        sessionId: context.sessionId,\n        checkId,\n        event: context.event,\n        _parentContext: context,\n      };\n\n      await handleOnInit(\n        checkId,\n        checkConfig.on_init,\n        context,\n        scope,\n        prInfo,\n        dependencyResultsMap,\n        executionContext\n      );\n\n      // Merge on_init outputs back into sharedDependencyResults\n      for (const [key, value] of Object.entries(dependencyResultsMap)) {\n        if (!sharedDependencyResults.has(key)) {\n          sharedDependencyResults.set(key, value as any);\n        }\n      }\n\n      logger.info(`[LevelDispatch] on_init completed for ${checkId} before forEach loop`);\n    } catch (error) {\n      const err = error instanceof Error ? error : new Error(String(error));\n      logger.error(`[LevelDispatch] on_init failed for ${checkId}: ${err.message}`);\n      throw err;\n    }\n  }\n\n  // Execute check once per forEach item\n  for (let itemIndex = 0; itemIndex < forEachItems.length; itemIndex++) {\n    const iterationStartMs = Date.now();\n    const scope: Array<{ check: string; index: number }> = [\n      { check: forEachParent, index: itemIndex },\n    ];\n\n    const forEachItem = forEachItems[itemIndex];\n    logger.info(\n      `[LevelDispatch][DEBUG] Starting iteration ${itemIndex} of ${checkId}, parent=${forEachParent}, item=${JSON.stringify(forEachItem)?.substring(0, 100)}`\n    );\n\n    // Check if the forEach item indicates a failure\n    // When a check fails (via fail_if or execution error), it may set a flag in the output\n    // Skip this iteration if the parent iteration failed\n    const shouldSkipDueToParentFailure =\n      (forEachItem as any)?.__failed === true || (forEachItem as any)?.__skip === true;\n\n    if (shouldSkipDueToParentFailure) {\n      // Parent iteration failed - skip this iteration\n      logger.info(\n        `â­  Skipped ${checkId} iteration ${itemIndex} (forEach parent \"${forEachParent}\" iteration ${itemIndex} marked as failed)`\n      );\n\n      // Track this as a skipped iteration in stats\n      const iterationDurationMs = Date.now() - iterationStartMs;\n      perIterationDurations.push(iterationDurationMs);\n\n      // Add empty result to maintain array alignment\n      perItemResults.push({ issues: [] });\n      // Propagate an explicit skip marker so downstream dependents can also skip this branch\n      allOutputs.push({ __skip: true });\n\n      continue; // Skip to next iteration\n    }\n\n    // Emit visor.foreach.item span for telemetry\n    try {\n      emitNdjsonSpanWithEvents(\n        'visor.foreach.item',\n        {\n          'visor.check.id': checkId,\n          'visor.foreach.index': itemIndex,\n          'visor.foreach.total': forEachItems.length,\n        },\n        []\n      );\n    } catch (error) {\n      logger.warn(`[LevelDispatch] Failed to emit foreach.item span: ${error}`);\n    }\n\n    // Emit scheduled event\n    emitEvent({ type: 'CheckScheduled', checkId, scope });\n\n    // Create dispatch record\n    const dispatch: DispatchRecord = {\n      id: `${checkId}-${itemIndex}-${Date.now()}`,\n      checkId,\n      scope,\n      provider: context.checks[checkId]?.providerType || 'unknown',\n      startMs: Date.now(),\n      attempts: 1,\n      foreachIndex: itemIndex,\n    };\n\n    state.activeDispatches.set(`${checkId}-${itemIndex}`, dispatch);\n\n    try {\n      // Get provider\n      const providerType = checkConfig.type || 'ai';\n      const providerRegistry =\n        require('../../providers/check-provider-registry').CheckProviderRegistry.getInstance();\n      const provider = providerRegistry.getProviderOrThrow(providerType);\n\n      // Build output history for template rendering\n      const outputHistory = buildOutputHistoryFromJournal(context);\n\n      // Resolve workflow inputs from config or context (centralized logic)\n      const workflowInputs = resolveWorkflowInputs(checkConfig, context);\n\n      // Build provider configuration\n      const providerConfig: CheckProviderConfig = {\n        type: providerType,\n        checkName: checkId,\n        prompt: checkConfig.prompt,\n        exec: checkConfig.exec,\n        schema: checkConfig.schema,\n        group: checkConfig.group,\n        focus: checkConfig.focus || mapCheckNameToFocus(checkId),\n        transform: checkConfig.transform,\n        transform_js: checkConfig.transform_js,\n        env: checkConfig.env,\n        forEach: checkConfig.forEach,\n        ...checkConfig,\n        eventContext: (context.prInfo as any)?.eventContext || {},\n        __outputHistory: outputHistory,\n        // Propagate workflow inputs for template access via {{ inputs.* }}\n        workflowInputs,\n        ai: {\n          ...(checkConfig.ai || {}),\n          timeout: checkConfig.ai?.timeout || 1800000,\n          debug: !!context.debug,\n        },\n      };\n\n      // Propagate authenticated Octokit (v2 frontends / Action mode)\n      try {\n        const maybeOctokit = (context.executionContext as any)?.octokit;\n        if (maybeOctokit) {\n          (providerConfig as any).eventContext = {\n            ...(providerConfig as any).eventContext,\n            octokit: maybeOctokit,\n          };\n        }\n      } catch {}\n\n      // Extract Slack conversation from webhookContext (for Slack socket mode)\n      // The socket-runner stores conversation data in webhookData under the endpoint key\n      try {\n        const webhookCtx = (context.executionContext as any)?.webhookContext;\n        const webhookData = webhookCtx?.webhookData as Map<string, unknown> | undefined;\n        if (context.debug) {\n          logger.info(\n            `[LevelDispatch] webhookContext: ${webhookCtx ? 'present' : 'absent'}, webhookData size: ${webhookData?.size || 0}`\n          );\n        }\n        if (webhookData && webhookData.size > 0) {\n          // Find the payload with slack_conversation\n          for (const payload of webhookData.values()) {\n            const slackConv = (payload as any)?.slack_conversation;\n            if (slackConv) {\n              // Build slack context with event and conversation\n              const event = (payload as any)?.event;\n              const messageCount = Array.isArray(slackConv?.messages)\n                ? slackConv.messages.length\n                : 0;\n              if (context.debug) {\n                logger.info(\n                  `[LevelDispatch] Slack conversation extracted: ${messageCount} messages`\n                );\n              }\n              (providerConfig as any).eventContext = {\n                ...(providerConfig as any).eventContext,\n                slack: {\n                  event: event || {},\n                  conversation: slackConv,\n                },\n                conversation: slackConv, // Also expose at top level for convenience\n              };\n              break;\n            }\n          }\n        }\n      } catch {}\n\n      // Fallback: expose conversation from executionContext (for CLI --message)\n      // Only if no Slack conversation was set above\n      try {\n        if (\n          !(providerConfig as any).eventContext?.conversation &&\n          (context.executionContext as any)?.conversation\n        ) {\n          (providerConfig as any).eventContext = {\n            ...(providerConfig as any).eventContext,\n            conversation: (context.executionContext as any).conversation,\n          };\n        }\n      } catch {}\n\n      // Build dependency results with scope\n      const dependencyResults = buildDependencyResultsWithScope(\n        checkId,\n        checkConfig,\n        context,\n        scope\n      );\n\n      // Merge shared on_init outputs into this iteration's dependencyResults\n      for (const [key, value] of sharedDependencyResults.entries()) {\n        if (!dependencyResults.has(key)) {\n          dependencyResults.set(key, value);\n        }\n      }\n\n      // Per-item dependency gating for map fanout: honor OR dependencies and continue_on_failure\n      try {\n        const rawDeps = (checkConfig as any)?.depends_on || [];\n        const depList = Array.isArray(rawDeps) ? rawDeps : [rawDeps];\n        if (depList.length > 0) {\n          const groupSatisfied = (token: string): boolean => {\n            if (typeof token !== 'string') return true;\n            const orOptions = token.includes('|')\n              ? token\n                  .split('|')\n                  .map(s => s.trim())\n                  .filter(Boolean)\n              : [token];\n            for (const opt of orOptions) {\n              const dr = dependencyResults.get(opt) as ReviewSummary | undefined;\n              const depCfg = context.config.checks?.[opt];\n              const cont = !!(depCfg && (depCfg as any).continue_on_failure === true);\n              let failed = false;\n              let skipped = false;\n              if (!dr) {\n                failed = true; // missing result => not satisfied\n              } else {\n                const out: any = (dr as any).output;\n                const fatal = hasFatalIssues(dr as any);\n                failed = fatal || (!!out && typeof out === 'object' && out.__failed === true);\n                skipped = !!(out && typeof out === 'object' && out.__skip === true);\n              }\n              const satisfied = !skipped && (!failed || cont);\n              if (satisfied) return true; // any option satisfies the group\n            }\n            return false;\n          };\n\n          let allSatisfied = true;\n          for (const token of depList) {\n            if (!groupSatisfied(token as any)) {\n              allSatisfied = false;\n              break;\n            }\n          }\n\n          if (!allSatisfied) {\n            // Skip this iteration without executing provider; maintain per-item alignment\n            if (context.debug) {\n              logger.info(\n                `[LevelDispatch] Skipping ${checkId} iteration ${itemIndex} due to unsatisfied dependency group(s)`\n              );\n            }\n            const iterationDurationMs = Date.now() - iterationStartMs;\n            perIterationDurations.push(iterationDurationMs);\n            perItemResults.push({ issues: [] });\n            allOutputs.push({ __skip: true });\n            // Do not call updateStats here: iteration did not execute\n            continue;\n          }\n        }\n      } catch {}\n\n      // Build PR info (use real prInfo from context if available, otherwise use defaults)\n      const prInfo: any = context.prInfo || {\n        number: 1,\n        title: 'State Machine Execution',\n        author: 'system',\n        eventType: context.event || 'manual',\n        eventContext: {},\n        files: [],\n        commits: [],\n      };\n\n      // Build execution context with optional args from on_success.run with directives\n      // Render any Liquid templates in pending args using the dependency outputs\n      const rawPendingArgs = state.pendingRunArgs?.get(checkId);\n      const depResultsObj: Record<string, unknown> = {};\n      for (const [k, v] of dependencyResults.entries()) {\n        const summary = v as ReviewSummary & { output?: unknown };\n        depResultsObj[k] = summary.output !== undefined ? summary.output : summary;\n      }\n      const renderedArgs = rawPendingArgs\n        ? await renderTemplateArgs(rawPendingArgs, depResultsObj, context)\n        : undefined;\n      const executionContext = {\n        ...context.executionContext,\n        _engineMode: context.mode,\n        _parentContext: context,\n        _parentState: state,\n        // Inject args from on_success.run with directives (merged with existing args)\n        args: renderedArgs\n          ? { ...((context.executionContext as any)?.args || {}), ...renderedArgs }\n          : (context.executionContext as any)?.args,\n      };\n\n      // Evaluate assume contract for this iteration (design-by-contract)\n      {\n        const assumeExpr = (checkConfig as any)?.assume as string | string[] | undefined;\n        if (assumeExpr) {\n          let ok = true;\n          try {\n            const evaluator = new FailureConditionEvaluator();\n            const exprs = Array.isArray(assumeExpr) ? assumeExpr : [assumeExpr];\n            // Get conversation from execution context (TUI/CLI) or provider event context (Slack)\n            const conversation =\n              (context.executionContext as any)?.conversation ||\n              (providerConfig as any)?.eventContext?.conversation;\n            for (const ex of exprs) {\n              const res = await evaluator.evaluateIfCondition(checkId, ex, {\n                event: context.event || 'manual',\n                previousResults: dependencyResults as any,\n                conversation,\n              } as any);\n              if (!res) {\n                ok = false;\n                break;\n              }\n            }\n          } catch (error) {\n            const msg = error instanceof Error ? error.message : String(error);\n            logger.error(`Failed to evaluate assume expression for check '${checkId}': ${msg}`);\n            // Fail-secure: if assume evaluation fails, skip execution\n            ok = false;\n          }\n          if (!ok) {\n            logger.info(\n              `â­  Skipped (assume: ${String(Array.isArray(assumeExpr) ? assumeExpr[0] : assumeExpr).substring(0, 40)}${String(Array.isArray(assumeExpr) ? assumeExpr[0] : assumeExpr).length > 40 ? '...' : ''})`\n            );\n            const iterationDurationMs = Date.now() - iterationStartMs;\n            perIterationDurations.push(iterationDurationMs);\n            perItemResults.push({ issues: [] });\n            allOutputs.push({ __skip: true });\n            continue;\n          }\n        }\n      }\n\n      // Emit provider telemetry\n      try {\n        emitNdjsonFallback('visor.provider', {\n          'visor.check.id': checkId,\n          'visor.provider.type': providerType,\n        });\n      } catch {}\n\n      // Execute provider with telemetry (sandbox routing if configured)\n      const itemResult = await withActiveSpan(\n        `visor.check.${checkId}`,\n        {\n          'visor.check.id': checkId,\n          'visor.check.type': providerType,\n          'visor.foreach.index': itemIndex,\n          session_id: context.sessionId,\n          wave: state.wave,\n        },\n        async span => {\n          const res = await executeWithSandboxRouting(\n            checkId,\n            checkConfig,\n            context,\n            prInfo,\n            dependencyResults,\n            checkConfig.ai?.timeout || 1800000,\n            () => provider.execute(prInfo, providerConfig, dependencyResults, executionContext)\n          );\n          try {\n            captureCheckOutput(span, (res as any).output);\n          } catch {}\n          return res;\n        }\n      );\n\n      // Enrich issues\n      const enrichedIssues = (itemResult.issues || []).map((issue: ReviewIssue) => ({\n        ...issue,\n        checkName: checkId,\n        ruleId: `${checkId}/${issue.ruleId || 'unknown'}`,\n        group: checkConfig.group,\n        schema: typeof checkConfig.schema === 'object' ? 'custom' : checkConfig.schema,\n        template: checkConfig.template,\n        timestamp: Date.now(),\n      }));\n\n      // Track output BEFORE creating enrichedResult\n      let output = (itemResult as any).output;\n      let content = (itemResult as any).content;\n\n      // Generate default content from issues if no content was provided\n      if (!content && enrichedIssues.length > 0) {\n        content = enrichedIssues\n          .map(\n            (i: ReviewIssue) =>\n              `- **${i.severity.toUpperCase()}**: ${i.message} (${i.file}:${i.line})`\n          )\n          .join('\\n');\n      }\n\n      // Check if this iteration has fatal issues (execution failures)\n      const iterationHasFatalIssues = enrichedIssues.some((issue: ReviewIssue) => {\n        const ruleId = issue.ruleId || '';\n        return (\n          ruleId.endsWith('/error') || // System errors\n          ruleId.includes('/execution_error') || // Command failures\n          ruleId.includes('timeout') || // Timeouts\n          ruleId.endsWith('_fail_if') // fail_if triggered\n        );\n      });\n\n      // If this iteration failed, mark the output so dependent forEach iterations can skip it\n      if (\n        iterationHasFatalIssues &&\n        output !== undefined &&\n        output !== null &&\n        typeof output === 'object'\n      ) {\n        output = { ...output, __failed: true };\n      } else if (iterationHasFatalIssues) {\n        // If output is primitive or undefined, wrap it in an object with __failed flag\n        output = { __value: output, __failed: true };\n      }\n\n      // DEBUG: Log output for this iteration\n      logger.info(\n        `[LevelDispatch][DEBUG] Iteration ${itemIndex}: output=${JSON.stringify(output)?.substring(0, 100)}, hasFatalIssues=${iterationHasFatalIssues}`\n      );\n\n      const enrichedResult: ReviewSummary = {\n        ...itemResult,\n        issues: enrichedIssues,\n        ...(content ? { content } : {}),\n      };\n\n      // JSON Schema validation for per-item outputs when a schema is provided\n      try {\n        let schemaObj =\n          (typeof checkConfig.schema === 'object' ? (checkConfig.schema as any) : undefined) ||\n          (checkConfig as any).output_schema;\n        // If schema is a known renderer string, attempt to load its JSON Schema\n        if (!schemaObj && typeof (checkConfig as any).schema === 'string') {\n          try {\n            const { loadRendererSchema } = await import('../dispatch/renderer-schema');\n            schemaObj = await loadRendererSchema((checkConfig as any).schema as string);\n          } catch {}\n        }\n        const itemOutput = output;\n        if (schemaObj && itemOutput !== undefined) {\n          const Ajv = require('ajv');\n          const ajv = new Ajv({ allErrors: true, allowUnionTypes: true, strict: false });\n          const validate = ajv.compile(schemaObj);\n          const valid = validate(itemOutput);\n          if (!valid) {\n            const errs = (validate.errors || [])\n              .slice(0, 3)\n              .map((e: any) => e.message)\n              .join('; ');\n            const issue: ReviewIssue = {\n              file: 'contract',\n              line: 0,\n              ruleId: `contract/schema_validation_failed`,\n              message: `Output schema validation failed${errs ? `: ${errs}` : ''}`,\n              severity: 'error',\n              category: 'logic',\n              checkName: checkId,\n              group: checkConfig.group,\n              schema: 'json-schema',\n              timestamp: Date.now(),\n            } as any;\n            enrichedResult.issues = [...(enrichedResult.issues || []), issue];\n            if (Array.isArray(enrichedIssues)) {\n              enrichedIssues.push(issue as any);\n            }\n          }\n        }\n      } catch {}\n\n      // Evaluate guarantee contract (non-fatal): append error issues on violation\n      try {\n        const guaranteeExpr = (checkConfig as any)?.guarantee as string | string[] | undefined;\n        if (guaranteeExpr) {\n          const evaluator = new FailureConditionEvaluator();\n          const exprs = Array.isArray(guaranteeExpr) ? guaranteeExpr : [guaranteeExpr];\n          for (const ex of exprs) {\n            const holds = await evaluator.evaluateIfCondition(checkId, ex, {\n              previousResults: dependencyResults as any,\n              event: context.event || 'manual',\n              output: output, // Pass the iteration output for guarantee evaluation\n            } as any);\n            if (!holds) {\n              const issue: ReviewIssue = {\n                file: 'contract',\n                line: 0,\n                ruleId: `contract/guarantee_failed`,\n                message: `Guarantee failed: ${ex}`,\n                severity: 'error',\n                category: 'logic',\n                checkName: checkId,\n                group: checkConfig.group,\n                schema:\n                  typeof checkConfig.schema === 'object' ? 'custom' : (checkConfig.schema as any),\n                timestamp: Date.now(),\n              } as any;\n              enrichedResult.issues = [...(enrichedResult.issues || []), issue];\n            }\n          }\n        }\n      } catch {}\n\n      // Evaluate fail_if for this forEach iteration\n      if (checkConfig.fail_if) {\n        try {\n          const evaluator = new FailureConditionEvaluator();\n          // Build outputs map for fail_if evaluation (use dependency results as previous outputs)\n          const failed = await evaluator.evaluateSimpleCondition(\n            checkId,\n            typeof checkConfig.schema === 'object' ? 'custom' : checkConfig.schema || '',\n            checkConfig.group || '',\n            enrichedResult,\n            checkConfig.fail_if,\n            Object.fromEntries(dependencyResults.entries()) as Record<string, ReviewSummary>\n          );\n\n          if (failed) {\n            logger.warn(\n              `[LevelDispatch] fail_if triggered for ${checkId} iteration ${itemIndex}: ${checkConfig.fail_if}`\n            );\n\n            // Add fail_if issue to the result\n            const failIssue: ReviewIssue = {\n              file: 'system',\n              line: 0,\n              ruleId: `${checkId}/${checkId}_fail_if`,\n              message: `Check failure condition met: ${checkConfig.fail_if}`,\n              severity: 'error',\n              category: 'logic',\n              checkName: checkId,\n              group: checkConfig.group,\n              schema: typeof checkConfig.schema === 'object' ? 'custom' : checkConfig.schema,\n              timestamp: Date.now(),\n            };\n\n            enrichedResult.issues = [...(enrichedResult.issues || []), failIssue];\n            enrichedIssues.push(failIssue as any);\n            allIssues.push(failIssue as any);\n\n            // Re-check if iteration has fatal issues after adding fail_if issue\n            const nowHasFatalIssues = enrichedResult.issues.some((issue: ReviewIssue) => {\n              const ruleId = issue.ruleId || '';\n              return (\n                ruleId.endsWith('/error') ||\n                ruleId.includes('/execution_error') ||\n                ruleId.includes('timeout') ||\n                ruleId.endsWith('_fail_if')\n              );\n            });\n\n            // Update output with __failed flag if needed\n            if (\n              nowHasFatalIssues &&\n              output !== undefined &&\n              output !== null &&\n              typeof output === 'object' &&\n              !(output as any).__failed\n            ) {\n              output = { ...output, __failed: true };\n            } else if (nowHasFatalIssues && !(output as any)?.__failed) {\n              output = { __value: output, __failed: true };\n            }\n          }\n        } catch (error) {\n          const msg = error instanceof Error ? error.message : String(error);\n          logger.error(\n            `[LevelDispatch] Error evaluating fail_if for ${checkId} iteration ${itemIndex}: ${msg}`\n          );\n        }\n      }\n\n      // Store per-item result\n      perItemResults.push(enrichedResult);\n      allIssues.push(...enrichedIssues);\n      allOutputs.push(output);\n\n      // Track content\n      if (typeof content === 'string' && content.trim()) {\n        allContents.push(content.trim());\n      }\n\n      // Store in journal with scope - EXPLICITLY include output field\n      try {\n        const journalEntry = {\n          sessionId: context.sessionId,\n          checkId,\n          result: { ...enrichedResult, output } as any,\n          event: context.event || 'manual',\n          scope,\n        };\n        // DEBUG: Log journal entry\n        logger.info(\n          `[LevelDispatch][DEBUG] Committing to journal: checkId=${checkId}, scope=${JSON.stringify(scope)}, hasOutput=${output !== undefined}`\n        );\n        context.journal.commitEntry(journalEntry);\n      } catch (error) {\n        logger.warn(`[LevelDispatch] Failed to commit to journal: ${error}`);\n      }\n\n      state.activeDispatches.delete(`${checkId}-${itemIndex}`);\n\n      // Emit completed event\n      emitEvent({\n        type: 'CheckCompleted',\n        checkId,\n        scope,\n        result: {\n          ...enrichedResult,\n          output,\n        },\n      });\n\n      // Track duration for this iteration\n      const iterationDurationMs = Date.now() - iterationStartMs;\n      perIterationDurations.push(iterationDurationMs);\n\n      // Track statistics for this forEach iteration\n      updateStats(\n        [{ checkId, result: enrichedResult, duration: iterationDurationMs }],\n        state,\n        true\n      );\n    } catch (error) {\n      // Track duration for failed iteration\n      const iterationDurationMs = Date.now() - iterationStartMs;\n      perIterationDurations.push(iterationDurationMs);\n      const err = error instanceof Error ? error : new Error(String(error));\n      logger.error(\n        `[LevelDispatch] Error executing check ${checkId} item ${itemIndex}: ${err.message}`\n      );\n\n      state.activeDispatches.delete(`${checkId}-${itemIndex}`);\n\n      // Emit error event\n      emitEvent({\n        type: 'CheckErrored',\n        checkId,\n        scope,\n        error: {\n          message: err.message,\n          stack: err.stack,\n          name: err.name,\n        },\n      });\n\n      // Add error to results\n      const errorIssue: ReviewIssue = {\n        file: '',\n        line: 0,\n        ruleId: `${checkId}/error`,\n        message: err.message,\n        severity: 'error',\n        category: 'logic',\n      };\n\n      allIssues.push(errorIssue);\n      perItemResults.push({ issues: [errorIssue] });\n\n      // Track statistics for this failed forEach iteration\n      updateStats(\n        [{ checkId, result: { issues: [errorIssue] }, error: err, duration: iterationDurationMs }],\n        state,\n        true\n      );\n    }\n  }\n\n  // Mark as completed\n  state.completedChecks.add(checkId);\n\n  // Update forEach metadata in stats\n  const checkStats = state.stats.get(checkId);\n  if (checkStats) {\n    checkStats.outputsProduced = allOutputs.length;\n    checkStats.perIterationDuration = perIterationDurations;\n\n    // Create preview of forEach items (first 3 + indicator for more)\n    const previewItems = allOutputs.slice(0, 3).map(item => {\n      const str = typeof item === 'string' ? item : (JSON.stringify(item) ?? 'undefined');\n      return str.length > 50 ? str.substring(0, 50) + '...' : str;\n    });\n\n    if (allOutputs.length > 3) {\n      checkStats.forEachPreview = [...previewItems, `...${allOutputs.length - 3} more`];\n    } else {\n      checkStats.forEachPreview = previewItems;\n    }\n\n    state.stats.set(checkId, checkStats);\n\n    // Check if ALL iterations failed (complete failure)\n    // If so, mark check as failed so dependents can be skipped\n    if (checkStats.totalRuns > 0 && checkStats.failedRuns === checkStats.totalRuns) {\n      logger.info(\n        `[LevelDispatch] forEach check ${checkId} failed completely (${checkStats.failedRuns}/${checkStats.totalRuns} iterations failed)`\n      );\n      // Mark in state so dependents know this check failed\n      if (!(state as any).failedChecks) {\n        (state as any).failedChecks = new Set<string>();\n      }\n      (state as any).failedChecks.add(checkId);\n    }\n  }\n\n  // Return aggregated result\n  const aggregatedResult: any = {\n    issues: allIssues,\n    isForEach: true,\n    forEachItems: allOutputs,\n    forEachItemResults: perItemResults,\n    // Include aggregated content from all iterations\n    ...(allContents.length > 0 ? { content: allContents.join('\\n') } : {}),\n  };\n\n  // DEBUG: Log aggregated result\n  logger.info(\n    `[LevelDispatch][DEBUG] Aggregated result for ${checkId}: forEachItems.length=${allOutputs.length}, results=${perItemResults.length}`\n  );\n  logger.info(`[LevelDispatch][DEBUG] allOutputs: ${JSON.stringify(allOutputs).substring(0, 200)}`);\n\n  // Store aggregated result in journal (without scope - this is the parent-level result)\n  // Before storing, process routing for the aggregated child check so on_success/on_fail\n  // can schedule follow-up actions (e.g., per-item remediation) based on forEach results.\n  try {\n    logger.info(`[LevelDispatch] Calling handleRouting for ${checkId}`);\n  } catch {}\n  let wasHalted = false;\n  try {\n    // Mark completion prior to routing so guards see this as completed in the wave\n    state.completedChecks.add(checkId);\n    const currentWaveCompletions = (state as any).currentWaveCompletions as Set<string> | undefined;\n    if (currentWaveCompletions) currentWaveCompletions.add(checkId);\n\n    wasHalted = await handleRouting(context, state, transition, emitEvent, {\n      checkId,\n      scope: [],\n      result: aggregatedResult as any,\n      checkConfig: checkConfig as any,\n      success: !hasFatalIssues(aggregatedResult as any),\n    });\n  } catch (error) {\n    logger.warn(`[LevelDispatch] Routing error for aggregated forEach ${checkId}: ${error}`);\n  }\n\n  // If execution was halted, return the aggregated result (with halt issue added)\n  if (wasHalted) {\n    logger.info(`[LevelDispatch] Execution halted after routing for aggregated ${checkId}`);\n    return aggregatedResult as ReviewSummary;\n  }\n\n  try {\n    context.journal.commitEntry({\n      sessionId: context.sessionId,\n      checkId,\n      result: aggregatedResult as any,\n      event: context.event || 'manual',\n      scope: [],\n    });\n    logger.info(`[LevelDispatch][DEBUG] Committed aggregated result to journal with scope=[]`);\n  } catch (error) {\n    logger.warn(`[LevelDispatch] Failed to commit aggregated forEach result to journal: ${error}`);\n  }\n\n  // Note: We intentionally do not increment totals here for the aggregated\n  // child invocation; per-iteration stats were recorded above via updateStats.\n  // Each iteration was counted separately, so the totalRuns already reflects\n  // the correct number of executions.\n\n  // Emit completed event for aggregated result\n  emitEvent({\n    type: 'CheckCompleted',\n    checkId,\n    scope: [],\n    result: aggregatedResult,\n  });\n\n  const parentCheckConfig = context.config.checks?.[forEachParent];\n\n  // Process on_finish for forEach PARENT after all forEach children complete\n  // The forEach parent is the one that produced the forEachItems\n  logger.info(\n    `[LevelDispatch][DEBUG] Checking on_finish for forEach parent ${forEachParent}: has_on_finish=${!!parentCheckConfig?.on_finish}, is_forEach=${!!parentCheckConfig?.forEach}`\n  );\n\n  if (parentCheckConfig?.on_finish && parentCheckConfig.forEach) {\n    logger.info(\n      `[LevelDispatch] Processing on_finish for forEach parent ${forEachParent} after children complete`\n    );\n\n    // Get the parent check's result from journal\n    try {\n      const snapshotId = context.journal.beginSnapshot();\n      const contextView = new (require('../../snapshot-store').ContextView)(\n        context.journal,\n        context.sessionId,\n        snapshotId,\n        [],\n        context.event\n      );\n      const parentResult = contextView.get(forEachParent);\n\n      if (parentResult) {\n        logger.info(\n          `[LevelDispatch] Found parent result for ${forEachParent}, evaluating on_finish`\n        );\n\n        // Evaluate on_finish routing (goto/goto_js) for the forEach parent\n        const onFinish = parentCheckConfig.on_finish;\n\n        // Process on_finish.run (if any). When we enqueue forward runs via\n        // on_finish from within LevelDispatch (i.e., forEach parent path), we\n        // must also request a WaveRetry so that checks whose execution depends\n        // on updated memory/side-effects (but are not direct dependents of the\n        // scheduled target) can re-evaluate their `if` conditions next wave.\n        // This mirrors routing.ts behavior and is necessary for flows where an\n        // aggregator sets flags consumed by later checks (e.g., posting steps).\n        let queuedForward = false;\n        logger.info(\n          `[LevelDispatch] on_finish.run: ${onFinish.run?.length || 0} targets, targets=${JSON.stringify(onFinish.run || [])}`\n        );\n        if (onFinish.run && onFinish.run.length > 0) {\n          for (const targetCheck of onFinish.run) {\n            logger.info(`[LevelDispatch] Processing on_finish.run target: ${targetCheck}`);\n            logger.info(\n              `[LevelDispatch] Loop budget check: routingLoopCount=${state.routingLoopCount}, max_loops=${context.config.routing?.max_loops ?? 10}`\n            );\n            // Check loop budget before scheduling\n            if (checkLoopBudget(context, state, 'on_finish', 'run')) {\n              const errorIssue: ReviewIssue = {\n                file: 'system',\n                line: 0,\n                ruleId: `${forEachParent}/routing/loop_budget_exceeded`,\n                message: `Routing loop budget exceeded (max_loops=${context.config.routing?.max_loops ?? 10}) during on_finish run`,\n                severity: 'error',\n                category: 'logic',\n              };\n              // Add error to parent result (not child aggregatedResult)\n              parentResult.issues = [...(parentResult.issues || []), errorIssue];\n              // Update parent result in journal with the error\n              try {\n                context.journal.commitEntry({\n                  sessionId: context.sessionId,\n                  checkId: forEachParent,\n                  result: parentResult as any,\n                  event: context.event || 'manual',\n                  scope: [],\n                });\n              } catch (err) {\n                logger.warn(\n                  `[LevelDispatch] Failed to commit parent result with loop budget error: ${err}`\n                );\n              }\n              return aggregatedResult; // ABORT\n            }\n\n            // Increment loop count\n            state.routingLoopCount++;\n\n            recordOnFinishRoutingEvent({\n              checkId: forEachParent,\n              action: 'run',\n              target: targetCheck,\n              source: 'run',\n              scope: [],\n            });\n            emitEvent({\n              type: 'ForwardRunRequested',\n              target: targetCheck,\n              scope: [],\n              origin: 'run',\n            });\n            queuedForward = true;\n          }\n        }\n\n        // Declarative transitions override goto/goto_js when present.\n        // Mirror routing.ts behavior for the forEach-parent on_finish path.\n        try {\n          const { evaluateTransitions } = await import('./routing');\n          const transTarget = await evaluateTransitions(\n            (onFinish as any).transitions,\n            forEachParent,\n            parentCheckConfig as any,\n            parentResult as any,\n            context,\n            state\n          );\n          if (transTarget !== undefined) {\n            if (transTarget) {\n              // Loop budget guard\n              if (checkLoopBudget(context, state, 'on_finish', 'goto')) {\n                const errorIssue: ReviewIssue = {\n                  file: 'system',\n                  line: 0,\n                  ruleId: `${forEachParent}/routing/loop_budget_exceeded`,\n                  message: `Routing loop budget exceeded (max_loops=${context.config.routing?.max_loops ?? 10}) during on_finish transitions`,\n                  severity: 'error',\n                  category: 'logic',\n                };\n                parentResult.issues = [...(parentResult.issues || []), errorIssue];\n                try {\n                  context.journal.commitEntry({\n                    sessionId: context.sessionId,\n                    checkId: forEachParent,\n                    result: parentResult as any,\n                    event: context.event || 'manual',\n                    scope: [],\n                  });\n                } catch {}\n                return aggregatedResult; // abort further routing\n              }\n              state.routingLoopCount++;\n              recordOnFinishRoutingEvent({\n                checkId: forEachParent,\n                action: 'goto',\n                target: transTarget.to,\n                source: 'transitions',\n                scope: [],\n                gotoEvent: (transTarget as any).goto_event,\n              });\n              emitEvent({\n                type: 'ForwardRunRequested',\n                target: transTarget.to,\n                scope: [],\n                origin: 'goto_js',\n                gotoEvent: (transTarget as any).goto_event,\n              });\n              queuedForward = true;\n            }\n            // Whether null (explicit no-op) or a target, transitions override goto/goto_js\n            // Also request a WaveRetry if we queued something (handled below)\n            if (queuedForward) {\n              // no-op here; WaveRetry emitted after this block\n            }\n            return aggregatedResult;\n          }\n        } catch (e) {\n          logger.error(\n            `[LevelDispatch] Error evaluating on_finish transitions for ${forEachParent}: ${e instanceof Error ? e.message : String(e)}`\n          );\n        }\n\n        // Evaluate goto_js and schedule routing if transitions did not match\n        const { evaluateGoto } = await import('./routing');\n\n        // Debug logging for forEach on_finish.goto_js evaluation\n        if (context.debug) {\n          logger.info(\n            `[LevelDispatch] Evaluating on_finish.goto_js for forEach parent: ${forEachParent}`\n          );\n          if (onFinish.goto_js) {\n            logger.info(`[LevelDispatch] goto_js code: ${onFinish.goto_js.substring(0, 200)}`);\n          }\n          try {\n            const snapshotId = context.journal.beginSnapshot();\n            const all = context.journal.readVisible(context.sessionId, snapshotId, undefined);\n            const keys = Array.from(new Set(all.map((e: any) => e.checkId)));\n            logger.info(`[LevelDispatch] history keys: ${keys.join(', ')}`);\n          } catch {}\n        }\n\n        const gotoTarget = await (evaluateGoto as any)(\n          onFinish.goto_js,\n          onFinish.goto,\n          forEachParent,\n          parentCheckConfig,\n          parentResult,\n          context,\n          state\n        );\n\n        if (context.debug) {\n          logger.info(`[LevelDispatch] goto_js evaluation result: ${gotoTarget || 'null'}`);\n        }\n\n        if (gotoTarget) {\n          // If we also queued on_finish.run and the goto target is the same\n          // forEach parent, defer this self-goto to avoid premature preemption\n          // before reducers (on_finish.run) have updated shared state (e.g.,\n          // memory). The goto will be scheduled AFTER the WaveRetry completes\n          // and checks can re-evaluate their conditions.\n          if (queuedForward && gotoTarget === forEachParent) {\n            logger.info(\n              `[LevelDispatch] on_finish.goto to self (${gotoTarget}) deferred, will process after WaveRetry`\n            );\n            // Still schedule the goto, but it will execute after aggregate completes\n            // and WaveRetry processes. This ensures the goto happens AFTER memory\n            // is updated by aggregate.\n            // Note: We don't schedule it immediately to avoid preemption, but we\n            // DO schedule it so it processes after the wave retry.\n          }\n          // Always schedule the goto (even if deferred) - it will execute in order\n          // Check loop budget before scheduling goto\n          if (checkLoopBudget(context, state, 'on_finish', 'goto')) {\n            const errorIssue: ReviewIssue = {\n              file: 'system',\n              line: 0,\n              ruleId: `${forEachParent}/routing/loop_budget_exceeded`,\n              message: `Routing loop budget exceeded (max_loops=${context.config.routing?.max_loops ?? 10}) during on_finish goto`,\n              severity: 'error',\n              category: 'logic',\n            };\n            // Add error to parent result (not child aggregatedResult)\n            parentResult.issues = [...(parentResult.issues || []), errorIssue];\n            // Update parent result in journal with the error\n            try {\n              context.journal.commitEntry({\n                sessionId: context.sessionId,\n                checkId: forEachParent,\n                result: parentResult as any,\n                event: context.event || 'manual',\n                scope: [],\n              });\n            } catch (err) {\n              logger.warn(\n                `[LevelDispatch] Failed to commit parent result with loop budget error: ${err}`\n              );\n            }\n            return aggregatedResult; // ABORT\n          }\n\n          logger.info(`[LevelDispatch] on_finish for ${forEachParent} routing to: ${gotoTarget}`);\n\n          // Increment loop count\n          state.routingLoopCount++;\n\n          recordOnFinishRoutingEvent({\n            checkId: forEachParent,\n            action: 'goto',\n            target: gotoTarget,\n            source: onFinish.goto_js ? 'goto_js' : 'goto',\n            scope: [],\n          });\n          emitEvent({\n            type: 'ForwardRunRequested',\n            target: gotoTarget,\n            scope: [],\n            origin: 'goto_js',\n            gotoEvent: context.event as any,\n          });\n          state.flags.forwardRunRequested = true;\n          // Also request a WaveRetry so planning occurs promptly even when preemption\n          // does not immediately rebuild a wave in some schedules.\n          try {\n            const guardKeyGoto = `waveRetry:on_finish:${forEachParent}:wave:${state.wave}`;\n            if (!(state as any).forwardRunGuards?.has(guardKeyGoto)) {\n              (state as any).forwardRunGuards?.add(guardKeyGoto);\n              emitEvent({ type: 'WaveRetry', reason: 'on_finish' });\n            }\n          } catch {}\n        } else {\n          logger.info(`[LevelDispatch] on_finish for ${forEachParent} returned null, no routing`);\n        }\n\n        // If we enqueued any on_finish.run targets, request a WaveRetry so the\n        // next wave re-evaluates guards/ifs across the full plan. Guard to\n        // avoid duplicate retries for the same parent within the same wave.\n        if (queuedForward) {\n          const guardKey = `waveRetry:on_finish:${forEachParent}:wave:${state.wave}`;\n          logger.info(\n            `[LevelDispatch] Checking WaveRetry guard: ${guardKey}, has=${!!(state as any).forwardRunGuards?.has(guardKey)}`\n          );\n          if (!(state as any).forwardRunGuards?.has(guardKey)) {\n            (state as any).forwardRunGuards?.add(guardKey);\n            logger.info(`[LevelDispatch] Emitting WaveRetry event for on_finish.run targets`);\n            emitEvent({ type: 'WaveRetry', reason: 'on_finish' });\n          }\n        } else {\n          // We may still have scheduled a goto above; in that case the guard\n          // block there has already emitted WaveRetry. Nothing to do here.\n        }\n\n        // No WaveRetry needed when goto was scheduled; the planner preempts\n        // remaining work and rebuilds the next wave around the goto target.\n      } else {\n        logger.warn(`[LevelDispatch] Could not find parent result for ${forEachParent} in journal`);\n      }\n    } catch (error) {\n      logger.error(\n        `[LevelDispatch] Error processing on_finish for forEach parent ${forEachParent}: ${error}`\n      );\n    }\n  }\n\n  return aggregatedResult;\n}\n\n/**\n * Execute a single check with provider integration\n */\nasync function executeSingleCheck(\n  checkId: string,\n  context: EngineContext,\n  state: RunState,\n  emitEvent: (event: EngineEvent) => void,\n  transition: (newState: EngineState) => void,\n  scopeOverride?: Array<{ check: string; index: number }>\n): Promise<ReviewSummary> {\n  // Check if this check depends on a forEach parent\n  const checkConfig = context.config.checks?.[checkId];\n\n  // Evaluate 'if' condition before execution\n  if (checkConfig?.if) {\n    const shouldRun = await evaluateIfCondition(checkId, checkConfig, context, state);\n\n    if (!shouldRun) {\n      // Log skip message at info level (visible without debug mode)\n      // Message format intentionally omits check name to satisfy e2e expectations.\n      logger.info(\n        `â­  Skipped (if: ${checkConfig.if.substring(0, 40)}${checkConfig.if.length > 40 ? '...' : ''})`\n      );\n\n      // Return empty result and mark as completed (tag as internal-skip for stats filtering)\n      const emptyResult: ReviewSummary = { issues: [] };\n      try {\n        Object.defineProperty(emptyResult as any, '__skipped', {\n          value: 'if_condition',\n          enumerable: false,\n        });\n      } catch {}\n\n      state.completedChecks.add(checkId);\n\n      // Track skip statistics\n      const stats: CheckExecutionStats = {\n        checkName: checkId,\n        totalRuns: 0,\n        successfulRuns: 0,\n        failedRuns: 0,\n        skippedRuns: 0,\n        skipped: true,\n        skipReason: 'if_condition',\n        skipCondition: checkConfig.if,\n        totalDuration: 0,\n        issuesFound: 0,\n        issuesBySeverity: {\n          critical: 0,\n          error: 0,\n          warning: 0,\n          info: 0,\n        },\n      };\n      state.stats.set(checkId, stats);\n      logger.info(`[LevelDispatch] Recorded skip stats for ${checkId}: skipReason=if_condition`);\n\n      // Store empty result in journal\n      try {\n        context.journal.commitEntry({\n          sessionId: context.sessionId,\n          checkId,\n          result: emptyResult as any,\n          event: context.event || 'manual',\n          scope: [],\n        });\n      } catch (error) {\n        logger.warn(`[LevelDispatch] Failed to commit skipped result to journal: ${error}`);\n      }\n\n      // Emit completed event\n      emitEvent({\n        type: 'CheckCompleted',\n        checkId,\n        scope: [],\n        result: emptyResult,\n      });\n\n      return emptyResult;\n    }\n  }\n\n  // Policy engine gating â€” after if-condition, before dependency gating\n  if (context.policyEngine && checkConfig) {\n    const gate = await applyPolicyGate(checkId, checkConfig, context.policyEngine);\n    if (gate.warn && gate.auditReason) {\n      // Record audit violation in stats for visibility\n      if (state.stats.has(checkId)) {\n        const s = state.stats.get(checkId)!;\n        (s as any).policyAuditWarning = gate.auditReason;\n      }\n    }\n    if (gate.skip) {\n      const emptyResult: ReviewSummary = { issues: [] };\n      try {\n        Object.defineProperty(emptyResult as any, '__skipped', {\n          value: 'policy_denied',\n          enumerable: false,\n        });\n      } catch {}\n      state.completedChecks.add(checkId);\n      const stats: CheckExecutionStats = {\n        checkName: checkId,\n        totalRuns: 0,\n        successfulRuns: 0,\n        failedRuns: 0,\n        skippedRuns: 0,\n        skipped: true,\n        skipReason: 'policy_denied',\n        skipCondition: gate.reason || 'policy denied',\n        totalDuration: 0,\n        issuesFound: 0,\n        issuesBySeverity: { critical: 0, error: 0, warning: 0, info: 0 },\n      };\n      state.stats.set(checkId, stats);\n      logger.info(`[LevelDispatch] Recorded skip stats for ${checkId}: skipReason=policy_denied`);\n      try {\n        context.journal.commitEntry({\n          sessionId: context.sessionId,\n          checkId,\n          result: emptyResult as any,\n          event: context.event || 'manual',\n          scope: [],\n        });\n      } catch (error) {\n        logger.warn(`[LevelDispatch] Failed to commit policy-denied result to journal: ${error}`);\n      }\n      emitEvent({\n        type: 'CheckCompleted',\n        checkId,\n        scope: [],\n        result: emptyResult,\n      });\n      return emptyResult;\n    }\n  }\n\n  const dependencies = checkConfig?.depends_on || [];\n  const depList = Array.isArray(dependencies) ? dependencies : [dependencies];\n\n  // Dependency gating with continue_on_failure and OR groups (\"A|B\")\n  const failedChecks = (state as any).failedChecks as Set<string> | undefined;\n  // Check for allowed failed dependencies (from on_fail.run triggers)\n  const allowedFailedDeps = state.allowedFailedDeps?.get(checkId);\n  const tokens = depList.filter(Boolean) as string[];\n  const groupSatisfied = (token: string): boolean => {\n    const options = token.includes('|')\n      ? token\n          .split('|')\n          .map(s => s.trim())\n          .filter(Boolean)\n      : [token];\n    for (const opt of options) {\n      // Check if this failed dependency is explicitly allowed (from on_fail.run)\n      // When a check is triggered by on_fail.run, it needs to run even though\n      // its dependency failed - that's the whole point of on_fail.run\n      const isAllowedFailedDep = !!(allowedFailedDeps && allowedFailedDeps.has(opt));\n      if (isAllowedFailedDep) {\n        if (context.debug) {\n          logger.info(\n            `[LevelDispatch] Allowing ${checkId} to run despite failed dependency ${opt} (on_fail.run)`\n          );\n        }\n        return true;\n      }\n\n      const depCfg: any = context.config.checks?.[opt];\n      const cont = !!(depCfg && depCfg.continue_on_failure === true);\n      const st = state.stats.get(opt);\n      const skipped = !!(st && (st as any).skipped === true);\n      const skipReason = (st as any)?.skipReason;\n      // forEach_empty is not a failure - it means there was nothing to process, which is valid\n      // The dependent step should still run (with empty data from the forEach step)\n      const skippedDueToEmptyForEach = skipped && skipReason === 'forEach_empty';\n      // Don't treat forEach_empty as a failure even if it's in failedChecks\n      // (forEach_empty checks are added to failedChecks for cascading within forEach chains,\n      // but should not be treated as failures for non-forEach dependents)\n      const wasMarkedFailed =\n        !!(failedChecks && failedChecks.has(opt)) && !skippedDueToEmptyForEach;\n      const failedOnly = !!(st && (st.failedRuns || 0) > 0 && (st.successfulRuns || 0) === 0);\n      const satisfied =\n        (!skipped || skippedDueToEmptyForEach) && ((!failedOnly && !wasMarkedFailed) || cont);\n      if (satisfied) return true;\n    }\n    return false;\n  };\n\n  if (tokens.length > 0) {\n    let allOk = true;\n    for (const t of tokens) {\n      if (!groupSatisfied(t)) {\n        allOk = false;\n        break;\n      }\n    }\n    if (!allOk) {\n      const emptyResult: ReviewSummary = { issues: [] };\n      try {\n        Object.defineProperty(emptyResult as any, '__skipped', {\n          value: 'dependency_failed',\n          enumerable: false,\n        });\n      } catch {}\n      state.completedChecks.add(checkId);\n      if (!(state as any).failedChecks) (state as any).failedChecks = new Set<string>();\n      (state as any).failedChecks.add(checkId);\n      const stats: CheckExecutionStats = {\n        checkName: checkId,\n        totalRuns: 0,\n        successfulRuns: 0,\n        failedRuns: 0,\n        skippedRuns: 0,\n        skipped: true,\n        skipReason: 'dependency_failed',\n        totalDuration: 0,\n        issuesFound: 0,\n        issuesBySeverity: { critical: 0, error: 0, warning: 0, info: 0 },\n      };\n      state.stats.set(checkId, stats);\n      try {\n        context.journal.commitEntry({\n          sessionId: context.sessionId,\n          checkId,\n          result: emptyResult as any,\n          event: context.event || 'manual',\n          scope: [],\n        });\n      } catch (error) {\n        logger.warn(`[LevelDispatch] Failed to commit empty result to journal: ${error}`);\n      }\n      emitEvent({ type: 'CheckCompleted', checkId, scope: [], result: emptyResult });\n      return emptyResult;\n    }\n  }\n\n  let forEachParent: string | undefined;\n  let forEachItems: unknown[] | undefined;\n\n  // Find if any dependency is a forEach parent with items\n  for (const depId of depList) {\n    if (!depId) continue;\n\n    try {\n      const snapshotId = context.journal.beginSnapshot();\n      const contextView = new (require('../../snapshot-store').ContextView)(\n        context.journal,\n        context.sessionId,\n        snapshotId,\n        [],\n        context.event\n      );\n      const depResult: any = contextView.get(depId);\n\n      if (context.debug) {\n        logger.info(\n          `[LevelDispatch] Checking dependency ${depId} for ${checkId}: has forEachItems=${!!depResult?.forEachItems}, isArray=${Array.isArray(depResult?.forEachItems)}`\n        );\n        if (depResult?.forEachItems) {\n          logger.info(\n            `[LevelDispatch] forEachItems length: ${depResult.forEachItems.length}, items: ${JSON.stringify(depResult.forEachItems).substring(0, 200)}`\n          );\n        }\n      }\n\n      if (depResult?.forEachItems && Array.isArray(depResult.forEachItems)) {\n        forEachParent = depId;\n        forEachItems = depResult.forEachItems;\n        if (context.debug && forEachItems) {\n          logger.info(\n            `[LevelDispatch] Detected forEach parent ${depId} with ${forEachItems.length} items for check ${checkId}`\n          );\n        }\n        break;\n      }\n    } catch (error) {\n      if (context.debug) {\n        logger.warn(`[LevelDispatch] Error checking forEach parent ${depId}: ${error}`);\n      }\n    }\n  }\n\n  // If there's a forEach parent, decide fanout behavior:\n  // - fanout: 'map'  => run once per item\n  // - fanout: 'reduce' (default) => run once at parent scope\n  if (forEachParent && forEachItems !== undefined) {\n    // Determine fanout mode\n    let fanoutMode: 'map' | 'reduce' = 'reduce';\n    const explicit = (checkConfig as any)?.fanout as 'map' | 'reduce' | undefined;\n    if (explicit === 'map' || explicit === 'reduce') {\n      fanoutMode = explicit;\n    } else {\n      // Heuristic default: most providers (command, ai, http, etc.) map per item.\n      // Aggregator-style providers (log, memory, script, workflow/noop) default to reduce.\n      const providerType = context.checks[checkId]?.providerType || '';\n      const reduceProviders = new Set(['log', 'memory', 'script', 'workflow', 'noop']);\n      fanoutMode = reduceProviders.has(providerType) ? 'reduce' : 'map';\n    }\n    if (fanoutMode === 'map') {\n      // Per-item execution\n      if (forEachItems.length === 0) {\n        // forEach parent has zero items - skip this check entirely\n        // Log skip message at info level (visible without debug mode)\n        logger.info(`â­  Skipped (forEach parent \"${forEachParent}\" has 0 items)`);\n\n        if (context.debug) {\n          logger.info(\n            `[LevelDispatch] Skipping check ${checkId}: forEach parent ${forEachParent} has zero items`\n          );\n        }\n\n        // Return empty result\n        const emptyResult: ReviewSummary = { issues: [] };\n        try {\n          Object.defineProperty(emptyResult as any, '__skipped', {\n            value: 'forEach_empty',\n            enumerable: false,\n          });\n        } catch {}\n\n        // Mark as completed\n        state.completedChecks.add(checkId);\n\n        // Mark this check as failed so downstream dependencies also skip\n        // This enables cascade skipping when a forEach parent has no items\n        if (!(state as any).failedChecks) {\n          (state as any).failedChecks = new Set<string>();\n        }\n        (state as any).failedChecks.add(checkId);\n\n        // Determine skip reason: if the parent failed, prefer dependency_failed over forEach_empty\n        let derivedSkipReason: 'forEach_empty' | 'dependency_failed' = 'forEach_empty';\n        try {\n          const parentFailed =\n            !!((state as any).failedChecks && (state as any).failedChecks.has(forEachParent)) ||\n            (() => {\n              const s = state.stats.get(forEachParent);\n              return !!(s && (s.failedRuns || 0) > 0);\n            })();\n          if (parentFailed) derivedSkipReason = 'dependency_failed';\n        } catch {}\n\n        // Update stats to record skip\n        const stats: CheckExecutionStats = {\n          checkName: checkId,\n          totalRuns: 0,\n          successfulRuns: 0,\n          failedRuns: 0,\n          skippedRuns: 0,\n          skipped: true,\n          skipReason: derivedSkipReason,\n          totalDuration: 0,\n          issuesFound: 0,\n          issuesBySeverity: {\n            critical: 0,\n            error: 0,\n            warning: 0,\n            info: 0,\n          },\n        };\n        state.stats.set(checkId, stats);\n\n        // Store empty result in journal\n        try {\n          context.journal.commitEntry({\n            sessionId: context.sessionId,\n            checkId,\n            result: emptyResult as any,\n            event: context.event || 'manual',\n            scope: [],\n          });\n        } catch (error) {\n          logger.warn(`[LevelDispatch] Failed to commit empty result to journal: ${error}`);\n        }\n\n        // Emit completed event\n        emitEvent({\n          type: 'CheckCompleted',\n          checkId,\n          scope: [],\n          result: emptyResult,\n        });\n\n        return emptyResult;\n      }\n\n      return await executeCheckWithForEachItems(\n        checkId,\n        forEachParent,\n        forEachItems,\n        context,\n        state,\n        emitEvent,\n        transition\n      );\n    }\n    // fanout reduce: fall through to normal single execution below\n  }\n\n  // Normal execution without forEach\n  const scope: Array<{ check: string; index: number }> = scopeOverride || [];\n\n  // Emit scheduled event\n  emitEvent({ type: 'CheckScheduled', checkId, scope });\n\n  // Track start time for duration calculation\n  const startTime = Date.now();\n\n  // Create dispatch record\n  const dispatch: DispatchRecord = {\n    id: `${checkId}-${Date.now()}`,\n    checkId,\n    scope,\n    provider: context.checks[checkId]?.providerType || 'unknown',\n    startMs: startTime,\n    attempts: 1,\n  };\n\n  state.activeDispatches.set(checkId, dispatch);\n\n  try {\n    // Get check configuration\n    const checkConfig = context.config.checks?.[checkId];\n    if (!checkConfig) {\n      throw new Error(`Check configuration not found: ${checkId}`);\n    }\n\n    // Build lightweight checks metadata for template helpers (e.g., chat_history)\n    const checksMeta: Record<string, { type?: string; group?: string }> = {};\n    try {\n      const allChecks = context.config.checks || {};\n      for (const [id, cfg] of Object.entries(allChecks)) {\n        const anyCfg = cfg as any;\n        checksMeta[id] = { type: anyCfg.type, group: anyCfg.group };\n      }\n    } catch {\n      // Best-effort only; helpers will fall back if this is missing\n    }\n\n    // Get provider\n    const providerType = checkConfig.type || 'ai';\n    const providerRegistry =\n      require('../../providers/check-provider-registry').CheckProviderRegistry.getInstance();\n    const provider = providerRegistry.getProviderOrThrow(providerType);\n\n    // Build output history for template rendering\n    const outputHistory = buildOutputHistoryFromJournal(context);\n\n    // Resolve workflow inputs from config or context (centralized logic)\n    const workflowInputs = resolveWorkflowInputs(checkConfig, context);\n\n    // Build provider configuration\n    const providerConfig: CheckProviderConfig = {\n      type: providerType,\n      checkName: checkId,\n      prompt: checkConfig.prompt,\n      exec: checkConfig.exec,\n      schema: checkConfig.schema,\n      group: checkConfig.group,\n      focus: checkConfig.focus || mapCheckNameToFocus(checkId),\n      transform: checkConfig.transform,\n      transform_js: checkConfig.transform_js,\n      env: checkConfig.env,\n      forEach: checkConfig.forEach,\n      ...checkConfig,\n      eventContext: (context.prInfo as any)?.eventContext || {},\n      // Expose history and checks metadata for template helpers\n      __outputHistory: outputHistory,\n      checksMeta,\n      // Propagate workflow inputs for template access via {{ inputs.* }}\n      workflowInputs,\n      ai: {\n        ...(checkConfig.ai || {}),\n        timeout: checkConfig.ai?.timeout || 1800000,\n        debug: !!context.debug,\n      },\n    };\n\n    // Propagate authenticated Octokit (v2 frontends / Action mode)\n    try {\n      const maybeOctokit = (context.executionContext as any)?.octokit;\n      if (maybeOctokit) {\n        (providerConfig as any).eventContext = {\n          ...(providerConfig as any).eventContext,\n          octokit: maybeOctokit,\n        };\n      }\n    } catch {}\n\n    // Extract Slack conversation from webhookContext (for Slack socket mode)\n    // The socket-runner stores conversation data in webhookData under the endpoint key\n    try {\n      const webhookCtx = (context.executionContext as any)?.webhookContext;\n      const webhookData = webhookCtx?.webhookData as Map<string, unknown> | undefined;\n      if (context.debug) {\n        logger.info(\n          `[LevelDispatch] webhookContext: ${webhookCtx ? 'present' : 'absent'}, webhookData size: ${webhookData?.size || 0}`\n        );\n      }\n      if (webhookData && webhookData.size > 0) {\n        // Find the payload with slack_conversation\n        for (const payload of webhookData.values()) {\n          const slackConv = (payload as any)?.slack_conversation;\n          if (slackConv) {\n            // Build slack context with event and conversation\n            const event = (payload as any)?.event;\n            const messageCount = Array.isArray(slackConv?.messages) ? slackConv.messages.length : 0;\n            if (context.debug) {\n              logger.info(`[LevelDispatch] Slack conversation extracted: ${messageCount} messages`);\n            }\n            (providerConfig as any).eventContext = {\n              ...(providerConfig as any).eventContext,\n              slack: {\n                event: event || {},\n                conversation: slackConv,\n              },\n              conversation: slackConv, // Also expose at top level for convenience\n            };\n            break;\n          }\n        }\n      }\n    } catch {}\n\n    // Fallback: expose conversation from executionContext (for CLI --message)\n    // Only if no Slack conversation was set above\n    try {\n      if (\n        !(providerConfig as any).eventContext?.conversation &&\n        (context.executionContext as any)?.conversation\n      ) {\n        (providerConfig as any).eventContext = {\n          ...(providerConfig as any).eventContext,\n          conversation: (context.executionContext as any).conversation,\n        };\n      }\n    } catch {}\n\n    // Build dependency results\n    const dependencyResults = buildDependencyResults(checkId, checkConfig, context, state);\n\n    // Build PR info (use real prInfo from context if available, otherwise use defaults)\n    const prInfo: any = context.prInfo || {\n      number: 1,\n      title: 'State Machine Execution',\n      author: 'system',\n      eventType: context.event || 'manual',\n      eventContext: {},\n      files: [],\n      commits: [],\n    };\n\n    // Build execution context with engine mode and parent context (M3: nested workflows)\n    // Also inject args from on_success.run with directives if present\n    // Render any Liquid templates in pending args using the dependency outputs\n    const rawPendingArgs = state.pendingRunArgs?.get(checkId);\n    const depResultsObj: Record<string, unknown> = {};\n    for (const [k, v] of dependencyResults.entries()) {\n      const summary = v as ReviewSummary & { output?: unknown };\n      depResultsObj[k] = summary.output !== undefined ? summary.output : summary;\n    }\n    const renderedArgs = rawPendingArgs\n      ? await renderTemplateArgs(rawPendingArgs, depResultsObj, context)\n      : undefined;\n    const executionContext = {\n      ...context.executionContext,\n      _engineMode: context.mode,\n      _parentContext: context,\n      _parentState: state,\n      // Make checks metadata available to providers that want it\n      checksMeta,\n      // Inject args from on_success.run with directives (merged with existing args)\n      args: renderedArgs\n        ? { ...((context.executionContext as any)?.args || {}), ...renderedArgs }\n        : (context.executionContext as any)?.args,\n    };\n\n    // Evaluate assume contract (design-by-contract) before executing\n    {\n      const assumeExpr = (checkConfig as any)?.assume as string | string[] | undefined;\n      if (assumeExpr) {\n        let ok = true;\n        try {\n          const evaluator = new FailureConditionEvaluator();\n          const exprs = Array.isArray(assumeExpr) ? assumeExpr : [assumeExpr];\n          // Get conversation from execution context (TUI/CLI) or provider event context (Slack)\n          const conversation =\n            (context.executionContext as any)?.conversation ||\n            (providerConfig as any)?.eventContext?.conversation;\n          for (const ex of exprs) {\n            const res = await evaluator.evaluateIfCondition(checkId, ex, {\n              event: context.event || 'manual',\n              previousResults: dependencyResults as any,\n              conversation,\n            } as any);\n            if (!res) {\n              ok = false;\n              break;\n            }\n          }\n        } catch (error) {\n          const msg = error instanceof Error ? error.message : String(error);\n          logger.error(`Failed to evaluate assume expression for check '${checkId}': ${msg}`);\n          // Fail-secure: if assume evaluation fails, skip execution\n          ok = false;\n        }\n        if (!ok) {\n          logger.info(\n            `â­  Skipped (assume: ${String(Array.isArray(assumeExpr) ? assumeExpr[0] : assumeExpr).substring(0, 40)}${String(Array.isArray(assumeExpr) ? assumeExpr[0] : assumeExpr).length > 40 ? '...' : ''})`\n          );\n          // Mark as completed and record skip stats\n          state.completedChecks.add(checkId);\n          const stats: CheckExecutionStats = {\n            checkName: checkId,\n            totalRuns: 0,\n            successfulRuns: 0,\n            failedRuns: 0,\n            skippedRuns: 0,\n            skipped: true,\n            skipReason: 'assume',\n            totalDuration: 0,\n            issuesFound: 0,\n            issuesBySeverity: { critical: 0, error: 0, warning: 0, info: 0 },\n          };\n          state.stats.set(checkId, stats);\n          const emptyResult: ReviewSummary = { issues: [] };\n          try {\n            Object.defineProperty(emptyResult as any, '__skipped', {\n              value: 'assume',\n              enumerable: false,\n            });\n          } catch {}\n          try {\n            context.journal.commitEntry({\n              sessionId: context.sessionId,\n              checkId,\n              result: emptyResult as any,\n              event: context.event || 'manual',\n              scope,\n            });\n          } catch {}\n          emitEvent({ type: 'CheckCompleted', checkId, scope, result: emptyResult });\n          return emptyResult;\n        }\n      }\n    }\n\n    // Emit provider telemetry\n    try {\n      emitNdjsonFallback('visor.provider', {\n        'visor.check.id': checkId,\n        'visor.provider.type': providerType,\n      });\n    } catch {}\n\n    // Execute provider with telemetry (sandbox routing if configured)\n    const result = await withActiveSpan(\n      `visor.check.${checkId}`,\n      {\n        'visor.check.id': checkId,\n        'visor.check.type': providerType,\n        session_id: context.sessionId,\n        wave: state.wave,\n      },\n      async span => {\n        const res = await executeWithSandboxRouting(\n          checkId,\n          checkConfig,\n          context,\n          prInfo,\n          dependencyResults,\n          checkConfig.ai?.timeout || 1800000,\n          () => provider.execute(prInfo, providerConfig, dependencyResults, executionContext)\n        );\n        try {\n          captureCheckOutput(span, (res as any).output);\n        } catch {}\n        return res;\n      }\n    );\n\n    // Special case: human-input style checks that intentionally pause the run\n    // (e.g., Slack SocketMode awaiting a reply) surface a marker on the result.\n    // When we see this, mark the run state so WavePlanning can terminate cleanly\n    // after this level instead of continuing to downstream checks.\n    try {\n      const awaitingHumanInput =\n        (result as any)?.awaitingHumanInput === true ||\n        ((result as any)?.output && (result as any).output.awaitingHumanInput === true);\n      if (awaitingHumanInput) {\n        (state as any).flags = (state as any).flags || {};\n        (state as any).flags.awaitingHumanInput = true;\n        logger.info(\n          `[LevelDispatch] Set awaitingHumanInput=true for check ${checkId} (wave=${state.wave})`\n        );\n      }\n    } catch (e) {\n      logger.warn(`[LevelDispatch] Failed to check awaitingHumanInput flag: ${e}`);\n    }\n\n    // Enrich issues with metadata\n    const enrichedIssues = (result.issues || []).map((issue: ReviewIssue) => ({\n      ...issue,\n      checkName: checkId,\n      ruleId: `${checkId}/${issue.ruleId || 'unknown'}`,\n      group: checkConfig.group,\n      schema: typeof checkConfig.schema === 'object' ? 'custom' : checkConfig.schema,\n      template: checkConfig.template,\n      timestamp: Date.now(),\n    }));\n\n    const enrichedResult: any = {\n      ...result,\n      issues: enrichedIssues,\n    };\n\n    // Validate output against JSON Schema if provided (non-fatal contract)\n    try {\n      let schemaObj =\n        (typeof checkConfig.schema === 'object' ? (checkConfig.schema as any) : undefined) ||\n        (checkConfig as any).output_schema;\n      if (!schemaObj && typeof (checkConfig as any).schema === 'string') {\n        try {\n          const { loadRendererSchema } = await import('../dispatch/renderer-schema');\n          schemaObj = await loadRendererSchema((checkConfig as any).schema as string);\n        } catch {}\n      }\n      if (schemaObj && (enrichedResult as any)?.output !== undefined) {\n        const Ajv = require('ajv');\n        const ajv = new Ajv({ allErrors: true, allowUnionTypes: true, strict: false });\n        const validate = ajv.compile(schemaObj);\n        const valid = validate((enrichedResult as any).output);\n        if (!valid) {\n          const errs = (validate.errors || [])\n            .slice(0, 3)\n            .map((e: any) => e.message)\n            .join('; ');\n          const issue: ReviewIssue = {\n            file: 'contract',\n            line: 0,\n            ruleId: `contract/schema_validation_failed`,\n            message: `Output schema validation failed${errs ? `: ${errs}` : ''}`,\n            severity: 'error',\n            category: 'logic',\n            checkName: checkId,\n            group: checkConfig.group,\n            schema: 'json-schema',\n            timestamp: Date.now(),\n          } as any;\n          enrichedResult.issues = [...(enrichedResult.issues || []), issue];\n        }\n      }\n    } catch {}\n\n    // Evaluate guarantee contract after execution (non-fatal)\n    try {\n      const guaranteeExpr = (checkConfig as any)?.guarantee as string | string[] | undefined;\n      if (guaranteeExpr) {\n        const evaluator = new FailureConditionEvaluator();\n        const exprs = Array.isArray(guaranteeExpr) ? guaranteeExpr : [guaranteeExpr];\n        for (const ex of exprs) {\n          const holds = await evaluator.evaluateIfCondition(checkId, ex, {\n            previousResults: dependencyResults as any,\n            event: context.event || 'manual',\n            output: enrichedResult.output,\n          } as any);\n          if (!holds) {\n            const issue: ReviewIssue = {\n              file: 'contract',\n              line: 0,\n              ruleId: `contract/guarantee_failed`,\n              message: `Guarantee failed: ${ex}`,\n              severity: 'error',\n              category: 'logic',\n              checkName: checkId,\n              group: checkConfig.group,\n              schema:\n                typeof checkConfig.schema === 'object' ? 'custom' : (checkConfig.schema as any),\n              timestamp: Date.now(),\n            } as any;\n            enrichedResult.issues = [...(enrichedResult.issues || []), issue];\n          }\n        }\n      }\n    } catch {}\n\n    // Handle forEach: true checks - convert output array to forEachItems\n    let isForEach = (result as any).isForEach;\n    let forEachItems = (result as any).forEachItems;\n\n    // DEBUG: Log forEach handling\n    logger.info(\n      `[LevelDispatch][DEBUG] After execution ${checkId}: checkConfig.forEach=${checkConfig.forEach}, output type=${typeof (result as any).output}, isArray=${Array.isArray((result as any).output)}`\n    );\n\n    if (checkConfig.forEach === true) {\n      const output = (result as any).output;\n      logger.info(\n        `[LevelDispatch][DEBUG] Processing forEach=true for ${checkId}, output=${JSON.stringify(output)?.substring(0, 200)}`\n      );\n\n      // Validate forEach output (must not be undefined)\n      if (output === undefined) {\n        logger.error(`[LevelDispatch] forEach check \"${checkId}\" produced undefined output`);\n        const undefinedError: ReviewIssue = {\n          file: 'system',\n          line: 0,\n          // Mark as execution failure so dependents treat this as failed dependency\n          ruleId: 'forEach/execution_error',\n          message: `forEach check \"${checkId}\" produced undefined output. Verify your command outputs valid data and your transform_js returns a value.`,\n          severity: 'error',\n          category: 'logic',\n        };\n        enrichedResult.issues = [...(enrichedResult.issues || []), undefinedError];\n        // Mark as forEach with empty items to skip dependent iterations\n        isForEach = true;\n        forEachItems = [];\n        enrichedResult.isForEach = true;\n        enrichedResult.forEachItems = [];\n        // Also mark this check as failed so downstream dependents skip with dependency_failed\n        try {\n          if (!(state as any).failedChecks) {\n            (state as any).failedChecks = new Set<string>();\n          }\n          (state as any).failedChecks.add(checkId);\n        } catch {}\n        // Early exit: persist result and stop further processing to avoid\n        // undefined-state follow-on work (routing/template/per-item commits).\n        try {\n          // Record completion BEFORE storing\n          state.completedChecks.add(checkId);\n          const currentWaveCompletions = (state as any).currentWaveCompletions as\n            | Set<string>\n            | undefined;\n          if (currentWaveCompletions) currentWaveCompletions.add(checkId);\n\n          // Update aggregated stats for forEach parent (failed run, 0 outputs)\n          const existing = state.stats.get(checkId);\n          const aggStats: CheckExecutionStats = existing || {\n            checkName: checkId,\n            totalRuns: 0,\n            successfulRuns: 0,\n            failedRuns: 0,\n            skippedRuns: 0,\n            skipped: false,\n            totalDuration: 0,\n            issuesFound: 0,\n            issuesBySeverity: { critical: 0, error: 0, warning: 0, info: 0 },\n          };\n          aggStats.totalRuns++;\n          aggStats.failedRuns++;\n          aggStats.outputsProduced = 0;\n          state.stats.set(checkId, aggStats);\n\n          // Store in journal\n          context.journal.commitEntry({\n            sessionId: context.sessionId,\n            checkId,\n            result: enrichedResult as any,\n            event: context.event || 'manual',\n            scope: [],\n          });\n        } catch (err) {\n          logger.warn(`[LevelDispatch] Failed to persist undefined forEach result: ${err}`);\n        }\n\n        // Clear active dispatch and emit completion event\n        try {\n          state.activeDispatches.delete(checkId);\n        } catch {}\n        emitEvent({\n          type: 'CheckCompleted',\n          checkId,\n          scope: [],\n          result: enrichedResult,\n        });\n        return enrichedResult as ReviewSummary;\n      } else if (Array.isArray(output)) {\n        isForEach = true;\n        forEachItems = output;\n        enrichedResult.isForEach = true;\n        enrichedResult.forEachItems = output;\n\n        // Log forEach items count (always log, not just in debug mode)\n        logger.info(`  Found ${output.length} items for forEach iteration`);\n\n        if (context.debug) {\n          logger.info(\n            `[LevelDispatch] Check ${checkId} is forEach parent with ${output.length} items`\n          );\n        }\n      } else {\n        // forEach check but output is not an array - convert to single-item array\n        if (context.debug) {\n          logger.warn(\n            `[LevelDispatch] Check ${checkId} has forEach:true but output is not an array: ${typeof output}, converting to single-item array`\n          );\n        }\n        isForEach = true;\n        forEachItems = [output];\n        enrichedResult.isForEach = true;\n        enrichedResult.forEachItems = [output];\n      }\n    }\n\n    // Also preserve forEach metadata if already present (from provider)\n    if ((result as any).isForEach) {\n      enrichedResult.isForEach = true;\n    }\n    if ((result as any).forEachItems) {\n      enrichedResult.forEachItems = (result as any).forEachItems;\n    }\n    if ((result as any).forEachItemResults) {\n      enrichedResult.forEachItemResults = (result as any).forEachItemResults;\n    }\n    if ((result as any).forEachFatalMask) {\n      enrichedResult.forEachFatalMask = (result as any).forEachFatalMask;\n    }\n\n    // Render template content and emit Mermaid diagrams\n    let renderedContent: string | undefined;\n    try {\n      renderedContent = await renderTemplateContent(checkId, checkConfig, enrichedResult);\n      if (renderedContent) {\n        logger.debug(\n          `[LevelDispatch] Template rendered for ${checkId}: ${renderedContent.length} chars`\n        );\n        // Emit Mermaid diagram events from the rendered content\n        emitMermaidFromMarkdown(checkId, renderedContent, 'content');\n      } else {\n        logger.debug(`[LevelDispatch] No template content rendered for ${checkId}`);\n      }\n    } catch (error) {\n      logger.warn(`[LevelDispatch] Failed to render template for ${checkId}: ${error}`);\n    }\n\n    // Generate default content from issues if no template content was rendered\n    if (!renderedContent && enrichedIssues.length > 0) {\n      renderedContent = enrichedIssues\n        .map(\n          (i: ReviewIssue) =>\n            `- **${i.severity.toUpperCase()}**: ${i.message} (${i.file}:${i.line})`\n        )\n        .join('\\n');\n    }\n\n    // Add timestamp to output if it exists and is an object\n    // For primitive outputs (number, string, boolean), preserve them as-is\n    let outputWithTimestamp: any = undefined;\n    if ((result as any).output !== undefined) {\n      const output = (result as any).output;\n      if (output !== null && typeof output === 'object' && !Array.isArray(output)) {\n        // Only add timestamp to plain objects\n        outputWithTimestamp = { ...output, ts: Date.now() };\n      } else {\n        // Preserve primitives, arrays, and null as-is\n        outputWithTimestamp = output;\n      }\n    }\n\n    // Add rendered content to the result\n    const enrichedResultWithContent = renderedContent\n      ? { ...enrichedResult, content: renderedContent }\n      : enrichedResult;\n\n    const enrichedResultWithTimestamp =\n      outputWithTimestamp !== undefined\n        ? { ...enrichedResultWithContent, output: outputWithTimestamp }\n        : enrichedResultWithContent;\n\n    // Record completion BEFORE routing (so routing can see it as completed)\n    state.completedChecks.add(checkId);\n\n    // Track wave-specific completion for 'if' condition evaluation\n    const currentWaveCompletions = (state as any).currentWaveCompletions as Set<string> | undefined;\n    if (currentWaveCompletions) {\n      currentWaveCompletions.add(checkId);\n    }\n\n    // Process routing (fail_if, on_success, on_fail) BEFORE storing in journal\n    // This allows routing errors to be included in the stored result\n    try {\n      logger.info(`[LevelDispatch] Calling handleRouting for ${checkId}`);\n    } catch {}\n    const wasHalted = await handleRouting(context, state, transition, emitEvent, {\n      checkId,\n      scope,\n      result: enrichedResult,\n      checkConfig: checkConfig as CheckConfig,\n      success: !hasFatalIssues(enrichedResult),\n    });\n\n    // If execution was halted by halt_execution, commit the result (with halt issue) then return\n    if (wasHalted) {\n      logger.info(\n        `[LevelDispatch] Execution halted after routing for ${checkId}, stopping level dispatch`\n      );\n      // Still commit the result so the halt issue is captured in the final summary\n      try {\n        const commitResult: any = {\n          ...enrichedResult,\n          ...(renderedContent ? { content: renderedContent } : {}),\n          ...((result as any).output !== undefined\n            ? outputWithTimestamp !== undefined\n              ? { output: outputWithTimestamp }\n              : { output: (result as any).output }\n            : {}),\n        };\n        context.journal.commitEntry({\n          sessionId: context.sessionId,\n          checkId,\n          result: commitResult,\n          event: context.event || 'manual',\n          scope,\n        });\n      } catch (error) {\n        logger.warn(`[LevelDispatch] Failed to commit halt result to journal: ${error}`);\n      }\n      return enrichedResult;\n    }\n\n    // NOW store in journal with routing-side mutations included (e.g., fail_if issues)\n    // Rebuild the commit payload from the possibly mutated enrichedResult so new issues are captured.\n    try {\n      const commitResult: any = {\n        ...enrichedResult,\n        ...(renderedContent ? { content: renderedContent } : {}),\n        ...((result as any).output !== undefined\n          ? outputWithTimestamp !== undefined\n            ? { output: outputWithTimestamp }\n            : { output: (result as any).output }\n          : {}),\n      };\n\n      context.journal.commitEntry({\n        sessionId: context.sessionId,\n        checkId,\n        result: commitResult,\n        event: context.event || 'manual',\n        scope,\n      });\n    } catch (error) {\n      logger.warn(`[LevelDispatch] Failed to commit to journal: ${error}`);\n    }\n\n    // For forEach parent checks (this check produced forEachItems), record a single aggregated run in stats\n    if (isForEach) {\n      try {\n        const existing = state.stats.get(checkId);\n        const aggStats: CheckExecutionStats = existing || {\n          checkName: checkId,\n          totalRuns: 0,\n          successfulRuns: 0,\n          failedRuns: 0,\n          skippedRuns: 0,\n          skipped: false,\n          totalDuration: 0,\n          issuesFound: 0,\n          issuesBySeverity: { critical: 0, error: 0, warning: 0, info: 0 },\n        };\n        aggStats.totalRuns++;\n        const hasFatal = hasFatalIssues(enrichedResultWithTimestamp as any);\n        if (hasFatal) aggStats.failedRuns++;\n        else aggStats.successfulRuns++;\n        // outputsProduced for parent equals number of items\n        const items = (enrichedResultWithTimestamp as any).forEachItems;\n        if (Array.isArray(items)) aggStats.outputsProduced = items.length;\n        state.stats.set(checkId, aggStats);\n      } catch {}\n    }\n\n    // If this is a forEach check, also commit per-item results\n    if (isForEach && forEachItems && Array.isArray(forEachItems)) {\n      for (let itemIndex = 0; itemIndex < forEachItems.length; itemIndex++) {\n        const itemScope: Array<{ check: string; index: number }> = [\n          { check: checkId, index: itemIndex },\n        ];\n        const item = forEachItems[itemIndex];\n\n        try {\n          context.journal.commitEntry({\n            sessionId: context.sessionId,\n            checkId,\n            result: { issues: [], output: item } as any,\n            event: context.event || 'manual',\n            scope: itemScope,\n          });\n        } catch (error) {\n          logger.warn(\n            `[LevelDispatch] Failed to commit per-item journal for ${checkId} item ${itemIndex}: ${error}`\n          );\n        }\n      }\n    }\n\n    state.activeDispatches.delete(checkId);\n\n    // Emit completed event with full result (including routing errors)\n    emitEvent({\n      type: 'CheckCompleted',\n      checkId,\n      scope,\n      result: {\n        ...enrichedResult,\n        output: (result as any).output,\n        content: renderedContent || (result as any).content,\n      },\n    });\n\n    return enrichedResult;\n  } catch (error) {\n    const err = error instanceof Error ? error : new Error(String(error));\n    logger.error(`[LevelDispatch] Error executing check ${checkId}: ${err.message}`);\n\n    state.activeDispatches.delete(checkId);\n\n    // Emit error event\n    emitEvent({\n      type: 'CheckErrored',\n      checkId,\n      scope,\n      error: {\n        message: err.message,\n        stack: err.stack,\n        name: err.name,\n      },\n    });\n    // Re-throw so the caller records the failure in statistics and surfaces\n    // a single top-level system/error issue via statistics aggregation.\n    throw err;\n  }\n}\n\n/**\n * Build dependency results for a check with scope\n */\nfunction buildDependencyResultsWithScope(\n  checkId: string,\n  checkConfig: any,\n  context: EngineContext,\n  scope: Array<{ check: string; index: number }>\n): Map<string, ReviewSummary> {\n  const dependencyResults = new Map<string, ReviewSummary>();\n\n  // Get dependencies from configuration\n  const dependencies = checkConfig.depends_on || [];\n  const depList = Array.isArray(dependencies) ? dependencies : [dependencies];\n\n  // Determine current forEach index from scope (if any)\n  const currentIndex = scope.length > 0 ? scope[scope.length - 1].index : undefined;\n\n  // First, populate explicit dependencies\n  for (const depId of depList) {\n    if (!depId) continue;\n\n    // Try to get the LATEST result from journal for this exact scope\n    try {\n      const snapshotId = context.journal.beginSnapshot();\n      const visible = context.journal.readVisible(\n        context.sessionId,\n        snapshotId,\n        context.event as any\n      );\n      const sameScope = (\n        a: Array<{ check: string; index: number }>,\n        b: Array<{ check: string; index: number }>\n      ): boolean => {\n        if (a.length !== b.length) return false;\n        for (let i = 0; i < a.length; i++)\n          if (a[i].check !== b[i].check || a[i].index !== b[i].index) return false;\n        return true;\n      };\n      const matches = visible.filter(e => e.checkId === depId && sameScope(e.scope as any, scope));\n      let journalResult = (\n        matches.length > 0 ? matches[matches.length - 1].result : undefined\n      ) as any;\n\n      // If we couldn't resolve a scoped result OR we received an aggregated\n      // forEach result, reconstruct a per-item view using forEachItemResults\n      if (\n        journalResult &&\n        Array.isArray(journalResult.forEachItems) &&\n        currentIndex !== undefined\n      ) {\n        const perItemSummary: any = (journalResult.forEachItemResults &&\n          journalResult.forEachItemResults[currentIndex]) || { issues: [] };\n        const perItemOutput = journalResult.forEachItems[currentIndex];\n        const combined = { ...perItemSummary, output: perItemOutput } as ReviewSummary;\n        dependencyResults.set(depId, combined);\n        continue;\n      }\n\n      if (!journalResult) {\n        // Fallback: try raw (aggregate) view and slice out current index if possible\n        try {\n          const rawView = new (require('../../snapshot-store').ContextView)(\n            context.journal,\n            context.sessionId,\n            snapshotId,\n            [],\n            context.event\n          );\n          const rawResult = rawView.get(depId) as any | undefined;\n          if (rawResult && Array.isArray(rawResult.forEachItems) && currentIndex !== undefined) {\n            const perItemSummary: any = (rawResult.forEachItemResults &&\n              rawResult.forEachItemResults[currentIndex]) || { issues: [] };\n            const perItemOutput = rawResult.forEachItems[currentIndex];\n            const combined = { ...perItemSummary, output: perItemOutput } as ReviewSummary;\n            dependencyResults.set(depId, combined);\n            continue;\n          }\n          journalResult = rawResult;\n        } catch {\n          // ignore\n        }\n      }\n\n      if (journalResult) {\n        dependencyResults.set(depId, journalResult as ReviewSummary);\n        continue;\n      }\n    } catch {\n      // Fall through to other sources\n    }\n\n    // Fall back to empty result\n    dependencyResults.set(depId, { issues: [] });\n  }\n\n  // Also populate ALL other executed checks from journal (for global outputs namespace)\n  // This provides access to all outputs via {{ outputs[\"check-name\"] }} in templates\n  try {\n    const snapshotId = context.journal.beginSnapshot();\n    const contextView = new (require('../../snapshot-store').ContextView)(\n      context.journal,\n      context.sessionId,\n      snapshotId,\n      scope,\n      context.event\n    );\n\n    // Get all check names from the config\n    const allCheckNames = Object.keys(context.config.checks || {});\n    for (const checkName of allCheckNames) {\n      // Skip if already in dependencies\n      if (dependencyResults.has(checkName)) continue;\n\n      // Try to get result from journal\n      let jr: any | undefined = contextView.get(checkName);\n\n      // If this is an aggregated forEach result and we have an index in scope,\n      // expose the per-item view to make `outputs[\"name\"]` reflect the current branch item.\n      if (jr && Array.isArray(jr.forEachItems) && currentIndex !== undefined) {\n        const perItemSummary: any = (jr.forEachItemResults &&\n          jr.forEachItemResults[currentIndex]) || { issues: [] };\n        const perItemOutput = jr.forEachItems[currentIndex];\n        const combined = { ...perItemSummary, output: perItemOutput } as ReviewSummary;\n        dependencyResults.set(checkName, combined);\n        continue;\n      }\n\n      if (!jr) {\n        // Fallback to raw aggregate and slice current index if possible\n        try {\n          const rawView = new (require('../../snapshot-store').ContextView)(\n            context.journal,\n            context.sessionId,\n            snapshotId,\n            [],\n            context.event\n          );\n          const raw = rawView.get(checkName) as any | undefined;\n          if (raw && Array.isArray(raw.forEachItems) && currentIndex !== undefined) {\n            const perItemSummary: any = (raw.forEachItemResults &&\n              raw.forEachItemResults[currentIndex]) || { issues: [] };\n            const perItemOutput = raw.forEachItems[currentIndex];\n            const combined = { ...perItemSummary, output: perItemOutput } as ReviewSummary;\n            dependencyResults.set(checkName, combined);\n            continue;\n          }\n          jr = raw;\n        } catch {\n          // ignore\n        }\n      }\n\n      if (jr) {\n        dependencyResults.set(checkName, jr as ReviewSummary);\n      }\n    }\n\n    // Add raw array access for forEach checks\n    // For each check with forEach:true, also provide <checkName>-raw key with the full array\n    for (const checkName of allCheckNames) {\n      const checkCfg = context.config.checks?.[checkName];\n      if (checkCfg?.forEach) {\n        // Get the check result (without scope) to access the full forEachItems array\n        try {\n          const rawContextView = new (require('../../snapshot-store').ContextView)(\n            context.journal,\n            context.sessionId,\n            snapshotId,\n            [], // No scope - get parent-level result with forEachItems\n            context.event\n          );\n          const rawResult = rawContextView.get(checkName);\n          if (rawResult && (rawResult as any).forEachItems) {\n            // Add -raw key with full array\n            const rawKey = `${checkName}-raw`;\n            dependencyResults.set(rawKey, {\n              issues: [],\n              output: (rawResult as any).forEachItems,\n            } as ReviewSummary);\n          }\n        } catch {\n          // Silently skip - raw access is optional\n        }\n      }\n    }\n  } catch {\n    // Silently fail - we'll just have the explicit dependencies\n  }\n\n  return dependencyResults;\n}\n\n/**\n * Build dependency results for a check\n */\nfunction buildDependencyResults(\n  checkId: string,\n  checkConfig: any,\n  context: EngineContext,\n  _state: RunState\n): Map<string, ReviewSummary> {\n  return buildDependencyResultsWithScope(checkId, checkConfig, context, []);\n}\n\n/**\n * Check if fail-fast should be triggered based on results\n */\nfunction shouldFailFast(\n  results: Array<{ checkId: string; result: ReviewSummary; error?: Error }>\n): boolean {\n  // Fail-fast if any check has critical or error severity issues\n  for (const { result } of results) {\n    if (!result || !result.issues) continue;\n\n    if (hasFatalIssues(result)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Check if result has fatal issues (execution failures, not code quality issues)\n *\n * Fatal issues are those indicating the check itself failed to execute properly:\n * - ruleId ends with '/error' (system errors, exceptions)\n * - ruleId contains '/execution_error' (command failures)\n * - ruleId contains 'timeout' (timeouts)\n * - ruleId ends with '_fail_if' (fail_if condition triggered)\n *\n * Regular error/critical severity issues (e.g., security vulnerabilities found in code)\n * are NOT fatal - they represent successful execution that found issues.\n */\nfunction hasFatalIssues(result: ReviewSummary): boolean {\n  if (!result.issues) {\n    return false;\n  }\n\n  // Check for execution failure indicators in ruleId\n  return result.issues.some(issue => {\n    const ruleId = issue.ruleId || '';\n    return (\n      ruleId.endsWith('/error') || // System errors\n      ruleId.includes('/execution_error') || // Command failures\n      ruleId.includes('timeout') || // Timeouts\n      (ruleId.endsWith('_fail_if') && ruleId !== 'global_fail_if') // check-level fail_if only\n    );\n  });\n}\n\n/**\n * Update execution stats\n */\nfunction updateStats(\n  results: Array<{ checkId: string; result: ReviewSummary; error?: Error; duration?: number }>,\n  state: RunState,\n  isForEachIteration: boolean = false\n): void {\n  for (const { checkId, result, error, duration } of results) {\n    const existing = state.stats.get(checkId);\n\n    const stats: CheckExecutionStats = existing || {\n      checkName: checkId,\n      totalRuns: 0,\n      successfulRuns: 0,\n      failedRuns: 0,\n      skippedRuns: 0,\n      skipped: false,\n      totalDuration: 0,\n      issuesFound: 0,\n      issuesBySeverity: {\n        critical: 0,\n        error: 0,\n        warning: 0,\n        info: 0,\n      },\n    };\n\n    // DEBUG: Log when updateStats is called for post-response\n    if (checkId === 'post-response') {\n      logger.info(\n        `[updateStats] Called for post-response: existing.skipped=${existing?.skipped}, stats.skipped=${stats.skipped}, skipReason=${(stats as any).skipReason}`\n      );\n    }\n\n    // If check was previously skipped but is now executing, clear the skipped flag\n    if (stats.skipped) {\n      stats.skipped = false;\n      if (checkId === 'post-response') {\n        logger.info(\n          `[updateStats] Clearing skipped flag for post-response (was skipped, now executing)`\n        );\n      }\n    }\n\n    // Increment totalRuns for all executions including forEach iterations\n    // isForEachIteration=true means this is a single iteration of a forEach child check\n    // We count these as separate executions\n    stats.totalRuns++;\n\n    // Track duration if provided\n    if (duration !== undefined) {\n      stats.totalDuration += duration;\n    }\n\n    // Check if this is an execution failure (not a code quality finding)\n    // Execution failures have specific ruleId patterns that indicate the check itself failed\n    const hasExecutionFailure = result.issues?.some(issue => {\n      const ruleId = issue.ruleId || '';\n      return (\n        ruleId.endsWith('/error') || // System errors, exceptions\n        ruleId.includes('/execution_error') || // Command failures\n        ruleId.includes('timeout') || // Timeouts\n        (ruleId.endsWith('_fail_if') && ruleId !== 'global_fail_if') // check-level fail_if only\n      );\n    });\n\n    if (error) {\n      // Exception during execution\n      stats.failedRuns++;\n      stats.errorMessage = error.message;\n      // Mark check as failed so dependents can be skipped\n      // Note: forEach iteration failures are tracked per-iteration, but the check\n      // is only marked as completely failed if ALL iterations fail (handled in executeCheckWithForEachItems)\n      if (!isForEachIteration) {\n        if (!(state as any).failedChecks) {\n          (state as any).failedChecks = new Set<string>();\n        }\n        (state as any).failedChecks.add(checkId);\n      }\n    } else if (hasExecutionFailure) {\n      // Execution failure (command error, fail_if triggered, etc.)\n      stats.failedRuns++;\n      // Note: We do NOT set stats.errorMessage here because the check already produced\n      // error issues as part of its normal output. Setting errorMessage would cause\n      // convertGroupedResultsToReviewSummary to create a duplicate system/error issue.\n      // errorMessage should only be set for exceptional errors (caught exceptions).\n\n      // Mark check as failed so dependents can be skipped\n      // Note: forEach iteration failures are tracked per-iteration, but the check\n      // is only marked as completely failed if ALL iterations fail (handled in executeCheckWithForEachItems)\n      if (!isForEachIteration) {\n        if (!(state as any).failedChecks) {\n          (state as any).failedChecks = new Set<string>();\n        }\n        (state as any).failedChecks.add(checkId);\n      }\n    } else {\n      stats.successfulRuns++;\n    }\n\n    // Count issues\n    if (result.issues) {\n      stats.issuesFound += result.issues.length;\n\n      for (const issue of result.issues) {\n        if (issue.severity === 'critical') stats.issuesBySeverity.critical++;\n        else if (issue.severity === 'error') stats.issuesBySeverity.error++;\n        else if (issue.severity === 'warning') stats.issuesBySeverity.warning++;\n        else if (issue.severity === 'info') stats.issuesBySeverity.info++;\n      }\n    }\n\n    // Track outputsProduced if result has output\n    // For forEach parent checks, use the length of forEachItems\n    // For regular checks, count is 1\n    if (stats.outputsProduced === undefined) {\n      const forEachItems = (result as any).forEachItems;\n      if (Array.isArray(forEachItems)) {\n        stats.outputsProduced = forEachItems.length;\n      } else if ((result as any).output !== undefined) {\n        stats.outputsProduced = 1;\n      }\n    }\n\n    state.stats.set(checkId, stats);\n  }\n}\n\n/**\n * Render template content for a check\n * Similar to legacy engine's renderCheckContent method\n */\nasync function renderTemplateContent(\n  checkId: string,\n  checkConfig: any,\n  reviewSummary: ReviewSummary\n): Promise<string | undefined> {\n  try {\n    const { createExtendedLiquid } = await import('../../liquid-extensions');\n    const fs = await import('fs/promises');\n    const path = await import('path');\n\n    // Determine template source: explicit template (content/file) or built-in by schema\n    const schemaRaw = checkConfig.schema || 'plain';\n    const schema = typeof schemaRaw === 'string' ? schemaRaw : 'code-review';\n\n    let templateContent: string | undefined;\n\n    if (checkConfig.template && checkConfig.template.content) {\n      templateContent = String(checkConfig.template.content);\n      logger.debug(`[LevelDispatch] Using inline template for ${checkId}`);\n    } else if (checkConfig.template && checkConfig.template.file) {\n      // Securely resolve relative file path\n      const file = String(checkConfig.template.file);\n      const resolved = path.resolve(process.cwd(), file);\n      templateContent = await fs.readFile(resolved, 'utf-8');\n      logger.debug(`[LevelDispatch] Using template file for ${checkId}: ${resolved}`);\n    } else if (schema && schema !== 'plain') {\n      // Built-in schema template fallback\n      const sanitized = String(schema).replace(/[^a-zA-Z0-9-]/g, '');\n      if (sanitized) {\n        // When bundled with ncc, __dirname is dist/ and output/ is at dist/output/\n        // When running from source, __dirname is src/state-machine/states/ and output/ is at output/\n        const candidatePaths = [\n          path.join(__dirname, 'output', sanitized, 'template.liquid'), // bundled: dist/output/\n          path.join(__dirname, '..', '..', 'output', sanitized, 'template.liquid'), // source (from state-machine/states)\n          path.join(__dirname, '..', '..', '..', 'output', sanitized, 'template.liquid'), // source (alternate)\n          path.join(process.cwd(), 'output', sanitized, 'template.liquid'), // fallback: cwd/output/\n          path.join(process.cwd(), 'dist', 'output', sanitized, 'template.liquid'), // fallback: cwd/dist/output/\n        ];\n        for (const p of candidatePaths) {\n          try {\n            templateContent = await fs.readFile(p, 'utf-8');\n            if (templateContent) {\n              logger.debug(`[LevelDispatch] Using schema template for ${checkId}: ${p}`);\n              break;\n            }\n          } catch {\n            // try next\n          }\n        }\n        if (!templateContent) {\n          logger.debug(\n            `[LevelDispatch] No template found for schema '${sanitized}' (tried ${candidatePaths.length} paths)`\n          );\n        }\n      }\n    }\n\n    if (!templateContent) {\n      // No template to render\n      logger.debug(`[LevelDispatch] No template content found for ${checkId}`);\n      return undefined;\n    }\n\n    // Use extended Liquid with our custom filters/tags\n    const liquid = createExtendedLiquid({\n      trimTagLeft: false,\n      trimTagRight: false,\n      trimOutputLeft: false,\n      trimOutputRight: false,\n      greedy: false,\n    });\n\n    // Ensure output is an object, not a JSON string\n    // If output is a string that looks like JSON, parse it\n    let output = (reviewSummary as any).output;\n    if (typeof output === 'string') {\n      const trimmed = output.trim();\n      if (trimmed.startsWith('{') || trimmed.startsWith('[')) {\n        try {\n          output = JSON.parse(trimmed);\n        } catch {\n          // Not valid JSON, keep as string\n        }\n      }\n    }\n\n    const templateData: Record<string, unknown> = {\n      issues: reviewSummary.issues || [],\n      checkName: checkId,\n      output,\n    };\n\n    logger.debug(\n      `[LevelDispatch] Rendering template for ${checkId} with output keys: ${output && typeof output === 'object' ? Object.keys(output).join(', ') : 'none'}`\n    );\n\n    const rendered = await liquid.parseAndRender(templateContent, templateData);\n    logger.debug(\n      `[LevelDispatch] Template rendered successfully for ${checkId}: ${rendered.length} chars, trimmed: ${rendered.trim().length} chars`\n    );\n    return rendered.trim();\n  } catch (error) {\n    const msg = error instanceof Error ? error.message : String(error);\n    logger.error(`[LevelDispatch] Failed to render template for ${checkId}: ${msg}`);\n    return undefined;\n  }\n}\n","/**\n * CheckRunning State Handler\n *\n * Responsibilities:\n * - Execute provider logic for a check\n * - Assemble CheckResult\n * - Transition to Routing state\n *\n * M1: This state is handled inline by LevelDispatch\n * M2: Will be a proper state when we add routing\n */\n\nimport type { EngineContext, RunState, EngineState, EngineEvent } from '../../types/engine';\n\nexport async function handleCheckRunning(\n  _context: EngineContext,\n  _state: RunState,\n  transition: (newState: EngineState) => void,\n  _emitEvent: (event: EngineEvent) => void\n): Promise<void> {\n  // M2: This state is not used yet - LevelDispatch handles execution inline with routing\n  // The routing happens directly in LevelDispatch after check execution\n  transition('WavePlanning');\n}\n","/**\n * Completed State Handler\n *\n * Responsibilities:\n * - Finalize stats\n * - Flush telemetry\n * - Update GitHub CheckRuns\n * - Terminal state\n */\n\nimport type { EngineContext, RunState } from '../../types/engine';\nimport { logger } from '../../logger';\n\nexport async function handleCompleted(context: EngineContext, state: RunState): Promise<void> {\n  if (context.debug) {\n    logger.info('[Completed] Execution complete');\n    logger.info(`[Completed] Total waves: ${state.wave + 1}`);\n    logger.info(`[Completed] Checks completed: ${state.completedChecks.size}`);\n    logger.info(`[Completed] Stats collected: ${state.stats.size}`);\n  }\n\n  // Finalize GitHub checks if configured\n  if (context.gitHubChecks) {\n    // GitHub check finalization happens in the main engine\n    if (context.debug) {\n      logger.info('[Completed] GitHub checks will be finalized by main engine');\n    }\n  }\n\n  // Note: This handler is currently unreachable because the main event loop\n  // in runner.ts exits before executing terminal states. The idle log message\n  // is emitted from runner.ts after the loop exits instead.\n\n  // Flush telemetry\n  // M4: Will add structured event streaming to debug visualizer\n\n  // Terminal state - no transition\n}\n","/**\n * Error State Handler\n *\n * Responsibilities:\n * - Capture fatal errors\n * - Unwind gracefully\n * - Terminal state\n */\n\nimport type { EngineContext, RunState } from '../../types/engine';\nimport { logger } from '../../logger';\n\nexport async function handleError(context: EngineContext, state: RunState): Promise<void> {\n  logger.error('[Error] State machine entered error state');\n\n  // Check if there's an error in the event queue\n  const errorEvent = state.eventQueue.find(e => e.type === 'Shutdown' && e.error);\n  if (errorEvent && errorEvent.type === 'Shutdown' && errorEvent.error) {\n    logger.error(`[Error] Fatal error: ${errorEvent.error.message}`);\n    if (errorEvent.error.stack) {\n      logger.error(`[Error] Stack: ${errorEvent.error.stack}`);\n    }\n  }\n\n  // Log stats for debugging\n  if (context.debug) {\n    logger.info(`[Error] Completed ${state.completedChecks.size} checks before error`);\n    logger.info(`[Error] Active dispatches: ${state.activeDispatches.size}`);\n  }\n\n  // Terminal state - no transition\n}\n","/**\n * State Machine Runner - Core orchestration\n *\n * Implements the main event loop that drives state transitions.\n * Supports OTEL telemetry and debug visualizer event streaming (M4).\n */\n\nimport type {\n  EngineContext,\n  RunState,\n  EngineEvent,\n  EngineState,\n  SerializedError,\n} from '../types/engine';\nimport { generateHumanId } from '../utils/human-id';\nimport type { EventEnvelope } from '../event-bus/types';\nimport { logger } from '../logger';\nimport type { ExecutionResult } from '../types/execution';\nimport { GroupedCheckResults } from '../reviewer';\nimport { withActiveSpan, addEvent as addOtelEvent } from '../telemetry/trace-helpers';\nimport type { DebugVisualizerServer } from '../debug-visualizer/ws-server';\n\n// Import state handlers\nimport { handleInit } from './states/init';\nimport { handlePlanReady } from './states/plan-ready';\nimport { handleWavePlanning } from './states/wave-planning';\nimport { handleLevelDispatch } from './states/level-dispatch';\nimport { handleCheckRunning } from './states/check-running';\nimport { handleCompleted } from './states/completed';\nimport { handleError } from './states/error';\n\n/**\n * Main state machine runner\n */\nexport class StateMachineRunner {\n  private context: EngineContext;\n  private state: RunState;\n  private debugServer?: DebugVisualizerServer;\n  private hasRun = false;\n\n  constructor(context: EngineContext, debugServer?: DebugVisualizerServer) {\n    this.context = context;\n    this.state = this.initializeState();\n    this.debugServer = debugServer;\n  }\n\n  /**\n   * Initialize the run state\n   */\n  private initializeState(): RunState {\n    // Pull defaults from config where available\n    const DEFAULT_MAX_WORKFLOW_DEPTH = 3;\n    const configuredMaxDepth =\n      (this.context && this.context.config && this.context.config.limits\n        ? this.context.config.limits.max_workflow_depth\n        : undefined) ?? DEFAULT_MAX_WORKFLOW_DEPTH;\n    return {\n      currentState: 'Init',\n      wave: 0,\n      levelQueue: [],\n      eventQueue: [],\n      activeDispatches: new Map(),\n      completedChecks: new Set(),\n      flags: {\n        failFastTriggered: false,\n        forwardRunRequested: false,\n        // Maximum nesting depth for nested workflows (configurable)\n        maxWorkflowDepth: configuredMaxDepth,\n        currentWorkflowDepth: 0, // Start at root level\n      },\n      stats: new Map(),\n      historyLog: [],\n      forwardRunGuards: new Set(),\n      currentLevelChecks: new Set(),\n      routingLoopCount: 0,\n      pendingRunScopes: new Map(),\n    };\n  }\n\n  /**\n   * Execute the state machine\n   */\n  async run(): Promise<ExecutionResult> {\n    this.hasRun = true;\n    try {\n      // Emit initial state transition event\n      this.emitEvent({ type: 'StateTransition', from: 'Init', to: 'Init' });\n\n      // Main event loop\n      while (!this.isTerminalState(this.state.currentState)) {\n        const currentState = this.state.currentState;\n\n        if (this.context.debug) {\n          logger.info(`[StateMachine] State: ${currentState}, Wave: ${this.state.wave}`);\n        }\n\n        // Execute current state handler\n        await this.executeState(currentState);\n\n        // Check for errors\n        if (this.state.currentState === 'Error') {\n          break;\n        }\n      }\n\n      // Log idle message for top-level workflows that completed successfully\n      if (\n        this.state.currentState === 'Completed' &&\n        !(this.context as any)._parentContext &&\n        !process.env.VISOR_TEST_MODE\n      ) {\n        logger.info('All workflows finished â€” waiting for events');\n      }\n\n      // Return final results\n      return this.buildExecutionResult();\n    } catch (error) {\n      const errorMsg = error instanceof Error ? error.message : String(error);\n      logger.error(`[StateMachine] Fatal error: ${errorMsg}`);\n      const serializedError: SerializedError = {\n        message: error instanceof Error ? error.message : String(error),\n        stack: error instanceof Error ? error.stack : undefined,\n        name: error instanceof Error ? error.name : undefined,\n      };\n      this.emitEvent({ type: 'Shutdown', error: serializedError });\n      throw error;\n    }\n  }\n\n  /**\n   * Execute a specific state handler\n   * M4: Wraps each state execution in an OTEL span for observability\n   */\n  private async executeState(state: EngineState): Promise<void> {\n    // M4: Wrap state execution in OTEL span\n    const attrs: Record<string, unknown> = {\n      state: state,\n      engine_mode: this.context.mode,\n      wave: this.state.wave,\n      session_id: this.context.sessionId,\n    };\n    const waveKind = (this.state as any)?.flags?.waveKind;\n    if (waveKind) attrs.wave_kind = waveKind;\n    return withActiveSpan(`engine.state.${state.toLowerCase()}`, attrs, async () => {\n      try {\n        switch (state) {\n          case 'Init':\n            await handleInit(this.context, this.state, this.transition.bind(this));\n            break;\n          case 'PlanReady':\n            await handlePlanReady(this.context, this.state, this.transition.bind(this));\n            break;\n          case 'WavePlanning':\n            await handleWavePlanning(this.context, this.state, this.transition.bind(this));\n            break;\n          case 'LevelDispatch':\n            await handleLevelDispatch(\n              this.context,\n              this.state,\n              this.transition.bind(this),\n              this.emitEvent.bind(this)\n            );\n            break;\n          case 'CheckRunning':\n            await handleCheckRunning(\n              this.context,\n              this.state,\n              this.transition.bind(this),\n              this.emitEvent.bind(this)\n            );\n            break;\n          case 'Routing':\n            // Routing is handled inline by CheckRunning for now\n            throw new Error('Routing state should be handled by CheckRunning');\n          case 'Completed':\n            await handleCompleted(this.context, this.state);\n            break;\n          case 'Error':\n            await handleError(this.context, this.state);\n            break;\n          default:\n            throw new Error(`Unknown state: ${state}`);\n        }\n      } catch (error) {\n        const errorMsg = error instanceof Error ? error.message : String(error);\n        logger.error(`[StateMachine] Error in state ${state}: ${errorMsg}`);\n        const serializedError: SerializedError = {\n          message: error instanceof Error ? error.message : String(error),\n          stack: error instanceof Error ? error.stack : undefined,\n          name: error instanceof Error ? error.name : undefined,\n        };\n        this.emitEvent({ type: 'Shutdown', error: serializedError });\n        this.state.currentState = 'Error';\n        throw error; // Re-throw to trigger span error recording\n      }\n    });\n  }\n\n  /**\n   * Transition to a new state\n   * M4: Emits OTEL span for the transition with state metadata\n   */\n  private transition(newState: EngineState): void {\n    const oldState = this.state.currentState;\n    this.state.currentState = newState;\n\n    // Emit state transition event\n    const transitionEvent = { type: 'StateTransition' as const, from: oldState, to: newState };\n    this.emitEvent(transitionEvent);\n\n    // M4: Emit OTEL event for state transition\n    try {\n      addOtelEvent('engine.state_transition', {\n        state_from: oldState,\n        state_to: newState,\n        engine_mode: this.context.mode,\n        wave: this.state.wave,\n        session_id: this.context.sessionId,\n      });\n    } catch (_err) {\n      // Ignore telemetry errors\n    }\n\n    if (this.context.debug) {\n      logger.info(`[StateMachine] Transition: ${oldState} -> ${newState}`);\n    }\n  }\n\n  /**\n   * Emit an engine event\n   * M4: Streams events to debug visualizer for time-travel debugging\n   */\n  private emitEvent(event: EngineEvent): void {\n    this.state.historyLog.push(event);\n\n    // Queue events that require processing by WavePlanning\n    if (event.type === 'ForwardRunRequested' || event.type === 'WaveRetry') {\n      this.state.eventQueue.push(event);\n    }\n\n    // M4: Stream event to debug visualizer for live monitoring\n    if (this.debugServer) {\n      try {\n        this.streamEventToDebugServer(event);\n      } catch (_err) {\n        // Ignore debug server errors\n      }\n    }\n\n    // Optional: publish to event bus if present in context (no-ops otherwise)\n    try {\n      const bus: any = (this.context as any).eventBus;\n      if (bus && typeof bus.emit === 'function') {\n        const envelope: EventEnvelope<EngineEvent> = {\n          id: generateHumanId(),\n          version: 1,\n          timestamp: new Date().toISOString(),\n          runId: this.context.sessionId,\n          workflowId: (this.context as any).workflowId,\n          wave: this.state.wave,\n          payload: event,\n        };\n        void bus.emit(envelope);\n      }\n    } catch {}\n\n    // Call onCheckComplete hook for TUI streaming updates\n    if (event.type === 'CheckCompleted') {\n      try {\n        const hook = this.context.executionContext?.hooks?.onCheckComplete;\n        if (typeof hook === 'function') {\n          const checkConfig = this.context.config?.checks?.[event.checkId];\n          hook({\n            checkId: event.checkId,\n            result: event.result,\n            checkConfig: checkConfig\n              ? {\n                  type: checkConfig.type,\n                  group: (checkConfig as any).group,\n                  criticality: (checkConfig as any).criticality,\n                  schema: checkConfig.schema,\n                }\n              : undefined,\n          });\n        }\n      } catch {}\n    }\n\n    if (this.context.debug && event.type !== 'StateTransition') {\n      logger.debug(`[StateMachine] Event: ${event.type}`);\n    }\n  }\n\n  /**\n   * Stream an engine event to debug visualizer (M4)\n   * Converts EngineEvent to ProcessedSpan format for visualization\n   */\n  private streamEventToDebugServer(event: EngineEvent): void {\n    if (!this.debugServer) return;\n\n    // Convert EngineEvent to a ProcessedSpan-like structure\n    const timestamp = process.hrtime();\n    const span = {\n      traceId: this.context.sessionId,\n      spanId: `${event.type}-${Date.now()}`,\n      name: `engine.event.${event.type.toLowerCase()}`,\n      startTime: timestamp,\n      endTime: timestamp,\n      duration: 0,\n      attributes: {\n        event_type: event.type,\n        engine_mode: this.context.mode,\n        wave: this.state.wave,\n        session_id: this.context.sessionId,\n        ...this.extractEventAttributes(event),\n      },\n      events: [],\n      status: 'ok' as const,\n    };\n\n    this.debugServer.emitSpan(span);\n  }\n\n  /**\n   * Extract type-specific attributes from engine events\n   */\n  private extractEventAttributes(event: EngineEvent): Record<string, any> {\n    switch (event.type) {\n      case 'StateTransition':\n        return { state_from: event.from, state_to: event.to };\n      case 'CheckScheduled':\n      case 'CheckCompleted':\n      case 'CheckErrored':\n        return {\n          check_id: event.checkId,\n          scope: event.scope?.join('.') || '',\n        };\n      case 'ForwardRunRequested':\n        return {\n          target: event.target,\n          goto_event: event.gotoEvent,\n          scope: event.scope?.join('.') || '',\n        };\n      case 'WaveRetry':\n        return { reason: event.reason };\n      case 'Shutdown':\n        return {\n          error: event.error?.message,\n        };\n      default:\n        return {};\n    }\n  }\n\n  /**\n   * Check if a state is terminal\n   */\n  private isTerminalState(state: EngineState): boolean {\n    return state === 'Completed' || state === 'Error';\n  }\n\n  /**\n   * Build the final execution result\n   */\n  private buildExecutionResult(): ExecutionResult {\n    const stats = Array.from(this.state.stats.values());\n    // Surface execution errors first for clearer reporting and to satisfy\n    // tests that read the first entry for error messages.\n    stats.sort((a, b) => (b.errorMessage ? 1 : 0) - (a.errorMessage ? 1 : 0));\n\n    // Build results from completed checks by reading from journal\n    const results: GroupedCheckResults = this.aggregateResultsFromJournal();\n\n    // Aggregate total duration\n    let totalDuration = 0;\n    for (const stat of stats) {\n      totalDuration = Math.max(totalDuration, stat.totalDuration);\n    }\n\n    // Normalize statistics: ensure successfulRuns + failedRuns == totalRuns\n    // The updateStats function in level-dispatch.ts already counts all executions correctly,\n    // including forEach iterations, retries, and goto re-runs. We just need to ensure consistency.\n    try {\n      for (const s of stats) {\n        // Final clamp: ensure successfulRuns + failedRuns == totalRuns\n        // Prefer to preserve failures and adjust successes accordingly.\n        const sumSF = (s.successfulRuns || 0) + (s.failedRuns || 0);\n        if (s.totalRuns !== undefined && sumSF !== s.totalRuns) {\n          if (sumSF > s.totalRuns) {\n            // Too many counted: clamp successes to fill remaining after failures\n            const failures = Math.min(s.failedRuns || 0, s.totalRuns);\n            s.failedRuns = failures;\n            s.successfulRuns = Math.max(0, s.totalRuns - failures);\n          } else {\n            // Not enough counted: assume remaining were successful\n            s.successfulRuns = (s.successfulRuns || 0) + (s.totalRuns - sumSF);\n          }\n        }\n      }\n    } catch {}\n\n    // Debug: log stats breakdown for debugging\n    if (this.context.debug) {\n      logger.info('[StateMachine][Stats] Final statistics breakdown:');\n      for (const s of stats) {\n        logger.info(\n          `  ${s.checkName}: totalRuns=${s.totalRuns}, successful=${s.successfulRuns}, failed=${s.failedRuns}`\n        );\n      }\n      logger.info(\n        `[StateMachine][Stats] Total: ${this.state.stats.size} configured, ${stats.reduce((sum, s) => sum + s.totalRuns, 0)} executions`\n      );\n    }\n\n    return {\n      results,\n      statistics: {\n        totalChecksConfigured: this.state.stats.size,\n        totalExecutions: stats.reduce((sum, s) => sum + s.totalRuns, 0),\n        successfulExecutions: stats.reduce((sum, s) => sum + s.successfulRuns, 0),\n        failedExecutions: stats.reduce((sum, s) => sum + s.failedRuns, 0),\n        skippedChecks: stats.filter(s => s.skipped).length,\n        totalDuration,\n        checks: stats,\n      },\n    };\n  }\n\n  /**\n   * Aggregate results from journal into GroupedCheckResults format\n   * This matches the format returned by the legacy engine\n   */\n  private aggregateResultsFromJournal(): GroupedCheckResults {\n    const groupedResults: GroupedCheckResults = {};\n\n    // Read all journal entries for this session\n    const allEntries = this.context.journal.readVisible(\n      this.context.sessionId,\n      this.context.journal.beginSnapshot(),\n      undefined\n    );\n\n    // Group entries by check ID to handle forEach iterations\n    const checkEntries = new Map<string, typeof allEntries>();\n    for (const entry of allEntries) {\n      const existing = checkEntries.get(entry.checkId) || [];\n      existing.push(entry);\n      checkEntries.set(entry.checkId, existing);\n    }\n\n    // Process each check\n    for (const [checkId, entries] of checkEntries) {\n      const checkConfig = this.context.config.checks?.[checkId];\n\n      // Special handling for system errors (validation, cycles, etc.)\n      if (!checkConfig && checkId === 'system') {\n        const latestEntry = entries[entries.length - 1];\n        if (latestEntry && latestEntry.result.issues) {\n          // Add system issues to a 'system' group\n          if (!groupedResults['system']) {\n            groupedResults['system'] = [];\n          }\n          groupedResults['system'].push({\n            checkName: 'system',\n            content: '',\n            group: 'system',\n            output: undefined,\n            debug: undefined,\n            issues: latestEntry.result.issues,\n          });\n        }\n        continue;\n      }\n\n      if (!checkConfig) continue;\n\n      // Determine group: use explicit group or fall back to check name\n      const group = checkConfig.group || checkId;\n\n      // For forEach checks, we aggregate all iterations\n      // For non-forEach, we take the latest entry\n      let content = '';\n      let output: unknown = undefined;\n      const allIssues: any[] = [];\n      let debug: any = undefined;\n\n      if (checkConfig.forEach && entries.length > 1) {\n        // Aggregate all forEach iterations\n        const contents: string[] = [];\n        for (const entry of entries) {\n          if (entry.result.content) {\n            contents.push(entry.result.content);\n          }\n          if (entry.result.issues) {\n            allIssues.push(...entry.result.issues);\n          }\n          if (entry.result.debug) {\n            debug = entry.result.debug;\n          }\n          // For forEach, output is typically an array from the last iteration\n          if (entry.result.output !== undefined) {\n            output = entry.result.output;\n          }\n        }\n        content = contents.join('\\n');\n      } else {\n        // For non-forEach or single-entry forEach, take the latest entry\n        const latestEntry = entries[entries.length - 1];\n        if (latestEntry) {\n          content = latestEntry.result.content || '';\n          output = latestEntry.result.output;\n          if (latestEntry.result.issues) {\n            allIssues.push(...latestEntry.result.issues);\n          }\n          debug = latestEntry.result.debug;\n        }\n      }\n\n      // Create CheckResult\n      const checkResult: import('../reviewer').CheckResult = {\n        checkName: checkId,\n        content,\n        group,\n        output,\n        debug,\n        issues: allIssues,\n      };\n\n      // Add to appropriate group\n      if (!groupedResults[group]) {\n        groupedResults[group] = [];\n      }\n      groupedResults[group].push(checkResult);\n    }\n\n    // Apply issue suppression if enabled\n    const suppressionEnabled = this.context.config.output?.suppressionEnabled ?? true;\n    if (suppressionEnabled) {\n      const { IssueFilter } = require('../issue-filter');\n      const filter = new IssueFilter(true);\n\n      // Filter issues in each check result\n      for (const group of Object.keys(groupedResults)) {\n        for (const checkResult of groupedResults[group]) {\n          if (checkResult.issues && checkResult.issues.length > 0) {\n            checkResult.issues = filter.filterIssues(\n              checkResult.issues,\n              this.context.workingDirectory\n            );\n          }\n        }\n      }\n    }\n\n    return groupedResults;\n  }\n\n  /**\n   * Get current run state (for debugging/testing)\n   */\n  getState(): RunState {\n    return this.state;\n  }\n\n  /**\n   * Hydrate the runner with a previously serialized state. Must be called\n   * before `run()` (i.e., when the runner has not started yet).\n   */\n  setState(state: RunState): void {\n    if (this.hasRun) {\n      throw new Error('StateMachineRunner.setState: cannot set state after run() has started');\n    }\n    this.state = state;\n  }\n\n  /**\n   * Bubble an event to parent context (nested workflows support)\n   * This allows nested workflows to trigger re-runs in parent workflows\n   */\n  bubbleEventToParent(event: EngineEvent): void {\n    if (this.state.parentContext && this.state.parentContext.mode === 'state-machine') {\n      // Emit event to parent's event queue\n      if (this.context.debug) {\n        logger.info(`[StateMachine] Bubbling event to parent: ${event.type}`);\n      }\n\n      // We need to access the parent runner to bubble events\n      // For now, we'll store events in a queue that can be retrieved\n      // The parent will poll for bubbled events after child execution\n      if (!this.state.parentContext._bubbledEvents) {\n        (this.state.parentContext as any)._bubbledEvents = [];\n      }\n      (this.state.parentContext as any)._bubbledEvents.push(event);\n    }\n  }\n}\n","/**\n * Docker image-based sandbox implementation.\n * Supports three modes: pre-built image, Dockerfile, and inline Dockerfile.\n */\n\nimport { promisify } from 'util';\nimport { execFile as execFileCb } from 'child_process';\nimport { writeFileSync, unlinkSync, mkdtempSync } from 'fs';\nimport { join } from 'path';\nimport { tmpdir } from 'os';\nimport { randomUUID } from 'crypto';\nimport { SandboxConfig, SandboxExecOptions, SandboxExecResult, SandboxInstance } from './types';\nimport { logger } from '../logger';\nimport { withActiveSpan, addEvent } from './sandbox-telemetry';\n\nconst execFileAsync = promisify(execFileCb);\n\nconst EXEC_MAX_BUFFER = 50 * 1024 * 1024; // 50MB\n\nexport class DockerImageSandbox implements SandboxInstance {\n  name: string;\n  config: SandboxConfig;\n  private containerId: string | null = null;\n  private containerName: string;\n  private repoPath: string;\n  private visorDistPath: string;\n  private cacheVolumeMounts: string[];\n\n  constructor(\n    name: string,\n    config: SandboxConfig,\n    repoPath: string,\n    visorDistPath: string,\n    cacheVolumeMounts: string[] = []\n  ) {\n    this.name = name;\n    this.config = config;\n    this.repoPath = repoPath;\n    this.visorDistPath = visorDistPath;\n    this.containerName = `visor-${name}-${randomUUID().slice(0, 8)}`;\n    this.cacheVolumeMounts = cacheVolumeMounts;\n  }\n\n  /**\n   * Build the Docker image if needed (dockerfile or dockerfile_inline mode)\n   */\n  private async buildImageIfNeeded(): Promise<string> {\n    if (this.config.image) {\n      return this.config.image;\n    }\n\n    const imageName = `visor-sandbox-${this.name}`;\n    const buildMode = this.config.dockerfile_inline ? 'inline' : 'dockerfile';\n\n    return withActiveSpan(\n      'visor.sandbox.build',\n      {\n        'visor.sandbox.name': this.name,\n        'visor.sandbox.build.mode': buildMode,\n      },\n      async () => {\n        if (this.config.dockerfile_inline) {\n          // Validate inline Dockerfile has a FROM instruction\n          if (!/^\\s*FROM\\s+/im.test(this.config.dockerfile_inline)) {\n            throw new Error(\n              `Sandbox '${this.name}' has invalid dockerfile_inline: must contain a FROM instruction`\n            );\n          }\n\n          // Write inline Dockerfile to temp file\n          const tmpDir = mkdtempSync(join(tmpdir(), 'visor-build-'));\n          const dockerfilePath = join(tmpDir, 'Dockerfile');\n          writeFileSync(dockerfilePath, this.config.dockerfile_inline, 'utf8');\n\n          try {\n            logger.info(`Building sandbox image '${imageName}' from inline Dockerfile`);\n            await execFileAsync(\n              'docker',\n              ['build', '-t', imageName, '-f', dockerfilePath, this.repoPath],\n              {\n                maxBuffer: EXEC_MAX_BUFFER,\n                timeout: 300000,\n              }\n            );\n          } finally {\n            try {\n              unlinkSync(dockerfilePath);\n            } catch {\n              /* ignore */\n            }\n          }\n\n          return imageName;\n        }\n\n        if (this.config.dockerfile) {\n          logger.info(`Building sandbox image '${imageName}' from ${this.config.dockerfile}`);\n          await execFileAsync(\n            'docker',\n            ['build', '-t', imageName, '-f', this.config.dockerfile, this.repoPath],\n            { maxBuffer: EXEC_MAX_BUFFER, timeout: 300000 }\n          );\n          return imageName;\n        }\n\n        throw new Error(`Sandbox '${this.name}' has no image, dockerfile, or dockerfile_inline`);\n      }\n    );\n  }\n\n  /**\n   * Start the sandbox container\n   */\n  async start(): Promise<void> {\n    const image = await this.buildImageIfNeeded();\n    const workdir = this.config.workdir || '/workspace';\n    const visorPath = this.config.visor_path || '/opt/visor';\n    const readOnlySuffix = this.config.read_only ? ':ro' : '';\n\n    const args: string[] = [\n      'docker',\n      'run',\n      '-d',\n      '--name',\n      this.containerName,\n      '-v',\n      `${this.repoPath}:${workdir}${readOnlySuffix}`,\n      '-v',\n      `${this.visorDistPath}:${visorPath}:ro`,\n      '-w',\n      workdir,\n    ];\n\n    // Network isolation\n    if (this.config.network === false) {\n      args.push('--network', 'none');\n    }\n\n    // Resource limits\n    if (this.config.resources?.memory) {\n      args.push('--memory', this.config.resources.memory);\n    }\n    if (this.config.resources?.cpu) {\n      args.push('--cpus', String(this.config.resources.cpu));\n    }\n\n    // Cache volume mounts\n    for (const mount of this.cacheVolumeMounts) {\n      args.push('-v', mount);\n    }\n\n    // Image and keep-alive command\n    args.push(image, 'sleep', 'infinity');\n\n    logger.info(`Starting sandbox container '${this.containerName}'`);\n\n    const { stdout } = await execFileAsync(args[0], args.slice(1), {\n      maxBuffer: EXEC_MAX_BUFFER,\n      timeout: 60000,\n    });\n    this.containerId = stdout.trim();\n    addEvent('visor.sandbox.container.started', {\n      container_name: this.containerName,\n      image,\n    });\n  }\n\n  /**\n   * Execute a command inside the running container\n   */\n  async exec(options: SandboxExecOptions): Promise<SandboxExecResult> {\n    if (!this.containerId) {\n      throw new Error(`Sandbox '${this.name}' is not started`);\n    }\n\n    const args: string[] = ['docker', 'exec'];\n\n    // Pass environment variables.\n    // Safe: execFile passes each arg as a separate argv entry â€” no shell interpretation.\n    // Docker -e sets the literal value; special chars ($, `, quotes) are not expanded.\n    for (const [key, value] of Object.entries(options.env)) {\n      if (!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(key)) {\n        throw new Error(`Invalid environment variable name: '${key}'`);\n      }\n      args.push('-e', `${key}=${value}`);\n    }\n\n    args.push(this.containerName, 'sh', '-c', options.command);\n\n    try {\n      const { stdout, stderr } = await execFileAsync(args[0], args.slice(1), {\n        maxBuffer: options.maxBuffer || EXEC_MAX_BUFFER,\n        timeout: options.timeoutMs || 600000,\n      });\n      return { stdout, stderr, exitCode: 0 };\n    } catch (err: unknown) {\n      const execErr = err as { stdout?: string; stderr?: string; code?: number };\n      return {\n        stdout: execErr.stdout || '',\n        stderr: execErr.stderr || '',\n        exitCode: typeof execErr.code === 'number' ? execErr.code : 1,\n      };\n    }\n  }\n\n  /**\n   * Stop and remove the container\n   */\n  async stop(): Promise<void> {\n    if (this.containerName) {\n      try {\n        await execFileAsync('docker', ['rm', '-f', this.containerName], {\n          maxBuffer: EXEC_MAX_BUFFER,\n          timeout: 30000,\n        });\n      } catch {\n        // Container may already be stopped\n      }\n      addEvent('visor.sandbox.container.stopped', {\n        container_name: this.containerName,\n      });\n      this.containerId = null;\n    }\n  }\n}\n","/**\n * Docker Compose-based sandbox implementation.\n * Supports multi-service environments (e.g., app + redis + postgres).\n */\n\nimport { promisify } from 'util';\nimport { execFile as execFileCb } from 'child_process';\nimport { randomUUID } from 'crypto';\nimport { SandboxConfig, SandboxExecOptions, SandboxExecResult, SandboxInstance } from './types';\nimport { logger } from '../logger';\n\nconst execFileAsync = promisify(execFileCb);\n\nconst EXEC_MAX_BUFFER = 50 * 1024 * 1024; // 50MB\n\nexport class DockerComposeSandbox implements SandboxInstance {\n  name: string;\n  config: SandboxConfig;\n  private projectName: string;\n  private started = false;\n\n  constructor(name: string, config: SandboxConfig) {\n    this.name = name;\n    this.config = config;\n    this.projectName = `visor-${name}-${randomUUID().slice(0, 8)}`;\n  }\n\n  /**\n   * Start the compose services\n   */\n  async start(): Promise<void> {\n    if (!this.config.compose) {\n      throw new Error(`Sandbox '${this.name}' has no compose file specified`);\n    }\n    if (!this.config.service) {\n      throw new Error(`Sandbox '${this.name}' requires a 'service' field for compose mode`);\n    }\n\n    logger.info(`Starting compose sandbox '${this.name}' (project: ${this.projectName})`);\n\n    await execFileAsync(\n      'docker',\n      ['compose', '-f', this.config.compose!, '-p', this.projectName, 'up', '-d'],\n      {\n        maxBuffer: EXEC_MAX_BUFFER,\n        timeout: 120000,\n      }\n    );\n\n    this.started = true;\n  }\n\n  /**\n   * Execute a command inside the compose service\n   */\n  async exec(options: SandboxExecOptions): Promise<SandboxExecResult> {\n    if (!this.started) {\n      throw new Error(`Compose sandbox '${this.name}' is not started`);\n    }\n\n    const service = this.config.service!;\n    const args: string[] = [\n      'docker',\n      'compose',\n      '-f',\n      this.config.compose!,\n      '-p',\n      this.projectName,\n      'exec',\n      '-T', // non-interactive\n    ];\n\n    // Pass environment variables.\n    // Safe: execFile passes each arg as a separate argv entry â€” no shell interpretation.\n    // Docker -e sets the literal value; special chars ($, `, quotes) are not expanded.\n    for (const [key, value] of Object.entries(options.env)) {\n      if (!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(key)) {\n        throw new Error(`Invalid environment variable name: '${key}'`);\n      }\n      args.push('-e', `${key}=${value}`);\n    }\n\n    // Working directory override\n    if (this.config.workdir) {\n      args.push('-w', this.config.workdir);\n    }\n\n    args.push(service, 'sh', '-c', options.command);\n\n    try {\n      const { stdout, stderr } = await execFileAsync(args[0], args.slice(1), {\n        maxBuffer: options.maxBuffer || EXEC_MAX_BUFFER,\n        timeout: options.timeoutMs || 600000,\n      });\n      return { stdout, stderr, exitCode: 0 };\n    } catch (err: unknown) {\n      const execErr = err as { stdout?: string; stderr?: string; code?: number };\n      return {\n        stdout: execErr.stdout || '',\n        stderr: execErr.stderr || '',\n        exitCode: typeof execErr.code === 'number' ? execErr.code : 1,\n      };\n    }\n  }\n\n  /**\n   * Stop and tear down the compose project\n   */\n  async stop(): Promise<void> {\n    if (this.started && this.config.compose) {\n      try {\n        await execFileAsync(\n          'docker',\n          ['compose', '-f', this.config.compose!, '-p', this.projectName, 'down'],\n          {\n            maxBuffer: EXEC_MAX_BUFFER,\n            timeout: 60000,\n          }\n        );\n      } catch {\n        // May already be stopped\n      }\n      this.started = false;\n    }\n  }\n}\n","/**\n * Docker named volume management for sandbox caching.\n * Creates, resolves, and evicts cache volumes based on sandbox configuration.\n */\n\nimport { promisify } from 'util';\nimport { execFile as execFileCb } from 'child_process';\nimport { createHash } from 'crypto';\nimport { SandboxCacheConfig } from './types';\nimport { logger } from '../logger';\n\nconst execFileAsync = promisify(execFileCb);\nconst EXEC_MAX_BUFFER = 10 * 1024 * 1024;\n\n/**\n * Compute a short hash for a container path to use in volume names\n */\nfunction pathHash(containerPath: string): string {\n  return createHash('sha256').update(containerPath).digest('hex').slice(0, 8);\n}\n\n/**\n * Parse a TTL string (e.g., \"7d\", \"24h\", \"1h30m\") into milliseconds\n */\nfunction parseTtl(ttl: string): number {\n  let ms = 0;\n  const dayMatch = ttl.match(/(\\d+)d/);\n  const hourMatch = ttl.match(/(\\d+)h/);\n  const minMatch = ttl.match(/(\\d+)m/);\n\n  if (dayMatch) ms += parseInt(dayMatch[1], 10) * 86400000;\n  if (hourMatch) ms += parseInt(hourMatch[1], 10) * 3600000;\n  if (minMatch) ms += parseInt(minMatch[1], 10) * 60000;\n\n  return ms || 604800000; // default 7 days\n}\n\nexport interface ResolvedVolume {\n  /** Docker volume name */\n  volumeName: string;\n  /** Mount spec for docker run -v flag: \"volumeName:containerPath\" */\n  mountSpec: string;\n}\n\nexport class CacheVolumeManager {\n  /**\n   * Resolve cache config into Docker volume mount specs.\n   *\n   * Volume naming: visor-cache-<prefix>-<sandboxName>-<pathHash>\n   *\n   * @param sandboxName - Name of the sandbox\n   * @param cacheConfig - Cache configuration from sandbox config\n   * @param gitBranch - Current git branch (used as default prefix)\n   * @returns Array of volume mount specs for docker run -v\n   */\n  async resolveVolumes(\n    sandboxName: string,\n    cacheConfig: SandboxCacheConfig,\n    gitBranch: string\n  ): Promise<ResolvedVolume[]> {\n    const prefix = (cacheConfig.prefix || gitBranch).replace(/[^a-zA-Z0-9._-]/g, '-');\n    const volumes: ResolvedVolume[] = [];\n\n    for (const containerPath of cacheConfig.paths) {\n      // Reject path traversal attempts (absolute-path check is in config validation)\n      if (/\\.\\./.test(containerPath)) {\n        throw new Error(`Cache path '${containerPath}' must not contain '..' path traversal`);\n      }\n      const hash = pathHash(containerPath);\n      const volumeName = `visor-cache-${prefix}-${sandboxName}-${hash}`;\n\n      // Check if volume exists\n      const exists = await this.volumeExists(volumeName);\n\n      if (!exists && cacheConfig.fallback_prefix) {\n        // Try to copy from fallback prefix volume\n        const fallbackPrefix = cacheConfig.fallback_prefix.replace(/[^a-zA-Z0-9._-]/g, '-');\n        const fallbackVolume = `visor-cache-${fallbackPrefix}-${sandboxName}-${hash}`;\n        const fallbackExists = await this.volumeExists(fallbackVolume);\n\n        if (fallbackExists) {\n          logger.info(`Cache miss for '${volumeName}', copying from fallback '${fallbackVolume}'`);\n          await this.copyVolume(fallbackVolume, volumeName);\n        } else {\n          // Create empty volume\n          await this.createVolume(volumeName);\n        }\n      } else if (!exists) {\n        await this.createVolume(volumeName);\n      }\n\n      // Update last-used label\n      await this.touchVolume(volumeName);\n\n      volumes.push({\n        volumeName,\n        mountSpec: `${volumeName}:${containerPath}`,\n      });\n    }\n\n    return volumes;\n  }\n\n  /**\n   * Check if a Docker volume exists\n   */\n  private async volumeExists(name: string): Promise<boolean> {\n    try {\n      await execFileAsync('docker', ['volume', 'inspect', name], {\n        maxBuffer: EXEC_MAX_BUFFER,\n        timeout: 10000,\n      });\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Create a Docker named volume\n   */\n  private async createVolume(name: string): Promise<void> {\n    const now = new Date().toISOString();\n    await execFileAsync('docker', ['volume', 'create', '--label', `visor.last-used=${now}`, name], {\n      maxBuffer: EXEC_MAX_BUFFER,\n      timeout: 10000,\n    });\n  }\n\n  /**\n   * Copy data from one volume to another using a temp container\n   */\n  private async copyVolume(source: string, target: string): Promise<void> {\n    await this.createVolume(target);\n    try {\n      await execFileAsync(\n        'docker',\n        [\n          'run',\n          '--rm',\n          '-v',\n          `${source}:/src:ro`,\n          '-v',\n          `${target}:/dst`,\n          'alpine',\n          'sh',\n          '-c',\n          'cp -a /src/. /dst/',\n        ],\n        { maxBuffer: EXEC_MAX_BUFFER, timeout: 60000 }\n      );\n    } catch (err) {\n      logger.warn(`Failed to copy cache volume ${source} -> ${target}: ${err}`);\n    }\n  }\n\n  /**\n   * Update the last-used label on a volume.\n   * Docker doesn't support updating labels in-place, so we record via a temp file approach\n   * by simply re-creating volumes with updated labels if they don't exist.\n   * For existing volumes, we track usage time via the volume name pattern.\n   */\n  private async touchVolume(_name: string): Promise<void> {\n    // Docker volume labels are immutable after creation.\n    // We track last-used via inspection of volume creation time\n    // and access patterns. This is a no-op for simplicity;\n    // eviction uses volume creation/inspection metadata instead.\n  }\n\n  /**\n   * Evict expired cache volumes for a sandbox\n   */\n  async evictExpired(sandboxName: string, ttl?: string, maxScopes?: number): Promise<void> {\n    const ttlMs = ttl ? parseTtl(ttl) : 604800000; // 7 days default\n    const maxScopesLimit = maxScopes || 10;\n\n    try {\n      // List all visor cache volumes for this sandbox\n      const { stdout } = await execFileAsync(\n        'docker',\n        ['volume', 'ls', '--filter', 'name=visor-cache-', '--format', '{{.Name}}'],\n        { maxBuffer: EXEC_MAX_BUFFER, timeout: 10000 }\n      );\n\n      const allVolumes = stdout.trim().split('\\n').filter(Boolean);\n      const sandboxVolumes = allVolumes.filter(v => v.includes(`-${sandboxName}-`));\n\n      if (sandboxVolumes.length === 0) return;\n\n      // Group by prefix (scope)\n      const scopeMap = new Map<string, string[]>();\n      for (const vol of sandboxVolumes) {\n        // visor-cache-<prefix>-<sandboxName>-<hash>\n        const match = vol.match(/^visor-cache-(.+)-\\w{8}$/);\n        if (match) {\n          const prefix = match[1].replace(`-${sandboxName}`, '');\n          if (!scopeMap.has(prefix)) scopeMap.set(prefix, []);\n          scopeMap.get(prefix)!.push(vol);\n        }\n      }\n\n      // Check each volume's creation time for TTL expiry (parallel inspect)\n      const now = Date.now();\n      const inspectResults = await Promise.allSettled(\n        sandboxVolumes.map(async vol => {\n          const { stdout: inspectOut } = await execFileAsync(\n            'docker',\n            ['volume', 'inspect', vol, '--format', '{{.CreatedAt}}'],\n            { maxBuffer: EXEC_MAX_BUFFER, timeout: 10000 }\n          );\n          return { vol, createdAt: new Date(inspectOut.trim()).getTime() };\n        })\n      );\n\n      for (const result of inspectResults) {\n        if (result.status !== 'fulfilled') continue;\n        const { vol, createdAt } = result.value;\n        if (now - createdAt > ttlMs) {\n          try {\n            logger.info(`Evicting expired cache volume: ${vol}`);\n            await execFileAsync('docker', ['volume', 'rm', vol], {\n              maxBuffer: EXEC_MAX_BUFFER,\n              timeout: 10000,\n            });\n          } catch {\n            // Volume may already be removed\n          }\n        }\n      }\n\n      // Enforce max_scopes by removing oldest scopes\n      if (scopeMap.size > maxScopesLimit) {\n        const scopes = Array.from(scopeMap.keys());\n        // Remove excess scopes (keep newest by alphabetical order as proxy)\n        const toRemove = scopes.slice(0, scopes.length - maxScopesLimit);\n        for (const scope of toRemove) {\n          const vols = scopeMap.get(scope) || [];\n          for (const vol of vols) {\n            try {\n              logger.info(`Evicting cache volume (max_scopes exceeded): ${vol}`);\n              await execFileAsync('docker', ['volume', 'rm', vol], {\n                maxBuffer: EXEC_MAX_BUFFER,\n                timeout: 10000,\n              });\n            } catch {\n              /* ignore */\n            }\n          }\n        }\n      }\n    } catch {\n      // Docker volume listing failed - skip eviction\n    }\n  }\n}\n","/**\n * SandboxManager â€” lifecycle management for Docker sandbox environments.\n * Handles lazy container startup, reuse, exec routing, and cleanup.\n */\n\nimport { resolve, dirname, join } from 'path';\nimport { existsSync } from 'fs';\nimport { SandboxConfig, SandboxInstance, SandboxExecOptions, SandboxExecResult } from './types';\nimport { DockerImageSandbox } from './docker-image-sandbox';\nimport { DockerComposeSandbox } from './docker-compose-sandbox';\nimport { CacheVolumeManager } from './cache-volume-manager';\nimport { logger } from '../logger';\nimport { withActiveSpan, addEvent } from './sandbox-telemetry';\n\nexport class SandboxManager {\n  private sandboxDefs: Record<string, SandboxConfig>;\n  private repoPath: string;\n  private gitBranch: string;\n  private instances: Map<string, SandboxInstance> = new Map();\n  private cacheManager: CacheVolumeManager;\n  private visorDistPath: string;\n\n  /** Get the resolved repository path (used by trace file relay) */\n  getRepoPath(): string {\n    return this.repoPath;\n  }\n\n  constructor(sandboxDefs: Record<string, SandboxConfig>, repoPath: string, gitBranch: string) {\n    this.sandboxDefs = sandboxDefs;\n    this.repoPath = resolve(repoPath);\n    this.gitBranch = gitBranch;\n    this.cacheManager = new CacheVolumeManager();\n\n    // Visor dist path: the directory containing index.js (the ncc bundle)\n    // ncc bundle: __dirname = <project>/dist (index.js is here)\n    // unbundled:  __dirname = <project>/dist/sandbox â†’ parent has index.js\n    this.visorDistPath = existsSync(join(__dirname, 'index.js'))\n      ? __dirname\n      : resolve(dirname(__dirname));\n  }\n\n  /**\n   * Resolve which sandbox a check should use.\n   * Returns null if the check should run on the host.\n   *\n   * Resolution order:\n   * 1. Check-level sandbox: (explicit override)\n   * 2. Workspace-level sandbox: (default)\n   * 3. null â†’ run on host\n   */\n  resolveSandbox(\n    checkSandbox: string | undefined,\n    workspaceDefault: string | undefined\n  ): string | null {\n    const name = checkSandbox || workspaceDefault;\n    if (!name) return null;\n\n    if (!this.sandboxDefs[name]) {\n      throw new Error(`Sandbox '${name}' is not defined in sandboxes configuration`);\n    }\n\n    return name;\n  }\n\n  /**\n   * Get or lazily start a sandbox instance by name.\n   */\n  async getOrStart(name: string): Promise<SandboxInstance> {\n    const existing = this.instances.get(name);\n    if (existing) return existing;\n\n    const config = this.sandboxDefs[name];\n    if (!config) {\n      throw new Error(`Sandbox '${name}' is not defined`);\n    }\n\n    const mode = config.compose ? 'compose' : 'image';\n\n    return withActiveSpan(\n      'visor.sandbox.start',\n      {\n        'visor.sandbox.name': name,\n        'visor.sandbox.mode': mode,\n      },\n      async () => {\n        let instance: SandboxInstance;\n\n        if (config.compose) {\n          // Compose mode\n          const composeSandbox = new DockerComposeSandbox(name, config);\n          await composeSandbox.start();\n          instance = composeSandbox;\n        } else {\n          // Image / Dockerfile mode\n          // Resolve cache volumes\n          let cacheVolumeMounts: string[] = [];\n          if (config.cache) {\n            const volumes = await this.cacheManager.resolveVolumes(\n              name,\n              config.cache,\n              this.gitBranch\n            );\n            cacheVolumeMounts = volumes.map(v => v.mountSpec);\n          }\n\n          const imageSandbox = new DockerImageSandbox(\n            name,\n            config,\n            this.repoPath,\n            this.visorDistPath,\n            cacheVolumeMounts\n          );\n          await imageSandbox.start();\n          instance = imageSandbox;\n        }\n\n        this.instances.set(name, instance);\n        return instance;\n      }\n    );\n  }\n\n  /**\n   * Execute a command inside a named sandbox\n   */\n  async exec(name: string, options: SandboxExecOptions): Promise<SandboxExecResult> {\n    const instance = await this.getOrStart(name);\n    return withActiveSpan(\n      'visor.sandbox.exec',\n      {\n        'visor.sandbox.name': name,\n      },\n      async (span: any) => {\n        const result = await instance.exec(options);\n        try {\n          span.setAttribute('visor.sandbox.exit_code', result.exitCode);\n        } catch {}\n        return result;\n      }\n    );\n  }\n\n  /**\n   * Stop all running sandbox instances and run cache eviction\n   */\n  async stopAll(): Promise<void> {\n    return withActiveSpan('visor.sandbox.stopAll', undefined, async () => {\n      const stopPromises = Array.from(this.instances.entries()).map(async ([name, instance]) => {\n        try {\n          await instance.stop();\n          addEvent('visor.sandbox.stopped', { 'visor.sandbox.name': name });\n          logger.info(`Stopped sandbox '${name}'`);\n        } catch (err) {\n          logger.warn(`Failed to stop sandbox '${name}': ${err}`);\n        }\n\n        // Run cache eviction\n        const config = this.sandboxDefs[name];\n        if (config?.cache) {\n          try {\n            await this.cacheManager.evictExpired(name, config.cache.ttl, config.cache.max_scopes);\n          } catch {\n            // Non-fatal\n          }\n        }\n      });\n\n      await Promise.allSettled(stopPromises);\n      this.instances.clear();\n    });\n  }\n}\n","/**\n * Workspace Manager\n *\n * Provides full isolation between parallel visor runs with human-readable project names.\n * Each run gets its own workspace in /tmp containing worktrees for all projects.\n */\n\nimport * as fsp from 'fs/promises';\nimport * as path from 'path';\nimport { commandExecutor } from './command-executor';\nimport { logger } from '../logger';\n\n/**\n * Escape a string for safe use in shell commands.\n * Uses single quotes and escapes any embedded single quotes.\n */\nfunction shellEscape(str: string): string {\n  // Replace single quotes with '\\'' (end quote, escaped quote, start quote)\n  // Then wrap the whole thing in single quotes\n  return \"'\" + str.replace(/'/g, \"'\\\\''\") + \"'\";\n}\n\n/**\n * Sanitize a path component to prevent path traversal attacks.\n * Removes directory separators and parent directory references.\n */\nfunction sanitizePathComponent(name: string): string {\n  return (\n    name\n      .replace(/\\.\\./g, '') // Remove parent directory references\n      .replace(/[\\/\\\\]/g, '-') // Replace path separators with dashes\n      .replace(/^\\.+/, '') // Remove leading dots\n      .trim() || 'unnamed'\n  ); // Ensure non-empty result\n}\n\nexport interface WorkspaceConfig {\n  enabled: boolean;\n  basePath: string;\n  cleanupOnExit: boolean;\n  name?: string;\n  mainProjectName?: string;\n}\n\nexport interface WorkspaceInfo {\n  sessionId: string;\n  workspacePath: string;\n  mainProjectPath: string;\n  mainProjectName: string;\n  originalPath: string;\n}\n\nexport interface ProjectInfo {\n  name: string;\n  path: string;\n  worktreePath: string;\n  repository: string;\n}\n\n/**\n * WorkspaceManager creates isolated workspaces for parallel visor runs.\n * Each run gets a unique workspace directory containing worktrees for all projects.\n */\nexport class WorkspaceManager {\n  private static instances: Map<string, WorkspaceManager> = new Map();\n\n  private sessionId: string;\n  private basePath: string;\n  private workspacePath: string;\n  private originalPath: string;\n  private config: WorkspaceConfig;\n  private initialized: boolean = false;\n  private mainProjectInfo: WorkspaceInfo | null = null;\n  private projects: Map<string, ProjectInfo> = new Map();\n  private cleanupHandlersRegistered: boolean = false;\n  private usedNames: Set<string> = new Set();\n\n  // Reference counting to prevent premature cleanup\n  private activeOperations: number = 0;\n  private cleanupRequested: boolean = false;\n  private cleanupResolvers: Array<() => void> = [];\n\n  private constructor(sessionId: string, originalPath: string, config?: Partial<WorkspaceConfig>) {\n    this.sessionId = sessionId;\n    this.originalPath = originalPath;\n\n    const configuredName = config?.name || process.env.VISOR_WORKSPACE_NAME;\n    const configuredMainProjectName =\n      config?.mainProjectName || process.env.VISOR_WORKSPACE_PROJECT;\n\n    // Default configuration\n    this.config = {\n      enabled: true,\n      basePath: process.env.VISOR_WORKSPACE_PATH || '/tmp/visor-workspaces',\n      cleanupOnExit: true,\n      name: configuredName,\n      mainProjectName: configuredMainProjectName,\n      ...config,\n    };\n\n    this.basePath = this.config.basePath;\n    const workspaceDirName = sanitizePathComponent(this.config.name || this.sessionId);\n    this.workspacePath = path.join(this.basePath, workspaceDirName);\n  }\n\n  /**\n   * Get or create a WorkspaceManager instance for a session\n   */\n  static getInstance(\n    sessionId: string,\n    originalPath: string,\n    config?: Partial<WorkspaceConfig>\n  ): WorkspaceManager {\n    if (!WorkspaceManager.instances.has(sessionId)) {\n      WorkspaceManager.instances.set(\n        sessionId,\n        new WorkspaceManager(sessionId, originalPath, config)\n      );\n    }\n    return WorkspaceManager.instances.get(sessionId)!;\n  }\n\n  /**\n   * Clear all instances (for testing)\n   */\n  static clearInstances(): void {\n    WorkspaceManager.instances.clear();\n  }\n\n  /**\n   * Check if workspace isolation is enabled\n   */\n  isEnabled(): boolean {\n    return this.config.enabled;\n  }\n\n  /**\n   * Acquire a reference to the workspace (prevents cleanup while held)\n   * Call release() when done with the operation.\n   */\n  acquire(): void {\n    this.activeOperations++;\n    logger.debug(\n      `[Workspace] Acquired reference (active: ${this.activeOperations}) for ${this.workspacePath}`\n    );\n  }\n\n  /**\n   * Release a reference to the workspace.\n   * If cleanup was requested and this was the last reference, cleanup will proceed.\n   */\n  release(): void {\n    this.activeOperations = Math.max(0, this.activeOperations - 1);\n    logger.debug(\n      `[Workspace] Released reference (active: ${this.activeOperations}) for ${this.workspacePath}`\n    );\n\n    // If cleanup was requested and no more active operations, proceed with cleanup\n    if (this.cleanupRequested && this.activeOperations === 0) {\n      logger.debug(`[Workspace] All references released, proceeding with deferred cleanup`);\n      // Resolve all waiting cleanup promises\n      for (const resolve of this.cleanupResolvers) {\n        resolve();\n      }\n      this.cleanupResolvers = [];\n    }\n  }\n\n  /**\n   * Get the number of active operations\n   */\n  getActiveOperations(): number {\n    return this.activeOperations;\n  }\n\n  /**\n   * Get the workspace path\n   */\n  getWorkspacePath(): string {\n    return this.workspacePath;\n  }\n\n  /**\n   * Get the original working directory\n   */\n  getOriginalPath(): string {\n    return this.originalPath;\n  }\n\n  /**\n   * Get workspace info (only available after initialize)\n   */\n  getWorkspaceInfo(): WorkspaceInfo | null {\n    return this.mainProjectInfo;\n  }\n\n  /**\n   * Initialize the workspace - creates workspace directory and main project worktree\n   */\n  async initialize(): Promise<WorkspaceInfo> {\n    if (!this.config.enabled) {\n      throw new Error('Workspace isolation is not enabled');\n    }\n\n    if (this.initialized && this.mainProjectInfo) {\n      return this.mainProjectInfo;\n    }\n\n    logger.info(`Initializing workspace: ${this.workspacePath}`);\n\n    // Create workspace directory (mkdir with recursive handles existing dirs)\n    await fsp.mkdir(this.workspacePath, { recursive: true });\n    logger.debug(`Created workspace directory: ${this.workspacePath}`);\n\n    // Extract main project name from original path (sanitize for defense in depth)\n    const configuredMainProjectName = this.config.mainProjectName;\n    const mainProjectName = sanitizePathComponent(\n      configuredMainProjectName || this.extractProjectName(this.originalPath)\n    );\n    this.usedNames.add(mainProjectName);\n\n    // Create worktree for main project\n    const mainProjectPath = path.join(this.workspacePath, mainProjectName);\n\n    // Check if original path is a git repository\n    const isGitRepo = await this.isGitRepository(this.originalPath);\n\n    if (isGitRepo) {\n      // Create worktree for main project\n      await this.createMainProjectWorktree(mainProjectPath);\n    } else {\n      // If not a git repo, create a symlink instead\n      logger.debug(`Original path is not a git repo, creating symlink`);\n      try {\n        await fsp.symlink(this.originalPath, mainProjectPath);\n      } catch (error) {\n        throw new Error(`Failed to create symlink for main project: ${error}`);\n      }\n    }\n\n    // Register cleanup handlers\n    this.registerCleanupHandlers();\n\n    this.mainProjectInfo = {\n      sessionId: this.sessionId,\n      workspacePath: this.workspacePath,\n      mainProjectPath,\n      mainProjectName,\n      originalPath: this.originalPath,\n    };\n\n    this.initialized = true;\n    logger.info(`Workspace initialized: ${this.workspacePath}`);\n\n    return this.mainProjectInfo;\n  }\n\n  /**\n   * Add a project to the workspace (creates symlink to worktree)\n   * If the same repository + worktreePath combination already exists, returns the existing path.\n   */\n  async addProject(\n    repository: string,\n    worktreePath: string,\n    description?: string\n  ): Promise<string> {\n    if (!this.initialized) {\n      throw new Error('Workspace not initialized. Call initialize() first.');\n    }\n\n    // Check if this exact project (same repo + worktree path) is already added\n    // This prevents duplicate checkouts when tyk-code-talk is called multiple times\n    for (const [existingName, existingProject] of this.projects.entries()) {\n      if (\n        existingProject.repository === repository &&\n        existingProject.worktreePath === worktreePath\n      ) {\n        logger.debug(`Reusing existing project: ${existingName} (${repository})`);\n        return existingProject.path;\n      }\n    }\n\n    // Extract project name and sanitize to prevent path traversal\n    let projectName = sanitizePathComponent(description || this.extractRepoName(repository));\n\n    // Handle duplicate names (only if not reusing existing)\n    projectName = this.getUniqueName(projectName);\n    this.usedNames.add(projectName);\n\n    // Create symlink in workspace\n    const workspacePath = path.join(this.workspacePath, projectName);\n\n    // Remove existing symlink/directory if present (rm with force handles non-existent)\n    await fsp.rm(workspacePath, { recursive: true, force: true });\n\n    try {\n      await fsp.symlink(worktreePath, workspacePath);\n    } catch (error) {\n      throw new Error(`Failed to create symlink for project ${projectName}: ${error}`);\n    }\n\n    // Track project\n    this.projects.set(projectName, {\n      name: projectName,\n      path: workspacePath,\n      worktreePath,\n      repository,\n    });\n\n    logger.info(`Added project to workspace: ${projectName} -> ${worktreePath}`);\n\n    return workspacePath;\n  }\n\n  /**\n   * List all projects in the workspace\n   */\n  listProjects(): ProjectInfo[] {\n    return Array.from(this.projects.values());\n  }\n\n  /**\n   * Cleanup the workspace.\n   * If there are active operations, waits for them to complete before cleaning up.\n   * @param timeout Maximum time to wait for active operations (default: 60s)\n   */\n  async cleanup(timeout: number = 60000): Promise<void> {\n    logger.info(\n      `Cleaning up workspace: ${this.workspacePath} (active operations: ${this.activeOperations})`\n    );\n\n    // If there are active operations, wait for them to complete\n    if (this.activeOperations > 0) {\n      logger.info(\n        `[Workspace] Waiting for ${this.activeOperations} active operations to complete before cleanup`\n      );\n      this.cleanupRequested = true;\n\n      // Wait for all operations to complete (with timeout)\n      await Promise.race([\n        new Promise<void>(resolve => {\n          if (this.activeOperations === 0) {\n            resolve();\n          } else {\n            this.cleanupResolvers.push(resolve);\n          }\n        }),\n        new Promise<void>(resolve => {\n          setTimeout(() => {\n            logger.warn(\n              `[Workspace] Cleanup timeout after ${timeout}ms, proceeding anyway (${this.activeOperations} operations still active)`\n            );\n            resolve();\n          }, timeout);\n        }),\n      ]);\n    }\n\n    try {\n      // Remove main project worktree if it exists\n      if (this.mainProjectInfo) {\n        const mainProjectPath = this.mainProjectInfo.mainProjectPath;\n\n        // Check if path exists and if it's a worktree (not a symlink)\n        try {\n          const stats = await fsp.lstat(mainProjectPath);\n          if (!stats.isSymbolicLink()) {\n            await this.removeMainProjectWorktree(mainProjectPath);\n          }\n        } catch {\n          // Path doesn't exist, nothing to clean up\n        }\n      }\n\n      // Remove workspace directory\n      await fsp.rm(this.workspacePath, { recursive: true, force: true });\n      logger.debug(`Removed workspace directory: ${this.workspacePath}`);\n\n      // Remove from instances\n      WorkspaceManager.instances.delete(this.sessionId);\n\n      this.initialized = false;\n      this.mainProjectInfo = null;\n      this.projects.clear();\n      this.usedNames.clear();\n      this.cleanupRequested = false;\n      this.cleanupResolvers = [];\n\n      logger.info(`Workspace cleanup completed: ${this.sessionId}`);\n    } catch (error) {\n      logger.warn(`Failed to cleanup workspace: ${error}`);\n    }\n  }\n\n  /**\n   * Create worktree for the main project\n   *\n   * visor-disable: architecture - Not using WorktreeManager here because:\n   * 1. WorktreeManager expects remote URLs and clones to bare repos first\n   * 2. This operates on the LOCAL repo we're already in (no cloning needed)\n   * 3. Adding a \"local mode\" to WorktreeManager would add complexity for minimal benefit\n   * The git commands here are simpler (just rev-parse + worktree add) vs WorktreeManager's\n   * full clone/bare-repo/fetch/worktree pipeline.\n   */\n  private async createMainProjectWorktree(targetPath: string): Promise<void> {\n    logger.debug(`Creating main project worktree: ${targetPath}`);\n\n    // Get current HEAD\n    const headResult = await commandExecutor.execute(\n      `git -C ${shellEscape(this.originalPath)} rev-parse HEAD`,\n      {\n        timeout: 10000,\n      }\n    );\n\n    if (headResult.exitCode !== 0) {\n      throw new Error(`Failed to get HEAD: ${headResult.stderr}`);\n    }\n\n    const headRef = headResult.stdout.trim();\n\n    // Create worktree using detached HEAD to avoid branch conflicts\n    const createCmd = `git -C ${shellEscape(this.originalPath)} worktree add --detach ${shellEscape(targetPath)} ${shellEscape(headRef)}`;\n    const result = await commandExecutor.execute(createCmd, { timeout: 60000 });\n\n    if (result.exitCode !== 0) {\n      throw new Error(`Failed to create main project worktree: ${result.stderr}`);\n    }\n\n    logger.debug(`Created main project worktree at ${targetPath}`);\n  }\n\n  /**\n   * Remove main project worktree\n   */\n  private async removeMainProjectWorktree(worktreePath: string): Promise<void> {\n    logger.debug(`Removing main project worktree: ${worktreePath}`);\n\n    const removeCmd = `git -C ${shellEscape(this.originalPath)} worktree remove ${shellEscape(worktreePath)} --force`;\n    const result = await commandExecutor.execute(removeCmd, { timeout: 30000 });\n\n    if (result.exitCode !== 0) {\n      logger.warn(`Failed to remove worktree via git: ${result.stderr}`);\n      // Directory will be removed with the workspace anyway\n    }\n  }\n\n  /**\n   * Check if a path is a git repository\n   */\n  private async isGitRepository(dirPath: string): Promise<boolean> {\n    try {\n      const result = await commandExecutor.execute(\n        `git -C ${shellEscape(dirPath)} rev-parse --git-dir`,\n        {\n          timeout: 5000,\n        }\n      );\n      return result.exitCode === 0;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Extract project name from path\n   */\n  private extractProjectName(dirPath: string): string {\n    return path.basename(dirPath);\n  }\n\n  /**\n   * Extract repository name from owner/repo format\n   */\n  private extractRepoName(repository: string): string {\n    // Handle URLs\n    if (repository.includes('://') || repository.startsWith('git@')) {\n      // Extract from URL\n      const match = repository.match(/[/:]([^/:]+\\/[^/:]+?)(?:\\.git)?$/);\n      if (match) {\n        return match[1].split('/').pop() || repository;\n      }\n    }\n\n    // Handle owner/repo format\n    if (repository.includes('/')) {\n      return repository.split('/').pop() || repository;\n    }\n\n    return repository;\n  }\n\n  /**\n   * Get a unique name by appending a number if needed\n   */\n  private getUniqueName(baseName: string): string {\n    if (!this.usedNames.has(baseName)) {\n      return baseName;\n    }\n\n    let counter = 2;\n    let uniqueName = `${baseName}-${counter}`;\n    while (this.usedNames.has(uniqueName)) {\n      counter++;\n      uniqueName = `${baseName}-${counter}`;\n    }\n\n    return uniqueName;\n  }\n\n  /**\n   * Register cleanup handlers for process exit\n   */\n  private registerCleanupHandlers(): void {\n    if (this.cleanupHandlersRegistered || !this.config.cleanupOnExit) {\n      return;\n    }\n\n    // Note: We don't register on 'exit' as it must be synchronous\n    // SIGINT and SIGTERM handlers are already registered by WorktreeManager\n    // We rely on explicit cleanup call or process handlers from the engine\n\n    this.cleanupHandlersRegistered = true;\n  }\n}\n","import type { VisorConfig, EventTrigger } from '../../types/config';\nimport type { PRInfo } from '../../pr-analyzer';\nimport type { EngineContext, CheckMetadata } from '../../types/engine';\nimport { ExecutionJournal } from '../../snapshot-store';\nimport { MemoryStore } from '../../memory-store';\nimport { generateHumanId } from '../../utils/human-id';\nimport { logger } from '../../logger';\nimport type { VisorConfig as VCfg, CheckConfig as CfgCheck } from '../../types/config';\nimport { WorkspaceManager } from '../../utils/workspace-manager';\n\n// Lazy-resolve DelegationManager from @probelabs/probe.\n// The class may not be exported in older published versions, so we\n// fall back gracefully to avoid breaking the build.\nlet _DelegationManager: (new (opts?: any) => any) | null = null;\ntry {\n  // eslint-disable-next-line @typescript-eslint/no-var-requires\n  const probe = require('@probelabs/probe');\n  if (probe && typeof probe.DelegationManager === 'function') {\n    _DelegationManager = probe.DelegationManager;\n  }\n} catch {\n  // Not available â€” max_ai_concurrency will be silently ignored\n}\n\n/**\n * Apply minimal criticality defaults in-place.\n * This is a no-behavior-change scaffold: we only default missing\n * check.criticality to 'policy' so downstream code can rely on a value.\n * Future mapping (retries/loop budgets) can build on this without\n * changing existing behavior.\n */\nfunction applyCriticalityDefaults(cfg: VCfg): void {\n  const checks = cfg.checks || {};\n  for (const id of Object.keys(checks)) {\n    const c: CfgCheck = (checks as any)[id] as CfgCheck;\n    if (!c.criticality) (c.criticality as any) = 'policy';\n    // For 'info' checks, default continue_on_failure to true if unset.\n    if (c.criticality === 'info' && typeof c.continue_on_failure === 'undefined')\n      c.continue_on_failure = true;\n  }\n}\n\n/**\n * Pure helper to build an EngineContext for a state-machine run.\n * Extracted to reduce StateMachineExecutionEngine size; behavior unchanged.\n */\nexport function buildEngineContextForRun(\n  workingDirectory: string,\n  config: VisorConfig,\n  prInfo: PRInfo,\n  debug?: boolean,\n  maxParallelism?: number,\n  failFast?: boolean,\n  requestedChecks?: string[]\n): EngineContext {\n  // Deep clone provided config to avoid cross-run mutations between tests/runs\n  const clonedConfig: VisorConfig = JSON.parse(JSON.stringify(config));\n\n  // Build check metadata\n  const checks: Record<string, CheckMetadata> = {};\n\n  // Fill in minimal defaults derived from criticality (no behavior change)\n  applyCriticalityDefaults(clonedConfig);\n\n  // If config has checks, use them\n  for (const [checkId, checkConfig] of Object.entries(clonedConfig.checks || {})) {\n    checks[checkId] = {\n      tags: checkConfig.tags || [],\n      triggers: (Array.isArray(checkConfig.on) ? checkConfig.on : [checkConfig.on]).filter(\n        Boolean\n      ) as EventTrigger[],\n      group: checkConfig.group,\n      providerType: checkConfig.type || 'ai',\n      // Normalize depends_on to array (supports string | string[])\n      dependencies: Array.isArray(checkConfig.depends_on)\n        ? checkConfig.depends_on\n        : checkConfig.depends_on\n          ? [checkConfig.depends_on]\n          : [],\n    };\n  }\n\n  // Backward compatibility: synthesize minimal check configs for requested checks\n  // that don't exist in the config (e.g., legacy test mode with empty config)\n  if (requestedChecks && requestedChecks.length > 0) {\n    for (const checkName of requestedChecks) {\n      if (!checks[checkName] && !clonedConfig.checks?.[checkName]) {\n        // Synthesize a minimal check config for this legacy check name\n        logger.debug(`[StateMachine] Synthesizing minimal config for legacy check: ${checkName}`);\n\n        // Add to config.checks so providers can find it\n        if (!clonedConfig.checks) {\n          clonedConfig.checks = {};\n        }\n        clonedConfig.checks[checkName] = {\n          type: 'ai',\n          prompt: `Perform ${checkName} analysis`,\n        } as any;\n\n        // Add metadata\n        checks[checkName] = {\n          tags: [],\n          triggers: [],\n          group: 'default',\n          providerType: 'ai',\n          dependencies: [],\n        };\n      }\n    }\n  }\n\n  // Initialize journal and memory\n  const journal = new ExecutionJournal();\n  const memory = MemoryStore.getInstance(clonedConfig.memory);\n\n  // Create shared AI concurrency limiter if configured\n  let sharedConcurrencyLimiter: any = undefined;\n  if (clonedConfig.max_ai_concurrency && _DelegationManager) {\n    sharedConcurrencyLimiter = new _DelegationManager({\n      maxConcurrent: clonedConfig.max_ai_concurrency,\n      maxPerSession: 999, // No per-session limit needed for global AI gating\n    });\n    logger.debug(\n      `[EngineContext] Created shared AI concurrency limiter (max: ${clonedConfig.max_ai_concurrency})`\n    );\n  }\n\n  return {\n    mode: 'state-machine',\n    config: clonedConfig,\n    checks,\n    journal,\n    memory,\n    workingDirectory,\n    originalWorkingDirectory: workingDirectory,\n    sessionId: generateHumanId(),\n    event: prInfo.eventType,\n    debug,\n    maxParallelism,\n    sharedConcurrencyLimiter,\n    failFast,\n    requestedChecks: requestedChecks && requestedChecks.length > 0 ? requestedChecks : undefined,\n    // Store prInfo for later access (e.g., in getOutputHistorySnapshot)\n    prInfo,\n  };\n}\n\n/**\n * Initialize workspace isolation for an engine context.\n * Creates an isolated workspace with the main project worktree.\n *\n * @param context - Engine context to update with workspace\n * @returns Updated context (same object, mutated)\n */\nexport async function initializeWorkspace(context: EngineContext): Promise<EngineContext> {\n  // Check if workspace isolation is enabled via config or env\n  const workspaceConfig = (context.config as any).workspace;\n  const isEnabled =\n    workspaceConfig?.enabled !== false && process.env.VISOR_WORKSPACE_ENABLED !== 'false';\n\n  if (!isEnabled) {\n    logger.debug('[Workspace] Workspace isolation is disabled');\n    return context;\n  }\n\n  const originalPath = context.workingDirectory || process.cwd();\n\n  try {\n    // Check if workspace should be kept (for debugging)\n    const keepWorkspace = process.env.VISOR_KEEP_WORKSPACE === 'true';\n\n    // Create workspace manager\n    const workspace = WorkspaceManager.getInstance(context.sessionId, originalPath, {\n      enabled: true,\n      basePath:\n        workspaceConfig?.base_path || process.env.VISOR_WORKSPACE_PATH || '/tmp/visor-workspaces',\n      cleanupOnExit: keepWorkspace ? false : workspaceConfig?.cleanup_on_exit !== false,\n      name: workspaceConfig?.name || process.env.VISOR_WORKSPACE_NAME,\n      mainProjectName: workspaceConfig?.main_project_name || process.env.VISOR_WORKSPACE_PROJECT,\n    });\n\n    // Initialize workspace (creates main project worktree)\n    const info = await workspace.initialize();\n\n    // Update context with workspace info\n    context.workspace = workspace;\n    context.workingDirectory = info.mainProjectPath;\n    context.originalWorkingDirectory = originalPath;\n\n    // Export workspace paths for templates/commands\n    try {\n      process.env.VISOR_WORKSPACE_ROOT = info.workspacePath;\n      process.env.VISOR_WORKSPACE_MAIN_PROJECT = info.mainProjectPath;\n      process.env.VISOR_WORKSPACE_MAIN_PROJECT_NAME = info.mainProjectName;\n      process.env.VISOR_ORIGINAL_WORKDIR = originalPath;\n    } catch {}\n\n    logger.info(`[Workspace] Initialized workspace: ${info.workspacePath}`);\n    logger.debug(`[Workspace] Main project at: ${info.mainProjectPath}`);\n    if (keepWorkspace) {\n      logger.info(`[Workspace] Keeping workspace after execution (--keep-workspace)`);\n    }\n\n    return context;\n  } catch (error) {\n    // Log warning but continue without workspace isolation\n    logger.warn(`[Workspace] Failed to initialize workspace: ${error}`);\n    logger.debug('[Workspace] Continuing without workspace isolation');\n    return context;\n  }\n}\n","import type { ReviewIssue, GroupedCheckResults, ReviewSummary } from '../../reviewer';\nimport type { ExecutionStatistics } from '../../types/execution';\n\n/**\n * Pure helper to convert grouped results + statistics into a flat ReviewSummary.\n * Extracted to reduce StateMachineExecutionEngine size; behavior unchanged.\n */\nexport function convertToReviewSummary(\n  groupedResults: GroupedCheckResults,\n  statistics?: ExecutionStatistics\n): ReviewSummary {\n  const allIssues: ReviewIssue[] = [];\n\n  // Aggregate issues from all check results\n  for (const checkResults of Object.values(groupedResults)) {\n    for (const checkResult of checkResults) {\n      if (checkResult.issues && checkResult.issues.length > 0) {\n        allIssues.push(...checkResult.issues);\n      }\n    }\n  }\n\n  // Convert errors from execution statistics into issues\n  if (statistics) {\n    for (const checkStats of statistics.checks) {\n      if (checkStats.errorMessage) {\n        allIssues.push({\n          file: 'system',\n          line: 0,\n          endLine: undefined,\n          ruleId: 'system/error',\n          message: checkStats.errorMessage,\n          severity: 'error',\n          category: 'logic',\n          suggestion: undefined,\n          replacement: undefined,\n        });\n      }\n    }\n  }\n\n  return {\n    issues: allIssues,\n  };\n}\n","import type { CheckExecutionOptions, ExecutionResult } from './types/execution';\nimport { AnalysisResult } from './output-formatters';\nimport type { VisorConfig } from './types/config';\nimport type { PRInfo } from './pr-analyzer';\nimport { StateMachineRunner } from './state-machine/runner';\nimport type { EngineContext } from './types/engine';\nimport { ExecutionJournal } from './snapshot-store';\nimport { logger } from './logger';\nimport type { DebugVisualizerServer } from './debug-visualizer/ws-server';\nimport { SandboxManager } from './sandbox/sandbox-manager';\nimport * as path from 'path';\nimport * as fs from 'fs';\n\n/**\n * State machine-based execution engine\n *\n * Production-ready state machine implementation with full observability support.\n * M4: Includes OTEL telemetry and debug visualizer event streaming.\n */\nexport class StateMachineExecutionEngine {\n  private workingDirectory: string;\n  private executionContext?: import('./providers/check-provider.interface').ExecutionContext;\n  private debugServer?: DebugVisualizerServer;\n  private _lastContext?: EngineContext;\n  private _lastRunner?: StateMachineRunner;\n\n  constructor(\n    workingDirectory?: string,\n    octokit?: import('@octokit/rest').Octokit,\n    debugServer?: DebugVisualizerServer\n  ) {\n    this.workingDirectory = workingDirectory || process.cwd();\n    this.debugServer = debugServer;\n  }\n\n  /**\n   * Execute checks using the state machine engine\n   *\n   * Converts CheckExecutionOptions -> executeGroupedChecks() -> AnalysisResult\n   */\n  async executeChecks(options: CheckExecutionOptions): Promise<AnalysisResult> {\n    const startTime = Date.now();\n    const timestamp = new Date().toISOString();\n    // Extract conversation from options if provided (TUI/CLI mode)\n    const optConversation = (options as any)?.conversation;\n    if (optConversation) {\n      const prev: any = this.executionContext || {};\n      this.executionContext = { ...prev, conversation: optConversation };\n    }\n\n    try {\n      // Initialize memory store if configured\n      if (options.config?.memory) {\n        const { MemoryStore } = await import('./memory-store');\n        const memoryStore = MemoryStore.getInstance(options.config.memory);\n        await memoryStore.initialize();\n        logger.debug('Memory store initialized');\n      }\n\n      // Analyze the repository\n      const { GitRepositoryAnalyzer } = await import('./git-repository-analyzer');\n      const gitAnalyzer = new GitRepositoryAnalyzer(options.workingDirectory);\n      logger.info('Analyzing local git repository...');\n      const repositoryInfo = await gitAnalyzer.analyzeRepository();\n\n      if (!repositoryInfo.isGitRepository) {\n        return this.createErrorResult(\n          repositoryInfo,\n          'Not a git repository or no changes found',\n          startTime,\n          timestamp,\n          options.checks\n        );\n      }\n\n      // Convert to PRInfo format for compatibility\n      const prInfo = gitAnalyzer.toPRInfo(repositoryInfo);\n\n      // Propagate event type if provided\n      try {\n        const evt = (options.webhookContext as any)?.eventType;\n        if (evt) (prInfo as any).eventType = evt;\n      } catch {}\n\n      // Apply tag filtering if specified\n      const filteredChecks = this.filterChecksByTags(\n        options.checks,\n        options.config,\n        options.tagFilter || options.config?.tag_filter\n      );\n\n      if (filteredChecks.length === 0) {\n        logger.warn('No checks match the tag filter criteria');\n        return this.createErrorResult(\n          repositoryInfo,\n          'No checks match the tag filter criteria',\n          startTime,\n          timestamp,\n          options.checks\n        );\n      }\n\n      // If a webhook context is provided (from WebhookServer or Slack socket),\n      // attach it to the http_input provider so http_input checks can read data.\n      try {\n        const map = (options as any)?.webhookContext?.webhookData as\n          | Map<string, unknown>\n          | undefined;\n        if (map) {\n          const { CheckProviderRegistry } = await import('./providers/check-provider-registry');\n          const reg = CheckProviderRegistry.getInstance();\n          const p: any = reg.getProvider('http_input');\n          if (p && typeof p.setWebhookContext === 'function') p.setWebhookContext(map);\n          const prev: any = this.executionContext || {};\n          this.setExecutionContext({ ...prev, webhookContext: { webhookData: map } } as any);\n        }\n      } catch {}\n\n      // Execute checks using state machine\n      logger.info(`Executing checks: ${filteredChecks.join(', ')}`);\n      const executionResult = await this.executeGroupedChecks(\n        prInfo,\n        filteredChecks,\n        options.timeout,\n        options.config,\n        options.outputFormat,\n        options.debug,\n        options.maxParallelism,\n        options.failFast,\n        options.tagFilter\n      );\n\n      // Convert ExecutionResult to AnalysisResult format\n      const executionTime = Date.now() - startTime;\n\n      // Extract review summary from grouped results\n      const reviewSummary = this.convertGroupedResultsToReviewSummary(\n        executionResult.results,\n        executionResult.statistics\n      );\n\n      // Collect debug information when debug mode is enabled\n      let debugInfo: import('./output-formatters').DebugInfo | undefined;\n      if (options.debug && reviewSummary.debug) {\n        debugInfo = {\n          provider: reviewSummary.debug.provider,\n          model: reviewSummary.debug.model,\n          processingTime: reviewSummary.debug.processingTime,\n          parallelExecution: options.checks.length > 1,\n          checksExecuted: options.checks,\n          totalApiCalls: reviewSummary.debug.totalApiCalls || options.checks.length,\n          apiCallDetails: reviewSummary.debug.apiCallDetails,\n        };\n      }\n\n      // Expose output history snapshot\n      try {\n        const histSnap = this.getOutputHistorySnapshot();\n        (reviewSummary as any).history = histSnap;\n      } catch {}\n\n      return {\n        repositoryInfo,\n        reviewSummary,\n        executionTime,\n        timestamp,\n        checksExecuted: filteredChecks,\n        executionStatistics: executionResult.statistics,\n        debug: debugInfo,\n      };\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Unknown error occurred';\n      logger.error('Error executing checks: ' + message);\n\n      // In strict test modes, surface errors to callers\n      const strictEnv = process.env.VISOR_STRICT_ERRORS === 'true';\n      if (strictEnv) {\n        throw error;\n      }\n\n      const fallbackRepositoryInfo: import('./git-repository-analyzer').GitRepositoryInfo = {\n        title: 'Error during analysis',\n        body: `Error: ${message || 'Unknown error'}`,\n        author: 'system',\n        base: 'main',\n        head: 'HEAD',\n        files: [],\n        totalAdditions: 0,\n        totalDeletions: 0,\n        isGitRepository: false,\n        workingDirectory: options.workingDirectory || process.cwd(),\n      };\n\n      return this.createErrorResult(\n        fallbackRepositoryInfo,\n        message || 'Unknown error occurred',\n        startTime,\n        timestamp,\n        options.checks\n      );\n    }\n  }\n\n  /**\n   * Get execution context (used by state machine to propagate hooks)\n   */\n  protected getExecutionContext():\n    | import('./providers/check-provider.interface').ExecutionContext\n    | undefined {\n    return this.executionContext;\n  }\n\n  /**\n   * Set execution context for external callers\n   */\n  public setExecutionContext(\n    context: import('./providers/check-provider.interface').ExecutionContext | undefined\n  ): void {\n    this.executionContext = context;\n  }\n\n  /**\n   * Reset per-run state (no-op for state machine engine)\n   *\n   * The state machine engine is stateless per-run by design.\n   * Each execution creates a fresh journal and context.\n   * This method exists only for backward compatibility with test framework.\n   *\n   * @deprecated This is a no-op. State machine engine doesn't maintain per-run state.\n   */\n  public resetPerRunState(): void {\n    // No-op: State machine engine is stateless per-run\n    // Each execution creates a fresh journal and context\n  }\n\n  /**\n   * Execute grouped checks using the state machine engine\n   *\n   * M4: Production-ready with full telemetry and debug server support\n   */\n  async executeGroupedChecks(\n    prInfo: PRInfo,\n    checks: string[],\n    timeout?: number,\n    config?: VisorConfig,\n    outputFormat?: string,\n    debug?: boolean,\n    maxParallelism?: number,\n    failFast?: boolean,\n    tagFilter?: import('./types/config').TagFilter,\n    _pauseGate?: () => Promise<void>\n  ): Promise<ExecutionResult> {\n    if (debug) {\n      logger.info('[StateMachine] Using state machine engine');\n    }\n\n    // Create minimal default config if none provided (backward compatibility)\n    if (!config) {\n      const { ConfigManager } = await import('./config');\n      const configManager = new ConfigManager();\n      config = await configManager.getDefaultConfig();\n      logger.debug('[StateMachine] Using default configuration (no config provided)');\n    }\n\n    // Merge tagFilter into config if provided (test runner passes it separately)\n    const configWithTagFilter = tagFilter\n      ? {\n          ...config,\n          tag_filter: tagFilter,\n        }\n      : config;\n\n    // Build engine context\n    const context = this.buildEngineContext(\n      configWithTagFilter,\n      prInfo,\n      debug,\n      maxParallelism,\n      failFast,\n      checks // Pass the explicit checks list\n    );\n\n    // Create SandboxManager if sandboxes are configured\n    if (configWithTagFilter.sandboxes && Object.keys(configWithTagFilter.sandboxes).length > 0) {\n      try {\n        const { execSync } = require('child_process');\n        const gitBranch = execSync('git rev-parse --abbrev-ref HEAD', { encoding: 'utf8' }).trim();\n        context.sandboxManager = new SandboxManager(\n          configWithTagFilter.sandboxes,\n          this.workingDirectory,\n          gitBranch\n        );\n      } catch {\n        // If git branch detection fails, use 'unknown'\n        context.sandboxManager = new SandboxManager(\n          configWithTagFilter.sandboxes,\n          this.workingDirectory,\n          'unknown'\n        );\n      }\n    }\n\n    // Initialize workspace isolation (if enabled)\n    const { initializeWorkspace } = require('./state-machine/context/build-engine-context');\n    await initializeWorkspace(context);\n\n    // Initialize policy engine (enterprise â€” dynamic import, no-op if unavailable)\n    if (configWithTagFilter.policy?.engine && configWithTagFilter.policy.engine !== 'disabled') {\n      try {\n        logger.debug(\n          `[PolicyEngine] Loading enterprise policy engine (engine=${configWithTagFilter.policy.engine})`\n        );\n        // @ts-ignore â€” enterprise/ may not exist in OSS builds (caught at runtime)\n        const { loadEnterprisePolicyEngine } = await import('./enterprise/loader');\n        context.policyEngine = await loadEnterprisePolicyEngine(configWithTagFilter.policy);\n        logger.debug(\n          `[PolicyEngine] Initialized: ${context.policyEngine?.constructor?.name || 'unknown'}`\n        );\n      } catch (err) {\n        // Enterprise module not available â€” continue with no policy engine\n        try {\n          logger.warn(\n            `[PolicyEngine] Enterprise policy engine init failed, using default: ${err instanceof Error ? err.message : err}`\n          );\n        } catch {}\n      }\n    }\n\n    // Enrich policy engine with PR context once available\n    if (context.policyEngine && 'setActorContext' in context.policyEngine) {\n      const actor: any = {\n        authorAssociation: prInfo?.authorAssociation || process.env.VISOR_AUTHOR_ASSOCIATION,\n        login: prInfo?.author || process.env.GITHUB_ACTOR,\n        isLocalMode: !process.env.GITHUB_ACTIONS,\n      };\n\n      // Extract Slack identity from webhookData (stashed by socket-runner)\n      try {\n        const webhookData = (this.executionContext as any)?.webhookContext?.webhookData;\n        if (webhookData instanceof Map) {\n          const { extractSlackContext } = await import('./slack/schedule-tool-handler');\n          const slackCtx = extractSlackContext(webhookData);\n          if (slackCtx) {\n            // Read pre-fetched user info (stashed by socket-runner)\n            const payload = Array.from(webhookData.values())[0] as any;\n            const userInfo = payload?.slack_user_info;\n            actor.slack = {\n              userId: slackCtx.userId,\n              channelId: slackCtx.channel,\n              channelType: slackCtx.channelType,\n              email: userInfo?.email,\n            };\n          }\n        }\n      } catch {}\n\n      const pullRequest = prInfo\n        ? {\n            number: prInfo.number,\n            labels: prInfo.labels,\n            draft: (prInfo as any).draft,\n            changedFiles: prInfo.files?.length,\n          }\n        : undefined;\n      (context.policyEngine as any).setActorContext(actor, undefined, pullRequest);\n    }\n\n    // Copy execution context (hooks, etc.) from legacy engine\n    context.executionContext = this.getExecutionContext();\n\n    // Store context for later access (e.g., getOutputHistorySnapshot)\n    this._lastContext = context;\n\n    // Optionally enable event-driven frontends if configured\n    let frontendsHost: any | undefined;\n    if (\n      Array.isArray((configWithTagFilter as any).frontends) &&\n      (configWithTagFilter as any).frontends.length > 0\n    ) {\n      try {\n        const { EventBus } = await import('./event-bus/event-bus');\n        const { FrontendsHost } = await import('./frontends/host');\n        const bus = new EventBus();\n        (context as any).eventBus = bus;\n        frontendsHost = new FrontendsHost(bus, logger);\n        if (process.env.VISOR_DEBUG === 'true') {\n          try {\n            const fns = ((configWithTagFilter as any).frontends || []).map((f: any) => ({\n              name: f?.name,\n              hasConfig: !!f?.config,\n              cfg: f?.config || undefined,\n            }));\n            logger.info(`[Frontends] Loading specs: ${JSON.stringify(fns)}`);\n          } catch {}\n        }\n        await frontendsHost.load((configWithTagFilter as any).frontends);\n        // Derive repo/pr/headSha and octokit if available\n        let owner: string | undefined;\n        let name: string | undefined;\n        let prNum: number | undefined;\n        let headSha: string | undefined;\n        try {\n          const anyInfo: any = prInfo as any;\n          owner =\n            anyInfo?.eventContext?.repository?.owner?.login ||\n            process.env.GITHUB_REPOSITORY?.split('/')?.[0];\n          name =\n            anyInfo?.eventContext?.repository?.name ||\n            process.env.GITHUB_REPOSITORY?.split('/')?.[1];\n          prNum = typeof anyInfo?.number === 'number' ? anyInfo.number : undefined;\n          headSha = anyInfo?.eventContext?.pull_request?.head?.sha || process.env.GITHUB_SHA;\n        } catch {}\n        const repoObj = owner && name ? { owner, name } : undefined;\n        const octokit = (this.executionContext as any)?.octokit;\n        // Fallback: if headSha is missing but we have PR info and octokit, fetch it\n        if (\n          !headSha &&\n          repoObj &&\n          prNum &&\n          octokit &&\n          typeof octokit.rest?.pulls?.get === 'function'\n        ) {\n          try {\n            const { data } = await octokit.rest.pulls.get({\n              owner: repoObj.owner,\n              repo: repoObj.name,\n              pull_number: prNum,\n            });\n            headSha = (data && (data as any).head && (data as any).head.sha) || headSha;\n          } catch {\n            // ignore; headSha remains undefined\n          }\n        }\n        // Make the event bus available to providers via executionContext\n        try {\n          const prev: any = this.getExecutionContext() || {};\n          this.setExecutionContext({ ...prev, eventBus: bus });\n          // Also reflect it into the active engine context so downstream providers see it\n          try {\n            (context as any).executionContext = this.getExecutionContext();\n          } catch {}\n        } catch {}\n\n        // Capture trace info while the OTel span is active (before async event handlers lose context)\n        let runTraceId: string | undefined;\n        try {\n          const { trace: lazyTrace, context: lazyCtx } = await import('./telemetry/lazy-otel');\n          const activeSpan = lazyTrace.getSpan(lazyCtx.active());\n          runTraceId = activeSpan?.spanContext()?.traceId;\n        } catch {}\n\n        await frontendsHost.startAll(() => ({\n          eventBus: bus,\n          logger,\n          // Provide the active (possibly tag-filtered) config so frontends can read groups, etc.\n          config: configWithTagFilter,\n          run: {\n            runId: (context as any).sessionId,\n            repo: repoObj,\n            pr: prNum,\n            headSha,\n            traceId: runTraceId,\n            event: (context as any).event || (prInfo as any)?.eventType,\n            actor:\n              (prInfo as any)?.eventContext?.sender?.login ||\n              (typeof process.env.GITHUB_ACTOR === 'string' ? process.env.GITHUB_ACTOR : undefined),\n          },\n          octokit,\n          webhookContext: (this.executionContext as any)?.webhookContext,\n          // Surface any injected test doubles for Slack as well\n          slack:\n            (this.executionContext as any)?.slack || (this.executionContext as any)?.slackClient,\n        }));\n\n        // Phase 1: Snapshot on HumanInputRequested (experimental pause support)\n        try {\n          bus.on('HumanInputRequested', async (envelope: any) => {\n            try {\n              const ev = (envelope && envelope.payload) || envelope;\n              // Determine channel/thread from event or inbound payload\n              let channel: string | undefined = ev?.channel;\n              let threadTs: string | undefined = ev?.threadTs;\n              if (!channel || !threadTs) {\n                try {\n                  const anyCfg: any = configWithTagFilter || {};\n                  const slackCfg: any = anyCfg.slack || {};\n                  const endpoint: string = slackCfg.endpoint || '/bots/slack/support';\n                  const map = (this.executionContext as any)?.webhookContext?.webhookData as\n                    | Map<string, unknown>\n                    | undefined;\n                  const payload: any = map?.get(endpoint);\n                  const e: any = payload?.event;\n                  const derivedTs = String(e?.thread_ts || e?.ts || e?.event_ts || '');\n                  const derivedCh = String(e?.channel || '');\n                  if (derivedCh && derivedTs) {\n                    channel = channel || derivedCh;\n                    threadTs = threadTs || derivedTs;\n                  }\n                } catch {}\n              }\n\n              const checkId = String(ev?.checkId || 'unknown');\n              const threadKey =\n                ev?.threadKey || (channel && threadTs ? `${channel}:${threadTs}` : 'session');\n              const baseDir =\n                process.env.VISOR_SNAPSHOT_DIR ||\n                path.resolve(process.cwd(), '.visor', 'snapshots');\n              fs.mkdirSync(baseDir, { recursive: true });\n              const filePath = path.join(baseDir, `${threadKey}-${checkId}.json`);\n              await this.saveSnapshotToFile(filePath);\n              logger.info(`[Snapshot] Saved run snapshot: ${filePath}`);\n              try {\n                await bus.emit({\n                  type: 'SnapshotSaved',\n                  checkId: ev?.checkId || 'unknown',\n                  channel,\n                  threadTs,\n                  threadKey,\n                  filePath,\n                });\n              } catch {}\n            } catch (e) {\n              logger.warn(\n                `[Snapshot] Failed to save snapshot on HumanInputRequested: ${\n                  e instanceof Error ? e.message : String(e)\n                }`\n              );\n            }\n          });\n        } catch {}\n      } catch (err) {\n        logger.warn(\n          `[Frontends] Failed to initialize frontends: ${err instanceof Error ? err.message : String(err)}`\n        );\n      }\n    }\n\n    // Create and run state machine with debug server support (M4)\n    const runner = new StateMachineRunner(context, this.debugServer);\n    this._lastRunner = runner;\n\n    try {\n      const result = await runner.run();\n\n      // Stop frontends if started\n      if (frontendsHost && typeof frontendsHost.stopAll === 'function') {\n        try {\n          await frontendsHost.stopAll();\n        } catch {}\n      }\n\n      if (debug) {\n        logger.info('[StateMachine] Execution complete');\n      }\n\n      // Post-grouped comments via legacy reviewer is removed; GitHub frontend handles comments\n\n      // Cleanup AI sessions after execution\n      try {\n        const { SessionRegistry } = await import('./session-registry');\n        const sessionRegistry = SessionRegistry.getInstance();\n        sessionRegistry.clearAllSessions();\n      } catch (error) {\n        logger.debug(`[StateMachine] Failed to cleanup sessions: ${error}`);\n      }\n\n      // Cleanup policy engine if enabled\n      if (context.policyEngine) {\n        try {\n          await context.policyEngine.shutdown();\n        } catch (error) {\n          logger.debug(`[StateMachine] Failed to cleanup policy engine: ${error}`);\n        }\n      }\n\n      // Cleanup workspace if enabled\n      if (context.workspace) {\n        try {\n          await context.workspace.cleanup();\n        } catch (error) {\n          logger.debug(`[StateMachine] Failed to cleanup workspace: ${error}`);\n        }\n      }\n\n      return result;\n    } finally {\n      // Cleanup sandbox containers\n      if (context.sandboxManager) {\n        await context.sandboxManager.stopAll().catch(err => {\n          logger.warn(`Failed to stop sandboxes: ${err}`);\n        });\n        context.sandboxManager = undefined;\n      }\n    }\n  }\n\n  /**\n   * Build the engine context for state machine execution\n   */\n  private buildEngineContext(\n    config: VisorConfig,\n    prInfo: PRInfo,\n    debug?: boolean,\n    maxParallelism?: number,\n    failFast?: boolean,\n    requestedChecks?: string[]\n  ): EngineContext {\n    const { buildEngineContextForRun } = require('./state-machine/context/build-engine-context');\n    return buildEngineContextForRun(\n      this.workingDirectory,\n      config,\n      prInfo,\n      debug,\n      maxParallelism,\n      failFast,\n      requestedChecks\n    );\n  }\n\n  /**\n   * Get output history snapshot for test framework compatibility\n   * Extracts output history from the journal\n   */\n  public getOutputHistorySnapshot(): Record<string, unknown[]> {\n    // Get the journal from the last execution context\n    const journal = (this as any)._lastContext?.journal as ExecutionJournal | undefined;\n    if (!journal) {\n      logger.debug('[StateMachine][DEBUG] getOutputHistorySnapshot: No journal found');\n      return {};\n    }\n\n    const sessionId = (this as any)._lastContext?.sessionId as string | undefined;\n    if (!sessionId) {\n      logger.debug('[StateMachine][DEBUG] getOutputHistorySnapshot: No sessionId found');\n      return {};\n    }\n\n    // Read all journal entries for this session\n    const snapshot = journal.beginSnapshot();\n    const allEntries = journal.readVisible(sessionId, snapshot, undefined);\n\n    logger.debug(\n      `[StateMachine][DEBUG] getOutputHistorySnapshot: Found ${allEntries.length} journal entries`\n    );\n\n    // Group by checkId and extract outputs\n    const outputHistory: Record<string, unknown[]> = {};\n    for (const entry of allEntries) {\n      const checkId = entry.checkId;\n\n      if (!outputHistory[checkId]) {\n        outputHistory[checkId] = [];\n      }\n      // Skip journal stubs for skipped checks\n      try {\n        if (entry && typeof entry.result === 'object' && (entry.result as any).__skipped) {\n          continue;\n        }\n      } catch {}\n\n      // Prefer explicit .output; fall back to the full result (issues/content)\n      // so tests and templates can reference paths like issues[0].severity for\n      // code-review schema steps which do not set a separate output object.\n      const payload =\n        entry.result.output !== undefined ? entry.result.output : (entry.result as unknown);\n\n      // Filter out forEach aggregation metadata objects (which contain a\n      // forEachItems array) to avoid double-counting per-item executions in\n      // tests. The actual per-item outputs are committed as separate entries\n      // and should be used for history-based assertions and routing.\n      try {\n        if (\n          payload &&\n          typeof payload === 'object' &&\n          (payload as any).forEachItems &&\n          Array.isArray((payload as any).forEachItems)\n        ) {\n          continue;\n        }\n      } catch {}\n\n      if (payload !== undefined) outputHistory[checkId].push(payload);\n    }\n\n    logger.debug(\n      `[StateMachine][DEBUG] getOutputHistorySnapshot result: ${JSON.stringify(Object.keys(outputHistory))}`\n    );\n    for (const [checkId, outputs] of Object.entries(outputHistory)) {\n      logger.debug(`[StateMachine][DEBUG]   ${checkId}: ${outputs.length} outputs`);\n    }\n\n    return outputHistory;\n  }\n\n  /**\n   * Save a JSON snapshot of the last run's state and journal to a file (experimental).\n   * Does not include secrets. Intended for debugging and future resume support.\n   */\n  public async saveSnapshotToFile(filePath: string): Promise<void> {\n    const fs = await import('fs/promises');\n    const ctx = this._lastContext;\n    const runner = this._lastRunner;\n    if (!ctx || !runner) {\n      throw new Error('No prior execution context to snapshot');\n    }\n    const journal = (ctx as any).journal as ExecutionJournal;\n    const snapshotId = journal.beginSnapshot();\n    const entries = journal.readVisible(ctx.sessionId, snapshotId, undefined);\n    const state = runner.getState();\n    const serializableState = serializeRunState(state);\n    const payload = {\n      version: 1,\n      sessionId: ctx.sessionId,\n      event: ctx.event,\n      wave: state.wave,\n      state: serializableState,\n      journal: entries,\n      requestedChecks: (ctx as any).requestedChecks || [],\n    } as const;\n    await fs.writeFile(filePath, JSON.stringify(payload, null, 2), 'utf8');\n  }\n\n  /**\n   * Load a snapshot JSON from file and return it. Resume support can build on this.\n   */\n  public async loadSnapshotFromFile<T = unknown>(filePath: string): Promise<T> {\n    const fs = await import('fs/promises');\n    const raw = await fs.readFile(filePath, 'utf8');\n    return JSON.parse(raw) as T;\n  }\n\n  /**\n   * Filter checks by tag filter\n   */\n  private filterChecksByTags(\n    checks: string[],\n    config: VisorConfig | undefined,\n    tagFilter: import('./types/config').TagFilter | undefined\n  ): string[] {\n    // When no tag filter is specified, include only untagged checks by default.\n    // Tagged checks are opt-in unless tag_filter is provided.\n    return checks.filter(checkName => {\n      const checkConfig = config?.checks?.[checkName];\n      if (!checkConfig) {\n        // If no config for this check, include it by default\n        return true;\n      }\n\n      const checkTags = checkConfig.tags || [];\n\n      // If no tag filter is specified, include only untagged checks.\n      if (!tagFilter || (!tagFilter.include && !tagFilter.exclude)) {\n        return checkTags.length === 0;\n      }\n\n      // If check has no tags and a tag filter is specified, include it (untagged checks always run)\n      if (checkTags.length === 0) {\n        return true;\n      }\n\n      // Check exclude tags first (if any exclude tag matches, skip the check)\n      if (tagFilter.exclude && tagFilter.exclude.length > 0) {\n        const hasExcludedTag = tagFilter.exclude.some(tag => checkTags.includes(tag));\n        if (hasExcludedTag) return false;\n      }\n\n      // Check include tags (if specified, at least one must match)\n      if (tagFilter.include && tagFilter.include.length > 0) {\n        const hasIncludedTag = tagFilter.include.some(tag => checkTags.includes(tag));\n        if (!hasIncludedTag) return false;\n      }\n\n      return true;\n    });\n  }\n\n  /**\n   * Create an error result in AnalysisResult format\n   */\n  private createErrorResult(\n    repositoryInfo: import('./git-repository-analyzer').GitRepositoryInfo,\n    errorMessage: string,\n    startTime: number,\n    timestamp: string,\n    checksExecuted: string[]\n  ): AnalysisResult {\n    const executionTime = Date.now() - startTime;\n\n    return {\n      repositoryInfo,\n      reviewSummary: {\n        issues: [\n          {\n            file: 'system',\n            line: 0,\n            endLine: undefined,\n            ruleId: 'system/error',\n            message: errorMessage,\n            severity: 'error',\n            category: 'logic',\n            suggestion: undefined,\n            replacement: undefined,\n          },\n        ],\n      },\n      executionTime,\n      timestamp,\n      checksExecuted,\n    };\n  }\n\n  /**\n   * Convert GroupedCheckResults to ReviewSummary\n   * Aggregates all check results into a single ReviewSummary\n   */\n  private convertGroupedResultsToReviewSummary(\n    groupedResults: import('./reviewer').GroupedCheckResults,\n    statistics?: import('./types/execution').ExecutionStatistics\n  ): import('./reviewer').ReviewSummary {\n    const { convertToReviewSummary } = require('./state-machine/execution/summary');\n    return (convertToReviewSummary as any)(groupedResults as any, statistics as any) as any;\n  }\n\n  /**\n   * Evaluate failure conditions for a check result\n   *\n   * This method provides backward compatibility with the legacy engine by\n   * delegating to the FailureConditionEvaluator.\n   *\n   * @param checkName - The name of the check being evaluated\n   * @param reviewSummary - The review summary containing check results\n   * @param config - The Visor configuration containing failure conditions\n   * @param previousOutputs - Optional previous check outputs for cross-check conditions\n   * @param authorAssociation - Optional GitHub author association for permission checks\n   * @returns Array of failure condition evaluation results\n   */\n  async evaluateFailureConditions(\n    checkName: string,\n    reviewSummary: import('./reviewer').ReviewSummary,\n    config: VisorConfig,\n    previousOutputs?: Record<string, import('./reviewer').ReviewSummary>,\n    authorAssociation?: string\n  ): Promise<import('./types/config').FailureConditionResult[]> {\n    const { FailureConditionEvaluator } = await import('./failure-condition-evaluator');\n    const evaluator = new FailureConditionEvaluator();\n    const { addEvent } = await import('./telemetry/trace-helpers');\n    const { addFailIfTriggered } = await import('./telemetry/metrics');\n\n    // Extract check configuration\n    const checkConfig = config.checks?.[checkName];\n    if (!checkConfig) {\n      return [];\n    }\n\n    // Schema can be string or Record<string, unknown>, convert to string for evaluation\n    const rawSchema = checkConfig.schema || 'code-review';\n    const checkSchema = typeof rawSchema === 'string' ? rawSchema : 'code-review';\n    const checkGroup = checkConfig.group || 'default';\n\n    // Handle both fail_if (simple string) and failure_conditions (complex object)\n    const results: import('./types/config').FailureConditionResult[] = [];\n\n    // Evaluate global fail_if\n    if (config.fail_if) {\n      const failed = await evaluator.evaluateSimpleCondition(\n        checkName,\n        checkSchema,\n        checkGroup,\n        reviewSummary,\n        config.fail_if,\n        previousOutputs || {}\n      );\n\n      // Telemetry events + metric\n      try {\n        addEvent('fail_if.evaluated', {\n          'visor.check.id': checkName,\n          scope: 'global',\n          expression: String(config.fail_if),\n          result: failed ? 'triggered' : 'not_triggered',\n        });\n        if (failed) {\n          addEvent('fail_if.triggered', {\n            'visor.check.id': checkName,\n            scope: 'global',\n            expression: String(config.fail_if),\n          });\n          addFailIfTriggered(checkName, 'global');\n        }\n      } catch {}\n\n      results.push({\n        conditionName: 'global_fail_if',\n        failed,\n        expression: config.fail_if,\n        message: failed ? `Global failure condition met: ${config.fail_if}` : undefined,\n        severity: 'error',\n        haltExecution: false,\n      });\n    }\n\n    // Evaluate check-specific fail_if (overrides global if present)\n    if (checkConfig.fail_if) {\n      const failed = await evaluator.evaluateSimpleCondition(\n        checkName,\n        checkSchema,\n        checkGroup,\n        reviewSummary,\n        checkConfig.fail_if,\n        previousOutputs || {}\n      );\n\n      // Telemetry events + metric\n      try {\n        addEvent('fail_if.evaluated', {\n          'visor.check.id': checkName,\n          scope: 'check',\n          expression: String(checkConfig.fail_if),\n          result: failed ? 'triggered' : 'not_triggered',\n        });\n        if (failed) {\n          addEvent('fail_if.triggered', {\n            'visor.check.id': checkName,\n            scope: 'check',\n            expression: String(checkConfig.fail_if),\n          });\n          addFailIfTriggered(checkName, 'check');\n        }\n      } catch {}\n\n      results.push({\n        conditionName: `${checkName}_fail_if`,\n        failed,\n        expression: checkConfig.fail_if,\n        message: failed ? `Check failure condition met: ${checkConfig.fail_if}` : undefined,\n        severity: 'error',\n        haltExecution: false,\n      });\n    }\n\n    // Also evaluate legacy failure_conditions if present\n    const globalConditions = config.failure_conditions;\n    const checkConditions = checkConfig.failure_conditions;\n\n    if (globalConditions || checkConditions) {\n      const legacyResults = await evaluator.evaluateConditions(\n        checkName,\n        checkSchema,\n        checkGroup,\n        reviewSummary,\n        globalConditions,\n        checkConditions,\n        previousOutputs,\n        authorAssociation\n      );\n      results.push(...legacyResults);\n    }\n\n    return results;\n  }\n\n  /**\n   * Get repository status\n   * @returns Repository status information\n   */\n  async getRepositoryStatus(): Promise<{\n    isGitRepository: boolean;\n    branch?: string;\n    hasChanges: boolean;\n    filesChanged?: number;\n  }> {\n    try {\n      const { GitRepositoryAnalyzer } = await import('./git-repository-analyzer');\n      const analyzer = new GitRepositoryAnalyzer(this.workingDirectory);\n      const info = await analyzer.analyzeRepository();\n\n      return {\n        isGitRepository: info.isGitRepository,\n        branch: info.head, // Use head as branch name\n        hasChanges: info.isGitRepository && (info.files?.length > 0 || false),\n        filesChanged: info.isGitRepository ? info.files?.length || 0 : 0,\n      };\n    } catch {\n      return {\n        isGitRepository: false,\n        hasChanges: false,\n      };\n    }\n  }\n\n  /**\n   * Check if current directory is a git repository\n   * @returns True if git repository, false otherwise\n   */\n  async isGitRepository(): Promise<boolean> {\n    const status = await this.getRepositoryStatus();\n    return status.isGitRepository;\n  }\n\n  /**\n   * Get list of available check types\n   * @returns Array of check type names\n   */\n  static getAvailableCheckTypes(): string[] {\n    const { CheckProviderRegistry } = require('./providers/check-provider-registry');\n    const registry = CheckProviderRegistry.getInstance();\n    return registry.getAvailableProviders();\n  }\n\n  /**\n   * Validate check types and return valid/invalid lists\n   * @param checks - Array of check type names to validate\n   * @returns Object with valid and invalid check types\n   */\n  static validateCheckTypes(checks: string[]): { valid: string[]; invalid: string[] } {\n    const availableTypes = StateMachineExecutionEngine.getAvailableCheckTypes();\n    const valid: string[] = [];\n    const invalid: string[] = [];\n\n    for (const check of checks) {\n      if (availableTypes.includes(check)) {\n        valid.push(check);\n      } else {\n        invalid.push(check);\n      }\n    }\n\n    return { valid, invalid };\n  }\n\n  /**\n   * Format the status column for execution statistics\n   * Used by execution-statistics-formatting tests\n   */\n  private formatStatusColumn(stats: import('./types/execution').CheckExecutionStats): string {\n    if (stats.skipped) {\n      // Format skip reason\n      if (stats.skipReason === 'if_condition') {\n        return 'â­ if';\n      } else if (stats.skipReason === 'fail_fast') {\n        return 'â­ ff';\n      } else if (stats.skipReason === 'dependency_failed') {\n        return 'â­ dep';\n      }\n      return 'â­';\n    }\n\n    const totalRuns = stats.totalRuns;\n    const successfulRuns = stats.successfulRuns;\n    const failedRuns = stats.failedRuns;\n\n    if (failedRuns > 0 && successfulRuns > 0) {\n      // Mixed results\n      return `âœ”/âœ– ${successfulRuns}/${totalRuns}`;\n    } else if (failedRuns > 0) {\n      // All failed\n      return totalRuns === 1 ? 'âœ–' : `âœ– Ã—${totalRuns}`;\n    } else {\n      // All successful\n      return totalRuns === 1 ? 'âœ”' : `âœ” Ã—${totalRuns}`;\n    }\n  }\n\n  /**\n   * Format the details column for execution statistics\n   * Used by execution-statistics-formatting tests\n   */\n  private formatDetailsColumn(stats: import('./types/execution').CheckExecutionStats): string {\n    const parts: string[] = [];\n\n    // Add outputs produced\n    if (stats.outputsProduced !== undefined && stats.outputsProduced > 0) {\n      parts.push(`â†’${stats.outputsProduced}`);\n    }\n\n    // Add critical issues\n    if (stats.issuesBySeverity.critical > 0) {\n      parts.push(`${stats.issuesBySeverity.critical}ðŸ”´`);\n    }\n\n    // Add error issues (only if no critical)\n    if (stats.issuesBySeverity.error > 0 && stats.issuesBySeverity.critical === 0) {\n      parts.push(`${stats.issuesBySeverity.error}âŒ`);\n    }\n\n    // Add warnings\n    if (stats.issuesBySeverity.warning > 0) {\n      parts.push(`${stats.issuesBySeverity.warning}âš ï¸`);\n    }\n\n    // Add info issues (only if no critical/error/warning)\n    if (\n      stats.issuesBySeverity.info > 0 &&\n      stats.issuesBySeverity.critical === 0 &&\n      stats.issuesBySeverity.error === 0 &&\n      stats.issuesBySeverity.warning === 0\n    ) {\n      parts.push(`${stats.issuesBySeverity.info}ðŸ’¡`);\n    }\n\n    // Add error message if present\n    if (stats.errorMessage) {\n      parts.push(this.truncate(stats.errorMessage, 40));\n    }\n\n    // Add skip condition if present\n    if (stats.skipCondition) {\n      parts.push(this.truncate(stats.skipCondition, 40));\n    }\n\n    return parts.join(' ');\n  }\n\n  /**\n   * Truncate a string to a maximum length\n   * Used by formatDetailsColumn\n   */\n  private truncate(str: string, maxLength: number): string {\n    if (str.length <= maxLength) {\n      return str;\n    }\n    return str.substring(0, maxLength - 3) + '...';\n  }\n}\n\n/** Convert RunState with Maps/Sets into a JSON-safe form */\nfunction serializeRunState(state: import('./types/engine').RunState) {\n  return {\n    ...state,\n    levelQueue: state.levelQueue,\n    eventQueue: state.eventQueue,\n    activeDispatches: Array.from(state.activeDispatches.entries()),\n    completedChecks: Array.from(state.completedChecks.values()),\n    stats: Array.from(state.stats.entries()),\n    historyLog: state.historyLog,\n    forwardRunGuards: Array.from(state.forwardRunGuards.values()),\n    currentLevelChecks: Array.from(state.currentLevelChecks.values()),\n    currentWaveCompletions: Array.from(\n      ((state as any).currentWaveCompletions as Set<string> | undefined) || []\n    ),\n    // failedChecks is an internal Set added by stats/dispatch layers; keep it if present\n    failedChecks: Array.from(((state as any).failedChecks as Set<string> | undefined) || []),\n    pendingRunScopes: Array.from((state.pendingRunScopes || new Map()).entries()).map(([k, v]) => [\n      k,\n      v,\n    ]),\n  };\n}\n\nexport type SnapshotJson = {\n  version: number;\n  sessionId: string;\n  event?: import('./types/config').EventTrigger;\n  wave?: number;\n  state: any;\n  journal: import('./snapshot-store').JournalEntry[];\n  requestedChecks?: string[];\n  meta?: Record<string, unknown>;\n};\n\n/**\n * Resume execution from a previously saved snapshot (experimental).\n * Frontends are started to mirror executeGroupedChecks behavior so integrations\n * like Slack can handle CheckCompleted/HumanInputRequested events during resume.\n */\nexport async function resumeFromSnapshot(\n  engine: StateMachineExecutionEngine,\n  snapshot: SnapshotJson,\n  config: VisorConfig,\n  opts?: { debug?: boolean; maxParallelism?: number; failFast?: boolean; webhookContext?: any }\n): Promise<import('./types/execution').ExecutionResult> {\n  // Recompute PRInfo from the current repository\n  const { GitRepositoryAnalyzer } = await import('./git-repository-analyzer');\n  const analyzer = new GitRepositoryAnalyzer(process.cwd());\n  const repoInfo = await analyzer.analyzeRepository();\n  const prInfo = analyzer.toPRInfo(repoInfo);\n\n  const context = (engine as any).buildEngineContext(\n    config,\n    prInfo,\n    opts?.debug,\n    opts?.maxParallelism,\n    opts?.failFast,\n    snapshot.requestedChecks\n  ) as import('./types/engine').EngineContext;\n\n  // Initialize workspace isolation (if enabled) - same as executeGroupedChecks\n  const { initializeWorkspace } = require('./state-machine/context/build-engine-context');\n  await initializeWorkspace(context);\n\n  // Propagate existing executionContext (hooks, octokit, webhookContext, slack, etc.)\n  try {\n    const prevExecCtx: any = (engine as any).getExecutionContext?.() || {};\n    (context as any).executionContext = prevExecCtx;\n  } catch {}\n\n  // Restore journal entries\n  try {\n    const journal = (context as any).journal as ExecutionJournal;\n    for (const e of snapshot.journal || []) {\n      journal.commitEntry({\n        // Re-hydrate all entries under the NEW sessionId for this resume run.\n        // This ensures helpers like output history and chat_history see both\n        // pre-snapshot and post-resume outputs as a single logical session.\n        sessionId: (context as any).sessionId,\n        scope: e.scope,\n        checkId: e.checkId,\n        result: e.result,\n        event: e.event,\n      });\n    }\n  } catch {}\n\n  // Adopt webhookContext and other execution context patches if provided\n  try {\n    const prev: any = (engine as any).getExecutionContext?.() || {};\n    (engine as any).setExecutionContext?.({ ...prev, webhookContext: opts?.webhookContext });\n    // Reflect merged executionContext into active engine context\n    try {\n      (context as any).executionContext = (engine as any).getExecutionContext?.();\n    } catch {}\n  } catch {}\n\n  // Optional frontends (Slack, GitHub, etc.) â€“ mirror executeGroupedChecks\n  let frontendsHost: any | undefined;\n  if (Array.isArray((config as any).frontends) && (config as any).frontends.length > 0) {\n    try {\n      const { EventBus } = await import('./event-bus/event-bus');\n      const { FrontendsHost } = await import('./frontends/host');\n      const bus = new EventBus();\n      (context as any).eventBus = bus;\n      frontendsHost = new FrontendsHost(bus, logger);\n\n      if (process.env.VISOR_DEBUG === 'true') {\n        try {\n          const fns = ((config as any).frontends || []).map((f: any) => ({\n            name: f?.name,\n            hasConfig: !!f?.config,\n            cfg: f?.config || undefined,\n          }));\n          logger.info(`[Frontends] Loading specs: ${JSON.stringify(fns)}`);\n        } catch {}\n      }\n\n      await frontendsHost.load((config as any).frontends);\n\n      // Derive repo/pr/headSha and octokit if available\n      let owner: string | undefined;\n      let name: string | undefined;\n      let prNum: number | undefined;\n      let headSha: string | undefined;\n      try {\n        const anyInfo: any = prInfo as any;\n        owner =\n          anyInfo?.eventContext?.repository?.owner?.login ||\n          process.env.GITHUB_REPOSITORY?.split('/')?.[0];\n        name =\n          anyInfo?.eventContext?.repository?.name || process.env.GITHUB_REPOSITORY?.split('/')?.[1];\n        prNum = typeof anyInfo?.number === 'number' ? anyInfo.number : undefined;\n        headSha = anyInfo?.eventContext?.pull_request?.head?.sha || process.env.GITHUB_SHA;\n      } catch {}\n      const repoObj = owner && name ? { owner, name } : undefined;\n      const octokit = (engine as any).getExecutionContext?.()?.octokit;\n\n      // Fallback: if headSha is missing but we have PR info and octokit, fetch it\n      if (\n        !headSha &&\n        repoObj &&\n        prNum &&\n        octokit &&\n        typeof octokit.rest?.pulls?.get === 'function'\n      ) {\n        try {\n          const { data } = await octokit.rest.pulls.get({\n            owner: repoObj.owner,\n            repo: repoObj.name,\n            pull_number: prNum,\n          });\n          headSha = (data && (data as any).head && (data as any).head.sha) || headSha;\n        } catch {\n          // ignore; headSha remains undefined\n        }\n      }\n\n      // Make the event bus available to providers via executionContext\n      try {\n        const prevExec: any = (engine as any).getExecutionContext?.() || {};\n        (engine as any).setExecutionContext?.({ ...prevExec, eventBus: bus });\n        try {\n          (context as any).executionContext = (engine as any).getExecutionContext?.();\n        } catch {}\n      } catch {}\n\n      // Capture trace info while the OTel span is active\n      let resumeTraceId: string | undefined;\n      try {\n        const { trace: lazyTrace, context: lazyCtx } = await import('./telemetry/lazy-otel');\n        const activeSpan = lazyTrace.getSpan(lazyCtx.active());\n        resumeTraceId = activeSpan?.spanContext()?.traceId;\n      } catch {}\n\n      await frontendsHost.startAll(() => ({\n        eventBus: bus,\n        logger,\n        // Provide the active config so frontends can read groups, etc.\n        config,\n        run: {\n          runId: (context as any).sessionId,\n          repo: repoObj,\n          pr: prNum,\n          headSha,\n          traceId: resumeTraceId,\n          event: (context as any).event || (prInfo as any)?.eventType,\n          actor:\n            (prInfo as any)?.eventContext?.sender?.login ||\n            (typeof process.env.GITHUB_ACTOR === 'string' ? process.env.GITHUB_ACTOR : undefined),\n        },\n        octokit,\n        webhookContext: (engine as any).getExecutionContext?.()?.webhookContext,\n        // Surface any injected test doubles for Slack as well\n        slack:\n          (engine as any).getExecutionContext?.()?.slack ||\n          (engine as any).getExecutionContext?.()?.slackClient,\n      }));\n\n      // Snapshot-on-human-input support for resumed runs\n      try {\n        bus.on('HumanInputRequested', async (envelope: any) => {\n          try {\n            const ev = (envelope && envelope.payload) || envelope;\n            // Determine channel/thread from event or inbound payload\n            let channel: string | undefined = ev?.channel;\n            let threadTs: string | undefined = ev?.threadTs;\n            if (!channel || !threadTs) {\n              try {\n                const anyCfg: any = config || {};\n                const slackCfg: any = anyCfg.slack || {};\n                const endpoint: string = slackCfg.endpoint || '/bots/slack/support';\n                const map = (engine as any).getExecutionContext?.()?.webhookContext?.webhookData as\n                  | Map<string, unknown>\n                  | undefined;\n                const payload: any = map?.get(endpoint);\n                const e: any = payload?.event;\n                const derivedTs = String(e?.thread_ts || e?.ts || e?.event_ts || '');\n                const derivedCh = String(e?.channel || '');\n                if (derivedCh && derivedTs) {\n                  channel = channel || derivedCh;\n                  threadTs = threadTs || derivedTs;\n                }\n              } catch {}\n            }\n\n            const checkId = String(ev?.checkId || 'unknown');\n            const threadKey =\n              ev?.threadKey || (channel && threadTs ? `${channel}:${threadTs}` : 'session');\n            const baseDir =\n              process.env.VISOR_SNAPSHOT_DIR || path.resolve(process.cwd(), '.visor', 'snapshots');\n            fs.mkdirSync(baseDir, { recursive: true });\n            const filePath = path.join(baseDir, `${threadKey}-${checkId}.json`);\n            await engine.saveSnapshotToFile(filePath);\n            logger.info(`[Snapshot] Saved run snapshot: ${filePath}`);\n            try {\n              await bus.emit({\n                type: 'SnapshotSaved',\n                checkId: ev?.checkId || 'unknown',\n                channel,\n                threadTs,\n                threadKey,\n                filePath,\n              });\n            } catch {}\n          } catch (e) {\n            logger.warn(\n              `[Snapshot] Failed to save snapshot on HumanInputRequested: ${\n                e instanceof Error ? e.message : String(e)\n              }`\n            );\n          }\n        });\n      } catch {}\n    } catch (err) {\n      logger.warn(\n        `[Frontends] Failed to initialize frontends (resumeFromSnapshot): ${\n          err instanceof Error ? err.message : String(err)\n        }`\n      );\n    }\n  }\n\n  // Create runner and hydrate state\n  // For resume flows, we treat the snapshot's journal as prior history and\n  // start a fresh run from the normal Init â†’ PlanReady â†’ WavePlanning cycle.\n  // This avoids resuming mid-wave and accidentally re-running stale checks\n  // (e.g., chat replies) before new input is incorporated.\n  const runner = new (require('./state-machine/runner').StateMachineRunner)(\n    context,\n    (engine as any).debugServer\n  );\n  (engine as any)._lastContext = context;\n  (engine as any)._lastRunner = runner;\n\n  const result = await runner.run();\n\n  // Stop frontends if started\n  if (frontendsHost && typeof frontendsHost.stopAll === 'function') {\n    try {\n      await frontendsHost.stopAll();\n    } catch {}\n  }\n\n  // Cleanup AI sessions after execution\n  try {\n    const { SessionRegistry } = await import('./session-registry');\n    const sessionRegistry = SessionRegistry.getInstance();\n    sessionRegistry.clearAllSessions();\n  } catch (error) {\n    logger.debug(`[StateMachine] Failed to cleanup sessions: ${error}`);\n  }\n\n  return result;\n}\n","/**\n * Generic scheduler for executing scheduled workflows\n * Uses node-cron for recurring schedules and setTimeout for one-time schedules\n *\n * This scheduler is frontend-agnostic. When a schedule fires, it runs a visor workflow.\n * Output handling (Slack, GitHub, webhooks) is delegated to output adapters.\n */\nimport cron from 'node-cron';\nimport { ScheduleStore, Schedule, ScheduleLimits, ScheduleStoreConfig } from './schedule-store';\nimport { getNextRunTime } from './schedule-parser';\nimport { logger } from '../logger';\nimport type { VisorConfig, StaticCronJob } from '../types/config';\nimport { StateMachineExecutionEngine } from '../state-machine-execution-engine';\nimport type { StorageConfig, HAConfig, ScheduleStoreStats } from './store/types';\n\n/**\n * Context enricher interface for frontend-specific functionality\n * This allows frontends (Slack, GitHub, etc.) to inject their specific context\n * without polluting the generic scheduler.\n */\nexport interface ScheduleContextEnricher {\n  /**\n   * Enrich the schedule context before execution\n   * @returns Additional context to merge into the synthetic payload\n   */\n  enrichContext?(schedule: Schedule): Promise<{\n    threadMessages?: Array<{ user: string; text: string }>;\n    additionalPayload?: Record<string, unknown>;\n  }>;\n\n  /**\n   * Prepare the execution environment before running the workflow\n   * @param schedule The schedule being executed\n   * @param reminderText The reminder text (for simple reminders)\n   */\n  prepareExecution?(schedule: Schedule, reminderText: string): Promise<void>;\n\n  /**\n   * Get the webhook endpoint for this frontend\n   */\n  getWebhookEndpoint?(): string;\n}\n\n/**\n * Output adapter interface for sending schedule results to different destinations\n */\nexport interface ScheduleOutputAdapter {\n  /** Adapter type identifier */\n  type: 'slack' | 'github' | 'webhook' | 'none';\n\n  /**\n   * Send schedule execution result to the destination\n   * @param schedule The schedule that was executed\n   * @param result The execution result (success/failure + output)\n   */\n  sendResult(schedule: Schedule, result: ScheduleExecutionResult): Promise<void>;\n}\n\n/**\n * Result of schedule execution\n */\nexport interface ScheduleExecutionResult {\n  success: boolean;\n  output?: unknown;\n  error?: string;\n  executionTimeMs: number;\n}\n\n/**\n * Configuration for the scheduler\n */\nexport interface SchedulerConfig {\n  /** Enable/disable the scheduler (default: true) */\n  enabled?: boolean;\n  /** Path to the schedules storage file */\n  storagePath?: string;\n  /** Check interval for due schedules in ms (default: 60000 - 1 minute) */\n  checkIntervalMs?: number;\n  /** Limits for schedules */\n  limits?: ScheduleLimits;\n  /** Default timezone for schedules (default: UTC) */\n  defaultTimezone?: string;\n  /** SQL storage configuration */\n  storage?: StorageConfig;\n  /** High-availability configuration */\n  ha?: HAConfig;\n}\n\n/**\n * Generic scheduler that manages schedule execution\n */\nexport class Scheduler {\n  private store: ScheduleStore;\n  private visorConfig: VisorConfig;\n  private checkIntervalMs: number;\n  private defaultTimezone: string;\n  private checkInterval: NodeJS.Timeout | null = null;\n  private cronJobs: Map<string, cron.ScheduledTask> = new Map();\n  private oneTimeTimeouts: Map<string, NodeJS.Timeout> = new Map();\n  private running = false;\n  private engine?: StateMachineExecutionEngine;\n  private outputAdapters: Map<string, ScheduleOutputAdapter> = new Map();\n  private executionContext: Record<string, unknown> = {};\n  private contextEnricher?: ScheduleContextEnricher;\n\n  // HA fields\n  private haConfig?: HAConfig;\n  private nodeId: string;\n  private heartbeatInterval: NodeJS.Timeout | null = null;\n  private heldLocks: Map<string, string> = new Map(); // scheduleId â†’ lockToken\n\n  constructor(visorConfig: VisorConfig, config?: SchedulerConfig) {\n    this.visorConfig = visorConfig;\n    this.checkIntervalMs = config?.checkIntervalMs ?? 60000;\n    this.defaultTimezone = config?.defaultTimezone ?? 'UTC';\n    this.haConfig = config?.ha;\n    this.nodeId = config?.ha?.node_id || `${require('os').hostname()}-${process.pid}`;\n\n    // Initialize store with SQL backend config\n    const storeConfig: ScheduleStoreConfig = {\n      path: config?.storagePath,\n      storage: config?.storage,\n      ha: config?.ha,\n    };\n    this.store = ScheduleStore.getInstance(storeConfig, config?.limits);\n  }\n\n  /**\n   * Set the execution engine (called after construction to avoid circular deps)\n   */\n  setEngine(engine: StateMachineExecutionEngine): void {\n    this.engine = engine;\n  }\n\n  /**\n   * Set the execution context (e.g., Slack client) for workflow executions\n   */\n  setExecutionContext(context: Record<string, unknown>): void {\n    this.executionContext = { ...this.executionContext, ...context };\n  }\n\n  /**\n   * Register an output adapter for a specific type\n   */\n  registerOutputAdapter(adapter: ScheduleOutputAdapter): void {\n    this.outputAdapters.set(adapter.type, adapter);\n    logger.debug(`[Scheduler] Registered output adapter: ${adapter.type}`);\n  }\n\n  /**\n   * Register a context enricher for frontend-specific functionality\n   * This allows frontends to inject thread history, prompt state, etc.\n   */\n  registerContextEnricher(enricher: ScheduleContextEnricher): void {\n    this.contextEnricher = enricher;\n    logger.debug('[Scheduler] Registered context enricher');\n  }\n\n  /**\n   * Get the schedule store instance\n   */\n  getStore(): ScheduleStore {\n    return this.store;\n  }\n\n  /**\n   * Start the scheduler\n   */\n  async start(): Promise<void> {\n    if (this.running) {\n      logger.warn('[Scheduler] Already running');\n      return;\n    }\n\n    // Initialize store\n    await this.store.initialize();\n\n    // Load static cron jobs from config (always executed, no permissions check)\n    try {\n      await this.loadStaticCronJobs();\n    } catch (err) {\n      logger.error(\n        `[Scheduler] Failed to load static cron jobs: ${err instanceof Error ? err.message : err}`\n      );\n    }\n\n    // Restore dynamic schedules from storage\n    try {\n      await this.restoreSchedules();\n    } catch (err) {\n      logger.error(\n        `[Scheduler] Failed to restore schedules: ${err instanceof Error ? err.message : err}`\n      );\n    }\n\n    // Start periodic check for due schedules\n    this.checkInterval = setInterval(() => {\n      this.checkDueSchedules().catch(error => {\n        logger.error(\n          `[Scheduler] Error checking due schedules: ${\n            error instanceof Error ? error.message : 'Unknown error'\n          }`\n        );\n      });\n    }, this.checkIntervalMs);\n\n    // Start heartbeat for HA lock renewal\n    if (this.haConfig?.enabled) {\n      this.startHeartbeat();\n    }\n\n    this.running = true;\n    logger.info('[Scheduler] Started');\n  }\n\n  /**\n   * Load and schedule static cron jobs from visor config\n   * These are defined in scheduler.cron section and always run regardless of permissions\n   */\n  private async loadStaticCronJobs(): Promise<void> {\n    const schedulerCfg = this.visorConfig.scheduler;\n    if (!schedulerCfg?.cron) {\n      return;\n    }\n\n    const cronJobs = schedulerCfg.cron as Record<string, StaticCronJob>;\n    let loadedCount = 0;\n\n    for (const [jobId, job] of Object.entries(cronJobs) as [string, StaticCronJob][]) {\n      if (job.enabled === false) {\n        logger.debug(`[Scheduler] Static cron job '${jobId}' is disabled, skipping`);\n        continue;\n      }\n\n      try {\n        await this.scheduleStaticCronJob(jobId, job);\n        loadedCount++;\n      } catch (error) {\n        logger.error(\n          `[Scheduler] Failed to load static cron job '${jobId}': ${\n            error instanceof Error ? error.message : 'Unknown error'\n          }`\n        );\n      }\n    }\n\n    if (loadedCount > 0) {\n      logger.info(`[Scheduler] Loaded ${loadedCount} static cron job(s) from config`);\n    }\n  }\n\n  /**\n   * Schedule a static cron job from config\n   */\n  private async scheduleStaticCronJob(jobId: string, job: StaticCronJob): Promise<void> {\n    // Validate cron expression\n    if (!cron.validate(job.schedule)) {\n      throw new Error(`Invalid cron expression: ${job.schedule}`);\n    }\n\n    // Check if workflow exists\n    const allChecks = Object.keys(this.visorConfig.checks || {});\n    if (!allChecks.includes(job.workflow)) {\n      throw new Error(`Workflow \"${job.workflow}\" not found in configuration`);\n    }\n\n    // Use a special ID prefix to distinguish static jobs from dynamic ones\n    const internalId = `__static_cron__:${jobId}`;\n\n    // Create cron job\n    const cronJob = cron.schedule(\n      job.schedule,\n      async () => {\n        logger.info(`[Scheduler] Executing static cron job '${jobId}': workflow=\"${job.workflow}\"`);\n        await this.executeStaticCronJob(jobId, job);\n      },\n      {\n        scheduled: true,\n        timezone: job.timezone || this.defaultTimezone,\n      }\n    );\n\n    this.cronJobs.set(internalId, cronJob);\n\n    // Compute next run time for logging\n    try {\n      const nextRun = getNextRunTime(job.schedule, job.timezone || this.defaultTimezone);\n      const description = job.description ? ` (${job.description})` : '';\n      logger.debug(\n        `[Scheduler] Scheduled static cron job '${jobId}'${description}: ${job.schedule} â†’ ${job.workflow}, next run: ${nextRun.toISOString()}`\n      );\n    } catch {\n      // Best effort logging\n    }\n  }\n\n  /**\n   * Execute a static cron job\n   */\n  private async executeStaticCronJob(jobId: string, job: StaticCronJob): Promise<void> {\n    if (this.haConfig?.enabled) {\n      // HA mode: acquire distributed lock to prevent duplicate execution across nodes\n      const ttl = this.haConfig.lock_ttl ?? 60;\n      const backend = this.store.getBackend();\n      const lockId = `__static_cron__:${jobId}`;\n      const lockToken = await backend.tryAcquireLock(lockId, this.nodeId, ttl);\n      if (!lockToken) {\n        logger.debug(`[Scheduler] Static cron job '${jobId}' locked by another node, skipping`);\n        return;\n      }\n      // Register in heldLocks so the heartbeat timer renews this lock\n      // during long-running jobs (prevents TTL expiration & duplicate execution)\n      this.heldLocks.set(lockId, lockToken);\n      try {\n        await this.doExecuteStaticCronJob(jobId, job);\n      } finally {\n        await backend.releaseLock(lockId, lockToken);\n        this.heldLocks.delete(lockId);\n      }\n    } else {\n      await this.doExecuteStaticCronJob(jobId, job);\n    }\n  }\n\n  /**\n   * Internal: execute a static cron job (after lock is held in HA mode)\n   */\n  private async doExecuteStaticCronJob(jobId: string, job: StaticCronJob): Promise<void> {\n    const startTime = Date.now();\n    let result: ScheduleExecutionResult;\n\n    // Build a synthetic schedule object for output adapters\n    const syntheticSchedule: Schedule = {\n      id: `__static_cron__:${jobId}`,\n      creatorId: 'system',\n      creatorContext: 'config',\n      timezone: job.timezone || this.defaultTimezone,\n      schedule: job.schedule,\n      isRecurring: true,\n      originalExpression: job.schedule,\n      workflow: job.workflow,\n      workflowInputs: job.inputs,\n      outputContext: job.output\n        ? {\n            type: job.output.type,\n            target: job.output.target,\n            threadId: job.output.thread_id,\n          }\n        : undefined,\n      status: 'active',\n      createdAt: 0,\n      runCount: 0,\n      failureCount: 0,\n    };\n\n    try {\n      // Execute the workflow\n      const output = await this.executeWorkflow(syntheticSchedule);\n\n      result = {\n        success: true,\n        output,\n        executionTimeMs: Date.now() - startTime,\n      };\n\n      logger.info(\n        `[Scheduler] Static cron job '${jobId}' completed in ${result.executionTimeMs}ms`\n      );\n    } catch (error) {\n      const errorMsg = error instanceof Error ? error.message : 'Unknown error';\n\n      result = {\n        success: false,\n        error: errorMsg,\n        executionTimeMs: Date.now() - startTime,\n      };\n\n      logger.error(`[Scheduler] Static cron job '${jobId}' failed: ${errorMsg}`);\n    }\n\n    // Send result to output adapter if configured\n    await this.sendResult(syntheticSchedule, result);\n  }\n\n  /**\n   * Stop the scheduler\n   */\n  async stop(): Promise<void> {\n    if (!this.running) {\n      return;\n    }\n\n    // Stop heartbeat\n    this.stopHeartbeat();\n\n    // Release all held locks\n    if (this.heldLocks.size > 0) {\n      const backend = this.store.getBackend();\n      for (const [scheduleId, lockToken] of this.heldLocks.entries()) {\n        await backend.releaseLock(scheduleId, lockToken).catch(() => {});\n      }\n      this.heldLocks.clear();\n    }\n\n    // Stop the check interval\n    if (this.checkInterval) {\n      clearInterval(this.checkInterval);\n      this.checkInterval = null;\n    }\n\n    // Stop all cron jobs\n    for (const [id, job] of this.cronJobs.entries()) {\n      job.stop();\n      logger.debug(`[Scheduler] Stopped cron job for schedule ${id}`);\n    }\n    this.cronJobs.clear();\n\n    // Clear all one-time timeouts\n    for (const [id, timeout] of this.oneTimeTimeouts.entries()) {\n      clearTimeout(timeout);\n      logger.debug(`[Scheduler] Cleared timeout for schedule ${id}`);\n    }\n    this.oneTimeTimeouts.clear();\n\n    // Flush store to ensure all changes are persisted\n    await this.store.flush();\n\n    this.running = false;\n    logger.info('[Scheduler] Stopped');\n  }\n\n  /**\n   * Start the heartbeat timer for renewing HA locks\n   */\n  private startHeartbeat(): void {\n    if (this.heartbeatInterval) return;\n\n    const intervalMs = (this.haConfig?.heartbeat_interval ?? 15) * 1000;\n\n    this.heartbeatInterval = setInterval(async () => {\n      const backend = this.store.getBackend();\n      const ttl = this.haConfig?.lock_ttl ?? 60;\n\n      for (const [scheduleId, lockToken] of this.heldLocks.entries()) {\n        const renewed = await backend.renewLock(scheduleId, lockToken, ttl);\n        if (!renewed) {\n          logger.warn(`[Scheduler] Failed to renew lock for schedule ${scheduleId}, lock lost`);\n          this.heldLocks.delete(scheduleId);\n        }\n      }\n    }, intervalMs);\n\n    logger.debug(`[Scheduler] Heartbeat started (interval: ${intervalMs}ms)`);\n  }\n\n  /**\n   * Stop the heartbeat timer\n   */\n  private stopHeartbeat(): void {\n    if (this.heartbeatInterval) {\n      clearInterval(this.heartbeatInterval);\n      this.heartbeatInterval = null;\n    }\n  }\n\n  /**\n   * Restore schedules from persistent storage\n   */\n  private async restoreSchedules(): Promise<void> {\n    const activeSchedules = await this.store.getActiveSchedulesAsync();\n    logger.info(`[Scheduler] Restoring ${activeSchedules.length} active schedules`);\n\n    for (const schedule of activeSchedules) {\n      try {\n        await this.scheduleExecution(schedule);\n      } catch (error) {\n        logger.error(\n          `[Scheduler] Failed to restore schedule ${schedule.id}: ${\n            error instanceof Error ? error.message : 'Unknown error'\n          }`\n        );\n      }\n    }\n  }\n\n  /**\n   * Schedule a workflow for execution\n   */\n  private async scheduleExecution(schedule: Schedule): Promise<void> {\n    if (schedule.isRecurring) {\n      await this.scheduleRecurring(schedule);\n    } else {\n      await this.scheduleOneTime(schedule);\n    }\n  }\n\n  /**\n   * Schedule a recurring workflow using cron\n   */\n  private async scheduleRecurring(schedule: Schedule): Promise<void> {\n    // Validate cron expression BEFORE stopping any existing job\n    // This ensures we don't break a working schedule when given an invalid update\n    if (!cron.validate(schedule.schedule)) {\n      logger.error(\n        `[Scheduler] Invalid cron expression for schedule ${schedule.id}: ${schedule.schedule}`\n      );\n      // Stop and remove any existing job before marking as failed\n      const existingJob = this.cronJobs.get(schedule.id);\n      if (existingJob) {\n        existingJob.stop();\n        this.cronJobs.delete(schedule.id);\n      }\n      await this.store.updateAsync(schedule.id, {\n        status: 'failed',\n        lastError: 'Invalid cron expression',\n      });\n      return;\n    }\n\n    // Stop existing job if any (only after validation passes)\n    const existingJob = this.cronJobs.get(schedule.id);\n    if (existingJob) {\n      existingJob.stop();\n    }\n\n    // Create cron job\n    const job = cron.schedule(\n      schedule.schedule,\n      async () => {\n        await this.executeSchedule(schedule);\n      },\n      {\n        scheduled: true,\n        timezone: schedule.timezone || this.defaultTimezone,\n      }\n    );\n\n    this.cronJobs.set(schedule.id, job);\n\n    // Update next run time\n    try {\n      const nextRun = getNextRunTime(schedule.schedule, schedule.timezone);\n      await this.store.updateAsync(schedule.id, { nextRunAt: nextRun.getTime() });\n    } catch (error) {\n      logger.warn(\n        `[Scheduler] Could not compute next run time for ${schedule.id}: ${\n          error instanceof Error ? error.message : 'Unknown error'\n        }`\n      );\n    }\n\n    logger.debug(`[Scheduler] Scheduled recurring execution ${schedule.id}: ${schedule.schedule}`);\n  }\n\n  /**\n   * Schedule a one-time workflow using setTimeout\n   */\n  private async scheduleOneTime(schedule: Schedule): Promise<void> {\n    // Clear existing timeout if any\n    const existingTimeout = this.oneTimeTimeouts.get(schedule.id);\n    if (existingTimeout) {\n      clearTimeout(existingTimeout);\n    }\n\n    if (!schedule.runAt) {\n      logger.error(`[Scheduler] One-time schedule ${schedule.id} has no runAt time`);\n      return;\n    }\n\n    const delayMs = schedule.runAt - Date.now();\n\n    // If already past due, execute immediately\n    if (delayMs <= 0) {\n      await this.executeSchedule(schedule);\n      return;\n    }\n\n    // Schedule for future execution\n    const timeout = setTimeout(async () => {\n      this.oneTimeTimeouts.delete(schedule.id);\n      await this.executeSchedule(schedule);\n    }, delayMs);\n\n    this.oneTimeTimeouts.set(schedule.id, timeout);\n\n    logger.debug(\n      `[Scheduler] Scheduled one-time execution ${schedule.id} for ${new Date(schedule.runAt).toISOString()}`\n    );\n  }\n\n  /**\n   * Check for and execute due schedules\n   */\n  private async checkDueSchedules(): Promise<void> {\n    const dueSchedules = await this.store.getDueSchedulesAsync();\n\n    for (const schedule of dueSchedules) {\n      // Skip if already scheduled\n      if (this.cronJobs.has(schedule.id) || this.oneTimeTimeouts.has(schedule.id)) {\n        continue;\n      }\n\n      if (this.haConfig?.enabled) {\n        // HA mode: acquire lock before executing\n        const ttl = this.haConfig.lock_ttl ?? 60;\n        const backend = this.store.getBackend();\n        const lockToken = await backend.tryAcquireLock(schedule.id, this.nodeId, ttl);\n        if (!lockToken) {\n          logger.debug(`[Scheduler] Schedule ${schedule.id} locked by another node, skipping`);\n          continue;\n        }\n        this.heldLocks.set(schedule.id, lockToken);\n        try {\n          await this.executeSchedule(schedule);\n        } finally {\n          await backend.releaseLock(schedule.id, lockToken);\n          this.heldLocks.delete(schedule.id);\n        }\n      } else {\n        await this.executeSchedule(schedule);\n      }\n    }\n  }\n\n  /**\n   * Execute a scheduled workflow\n   */\n  private async executeSchedule(schedule: Schedule): Promise<void> {\n    const description = schedule.workflow || 'reminder';\n    logger.info(`[Scheduler] Executing schedule ${schedule.id}: ${description}`);\n\n    const startTime = Date.now();\n    let result: ScheduleExecutionResult;\n\n    try {\n      // Execute the workflow\n      const output = await this.executeWorkflow(schedule);\n\n      result = {\n        success: true,\n        output,\n        executionTimeMs: Date.now() - startTime,\n      };\n\n      // Update schedule state\n      const now = Date.now();\n      await this.store.updateAsync(schedule.id, {\n        lastRunAt: now,\n        runCount: schedule.runCount + 1,\n        failureCount: 0, // Reset on success\n        lastError: undefined,\n      });\n\n      // For one-time schedules, mark as completed\n      if (!schedule.isRecurring) {\n        await this.store.updateAsync(schedule.id, { status: 'completed' });\n        await this.store.deleteAsync(schedule.id); // Clean up\n        logger.info(`[Scheduler] One-time schedule ${schedule.id} completed and removed`);\n      } else {\n        // Update next run time for recurring schedules\n        try {\n          const nextRun = getNextRunTime(schedule.schedule, schedule.timezone);\n          await this.store.updateAsync(schedule.id, { nextRunAt: nextRun.getTime() });\n        } catch (err) {\n          // If we can't compute next run, pause the schedule to prevent duplicate execution\n          logger.warn(\n            `[Scheduler] Failed to compute next run time for ${schedule.id}, pausing schedule: ${err instanceof Error ? err.message : err}`\n          );\n          await this.store.updateAsync(schedule.id, {\n            status: 'paused',\n            lastError: `Failed to compute next run time: ${err instanceof Error ? err.message : err}`,\n          });\n        }\n      }\n    } catch (error) {\n      const errorMsg = error instanceof Error ? error.message : 'Unknown error';\n\n      result = {\n        success: false,\n        error: errorMsg,\n        executionTimeMs: Date.now() - startTime,\n      };\n\n      await this.handleScheduleFailure(schedule, error);\n    }\n\n    // Send result to output adapter if configured\n    await this.sendResult(schedule, result);\n  }\n\n  /**\n   * Helper to prepare execution environment - reduces duplication between workflow and reminder execution\n   */\n  private prepareExecution(\n    schedule: Schedule,\n    cliMessage?: string\n  ): {\n    engine: StateMachineExecutionEngine;\n    config: VisorConfig;\n    responseRef: { captured?: string };\n  } {\n    // Clone config for this run\n    const config: VisorConfig = JSON.parse(JSON.stringify(this.visorConfig));\n\n    // Ensure appropriate frontends are present\n    // For simple reminders (cliMessage set), always ensure Slack frontend is available\n    // as the visor pipeline uses it to post AI responses\n    const fronts = Array.isArray(config.frontends) ? config.frontends : [];\n    const hasSlackFrontend = fronts.some((f: any) => f && f.name === 'slack');\n    if (!hasSlackFrontend && (cliMessage || schedule.outputContext?.type === 'slack')) {\n      fronts.push({ name: 'slack' });\n    }\n    config.frontends = fronts;\n\n    // Create a new engine instance\n    const engine = new StateMachineExecutionEngine();\n\n    // Set up response capture for recurring reminders\n    const responseRef: { captured?: string } = {};\n    const responseCapture = (text: string) => {\n      responseRef.captured = text;\n      logger.debug(\n        `[Scheduler] Captured AI response for schedule ${schedule.id} (${text.length} chars)`\n      );\n    };\n\n    // Set execution context\n    engine.setExecutionContext({\n      ...this.executionContext,\n      cliMessage,\n      responseCapture,\n    });\n\n    return { engine, config, responseRef };\n  }\n\n  /**\n   * Execute the workflow for a schedule\n   */\n  private async executeWorkflow(schedule: Schedule): Promise<unknown> {\n    // Handle simple reminders (no workflow set) - run through default chat workflow\n    if (!schedule.workflow) {\n      return this.executeSimpleReminder(schedule);\n    }\n\n    if (!this.engine) {\n      logger.warn('[Scheduler] No execution engine set, skipping workflow execution');\n      return { message: 'No execution engine configured' };\n    }\n\n    // Check if the workflow exists\n    const allChecks = Object.keys(this.visorConfig.checks || {});\n    if (!allChecks.includes(schedule.workflow)) {\n      throw new Error(`Workflow \"${schedule.workflow}\" not found in configuration`);\n    }\n\n    // Build synthetic webhook context for the schedule\n    const syntheticPayload = {\n      event: {\n        type: 'schedule_triggered',\n        schedule_id: schedule.id,\n        workflow: schedule.workflow,\n        creator_id: schedule.creatorId,\n        creator_context: schedule.creatorContext,\n        timestamp: Date.now(),\n      },\n      schedule: {\n        id: schedule.id,\n        workflow: schedule.workflow,\n        workflowInputs: schedule.workflowInputs,\n        isRecurring: schedule.isRecurring,\n        outputContext: schedule.outputContext,\n      },\n    };\n\n    // Create webhook context map\n    const webhookData = new Map<string, unknown>();\n    const endpoint = '/scheduler/trigger';\n    webhookData.set(endpoint, syntheticPayload);\n\n    // Use common preparation helper\n    const { engine: runEngine, config: cfgForRun } = this.prepareExecution(schedule);\n\n    // Execute the workflow\n    await runEngine.executeChecks({\n      checks: [schedule.workflow],\n      showDetails: true,\n      outputFormat: 'json',\n      config: cfgForRun,\n      webhookContext: { webhookData, eventType: 'schedule' },\n      debug: process.env.VISOR_DEBUG === 'true',\n      inputs: schedule.workflowInputs,\n    } as any);\n\n    return { message: 'Workflow completed', workflow: schedule.workflow };\n  }\n\n  /**\n   * Execute a simple reminder by running it through the visor pipeline\n   * Treats the reminder text as if the user sent it as a message\n   */\n  private async executeSimpleReminder(schedule: Schedule): Promise<unknown> {\n    const reminderText = schedule.workflowInputs?.text as string;\n    if (!reminderText) {\n      return { message: 'Reminder!', type: 'simple_reminder' };\n    }\n\n    // Get all checks from config\n    const allChecks = Object.keys(this.visorConfig.checks || {});\n    if (allChecks.length === 0) {\n      logger.warn('[Scheduler] No checks configured, returning reminder text directly');\n      return { message: reminderText, type: 'simple_reminder' };\n    }\n\n    logger.info(`[Scheduler] Running reminder through visor pipeline (${allChecks.length} checks)`);\n\n    // Use context enricher to get thread history and other frontend-specific data\n    const channel = schedule.outputContext?.target || '';\n    const threadId = schedule.outputContext?.threadId;\n    let threadMessages: Array<{ user: string; text: string }> = [];\n    let additionalPayload: Record<string, unknown> = {};\n\n    if (this.contextEnricher?.enrichContext) {\n      try {\n        const enriched = await this.contextEnricher.enrichContext(schedule);\n        threadMessages = enriched.threadMessages || [];\n        additionalPayload = enriched.additionalPayload || {};\n        if (threadMessages.length > 0) {\n          logger.debug(\n            `[Scheduler] Context enricher provided ${threadMessages.length} thread messages`\n          );\n        }\n      } catch (error) {\n        logger.warn(\n          `[Scheduler] Context enrichment failed: ${error instanceof Error ? error.message : error}`\n        );\n      }\n    }\n\n    // Build context message that includes previous response if available\n    let contextualReminderText = reminderText;\n    if (schedule.isRecurring && schedule.previousResponse) {\n      contextualReminderText = `${reminderText}\n\n---\n**Previous Response (for context):**\n${schedule.previousResponse}\n---\n\nPlease provide an updated response based on the reminder above. You may reference or build upon the previous response if relevant.`;\n    }\n\n    // Build synthetic event payload\n    // Keep slack_conversation for backward compatibility with existing checks\n    const conversationData = {\n      current: {\n        user: schedule.creatorName || schedule.creatorId,\n        text: contextualReminderText,\n      },\n      messages:\n        threadMessages.length > 0\n          ? [\n              ...threadMessages,\n              { user: schedule.creatorName || schedule.creatorId, text: contextualReminderText },\n            ]\n          : [{ user: schedule.creatorName || schedule.creatorId, text: contextualReminderText }],\n    };\n\n    const syntheticPayload = {\n      event: {\n        type: 'message',\n        subtype: 'scheduled_reminder',\n        text: contextualReminderText,\n        user: schedule.creatorId,\n        channel: channel,\n        ts: String(Date.now() / 1000),\n        thread_ts: threadId,\n      },\n      // Include both for compatibility (slack_conversation for existing checks, conversation for generic)\n      slack_conversation: conversationData,\n      conversation: conversationData,\n      // Include schedule context for any checks that need it\n      schedule: {\n        id: schedule.id,\n        isReminder: true,\n        creatorId: schedule.creatorId,\n        creatorContext: schedule.creatorContext,\n        previousResponse: schedule.previousResponse,\n      },\n      // Merge any additional frontend-specific payload\n      ...additionalPayload,\n    };\n\n    // Get webhook endpoint from enricher or use Slack config or default\n    const endpoint =\n      this.contextEnricher?.getWebhookEndpoint?.() ||\n      (this.visorConfig as any).slack?.endpoint ||\n      '/bots/slack/support';\n\n    // Create webhook context map\n    const webhookData = new Map<string, unknown>();\n    webhookData.set(endpoint, syntheticPayload);\n\n    // Allow context enricher to prepare execution environment (e.g., seed prompt state)\n    if (this.contextEnricher?.prepareExecution) {\n      try {\n        await this.contextEnricher.prepareExecution(schedule, reminderText);\n      } catch (error) {\n        logger.warn(\n          `[Scheduler] Execution preparation failed: ${\n            error instanceof Error ? error.message : error\n          }`\n        );\n      }\n    }\n\n    // Use common execution helper\n    const {\n      engine: runEngine,\n      config: cfgForRun,\n      responseRef,\n    } = this.prepareExecution(schedule, reminderText);\n\n    try {\n      // Execute ALL checks - let the visor engine route based on config\n      await runEngine.executeChecks({\n        checks: allChecks,\n        showDetails: true,\n        outputFormat: 'json',\n        config: cfgForRun,\n        webhookContext: { webhookData, eventType: 'schedule' },\n        debug: process.env.VISOR_DEBUG === 'true',\n      } as any);\n\n      // The visor pipeline handles output via frontends (Slack, etc.)\n      // We return success - the actual response was posted by the pipeline\n\n      // Save captured response for recurring reminders (previousResponse feature)\n      if (schedule.isRecurring && responseRef.captured) {\n        await this.store.updateAsync(schedule.id, { previousResponse: responseRef.captured });\n        logger.info(\n          `[Scheduler] Saved previousResponse for recurring schedule ${schedule.id} (${responseRef.captured.length} chars)`\n        );\n      }\n\n      return {\n        message: 'Reminder processed through pipeline',\n        type: 'pipeline_executed',\n        reminderText,\n        capturedResponse: responseRef.captured,\n      };\n    } catch (error) {\n      logger.error(\n        `[Scheduler] Failed to run reminder through pipeline: ${error instanceof Error ? error.message : error}`\n      );\n      // Fallback to just returning the reminder text for posting\n      return { message: reminderText, type: 'simple_reminder' };\n    }\n  }\n\n  /**\n   * Handle schedule execution failure\n   */\n  private async handleScheduleFailure(schedule: Schedule, error: unknown): Promise<void> {\n    const errorMsg = error instanceof Error ? error.message : 'Unknown error';\n    logger.error(`[Scheduler] Schedule ${schedule.id} failed: ${errorMsg}`);\n\n    const newFailureCount = schedule.failureCount + 1;\n\n    // Update failure count\n    await this.store.updateAsync(schedule.id, {\n      failureCount: newFailureCount,\n      lastError: errorMsg,\n    });\n\n    // Auto-pause after 3 consecutive failures\n    if (newFailureCount >= 3) {\n      await this.store.updateAsync(schedule.id, { status: 'failed' });\n\n      // Stop the cron job\n      const job = this.cronJobs.get(schedule.id);\n      if (job) {\n        job.stop();\n        this.cronJobs.delete(schedule.id);\n      }\n\n      logger.warn(`[Scheduler] Schedule ${schedule.id} paused after 3 consecutive failures`);\n    }\n  }\n\n  /**\n   * Send execution result to the appropriate output adapter\n   */\n  private async sendResult(schedule: Schedule, result: ScheduleExecutionResult): Promise<void> {\n    const outputType = schedule.outputContext?.type || 'none';\n\n    // Get the appropriate adapter\n    const adapter = this.outputAdapters.get(outputType);\n    if (!adapter) {\n      if (outputType !== 'none') {\n        logger.warn(`[Scheduler] No output adapter registered for type: ${outputType}`);\n      }\n      return;\n    }\n\n    try {\n      await adapter.sendResult(schedule, result);\n    } catch (error) {\n      logger.error(\n        `[Scheduler] Failed to send result via ${outputType} adapter: ${\n          error instanceof Error ? error.message : 'Unknown error'\n        }`\n      );\n    }\n  }\n\n  /**\n   * Check if scheduler is running\n   */\n  isRunning(): boolean {\n    return this.running;\n  }\n\n  /**\n   * Get scheduler stats\n   */\n  async getStats(): Promise<{\n    running: boolean;\n    activeCronJobs: number;\n    pendingOneTimeSchedules: number;\n    storeStats: ScheduleStoreStats;\n  }> {\n    return {\n      running: this.running,\n      activeCronJobs: this.cronJobs.size,\n      pendingOneTimeSchedules: this.oneTimeTimeouts.size,\n      storeStats: await this.store.getStatsAsync(),\n    };\n  }\n}\n\n// Singleton instance\nlet schedulerInstance: Scheduler | undefined;\n\n/**\n * Get the singleton scheduler instance\n */\nexport function getScheduler(\n  visorConfig?: VisorConfig,\n  config?: SchedulerConfig\n): Scheduler | undefined {\n  if (!schedulerInstance && visorConfig) {\n    schedulerInstance = new Scheduler(visorConfig, config);\n  }\n  return schedulerInstance;\n}\n\n/**\n * Reset the scheduler instance (for testing)\n */\nexport function resetScheduler(): void {\n  if (schedulerInstance) {\n    schedulerInstance.stop().catch(() => {});\n  }\n  schedulerInstance = undefined;\n}\n","/**\n * CLI command handlers for the scheduler\n *\n * Commands:\n *   visor schedule start [--config path]    - Run scheduler daemon\n *   visor schedule list                     - Show active schedules\n *   visor schedule create <workflow> --at \"time\" [--output slack:#channel]\n *   visor schedule cancel <id>              - Cancel a schedule\n */\nimport { ScheduleStore, ScheduleOutputContext } from './schedule-store';\nimport { Scheduler } from './scheduler';\nimport { parseScheduleExpression, getNextRunTime } from './schedule-parser';\nimport { configureLoggerFromCli } from '../logger';\nimport { ConfigManager } from '../config';\nimport { StateMachineExecutionEngine } from '../state-machine-execution-engine';\nimport type { VisorConfig, SchedulerConfig as VisorSchedulerConfig } from '../types/config';\n\n/**\n * Parse CLI arguments for schedule commands\n */\nfunction parseArgs(argv: string[]): {\n  subcommand: string;\n  positional: string[];\n  flags: Record<string, string | boolean>;\n} {\n  const subcommand = argv[0] || 'help';\n  const positional: string[] = [];\n  const flags: Record<string, string | boolean> = {};\n\n  for (let i = 1; i < argv.length; i++) {\n    const arg = argv[i];\n    if (arg.startsWith('--')) {\n      const key = arg.slice(2);\n      const next = argv[i + 1];\n      if (next && !next.startsWith('--')) {\n        flags[key] = next;\n        i++;\n      } else {\n        flags[key] = true;\n      }\n    } else if (!arg.startsWith('-')) {\n      positional.push(arg);\n    }\n  }\n\n  return { subcommand, positional, flags };\n}\n\n/**\n * Handle the schedule subcommand\n */\nexport async function handleScheduleCommand(\n  argv: string[],\n  configManager: ConfigManager\n): Promise<void> {\n  const { subcommand, positional, flags } = parseArgs(argv);\n\n  // Configure logger\n  configureLoggerFromCli({\n    output: 'table',\n    debug: flags.debug === true || process.env.VISOR_DEBUG === 'true',\n    verbose: flags.verbose === true,\n    quiet: flags.quiet === true,\n  });\n\n  switch (subcommand) {\n    case 'start':\n      await handleStart(flags, configManager);\n      break;\n    case 'list':\n      await handleList(flags);\n      break;\n    case 'create':\n      await handleCreate(positional, flags);\n      break;\n    case 'cancel':\n      await handleCancel(positional, flags);\n      break;\n    case 'pause':\n      await handlePause(positional, flags);\n      break;\n    case 'resume':\n      await handleResume(positional, flags);\n      break;\n    case 'help':\n    default:\n      printHelp();\n      break;\n  }\n}\n\n/**\n * Print help text\n */\nfunction printHelp(): void {\n  console.log(`\nVisor Schedule - Manage scheduled workflow executions\n\nUSAGE:\n  visor schedule <command> [options]\n\nCOMMANDS:\n  start                Start the scheduler daemon\n  list                 List all active schedules\n  create <workflow>    Create a new schedule\n  cancel <id>          Cancel a schedule\n  pause <id>           Pause a schedule\n  resume <id>          Resume a paused schedule\n  help                 Show this help message\n\nOPTIONS:\n  --config <path>      Path to Visor configuration file\n  --at \"<time>\"        Schedule time (e.g., \"every Monday at 9am\", \"in 2 hours\")\n  --output <dest>      Output destination (e.g., \"slack:#channel\", \"webhook:url\")\n  --inputs <json>      JSON string of workflow inputs\n\nEXAMPLES:\n  # Start scheduler daemon\n  visor schedule start --config .visor.yaml\n\n  # Create a recurring schedule\n  visor schedule create daily-report --at \"every day at 9am\" --output slack:#reports\n\n  # Create a one-time schedule\n  visor schedule create security-scan --at \"in 2 hours\"\n\n  # List schedules\n  visor schedule list\n\n  # Cancel a schedule\n  visor schedule cancel abc12345\n`);\n}\n\n/**\n * Handle 'schedule start' - run the scheduler daemon\n */\nasync function handleStart(\n  flags: Record<string, string | boolean>,\n  configManager: ConfigManager\n): Promise<void> {\n  console.log('Starting Visor Scheduler...');\n\n  // Load configuration\n  const configPath = typeof flags.config === 'string' ? flags.config : undefined;\n  let config: VisorConfig;\n\n  try {\n    if (configPath) {\n      config = await configManager.loadConfig(configPath);\n    } else {\n      config = await configManager.findAndLoadConfig();\n    }\n  } catch (error) {\n    console.error(\n      `Failed to load configuration: ${error instanceof Error ? error.message : error}`\n    );\n    process.exit(1);\n  }\n\n  // Get scheduler config from visor config\n  const schedulerConfig = (config as any).scheduler as VisorSchedulerConfig | undefined;\n\n  // Check if scheduler is enabled\n  if (schedulerConfig?.enabled === false) {\n    console.error('Scheduler is disabled in configuration (scheduler.enabled: false)');\n    process.exit(1);\n  }\n\n  // Create scheduler with mapped limits and storage config\n  const scheduler = new Scheduler(config, {\n    storagePath: schedulerConfig?.storage?.path,\n    limits: schedulerConfig?.limits\n      ? {\n          maxPerUser: schedulerConfig.limits.max_per_user,\n          maxRecurringPerUser: schedulerConfig.limits.max_recurring_per_user,\n          maxGlobal: schedulerConfig.limits.max_global,\n        }\n      : undefined,\n    defaultTimezone: schedulerConfig?.default_timezone,\n    storage: schedulerConfig?.storage?.driver\n      ? {\n          driver: schedulerConfig.storage.driver,\n          connection: schedulerConfig.storage.connection,\n        }\n      : undefined,\n    ha: schedulerConfig?.ha\n      ? {\n          enabled: schedulerConfig.ha.enabled ?? false,\n          node_id: schedulerConfig.ha.node_id,\n          lock_ttl: schedulerConfig.ha.lock_ttl,\n          heartbeat_interval: schedulerConfig.ha.heartbeat_interval,\n        }\n      : undefined,\n  });\n\n  // Create and set execution engine\n  const engine = new StateMachineExecutionEngine();\n  scheduler.setEngine(engine);\n\n  // Start scheduler\n  try {\n    await scheduler.start();\n    console.log('Scheduler started successfully');\n    console.log(`Storage: ${schedulerConfig?.storage?.path || '.visor/schedules.json'}`);\n    console.log(`Timezone: ${schedulerConfig?.default_timezone || 'UTC'}`);\n\n    // Print stats\n    const stats = await scheduler.getStats();\n    console.log(`Active schedules: ${stats.storeStats.active}`);\n    console.log(`Recurring: ${stats.storeStats.recurring}, One-time: ${stats.storeStats.oneTime}`);\n\n    console.log('\\nPress Ctrl+C to stop\\n');\n\n    // Handle shutdown\n    const shutdown = async () => {\n      console.log('\\nShutting down scheduler...');\n      await scheduler.stop();\n      console.log('Scheduler stopped');\n      process.exit(0);\n    };\n\n    process.on('SIGINT', shutdown);\n    process.on('SIGTERM', shutdown);\n\n    // Keep process alive\n    process.stdin.resume();\n  } catch (error) {\n    console.error(`Failed to start scheduler: ${error instanceof Error ? error.message : error}`);\n    process.exit(1);\n  }\n}\n\n/**\n * Handle 'schedule list' - list all schedules\n */\nasync function handleList(flags: Record<string, string | boolean>): Promise<void> {\n  const store = ScheduleStore.getInstance({\n    path: typeof flags.config === 'string' ? undefined : '.visor/schedules.json',\n  });\n\n  await store.initialize();\n\n  const allSchedules = await store.getAllAsync();\n  const schedules = allSchedules.filter(s => s.status !== 'completed');\n\n  if (schedules.length === 0) {\n    console.log('No active schedules found.');\n    console.log('\\nTo create a schedule:');\n    console.log('  visor schedule create <workflow> --at \"every Monday at 9am\"');\n    return;\n  }\n\n  console.log(`Found ${schedules.length} schedule(s):\\n`);\n\n  for (const schedule of schedules) {\n    const when = schedule.isRecurring\n      ? schedule.originalExpression\n      : new Date(schedule.runAt!).toLocaleString();\n    const status = schedule.status !== 'active' ? ` [${schedule.status.toUpperCase()}]` : '';\n    const output = schedule.outputContext?.type\n      ? ` â†’ ${schedule.outputContext.type}${schedule.outputContext.target ? `:${schedule.outputContext.target}` : ''}`\n      : '';\n\n    console.log(`  ${schedule.id.substring(0, 8)}  ${schedule.workflow}`);\n    console.log(`           ${when}${output}${status}`);\n    if (schedule.nextRunAt) {\n      console.log(`           Next: ${new Date(schedule.nextRunAt).toLocaleString()}`);\n    }\n    console.log();\n  }\n}\n\n/**\n * Handle 'schedule create' - create a new schedule\n */\nasync function handleCreate(\n  positional: string[],\n  flags: Record<string, string | boolean>\n): Promise<void> {\n  const workflow = positional[0];\n  const expression = flags.at as string | undefined;\n\n  if (!workflow) {\n    console.error('Error: Workflow name is required');\n    console.log('Usage: visor schedule create <workflow> --at \"time\"');\n    process.exit(1);\n  }\n\n  if (!expression) {\n    console.error('Error: Schedule time is required');\n    console.log('Usage: visor schedule create <workflow> --at \"every Monday at 9am\"');\n    process.exit(1);\n  }\n\n  // Parse output destination\n  let outputContext: ScheduleOutputContext | undefined;\n  if (flags.output && typeof flags.output === 'string') {\n    const [type, target] = flags.output.split(':');\n    if (type === 'slack' || type === 'github' || type === 'webhook') {\n      outputContext = { type, target };\n    } else {\n      console.error(`Error: Unknown output type: ${type}`);\n      console.log('Supported types: slack, github, webhook');\n      process.exit(1);\n    }\n  }\n\n  // Parse inputs\n  let inputs: Record<string, unknown> | undefined;\n  if (flags.inputs && typeof flags.inputs === 'string') {\n    try {\n      inputs = JSON.parse(flags.inputs);\n    } catch {\n      console.error('Error: Invalid JSON for --inputs');\n      process.exit(1);\n    }\n  }\n\n  // Get timezone\n  const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone || 'UTC';\n\n  try {\n    // Parse the schedule expression\n    const parsed = parseScheduleExpression(expression, timezone);\n\n    // Initialize store\n    const store = ScheduleStore.getInstance();\n    await store.initialize();\n\n    // Create the schedule\n    const schedule = await store.createAsync({\n      creatorId: process.env.USER || 'cli-user',\n      creatorContext: 'cli',\n      timezone,\n      schedule: parsed.cronExpression || '',\n      runAt: parsed.type === 'one-time' ? parsed.runAt?.getTime() : undefined,\n      isRecurring: parsed.type === 'recurring',\n      originalExpression: expression,\n      workflow,\n      workflowInputs: inputs,\n      outputContext,\n      nextRunAt:\n        parsed.type === 'recurring' && parsed.cronExpression\n          ? getNextRunTime(parsed.cronExpression, timezone).getTime()\n          : parsed.runAt?.getTime(),\n    });\n\n    console.log('Schedule created successfully!');\n    console.log();\n    console.log(`  ID:       ${schedule.id.substring(0, 8)}`);\n    console.log(`  Workflow: ${schedule.workflow}`);\n    console.log(`  When:     ${schedule.originalExpression}`);\n    if (schedule.nextRunAt) {\n      console.log(`  Next run: ${new Date(schedule.nextRunAt).toLocaleString()}`);\n    }\n    if (outputContext) {\n      console.log(`  Output:   ${outputContext.type}:${outputContext.target || ''}`);\n    }\n    console.log();\n    console.log('Start the scheduler daemon to execute this schedule:');\n    console.log('  visor schedule start');\n  } catch (error) {\n    console.error(`Failed to create schedule: ${error instanceof Error ? error.message : error}`);\n    process.exit(1);\n  }\n}\n\n/**\n * Get the current CLI user identifier\n */\nfunction getCurrentCliUser(): string {\n  return process.env.USER || process.env.USERNAME || 'cli-user';\n}\n\n/**\n * Verify ownership of a schedule (for CLI operations)\n * Returns true if the user owns the schedule or --force is used\n */\nfunction verifyOwnership(\n  schedule: { creatorId: string; creatorContext?: string },\n  flags: Record<string, string | boolean>,\n  operation: string\n): boolean {\n  const currentUser = getCurrentCliUser();\n  const isOwner = schedule.creatorContext === 'cli' && schedule.creatorId === currentUser;\n  const forceFlag = flags.force === true;\n\n  if (!isOwner && !forceFlag) {\n    console.error(`Error: You do not own this schedule.`);\n    console.error(`  Owner: ${schedule.creatorId} (${schedule.creatorContext || 'unknown'})`);\n    console.error(`  You:   ${currentUser} (cli)`);\n    console.log();\n    console.log(`Use --force to ${operation} schedules you don't own.`);\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Handle 'schedule cancel' - cancel a schedule\n */\nasync function handleCancel(\n  positional: string[],\n  flags: Record<string, string | boolean>\n): Promise<void> {\n  const scheduleId = positional[0];\n\n  if (!scheduleId) {\n    console.error('Error: Schedule ID is required');\n    console.log('Usage: visor schedule cancel <id> [--force]');\n    process.exit(1);\n  }\n\n  const store = ScheduleStore.getInstance();\n  await store.initialize();\n\n  // Find schedule by ID or partial ID\n  let schedule = await store.getAsync(scheduleId);\n  if (!schedule) {\n    const all = await store.getAllAsync();\n    schedule = all.find(s => s.id.startsWith(scheduleId));\n  }\n\n  if (!schedule) {\n    console.error(`Schedule not found: ${scheduleId}`);\n    console.log('\\nUse \"visor schedule list\" to see available schedules.');\n    process.exit(1);\n  }\n\n  // Verify ownership\n  if (!verifyOwnership(schedule, flags, 'cancel')) {\n    process.exit(1);\n  }\n\n  await store.deleteAsync(schedule.id);\n\n  console.log('Schedule cancelled successfully!');\n  console.log();\n  console.log(`  ID:       ${schedule.id.substring(0, 8)}`);\n  console.log(`  Workflow: ${schedule.workflow}`);\n  console.log(`  Was:      ${schedule.originalExpression}`);\n}\n\n/**\n * Handle 'schedule pause' - pause a schedule\n */\nasync function handlePause(\n  positional: string[],\n  flags: Record<string, string | boolean>\n): Promise<void> {\n  const scheduleId = positional[0];\n\n  if (!scheduleId) {\n    console.error('Error: Schedule ID is required');\n    console.log('Usage: visor schedule pause <id> [--force]');\n    process.exit(1);\n  }\n\n  const store = ScheduleStore.getInstance();\n  await store.initialize();\n\n  // Find schedule by ID or partial ID\n  let schedule = await store.getAsync(scheduleId);\n  if (!schedule) {\n    const all = await store.getAllAsync();\n    schedule = all.find(s => s.id.startsWith(scheduleId));\n  }\n\n  if (!schedule) {\n    console.error(`Schedule not found: ${scheduleId}`);\n    process.exit(1);\n  }\n\n  // Verify ownership\n  if (!verifyOwnership(schedule, flags, 'pause')) {\n    process.exit(1);\n  }\n\n  await store.updateAsync(schedule.id, { status: 'paused' });\n\n  console.log('Schedule paused successfully!');\n  console.log();\n  console.log(`  ID:       ${schedule.id.substring(0, 8)}`);\n  console.log(`  Workflow: ${schedule.workflow}`);\n  console.log('\\nUse \"visor schedule resume <id>\" to resume.');\n}\n\n/**\n * Handle 'schedule resume' - resume a paused schedule\n */\nasync function handleResume(\n  positional: string[],\n  flags: Record<string, string | boolean>\n): Promise<void> {\n  const scheduleId = positional[0];\n\n  if (!scheduleId) {\n    console.error('Error: Schedule ID is required');\n    console.log('Usage: visor schedule resume <id> [--force]');\n    process.exit(1);\n  }\n\n  const store = ScheduleStore.getInstance();\n  await store.initialize();\n\n  // Find schedule by ID or partial ID\n  let schedule = await store.getAsync(scheduleId);\n  if (!schedule) {\n    const all = await store.getAllAsync();\n    schedule = all.find(s => s.id.startsWith(scheduleId));\n  }\n\n  if (!schedule) {\n    console.error(`Schedule not found: ${scheduleId}`);\n    process.exit(1);\n  }\n\n  // Verify ownership\n  if (!verifyOwnership(schedule, flags, 'resume')) {\n    process.exit(1);\n  }\n\n  await store.updateAsync(schedule.id, { status: 'active' });\n\n  console.log('Schedule resumed successfully!');\n  console.log();\n  console.log(`  ID:       ${schedule.id.substring(0, 8)}`);\n  console.log(`  Workflow: ${schedule.workflow}`);\n}\n","/**\n * Scheduler module public exports\n *\n * This module provides a generic, frontend-agnostic scheduler for executing\n * workflows at specified times. It supports both:\n * - Static schedules defined in YAML configuration\n * - Dynamic schedules created via AI tool at runtime\n */\n\n// Schedule store\nexport {\n  ScheduleStore,\n  Schedule,\n  ScheduleOutputContext,\n  ScheduleStoreConfig,\n  ScheduleLimits,\n} from './schedule-store';\n\n// Store backends\nexport type {\n  ScheduleStoreBackend,\n  ScheduleStoreStats,\n  StorageConfig,\n  HAConfig,\n} from './store/types';\n\nexport { createStoreBackend } from './store/index';\n\n// Schedule parser\nexport {\n  parseScheduleExpression,\n  getNextRunTime,\n  isValidCronExpression,\n  ParsedSchedule,\n} from './schedule-parser';\n\n// Scheduler daemon\nexport {\n  Scheduler,\n  SchedulerConfig,\n  ScheduleOutputAdapter,\n  ScheduleExecutionResult,\n  getScheduler,\n  resetScheduler,\n} from './scheduler';\n\n// Schedule tool (for AI providers)\nexport {\n  handleScheduleAction,\n  getScheduleToolDefinition,\n  isScheduleTool,\n  buildScheduleToolContext,\n  ScheduleToolArgs,\n  ScheduleToolContext,\n  ScheduleToolResult,\n  ScheduleAction,\n  ScheduleType,\n  SchedulePermissions,\n} from './schedule-tool';\n\n// CLI handler\nexport { handleScheduleCommand } from './cli-handler';\n","/**\n * Handler for executing the schedule tool within the MCP custom tools server context\n * This integrates the schedule tool with the AI check provider's custom tools system\n *\n * This is a Slack-specific adapter that translates between Slack context and the\n * generic frontend-agnostic scheduler.\n */\nimport { CustomToolDefinition } from '../types/config';\nimport {\n  handleScheduleAction,\n  getScheduleToolDefinition,\n  buildScheduleToolContext,\n  ScheduleToolArgs,\n  ScheduleStore,\n  SchedulePermissions,\n} from '../scheduler';\nimport { SlackClient } from './client';\nimport { logger } from '../logger';\n\n/**\n * Context information extracted from Slack webhook payload\n */\nexport interface SlackWebhookContext {\n  userId: string;\n  userName?: string;\n  channel: string;\n  threadTs?: string;\n  timezone?: string;\n  /** Channel type: 'channel' for public/private channels, 'dm' for direct messages, 'group' for group DMs */\n  channelType?: 'channel' | 'dm' | 'group';\n}\n\n/**\n * Determine channel type from channel ID\n * C = public channel, G = private channel/group DM, D = direct message\n */\nfunction getChannelType(channelId: string): 'channel' | 'dm' | 'group' {\n  if (channelId.startsWith('D')) {\n    return 'dm';\n  } else if (channelId.startsWith('G')) {\n    // G prefix is used for both private channels and multi-party DMs\n    // For permission purposes, we treat private channels like public ones\n    return 'group';\n  }\n  // C prefix = public channel\n  return 'channel';\n}\n\n/**\n * Extract Slack context from webhook payload\n */\nexport function extractSlackContext(webhookData: Map<string, unknown>): SlackWebhookContext | null {\n  try {\n    // Find the Slack payload in webhook data\n    for (const payload of webhookData.values()) {\n      const p = payload as any;\n      if (!p || typeof p !== 'object') continue;\n\n      const event = p.event;\n      const conversation = p.slack_conversation;\n\n      if (event) {\n        const userId = event.user || '';\n        const channel = event.channel || '';\n        // Only use thread_ts if it's actually a threaded message\n        // A message is in a thread if thread_ts exists AND differs from ts\n        // (thread_ts === ts means it's the parent message of a thread, not a reply)\n        const isInThread = event.thread_ts && event.thread_ts !== event.ts;\n        const threadTs = isInThread ? event.thread_ts : undefined;\n\n        if (userId && channel) {\n          return {\n            userId,\n            channel,\n            threadTs,\n            userName: conversation?.current?.user,\n            timezone: undefined, // Will be fetched on-demand\n            channelType: getChannelType(channel),\n          };\n        }\n      }\n    }\n  } catch {\n    // Best effort\n  }\n\n  return null;\n}\n\n/**\n * Create a schedule tool definition that uses context from the execution environment\n * This returns a tool that can be added to the custom tools server\n */\nexport function createScheduleToolWithContext(\n  slackContext: SlackWebhookContext,\n  _slackClient?: SlackClient\n): CustomToolDefinition {\n  const baseDef = getScheduleToolDefinition();\n\n  // Create an enhanced tool that captures context at creation time\n  return {\n    ...baseDef,\n    // Override the exec to handle the tool call with context\n    // This is a placeholder - the actual execution happens via executeScheduleTool\n    exec: JSON.stringify({\n      type: 'schedule_tool',\n      context: slackContext,\n    }),\n  };\n}\n\n/**\n * Execute the schedule tool with the given arguments and context\n * This is called by the custom tool executor when the schedule tool is invoked\n */\nexport async function executeScheduleTool(\n  args: Record<string, unknown>,\n  slackContext: SlackWebhookContext,\n  slackClient?: SlackClient,\n  availableWorkflows?: string[],\n  permissions?: SchedulePermissions\n): Promise<string> {\n  // Fetch user timezone if client is available and not already set\n  let timezone = slackContext.timezone;\n  if (!timezone && slackClient && slackContext.userId) {\n    try {\n      const userInfo = await slackClient.getUserInfo(slackContext.userId);\n      if (userInfo.ok && userInfo.user?.tz) {\n        timezone = userInfo.user.tz;\n        slackContext.timezone = timezone;\n      }\n    } catch {\n      // Use default timezone\n    }\n  }\n\n  // Build the generic tool context from Slack context\n  const toolContext = buildScheduleToolContext(\n    {\n      slackContext: {\n        userId: slackContext.userId,\n        userName: slackContext.userName,\n        timezone: timezone || 'UTC',\n        channelType: slackContext.channelType,\n      },\n    },\n    availableWorkflows,\n    permissions\n  );\n\n  // Map the tool arguments - AI provides structured data\n  const toolArgs: ScheduleToolArgs = {\n    action: args.action as any,\n    // What to do\n    reminder_text: args.reminder_text as string | undefined,\n    workflow: args.workflow as string | undefined,\n    workflow_inputs: args.workflow_inputs as Record<string, unknown> | undefined,\n    // Where to send\n    target_type: args.target_type as 'channel' | 'dm' | 'thread' | 'user' | undefined,\n    target_id: args.target_id as string | undefined,\n    thread_ts: args.thread_ts as string | undefined,\n    // When to run\n    is_recurring: args.is_recurring as boolean | undefined,\n    cron: args.cron as string | undefined,\n    run_at: args.run_at as string | undefined,\n    original_expression: args.original_expression as string | undefined,\n    // For cancel/pause/resume\n    schedule_id: args.schedule_id as string | undefined,\n  };\n\n  // If AI didn't provide target, default to current Slack context\n  if (!toolArgs.target_type && slackContext.channel) {\n    // Only use 'thread' if we're actually in a thread\n    if (slackContext.threadTs) {\n      toolArgs.target_type = 'thread';\n      toolArgs.target_id = slackContext.channel;\n      toolArgs.thread_ts = slackContext.threadTs;\n    } else {\n      toolArgs.target_type = slackContext.channelType === 'channel' ? 'channel' : 'dm';\n      toolArgs.target_id = slackContext.channel;\n    }\n  }\n\n  try {\n    const result = await handleScheduleAction(toolArgs, toolContext);\n\n    if (result.success) {\n      return result.message;\n    } else {\n      return `Error: ${result.error || result.message}`;\n    }\n  } catch (error) {\n    const errorMsg = error instanceof Error ? error.message : 'Unknown error';\n    logger.error(`[ScheduleToolHandler] Failed to execute schedule tool: ${errorMsg}`);\n    return `Error: ${errorMsg}`;\n  }\n}\n\n/**\n * Check if a tool name is the schedule tool\n */\nexport function isScheduleToolCall(toolName: string): boolean {\n  return toolName === 'schedule';\n}\n\n/**\n * Initialize the schedule store if not already initialized\n */\nexport async function ensureScheduleStoreInitialized(): Promise<ScheduleStore> {\n  const store = ScheduleStore.getInstance();\n  if (!store.isInitialized()) {\n    await store.initialize();\n  }\n  return store;\n}\n\n// Legacy alias for backwards compatibility\nexport const ensureReminderStoreInitialized = ensureScheduleStoreInitialized;\n","import { CustomToolDefinition } from '../types/config';\nimport { CustomToolExecutor } from './custom-tool-executor';\nimport { logger } from '../logger';\nimport http from 'http';\nimport { EventEmitter } from 'events';\nimport {\n  isWorkflowTool,\n  executeWorkflowAsTool,\n  WorkflowToolDefinition,\n  WorkflowToolContext,\n} from './workflow-tool-executor';\nimport {\n  isScheduleTool,\n  handleScheduleAction,\n  buildScheduleToolContext,\n  ScheduleToolArgs,\n} from '../scheduler/schedule-tool';\n// Legacy Slack-specific imports for backwards compatibility\nimport { extractSlackContext } from '../slack/schedule-tool-handler';\n\n/**\n * MCP Protocol message types\n */\ninterface MCPMessage {\n  jsonrpc: '2.0';\n  id?: number | string;\n  method?: string;\n  params?: unknown;\n  result?: unknown;\n  error?: {\n    code: number;\n    message: string;\n    data?: unknown;\n  };\n}\n\n/**\n * MCP Tools List Response\n */\ninterface MCPToolsListResponse {\n  jsonrpc: '2.0';\n  id: number | string;\n  result: {\n    tools: Array<{\n      name: string;\n      description?: string;\n      inputSchema: {\n        type: 'object';\n        properties?: Record<string, unknown>;\n        required?: string[];\n        additionalProperties?: boolean;\n      };\n    }>;\n  };\n}\n\n/**\n * MCP Tool Call Request\n */\ninterface MCPToolCallRequest {\n  jsonrpc: '2.0';\n  id: number | string;\n  method: 'tools/call';\n  params: {\n    name: string;\n    arguments: Record<string, unknown>;\n  };\n}\n\n/**\n * MCP Tool Call Response\n */\ninterface MCPToolCallResponse {\n  jsonrpc: '2.0';\n  id: number | string;\n  result?: {\n    content: Array<{\n      type: 'text';\n      text: string;\n    }>;\n  };\n  error?: {\n    code: number;\n    message: string;\n    data?: unknown;\n  };\n}\n\n/**\n * SSE Client Connection\n */\ninterface SSEConnection {\n  response: http.ServerResponse;\n  id: string;\n}\n\n/**\n * Custom MCP Server interface\n */\nexport interface CustomMCPServer {\n  start(): Promise<number>;\n  stop(options?: { graceMs?: number; drainTimeoutMs?: number }): Promise<void>;\n  getUrl(): string;\n}\n\n/**\n * SSE-based MCP server that exposes custom tools from YAML configuration\n * Implements the Model Context Protocol over Server-Sent Events\n */\nexport class CustomToolsSSEServer implements CustomMCPServer {\n  private server: http.Server | null = null;\n  private port: number = 0;\n  private connections: Set<SSEConnection> = new Set();\n  private toolExecutor: CustomToolExecutor;\n  private sessionId: string;\n  private debug: boolean;\n  private eventBus: EventEmitter;\n  private messageQueue: Map<string, MCPMessage[]> = new Map();\n  private tools: Map<string, CustomToolDefinition>;\n  private workflowContext?: WorkflowToolContext;\n  private keepaliveInterval: NodeJS.Timeout | null = null;\n  private activeToolCalls: number = 0;\n  private lastActivityAt: number = Date.now();\n  private static readonly KEEPALIVE_INTERVAL_MS = 30000; // 30 seconds\n\n  constructor(\n    tools: Map<string, CustomToolDefinition>,\n    sessionId: string,\n    debug: boolean = false,\n    workflowContext?: WorkflowToolContext\n  ) {\n    this.sessionId = sessionId;\n    this.debug = debug;\n    this.eventBus = new EventEmitter();\n    this.tools = tools;\n    this.workflowContext = workflowContext;\n\n    // Convert Map to Record for CustomToolExecutor (only for non-workflow tools)\n    const toolsRecord: Record<string, CustomToolDefinition> = {};\n    const workflowToolNames: string[] = [];\n    for (const [name, tool] of tools.entries()) {\n      // Skip workflow tools - they're handled separately\n      if (!isWorkflowTool(tool)) {\n        toolsRecord[name] = tool;\n      } else {\n        workflowToolNames.push(name);\n      }\n    }\n\n    // Warn if workflow tools are present but no context is provided\n    if (workflowToolNames.length > 0 && !workflowContext) {\n      logger.warn(\n        `[CustomToolsSSEServer:${sessionId}] ${workflowToolNames.length} workflow tool(s) registered but no workflowContext provided. ` +\n          `Tools [${workflowToolNames.join(', ')}] will fail at runtime. ` +\n          `Pass workflowContext to enable workflow tool execution.`\n      );\n    }\n\n    this.toolExecutor = new CustomToolExecutor(toolsRecord);\n\n    if (this.debug) {\n      const workflowToolCount = workflowToolNames.length;\n      const regularToolCount = tools.size - workflowToolCount;\n      logger.debug(\n        `[CustomToolsSSEServer:${sessionId}] Initialized with ${regularToolCount} regular tools and ${workflowToolCount} workflow tools`\n      );\n    }\n  }\n\n  /**\n   * Start the SSE server on an ephemeral port\n   * Returns the actual bound port number\n   */\n  async start(): Promise<number> {\n    return new Promise((resolve, reject) => {\n      try {\n        // Create HTTP server\n        this.server = http.createServer((req, res) => {\n          this.handleRequest(req, res).catch(error => {\n            logger.error(\n              `[CustomToolsSSEServer:${this.sessionId}] Request handler error: ${error}`\n            );\n          });\n        });\n\n        // Error handler\n        this.server.on('error', (error: NodeJS.ErrnoException) => {\n          if (error.code === 'EADDRINUSE') {\n            // Port in use, let the OS pick another one\n            if (this.debug) {\n              logger.debug(\n                `[CustomToolsSSEServer:${this.sessionId}] Port ${this.port} in use, retrying with new port`\n              );\n            }\n            reject(new Error(`Port ${this.port} already in use`));\n          } else {\n            reject(error);\n          }\n        });\n\n        // Listen on ephemeral port (0 = OS assigns)\n        this.server.listen(0, 'localhost', () => {\n          const address = this.server!.address();\n          if (!address || typeof address === 'string') {\n            reject(new Error('Failed to bind to port'));\n            return;\n          }\n\n          this.port = address.port;\n          if (this.debug) {\n            logger.debug(\n              `[CustomToolsSSEServer:${this.sessionId}] Started on http://localhost:${this.port}/sse`\n            );\n          }\n\n          // Start keepalive to prevent connection timeouts during long AI thinking periods\n          this.startKeepalive();\n\n          resolve(this.port);\n        });\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n\n  /**\n   * Start sending periodic keepalive pings to all connections\n   * This prevents the SSE connection from being closed during long idle periods\n   */\n  private startKeepalive(): void {\n    if (this.keepaliveInterval) {\n      return; // Already running\n    }\n\n    this.keepaliveInterval = setInterval(() => {\n      if (this.connections.size === 0) {\n        return;\n      }\n\n      for (const connection of this.connections) {\n        try {\n          // Send SSE comment as keepalive (: prefixed lines are comments in SSE)\n          connection.response.write(`: keepalive ${Date.now()}\\n\\n`);\n        } catch (error) {\n          // Connection might be closed, will be cleaned up on next request\n          if (this.debug) {\n            logger.debug(\n              `[CustomToolsSSEServer:${this.sessionId}] Keepalive failed for ${connection.id}: ${error}`\n            );\n          }\n        }\n      }\n\n      if (this.debug) {\n        logger.debug(\n          `[CustomToolsSSEServer:${this.sessionId}] Sent keepalive to ${this.connections.size} connection(s)`\n        );\n      }\n    }, CustomToolsSSEServer.KEEPALIVE_INTERVAL_MS);\n  }\n\n  /**\n   * Stop the keepalive interval\n   */\n  private stopKeepalive(): void {\n    if (this.keepaliveInterval) {\n      clearInterval(this.keepaliveInterval);\n      this.keepaliveInterval = null;\n    }\n  }\n\n  /**\n   * Stop the server and cleanup resources\n   */\n  async stop(options?: { graceMs?: number; drainTimeoutMs?: number }): Promise<void> {\n    const graceMs = this.getEnvNumber('VISOR_CUSTOM_TOOLS_GRACE_MS', 0);\n    const drainTimeoutMs = this.getEnvNumber('VISOR_CUSTOM_TOOLS_DRAIN_TIMEOUT_MS', 60000);\n    const effectiveGraceMs = options?.graceMs ?? graceMs;\n    const effectiveDrainTimeoutMs = options?.drainTimeoutMs ?? drainTimeoutMs;\n\n    if (effectiveGraceMs > 0) {\n      const sinceLastActivity = Date.now() - this.lastActivityAt;\n      const waitMs = Math.max(0, effectiveGraceMs - sinceLastActivity);\n      if (waitMs > 0) {\n        logger.debug(\n          `[CustomToolsSSEServer:${this.sessionId}] Grace period before stop: ${waitMs}ms (activeToolCalls=${this.activeToolCalls})`\n        );\n        await new Promise(resolve => setTimeout(resolve, waitMs));\n      }\n    }\n\n    if (this.activeToolCalls > 0) {\n      const startedAt = Date.now();\n      logger.debug(\n        `[CustomToolsSSEServer:${this.sessionId}] Waiting for ${this.activeToolCalls} active tool call(s) before stop`\n      );\n      while (this.activeToolCalls > 0 && Date.now() - startedAt < effectiveDrainTimeoutMs) {\n        await new Promise(resolve => setTimeout(resolve, 250));\n      }\n      if (this.activeToolCalls > 0) {\n        logger.warn(\n          `[CustomToolsSSEServer:${this.sessionId}] Drain timeout reached; stopping with ${this.activeToolCalls} active tool call(s)`\n        );\n      }\n    }\n\n    if (this.debug) {\n      logger.debug(`[CustomToolsSSEServer:${this.sessionId}] Stopping server...`);\n    }\n\n    // Stop keepalive first\n    this.stopKeepalive();\n\n    // Close all SSE connections\n    for (const connection of this.connections) {\n      try {\n        connection.response.end();\n      } catch (error) {\n        if (this.debug) {\n          logger.debug(\n            `[CustomToolsSSEServer:${this.sessionId}] Error closing connection: ${error}`\n          );\n        }\n      }\n    }\n    this.connections.clear();\n\n    // Stop the HTTP server\n    if (this.server) {\n      await new Promise<void>((resolve, reject) => {\n        const timeout = setTimeout(() => {\n          // Force close after 5s\n          if (this.debug) {\n            logger.debug(\n              `[CustomToolsSSEServer:${this.sessionId}] Force closing server after timeout`\n            );\n          }\n          this.server?.close(() => resolve());\n        }, 5000);\n\n        this.server!.close(error => {\n          clearTimeout(timeout);\n          if (error) {\n            reject(error);\n          } else {\n            resolve();\n          }\n        });\n      });\n\n      this.server = null;\n    }\n\n    if (this.debug) {\n      logger.debug(`[CustomToolsSSEServer:${this.sessionId}] Server stopped`);\n    }\n  }\n\n  /**\n   * Get the SSE endpoint URL\n   */\n  getUrl(): string {\n    if (!this.port) {\n      throw new Error('Server not started');\n    }\n    return `http://localhost:${this.port}/sse`;\n  }\n\n  /**\n   * Handle incoming HTTP requests\n   */\n  private async handleRequest(req: http.IncomingMessage, res: http.ServerResponse): Promise<void> {\n    const url = new URL(req.url || '/', `http://localhost:${this.port}`);\n    if (this.debug) {\n      logger.debug(\n        `[CustomToolsSSEServer:${this.sessionId}] HTTP ${req.method} ${url.pathname} (connections=${this.connections.size})`\n      );\n    }\n\n    // Handle CORS preflight\n    if (req.method === 'OPTIONS') {\n      this.handleCORS(res);\n      res.writeHead(204);\n      res.end();\n      return;\n    }\n\n    // GET /sse - Establish SSE connection (MCP standard pattern)\n    if (req.method === 'GET' && url.pathname === '/sse') {\n      this.handleSSEConnection(req, res);\n      return;\n    }\n\n    // POST /sse - Combined SSE connection with initial message (legacy pattern for tests)\n    if (req.method === 'POST' && url.pathname === '/sse') {\n      await this.handleLegacySSEPost(req, res);\n      return;\n    }\n\n    // POST /message - Handle MCP messages (MCP standard pattern)\n    if (req.method === 'POST' && url.pathname === '/message') {\n      await this.handleMessage(req, res);\n      return;\n    }\n\n    // Not found\n    res.writeHead(404, { 'Content-Type': 'application/json' });\n    res.end(JSON.stringify({ error: 'Not found' }));\n  }\n\n  /**\n   * Handle legacy POST /sse pattern (connection + message in one request)\n   * This maintains backward compatibility with tests\n   */\n  private async handleLegacySSEPost(\n    req: http.IncomingMessage,\n    res: http.ServerResponse\n  ): Promise<void> {\n    // Setup SSE headers\n    this.handleCORS(res);\n    res.writeHead(200, {\n      'Content-Type': 'text/event-stream',\n      'Cache-Control': 'no-cache',\n      Connection: 'keep-alive',\n    });\n\n    // Create connection\n    const connectionId = `conn-${Date.now()}-${Math.random().toString(36).substring(2, 11)}`;\n    const connection: SSEConnection = {\n      response: res,\n      id: connectionId,\n    };\n    this.connections.add(connection);\n\n    if (this.debug) {\n      logger.debug(\n        `[CustomToolsSSEServer:${this.sessionId}] Legacy SSE POST connection: ${connectionId} (connections=${this.connections.size})`\n      );\n    }\n\n    // Parse request body and handle message\n    let body = '';\n    req.on('data', chunk => {\n      body += chunk.toString();\n    });\n\n    req.on('end', async () => {\n      try {\n        if (body.trim()) {\n          const message = JSON.parse(body) as MCPMessage;\n          await this.handleMCPMessage(connection, message);\n        }\n      } catch (error) {\n        const errorMsg = error instanceof Error ? error.message : 'Unknown error';\n        if (this.debug) {\n          logger.error(\n            `[CustomToolsSSEServer:${this.sessionId}] Error in legacy SSE POST: ${errorMsg}`\n          );\n        }\n        this.sendErrorResponse(connection, null, -32700, 'Parse error', { error: errorMsg });\n      }\n    });\n\n    // Handle disconnect\n    req.on('close', () => {\n      this.connections.delete(connection);\n      if (this.debug) {\n        logger.debug(\n          `[CustomToolsSSEServer:${this.sessionId}] Legacy SSE POST connection closed: ${connectionId} (connections=${this.connections.size})`\n        );\n      }\n    });\n  }\n\n  /**\n   * Handle SSE connection establishment (GET /sse)\n   */\n  private handleSSEConnection(req: http.IncomingMessage, res: http.ServerResponse): void {\n    // Setup SSE headers\n    this.handleCORS(res);\n    res.writeHead(200, {\n      'Content-Type': 'text/event-stream',\n      'Cache-Control': 'no-cache',\n      Connection: 'keep-alive',\n    });\n\n    // Create connection ID\n    const connectionId = `conn-${Date.now()}-${Math.random().toString(36).substring(2, 11)}`;\n\n    // Register connection\n    const connection: SSEConnection = {\n      response: res,\n      id: connectionId,\n    };\n    this.connections.add(connection);\n\n    if (this.debug) {\n      logger.debug(\n        `[CustomToolsSSEServer:${this.sessionId}] New SSE connection: ${connectionId} (connections=${this.connections.size})`\n      );\n    }\n\n    // Send initial endpoint message with session ID for message routing\n    this.sendSSE(\n      connection,\n      'endpoint',\n      `http://localhost:${this.port}/message?sessionId=${connectionId}`\n    );\n\n    // Handle client disconnect\n    req.on('close', () => {\n      if (this.debug) {\n        logger.debug(\n          `[CustomToolsSSEServer:${this.sessionId}] Connection closed: ${connectionId} (connections=${this.connections.size})`\n        );\n      }\n      this.connections.delete(connection);\n    });\n  }\n\n  /**\n   * Handle MCP message (POST /message)\n   */\n  private async handleMessage(req: http.IncomingMessage, res: http.ServerResponse): Promise<void> {\n    const url = new URL(req.url || '/', `http://localhost:${this.port}`);\n    const sessionId = url.searchParams.get('sessionId');\n\n    // Find the connection for this session\n    let connection: SSEConnection | undefined;\n    for (const conn of this.connections) {\n      if (conn.id === sessionId) {\n        connection = conn;\n        break;\n      }\n    }\n\n    if (!connection) {\n      // If no specific connection found, use the first available (for backwards compatibility)\n      connection = this.connections.values().next().value;\n    }\n\n    if (!connection) {\n      res.writeHead(400, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ error: 'No active SSE connection' }));\n      if (this.debug) {\n        logger.debug(\n          `[CustomToolsSSEServer:${this.sessionId}] No active SSE connection for sessionId=${sessionId}`\n        );\n      }\n      return;\n    }\n\n    // Parse request body\n    let body = '';\n    req.on('data', chunk => {\n      body += chunk.toString();\n    });\n\n    req.on('end', async () => {\n      try {\n        const message = JSON.parse(body) as MCPMessage;\n\n        if (this.debug) {\n          logger.debug(\n            `[CustomToolsSSEServer:${this.sessionId}] Received message: ${JSON.stringify(message)}`\n          );\n        }\n\n        // Send 202 response BEFORE handling the message. Tool execution\n        // (e.g. engineer workflow running claude -p) can take many minutes.\n        // If we await handleMCPMessage first, undici's headersTimeout (300s\n        // default) kills the POST fetch on the client side with \"fetch failed\".\n        this.handleCORS(res);\n        res.writeHead(202, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ status: 'accepted' }));\n\n        // Handle the MCP message asynchronously (tool results sent via SSE)\n        await this.handleMCPMessage(connection!, message);\n      } catch (error) {\n        const errorMsg = error instanceof Error ? error.message : 'Unknown error';\n        if (this.debug) {\n          logger.error(\n            `[CustomToolsSSEServer:${this.sessionId}] Error parsing message: ${errorMsg}`\n          );\n        }\n        this.sendErrorResponse(connection!, null, -32700, 'Parse error', { error: errorMsg });\n\n        // Only send error response if headers haven't been sent yet\n        if (!res.headersSent) {\n          res.writeHead(400, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ error: 'Parse error', details: errorMsg }));\n        }\n      }\n    });\n  }\n\n  /**\n   * Handle CORS headers\n   */\n  private handleCORS(res: http.ServerResponse): void {\n    res.setHeader('Access-Control-Allow-Origin', '*');\n    res.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');\n    res.setHeader('Access-Control-Allow-Headers', 'Content-Type');\n  }\n\n  /**\n   * Send SSE message to client\n   */\n  private sendSSE(connection: SSEConnection, event: string, data: unknown): void {\n    try {\n      const dataStr = typeof data === 'string' ? data : JSON.stringify(data);\n\n      // Log SSE message being sent (important for debugging MCP communication)\n      const preview =\n        dataStr.length > 300\n          ? `${dataStr.substring(0, 150)}...${dataStr.substring(dataStr.length - 150)}`\n          : dataStr;\n      logger.debug(\n        `[CustomToolsSSEServer:${this.sessionId}] Sending SSE event='${event}' size=${dataStr.length} preview=${preview}`\n      );\n\n      connection.response.write(`event: ${event}\\n`);\n      connection.response.write(`data: ${dataStr}\\n\\n`);\n\n      logger.debug(\n        `[CustomToolsSSEServer:${this.sessionId}] SSE message sent successfully, event='${event}'`\n      );\n    } catch (error) {\n      logger.error(`[CustomToolsSSEServer:${this.sessionId}] Error sending SSE: ${error}`);\n    }\n  }\n\n  /**\n   * Handle MCP protocol messages\n   */\n  private async handleMCPMessage(connection: SSEConnection, message: MCPMessage): Promise<void> {\n    if (this.debug) {\n      logger.debug(\n        `[CustomToolsSSEServer:${this.sessionId}] Received MCP message: ${JSON.stringify(message)}`\n      );\n    }\n    this.lastActivityAt = Date.now();\n\n    // Handle tools/list request\n    if (message.method === 'tools/list') {\n      const response = await this.handleToolsList(message.id!);\n      this.sendSSE(connection, 'message', response);\n      return;\n    }\n\n    // Handle tools/call request\n    if (message.method === 'tools/call') {\n      const request = message as MCPToolCallRequest;\n      const argsPreview = JSON.stringify(request.params.arguments).substring(0, 200);\n      logger.info(\n        `[CustomToolsSSEServer:${this.sessionId}] Received tools/call for '${request.params.name}' id=${request.id} args=${argsPreview}`\n      );\n\n      const response = await this.handleToolCall(\n        request.id,\n        request.params.name,\n        request.params.arguments\n      );\n\n      logger.info(\n        `[CustomToolsSSEServer:${this.sessionId}] Sending response for '${request.params.name}' id=${request.id} hasError=${!!response.error}`\n      );\n      this.sendSSE(connection, 'message', response);\n      return;\n    }\n\n    // Handle initialize request\n    if (message.method === 'initialize') {\n      const response: MCPMessage = {\n        jsonrpc: '2.0',\n        id: message.id!,\n        result: {\n          protocolVersion: '2024-11-05',\n          capabilities: {\n            tools: {},\n          },\n          serverInfo: {\n            name: 'visor-custom-tools',\n            version: '1.0.0',\n          },\n        },\n      };\n      this.sendSSE(connection, 'message', response);\n      return;\n    }\n\n    // Handle notifications/initialized\n    if (message.method === 'notifications/initialized') {\n      // No response needed for notifications\n      return;\n    }\n\n    // Unknown method\n    this.sendErrorResponse(connection, message.id!, -32601, 'Method not found');\n  }\n\n  /**\n   * Handle tools/list MCP request\n   */\n  private async handleToolsList(id: number | string): Promise<MCPToolsListResponse> {\n    // Get all tools from the tools map (includes both regular and workflow tools)\n    const allTools = Array.from(this.tools.values());\n\n    if (this.debug) {\n      logger.debug(\n        `[CustomToolsSSEServer:${this.sessionId}] Listing ${allTools.length} tools: ${allTools.map(t => t.name).join(', ')}`\n      );\n    }\n\n    return {\n      jsonrpc: '2.0',\n      id,\n      result: {\n        tools: allTools.map(tool => ({\n          name: tool.name,\n          description: tool.description || `Execute ${tool.name}`,\n          inputSchema: tool.inputSchema || {\n            type: 'object',\n            properties: {},\n            required: [],\n          },\n        })),\n      },\n    };\n  }\n\n  /**\n   * Handle tools/call MCP request\n   */\n  private async handleToolCall(\n    id: number | string,\n    toolName: string,\n    args: Record<string, unknown>\n  ): Promise<MCPToolCallResponse> {\n    // Acquire workspace reference to prevent premature cleanup during tool execution\n    const workspace = this.workflowContext?.workspace;\n    if (workspace) {\n      workspace.acquire();\n    }\n\n    this.activeToolCalls++;\n    this.lastActivityAt = Date.now();\n\n    try {\n      if (this.debug) {\n        logger.debug(\n          `[CustomToolsSSEServer:${this.sessionId}] Executing tool: ${toolName} with args: ${JSON.stringify(args)}`\n        );\n      }\n\n      const retryCount = this.getEnvNumber('VISOR_CUSTOM_TOOLS_RETRY_COUNT', 0);\n      const retryDelayMs = this.getEnvNumber('VISOR_CUSTOM_TOOLS_RETRY_DELAY_MS', 1000);\n      let attempt = 0;\n      let result: unknown;\n\n      while (true) {\n        try {\n          // Check if this is the schedule tool\n          if (isScheduleTool(toolName)) {\n            // Extract context from various sources\n            const webhookData = this.workflowContext?.executionContext?.webhookContext?.webhookData;\n            const slackContext = webhookData\n              ? extractSlackContext(webhookData as Map<string, unknown>)\n              : null;\n\n            // Get available workflows from visor config if available\n            const visorCfg = (this.workflowContext as any)?.visorConfig;\n            const availableWorkflows = visorCfg?.checks ? Object.keys(visorCfg.checks) : undefined;\n\n            // Extract scheduler permissions from config\n            const schedulerPermissions = visorCfg?.scheduler?.permissions;\n            const permissions = schedulerPermissions\n              ? {\n                  allowPersonal: schedulerPermissions.allow_personal,\n                  allowChannel: schedulerPermissions.allow_channel,\n                  allowDm: schedulerPermissions.allow_dm,\n                  allowedWorkflows: schedulerPermissions.allowed_workflows,\n                  deniedWorkflows: schedulerPermissions.denied_workflows,\n                }\n              : undefined;\n\n            // Build generic schedule tool context\n            const scheduleContext = buildScheduleToolContext(\n              {\n                slackContext: slackContext\n                  ? {\n                      userId: slackContext.userId,\n                      userName: slackContext.userName,\n                      timezone: slackContext.timezone,\n                      channelType: slackContext.channelType,\n                    }\n                  : undefined,\n              },\n              availableWorkflows,\n              permissions,\n              {\n                outputType: args.output_type as 'slack' | 'github' | 'webhook' | 'none' | undefined,\n                outputTarget: args.output_target as string | undefined,\n              }\n            );\n\n            if (this.debug) {\n              logger.debug(\n                `[CustomToolsSSEServer:${this.sessionId}] Executing schedule tool for user ${scheduleContext.userId} (${scheduleContext.contextType})`\n              );\n            }\n\n            // Execute generic schedule tool - AI provides structured data\n            const scheduleArgs: ScheduleToolArgs = {\n              action: (args.action as 'create' | 'list' | 'cancel' | 'pause' | 'resume') || 'list',\n              // What to do\n              reminder_text: args.reminder_text as string | undefined,\n              workflow: args.workflow as string | undefined,\n              workflow_inputs: args.workflow_inputs as Record<string, unknown> | undefined,\n              // Where to send\n              target_type: args.target_type as 'channel' | 'dm' | 'thread' | 'user' | undefined,\n              target_id: args.target_id as string | undefined,\n              thread_ts: args.thread_ts as string | undefined,\n              // When to run\n              is_recurring: args.is_recurring as boolean | undefined,\n              cron: args.cron as string | undefined,\n              run_at: args.run_at as string | undefined,\n              original_expression: args.original_expression as string | undefined,\n              // For cancel/pause/resume\n              schedule_id: args.schedule_id as string | undefined,\n            };\n            const scheduleResult = await handleScheduleAction(scheduleArgs, scheduleContext);\n\n            result = scheduleResult.success\n              ? scheduleResult.message\n              : `Error: ${scheduleResult.error}`;\n            break;\n          }\n\n          // Check if this is a workflow tool\n          const tool = this.tools.get(toolName);\n          if (tool && isWorkflowTool(tool)) {\n            // Execute workflow tool\n            if (!this.workflowContext) {\n              throw new Error(\n                `Workflow tool '${toolName}' requires workflow context but none was provided`\n              );\n            }\n\n            if (this.debug) {\n              logger.debug(\n                `[CustomToolsSSEServer:${this.sessionId}] Executing workflow tool: ${toolName}`\n              );\n            }\n\n            const workflowTool = tool as WorkflowToolDefinition;\n            result = await executeWorkflowAsTool(\n              workflowTool.__workflowId,\n              args,\n              this.workflowContext,\n              workflowTool.__argsOverrides\n            );\n          } else {\n            // Execute regular custom tool\n            result = await this.toolExecutor.execute(toolName, args);\n          }\n          break;\n        } catch (error) {\n          const errorMsg = error instanceof Error ? error.message : 'Unknown error';\n          if (attempt >= retryCount) {\n            throw error;\n          }\n          const delay = Math.min(retryDelayMs * Math.pow(2, attempt), 30000);\n          logger.warn(\n            `[CustomToolsSSEServer:${this.sessionId}] Tool ${toolName} failed (attempt ${attempt + 1}/${retryCount + 1}): ${errorMsg}. Retrying in ${delay}ms`\n          );\n          await new Promise(resolve => setTimeout(resolve, delay));\n          attempt++;\n        }\n      }\n\n      // Format result as MCP response\n      const resultText = typeof result === 'string' ? result : JSON.stringify(result, null, 2);\n\n      // Always log tool completion with result details (important for debugging MCP issues)\n      const resultPreview =\n        resultText.length > 500\n          ? `${resultText.substring(0, 250)}...TRUNCATED(${resultText.length} chars)...${resultText.substring(resultText.length - 250)}`\n          : resultText;\n      logger.info(\n        `[CustomToolsSSEServer:${this.sessionId}] Tool ${toolName} completed. Result size: ${resultText.length} chars`\n      );\n      logger.debug(\n        `[CustomToolsSSEServer:${this.sessionId}] Tool ${toolName} result preview: ${resultPreview}`\n      );\n\n      const response: MCPToolCallResponse = {\n        jsonrpc: '2.0',\n        id,\n        result: {\n          content: [\n            {\n              type: 'text',\n              text: resultText,\n            },\n          ],\n        },\n      };\n\n      logger.debug(\n        `[CustomToolsSSEServer:${this.sessionId}] Returning MCP response for ${toolName}, id=${id}, content_length=${resultText.length}`\n      );\n\n      return response;\n    } catch (error) {\n      const errorMsg = error instanceof Error ? error.message : 'Unknown error';\n      logger.error(\n        `[CustomToolsSSEServer:${this.sessionId}] Tool execution failed: ${toolName} - ${errorMsg}`\n      );\n\n      const isValidationError = errorMsg.startsWith('Invalid workflow inputs:');\n\n      return {\n        jsonrpc: '2.0',\n        id,\n        error: {\n          code: isValidationError ? -32602 : -32603,\n          message: isValidationError\n            ? `Invalid tool parameters: ${errorMsg}`\n            : `Internal error during tool execution: ${errorMsg}`,\n        },\n      };\n    } finally {\n      this.activeToolCalls = Math.max(0, this.activeToolCalls - 1);\n      this.lastActivityAt = Date.now();\n      // Release workspace reference after tool execution completes\n      if (workspace) {\n        workspace.release();\n      }\n    }\n  }\n\n  private getEnvNumber(name: string, fallback: number): number {\n    const raw = process.env[name];\n    if (!raw) return fallback;\n    const parsed = parseInt(raw, 10);\n    return Number.isFinite(parsed) ? parsed : fallback;\n  }\n\n  /**\n   * Send error response via SSE\n   */\n  private sendErrorResponse(\n    connection: SSEConnection,\n    id: number | string | null,\n    code: number,\n    message: string,\n    data?: unknown\n  ): void {\n    const errorResponse: MCPMessage = {\n      jsonrpc: '2.0',\n      id: id ?? 'error',\n      error: {\n        code,\n        message,\n        data,\n      },\n    };\n\n    this.sendSSE(connection, 'message', errorResponse);\n  }\n}\n","import { CheckProvider, CheckProviderConfig } from './check-provider.interface';\nimport { PRInfo } from '../pr-analyzer';\nimport { ReviewSummary } from '../reviewer';\nimport { AIReviewService, AIReviewConfig } from '../ai-review-service';\nimport { EnvironmentResolver } from '../utils/env-resolver';\nimport { IssueFilter } from '../issue-filter';\nimport { createExtendedLiquid } from '../liquid-extensions';\nimport fs from 'fs/promises';\nimport path from 'path';\nimport { trace, context as otContext } from '../telemetry/lazy-otel';\nimport {\n  captureCheckInputContext,\n  captureCheckOutput,\n  captureProviderCall,\n  sanitizeContextForTelemetry,\n} from '../telemetry/state-capture';\nimport { CustomToolsSSEServer } from './mcp-custom-sse-server';\nimport { CustomToolDefinition } from '../types/config';\nimport { logger } from '../logger';\nimport {\n  resolveWorkflowToolFromItem,\n  isWorkflowToolReference,\n  WorkflowToolReference,\n  WorkflowToolContext,\n} from './workflow-tool-executor';\nimport { createSecureSandbox, compileAndRun } from '../utils/sandbox';\nimport type Sandbox from '@nyariv/sandboxjs';\nimport { getScheduleToolDefinition } from '../scheduler/schedule-tool';\n// Legacy Slack context extraction for backwards compatibility\nimport { extractSlackContext } from '../slack/schedule-tool-handler';\n\n/**\n * AI-powered check provider using probe agent\n */\nexport class AICheckProvider extends CheckProvider {\n  private aiReviewService: AIReviewService;\n  private liquidEngine: ReturnType<typeof createExtendedLiquid>;\n  private sandbox: Sandbox | null = null;\n\n  constructor() {\n    super();\n    this.aiReviewService = new AIReviewService();\n    this.liquidEngine = createExtendedLiquid();\n  }\n\n  getName(): string {\n    return 'ai';\n  }\n\n  getDescription(): string {\n    return 'AI-powered code review using Google Gemini, Anthropic Claude, OpenAI GPT, or AWS Bedrock models';\n  }\n\n  /** Lightweight debug helper to avoid importing logger here */\n  private logDebug(msg: string): void {\n    try {\n      if (process.env.VISOR_DEBUG === 'true') {\n        // eslint-disable-next-line no-console\n        console.debug(msg);\n      }\n    } catch {\n      // Best-effort only\n    }\n  }\n\n  /** Detect Slack webhook payload and build a lightweight slack context for templates */\n  private buildSlackEventContext(\n    context?: import('./check-provider.interface').ExecutionContext,\n    config?: CheckProviderConfig,\n    prInfo?: PRInfo\n  ): Record<string, unknown> {\n    try {\n      const aiCfg: any = config?.ai || {};\n      if (aiCfg.skip_slack_context === true) return {};\n      const webhook = context?.webhookContext;\n      const map = webhook?.webhookData;\n      if (!map || !(map instanceof Map)) return {};\n      // In Slack socket mode we store the payload under the configured endpoint key.\n      // For template purposes, it is sufficient to inspect the first payload.\n      const first = Array.from(map.values())[0] as any;\n      if (!first || typeof first !== 'object') return {};\n      const ev = first.event;\n      const conv = first.slack_conversation;\n      if (!ev && !conv) return {};\n      // Attach conversation to prInfo so downstream helpers (XML context) can use it\n      if (conv && prInfo) {\n        try {\n          (prInfo as any).slackConversation = conv;\n        } catch {\n          // best-effort only\n        }\n      }\n      return { slack: { event: ev, conversation: conv } };\n    } catch {\n      return {};\n    }\n  }\n\n  async validateConfig(config: unknown): Promise<boolean> {\n    if (!config || typeof config !== 'object') {\n      return false;\n    }\n\n    const cfg = config as CheckProviderConfig;\n\n    // Type must be 'ai'\n    if (cfg.type !== 'ai') {\n      return false;\n    }\n\n    // Check for prompt or focus\n    const prompt = cfg.prompt || cfg.focus;\n    if (typeof prompt !== 'string') {\n      return false;\n    }\n\n    // Focus is now config-driven - any string value is acceptable\n    // No validation needed here as focus is just a hint to the AI\n\n    // Validate AI provider config if present\n    if (cfg.ai) {\n      if (\n        cfg.ai.provider &&\n        !['google', 'anthropic', 'openai', 'bedrock', 'mock'].includes(cfg.ai.provider as string)\n      ) {\n        return false;\n      }\n\n      // Validate mcpServers if present\n      if (cfg.ai.mcpServers) {\n        if (!this.validateMcpServers(cfg.ai.mcpServers)) {\n          return false;\n        }\n      }\n    }\n\n    // Validate check-level MCP servers if present\n    const checkLevelMcpServers = (cfg as CheckProviderConfig & { ai_mcp_servers?: unknown })\n      .ai_mcp_servers;\n    if (checkLevelMcpServers) {\n      if (!this.validateMcpServers(checkLevelMcpServers)) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Validate MCP servers configuration\n   */\n  private validateMcpServers(mcpServers: unknown): boolean {\n    if (typeof mcpServers !== 'object' || mcpServers === null) {\n      return false;\n    }\n\n    for (const serverConfig of Object.values(mcpServers)) {\n      if (!serverConfig || typeof serverConfig !== 'object') {\n        return false;\n      }\n      const config = serverConfig as { command?: unknown; args?: unknown };\n      if (typeof config.command !== 'string') {\n        return false;\n      }\n      if (config.args !== undefined && !Array.isArray(config.args)) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Group files by their file extension for template context\n   */\n  private groupFilesByExtension(\n    files: import('../pr-analyzer').PRFile[]\n  ): Record<string, import('../pr-analyzer').PRFile[]> {\n    const grouped: Record<string, import('../pr-analyzer').PRFile[]> = {};\n\n    files.forEach(file => {\n      const parts = file.filename.split('.');\n      const ext = parts.length > 1 ? parts.pop()?.toLowerCase() || 'noext' : 'noext';\n      if (!grouped[ext]) {\n        grouped[ext] = [];\n      }\n      grouped[ext].push(file);\n    });\n\n    return grouped;\n  }\n\n  /**\n   * Process prompt configuration to resolve final prompt string\n   */\n  private async processPrompt(\n    promptConfig: string,\n    prInfo: PRInfo,\n    eventContext?: Record<string, unknown>,\n    dependencyResults?: Map<string, ReviewSummary>,\n    outputHistory?: Map<string, unknown[]>,\n    args?: Record<string, unknown>,\n    workflowInputs?: Record<string, unknown>\n  ): Promise<string> {\n    let promptContent: string;\n\n    // Auto-detect if it's a file path or inline content\n    if (await this.isFilePath(promptConfig)) {\n      promptContent = await this.loadPromptFromFile(promptConfig);\n    } else {\n      promptContent = promptConfig;\n    }\n\n    // Process Liquid templates in the prompt\n    return await this.renderPromptTemplate(\n      promptContent,\n      prInfo,\n      eventContext,\n      dependencyResults,\n      outputHistory,\n      args,\n      workflowInputs\n    );\n  }\n\n  /**\n   * Detect if a string is likely a file path and if the file exists\n   */\n  private async isFilePath(str: string): Promise<boolean> {\n    // Quick checks to exclude obvious non-file-path content\n    if (!str || str.trim() !== str || str.length > 512) {\n      return false;\n    }\n\n    // Exclude strings that are clearly content (contain common content indicators)\n    // But be more careful with paths that might contain common words as directory names\n    if (\n      /\\s{2,}/.test(str) || // Multiple consecutive spaces\n      /\\n/.test(str) || // Contains newlines\n      /^(please|analyze|review|check|find|identify|look|search)/i.test(str.trim()) || // Starts with command words\n      str.split(' ').length > 8 // Too many words for a typical file path\n    ) {\n      return false;\n    }\n\n    // For strings with path separators, be more lenient about common words\n    // as they might be legitimate directory names\n    if (!/[\\/\\\\]/.test(str)) {\n      // Only apply strict English word filter to non-path strings\n      if (/\\b(the|and|or|but|for|with|by|from|in|on|at|as)\\b/i.test(str)) {\n        return false;\n      }\n    }\n\n    // Positive indicators for file paths\n    const hasFileExtension = /\\.[a-zA-Z0-9]{1,10}$/i.test(str);\n    const hasPathSeparators = /[\\/\\\\]/.test(str);\n    const isRelativePath = /^\\.{1,2}\\//.test(str);\n    const isAbsolutePath = path.isAbsolute(str);\n    const hasTypicalFileChars = /^[a-zA-Z0-9._\\-\\/\\\\:~]+$/.test(str);\n\n    // Must have at least one strong indicator\n    if (!(hasFileExtension || isRelativePath || isAbsolutePath || hasPathSeparators)) {\n      return false;\n    }\n\n    // Must contain only typical file path characters\n    if (!hasTypicalFileChars) {\n      return false;\n    }\n\n    // Additional validation for suspected file paths\n    try {\n      // Try to resolve and check if file exists\n      let resolvedPath: string;\n\n      if (path.isAbsolute(str)) {\n        resolvedPath = path.normalize(str);\n      } else {\n        // Resolve relative to current working directory\n        resolvedPath = path.resolve(process.cwd(), str);\n      }\n\n      // Check if file exists\n      const fs = require('fs').promises;\n      try {\n        const stat = await fs.stat(resolvedPath);\n        return stat.isFile();\n      } catch {\n        // File doesn't exist, but might still be a valid file path format\n        // Return true if it has strong file path indicators\n        return hasFileExtension && (isRelativePath || isAbsolutePath || hasPathSeparators);\n      }\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Load prompt content from file with security validation\n   */\n  private async loadPromptFromFile(promptPath: string): Promise<string> {\n    // Enforce .liquid file extension for all prompt files\n    if (!promptPath.endsWith('.liquid')) {\n      throw new Error('Prompt file must have .liquid extension');\n    }\n\n    let resolvedPath: string;\n\n    if (path.isAbsolute(promptPath)) {\n      // Absolute path - use as-is\n      resolvedPath = promptPath;\n    } else {\n      // Relative path - resolve relative to current working directory\n      resolvedPath = path.resolve(process.cwd(), promptPath);\n    }\n\n    // Security: For relative paths, ensure they don't escape the current directory\n    if (!path.isAbsolute(promptPath)) {\n      const normalizedPath = path.normalize(resolvedPath);\n      const currentDir = path.resolve(process.cwd());\n      if (!normalizedPath.startsWith(currentDir)) {\n        throw new Error('Invalid prompt file path: path traversal detected');\n      }\n    }\n\n    // Security: Check for obvious path traversal patterns\n    if (promptPath.includes('../..')) {\n      throw new Error('Invalid prompt file path: path traversal detected');\n    }\n\n    try {\n      const promptContent = await fs.readFile(resolvedPath, 'utf-8');\n      return promptContent;\n    } catch (error) {\n      throw new Error(\n        `Failed to load prompt from ${resolvedPath}: ${\n          error instanceof Error ? error.message : 'Unknown error'\n        }`\n      );\n    }\n  }\n\n  /**\n   * Render Liquid template in prompt with comprehensive event context\n   */\n  private async renderPromptTemplate(\n    promptContent: string,\n    prInfo: PRInfo,\n    eventContext?: Record<string, unknown>,\n    dependencyResults?: Map<string, ReviewSummary>,\n    outputHistory?: Map<string, unknown[]>,\n    args?: Record<string, unknown>,\n    workflowInputs?: Record<string, unknown>\n  ): Promise<string> {\n    // Build outputs_raw from -raw keys (aggregate parent values)\n    const outputsRaw: Record<string, unknown> = {};\n    if (dependencyResults) {\n      for (const [k, v] of dependencyResults.entries()) {\n        if (typeof k !== 'string') continue;\n        if (k.endsWith('-raw')) {\n          const name = k.slice(0, -4);\n          const summary = v as ReviewSummary & { output?: unknown };\n          outputsRaw[name] = summary.output !== undefined ? summary.output : summary;\n        }\n      }\n    }\n\n    // Note: We intentionally do NOT expose any special `fact_validation` object\n    // in the template context. Templates should derive everything from\n    // outputs / outputs_history / memory helpers to avoid hidden magic.\n\n    // Create comprehensive template context with PR and event information\n    const templateContext = {\n      // PR Information\n      pr: {\n        number: prInfo.number,\n        title: prInfo.title,\n        body: prInfo.body,\n        author: prInfo.author,\n        baseBranch: prInfo.base,\n        headBranch: prInfo.head,\n        isIncremental: prInfo.isIncremental,\n        filesChanged: prInfo.files?.map(f => f.filename) || [],\n        totalAdditions: prInfo.files?.reduce((sum, f) => sum + f.additions, 0) || 0,\n        totalDeletions: prInfo.files?.reduce((sum, f) => sum + f.deletions, 0) || 0,\n        totalChanges: prInfo.files?.reduce((sum, f) => sum + f.changes, 0) || 0,\n        base: prInfo.base,\n        head: prInfo.head,\n      },\n\n      // File Details\n      files: prInfo.files || [],\n      description: prInfo.body || '',\n\n      // GitHub / webhook Event Context\n      event: eventContext\n        ? {\n            name: eventContext.event_name || 'unknown',\n            action: eventContext.action,\n            isPullRequest: !prInfo.isIssue, // Set based on whether this is a PR or an issue\n\n            // Repository Info\n            repository: eventContext.repository\n              ? {\n                  owner: (eventContext.repository as { owner?: { login?: string } })?.owner?.login,\n                  name: (eventContext.repository as { name?: string })?.name,\n                  fullName: eventContext.repository\n                    ? `${(eventContext.repository as { owner?: { login?: string } })?.owner?.login}/${(eventContext.repository as { name?: string })?.name}`\n                    : undefined,\n                }\n              : undefined,\n\n            // Comment Data (for comment events)\n            comment: eventContext.comment\n              ? {\n                  body: (eventContext.comment as { body?: string })?.body,\n                  author: (eventContext.comment as { user?: { login?: string } })?.user?.login,\n                }\n              : undefined,\n\n            // Issue Data (for issue events)\n            issue: eventContext.issue\n              ? {\n                  number: (eventContext.issue as { number?: number })?.number,\n                  title: (eventContext.issue as { title?: string })?.title,\n                  body: (eventContext.issue as { body?: string })?.body,\n                  state: (eventContext.issue as { state?: string })?.state,\n                  author: (eventContext.issue as { user?: { login?: string } })?.user?.login,\n                  labels: (eventContext.issue as { labels?: unknown[] })?.labels || [],\n                  assignees:\n                    (\n                      eventContext as { issue?: { assignees?: Array<{ login: string }> } }\n                    )?.issue?.assignees?.map(a => a.login) || [],\n                  createdAt: (eventContext.issue as { created_at?: string })?.created_at,\n                  updatedAt: (eventContext.issue as { updated_at?: string })?.updated_at,\n                  isPullRequest: !!(eventContext.issue as { pull_request?: unknown })?.pull_request,\n                }\n              : undefined,\n\n            // Pull Request Event Data\n            pullRequest: eventContext.pull_request\n              ? {\n                  number: (eventContext.pull_request as { number?: number })?.number,\n                  state: (eventContext.pull_request as { state?: string })?.state,\n                  draft: (eventContext.pull_request as { draft?: boolean })?.draft,\n                  headSha: (eventContext.pull_request as { head?: { sha?: string } })?.head?.sha,\n                  headRef: (eventContext.pull_request as { head?: { ref?: string } })?.head?.ref,\n                  baseSha: (eventContext.pull_request as { base?: { sha?: string } })?.base?.sha,\n                  baseRef: (eventContext.pull_request as { base?: { ref?: string } })?.base?.ref,\n                }\n              : undefined,\n\n            // Raw event payload for advanced use cases\n            payload: eventContext,\n          }\n        : undefined,\n\n      // Slack conversation context (if provided via eventContext.slack)\n      slack: (() => {\n        try {\n          const anyCtx = eventContext as any;\n          const slack = anyCtx?.slack;\n          if (slack && typeof slack === 'object') return slack;\n        } catch {\n          // ignore\n        }\n        return undefined;\n      })(),\n\n      // Unified conversation context across transports (Slack & GitHub)\n      conversation: (() => {\n        try {\n          const anyCtx = eventContext as any;\n          if (anyCtx?.slack?.conversation) return anyCtx.slack.conversation;\n          if (anyCtx?.github?.conversation) return anyCtx.github.conversation;\n          if (anyCtx?.conversation) return anyCtx.conversation;\n        } catch {\n          // ignore\n        }\n        return undefined;\n      })(),\n\n      // Utility data for templates\n      utils: {\n        // Date/time helpers\n        now: new Date().toISOString(),\n        today: new Date().toISOString().split('T')[0],\n\n        // Dynamic file grouping by extension\n        filesByExtension: this.groupFilesByExtension(prInfo.files || []),\n\n        // File status categorizations\n        addedFiles: (prInfo.files || []).filter(f => f.status === 'added'),\n        modifiedFiles: (prInfo.files || []).filter(f => f.status === 'modified'),\n        removedFiles: (prInfo.files || []).filter(f => f.status === 'removed'),\n        renamedFiles: (prInfo.files || []).filter(f => f.status === 'renamed'),\n\n        // Change analysis\n        hasLargeChanges: (prInfo.files || []).some(f => f.changes > 50),\n        totalFiles: (prInfo.files || []).length,\n      },\n\n      // Checks metadata for helpers like chat_history\n      checks_meta: (() => {\n        try {\n          return (eventContext as any)?.__checksMeta || undefined;\n        } catch {\n          return undefined;\n        }\n      })(),\n\n      // Previous check outputs (dependency results)\n      // Expose raw output directly if available, otherwise expose the result as-is\n      outputs: dependencyResults\n        ? Object.fromEntries(\n            Array.from(dependencyResults.entries()).map(([checkName, result]) => [\n              checkName,\n              (() => {\n                const summary = result as ReviewSummary & { output?: unknown };\n                return summary.output !== undefined ? summary.output : summary;\n              })(),\n            ])\n          )\n        : {},\n      // Alias for consistency with other providers\n      outputs_history: (() => {\n        const hist: Record<string, unknown[]> = {};\n        if (outputHistory) {\n          for (const [k, v] of outputHistory.entries()) hist[k] = v;\n        }\n        return hist;\n      })(),\n      // Stage-scoped history slice calculated from baseline captured by the flow runner.\n      outputs_history_stage: (() => {\n        const stage: Record<string, unknown[]> = {};\n        try {\n          const base = (eventContext as any)?.__stageHistoryBase as\n            | Record<string, number>\n            | undefined;\n          if (!outputHistory || !base) return stage;\n          for (const [k, v] of outputHistory.entries()) {\n            const start = base[k] || 0;\n            const arr = Array.isArray(v) ? (v as unknown[]) : [];\n            stage[k] = arr.slice(start);\n          }\n        } catch {}\n        return stage;\n      })(),\n      // New: outputs_raw exposes aggregate values (e.g., full arrays for forEach parents)\n      outputs_raw: outputsRaw,\n      // Custom arguments from on_init 'with' directive\n      args: args || {},\n      // Workflow inputs (for nested workflow steps to access parent inputs like {{ inputs.context }})\n      inputs: workflowInputs || {},\n    };\n\n    try {\n      if (process.env.VISOR_DEBUG === 'true') {\n        const outKeys = Object.keys((templateContext as any).outputs || {}).join(', ');\n        const histKeys = Object.keys((templateContext as any).outputs_history || {}).join(', ');\n        const inputsKeys = Object.keys((templateContext as any).inputs || {}).join(', ');\n        console.error(\n          `[prompt-ctx] outputs.keys=${outKeys} hist.keys=${histKeys} inputs.keys=${inputsKeys}`\n        );\n        // Log projects specifically if present\n        const projects = (templateContext as any).inputs?.projects;\n        if (projects) {\n          console.error(\n            `[prompt-ctx] inputs.projects has ${Array.isArray(projects) ? projects.length : 'N/A'} items`\n          );\n        }\n      }\n    } catch {}\n\n    try {\n      return await this.liquidEngine.parseAndRender(promptContent, templateContext);\n    } catch (error) {\n      // Always show a helpful snippet with a caret, similar to YAML errors\n      const err: any = error || {};\n      const lines = String(promptContent || '').split(/\\r?\\n/);\n      const lineNum: number = Number(err.line || err?.token?.line || err?.location?.line || 0);\n      const colNum: number = Number(err.col || err?.token?.col || err?.location?.col || 0);\n      let snippet = '';\n      if (lineNum > 0) {\n        const start = Math.max(1, lineNum - 3);\n        const end = Math.max(lineNum + 2, lineNum);\n        const width = String(end).length;\n        for (let i = start; i <= Math.min(end, lines.length); i++) {\n          const ln = `${String(i).padStart(width, ' ')} | ${lines[i - 1] ?? ''}`;\n          snippet += ln + '\\n';\n          if (i === lineNum) {\n            const caretPad = ' '.repeat(Math.max(0, colNum > 1 ? colNum - 1 : 0) + width + 3);\n            snippet += caretPad + '^\\n';\n          }\n        }\n      } else {\n        // Fallback preview of the first 20 lines\n        const preview = lines\n          .slice(0, 20)\n          .map((l, i) => `${(i + 1).toString().padStart(3, ' ')} | ${l}`)\n          .join('\\n');\n        snippet = preview + '\\n';\n      }\n      const msg = `Failed to render prompt template: ${\n        error instanceof Error ? error.message : 'Unknown error'\n      }`;\n      // Print a clear, user-friendly error with context\n      try {\n        console.error('\\n[prompt-error] ' + msg + '\\n' + snippet);\n      } catch {}\n      throw new Error(msg);\n    }\n  }\n\n  /**\n   * Render Liquid templates in schema definitions\n   * Supports dynamic enum values and other template-driven schema properties\n   */\n  private async renderSchema(\n    schema: string | Record<string, unknown> | undefined,\n    prInfo: PRInfo,\n    _eventContext?: Record<string, unknown>,\n    dependencyResults?: Map<string, ReviewSummary>,\n    outputHistory?: Map<string, unknown[]>,\n    args?: Record<string, unknown>,\n    workflowInputs?: Record<string, unknown>\n  ): Promise<string | Record<string, unknown> | undefined> {\n    if (!schema) return schema;\n\n    let schemaStr: string;\n\n    if (typeof schema === 'string') {\n      // Check if string schema contains Liquid templates\n      if (!schema.includes('{{') && !schema.includes('{%')) {\n        // No Liquid templates, return as-is (could be a schema reference like 'code-review')\n        return schema;\n      }\n      // String schema with Liquid templates (e.g., JSON string in YAML)\n      schemaStr = schema;\n    } else {\n      // For object schemas, check if they contain Liquid templates\n      schemaStr = JSON.stringify(schema);\n      if (!schemaStr.includes('{{') && !schemaStr.includes('{%')) {\n        // No Liquid templates, return as-is\n        return schema;\n      }\n    }\n\n    // Build the same template context as renderPromptTemplate\n    const outputsRaw: Record<string, unknown> = {};\n    if (dependencyResults) {\n      for (const [k, v] of dependencyResults.entries()) {\n        if (typeof k !== 'string') continue;\n        if (k.endsWith('-raw')) {\n          const name = k.slice(0, -4);\n          const summary = v as ReviewSummary & { output?: unknown };\n          outputsRaw[name] = summary.output !== undefined ? summary.output : summary;\n        }\n      }\n    }\n\n    const templateContext = {\n      pr: {\n        number: prInfo.number,\n        title: prInfo.title,\n        body: prInfo.body,\n        author: prInfo.author,\n        baseBranch: prInfo.base,\n        headBranch: prInfo.head,\n        isIncremental: prInfo.isIncremental,\n        filesChanged: prInfo.files?.map(f => f.filename) || [],\n        totalAdditions: prInfo.files?.reduce((sum, f) => sum + f.additions, 0) || 0,\n        totalDeletions: prInfo.files?.reduce((sum, f) => sum + f.deletions, 0) || 0,\n        totalChanges: prInfo.files?.reduce((sum, f) => sum + f.changes, 0) || 0,\n        base: prInfo.base,\n        head: prInfo.head,\n      },\n      files: prInfo.files || [],\n      description: prInfo.body || '',\n      outputs: dependencyResults\n        ? Object.fromEntries(\n            Array.from(dependencyResults.entries()).map(([checkName, result]) => [\n              checkName,\n              (() => {\n                const summary = result as ReviewSummary & { output?: unknown };\n                return summary.output !== undefined ? summary.output : summary;\n              })(),\n            ])\n          )\n        : {},\n      outputs_history: (() => {\n        const hist: Record<string, unknown[]> = {};\n        if (outputHistory) {\n          for (const [k, v] of outputHistory.entries()) hist[k] = v;\n        }\n        return hist;\n      })(),\n      outputs_raw: outputsRaw,\n      args: args || {},\n      inputs: workflowInputs || {},\n    };\n\n    try {\n      if (process.env.VISOR_DEBUG === 'true') {\n        logger.debug(`[schema-render] Rendering schema with Liquid templates`);\n        logger.debug(\n          `[schema-render] inputs.projects count: ${Array.isArray((templateContext as any).inputs?.projects) ? (templateContext as any).inputs.projects.length : 'N/A'}`\n        );\n      }\n\n      const renderedStr = await this.liquidEngine.parseAndRender(schemaStr, templateContext);\n\n      // Parse the rendered JSON back to an object\n      try {\n        const parsed = JSON.parse(renderedStr);\n        if (process.env.VISOR_DEBUG === 'true') {\n          logger.debug(`[schema-render] Successfully rendered schema`);\n        }\n        return parsed;\n      } catch (parseError) {\n        const errorMsg = parseError instanceof Error ? parseError.message : String(parseError);\n        // Log full rendered string for debugging (up to 2000 chars to avoid log flooding)\n        const preview =\n          renderedStr.length > 2000\n            ? renderedStr.substring(0, 2000) + '...[truncated]'\n            : renderedStr;\n        logger.error(`[schema-render] JSON_PARSE_ERROR: Failed to parse rendered schema as JSON`);\n        logger.error(`[schema-render] Parse error: ${errorMsg}`);\n        logger.error(`[schema-render] Original schema type: ${typeof schema}`);\n        logger.error(`[schema-render] Rendered output (${renderedStr.length} chars):\\n${preview}`);\n        // Throw error to make configuration issues visible rather than silently falling back\n        throw new Error(\n          `Schema template rendered invalid JSON: ${errorMsg}. ` +\n            `Check Liquid template syntax. Rendered output starts with: \"${renderedStr.substring(0, 100)}...\"`\n        );\n      }\n    } catch (error) {\n      // Re-throw JSON parse errors (already formatted above)\n      if (\n        error instanceof Error &&\n        error.message.includes('Schema template rendered invalid JSON')\n      ) {\n        throw error;\n      }\n      // Handle Liquid rendering errors\n      const errorMsg = error instanceof Error ? error.message : 'Unknown error';\n      logger.error(`[schema-render] LIQUID_RENDER_ERROR: Failed to render schema template`);\n      logger.error(`[schema-render] Error: ${errorMsg}`);\n      logger.error(\n        `[schema-render] Original schema: ${schemaStr.substring(0, 500)}${schemaStr.length > 500 ? '...[truncated]' : ''}`\n      );\n      // Throw error to make template syntax issues visible\n      throw new Error(\n        `Schema Liquid template error: ${errorMsg}. ` +\n          `Check template syntax in schema definition.`\n      );\n    }\n  }\n\n  async execute(\n    prInfo: PRInfo,\n    config: CheckProviderConfig,\n    _dependencyResults?: Map<string, ReviewSummary>,\n    sessionInfo?: { parentSessionId?: string; reuseSession?: boolean }\n  ): Promise<ReviewSummary> {\n    // Apply environment configuration if present\n    if (config.env) {\n      const result = EnvironmentResolver.withTemporaryEnv(config.env, () => {\n        // This will be executed with the temporary environment\n        return this.executeWithConfig(prInfo, config, _dependencyResults, sessionInfo);\n      });\n\n      if (result instanceof Promise) {\n        return result;\n      }\n      return result;\n    }\n\n    return this.executeWithConfig(prInfo, config, _dependencyResults, sessionInfo);\n  }\n\n  private async executeWithConfig(\n    prInfo: PRInfo,\n    config: CheckProviderConfig,\n    _dependencyResults?: Map<string, ReviewSummary>,\n    sessionInfo?: {\n      parentSessionId?: string;\n      reuseSession?: boolean;\n    } & import('./check-provider.interface').ExecutionContext\n  ): Promise<ReviewSummary> {\n    try {\n      if (process.env.VISOR_DEBUG === 'true') {\n        console.error(`[ai-exec] step=${String((config as any).checkName || 'unknown')}`);\n      }\n    } catch {}\n    // Extract AI configuration - only set properties that are explicitly provided.\n    // Workspace / allowedFolders will be derived below from the execution context.\n    const aiConfig: AIReviewConfig = {};\n\n    // Check-level AI configuration (ai object)\n    if (config.ai) {\n      const aiAny: any = config.ai;\n      const skipTransport: boolean = aiAny.skip_transport_context === true;\n      // Only set properties that are actually defined to avoid overriding env vars\n      if (aiAny.apiKey !== undefined) {\n        aiConfig.apiKey = aiAny.apiKey as string;\n      }\n      if (aiAny.model !== undefined) {\n        aiConfig.model = aiAny.model as string;\n      }\n      if (aiAny.timeout !== undefined) {\n        aiConfig.timeout = aiAny.timeout as number;\n      }\n      if (aiAny.max_iterations !== undefined || aiAny.maxIterations !== undefined) {\n        const raw = aiAny.max_iterations ?? aiAny.maxIterations;\n        aiConfig.maxIterations = Number(raw);\n      }\n      if (aiAny.provider !== undefined) {\n        aiConfig.provider = aiAny.provider as\n          | 'google'\n          | 'anthropic'\n          | 'openai'\n          | 'bedrock'\n          | 'mock';\n      }\n      if (aiAny.debug !== undefined) {\n        aiConfig.debug = aiAny.debug as boolean;\n      }\n      if (aiAny.enableDelegate !== undefined) {\n        aiConfig.enableDelegate = aiAny.enableDelegate as boolean;\n      }\n      if (aiAny.enableTasks !== undefined) {\n        aiConfig.enableTasks = aiAny.enableTasks as boolean;\n      }\n      if (aiAny.allowEdit !== undefined) {\n        aiConfig.allowEdit = aiAny.allowEdit as boolean;\n      }\n      if (aiAny.allowedTools !== undefined) {\n        aiConfig.allowedTools = aiAny.allowedTools as string[];\n        this.logDebug(\n          `[AI Provider] Read allowedTools from YAML: ${JSON.stringify(aiAny.allowedTools)}`\n        );\n      }\n      if (aiAny.disableTools !== undefined) {\n        aiConfig.disableTools = aiAny.disableTools as boolean;\n        this.logDebug(`[AI Provider] Read disableTools from YAML: ${aiAny.disableTools}`);\n      }\n      if (aiAny.allowBash !== undefined) {\n        aiConfig.allowBash = aiAny.allowBash as boolean;\n      }\n      if (aiAny.bashConfig !== undefined) {\n        aiConfig.bashConfig = aiAny.bashConfig as import('../types/config').BashConfig;\n      }\n      if (aiAny.completion_prompt !== undefined) {\n        aiConfig.completionPrompt = aiAny.completion_prompt as string;\n      }\n      if (aiAny.skip_code_context !== undefined) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (aiConfig as any).skip_code_context = aiAny.skip_code_context as boolean;\n      } else if (skipTransport) {\n        (aiConfig as any).skip_code_context = true;\n      }\n      // Optional: allow disabling Slack context separately from PR/code context\n      if (aiAny.skip_slack_context !== undefined) {\n        (aiConfig as any).skip_slack_context = aiAny.skip_slack_context as boolean;\n      } else if (skipTransport) {\n        (aiConfig as any).skip_slack_context = true;\n      }\n      if (aiAny.retry !== undefined) {\n        aiConfig.retry = aiAny.retry as import('../types/config').AIRetryConfig;\n      }\n      if (aiAny.fallback !== undefined) {\n        aiConfig.fallback = aiAny.fallback as import('../types/config').AIFallbackConfig;\n      }\n    }\n\n    // Derive workspace-aware allowedFolders for ProbeAgent when workspace\n    // isolation is enabled. This ensures tools like search/query operate\n    // inside the isolated workspace (and its project symlinks) instead of\n    // the Visor repository root.\n    // Folder names are human-readable (tyk-docs, visor2) thanks to WorkspaceManager.\n    try {\n      const ctxAny: any = sessionInfo as any;\n      const parentCtx = ctxAny?._parentContext;\n      const workspace = parentCtx?.workspace;\n\n      // Enhanced debug logging for workspace propagation diagnosis\n      logger.debug(\n        `[AI Provider] Workspace detection for check '${(config as any).checkName || 'unknown'}':`\n      );\n      logger.debug(`[AI Provider]   sessionInfo exists: ${!!sessionInfo}`);\n      logger.debug(`[AI Provider]   _parentContext exists: ${!!parentCtx}`);\n      logger.debug(`[AI Provider]   workspace exists: ${!!workspace}`);\n      if (workspace) {\n        logger.debug(\n          `[AI Provider]   workspace.isEnabled exists: ${typeof workspace.isEnabled === 'function'}`\n        );\n        logger.debug(\n          `[AI Provider]   workspace.isEnabled(): ${typeof workspace.isEnabled === 'function' ? workspace.isEnabled() : 'N/A'}`\n        );\n        const projectCount =\n          typeof workspace.listProjects === 'function' ? workspace.listProjects()?.length : 'N/A';\n        logger.debug(`[AI Provider]   workspace.listProjects() count: ${projectCount}`);\n      }\n\n      if (workspace && typeof workspace.isEnabled === 'function' && workspace.isEnabled()) {\n        const folders: string[] = [];\n        let workspaceRoot: string | undefined;\n        let mainProjectPath: string | undefined;\n        try {\n          const info = workspace.getWorkspaceInfo?.();\n          if (info && typeof info.workspacePath === 'string') {\n            workspaceRoot = info.workspacePath;\n            mainProjectPath = info.mainProjectPath;\n            // Add workspace root first so allowedFolders[0] is the workspace root.\n            // This keeps compatibility with ProbeAgent's legacy default cwd behavior,\n            // while we also set explicit path/cwd below.\n            folders.push(info.workspacePath);\n            // NOTE: We intentionally do NOT add mainProjectPath here.\n            // Inclusion of the main project is controlled below via\n            // workspace.include_main_project / VISOR_WORKSPACE_INCLUDE_MAIN_PROJECT.\n          }\n        } catch {\n          // ignore workspace info errors\n        }\n        // Collect checked-out projects (these are the user's actual projects)\n        const projectPaths: string[] = [];\n        try {\n          const projects = workspace.listProjects?.() || [];\n          for (const proj of projects as any[]) {\n            if (proj && typeof proj.path === 'string') {\n              // Project paths have human-readable names (tyk-docs, not checkout-tyk-docs)\n              folders.push(proj.path);\n              projectPaths.push(proj.path);\n            }\n          }\n        } catch {\n          // ignore project listing errors\n        }\n        // Only include the main project when explicitly enabled.\n        const workspaceCfg = parentCtx?.config?.workspace as\n          | { include_main_project?: boolean }\n          | undefined;\n        const includeMainProject =\n          workspaceCfg?.include_main_project === true ||\n          process.env.VISOR_WORKSPACE_INCLUDE_MAIN_PROJECT === 'true';\n        if (includeMainProject && mainProjectPath) {\n          folders.push(mainProjectPath);\n          logger.debug(`[AI Provider] Including main project (enabled): ${mainProjectPath}`);\n        } else if (mainProjectPath) {\n          logger.debug(`[AI Provider] Excluding main project (disabled): ${mainProjectPath}`);\n        }\n        const unique = Array.from(new Set(folders.filter(p => typeof p === 'string' && p)));\n        if (unique.length > 0 && workspaceRoot) {\n          if (unique[0] !== workspaceRoot) {\n            logger.warn(\n              `[AI Provider] allowedFolders[0] is not workspaceRoot; tooling defaults may be mis-scoped`\n            );\n          }\n          (aiConfig as any).allowedFolders = unique;\n          // Use workspace root as cwd so tools default to the workspace root.\n          // Both are set for compatibility: path for older probe versions, cwd for rc175+.\n          const aiCwd = workspaceRoot;\n          (aiConfig as any).path = aiCwd;\n          (aiConfig as any).cwd = aiCwd;\n          (aiConfig as any).workspacePath = aiCwd;\n          logger.debug(`[AI Provider] Workspace isolation enabled:`);\n          logger.debug(`[AI Provider]   cwd (workspaceRoot): ${aiCwd}`);\n          logger.debug(`[AI Provider]   workspaceRoot: ${workspaceRoot}`);\n          logger.debug(`[AI Provider]   allowedFolders: ${JSON.stringify(unique)}`);\n        }\n      } else if (parentCtx && typeof parentCtx.workingDirectory === 'string') {\n        // Fallback: when workspace is not available (or disabled), still\n        // constrain tools to the engine's working directory so ProbeAgent\n        // operates inside the same logical root as the state machine. This\n        // also ensures nested workflows (e.g. code-question-helper) use the\n        // workspace main project path once initializeWorkspace has updated\n        // the parent context.\n        if (!(aiConfig as any).allowedFolders) {\n          (aiConfig as any).allowedFolders = [parentCtx.workingDirectory];\n        }\n        if (!(aiConfig as any).path) {\n          (aiConfig as any).path = parentCtx.workingDirectory;\n          (aiConfig as any).cwd = parentCtx.workingDirectory;\n        }\n      }\n    } catch {\n      // Best-effort only; fall back to defaults on error.\n    }\n\n    // Check-level AI model and provider (top-level properties)\n    if (config.ai_model !== undefined) {\n      aiConfig.model = config.ai_model as string;\n    }\n    if (config.ai_provider !== undefined) {\n      aiConfig.provider = config.ai_provider as\n        | 'google'\n        | 'anthropic'\n        | 'openai'\n        | 'bedrock'\n        | 'mock';\n    }\n    if (config.ai_max_iterations !== undefined && aiConfig.maxIterations === undefined) {\n      aiConfig.maxIterations = config.ai_max_iterations as number;\n    }\n\n    // Pass shared concurrency limiter for global AI call gating\n    const sharedLimiter = (sessionInfo as any)?._parentContext?.sharedConcurrencyLimiter;\n    if (sharedLimiter) {\n      aiConfig.concurrencyLimiter = sharedLimiter;\n    }\n\n    // Policy engine: capability enforcement\n    const policyEngine = (sessionInfo as any)?._parentContext?.policyEngine;\n    if (policyEngine) {\n      try {\n        const checkName = (config as any).checkName || 'unknown';\n        const decision = await policyEngine.evaluateCapabilities(checkName, {\n          allowEdit: aiConfig.allowEdit,\n          allowBash: aiConfig.allowBash,\n          allowedTools: aiConfig.allowedTools,\n        });\n        if (decision.capabilities) {\n          if (decision.capabilities.allowEdit === false) aiConfig.allowEdit = false;\n          if (decision.capabilities.allowBash === false) aiConfig.allowBash = false;\n          if (decision.capabilities.allowedTools) {\n            if (aiConfig.allowedTools) {\n              // Intersect: policy can only restrict, not expand\n              aiConfig.allowedTools = aiConfig.allowedTools.filter((t: string) =>\n                decision.capabilities!.allowedTools!.includes(t)\n              );\n            } else {\n              aiConfig.allowedTools = decision.capabilities.allowedTools;\n            }\n          }\n        }\n      } catch (err) {\n        // Policy evaluation failed â€” continue without filtering\n        try {\n          const { logger } = require('../logger');\n          logger.warn(\n            `[PolicyEngine] Capability evaluation failed: ${err instanceof Error ? err.message : err}`\n          );\n        } catch {}\n      }\n    }\n\n    // Get custom prompt from config - REQUIRED, no fallbacks\n    const customPrompt = config.prompt;\n\n    if (!customPrompt) {\n      throw new Error(\n        `No prompt defined for check. All checks must have prompts defined in .visor.yaml configuration.`\n      );\n    }\n\n    // Setup MCP tools from multiple configuration levels\n    const mcpServers: Record<string, import('../types/config').McpServerConfig> = {};\n\n    // 1. Start with global MCP servers (from visor config root)\n    const globalConfig = config as CheckProviderConfig & {\n      ai_mcp_servers?: Record<string, import('../types/config').McpServerConfig>;\n    };\n    if (globalConfig.ai_mcp_servers) {\n      Object.assign(mcpServers, globalConfig.ai_mcp_servers);\n    }\n\n    // 2. Add check-level MCP servers (overrides global)\n    if (config.ai_mcp_servers) {\n      Object.assign(mcpServers, config.ai_mcp_servers);\n    }\n\n    // 3. Add ai.mcpServers (overrides everything)\n    if (config.ai?.mcpServers) {\n      Object.assign(mcpServers, config.ai.mcpServers);\n    }\n\n    // 4. Evaluate ai_mcp_servers_js for dynamic MCP server selection (overrides all static configs)\n    const mcpServersJsExpr = (config as any).ai_mcp_servers_js as string | undefined;\n    logger.info(\n      `[AICheckProvider] ai_mcp_servers_js check: hasExpr=${!!mcpServersJsExpr}, hasDeps=${!!_dependencyResults}, depsSize=${_dependencyResults?.size ?? 0}`\n    );\n    if (mcpServersJsExpr && _dependencyResults) {\n      try {\n        const dynamicServers = this.evaluateMcpServersJs(\n          mcpServersJsExpr,\n          prInfo,\n          _dependencyResults,\n          config\n        );\n        if (Object.keys(dynamicServers).length > 0) {\n          Object.assign(mcpServers, dynamicServers);\n        }\n      } catch (error) {\n        logger.error(\n          `[AICheckProvider] Failed to evaluate ai_mcp_servers_js: ${error instanceof Error ? error.message : 'Unknown error'}`\n        );\n        // Continue without dynamic servers\n      }\n    }\n\n    // 5. Resolve environment variable placeholders in MCP server env configs\n    // Supports ${VAR} and ${{ env.VAR }} syntax\n    for (const serverConfig of Object.values(mcpServers)) {\n      if (serverConfig.env) {\n        const resolvedEnv: Record<string, string> = {};\n        for (const [key, value] of Object.entries(serverConfig.env)) {\n          if (typeof value === 'string') {\n            resolvedEnv[key] = String(EnvironmentResolver.resolveValue(value));\n          } else {\n            resolvedEnv[key] = String(value);\n          }\n        }\n        serverConfig.env = resolvedEnv;\n      }\n    }\n\n    // 6. Setup custom tools SSE server if MCP servers reference custom tools\n    // Check for ai_custom_tools_js (dynamic), ai_custom_tools (static), and tools: in MCP servers\n    let customToolsServer: CustomToolsSSEServer | null = null;\n    let customToolsToLoad: Array<string | WorkflowToolReference> = [];\n    let customToolsServerName: string | null = null;\n\n    // Option 1: Check for ai_custom_tools_js (dynamic JavaScript expression)\n    const customToolsJsExpr = (config as any).ai_custom_tools_js as string | undefined;\n    if (customToolsJsExpr && _dependencyResults) {\n      try {\n        const dynamicTools = this.evaluateCustomToolsJs(\n          customToolsJsExpr,\n          prInfo,\n          _dependencyResults,\n          config\n        );\n        if (dynamicTools.length > 0) {\n          customToolsToLoad = dynamicTools;\n          customToolsServerName = '__custom_tools__';\n          logger.debug(\n            `[AICheckProvider] ai_custom_tools_js evaluated to ${dynamicTools.length} tools`\n          );\n        }\n      } catch (error) {\n        logger.error(\n          `[AICheckProvider] Failed to evaluate ai_custom_tools_js: ${error instanceof Error ? error.message : 'Unknown error'}`\n        );\n        // Continue without dynamic tools, fallback to static\n      }\n    }\n\n    // Option 2: Check for ai_custom_tools (static - backward compatible)\n    // Merge with dynamic tools if both are specified\n    const staticCustomTools = this.getCustomToolsForAI(config);\n    if (staticCustomTools.length > 0) {\n      if (customToolsToLoad.length > 0) {\n        // Merge dynamic and static tools (avoid duplicates by name)\n        const existingNames = new Set(\n          customToolsToLoad.map(item => (typeof item === 'string' ? item : item.workflow))\n        );\n        for (const tool of staticCustomTools) {\n          const name = typeof tool === 'string' ? tool : tool.workflow;\n          if (!existingNames.has(name)) {\n            customToolsToLoad.push(tool);\n          }\n        }\n      } else {\n        customToolsToLoad = staticCustomTools;\n        customToolsServerName = '__custom_tools__';\n      }\n    }\n\n    // Option 3: Check if any MCP server uses \"tools:\" format (preferred - reuses ai_mcp_servers)\n    // Note: This format only supports string tool names, not workflow references\n    for (const [serverName, serverConfig] of Object.entries(mcpServers)) {\n      if ((serverConfig as any).tools && Array.isArray((serverConfig as any).tools)) {\n        customToolsToLoad = (serverConfig as any).tools as string[];\n        customToolsServerName = serverName;\n        break; // Only support one custom tools server per check\n      }\n    }\n\n    // Option 4: Extract workflow and tool entries from ai_mcp_servers/ai_mcp_servers_js\n    // Unified format:\n    //   { workflow: 'name', inputs: {...} } â†’ workflow tool\n    //   { tool: 'name' } â†’ custom tool from tools: section or built-in (e.g., 'schedule')\n    const workflowEntriesFromMcp: WorkflowToolReference[] = [];\n    const toolEntriesFromMcp: string[] = [];\n    const mcpEntriesToRemove: string[] = [];\n\n    for (const [serverName, serverConfig] of Object.entries(mcpServers)) {\n      const cfg = serverConfig as unknown as Record<string, unknown>;\n\n      if (cfg.workflow && typeof cfg.workflow === 'string') {\n        // Workflow tool entry\n        workflowEntriesFromMcp.push({\n          workflow: cfg.workflow as string,\n          args: cfg.inputs as Record<string, unknown> | undefined,\n        });\n        mcpEntriesToRemove.push(serverName);\n        logger.debug(\n          `[AICheckProvider] Extracted workflow tool '${serverName}' (workflow=${cfg.workflow}) from ai_mcp_servers`\n        );\n      } else if (cfg.tool && typeof cfg.tool === 'string') {\n        // Custom tool or built-in tool entry\n        toolEntriesFromMcp.push(cfg.tool as string);\n        mcpEntriesToRemove.push(serverName);\n        logger.debug(`[AICheckProvider] Extracted tool '${cfg.tool}' from ai_mcp_servers`);\n      }\n    }\n\n    // Remove extracted entries from mcpServers (they'll be exposed via SSE server)\n    for (const name of mcpEntriesToRemove) {\n      delete mcpServers[name];\n    }\n\n    // Merge workflow entries with custom tools\n    if (workflowEntriesFromMcp.length > 0) {\n      const existingNames = new Set(\n        customToolsToLoad.map(item => (typeof item === 'string' ? item : item.workflow))\n      );\n      for (const wf of workflowEntriesFromMcp) {\n        if (!existingNames.has(wf.workflow)) {\n          customToolsToLoad.push(wf);\n        }\n      }\n      if (!customToolsServerName) {\n        customToolsServerName = '__tools__';\n      }\n    }\n\n    // Merge tool entries with custom tools\n    if (toolEntriesFromMcp.length > 0) {\n      const existingNames = new Set(\n        customToolsToLoad.map(item => (typeof item === 'string' ? item : item.workflow))\n      );\n      for (const toolName of toolEntriesFromMcp) {\n        if (!existingNames.has(toolName)) {\n          customToolsToLoad.push(toolName);\n        }\n      }\n      if (!customToolsServerName) {\n        customToolsServerName = '__tools__';\n      }\n    }\n\n    // Option 5: Handle built-in tools (currently just 'schedule')\n    const sessionAny = sessionInfo as any;\n    const webhookData =\n      sessionAny?.webhookContext?.webhookData ||\n      sessionAny?._parentContext?.webhookContext?.webhookData;\n    const slackContext = webhookData\n      ? extractSlackContext(webhookData as Map<string, unknown>)\n      : null;\n\n    // Check if \"schedule\" is requested in custom tools (from ai_custom_tools, ai_custom_tools_js, or ai_mcp_servers)\n    const scheduleToolRequested =\n      !config.ai?.disableTools &&\n      customToolsToLoad.some(\n        tool => tool === 'schedule' || (typeof tool === 'object' && tool.workflow === 'schedule')\n      );\n\n    if (scheduleToolRequested) {\n      // Remove \"schedule\" from customToolsToLoad - we'll add the real built-in tool later\n      customToolsToLoad = customToolsToLoad.filter(\n        tool => tool !== 'schedule' && !(typeof tool === 'object' && tool.workflow === 'schedule')\n      );\n      if (!customToolsServerName) {\n        customToolsServerName = '__tools__';\n      }\n      const contextInfo = slackContext\n        ? `user=${slackContext.userId}, channelType=${slackContext.channelType}`\n        : 'cli';\n      logger.debug(`[AICheckProvider] Schedule tool requested (${contextInfo})`);\n    }\n\n    // Legacy support: enable_scheduler: true also enables the schedule tool\n    const scheduleToolEnabled =\n      scheduleToolRequested || (config.ai?.enable_scheduler === true && !config.ai?.disableTools);\n\n    if (\n      (customToolsToLoad.length > 0 || scheduleToolEnabled) &&\n      (customToolsServerName || scheduleToolEnabled) &&\n      !config.ai?.disableTools\n    ) {\n      if (!customToolsServerName) {\n        customToolsServerName = '__tools__';\n      }\n      try {\n        // Load custom tools from global config (supports workflows and custom tools)\n        const customTools = this.loadCustomTools(customToolsToLoad, config);\n\n        // Add schedule tool if enabled (via ai_mcp_servers { tool: 'schedule' } or enable_scheduler)\n        if (scheduleToolEnabled) {\n          const scheduleTool = getScheduleToolDefinition();\n          customTools.set(scheduleTool.name, scheduleTool);\n          logger.debug(`[AICheckProvider] Added built-in schedule tool`);\n        }\n\n        if (customTools.size > 0) {\n          const sessionId = (config as any).checkName || `ai-check-${Date.now()}`;\n          const debug = aiConfig.debug || process.env.VISOR_DEBUG === 'true';\n\n          // Build workflow context for workflow tools\n          // Include workspace for reference counting during async MCP tool calls\n          const parentCtxForTools = (sessionInfo as any)?._parentContext;\n          const workflowContext: WorkflowToolContext = {\n            prInfo,\n            outputs: _dependencyResults,\n            executionContext: sessionInfo as import('./check-provider.interface').ExecutionContext,\n            workspace: parentCtxForTools?.workspace,\n          };\n\n          customToolsServer = new CustomToolsSSEServer(\n            customTools,\n            sessionId,\n            debug,\n            workflowContext\n          );\n          const port = await customToolsServer.start();\n\n          if (debug) {\n            logger.debug(\n              `[AICheckProvider] Started custom tools SSE server '${customToolsServerName}' on port ${port} for ${customTools.size} tools`\n            );\n          }\n\n          // Update the server config to use the ephemeral SSE endpoint\n          // Use ai.timeout from config if set, otherwise default to 30 minutes for workflow tools\n          // (code checkouts + AI exploration can legitimately take 15-20 minutes)\n          const workflowToolTimeout = (config.ai as any)?.timeout || 1800000;\n          mcpServers[customToolsServerName] = {\n            command: '',\n            args: [],\n            url: `http://localhost:${port}/sse`,\n            transport: 'sse',\n            timeout: workflowToolTimeout,\n          } as any;\n        }\n      } catch (error) {\n        logger.error(\n          `[AICheckProvider] Failed to start custom tools SSE server '${customToolsServerName}': ${error instanceof Error ? error.message : 'Unknown error'}`\n        );\n        // Continue without custom tools\n      }\n    }\n\n    // Pass MCP server config directly to AI service (unless tools are disabled)\n    if (Object.keys(mcpServers).length > 0 && !config.ai?.disableTools) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (aiConfig as any).mcpServers = mcpServers;\n      // no noisy diagnostics here\n    } else if (config.ai?.disableTools) {\n      // silently skip MCP when tools disabled\n    }\n\n    // Evaluate ai_bash_config_js for dynamic bash command permissions\n    const bashConfigJsExpr = (config as any).ai_bash_config_js as string | undefined;\n    if (bashConfigJsExpr && _dependencyResults) {\n      try {\n        const dynamicBashConfig = this.evaluateBashConfigJs(\n          bashConfigJsExpr,\n          prInfo,\n          _dependencyResults,\n          config\n        );\n        // Merge: dynamic arrays extend static ones\n        if (!aiConfig.bashConfig) aiConfig.bashConfig = {};\n        if (dynamicBashConfig.allow?.length) {\n          aiConfig.bashConfig.allow = [\n            ...(aiConfig.bashConfig.allow || []),\n            ...dynamicBashConfig.allow,\n          ];\n        }\n        if (dynamicBashConfig.deny?.length) {\n          aiConfig.bashConfig.deny = [\n            ...(aiConfig.bashConfig.deny || []),\n            ...dynamicBashConfig.deny,\n          ];\n        }\n        // Also enable bash if dynamic config provides commands\n        if (dynamicBashConfig.allow?.length || dynamicBashConfig.deny?.length) {\n          aiConfig.allowBash = true;\n        }\n      } catch (error) {\n        logger.error(\n          `[AICheckProvider] Failed to evaluate ai_bash_config_js: ${error instanceof Error ? error.message : 'Unknown error'}`\n        );\n      }\n    }\n\n    // Build template context for state capture\n    const templateContext = {\n      pr: {\n        number: prInfo.number,\n        title: prInfo.title,\n        author: prInfo.author,\n        branch: prInfo.head,\n        base: prInfo.base,\n      },\n      files: prInfo.files,\n      outputs: _dependencyResults\n        ? Object.fromEntries(\n            Array.from(_dependencyResults.entries()).map(([checkName, result]) => [\n              checkName,\n              (result as any).output !== undefined ? (result as any).output : result,\n            ])\n          )\n        : {},\n      args: (sessionInfo as any)?.args || {},\n    };\n\n    // Capture input context in active OTEL span and attach trace ID to prInfo for AI context\n    try {\n      const span = trace.getSpan(otContext.active());\n      if (span) {\n        captureCheckInputContext(span, templateContext);\n        const spanTraceId = span.spanContext()?.traceId;\n        if (spanTraceId) {\n          (prInfo as any).otelTraceId = spanTraceId;\n        }\n      }\n    } catch {\n      // Ignore telemetry errors\n    }\n    // Fallback NDJSON for input context (non-OTEL environments)\n    try {\n      const checkId = (config as any).checkName || (config as any).id || 'unknown';\n      // Sanitize context to avoid leaking API keys in traces\n      const ctxJson = JSON.stringify(sanitizeContextForTelemetry(templateContext));\n      const { emitNdjsonSpanWithEvents } = require('../telemetry/fallback-ndjson');\n      emitNdjsonSpanWithEvents(\n        'visor.check',\n        { 'visor.check.id': checkId, 'visor.check.input.context': ctxJson },\n        []\n      );\n    } catch {}\n\n    // Process prompt with Liquid templates and file loading\n    // Do NOT strip event context on skip_code_context â€” that flag only controls\n    // whether we embed PR diffs/large code context later in AIReviewService.\n    // Keep repository/comment metadata available for prompts and tests.\n    const baseEventContext = (config.eventContext || {}) as Record<string, unknown>;\n    const checksMeta = (config as any).checksMeta as\n      | Record<string, { type?: string; group?: string }>\n      | undefined;\n    // Inject Slack context into eventContext when running under Slack (best-effort)\n    const slackCtx = this.buildSlackEventContext(\n      sessionInfo as\n        | (typeof sessionInfo & import('./check-provider.interface').ExecutionContext)\n        | undefined,\n      config,\n      prInfo\n    );\n    const baseWithSlack = { ...baseEventContext, ...slackCtx };\n    const eventContext = checksMeta\n      ? { ...baseWithSlack, __checksMeta: checksMeta }\n      : baseWithSlack;\n    // Thread stageHistoryBase via eventContext for prompt rendering so\n    // Liquid templates can get outputs_history_stage (computed from baseline).\n    const ctxWithStage = {\n      ...(eventContext || {}),\n      __stageHistoryBase: (sessionInfo as any)?.stageHistoryBase as\n        | Record<string, number>\n        | undefined,\n    } as Record<string, unknown>;\n\n    const processedPrompt = await this.processPrompt(\n      customPrompt,\n      prInfo,\n      ctxWithStage,\n      _dependencyResults,\n      (config as any).__outputHistory as Map<string, unknown[]> | undefined,\n      (sessionInfo as any)?.args,\n      (config as any).workflowInputs as Record<string, unknown> | undefined\n    );\n\n    // Process schema with Liquid templates (supports dynamic enum values)\n    const processedSchema = await this.renderSchema(\n      config.schema as string | Record<string, unknown> | undefined,\n      prInfo,\n      ctxWithStage,\n      _dependencyResults,\n      (config as any).__outputHistory as Map<string, unknown[]> | undefined,\n      (sessionInfo as any)?.args,\n      (config as any).workflowInputs as Record<string, unknown> | undefined\n    );\n\n    // Optional persona (vendor extension): ai.ai_persona or ai_persona.\n    // This is a light-weight preamble, not a rewriting of the user's prompt.\n    const aiAny = (config.ai || {}) as any;\n    // Persona (underscore only)\n    const persona = (aiAny?.ai_persona || (config as any).ai_persona || '').toString().trim();\n    const finalPrompt = persona ? `Persona: ${persona}\\n\\n${processedPrompt}` : processedPrompt;\n    const promptTypeOverride = (\n      (aiAny?.prompt_type ||\n        (config.ai as any)?.promptType ||\n        (config as any).ai_prompt_type ||\n        '') as string\n    )\n      .toString()\n      .trim();\n\n    // Test hook: capture the FINAL prompt (with PR context) before provider invocation\n    try {\n      const stepName = (config as any).checkName || 'unknown';\n      const serviceForCapture = new AIReviewService(aiConfig);\n      const finalPromptCapture = await (serviceForCapture as any).buildCustomPrompt(\n        prInfo,\n        finalPrompt,\n        processedSchema,\n        {\n          checkName: (config as any).checkName,\n          skipPRContext: (config.ai as any)?.skip_code_context === true,\n        }\n      );\n      sessionInfo?.hooks?.onPromptCaptured?.({\n        step: String(stepName),\n        provider: 'ai',\n        prompt: finalPromptCapture,\n      });\n      // capture hook retained; no extra console diagnostics\n    } catch {}\n\n    // Test hook: mock output for this step (short-circuit provider)\n    try {\n      const stepName = (config as any).checkName || 'unknown';\n      const mock = sessionInfo?.hooks?.mockForStep?.(String(stepName));\n      if (mock !== undefined) {\n        const ms = mock as any;\n        const issuesArr = Array.isArray(ms?.issues) ? (ms.issues as any[]) : [];\n        // Prefer explicit output if provided; otherwise treat the mock itself as output\n        const out = ms && typeof ms === 'object' && 'output' in ms ? ms.output : ms;\n        const summary: ReviewSummary & { output?: unknown; content?: string } = {\n          issues: issuesArr,\n          output: out,\n          ...(typeof ms?.content === 'string' ? { content: String(ms.content) } : {}),\n        } as any;\n        return summary;\n      }\n    } catch {}\n\n    // Create AI service with config - environment variables will be used if aiConfig is empty\n    try {\n      if (promptTypeOverride) (aiConfig as any).promptType = promptTypeOverride;\n      // Prefer new system_prompt; fall back to legacy custom_prompt for backward compatibility\n      const sys = (aiAny?.system_prompt || (config as any).ai_system_prompt || '')\n        .toString()\n        .trim();\n      const legacy = (aiAny?.custom_prompt || (config as any).ai_custom_prompt || '')\n        .toString()\n        .trim();\n      if (sys) (aiConfig as any).systemPrompt = sys;\n      else if (legacy) (aiConfig as any).systemPrompt = legacy;\n    } catch {}\n    const service = new AIReviewService(aiConfig);\n\n    // Use the processed schema (with Liquid templates rendered)\n    const schema = processedSchema;\n\n    // Removed verbose AICheckProvider console diagnostics; rely on logger.debug when needed\n\n    try {\n      // No extra console diagnostics here\n\n      let result: ReviewSummary;\n      const prevPromptTypeEnv = process.env.VISOR_PROMPT_TYPE;\n      const shouldIgnoreEnvPromptType = aiAny?.disableTools === true;\n      let didAdjustPromptTypeEnv = false;\n      if (promptTypeOverride) {\n        process.env.VISOR_PROMPT_TYPE = promptTypeOverride;\n        didAdjustPromptTypeEnv = true;\n      } else if (shouldIgnoreEnvPromptType && prevPromptTypeEnv !== undefined) {\n        delete process.env.VISOR_PROMPT_TYPE;\n        didAdjustPromptTypeEnv = true;\n      }\n      try {\n        // Check if we should use session reuse (only if explicitly enabled on this check)\n        // No extra reuse_ai_session console diagnostics\n        const reuseEnabled =\n          (config as any).reuse_ai_session === true ||\n          typeof (config as any).reuse_ai_session === 'string';\n        let promptUsed = finalPrompt;\n        if (sessionInfo?.reuseSession && sessionInfo.parentSessionId && reuseEnabled) {\n          // Safety: only reuse if the parent session actually exists\n          try {\n            const { SessionRegistry } = require('../session-registry');\n            const reg = SessionRegistry.getInstance();\n            if (!reg.hasSession(sessionInfo.parentSessionId)) {\n              if (aiConfig.debug || process.env.VISOR_DEBUG === 'true') {\n                console.warn(\n                  `âš ï¸  Parent session ${sessionInfo.parentSessionId} not found; creating a new session for ${config.checkName}`\n                );\n              }\n              // Fall back to new session\n              promptUsed = processedPrompt;\n              const fresh = await service.executeReview(\n                prInfo,\n                processedPrompt,\n                schema,\n                config.checkName,\n                config.sessionId\n              );\n              return {\n                ...fresh,\n                issues: new IssueFilter(config.suppressionEnabled !== false).filterIssues(\n                  fresh.issues || [],\n                  process.cwd()\n                ),\n              };\n            }\n          } catch {}\n          // Get session_mode from config, default to 'clone'\n          const sessionMode = (config.session_mode as 'clone' | 'append') || 'clone';\n\n          if (aiConfig.debug) {\n            console.error(\n              `ðŸ”„ Debug: Using session reuse with parent session: ${sessionInfo.parentSessionId} (mode: ${sessionMode})`\n            );\n          }\n          promptUsed = processedPrompt;\n          result = await service.executeReviewWithSessionReuse(\n            prInfo,\n            processedPrompt,\n            sessionInfo.parentSessionId,\n            schema,\n            config.checkName,\n            sessionMode\n          );\n        } else {\n          if (aiConfig.debug) {\n            console.error(`ðŸ†• Debug: Creating new AI session for check: ${config.checkName}`);\n          }\n          promptUsed = finalPrompt;\n          result = await service.executeReview(\n            prInfo,\n            finalPrompt,\n            schema,\n            config.checkName,\n            config.sessionId\n          );\n        }\n\n        // Apply issue suppression filtering\n        const suppressionEnabled = config.suppressionEnabled !== false;\n        const issueFilter = new IssueFilter(suppressionEnabled);\n        const filteredIssues = issueFilter.filterIssues(result.issues || [], process.cwd());\n\n        const finalResult = {\n          ...result,\n          issues: filteredIssues,\n        };\n\n        // Capture AI provider call and output in active OTEL span\n        try {\n          const span = trace.getSpan(otContext.active());\n          if (span) {\n            captureProviderCall(\n              span,\n              'ai',\n              {\n                prompt: promptUsed,\n                model: aiConfig.model,\n              },\n              {\n                content: JSON.stringify(finalResult),\n                tokens: (result as any).usage?.totalTokens,\n              }\n            );\n            const outputForSpan = (finalResult as { output?: unknown }).output ?? finalResult;\n            captureCheckOutput(span, outputForSpan);\n          }\n        } catch {\n          // Ignore telemetry errors\n        }\n        // Fallback NDJSON for output (non-OTEL environments)\n        try {\n          const checkId = (config as any).checkName || (config as any).id || 'unknown';\n          const outJson = JSON.stringify((finalResult as any).output ?? finalResult);\n          const { emitNdjsonSpanWithEvents } = require('../telemetry/fallback-ndjson');\n          emitNdjsonSpanWithEvents(\n            'visor.check',\n            { 'visor.check.id': checkId, 'visor.check.output': outJson },\n            []\n          );\n        } catch {}\n\n        return finalResult;\n      } finally {\n        if (didAdjustPromptTypeEnv) {\n          if (prevPromptTypeEnv === undefined) {\n            delete process.env.VISOR_PROMPT_TYPE;\n          } else {\n            process.env.VISOR_PROMPT_TYPE = prevPromptTypeEnv;\n          }\n        }\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n\n      // Log detailed error information\n      console.error(`âŒ AI Check Provider Error for check: ${errorMessage}`);\n\n      // Check if this is a critical error (authentication, rate limits, etc)\n      const isCriticalError =\n        errorMessage.includes('API rate limit') ||\n        errorMessage.includes('403') ||\n        errorMessage.includes('401') ||\n        errorMessage.includes('authentication') ||\n        errorMessage.includes('API key');\n\n      if (isCriticalError) {\n        console.error(`ðŸš¨ CRITICAL ERROR: AI provider authentication or rate limit issue detected`);\n        console.error(`ðŸš¨ This check cannot proceed without valid API credentials`);\n      }\n\n      // Re-throw with more context\n      throw new Error(`AI analysis failed: ${errorMessage}`);\n    } finally {\n      // Cleanup custom tools server\n      // When AI check is complete (success or error), stop immediately without grace period.\n      // Grace period is only useful during active tool iteration, not at check completion.\n      if (customToolsServer) {\n        try {\n          const drainTimeoutRaw = process.env.VISOR_CUSTOM_TOOLS_DRAIN_TIMEOUT_MS;\n          const drainTimeoutMs = drainTimeoutRaw ? parseInt(drainTimeoutRaw, 10) : undefined;\n\n          await customToolsServer.stop({\n            graceMs: 0, // No grace period at check completion - we're done\n            drainTimeoutMs: Number.isFinite(drainTimeoutMs as number) ? drainTimeoutMs : undefined,\n          });\n          if (aiConfig.debug || process.env.VISOR_DEBUG === 'true') {\n            logger.debug('[AICheckProvider] Custom tools SSE server stopped');\n          }\n        } catch (error) {\n          logger.error(\n            `[AICheckProvider] Error stopping custom tools SSE server: ${error instanceof Error ? error.message : 'Unknown error'}`\n          );\n        }\n      }\n    }\n  }\n\n  /**\n   * Get custom tool items from check configuration\n   * Returns an array of tool items (string names or workflow references)\n   */\n  private getCustomToolsForAI(config: CheckProviderConfig): Array<string | WorkflowToolReference> {\n    const aiCustomTools = (config as any).ai_custom_tools;\n\n    if (!aiCustomTools) {\n      return [];\n    }\n\n    if (Array.isArray(aiCustomTools)) {\n      // Filter to only string names and workflow references\n      return aiCustomTools.filter(\n        item => typeof item === 'string' || isWorkflowToolReference(item)\n      );\n    }\n\n    if (typeof aiCustomTools === 'string') {\n      return [aiCustomTools];\n    }\n\n    // Support single workflow reference object\n    if (isWorkflowToolReference(aiCustomTools)) {\n      return [aiCustomTools];\n    }\n\n    return [];\n  }\n\n  /**\n   * Evaluate ai_custom_tools_js expression to dynamically compute custom tools.\n   * Returns an array of tool names or workflow references.\n   */\n  private evaluateCustomToolsJs(\n    expression: string,\n    prInfo: PRInfo,\n    dependencyResults: Map<string, ReviewSummary>,\n    config: CheckProviderConfig\n  ): Array<string | WorkflowToolReference> {\n    if (!this.sandbox) {\n      this.sandbox = createSecureSandbox();\n    }\n\n    // Build outputs object from dependency results (same pattern as template rendering)\n    const outputs: Record<string, unknown> = {};\n    for (const [checkId, result] of dependencyResults.entries()) {\n      // Extract structured output if available, otherwise use result as-is\n      const summary = result as ReviewSummary & { output?: unknown };\n      outputs[checkId] = summary.output !== undefined ? summary.output : summary;\n    }\n\n    // Build context for the expression\n    const jsContext: Record<string, unknown> = {\n      outputs,\n      inputs: (config as any).inputs || {},\n      pr: {\n        number: prInfo.number,\n        title: prInfo.title,\n        description: prInfo.body,\n        author: prInfo.author,\n        branch: prInfo.head,\n        base: prInfo.base,\n        authorAssociation: prInfo.authorAssociation,\n      },\n      files:\n        prInfo.files?.map(f => ({\n          filename: f.filename,\n          status: f.status,\n          additions: f.additions,\n          deletions: f.deletions,\n          changes: f.changes,\n        })) || [],\n      env: this.buildSafeEnv(),\n      memory: (config as any).__memoryAccessor || {},\n    };\n\n    try {\n      const result = compileAndRun<unknown>(this.sandbox, expression, jsContext, {\n        injectLog: true,\n        wrapFunction: true,\n        logPrefix: '[ai_custom_tools_js]',\n      });\n\n      // Validate result is an array\n      if (!Array.isArray(result)) {\n        logger.warn(\n          `[AICheckProvider] ai_custom_tools_js must return an array, got ${typeof result}`\n        );\n        return [];\n      }\n\n      // Filter to valid items (strings or workflow references)\n      return result.filter(\n        (item: unknown) => typeof item === 'string' || isWorkflowToolReference(item as any)\n      ) as Array<string | WorkflowToolReference>;\n    } catch (error) {\n      logger.error(\n        `[AICheckProvider] Failed to evaluate ai_custom_tools_js: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n      return [];\n    }\n  }\n\n  /**\n   * Evaluate ai_mcp_servers_js expression to dynamically compute MCP servers.\n   * Returns a record mapping server names to McpServerConfig objects.\n   */\n  private evaluateMcpServersJs(\n    expression: string,\n    prInfo: PRInfo,\n    dependencyResults: Map<string, ReviewSummary>,\n    config: CheckProviderConfig\n  ): Record<string, import('../types/config').McpServerConfig> {\n    if (!this.sandbox) {\n      this.sandbox = createSecureSandbox();\n    }\n\n    // Build outputs object from dependency results (same pattern as template rendering)\n    const outputs: Record<string, unknown> = {};\n    for (const [checkId, result] of dependencyResults.entries()) {\n      const summary = result as ReviewSummary & { output?: unknown };\n      outputs[checkId] = summary.output !== undefined ? summary.output : summary;\n    }\n\n    // Build context for the expression\n    const jsContext: Record<string, unknown> = {\n      outputs,\n      inputs: (config as any).inputs || {},\n      pr: {\n        number: prInfo.number,\n        title: prInfo.title,\n        description: prInfo.body,\n        author: prInfo.author,\n        branch: prInfo.head,\n        base: prInfo.base,\n        authorAssociation: prInfo.authorAssociation,\n      },\n      files:\n        prInfo.files?.map(f => ({\n          filename: f.filename,\n          status: f.status,\n          additions: f.additions,\n          deletions: f.deletions,\n          changes: f.changes,\n        })) || [],\n      env: this.buildSafeEnv(),\n      memory: (config as any).__memoryAccessor || {},\n    };\n\n    try {\n      // Debug: log what's in build-config output\n      const buildConfigOutput = (jsContext.outputs as any)?.['build-config'];\n      logger.info(\n        `[AICheckProvider] ai_mcp_servers_js context: build-config output keys=${buildConfigOutput ? Object.keys(buildConfigOutput).join(',') : 'N/A'}, mcp_servers keys=${buildConfigOutput?.mcp_servers ? Object.keys(buildConfigOutput.mcp_servers).join(',') : 'N/A'}`\n      );\n\n      const result = compileAndRun<unknown>(this.sandbox, expression, jsContext, {\n        injectLog: true,\n        wrapFunction: true,\n        logPrefix: '[ai_mcp_servers_js]',\n      });\n\n      // Validate result is an object (not array, not null)\n      if (typeof result !== 'object' || result === null || Array.isArray(result)) {\n        logger.warn(\n          `[AICheckProvider] ai_mcp_servers_js must return an object, got ${Array.isArray(result) ? 'array' : typeof result}`\n        );\n        return {};\n      }\n\n      // Validate each server config - accepts multiple entry types:\n      // 1. External stdio MCP server: has 'command'\n      // 2. External SSE/HTTP MCP server: has 'url'\n      // 3. Workflow tool reference: has 'workflow'\n      // 4. Custom/built-in tool reference: has 'tool'\n      // 5. Auto-detect from tools: section: empty object {}\n      const validServers: Record<string, import('../types/config').McpServerConfig> = {};\n      for (const [serverName, serverConfig] of Object.entries(result as Record<string, unknown>)) {\n        if (typeof serverConfig !== 'object' || serverConfig === null) {\n          logger.warn(\n            `[AICheckProvider] ai_mcp_servers_js: server \"${serverName}\" config must be an object`\n          );\n          continue;\n        }\n        const cfg = serverConfig as Record<string, unknown>;\n        // Accept: command (stdio), url (sse/http), workflow (workflow tool), tool (custom/built-in), or empty {} (auto-detect)\n        const isValid =\n          cfg.command || cfg.url || cfg.workflow || cfg.tool || Object.keys(cfg).length === 0;\n        if (!isValid) {\n          logger.warn(\n            `[AICheckProvider] ai_mcp_servers_js: server \"${serverName}\" must have command, url, workflow, or tool`\n          );\n          continue;\n        }\n        validServers[serverName] = cfg as unknown as import('../types/config').McpServerConfig;\n      }\n\n      logger.debug(\n        `[AICheckProvider] ai_mcp_servers_js evaluated to ${Object.keys(validServers).length} servers: ${Object.keys(validServers).join(', ')}`\n      );\n      return validServers;\n    } catch (error) {\n      logger.error(\n        `[AICheckProvider] Failed to evaluate ai_mcp_servers_js: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n      return {};\n    }\n  }\n\n  /**\n   * Evaluate ai_bash_config_js expression to dynamically compute bash configuration.\n   * Returns a partial BashConfig object with optional allow/deny arrays.\n   */\n  private evaluateBashConfigJs(\n    expression: string,\n    prInfo: PRInfo,\n    dependencyResults: Map<string, ReviewSummary>,\n    config: CheckProviderConfig\n  ): Partial<import('../types/config').BashConfig> {\n    if (!this.sandbox) {\n      this.sandbox = createSecureSandbox();\n    }\n\n    // Build outputs object from dependency results (same pattern as template rendering)\n    const outputs: Record<string, unknown> = {};\n    for (const [checkId, result] of dependencyResults.entries()) {\n      const summary = result as ReviewSummary & { output?: unknown };\n      outputs[checkId] = summary.output !== undefined ? summary.output : summary;\n    }\n\n    // Build context for the expression\n    const jsContext: Record<string, unknown> = {\n      outputs,\n      inputs: (config as any).inputs || {},\n      pr: {\n        number: prInfo.number,\n        title: prInfo.title,\n        description: prInfo.body,\n        author: prInfo.author,\n        branch: prInfo.head,\n        base: prInfo.base,\n        authorAssociation: prInfo.authorAssociation,\n      },\n      files:\n        prInfo.files?.map(f => ({\n          filename: f.filename,\n          status: f.status,\n          additions: f.additions,\n          deletions: f.deletions,\n          changes: f.changes,\n        })) || [],\n      env: this.buildSafeEnv(),\n      memory: (config as any).__memoryAccessor || {},\n    };\n\n    try {\n      const result = compileAndRun<unknown>(this.sandbox, expression, jsContext, {\n        injectLog: true,\n        wrapFunction: true,\n        logPrefix: '[ai_bash_config_js]',\n      });\n\n      // Validate result is an object (not array, not null)\n      if (typeof result !== 'object' || result === null || Array.isArray(result)) {\n        logger.warn(\n          `[AICheckProvider] ai_bash_config_js must return an object, got ${Array.isArray(result) ? 'array' : typeof result}`\n        );\n        return {};\n      }\n\n      const cfg = result as Record<string, unknown>;\n\n      // Validate allow/deny are string arrays if present\n      const validConfig: Partial<import('../types/config').BashConfig> = {};\n      if (cfg.allow !== undefined) {\n        if (\n          Array.isArray(cfg.allow) &&\n          cfg.allow.every((item: unknown) => typeof item === 'string')\n        ) {\n          validConfig.allow = cfg.allow as string[];\n        } else {\n          logger.warn(`[AICheckProvider] ai_bash_config_js: 'allow' must be a string array`);\n        }\n      }\n      if (cfg.deny !== undefined) {\n        if (\n          Array.isArray(cfg.deny) &&\n          cfg.deny.every((item: unknown) => typeof item === 'string')\n        ) {\n          validConfig.deny = cfg.deny as string[];\n        } else {\n          logger.warn(`[AICheckProvider] ai_bash_config_js: 'deny' must be a string array`);\n        }\n      }\n\n      logger.debug(\n        `[AICheckProvider] ai_bash_config_js evaluated: allow=${validConfig.allow?.length ?? 0}, deny=${validConfig.deny?.length ?? 0}`\n      );\n      return validConfig;\n    } catch (error) {\n      logger.error(\n        `[AICheckProvider] Failed to evaluate ai_bash_config_js: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n      return {};\n    }\n  }\n\n  /**\n   * Build a safe subset of environment variables for sandbox access.\n   * Excludes sensitive keys like API keys, secrets, tokens.\n   */\n  private buildSafeEnv(): Record<string, string> {\n    const sensitivePatterns = [\n      /api.?key/i,\n      /secret/i,\n      /token/i,\n      /password/i,\n      /credential/i,\n      /auth/i,\n      /private/i,\n    ];\n    const safeEnv: Record<string, string> = {};\n\n    for (const [key, value] of Object.entries(process.env)) {\n      if (value === undefined) continue;\n      const isSensitive = sensitivePatterns.some(pattern => pattern.test(key));\n      if (!isSensitive) {\n        safeEnv[key] = value;\n      }\n    }\n\n    return safeEnv;\n  }\n\n  /**\n   * Load custom tools from global configuration and workflow registry\n   * Supports both traditional custom tools and workflow-as-tool references\n   */\n  private loadCustomTools(\n    toolItems: Array<string | WorkflowToolReference>,\n    config: CheckProviderConfig\n  ): Map<string, CustomToolDefinition> {\n    const tools = new Map<string, CustomToolDefinition>();\n\n    // Get tools from global config (passed through check config)\n    const globalTools = (config as any).__globalTools as\n      | Record<string, CustomToolDefinition>\n      | undefined;\n\n    for (const item of toolItems) {\n      // First, try to resolve as a workflow tool\n      const workflowTool = resolveWorkflowToolFromItem(item);\n      if (workflowTool) {\n        logger.debug(`[AICheckProvider] Loaded workflow '${workflowTool.name}' as custom tool`);\n        tools.set(workflowTool.name, workflowTool);\n        continue;\n      }\n\n      // If it's not a workflow, try to load from global tools\n      if (typeof item === 'string') {\n        // Check global tools\n        if (globalTools && globalTools[item]) {\n          const tool = globalTools[item];\n          tool.name = tool.name || item;\n          tools.set(item, tool);\n          continue;\n        }\n\n        // Not found in either location\n        logger.warn(\n          `[AICheckProvider] Custom tool '${item}' not found in global tools or workflow registry`\n        );\n      } else if (isWorkflowToolReference(item)) {\n        // Workflow reference that wasn't found in registry\n        logger.warn(\n          `[AICheckProvider] Workflow '${item.workflow}' referenced but not found in registry`\n        );\n      }\n    }\n\n    // Warn if no tools were loaded but items were specified\n    if (tools.size === 0 && toolItems.length > 0 && !globalTools) {\n      logger.warn(\n        `[AICheckProvider] ai_custom_tools specified but no global tools found in configuration and no workflows matched`\n      );\n    }\n\n    return tools;\n  }\n\n  getSupportedConfigKeys(): string[] {\n    return [\n      'type',\n      'prompt',\n      'focus',\n      'schema',\n      'group',\n      'ai.provider',\n      'ai.model',\n      'ai.apiKey',\n      'ai.timeout',\n      'ai.max_iterations',\n      'ai.mcpServers',\n      'ai.enableDelegate',\n      'ai.enableTasks',\n      // legacy persona/prompt keys supported in config\n      'ai_persona',\n      'ai_prompt_type',\n      'ai_custom_prompt',\n      'ai_system_prompt',\n      'ai_max_iterations',\n      // new provider resilience and tools toggles\n      'ai.retry',\n      'ai.fallback',\n      'ai.allowEdit',\n      'ai.allowedTools',\n      'ai.disableTools',\n      'ai.allowBash',\n      'ai.bashConfig',\n      'ai_model',\n      'ai_provider',\n      'ai_mcp_servers',\n      'ai_mcp_servers_js',\n      'ai_custom_tools',\n      'ai_custom_tools_js',\n      'ai_bash_config_js',\n      'env',\n    ];\n  }\n\n  async isAvailable(): Promise<boolean> {\n    // Check if any AI API key is available\n    return !!(\n      process.env.GOOGLE_API_KEY ||\n      process.env.ANTHROPIC_API_KEY ||\n      process.env.OPENAI_API_KEY ||\n      // AWS Bedrock credentials check\n      (process.env.AWS_ACCESS_KEY_ID && process.env.AWS_SECRET_ACCESS_KEY) ||\n      process.env.AWS_BEDROCK_API_KEY\n    );\n  }\n\n  getRequirements(): string[] {\n    return [\n      'At least one of: GOOGLE_API_KEY, ANTHROPIC_API_KEY, OPENAI_API_KEY, or AWS credentials (AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY)',\n      'Optional: MODEL_NAME environment variable',\n      'Optional: AWS_REGION for Bedrock provider',\n      'Network access to AI provider APIs',\n    ];\n  }\n}\n","import { CheckProvider, CheckProviderConfig } from './check-provider.interface';\nimport { PRInfo } from '../pr-analyzer';\nimport { ReviewSummary, ReviewIssue } from '../reviewer';\nimport { IssueFilter } from '../issue-filter';\nimport { Liquid } from 'liquidjs';\nimport { createExtendedLiquid } from '../liquid-extensions';\nimport { trace, context as otContext } from '../telemetry/lazy-otel';\nimport {\n  captureCheckInputContext,\n  captureCheckOutput,\n  captureProviderCall,\n} from '../telemetry/state-capture';\nimport { EnvironmentResolver } from '../utils/env-resolver';\n\n/**\n * Check provider that sends data to an HTTP endpoint, typically used as an output/notification provider\n */\nexport class HttpCheckProvider extends CheckProvider {\n  private liquid: Liquid;\n\n  constructor() {\n    super();\n    this.liquid = createExtendedLiquid();\n  }\n  getName(): string {\n    return 'http';\n  }\n\n  getDescription(): string {\n    return 'Send data to external HTTP endpoint for notifications or integration';\n  }\n\n  async validateConfig(config: unknown): Promise<boolean> {\n    if (!config || typeof config !== 'object') {\n      return false;\n    }\n\n    const cfg = config as CheckProviderConfig;\n\n    // Type must be 'http'\n    if (cfg.type !== 'http') {\n      return false;\n    }\n\n    // Must have URL specified\n    if (typeof cfg.url !== 'string' || !cfg.url) {\n      return false;\n    }\n\n    // Must have body template specified\n    if (typeof cfg.body !== 'string' || !cfg.body) {\n      return false;\n    }\n\n    // Validate URL format\n    try {\n      new URL(cfg.url as string);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  async execute(\n    prInfo: PRInfo,\n    config: CheckProviderConfig,\n    dependencyResults?: Map<string, ReviewSummary>,\n    _sessionInfo?: { parentSessionId?: string; reuseSession?: boolean }\n  ): Promise<ReviewSummary> {\n    const url = config.url as string;\n    const bodyTemplate = config.body as string;\n    const method = (config.method as string) || 'POST';\n    const headers = (config.headers as Record<string, string>) || {};\n    const timeout = (config.timeout as number) || 30000;\n\n    // Prepare template context with all available data\n    const templateContext = {\n      pr: {\n        number: prInfo.number,\n        title: prInfo.title,\n        body: prInfo.body,\n        author: prInfo.author,\n        base: prInfo.base,\n        head: prInfo.head,\n        totalAdditions: prInfo.totalAdditions,\n        totalDeletions: prInfo.totalDeletions,\n      },\n      files: prInfo.files.map(f => ({\n        filename: f.filename,\n        status: f.status,\n        additions: f.additions,\n        deletions: f.deletions,\n        changes: f.changes,\n        patch: f.patch,\n      })),\n      outputs: dependencyResults ? Object.fromEntries(dependencyResults) : {},\n      metadata: config.metadata || {},\n    };\n\n    // Capture input context in active OTEL span\n    try {\n      const span = trace.getSpan(otContext.active());\n      if (span) {\n        captureCheckInputContext(span, templateContext);\n      }\n    } catch {\n      // Ignore telemetry errors\n    }\n\n    // Render the body template\n    let payload: Record<string, unknown>;\n    try {\n      const renderedBody = await this.liquid.parseAndRender(bodyTemplate, templateContext);\n      // Try to parse as JSON, otherwise send as plain text\n      try {\n        payload = JSON.parse(renderedBody);\n      } catch {\n        payload = { message: renderedBody };\n      }\n    } catch (error) {\n      return this.createErrorResult(\n        url,\n        new Error(\n          `Template rendering failed: ${error instanceof Error ? error.message : 'Unknown error'}`\n        )\n      );\n    }\n\n    try {\n      // Resolve environment variables in headers\n      const resolvedHeaders = EnvironmentResolver.resolveHeaders(headers);\n\n      // Send webhook request\n      const response = await this.sendWebhookRequest(\n        url,\n        method,\n        resolvedHeaders,\n        payload,\n        timeout\n      );\n\n      // Parse webhook response\n      const result = this.parseWebhookResponse(response, url);\n\n      // Apply issue suppression filtering\n      const suppressionEnabled = config.suppressionEnabled !== false;\n      const issueFilter = new IssueFilter(suppressionEnabled);\n      const filteredIssues = issueFilter.filterIssues(result.issues || [], process.cwd());\n\n      const finalResult = {\n        ...result,\n        issues: filteredIssues,\n      };\n\n      // Capture HTTP provider call and output in active OTEL span\n      try {\n        const span = trace.getSpan(otContext.active());\n        if (span) {\n          // Sanitize headers for telemetry to avoid exposing sensitive data\n          const sanitizedHeaders = EnvironmentResolver.sanitizeHeaders(resolvedHeaders);\n          captureProviderCall(\n            span,\n            'http',\n            {\n              url,\n              method,\n              headers: sanitizedHeaders,\n              body: JSON.stringify(payload).substring(0, 500),\n            },\n            {\n              content: JSON.stringify(response).substring(0, 500),\n            }\n          );\n          const outputForSpan = (finalResult as { output?: unknown }).output ?? finalResult;\n          captureCheckOutput(span, outputForSpan);\n        }\n      } catch {\n        // Ignore telemetry errors\n      }\n\n      return finalResult;\n    } catch (error) {\n      return this.createErrorResult(url, error);\n    }\n  }\n\n  private async sendWebhookRequest(\n    url: string,\n    method: string,\n    headers: Record<string, string>,\n    payload: Record<string, unknown>,\n    timeout: number\n  ): Promise<Record<string, unknown>> {\n    // Check if fetch is available (Node 18+)\n    if (typeof fetch === 'undefined') {\n      throw new Error('Webhook provider requires Node.js 18+ or node-fetch package');\n    }\n\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n    try {\n      const response = await fetch(url, {\n        method,\n        headers: {\n          'Content-Type': 'application/json',\n          ...headers,\n        },\n        body: JSON.stringify(payload),\n        signal: controller.signal,\n      });\n\n      clearTimeout(timeoutId);\n\n      if (!response.ok) {\n        throw new Error(`Webhook returned ${response.status}: ${response.statusText}`);\n      }\n\n      return (await response.json()) as Record<string, unknown>;\n    } catch (error: unknown) {\n      clearTimeout(timeoutId);\n\n      if (error instanceof Error && error.name === 'AbortError') {\n        throw new Error(`Webhook request timed out after ${timeout}ms`);\n      }\n\n      throw error;\n    }\n  }\n\n  private parseWebhookResponse(response: Record<string, unknown>, url: string): ReviewSummary {\n    // Validate and normalize the webhook response\n    if (!response || typeof response !== 'object') {\n      return this.createErrorResult(url, new Error('Invalid webhook response format'));\n    }\n\n    const issues: ReviewIssue[] = Array.isArray(response.comments)\n      ? (response.comments as Array<Record<string, unknown>>).map(c => ({\n          file: (c.file as string) || 'unknown',\n          line: (c.line as number) || 0,\n          endLine: c.endLine as number | undefined,\n          ruleId: (c.ruleId as string) || `webhook/${this.validateCategory(c.category)}`,\n          message: (c.message as string) || '',\n          severity: this.validateSeverity(c.severity),\n          category: this.validateCategory(c.category),\n          suggestion: c.suggestion as string | undefined,\n          replacement: c.replacement as string | undefined,\n        }))\n      : [];\n\n    return {\n      issues,\n    };\n  }\n\n  private createErrorResult(url: string, error: unknown): ReviewSummary {\n    const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n\n    return {\n      issues: [\n        {\n          file: 'webhook',\n          line: 0,\n          endLine: undefined,\n          ruleId: 'webhook/error',\n          message: `Webhook execution error: ${errorMessage}`,\n          severity: 'error',\n          category: 'logic',\n          suggestion: undefined,\n          replacement: undefined,\n        },\n      ],\n    };\n  }\n\n  private validateSeverity(severity: unknown): 'info' | 'warning' | 'error' | 'critical' {\n    const valid = ['info', 'warning', 'error', 'critical'];\n    return valid.includes(severity as string)\n      ? (severity as 'info' | 'warning' | 'error' | 'critical')\n      : 'info';\n  }\n\n  private validateCategory(\n    category: unknown\n  ): 'security' | 'performance' | 'style' | 'logic' | 'documentation' {\n    const valid = ['security', 'performance', 'style', 'logic', 'documentation'];\n    return valid.includes(category as string)\n      ? (category as 'security' | 'performance' | 'style' | 'logic' | 'documentation')\n      : 'logic';\n  }\n\n  getSupportedConfigKeys(): string[] {\n    return [\n      'type',\n      'url',\n      'body',\n      'method',\n      'headers',\n      'timeout',\n      'metadata',\n      'depends_on',\n      'on',\n      'if',\n      'group',\n      'schedule',\n    ];\n  }\n\n  async isAvailable(): Promise<boolean> {\n    // HTTP provider is available if fetch is available\n    return typeof fetch !== 'undefined';\n  }\n\n  getRequirements(): string[] {\n    return [\n      'Valid HTTP URL',\n      'Body template (Liquid) for payload construction',\n      'Network access to HTTP endpoint',\n      'Optional: Dependencies for accessing their outputs in templates',\n    ];\n  }\n}\n","import { CheckProvider, CheckProviderConfig } from './check-provider.interface';\nimport { PRInfo } from '../pr-analyzer';\nimport { ReviewSummary } from '../reviewer';\nimport { Liquid } from 'liquidjs';\nimport { createExtendedLiquid } from '../liquid-extensions';\nimport { logger } from '../logger';\n\n/**\n * Check provider that receives input from HTTP webhooks and makes it available to dependent checks\n */\nexport class HttpInputProvider extends CheckProvider {\n  private liquid: Liquid;\n  private webhookContext?: Map<string, unknown>;\n\n  constructor() {\n    super();\n    this.liquid = createExtendedLiquid();\n  }\n\n  /**\n   * Set webhook context for accessing webhook data\n   */\n  setWebhookContext(webhookContext: Map<string, unknown>): void {\n    this.webhookContext = webhookContext;\n  }\n\n  getName(): string {\n    return 'http_input';\n  }\n\n  getDescription(): string {\n    return 'Receive and process HTTP webhook input data for use by dependent checks';\n  }\n\n  async validateConfig(config: unknown): Promise<boolean> {\n    if (!config || typeof config !== 'object') {\n      return false;\n    }\n\n    const cfg = config as CheckProviderConfig;\n\n    // Type must be 'http_input'\n    if (cfg.type !== 'http_input') {\n      return false;\n    }\n\n    // Must have endpoint specified\n    if (typeof cfg.endpoint !== 'string' || !cfg.endpoint) {\n      return false;\n    }\n\n    // Transform is optional but must be string if provided\n    if (cfg.transform !== undefined && typeof cfg.transform !== 'string') {\n      return false;\n    }\n\n    return true;\n  }\n\n  async execute(\n    prInfo: PRInfo,\n    config: CheckProviderConfig,\n    _dependencyResults?: Map<string, ReviewSummary>,\n    _sessionInfo?: { parentSessionId?: string; reuseSession?: boolean }\n  ): Promise<ReviewSummary> {\n    const endpoint = config.endpoint as string;\n    const transform = config.transform as string | undefined;\n\n    // In actual implementation, this would receive data from the webhook server\n    // For now, we'll check if there's webhook data in the execution context\n    const webhookData = this.getWebhookData(endpoint);\n\n    if (!webhookData) {\n      return {\n        issues: [],\n      };\n    }\n\n    // Apply transformation if specified\n    let processedData = webhookData;\n    if (transform) {\n      try {\n        const templateContext = {\n          webhook: webhookData,\n          pr: {\n            number: prInfo.number,\n            title: prInfo.title,\n            author: prInfo.author,\n            base: prInfo.base,\n            head: prInfo.head,\n          },\n        };\n        const rendered = await this.liquid.parseAndRender(transform, templateContext);\n        processedData = JSON.parse(rendered);\n        logger.verbose(`âœ“ Applied webhook transform successfully`);\n      } catch (error) {\n        logger.error(\n          `âœ— Failed to transform webhook data: ${error instanceof Error ? error.message : 'Unknown error'}`\n        );\n        return {\n          issues: [\n            {\n              file: 'webhook_input',\n              line: 0,\n              ruleId: 'webhook_input/transform_error',\n              message: `Failed to transform webhook data: ${error instanceof Error ? error.message : 'Unknown error'}`,\n              severity: 'error',\n              category: 'logic',\n            },\n          ],\n        };\n      }\n    }\n\n    // Return the processed data as a custom field for dependent checks to access\n    // This will be available in outputs for dependent checks\n    return {\n      issues: [],\n      // Add custom data field that will be passed through\n      data: processedData,\n    } as ReviewSummary & { data: unknown };\n  }\n\n  private getWebhookData(endpoint: string): Record<string, unknown> | null {\n    // Use webhook context if available (preferred method)\n    if (this.webhookContext) {\n      return (this.webhookContext.get(endpoint) as Record<string, unknown>) || null;\n    }\n\n    // Fallback to global store for backwards compatibility\n    // This should be removed once all usages are migrated\n    const globalWebhookStore = (global as Record<string, unknown>).__visor_webhook_data as\n      | Map<string, Record<string, unknown>>\n      | undefined;\n    if (globalWebhookStore && globalWebhookStore.get) {\n      console.warn(\n        'HttpInputProvider: Using deprecated global webhook store. Please use webhook context instead.'\n      );\n      return globalWebhookStore.get(endpoint) || null;\n    }\n\n    return null;\n  }\n\n  getSupportedConfigKeys(): string[] {\n    return ['type', 'endpoint', 'transform', 'on', 'depends_on', 'if', 'group'];\n  }\n\n  async isAvailable(): Promise<boolean> {\n    // Available if webhook server is configured and running\n    return true;\n  }\n\n  getRequirements(): string[] {\n    return [\n      'HTTP server must be configured and running',\n      'Valid endpoint path specified',\n      'Optional: Transform template for data processing',\n    ];\n  }\n}\n","import type { PRInfo } from '../pr-analyzer';\nimport type { ReviewSummary } from '../reviewer';\nimport { MemoryStore } from '../memory-store';\n\n/**\n * Build a common provider template context with PR info, outputs (current),\n * outputs.history (all runs), outputs_raw (aggregate -raw deps) and an alias\n * outputs_history / outputs_history_stage. Optionally attaches read-only\n * memory helpers (get/has/list/getAll).\n */\nconst PR_CACHE_LIMIT = 16;\nconst prCache = new Map<string, any>();\n\nfunction prCacheKey(pr: PRInfo): string {\n  // Hash on stable fields + file list summary to avoid rebuilding the same structure repeatedly\n  let sum = 0;\n  for (const f of pr.files) sum += (f.additions || 0) + (f.deletions || 0) + (f.changes || 0);\n  return [pr.number, pr.title, pr.author, pr.base, pr.head, pr.files.length, sum].join('|');\n}\n\nexport function buildProviderTemplateContext(\n  prInfo: PRInfo,\n  dependencyResults?: Map<string, ReviewSummary>,\n  memoryStore?: MemoryStore,\n  outputHistory?: Map<string, unknown[]>,\n  stageHistoryBase?: Record<string, number>,\n  opts: { attachMemoryReadHelpers?: boolean; args?: Record<string, unknown> } = {\n    attachMemoryReadHelpers: true,\n  }\n): Record<string, unknown> {\n  const context: Record<string, unknown> = {};\n\n  // PR context with tiny cache\n  const key = prCacheKey(prInfo);\n  let prObj = prCache.get(key);\n  if (!prObj) {\n    prObj = {\n      number: prInfo.number,\n      title: prInfo.title,\n      body: prInfo.body,\n      author: prInfo.author,\n      base: prInfo.base,\n      head: prInfo.head,\n      totalAdditions: prInfo.totalAdditions,\n      totalDeletions: prInfo.totalDeletions,\n      files: prInfo.files.map(f => ({\n        filename: f.filename,\n        status: f.status,\n        additions: f.additions,\n        deletions: f.deletions,\n        changes: f.changes,\n      })),\n    };\n    prCache.set(key, prObj);\n    if (prCache.size > PR_CACHE_LIMIT) {\n      const first = prCache.keys().next();\n      if (!first.done) prCache.delete(first.value);\n    }\n  }\n  context.pr = prObj;\n\n  // outputs and history\n  const outputs: Record<string, unknown> = {};\n  const outputsRaw: Record<string, unknown> = {};\n  const history: Record<string, unknown[]> = {};\n\n  if (dependencyResults) {\n    for (const [checkName, result] of dependencyResults.entries()) {\n      if (typeof checkName !== 'string') continue;\n      const summary = result as ReviewSummary & { output?: unknown };\n      if (checkName.endsWith('-raw')) {\n        const name = checkName.slice(0, -4);\n        outputsRaw[name] = summary.output !== undefined ? summary.output : summary;\n      } else {\n        const extracted = summary.output !== undefined ? summary.output : summary;\n        outputs[checkName] = extracted;\n      }\n    }\n  }\n\n  if (outputHistory) {\n    for (const [checkName, historyArray] of outputHistory) {\n      const arr = Array.isArray(historyArray) ? (historyArray as unknown[]) : [];\n      // Filter out aggregated forEach metadata objects to keep history aligned\n      // with per-item outputs. This mirrors provider-side history builder\n      // behavior and prevents scripts from accidentally counting aggregated\n      // results as items.\n      const filtered = arr.filter(v => {\n        try {\n          if (!v || typeof v !== 'object') return true;\n          const obj = v as Record<string, unknown>;\n          if (Array.isArray((obj as any).forEachItems)) return false;\n          if ((obj as any).isForEach === true && (obj as any).forEachItems !== undefined)\n            return false;\n        } catch {}\n        return true;\n      });\n      history[checkName] = filtered;\n    }\n  }\n\n  const historyStage: Record<string, unknown[]> = {};\n  try {\n    if (outputHistory && stageHistoryBase) {\n      for (const [checkName, historyArray] of outputHistory) {\n        const start = stageHistoryBase[checkName] || 0;\n        const arr = Array.isArray(historyArray) ? (historyArray as unknown[]) : [];\n        historyStage[checkName] = arr.slice(start);\n      }\n    }\n  } catch {}\n\n  (outputs as any).history = history;\n  context.outputs = outputs;\n  (context as any).outputs_history = history;\n  (context as any).outputs_history_stage = historyStage;\n  (context as any).outputs_raw = outputsRaw;\n\n  if (opts.attachMemoryReadHelpers && memoryStore) {\n    context.memory = {\n      get: (key: string, ns?: string) => memoryStore.get(key, ns),\n      has: (key: string, ns?: string) => memoryStore.has(key, ns),\n      list: (ns?: string) => memoryStore.list(ns),\n      getAll: (ns?: string) => memoryStore.getAll(ns),\n    } as Record<string, unknown>;\n  }\n\n  // Add args from on_init 'with' directive\n  if (opts.args) {\n    context.args = opts.args;\n  }\n\n  return context;\n}\n","import { CheckProvider, CheckProviderConfig } from './check-provider.interface';\nimport { PRInfo } from '../pr-analyzer';\nimport { ReviewSummary } from '../reviewer';\n// eslint-disable-next-line no-restricted-imports -- needed for Liquid type\nimport { Liquid } from 'liquidjs';\nimport { createExtendedLiquid } from '../liquid-extensions';\nimport { EnvironmentResolver } from '../utils/env-resolver';\nimport { createSecureSandbox, compileAndRun } from '../utils/sandbox';\nimport { buildProviderTemplateContext } from '../utils/template-context';\nimport Sandbox from '@nyariv/sandboxjs';\nimport { logger } from '../logger';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\n/**\n * Check provider that fetches data from HTTP endpoints\n */\nexport class HttpClientProvider extends CheckProvider {\n  private liquid: Liquid;\n  private sandbox?: Sandbox;\n\n  constructor() {\n    super();\n    this.liquid = createExtendedLiquid();\n  }\n\n  private createSecureSandbox(): Sandbox {\n    return createSecureSandbox();\n  }\n\n  getName(): string {\n    return 'http_client';\n  }\n\n  getDescription(): string {\n    return 'Fetch data from HTTP endpoints for use by dependent checks';\n  }\n\n  async validateConfig(config: unknown): Promise<boolean> {\n    if (!config || typeof config !== 'object') {\n      return false;\n    }\n\n    const cfg = config as CheckProviderConfig;\n\n    // Type must be 'http_client'\n    if (cfg.type !== 'http_client') {\n      return false;\n    }\n\n    // Must have URL specified\n    if (typeof cfg.url !== 'string' || !cfg.url) {\n      return false;\n    }\n\n    // Validate URL format\n    try {\n      new URL(cfg.url as string);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  async execute(\n    prInfo: PRInfo,\n    config: CheckProviderConfig,\n    dependencyResults?: Map<string, ReviewSummary>,\n    context?: import('./check-provider.interface').ExecutionContext\n  ): Promise<ReviewSummary> {\n    const url = config.url as string;\n    const method = (config.method as string) || 'GET';\n    const headers = (config.headers as Record<string, string>) || {};\n    const timeout = (config.timeout as number) || 30000;\n    const transform = config.transform as string | undefined;\n    const transformJs = config.transform_js as string | undefined;\n    const bodyTemplate = config.body as string | undefined;\n    const outputFileTemplate = config.output_file as string | undefined;\n    const skipIfExists = config.skip_if_exists !== false; // Default true for caching\n\n    // Track resolved URL for error messages\n    let resolvedUrlForErrors = url;\n\n    try {\n      // Use shared template context builder for consistent output extraction\n      const templateContext = buildProviderTemplateContext(\n        prInfo,\n        dependencyResults,\n        undefined, // memoryStore\n        undefined, // outputHistory\n        undefined, // stageHistoryBase\n        { attachMemoryReadHelpers: false }\n      );\n      // Add env to context for shell-style variable resolution\n      (templateContext as Record<string, unknown>).env = process.env;\n\n      // First resolve shell-style environment variables (${VAR}, $VAR, ${{ env.VAR }})\n      let renderedUrl = String(EnvironmentResolver.resolveValue(url));\n      resolvedUrlForErrors = renderedUrl; // Track for error messages\n\n      // Then render Liquid templates if present\n      if (renderedUrl.includes('{{') || renderedUrl.includes('{%')) {\n        renderedUrl = await this.liquid.parseAndRender(renderedUrl, templateContext);\n        resolvedUrlForErrors = renderedUrl; // Update after Liquid rendering\n      }\n\n      // Prepare request body if provided\n      let requestBody: string | undefined;\n      if (bodyTemplate) {\n        // First resolve shell-style environment variables\n        let resolvedBody = String(EnvironmentResolver.resolveValue(bodyTemplate));\n        // Then render Liquid templates if present\n        if (resolvedBody.includes('{{') || resolvedBody.includes('{%')) {\n          resolvedBody = await this.liquid.parseAndRender(resolvedBody, templateContext);\n        }\n        requestBody = resolvedBody;\n      }\n\n      // Resolve environment variables and Liquid templates in headers\n      const resolvedHeaders: Record<string, string> = {};\n      for (const [key, value] of Object.entries(headers)) {\n        let resolvedValue = String(EnvironmentResolver.resolveValue(value));\n        // Render Liquid templates if present\n        if (resolvedValue.includes('{{') || resolvedValue.includes('{%')) {\n          resolvedValue = await this.liquid.parseAndRender(resolvedValue, templateContext);\n        }\n        resolvedHeaders[key] = resolvedValue;\n        // Debug auth header (mask most of the value for security)\n        if (key.toLowerCase() === 'authorization') {\n          const maskedValue =\n            resolvedValue.length > 20\n              ? `${resolvedValue.substring(0, 15)}...${resolvedValue.substring(resolvedValue.length - 5)}`\n              : resolvedValue;\n          logger.verbose(`[http_client] ${key}: ${maskedValue}`);\n        }\n      }\n\n      // Resolve output_file path if specified\n      let resolvedOutputFile: string | undefined;\n      if (outputFileTemplate) {\n        let outputPath = String(EnvironmentResolver.resolveValue(outputFileTemplate));\n        if (outputPath.includes('{{') || outputPath.includes('{%')) {\n          outputPath = await this.liquid.parseAndRender(outputPath, templateContext);\n        }\n        resolvedOutputFile = outputPath.trim();\n\n        // When workspace is enabled and path is relative, resolve against workingDirectory\n        const parentContext = (context as any)?._parentContext;\n        const workingDirectory = parentContext?.workingDirectory;\n        const workspaceEnabled = parentContext?.workspace?.isEnabled?.();\n\n        if (workspaceEnabled && workingDirectory && !path.isAbsolute(resolvedOutputFile)) {\n          resolvedOutputFile = path.join(workingDirectory, resolvedOutputFile);\n          logger.debug(\n            `[http_client] Resolved relative output_file to workspace: ${resolvedOutputFile}`\n          );\n        }\n\n        // Check if file already exists (caching)\n        if (skipIfExists && fs.existsSync(resolvedOutputFile)) {\n          const stats = fs.statSync(resolvedOutputFile);\n          logger.verbose(`[http_client] File cached: ${resolvedOutputFile} (${stats.size} bytes)`);\n          return {\n            issues: [],\n            file_path: resolvedOutputFile,\n            size: stats.size,\n            cached: true,\n          } as unknown as ReviewSummary;\n        }\n      }\n\n      // Test hook: mock HTTP response for this step\n      const stepName = (config as any).checkName || 'unknown';\n      const mock = context?.hooks?.mockForStep?.(String(stepName));\n\n      // If mock is provided, return it directly as the step output (with issues: [])\n      if (mock !== undefined) {\n        const mockObj = typeof mock === 'object' && mock !== null ? mock : { data: mock };\n        return {\n          issues: [],\n          ...mockObj,\n        } as unknown as ReviewSummary & { data: unknown };\n      }\n\n      // Debug log the request for troubleshooting\n      logger.verbose(`[http_client] ${method} ${renderedUrl}`);\n      if (requestBody) {\n        logger.verbose(\n          `[http_client] Body: ${requestBody.substring(0, 500)}${requestBody.length > 500 ? '...' : ''}`\n        );\n      }\n\n      // If output_file is specified, download to file instead of returning data\n      if (resolvedOutputFile) {\n        const fileResult = await this.downloadToFile(\n          renderedUrl,\n          method,\n          resolvedHeaders,\n          requestBody,\n          timeout,\n          resolvedOutputFile\n        );\n        return fileResult;\n      }\n\n      const data = await this.fetchData(renderedUrl, method, resolvedHeaders, requestBody, timeout);\n\n      // Apply Liquid transformation if specified\n      let processedData = data;\n      if (transform) {\n        try {\n          const transformContext = {\n            response: data,\n            pr: templateContext.pr,\n            outputs: templateContext.outputs,\n          };\n          const rendered = await this.liquid.parseAndRender(transform, transformContext);\n          // Try to parse as JSON if the transform result looks like JSON\n          if (rendered.trim().startsWith('{') || rendered.trim().startsWith('[')) {\n            processedData = JSON.parse(rendered);\n          } else {\n            processedData = rendered;\n          }\n        } catch (error) {\n          return {\n            issues: [\n              {\n                file: 'http_client',\n                line: 0,\n                ruleId: 'http_client/transform_error',\n                message: `Failed to transform response data: ${error instanceof Error ? error.message : 'Unknown error'}`,\n                severity: 'error',\n                category: 'logic',\n              },\n            ],\n          };\n        }\n      }\n\n      // Apply JavaScript transformation if specified\n      if (transformJs) {\n        try {\n          this.sandbox = this.createSecureSandbox();\n\n          // Create scope for JavaScript transform (scope, not context)\n          const jsScope: Record<string, unknown> = {\n            output: data,\n            pr: templateContext.pr,\n            outputs: templateContext.outputs,\n            env: process.env,\n          };\n\n          const result = compileAndRun(this.sandbox, transformJs, jsScope, {\n            injectLog: true,\n            logPrefix: 'ðŸ” [transform_js]',\n            wrapFunction: true,\n          });\n          processedData = result;\n          logger.verbose(`âœ“ Applied JavaScript transform successfully`);\n        } catch (error) {\n          logger.error(\n            `âœ— Failed to apply JavaScript transform: ${error instanceof Error ? error.message : 'Unknown error'}`\n          );\n          return {\n            issues: [\n              {\n                file: 'http_client',\n                line: 0,\n                ruleId: 'http_client/transform_js_error',\n                message: `Failed to apply JavaScript transform: ${error instanceof Error ? error.message : 'Unknown error'}`,\n                severity: 'error',\n                category: 'logic',\n              },\n            ],\n          };\n        }\n      }\n\n      // Return the fetched data in the standard `output` property for guarantee evaluation\n      // This is consistent with other providers (script, command, ai, etc.)\n      return {\n        issues: [],\n        output: processedData,\n      } as unknown as ReviewSummary;\n    } catch (error) {\n      return {\n        issues: [\n          {\n            file: 'http_client',\n            line: 0,\n            ruleId: 'http_client/fetch_error',\n            message: `Failed to fetch from ${resolvedUrlForErrors}: ${error instanceof Error ? error.message : 'Unknown error'}`,\n            severity: 'error',\n            category: 'logic',\n          },\n        ],\n      };\n    }\n  }\n\n  private async fetchData(\n    url: string,\n    method: string,\n    headers: Record<string, string>,\n    body?: string,\n    timeout: number = 30000\n  ): Promise<unknown> {\n    // Check if fetch is available (Node 18+)\n    if (typeof fetch === 'undefined') {\n      throw new Error('HTTP client provider requires Node.js 18+ or node-fetch package');\n    }\n\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n    try {\n      const requestOptions: RequestInit = {\n        method,\n        headers: {\n          ...headers,\n        },\n        signal: controller.signal,\n      };\n\n      // Add body for non-GET requests\n      if (method !== 'GET' && body) {\n        requestOptions.body = body;\n        // Set Content-Type if not already set\n        if (!headers['Content-Type'] && !headers['content-type']) {\n          requestOptions.headers = {\n            ...requestOptions.headers,\n            'Content-Type': 'application/json',\n          };\n        }\n      }\n\n      const response = await fetch(url, requestOptions);\n\n      clearTimeout(timeoutId);\n\n      logger.verbose(`[http_client] Response: ${response.status} ${response.statusText}`);\n\n      if (!response.ok) {\n        // Log response body for debugging auth failures\n        try {\n          const errorBody = await response.text();\n          logger.warn(`[http_client] Error body: ${errorBody.substring(0, 500)}`);\n        } catch {}\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n\n      // Try to parse as JSON first\n      const contentType = response.headers.get('content-type');\n      if (contentType && contentType.includes('application/json')) {\n        return await response.json();\n      }\n\n      // Otherwise return as text\n      const text = await response.text();\n\n      // Try to parse as JSON if it looks like JSON\n      if (text.trim().startsWith('{') || text.trim().startsWith('[')) {\n        try {\n          return JSON.parse(text);\n        } catch {\n          // Not JSON, return as text\n          return text;\n        }\n      }\n\n      return text;\n    } catch (error: unknown) {\n      clearTimeout(timeoutId);\n\n      if (error instanceof Error && error.name === 'AbortError') {\n        throw new Error(`Request timed out after ${timeout}ms`);\n      }\n\n      throw error;\n    }\n  }\n\n  private async downloadToFile(\n    url: string,\n    method: string,\n    headers: Record<string, string>,\n    body: string | undefined,\n    timeout: number,\n    outputFile: string\n  ): Promise<ReviewSummary> {\n    // Check if fetch is available (Node 18+)\n    if (typeof fetch === 'undefined') {\n      throw new Error('HTTP client provider requires Node.js 18+ or node-fetch package');\n    }\n\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n    try {\n      const requestOptions: RequestInit = {\n        method,\n        headers: { ...headers },\n        signal: controller.signal,\n      };\n\n      // Add body for non-GET requests\n      if (method !== 'GET' && body) {\n        requestOptions.body = body;\n        if (!headers['Content-Type'] && !headers['content-type']) {\n          requestOptions.headers = {\n            ...requestOptions.headers,\n            'Content-Type': 'application/json',\n          };\n        }\n      }\n\n      const response = await fetch(url, requestOptions);\n      clearTimeout(timeoutId);\n\n      if (!response.ok) {\n        return {\n          issues: [\n            {\n              file: 'http_client',\n              line: 0,\n              ruleId: 'http_client/download_error',\n              message: `Failed to download file: HTTP ${response.status}: ${response.statusText}`,\n              severity: 'error',\n              category: 'logic',\n            },\n          ],\n        };\n      }\n\n      // Create parent directory if it doesn't exist\n      const parentDir = path.dirname(outputFile);\n      if (parentDir && !fs.existsSync(parentDir)) {\n        fs.mkdirSync(parentDir, { recursive: true });\n      }\n\n      // Get the response as an ArrayBuffer and write to file\n      const arrayBuffer = await response.arrayBuffer();\n      const buffer = Buffer.from(arrayBuffer);\n      fs.writeFileSync(outputFile, buffer);\n\n      const contentType = response.headers.get('content-type') || 'application/octet-stream';\n      logger.verbose(`[http_client] Downloaded: ${outputFile} (${buffer.length} bytes)`);\n\n      return {\n        issues: [],\n        file_path: outputFile,\n        size: buffer.length,\n        content_type: contentType,\n        cached: false,\n      } as unknown as ReviewSummary;\n    } catch (error: unknown) {\n      clearTimeout(timeoutId);\n\n      if (error instanceof Error && error.name === 'AbortError') {\n        return {\n          issues: [\n            {\n              file: 'http_client',\n              line: 0,\n              ruleId: 'http_client/download_timeout',\n              message: `Download timed out after ${timeout}ms`,\n              severity: 'error',\n              category: 'logic',\n            },\n          ],\n        };\n      }\n\n      return {\n        issues: [\n          {\n            file: 'http_client',\n            line: 0,\n            ruleId: 'http_client/download_error',\n            message: `Failed to download file: ${error instanceof Error ? error.message : 'Unknown error'}`,\n            severity: 'error',\n            category: 'logic',\n          },\n        ],\n      };\n    }\n  }\n\n  getSupportedConfigKeys(): string[] {\n    return [\n      'type',\n      'url',\n      'method',\n      'headers',\n      'body',\n      'transform',\n      'transform_js',\n      'timeout',\n      'output_file',\n      'skip_if_exists',\n      'depends_on',\n      'on',\n      'if',\n      'group',\n      'schedule',\n    ];\n  }\n\n  async isAvailable(): Promise<boolean> {\n    // HTTP client is available if fetch is available\n    return typeof fetch !== 'undefined';\n  }\n\n  getRequirements(): string[] {\n    return [\n      'Valid HTTP/HTTPS URL to fetch from',\n      'Network access to the endpoint',\n      'Optional: Transform template for processing response data',\n      'Optional: Body template for POST/PUT requests',\n      'Optional: output_file path to download response to a file',\n      'Optional: skip_if_exists (default: true) to enable caching for file downloads',\n    ];\n  }\n}\n","import { CheckProvider, CheckProviderConfig } from './check-provider.interface';\nimport { PRInfo } from '../pr-analyzer';\nimport { ReviewSummary } from '../reviewer';\n\n/**\n * No-operation check provider that doesn't perform any analysis.\n *\n * This provider is designed for command orchestration - it allows creating\n * checks that exist purely to trigger other checks through dependencies.\n *\n * Example use case: A \"/review\" command that triggers multiple analysis checks\n * without performing any analysis itself.\n */\nexport class NoopCheckProvider extends CheckProvider {\n  getName(): string {\n    return 'noop';\n  }\n\n  getDescription(): string {\n    return 'No-operation provider for command orchestration and dependency triggering';\n  }\n\n  async validateConfig(config: unknown): Promise<boolean> {\n    if (!config || typeof config !== 'object') {\n      return false;\n    }\n\n    const cfg = config as CheckProviderConfig;\n\n    // Type must be 'noop'\n    if (cfg.type !== 'noop') {\n      return false;\n    }\n\n    return true;\n  }\n\n  async execute(\n    _prInfo: PRInfo,\n    _config: CheckProviderConfig,\n    _dependencyResults?: Map<string, ReviewSummary>,\n    _sessionInfo?: { parentSessionId?: string; reuseSession?: boolean }\n  ): Promise<ReviewSummary> {\n    // Noop provider doesn't perform any analysis\n    // It exists purely for command orchestration and dependency triggering\n    return {\n      issues: [],\n    };\n  }\n\n  getSupportedConfigKeys(): string[] {\n    return ['type', 'command', 'depends_on', 'on', 'if', 'group'];\n  }\n\n  async isAvailable(): Promise<boolean> {\n    // Noop provider is always available\n    return true;\n  }\n\n  getRequirements(): string[] {\n    return [\n      'No external dependencies required',\n      'Used for command orchestration and dependency triggering',\n    ];\n  }\n}\n","import { CheckProvider, CheckProviderConfig, ExecutionContext } from './check-provider.interface';\nimport { PRInfo } from '../pr-analyzer';\nimport { ReviewSummary } from '../reviewer';\n// eslint-disable-next-line no-restricted-imports -- needed for Liquid type\nimport { Liquid } from 'liquidjs';\nimport { createExtendedLiquid } from '../liquid-extensions';\nimport { logger } from '../logger';\n\n/**\n * Log levels supported by the log provider\n */\nexport type LogLevel = 'debug' | 'info' | 'warn' | 'error';\n\n/**\n * Check provider that outputs debugging and logging information.\n * Useful for troubleshooting check workflows and understanding execution flow.\n */\nexport class LogCheckProvider extends CheckProvider {\n  private liquid: Liquid;\n\n  constructor() {\n    super();\n    this.liquid = createExtendedLiquid({\n      strictVariables: false,\n      strictFilters: false,\n    });\n  }\n\n  getName(): string {\n    return 'log';\n  }\n\n  getDescription(): string {\n    return 'Output debugging and logging information for troubleshooting check workflows';\n  }\n\n  async validateConfig(config: unknown): Promise<boolean> {\n    if (!config || typeof config !== 'object') {\n      return false;\n    }\n\n    const cfg = config as CheckProviderConfig;\n\n    // Type must be 'log'\n    if (cfg.type !== 'log') {\n      return false;\n    }\n\n    // Message is required\n    if (!cfg.message || typeof cfg.message !== 'string') {\n      return false;\n    }\n\n    // Validate log level if provided\n    if (cfg.level && !['debug', 'info', 'warn', 'error'].includes(cfg.level as string)) {\n      return false;\n    }\n\n    return true;\n  }\n\n  async execute(\n    prInfo: PRInfo,\n    config: CheckProviderConfig,\n    dependencyResults?: Map<string, ReviewSummary>,\n    context?: ExecutionContext\n  ): Promise<ReviewSummary> {\n    const message = config.message as string;\n    const level = (config.level as LogLevel) || 'info';\n    const includePrContext = config.include_pr_context !== false;\n    const includeDependencies = config.include_dependencies !== false;\n    const includeMetadata = config.include_metadata !== false;\n\n    // Prepare template context\n    const templateContext = this.buildTemplateContext(\n      prInfo,\n      dependencyResults,\n      includePrContext,\n      includeDependencies,\n      includeMetadata,\n      config.__outputHistory as Map<string, unknown[]> | undefined,\n      context,\n      config\n    );\n\n    // Render the log message template\n    const renderedMessage = await this.liquid.parseAndRender(message, templateContext);\n\n    // Build the log output\n    const logOutput = this.formatLogOutput(\n      level,\n      renderedMessage,\n      templateContext,\n      includePrContext,\n      includeDependencies,\n      includeMetadata\n    );\n\n    // Route through centralized logger to keep stdout clean in JSON/SARIF\n    if (level === 'error') logger.error(logOutput);\n    else if (level === 'warn') logger.warn(logOutput);\n    else if (level === 'debug') logger.debug(logOutput);\n    else logger.info(logOutput);\n\n    // Return with the log content as custom data for dependent checks.\n    // For chat-style logs (group: chat), also expose a structured\n    // `output.text` field so frontends like Slack can post a clean\n    // human-facing message without the level prefix.\n    // Also set `content` so it gets included in CheckResult for TUI display.\n    const summary: ReviewSummary & { logOutput: string; content: string; output?: unknown } = {\n      issues: [],\n      logOutput,\n      content: renderedMessage, // Used by runner to build CheckResult\n    };\n\n    if ((config as any).group === 'chat') {\n      (summary as any).output = { text: renderedMessage };\n    }\n\n    return summary;\n  }\n\n  private buildTemplateContext(\n    prInfo: PRInfo,\n    dependencyResults?: Map<string, ReviewSummary>,\n    _includePrContext: boolean = true,\n    _includeDependencies: boolean = true,\n    includeMetadata: boolean = true,\n    outputHistory?: Map<string, unknown[]>,\n    executionContext?: ExecutionContext,\n    config?: CheckProviderConfig\n  ): Record<string, unknown> {\n    const context: Record<string, unknown> = {};\n\n    // Always provide pr context for template rendering\n    context.pr = {\n      number: prInfo.number,\n      title: prInfo.title,\n      body: prInfo.body,\n      author: prInfo.author,\n      base: prInfo.base,\n      head: prInfo.head,\n      totalAdditions: prInfo.totalAdditions,\n      totalDeletions: prInfo.totalDeletions,\n      files: prInfo.files.map(f => ({\n        filename: f.filename,\n        status: f.status,\n        additions: f.additions,\n        deletions: f.deletions,\n        changes: f.changes,\n      })),\n    };\n\n    // Add convenience data\n    context.filenames = prInfo.files.map(f => f.filename);\n    context.fileCount = prInfo.files.length;\n\n    // Always provide dependency data for template rendering\n    if (dependencyResults) {\n      const dependencies: Record<string, unknown> = {};\n      const outputs: Record<string, unknown> = {};\n      const outputsRaw: Record<string, unknown> = {};\n      const history: Record<string, unknown[]> = {};\n      context.dependencyCount = dependencyResults.size;\n\n      for (const [checkName, result] of dependencyResults.entries()) {\n        if (typeof checkName !== 'string') continue;\n        dependencies[checkName] = {\n          issueCount: result.issues?.length || 0,\n          suggestionCount: 0,\n          issues: result.issues || [],\n        };\n\n        // Add outputs namespace for accessing dependency results directly\n        const summary = result as import('../reviewer').ReviewSummary & { output?: unknown };\n        if (typeof checkName === 'string' && checkName.endsWith('-raw')) {\n          const name = checkName.slice(0, -4);\n          outputsRaw[name] = summary.output !== undefined ? summary.output : summary;\n        } else {\n          outputs[checkName] = summary.output !== undefined ? summary.output : summary;\n        }\n      }\n\n      // Add history for each check if available\n      if (outputHistory) {\n        for (const [checkName, historyArray] of outputHistory) {\n          history[checkName] = historyArray;\n        }\n      }\n\n      // Attach history to the outputs object\n      (outputs as any).history = history;\n\n      context.dependencies = dependencies;\n      context.outputs = outputs;\n      // Alias: outputs_history mirrors outputs.history for consistency\n      (context as any).outputs_history = history;\n      // New: outputs_raw exposes aggregate values (e.g., arrays) for forEach parents\n      (context as any).outputs_raw = outputsRaw;\n    }\n\n    if (includeMetadata) {\n      context.metadata = {\n        timestamp: new Date().toISOString(),\n        executionTime: Date.now(),\n        nodeVersion: process.version,\n        platform: process.platform,\n        workingDirectory: process.cwd(),\n      };\n    }\n\n    // Add workflow inputs if available\n    // Check config first (set by projectWorkflowToGraph), then fall back to executionContext\n    const workflowInputs =\n      (config as any)?.workflowInputs || executionContext?.workflowInputs || {};\n    logger.debug(\n      `[LogProvider] Adding ${Object.keys(workflowInputs).length} workflow inputs to context`\n    );\n    context.inputs = workflowInputs;\n\n    return context;\n  }\n\n  private formatLogOutput(\n    level: LogLevel,\n    message: string,\n    templateContext: Record<string, unknown>,\n    includePrContext: boolean,\n    includeDependencies: boolean,\n    includeMetadata: boolean\n  ): string {\n    const sections: string[] = [];\n\n    // Log level and message\n    const levelEmoji = this.getLevelEmoji(level);\n    sections.push(`${levelEmoji} **${level.toUpperCase()}**: ${message}`);\n\n    // PR context section\n    if (includePrContext && templateContext.pr) {\n      const pr = templateContext.pr as Record<string, unknown>;\n      sections.push('');\n      sections.push('### PR Context');\n      sections.push(`- **PR #${pr.number}**: ${pr.title}`);\n      sections.push(`- **Author**: ${pr.author}`);\n      sections.push(`- **Base**: ${pr.base} â†’ **Head**: ${pr.head}`);\n      sections.push(`- **Changes**: +${pr.totalAdditions} -${pr.totalDeletions}`);\n      sections.push(`- **Files Modified**: ${templateContext.fileCount}`);\n    }\n\n    // Dependencies section\n    if (includeDependencies && templateContext.dependencies) {\n      const deps = templateContext.dependencies as Record<string, Record<string, unknown>>;\n      sections.push('');\n      sections.push('### Dependency Results');\n\n      if (Object.keys(deps).length === 0) {\n        sections.push('- No dependency results available');\n      } else {\n        for (const [checkName, result] of Object.entries(deps)) {\n          sections.push(\n            `- **${checkName}**: ${result.issueCount} issues, ${result.suggestionCount} suggestions`\n          );\n        }\n      }\n    }\n\n    // Metadata section\n    if (includeMetadata && templateContext.metadata) {\n      const meta = templateContext.metadata as Record<string, unknown>;\n      sections.push('');\n      sections.push('### Execution Metadata');\n      sections.push(`- **Timestamp**: ${meta.timestamp}`);\n      sections.push(`- **Node Version**: ${meta.nodeVersion}`);\n      sections.push(`- **Platform**: ${meta.platform}`);\n      sections.push(`- **Working Directory**: ${meta.workingDirectory}`);\n    }\n\n    return sections.join('\\n');\n  }\n\n  private getLevelEmoji(level: LogLevel): string {\n    switch (level) {\n      case 'debug':\n        return 'ðŸ›';\n      case 'info':\n        return 'â„¹ï¸';\n      case 'warn':\n        return 'âš ï¸';\n      case 'error':\n        return 'âŒ';\n      default:\n        return 'â„¹ï¸';\n    }\n  }\n\n  getSupportedConfigKeys(): string[] {\n    return [\n      'type',\n      'message',\n      'level',\n      'include_pr_context',\n      'include_dependencies',\n      'include_metadata',\n      'group',\n      'command',\n      'depends_on',\n      'on',\n      'if',\n    ];\n  }\n\n  async isAvailable(): Promise<boolean> {\n    // Log provider is always available\n    return true;\n  }\n\n  getRequirements(): string[] {\n    return [\n      'No external dependencies required',\n      'Used for debugging and logging check execution flow',\n    ];\n  }\n}\n","import type { RecordingOctokit } from './github-recorder';\n\nlet __rec: RecordingOctokit | null = null;\n\nexport function setGlobalRecorder(r: RecordingOctokit | null): void {\n  __rec = r;\n}\n\nexport function getGlobalRecorder(): RecordingOctokit | null {\n  return __rec;\n}\n","import { CheckProvider, CheckProviderConfig } from './check-provider.interface';\nimport { PRInfo } from '../pr-analyzer';\nimport { ReviewSummary } from '../reviewer';\nimport Sandbox from '@nyariv/sandboxjs';\nimport { createSecureSandbox } from '../utils/sandbox';\nimport { createExtendedLiquid } from '../liquid-extensions';\nimport { logger } from '../logger';\n\nexport class GitHubOpsProvider extends CheckProvider {\n  private sandbox?: Sandbox;\n\n  getName(): string {\n    return 'github';\n  }\n\n  getDescription(): string {\n    return 'Native GitHub operations (labels, comments, reviewers) executed via Octokit';\n  }\n\n  async validateConfig(config: unknown): Promise<boolean> {\n    if (!config || typeof config !== 'object') return false;\n    const cfg = config as CheckProviderConfig & { op?: string };\n    return typeof cfg.op === 'string' && cfg.op.length > 0;\n  }\n\n  getSupportedConfigKeys(): string[] {\n    return ['op', 'values', 'value'];\n  }\n\n  async isAvailable(): Promise<boolean> {\n    // Available when running in GitHub context or when a token is provided\n    return Boolean(\n      process.env.GITHUB_TOKEN || process.env['INPUT_GITHUB-TOKEN'] || process.env.GITHUB_REPOSITORY\n    );\n  }\n\n  getRequirements(): string[] {\n    return ['GITHUB_TOKEN or INPUT_GITHUB-TOKEN', 'GITHUB_REPOSITORY'];\n  }\n\n  async execute(\n    prInfo: PRInfo,\n    config: CheckProviderConfig,\n    dependencyResults?: Map<string, ReviewSummary>\n  ): Promise<ReviewSummary> {\n    const cfg = config as CheckProviderConfig & {\n      op: string;\n      values?: string[] | string;\n      value?: string;\n    };\n\n    // IMPORTANT: Always prefer authenticated octokit from event context (GitHub App or token)\n    // This ensures proper bot identity in reactions, labels, and comments\n    let octokit: import('@octokit/rest').Octokit | undefined = config.eventContext?.octokit as\n      | import('@octokit/rest').Octokit\n      | undefined;\n    if (process.env.VISOR_DEBUG === 'true') {\n      try {\n        logger.debug(`[github-ops] pre-fallback octokit? ${!!octokit}`);\n      } catch {}\n    }\n    // Test runner fallback: use global recorder if eventContext is missing octokit\n    if (!octokit) {\n      try {\n        const { getGlobalRecorder } = require('../test-runner/recorders/global-recorder');\n        const rec = getGlobalRecorder && getGlobalRecorder();\n        if (rec) octokit = rec as any;\n      } catch {}\n    }\n\n    if (!octokit) {\n      if (process.env.VISOR_DEBUG === 'true') {\n        try {\n          console.error('[github-ops] missing octokit after fallback â€” returning issue');\n        } catch {}\n      }\n      return {\n        issues: [\n          {\n            file: 'system',\n            line: 0,\n            ruleId: 'github/missing_octokit',\n            message:\n              'No authenticated Octokit instance available in event context. GitHub operations require proper authentication context.',\n            severity: 'error',\n            category: 'logic',\n          },\n        ],\n      };\n    }\n\n    const repoEnv = process.env.GITHUB_REPOSITORY || '';\n    let owner = '';\n    let repo = '';\n    if (repoEnv.includes('/')) {\n      [owner, repo] = repoEnv.split('/') as [string, string];\n    } else {\n      try {\n        const ec: any = config.eventContext || {};\n        owner = ec?.repository?.owner?.login || owner;\n        repo = ec?.repository?.name || repo;\n      } catch {}\n    }\n    try {\n      if (process.env.VISOR_DEBUG === 'true') {\n        logger.info(\n          `[github-ops] context octokit? ${!!octokit} repo=${owner}/${repo} pr#=${prInfo?.number}`\n        );\n      }\n    } catch {}\n    if (!owner || !repo || !prInfo?.number) {\n      return {\n        issues: [\n          {\n            file: 'system',\n            line: 0,\n            ruleId: 'github/missing_context',\n            message: 'Missing owner/repo or PR number; GitHub operations require Action context',\n            severity: 'error',\n            category: 'logic',\n          },\n        ],\n      };\n    }\n\n    // Build values list (allow string or array), render Liquid templates if present, and normalize\n    let valuesRaw: string[] = [];\n    if (Array.isArray(cfg.values)) valuesRaw = (cfg.values as unknown[]).map(v => String(v));\n    else if (typeof cfg.values === 'string') valuesRaw = [cfg.values];\n    else if (typeof cfg.value === 'string') valuesRaw = [cfg.value];\n    try {\n      if (process.env.VISOR_DEBUG === 'true') {\n        logger.info(`[github-ops] op=${cfg.op} valuesRaw(before)=${JSON.stringify(valuesRaw)}`);\n      }\n    } catch {}\n\n    // Liquid render helper for values\n    const renderValues = async (arr: string[]): Promise<string[]> => {\n      if (!arr || arr.length === 0) return [];\n      const liq = createExtendedLiquid({\n        cache: false,\n        strictFilters: false,\n        strictVariables: false,\n      });\n      const outputs: Record<string, unknown> = {};\n      if (dependencyResults) {\n        for (const [name, result] of dependencyResults.entries()) {\n          const summary = result as ReviewSummary & { output?: unknown };\n          outputs[name] = summary.output !== undefined ? summary.output : summary;\n        }\n      }\n      // Fallback: if outputs missing but engine provided history, use last output snapshot\n      try {\n        const hist = (config as any).__outputHistory as Map<string, unknown[]> | undefined;\n        if (hist) {\n          for (const [name, arr] of hist.entries()) {\n            if (!outputs[name] && Array.isArray(arr) && arr.length > 0) {\n              outputs[name] = arr[arr.length - 1];\n            }\n          }\n        }\n      } catch {}\n      const ctx = {\n        pr: {\n          number: prInfo.number,\n          title: prInfo.title,\n          author: prInfo.author,\n          branch: prInfo.head,\n          base: prInfo.base,\n          authorAssociation: prInfo.authorAssociation,\n        },\n        outputs,\n      };\n      try {\n        if (process.env.VISOR_DEBUG === 'true') {\n          logger.info(`[github-ops] deps keys=${Object.keys(outputs).join(', ')}`);\n          const ov = outputs['overview'] as any;\n          if (ov) {\n            logger.info(`[github-ops] outputs.overview.keys=${Object.keys(ov).join(',')}`);\n            if (ov.tags) {\n              logger.info(\n                `[github-ops] outputs.overview.tags keys=${Object.keys(ov.tags).join(',')}`\n              );\n              try {\n                logger.info(\n                  `[github-ops] outputs.overview.tags['review-effort']=${String(ov.tags['review-effort'])}`\n                );\n              } catch {}\n            }\n          }\n        }\n      } catch {}\n      const out: string[] = [];\n      for (const item of arr) {\n        if (typeof item === 'string' && (item.includes('{{') || item.includes('{%'))) {\n          try {\n            const rendered = await liq.parseAndRender(item, ctx);\n            out.push(rendered);\n          } catch (e) {\n            // If Liquid fails, surface as a provider error\n            const msg = e instanceof Error ? e.message : String(e);\n            if (process.env.VISOR_DEBUG === 'true') {\n              logger.warn(`[github-ops] liquid_render_error: ${msg}`);\n            }\n            return Promise.reject({\n              issues: [\n                {\n                  file: 'system',\n                  line: 0,\n                  ruleId: 'github/liquid_render_error',\n                  message: `Failed to render template: ${msg}`,\n                  severity: 'error',\n                  category: 'logic',\n                },\n              ],\n            } as ReviewSummary);\n          }\n        } else {\n          out.push(String(item));\n        }\n      }\n      return out;\n    };\n\n    let values: string[] = await renderValues(valuesRaw);\n\n    // Flatten helpers: allow a single Liquid-rendered value to represent\n    // a JSON array (e.g., \"{{ outputs['issue-assistant'].labels | json }}\")\n    // or a newline-separated list. This makes explicit YAML configs expressive\n    // without re-introducing value_js.\n    try {\n      const flattened: string[] = [];\n      for (const v of values) {\n        const t = String(v ?? '').trim();\n        if (!t) continue;\n        let expanded = false;\n        // JSON array expansion\n        if (t.startsWith('[') && t.endsWith(']')) {\n          try {\n            const arr = JSON.parse(t);\n            if (Array.isArray(arr)) {\n              for (const x of arr) flattened.push(String(x ?? ''));\n              expanded = true;\n            }\n          } catch {}\n        }\n        if (expanded) continue;\n        // Newline-separated fallback (one per line)\n        if (t.includes('\\n')) {\n          for (const line of t.split('\\n')) {\n            const s = line.trim();\n            if (s) flattened.push(s);\n          }\n          expanded = true;\n        }\n        if (!expanded) flattened.push(t);\n      }\n      values = flattened;\n    } catch {}\n\n    // Expose dependency outputs to value_js for convenience (generic map)\n    const depOutputs: Record<string, unknown> = {};\n    if (dependencyResults) {\n      for (const [name, result] of dependencyResults.entries()) {\n        const summary = result as ReviewSummary & { output?: unknown };\n        depOutputs[name] = summary.output !== undefined ? summary.output : summary;\n      }\n    }\n\n    // Provider-side normalization replaces legacy value_js usage\n    const sanitizeLabel = (s: string) =>\n      s\n        .replace(/[^A-Za-z0-9:\\/\\- ]/g, '')\n        .replace(/\\/{2,}/g, '/')\n        .trim();\n    values = (Array.isArray(values) ? values : [])\n      .map(v => String(v ?? ''))\n      .map(sanitizeLabel)\n      .filter(Boolean);\n\n    // Fallback: if values are still empty, try deriving from dependency outputs\n    // 1) Common pattern: outputs.<dep>.labels (e.g., from issue-assistant)\n    if (values.length === 0 && Object.keys(depOutputs).length > 0) {\n      try {\n        const lbls: string[] = [];\n        for (const obj of Object.values(depOutputs)) {\n          const labelsAny = (obj as any)?.labels;\n          if (Array.isArray(labelsAny)) {\n            for (const v of labelsAny) lbls.push(String(v ?? ''));\n          }\n        }\n        const norm = lbls\n          .map(s => s.trim())\n          .filter(Boolean)\n          .map(s => s.replace(/[^A-Za-z0-9:\\/\\- ]/g, '').replace(/\\/{2,}/g, '/'));\n        values = Array.from(new Set(norm));\n        if (process.env.VISOR_DEBUG === 'true') {\n          logger.info(`[github-ops] derived values from deps.labels: ${JSON.stringify(values)}`);\n        }\n      } catch {}\n    }\n\n    // 2) Fallback: outputs.<dep>.tags based derivation (overview-style)\n    // Fallback: if values are still empty, try deriving from dependency outputs (common pattern: outputs.<dep>.tags)\n    if (values.length === 0 && dependencyResults && dependencyResults.size > 0) {\n      try {\n        const derived: string[] = [];\n        for (const result of dependencyResults.values()) {\n          const out = (result as ReviewSummary & { output?: unknown })?.output ?? result;\n          const tags = (out as Record<string, unknown>)?.['tags'] as\n            | Record<string, unknown>\n            | undefined;\n          if (tags && typeof tags === 'object') {\n            const label = tags['label'];\n            const effort = (tags as Record<string, unknown>)['review-effort'];\n            if (label != null) derived.push(String(label));\n            if (effort !== undefined && effort !== null)\n              derived.push(`review/effort:${String(effort)}`);\n          }\n        }\n        values = derived;\n        if (process.env.VISOR_DEBUG === 'true') {\n          logger.info(`[github-ops] derived values from deps: ${JSON.stringify(values)}`);\n        }\n      } catch {}\n    }\n\n    // Trim (already sanitized), drop empty, and de-duplicate values regardless of source\n    values = Array.from(new Set(values));\n\n    try {\n      // Minimal debug to help diagnose label flow under tests\n      if (process.env.NODE_ENV === 'test' || process.env.VISOR_DEBUG === 'true') {\n        logger.info(`[github-ops] ${cfg.op} resolved values: ${JSON.stringify(values)}`);\n      }\n    } catch {}\n\n    try {\n      switch (cfg.op) {\n        case 'labels.add': {\n          if (values.length === 0) break; // no-op if nothing to add\n          try {\n            if (process.env.VISOR_OUTPUT_FORMAT !== 'json')\n              logger.step(`[github-ops] labels.add -> ${JSON.stringify(values)}`);\n          } catch {}\n          await octokit.rest.issues.addLabels({\n            owner,\n            repo,\n            issue_number: prInfo.number,\n            labels: values,\n          });\n          break;\n        }\n        case 'labels.remove': {\n          for (const l of values) {\n            await octokit.rest.issues.removeLabel({\n              owner,\n              repo,\n              issue_number: prInfo.number,\n              name: l,\n            });\n          }\n          break;\n        }\n        case 'comment.create': {\n          const body = values.join('\\n').trim();\n          if (body)\n            await octokit.rest.issues.createComment({\n              owner,\n              repo,\n              issue_number: prInfo.number,\n              body,\n            });\n          break;\n        }\n        default:\n          return {\n            issues: [\n              {\n                file: 'system',\n                line: 0,\n                ruleId: 'github/unsupported_op',\n                message: `Unsupported GitHub op: ${cfg.op}`,\n                severity: 'error',\n                category: 'logic',\n              },\n            ],\n          };\n      }\n\n      return { issues: [] };\n    } catch (e) {\n      const msg = e instanceof Error ? e.message : String(e);\n      try {\n        logger.error(`[github-ops] op_failed ${cfg.op}: ${msg}`);\n      } catch {}\n      return {\n        issues: [\n          {\n            file: 'system',\n            line: 0,\n            ruleId: 'github/op_failed',\n            message: `GitHub operation failed (${cfg.op}): ${msg}`,\n            severity: 'error',\n            category: 'logic',\n          },\n        ],\n      };\n    }\n  }\n\n  /**\n   * Create a secure sandbox for evaluating small expressions without access to process/env\n   */\n  private getSecureSandbox(): Sandbox {\n    if (this.sandbox) return this.sandbox;\n    this.sandbox = createSecureSandbox();\n    return this.sandbox;\n  }\n}\n","/**\n * Type definitions for Claude Code SDK and MCP SDK\n * These are placeholder types for when the packages aren't installed\n */\n\n// Claude Code SDK types\nexport interface ClaudeCodeQuery {\n  query: string;\n  tools?: Array<{\n    name: string;\n    [key: string]: unknown;\n  }>;\n  subagent?: string;\n  maxTurns?: number;\n  systemPrompt?: string;\n  sessionId?: string;\n}\n\nexport interface ClaudeCodeResponse {\n  content: string;\n  usage?: {\n    input_tokens: number;\n    output_tokens: number;\n  };\n  turn_count?: number;\n  session_id?: string;\n}\n\nexport interface ClaudeCodeClient {\n  query(options: ClaudeCodeQuery): Promise<ClaudeCodeResponse>;\n}\n\n// MCP Server configuration interface\nexport interface McpServerConfig {\n  command: string;\n  args?: string[];\n  env?: Record<string, string>;\n}\n\n// MCP Tool interface\nexport interface McpTool {\n  name: string;\n  description?: string;\n  inputSchema?: Record<string, unknown>;\n  handler?: (args: Record<string, unknown>) => Promise<unknown>;\n}\n\n// MCP Server interface\nexport interface McpServer {\n  name: string;\n  command?: string;\n  args?: string[];\n  env?: Record<string, string>;\n  tools?: McpTool[];\n}\n\n// MCP Server Instance interface\nexport interface McpServerInstance {\n  name: string;\n  listTools(): Promise<McpTool[]>;\n  callTool(name: string, args: Record<string, unknown>): Promise<unknown>;\n  close(): Promise<void>;\n}\n\n// Claude Code configuration interface\nexport interface ClaudeCodeConfig {\n  allowedTools?: string[];\n  maxTurns?: number;\n  systemPrompt?: string;\n  mcpServers?: Record<string, McpServerConfig>;\n  subagent?: string;\n  hooks?: {\n    onStart?: string;\n    onEnd?: string;\n    onError?: string;\n  };\n}\n\n/**\n * Utility function to safely import optional dependencies\n */\nexport async function safeImport<T>(moduleName: string): Promise<T | null> {\n  try {\n    return await import(moduleName);\n  } catch {\n    return null;\n  }\n}\n","import { CheckProvider, CheckProviderConfig } from './check-provider.interface';\nimport { PRInfo } from '../pr-analyzer';\nimport { ReviewSummary } from '../reviewer';\nimport { EnvironmentResolver } from '../utils/env-resolver';\nimport { IssueFilter } from '../issue-filter';\nimport { Liquid } from 'liquidjs';\nimport { createExtendedLiquid } from '../liquid-extensions';\nimport fs from 'fs/promises';\nimport path from 'path';\nimport {\n  ClaudeCodeQuery,\n  ClaudeCodeResponse,\n  ClaudeCodeConfig,\n  ClaudeCodeClient,\n  safeImport,\n} from './claude-code-types';\n\ntype ClaudeCodeConstructor = new (options: { apiKey: string }) => ClaudeCodeClient;\n\nfunction isClaudeCodeConstructor(value: unknown): value is ClaudeCodeConstructor {\n  return typeof value === 'function';\n}\n\n/**\n * Error thrown when Claude Code SDK is not installed\n */\nexport class ClaudeCodeSDKNotInstalledError extends Error {\n  constructor() {\n    super(\n      'Claude Code SDK is not installed. Install with: npm install @anthropic/claude-code-sdk @modelcontextprotocol/sdk'\n    );\n    this.name = 'ClaudeCodeSDKNotInstalledError';\n  }\n}\n\n/**\n * Error thrown when Claude Code API key is not configured\n */\nexport class ClaudeCodeAPIKeyMissingError extends Error {\n  constructor() {\n    super(\n      'No API key found for Claude Code provider. Set CLAUDE_CODE_API_KEY or ANTHROPIC_API_KEY environment variable.'\n    );\n    this.name = 'ClaudeCodeAPIKeyMissingError';\n  }\n}\n\n/**\n * Claude Code check provider using the Claude Code TypeScript SDK\n * Supports MCP tools and streaming responses\n */\nexport class ClaudeCodeCheckProvider extends CheckProvider {\n  private liquidEngine: Liquid;\n  private claudeCodeClient: ClaudeCodeClient | null = null;\n\n  constructor() {\n    super();\n    this.liquidEngine = createExtendedLiquid();\n  }\n\n  getName(): string {\n    return 'claude-code';\n  }\n\n  getDescription(): string {\n    return 'AI-powered code review using Claude Code with MCP tools support';\n  }\n\n  async validateConfig(config: unknown): Promise<boolean> {\n    if (!config || typeof config !== 'object') {\n      return false;\n    }\n\n    const cfg = config as CheckProviderConfig;\n\n    // Type must be 'claude-code'\n    if (cfg.type !== 'claude-code') {\n      return false;\n    }\n\n    // Check for prompt\n    if (!cfg.prompt || typeof cfg.prompt !== 'string') {\n      return false;\n    }\n\n    // Validate Claude Code specific configuration\n    if (cfg.claude_code) {\n      const claudeCodeConfig = cfg.claude_code as ClaudeCodeConfig;\n\n      // Validate allowedTools if present\n      if (claudeCodeConfig.allowedTools && !Array.isArray(claudeCodeConfig.allowedTools)) {\n        return false;\n      }\n\n      // Validate maxTurns if present\n      if (claudeCodeConfig.maxTurns && typeof claudeCodeConfig.maxTurns !== 'number') {\n        return false;\n      }\n\n      // Validate systemPrompt if present\n      if (claudeCodeConfig.systemPrompt && typeof claudeCodeConfig.systemPrompt !== 'string') {\n        return false;\n      }\n\n      // Validate mcpServers if present\n      if (claudeCodeConfig.mcpServers) {\n        if (typeof claudeCodeConfig.mcpServers !== 'object') {\n          return false;\n        }\n\n        for (const serverConfig of Object.values(claudeCodeConfig.mcpServers)) {\n          if (!serverConfig.command || typeof serverConfig.command !== 'string') {\n            return false;\n          }\n          if (serverConfig.args && !Array.isArray(serverConfig.args)) {\n            return false;\n          }\n        }\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Initialize Claude Code SDK client\n   */\n  private async initializeClaudeCodeClient(): Promise<ClaudeCodeClient> {\n    if (this.claudeCodeClient) {\n      return this.claudeCodeClient;\n    }\n\n    // Use safe import to avoid TypeScript compilation errors\n    const claudeCodeModule = await safeImport<{\n      ClaudeCode?: unknown;\n      default?: { ClaudeCode?: unknown };\n    }>('@anthropic/claude-code-sdk');\n\n    if (!claudeCodeModule) {\n      throw new ClaudeCodeSDKNotInstalledError();\n    }\n\n    const ClaudeCodeCtor = claudeCodeModule.ClaudeCode || claudeCodeModule.default?.ClaudeCode;\n\n    if (!isClaudeCodeConstructor(ClaudeCodeCtor)) {\n      throw new Error('ClaudeCode class not found in @anthropic/claude-code-sdk');\n    }\n\n    // Initialize with API key from environment\n    const apiKey = process.env.CLAUDE_CODE_API_KEY || process.env.ANTHROPIC_API_KEY;\n    if (!apiKey) {\n      throw new ClaudeCodeAPIKeyMissingError();\n    }\n\n    try {\n      const client = new ClaudeCodeCtor({\n        apiKey,\n      }) as ClaudeCodeClient;\n\n      this.claudeCodeClient = client;\n      return client;\n    } catch (error) {\n      throw new Error(\n        `Failed to initialize Claude Code SDK: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n    }\n  }\n\n  /**\n   * Group files by their file extension for template context\n   */\n  private groupFilesByExtension(\n    files: import('../pr-analyzer').PRFile[]\n  ): Record<string, import('../pr-analyzer').PRFile[]> {\n    const grouped: Record<string, import('../pr-analyzer').PRFile[]> = {};\n\n    files.forEach(file => {\n      const parts = file.filename.split('.');\n      const ext = parts.length > 1 ? parts.pop()?.toLowerCase() || 'noext' : 'noext';\n      if (!grouped[ext]) {\n        grouped[ext] = [];\n      }\n      grouped[ext].push(file);\n    });\n\n    return grouped;\n  }\n\n  /**\n   * Process prompt configuration to resolve final prompt string\n   */\n  private async processPrompt(\n    promptConfig: string,\n    prInfo: PRInfo,\n    eventContext?: Record<string, unknown>,\n    dependencyResults?: Map<string, ReviewSummary>\n  ): Promise<string> {\n    let promptContent: string;\n\n    // Auto-detect if it's a file path or inline content\n    if (await this.isFilePath(promptConfig)) {\n      promptContent = await this.loadPromptFromFile(promptConfig);\n    } else {\n      promptContent = promptConfig;\n    }\n\n    // Process Liquid templates in the prompt\n    return await this.renderPromptTemplate(promptContent, prInfo, eventContext, dependencyResults);\n  }\n\n  /**\n   * Detect if a string is likely a file path and if the file exists\n   */\n  private async isFilePath(str: string): Promise<boolean> {\n    // Quick checks to exclude obvious non-file-path content\n    if (!str || str.trim() !== str || str.length > 512) {\n      return false;\n    }\n\n    // Exclude strings that are clearly content (contain common content indicators)\n    if (\n      /\\s{2,}/.test(str) || // Multiple consecutive spaces\n      /\\n/.test(str) || // Contains newlines\n      /^(please|analyze|review|check|find|identify|look|search)/i.test(str.trim()) || // Starts with command words\n      str.split(' ').length > 8 // Too many words for a typical file path\n    ) {\n      return false;\n    }\n\n    // For strings with path separators, be more lenient about common words\n    if (!/[\\/\\\\]/.test(str)) {\n      // Only apply strict English word filter to non-path strings\n      if (/\\b(the|and|or|but|for|with|by|from|in|on|at|as)\\b/i.test(str)) {\n        return false;\n      }\n    }\n\n    // Positive indicators for file paths\n    const hasFileExtension = /\\.[a-zA-Z0-9]{1,10}$/i.test(str);\n    const hasPathSeparators = /[\\/\\\\]/.test(str);\n    const isRelativePath = /^\\.{1,2}\\//.test(str);\n    const isAbsolutePath = path.isAbsolute(str);\n    const hasTypicalFileChars = /^[a-zA-Z0-9._\\-\\/\\\\:~]+$/.test(str);\n\n    // Must have at least one strong indicator\n    if (!(hasFileExtension || isRelativePath || isAbsolutePath || hasPathSeparators)) {\n      return false;\n    }\n\n    // Must contain only typical file path characters\n    if (!hasTypicalFileChars) {\n      return false;\n    }\n\n    // Additional validation for suspected file paths\n    try {\n      // Try to resolve and check if file exists\n      let resolvedPath: string;\n\n      if (path.isAbsolute(str)) {\n        resolvedPath = path.normalize(str);\n      } else {\n        // Resolve relative to current working directory\n        resolvedPath = path.resolve(process.cwd(), str);\n      }\n\n      // Check if file exists\n      try {\n        const stat = await fs.stat(resolvedPath);\n        return stat.isFile();\n      } catch {\n        // File doesn't exist, but might still be a valid file path format\n        return hasFileExtension && (isRelativePath || isAbsolutePath || hasPathSeparators);\n      }\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Load prompt content from file with security validation\n   */\n  private async loadPromptFromFile(promptPath: string): Promise<string> {\n    // Enforce .liquid file extension for all prompt files\n    if (!promptPath.endsWith('.liquid')) {\n      throw new Error('Prompt file must have .liquid extension');\n    }\n\n    let resolvedPath: string;\n\n    if (path.isAbsolute(promptPath)) {\n      // Absolute path - use as-is\n      resolvedPath = promptPath;\n    } else {\n      // Relative path - resolve relative to current working directory\n      resolvedPath = path.resolve(process.cwd(), promptPath);\n    }\n\n    // Security: For relative paths, ensure they don't escape the current directory\n    if (!path.isAbsolute(promptPath)) {\n      const normalizedPath = path.normalize(resolvedPath);\n      const currentDir = path.resolve(process.cwd());\n      if (!normalizedPath.startsWith(currentDir)) {\n        throw new Error('Invalid prompt file path: path traversal detected');\n      }\n    }\n\n    // Security: Check for obvious path traversal patterns\n    if (promptPath.includes('../..')) {\n      throw new Error('Invalid prompt file path: path traversal detected');\n    }\n\n    try {\n      const promptContent = await fs.readFile(resolvedPath, 'utf-8');\n      return promptContent;\n    } catch (error) {\n      throw new Error(\n        `Failed to load prompt from ${resolvedPath}: ${\n          error instanceof Error ? error.message : 'Unknown error'\n        }`\n      );\n    }\n  }\n\n  /**\n   * Render Liquid template in prompt with comprehensive context\n   */\n  private async renderPromptTemplate(\n    promptContent: string,\n    prInfo: PRInfo,\n    eventContext?: Record<string, unknown>,\n    dependencyResults?: Map<string, ReviewSummary>\n  ): Promise<string> {\n    // Create comprehensive template context with PR and event information\n    const templateContext = {\n      // PR Information\n      pr: {\n        number: prInfo.number,\n        title: prInfo.title,\n        body: prInfo.body,\n        author: prInfo.author,\n        baseBranch: prInfo.base,\n        headBranch: prInfo.head,\n        isIncremental: prInfo.isIncremental,\n        filesChanged: prInfo.files?.map(f => f.filename) || [],\n        totalAdditions: prInfo.files?.reduce((sum, f) => sum + f.additions, 0) || 0,\n        totalDeletions: prInfo.files?.reduce((sum, f) => sum + f.deletions, 0) || 0,\n        totalChanges: prInfo.files?.reduce((sum, f) => sum + f.changes, 0) || 0,\n        base: prInfo.base,\n        head: prInfo.head,\n      },\n\n      // File Details\n      files: prInfo.files || [],\n      description: prInfo.body || '',\n\n      // GitHub Event Context\n      event: eventContext\n        ? {\n            name: eventContext.event_name || 'unknown',\n            action: eventContext.action,\n            isPullRequest: !prInfo.isIssue,\n\n            // Repository Info\n            repository: eventContext.repository\n              ? {\n                  owner: (eventContext.repository as { owner?: { login?: string } })?.owner?.login,\n                  name: (eventContext.repository as { name?: string })?.name,\n                  fullName: eventContext.repository\n                    ? `${(eventContext.repository as { owner?: { login?: string } })?.owner?.login}/${(eventContext.repository as { name?: string })?.name}`\n                    : undefined,\n                }\n              : undefined,\n\n            // Comment Data (for comment events)\n            comment: eventContext.comment\n              ? {\n                  body: (eventContext.comment as { body?: string })?.body,\n                  author: (eventContext.comment as { user?: { login?: string } })?.user?.login,\n                }\n              : undefined,\n\n            // Raw event payload for advanced use cases\n            payload: eventContext,\n          }\n        : undefined,\n\n      // Utility data for templates\n      utils: {\n        // Date/time helpers\n        now: new Date().toISOString(),\n        today: new Date().toISOString().split('T')[0],\n\n        // Dynamic file grouping by extension\n        filesByExtension: this.groupFilesByExtension(prInfo.files || []),\n\n        // File status categorizations\n        addedFiles: (prInfo.files || []).filter(f => f.status === 'added'),\n        modifiedFiles: (prInfo.files || []).filter(f => f.status === 'modified'),\n        removedFiles: (prInfo.files || []).filter(f => f.status === 'removed'),\n        renamedFiles: (prInfo.files || []).filter(f => f.status === 'renamed'),\n\n        // Change analysis\n        hasLargeChanges: (prInfo.files || []).some(f => f.changes > 50),\n        totalFiles: (prInfo.files || []).length,\n      },\n\n      // Previous check outputs (dependency results)\n      // Expose raw output directly if available, otherwise expose the result as-is\n      outputs: dependencyResults\n        ? Object.fromEntries(\n            Array.from(dependencyResults.entries()).map(([checkName, result]) => [\n              checkName,\n              // If the result has a direct output field, use it directly\n              // Otherwise, expose the entire result\n              (() => {\n                const summary = result as ReviewSummary & { output?: unknown };\n                return summary.output !== undefined ? summary.output : summary;\n              })(),\n            ])\n          )\n        : {},\n    };\n\n    try {\n      return await this.liquidEngine.parseAndRender(promptContent, templateContext);\n    } catch (error) {\n      throw new Error(\n        `Failed to render prompt template: ${\n          error instanceof Error ? error.message : 'Unknown error'\n        }`\n      );\n    }\n  }\n\n  /**\n   * Parse structured response from Claude Code\n   */\n  private parseStructuredResponse(content: string): ReviewSummary {\n    try {\n      // Try to parse as JSON first\n      const parsed = JSON.parse(content);\n\n      // Convert to ReviewSummary format\n      return {\n        issues: parsed.issues || [],\n      };\n    } catch {\n      // If not JSON, treat as plain text comment\n      return {\n        issues: [],\n      };\n    }\n  }\n\n  async execute(\n    prInfo: PRInfo,\n    config: CheckProviderConfig,\n    dependencyResults?: Map<string, ReviewSummary>,\n    sessionInfo?: { parentSessionId?: string; reuseSession?: boolean }\n  ): Promise<ReviewSummary> {\n    // Apply environment configuration if present\n    if (config.env) {\n      const result = EnvironmentResolver.withTemporaryEnv(config.env, () => {\n        return this.executeWithConfig(prInfo, config, dependencyResults, sessionInfo);\n      });\n\n      if (result instanceof Promise) {\n        return result;\n      }\n      return result;\n    }\n\n    return this.executeWithConfig(prInfo, config, dependencyResults, sessionInfo);\n  }\n\n  private async executeWithConfig(\n    prInfo: PRInfo,\n    config: CheckProviderConfig,\n    dependencyResults?: Map<string, ReviewSummary>,\n    sessionInfo?: { parentSessionId?: string; reuseSession?: boolean }\n  ): Promise<ReviewSummary> {\n    // Test hook: allow short-circuiting provider with mock output (YAML tests)\n    try {\n      const stepName = (config as any).checkName || 'claude-code';\n      const mock = (sessionInfo as any)?.hooks?.mockForStep?.(String(stepName));\n      if (mock !== undefined) {\n        if (mock && typeof mock === 'object' && 'issues' in (mock as any)) {\n          return mock as unknown as ReviewSummary;\n        }\n        return { issues: [], output: mock as unknown } as ReviewSummary & { output: unknown };\n      }\n    } catch {}\n    // Extract Claude Code configuration\n    const claudeCodeConfig = (config.claude_code as ClaudeCodeConfig) || {};\n\n    // Get custom prompt from config - REQUIRED\n    const customPrompt = config.prompt;\n    if (!customPrompt) {\n      throw new Error(\n        `No prompt defined for check. All checks must have prompts defined in .visor.yaml configuration.`\n      );\n    }\n\n    // Process prompt with Liquid templates and file loading\n    const processedPrompt = await this.processPrompt(\n      customPrompt,\n      prInfo,\n      config.eventContext,\n      dependencyResults\n    );\n\n    const startTime = Date.now();\n\n    try {\n      // Initialize Claude Code client\n      const client = await this.initializeClaudeCodeClient();\n\n      // Prepare query object with MCP servers passed directly to SDK\n      const query: ClaudeCodeQuery = {\n        query: processedPrompt,\n        maxTurns: claudeCodeConfig.maxTurns || 5,\n        systemPrompt: claudeCodeConfig.systemPrompt,\n        subagent: claudeCodeConfig.subagent,\n      };\n\n      // Add allowed tools if specified\n      if (claudeCodeConfig.allowedTools && claudeCodeConfig.allowedTools.length > 0) {\n        query.tools = claudeCodeConfig.allowedTools.map(name => ({ name }));\n      }\n\n      // Pass MCP servers directly to the SDK - let it handle spawning and tool discovery\n      if (claudeCodeConfig.mcpServers && Object.keys(claudeCodeConfig.mcpServers).length > 0) {\n        // Policy engine: filter MCP servers whose allowed methods are all denied\n        const policyEngine = (sessionInfo as any)?._parentContext?.policyEngine;\n        let filteredServers = claudeCodeConfig.mcpServers;\n        if (policyEngine) {\n          const allowed: Record<string, any> = {};\n          for (const [name, serverCfg] of Object.entries(claudeCodeConfig.mcpServers)) {\n            try {\n              const decision = await policyEngine.evaluateToolInvocation(\n                name,\n                '*',\n                (serverCfg as any).transport\n              );\n              if (decision.allowed) {\n                allowed[name] = serverCfg;\n              }\n            } catch (err) {\n              // Policy evaluation failed â€” continue without filtering this server\n              allowed[name] = serverCfg;\n              try {\n                const { logger } = require('../logger');\n                logger.warn(\n                  `[PolicyEngine] Tool invocation evaluation failed for server '${name}': ${err instanceof Error ? err.message : err}`\n                );\n              } catch {}\n            }\n          }\n          filteredServers = allowed;\n        }\n        if (Object.keys(filteredServers).length > 0) {\n          (query as any).mcpServers = filteredServers;\n        }\n      }\n\n      // Execute query with Claude Code\n      let response: ClaudeCodeResponse;\n\n      if (sessionInfo?.reuseSession && sessionInfo.parentSessionId) {\n        // Use session reuse if available\n        response = await client.query({\n          ...query,\n          sessionId: sessionInfo.parentSessionId,\n        });\n      } else {\n        // Create new session\n        response = await client.query(query);\n      }\n\n      // Parse the response\n      const result = this.parseStructuredResponse(response.content) as ReviewSummary & {\n        debug?: import('../ai-review-service').AIDebugInfo & {\n          sessionId?: string;\n          turnCount?: number;\n          usage?: unknown;\n          toolsUsed?: string[];\n        };\n      };\n\n      result.debug = {\n        prompt: processedPrompt,\n        rawResponse: response.content,\n        provider: 'claude-code',\n        model: 'claude-code',\n        apiKeySource: 'CLAUDE_CODE_API_KEY',\n        processingTime: Date.now() - startTime,\n        promptLength: processedPrompt.length,\n        responseLength: response.content.length,\n        jsonParseSuccess: true,\n        errors: [],\n        checksExecuted: [config.checkName || 'claude-code-check'],\n        parallelExecution: false,\n        timestamp: new Date().toISOString(),\n        // Claude Code specific debug info\n        sessionId: response.session_id,\n        turnCount: response.turn_count,\n        usage: response.usage,\n      };\n\n      // Apply issue suppression filtering\n      const suppressionEnabled = config.suppressionEnabled !== false;\n      const issueFilter = new IssueFilter(suppressionEnabled);\n      const filteredIssues = issueFilter.filterIssues(result.issues || [], process.cwd());\n\n      return {\n        ...result,\n        issues: filteredIssues,\n      };\n    } catch (error) {\n      // Re-throw setup/configuration errors that should terminate the application\n      if (\n        error instanceof ClaudeCodeSDKNotInstalledError ||\n        error instanceof ClaudeCodeAPIKeyMissingError\n      ) {\n        throw error;\n      }\n\n      const errorMessage = error instanceof Error ? error.message : String(error);\n\n      // Log detailed error information\n      console.error(`âŒ Claude Code Check Provider Error: ${errorMessage}`);\n\n      // Check if this is a critical error\n      const isCriticalError =\n        errorMessage.includes('API rate limit') ||\n        errorMessage.includes('403') ||\n        errorMessage.includes('401') ||\n        errorMessage.includes('authentication');\n\n      if (isCriticalError) {\n        console.error(\n          `ðŸš¨ CRITICAL ERROR: Claude Code provider authentication or setup issue detected`\n        );\n        console.error(\n          `ðŸš¨ This check cannot proceed without valid API credentials and SDK installation`\n        );\n      }\n\n      // Re-throw with more context\n      throw new Error(`Claude Code analysis failed: ${errorMessage}`);\n    }\n  }\n\n  getSupportedConfigKeys(): string[] {\n    return [\n      'type',\n      'prompt',\n      'claude_code.allowedTools',\n      'claude_code.maxTurns',\n      'claude_code.systemPrompt',\n      'claude_code.mcpServers',\n      'claude_code.subagent',\n      'claude_code.hooks',\n      'env',\n      'checkName',\n      'sessionId',\n      'suppressionEnabled',\n    ];\n  }\n\n  async isAvailable(): Promise<boolean> {\n    try {\n      // Check if Claude Code API key is available\n      const hasApiKey = !!(process.env.CLAUDE_CODE_API_KEY || process.env.ANTHROPIC_API_KEY);\n\n      if (!hasApiKey) {\n        return false;\n      }\n\n      // Try to import the SDK to check if it's installed\n      const claudeCodeModule = await safeImport<{\n        ClaudeCode?: unknown;\n        default?: { ClaudeCode?: unknown };\n      }>('@anthropic/claude-code-sdk');\n      if (!claudeCodeModule) {\n        return false;\n      }\n      const ClaudeCode = claudeCodeModule.ClaudeCode || claudeCodeModule.default?.ClaudeCode;\n\n      return !!ClaudeCode;\n    } catch {\n      // If import fails, the SDK is not installed\n      return false;\n    }\n  }\n\n  getRequirements(): string[] {\n    return [\n      'CLAUDE_CODE_API_KEY or ANTHROPIC_API_KEY environment variable',\n      '@anthropic/claude-code-sdk npm package',\n      '@modelcontextprotocol/sdk npm package (for MCP support)',\n      'Network access to Claude Code API',\n    ];\n  }\n}\n","export type EnvMap = Record<string, string>;\n\n// Default: expose all env vars except a conservative denylist.\n// If VISOR_ALLOW_ENV is set and not '*', restrict to that allowlist.\n// VISOR_DENY_ENV can further mask exact keys or prefix* patterns.\nexport function buildSandboxEnv(input: NodeJS.ProcessEnv): EnvMap {\n  const denyDefaults = [\n    'GITHUB_TOKEN',\n    'INPUT_GITHUB-TOKEN',\n    'ACTIONS_RUNTIME_TOKEN',\n    'ACTIONS_ID_TOKEN_REQUEST_TOKEN',\n    'AWS_ACCESS_KEY_ID',\n    'AWS_SECRET_ACCESS_KEY',\n    'AWS_SESSION_TOKEN',\n    'AZURE_CLIENT_SECRET',\n    'GOOGLE_APPLICATION_CREDENTIALS',\n    'OPENAI_API_KEY',\n    'ANTHROPIC_API_KEY',\n    'HUGGINGFACE_API_KEY',\n    'CLAUDE_CODE_API_KEY',\n    'PROBE_API_KEY',\n  ];\n\n  const denyExtra = (input.VISOR_DENY_ENV || '')\n    .split(',')\n    .map(s => s.trim())\n    .filter(Boolean);\n  const deny = Array.from(new Set([...denyDefaults, ...denyExtra]));\n  const allowSpec = (input.VISOR_ALLOW_ENV || '*').trim();\n\n  const denyMatch = (key: string): boolean => {\n    for (const pat of deny) {\n      if (!pat) continue;\n      if (pat.endsWith('*')) {\n        const prefix = pat.slice(0, -1);\n        if (key.startsWith(prefix)) return true;\n      } else if (key === pat) {\n        return true;\n      }\n    }\n    if (/(_TOKEN|_SECRET|_PASSWORD|_PRIVATE_KEY)$/i.test(key)) return true;\n    return false;\n  };\n\n  const out: EnvMap = {};\n  if (allowSpec !== '*') {\n    const allow = allowSpec\n      .split(',')\n      .map(s => s.trim())\n      .filter(Boolean);\n    for (const key of allow) {\n      const val = input[key];\n      if (key && val !== undefined && !denyMatch(key)) out[key] = String(val);\n    }\n    return out;\n  }\n\n  for (const [k, v] of Object.entries(input)) {\n    if (v === undefined || v === null) continue;\n    if (denyMatch(k)) continue;\n    out[k] = String(v);\n  }\n  return out;\n}\n","import { CheckProvider, CheckProviderConfig } from './check-provider.interface';\nimport { PRInfo } from '../pr-analyzer';\nimport { ReviewSummary, ReviewIssue } from '../reviewer';\n// eslint-disable-next-line no-restricted-imports -- needed for Liquid type\nimport { Liquid } from 'liquidjs';\nimport Sandbox from '@nyariv/sandboxjs';\nimport { createSecureSandbox, compileAndRun } from '../utils/sandbox';\nimport { createExtendedLiquid } from '../liquid-extensions';\nimport { logger } from '../logger';\nimport { commandExecutor } from '../utils/command-executor';\nimport {\n  createPermissionHelpers,\n  detectLocalMode,\n  resolveAssociationFromEvent,\n} from '../utils/author-permissions';\nimport { trace, context as otContext } from '../telemetry/lazy-otel';\nimport {\n  captureCheckInputContext,\n  captureCheckOutput,\n  captureTransformJS,\n  sanitizeContextForTelemetry,\n} from '../telemetry/state-capture';\n\n/**\n * Check provider that executes shell commands and captures their output\n * Supports JSON parsing and integration with forEach functionality\n */\nexport class CommandCheckProvider extends CheckProvider {\n  private liquid: Liquid;\n  private sandbox?: Sandbox;\n\n  constructor() {\n    super();\n    this.liquid = createExtendedLiquid({\n      cache: false,\n      strictFilters: false,\n      strictVariables: false,\n    });\n    // Lazily create sandbox only when transform_js is used\n  }\n\n  private createSecureSandbox(): Sandbox {\n    return createSecureSandbox();\n  }\n\n  getName(): string {\n    return 'command';\n  }\n\n  getDescription(): string {\n    return 'Execute shell commands and capture output for processing';\n  }\n\n  async validateConfig(config: unknown): Promise<boolean> {\n    if (!config || typeof config !== 'object') {\n      return false;\n    }\n\n    const cfg = config as CheckProviderConfig;\n\n    // Must have exec specified\n    if (!cfg.exec || typeof cfg.exec !== 'string') {\n      return false;\n    }\n\n    return true;\n  }\n\n  async execute(\n    prInfo: PRInfo,\n    config: CheckProviderConfig,\n    dependencyResults?: Map<string, ReviewSummary>,\n    context?: import('./check-provider.interface').ExecutionContext\n  ): Promise<ReviewSummary> {\n    try {\n      logger.info(\n        `  command provider: executing check=${String((config as any).checkName || config.type)} hasTransformJs=${Boolean(\n          (config as any).transform_js\n        )}`\n      );\n    } catch {}\n    const command = config.exec as string;\n    const transform = config.transform as string | undefined;\n    const transformJs = config.transform_js as string | undefined;\n\n    // Prepare template context for Liquid rendering\n    const outputsObj = this.buildOutputContext(\n      dependencyResults,\n      config.__outputHistory as Map<string, unknown[]> | undefined\n    );\n\n    // Build outputs_raw from -raw keys in dependencyResults\n    const outputsRaw: Record<string, unknown> = {};\n    if (dependencyResults) {\n      for (const [key, value] of dependencyResults.entries()) {\n        if (typeof key !== 'string') continue;\n        if (key.endsWith('-raw')) {\n          const name = key.slice(0, -4);\n          const summary = value as ReviewSummary & { output?: unknown };\n          outputsRaw[name] = summary.output !== undefined ? summary.output : summary;\n        }\n      }\n    }\n\n    const templateContext = {\n      pr: {\n        number: prInfo.number,\n        title: prInfo.title,\n        author: prInfo.author,\n        branch: prInfo.head,\n        base: prInfo.base,\n      },\n      files: prInfo.files,\n      fileCount: prInfo.files.length,\n      outputs: outputsObj,\n      // Alias: outputs_history mirrors outputs.history for consistency\n      outputs_history: (outputsObj as any).history || {},\n      // Stage-scoped history slice based on baseline provided by runner\n      outputs_history_stage: (() => {\n        const stage: Record<string, unknown[]> = {};\n        try {\n          const base = (context as any)?.stageHistoryBase as Record<string, number> | undefined;\n          const histMap = (config as any).__outputHistory as Map<string, unknown[]> | undefined;\n          if (!base || !histMap) return stage;\n          for (const [k, v] of histMap.entries()) {\n            const start = base[k] || 0;\n            const arr = Array.isArray(v) ? (v as unknown[]) : [];\n            stage[k] = arr.slice(start);\n          }\n        } catch {}\n        return stage;\n      })(),\n      // New: outputs_raw exposes aggregate values (e.g., full arrays for forEach parents)\n      outputs_raw: outputsRaw,\n      // Workflow inputs (when executing within a workflow)\n      // Check config first (set by projectWorkflowToGraph), then fall back to context\n      inputs: (config as any).workflowInputs || context?.workflowInputs || {},\n      // Custom arguments from on_init 'with' directive\n      args: context?.args || {},\n      env: this.getSafeEnvironmentVariables(),\n    };\n\n    logger.debug(\n      `ðŸ”§ Debug: Template outputs keys: ${Object.keys(templateContext.outputs || {}).join(', ')}`\n    );\n\n    // Capture input context in active OTEL span\n    try {\n      const span = trace.getSpan(otContext.active());\n      if (span) {\n        captureCheckInputContext(span, templateContext);\n      }\n    } catch {\n      // Ignore telemetry errors\n    }\n    // Fallback NDJSON for input context (non-OTEL environments)\n    try {\n      const checkId = (config as any).checkName || (config as any).id || 'unknown';\n      // Sanitize context to avoid leaking API keys in traces\n      const ctxJson = JSON.stringify(sanitizeContextForTelemetry(templateContext));\n      const { emitNdjsonSpanWithEvents } = require('../telemetry/fallback-ndjson');\n      // Emit both start and completion markers together for deterministic E2E assertions\n      emitNdjsonSpanWithEvents(\n        'visor.check',\n        { 'visor.check.id': checkId, 'visor.check.input.context': ctxJson },\n        [{ name: 'check.started' }, { name: 'check.completed' }]\n      );\n    } catch {}\n\n    // Test hook: mock output for this step (short-circuit execution)\n    try {\n      const stepName = (config as any).checkName || 'unknown';\n      if (process.env.VISOR_DEBUG === 'true') {\n        logger.debug(\n          `[Command] Mock check: stepName=${stepName}, context=${!!context}, hooks=${!!context?.hooks}, mockForStep=${!!context?.hooks?.mockForStep}`\n        );\n      }\n      const rawMock = context?.hooks?.mockForStep?.(String(stepName));\n      if (process.env.VISOR_DEBUG === 'true') {\n        logger.debug(\n          `[Command] Mock result: ${rawMock !== undefined ? 'found' : 'not found'}, value=${JSON.stringify(rawMock)?.slice(0, 200)}`\n        );\n      }\n      if (rawMock !== undefined) {\n        // Normalize primitive mocks into object form\n        let mock: any;\n        if (typeof rawMock === 'number') {\n          mock = { exit_code: Number(rawMock) };\n        } else if (typeof rawMock === 'string') {\n          mock = { stdout: String(rawMock) };\n        } else {\n          mock = rawMock as Record<string, unknown>;\n        }\n        const m = mock as { stdout?: string; stderr?: string; exit_code?: number; exit?: number };\n\n        // Check if this looks like a command mock (has stdout/stderr/exit_code) or direct data output\n        const isCommandMock =\n          m.stdout !== undefined ||\n          m.stderr !== undefined ||\n          m.exit_code !== undefined ||\n          m.exit !== undefined;\n\n        let out: unknown;\n        if (isCommandMock) {\n          // Traditional command mock format: { stdout: \"...\", exit_code: 0 }\n          out = m.stdout ?? '';\n          try {\n            if (\n              typeof out === 'string' &&\n              (out.trim().startsWith('{') || out.trim().startsWith('['))\n            ) {\n              out = JSON.parse(out);\n            }\n          } catch {}\n        } else {\n          // Direct data mock format: { data: [...], count: 1 } - use as-is\n          out = mock;\n        }\n\n        const code = isCommandMock\n          ? typeof m.exit_code === 'number'\n            ? m.exit_code\n            : typeof m.exit === 'number'\n              ? m.exit\n              : 0\n          : 0;\n        // For fail_if consistency, merge exit_code into the output if it's an object\n        // This allows both `output.exit_code !== 0` and `output.failed > 0` patterns to work\n        let outputWithMeta: unknown;\n        if (isCommandMock) {\n          if (out && typeof out === 'object' && !Array.isArray(out)) {\n            // Merge exit_code into the parsed object (without overwriting existing fields)\n            outputWithMeta = { ...(out as object), exit_code: code };\n          } else {\n            // For non-object outputs (string, array), wrap in a structure\n            outputWithMeta = { value: out, exit_code: code };\n          }\n        } else {\n          outputWithMeta = out;\n        }\n        if (code !== 0) {\n          return {\n            issues: [\n              {\n                file: 'command',\n                line: 0,\n                ruleId: 'command/execution_error',\n                message: `Mocked command exited with code ${code}`,\n                severity: 'error',\n                category: 'logic',\n              },\n            ],\n            output: outputWithMeta,\n          } as any;\n        }\n        return { issues: [], output: outputWithMeta } as any;\n      }\n    } catch {}\n\n    try {\n      // Render the command with Liquid templates if needed\n      let renderedCommand = command;\n      if (command.includes('{{') || command.includes('{%')) {\n        renderedCommand = await this.renderCommandTemplate(command, templateContext);\n      }\n      logger.debug(`ðŸ”§ Debug: Rendered command: ${renderedCommand}`);\n\n      // Prepare environment variables - convert all to strings\n      const scriptEnv: Record<string, string> = {};\n      for (const [key, value] of Object.entries(process.env)) {\n        if (value !== undefined) {\n          scriptEnv[key] = value;\n        }\n      }\n      if (config.env) {\n        for (const [key, value] of Object.entries(config.env)) {\n          if (value !== undefined && value !== null) {\n            scriptEnv[key] = String(value);\n          }\n        }\n      }\n\n      // Get timeout from config (in milliseconds) or use default (60 seconds = 60000ms)\n      const timeoutMs = (config.timeout as number) || 60000;\n\n      // Commands are executed via child_process.exec() which passes them through\n      // /bin/sh -c, so multiline scripts (e.g. node -e '...') work correctly as-is.\n      // The shell preserves newlines inside quoted arguments.\n      const safeCommand = renderedCommand;\n\n      // Determine working directory - use workspace if enabled, otherwise default\n      const parentContext = (context as any)?._parentContext;\n      const workingDirectory = parentContext?.workingDirectory;\n      const workspaceEnabled = parentContext?.workspace?.isEnabled?.();\n      const cwd = workspaceEnabled && workingDirectory ? workingDirectory : undefined;\n\n      if (cwd) {\n        logger.debug(`[command] Using workspace working directory: ${cwd}`);\n      }\n\n      // Use shared command executor\n      const execResult = await commandExecutor.execute(safeCommand, {\n        env: scriptEnv,\n        timeout: timeoutMs,\n        cwd,\n      });\n\n      const { stdout, stderr, exitCode } = execResult;\n\n      if (stderr) {\n        logger.debug(`Command stderr: ${stderr}`);\n      }\n\n      // Check for non-zero exit code\n      if (exitCode !== 0) {\n        const errorMessage = stderr || `Command exited with code ${exitCode}`;\n        logger.error(`Command failed with exit code ${exitCode}: ${errorMessage}`);\n\n        // Build error output so workflow tools can propagate errors to AI\n        const errorOutput = {\n          error: true,\n          exit_code: exitCode,\n          message: errorMessage,\n          // Include stdout if present - may contain partial results or error details\n          ...(stdout.trim() ? { stdout: stdout.trim() } : {}),\n          // Include a text field for AI tool compatibility\n          text: `Command failed with exit code ${exitCode}: ${errorMessage}`,\n        };\n\n        // Capture error output in telemetry so traces show what happened\n        try {\n          const span = trace.getSpan(otContext.active());\n          if (span) {\n            captureCheckOutput(span, errorOutput);\n          }\n        } catch {\n          // Ignore telemetry errors\n        }\n\n        return {\n          issues: [\n            {\n              file: 'command',\n              line: 0,\n              ruleId: 'command/execution_error',\n              message: `Command execution failed: ${errorMessage}`,\n              severity: 'error',\n              category: 'logic',\n            },\n          ],\n          output: errorOutput,\n        } as ReviewSummary & { output: unknown };\n      }\n\n      // Keep raw output for transforms\n      const rawOutput = stdout.trim();\n\n      // Try to parse output as JSON for default behavior\n      // no debug\n      let output: unknown = rawOutput;\n      try {\n        // Attempt to parse as JSON\n        const parsed = JSON.parse(rawOutput);\n        output = parsed;\n        logger.debug(`ðŸ”§ Debug: Parsed entire output as JSON successfully`);\n      } catch {\n        // Try to extract JSON from the end of output (for commands with debug logs)\n        const extractedTail = this.extractJsonFromEnd(rawOutput);\n        if (extractedTail) {\n          try {\n            output = JSON.parse(extractedTail);\n          } catch {\n            output = rawOutput;\n          }\n        } else {\n          // Try to extract any balanced JSON substring anywhere\n          const extractedAny = this.extractJsonAnywhere(rawOutput);\n          if (extractedAny) {\n            try {\n              output = JSON.parse(extractedAny);\n            } catch {\n              output = rawOutput;\n            }\n          } else {\n            // Last resort: detect common boolean flags like error:true or error=false for fail_if gating\n            const m = /\\berror\\b\\s*[:=]\\s*(true|false)/i.exec(rawOutput);\n            if (m) {\n              output = { error: m[1].toLowerCase() === 'true' } as any;\n            } else {\n              output = rawOutput;\n            }\n          }\n        }\n      }\n\n      // Log the parsed structure for debugging\n      // no debug\n\n      // Apply transform if specified (Liquid or JavaScript)\n      let finalOutput = output;\n\n      // First apply Liquid transform if present\n      if (transform) {\n        try {\n          const transformContext = {\n            ...templateContext,\n            output: output, // Use parsed output for Liquid (object if JSON, string otherwise)\n          };\n          const rendered = await this.liquid.parseAndRender(transform, transformContext);\n\n          // Try to parse the transformed result as JSON\n          try {\n            finalOutput = JSON.parse(rendered.trim());\n            logger.verbose(`âœ“ Applied Liquid transform successfully (parsed as JSON)`);\n          } catch {\n            finalOutput = rendered.trim();\n            logger.verbose(`âœ“ Applied Liquid transform successfully (string output)`);\n          }\n\n          // Capture Liquid transform in telemetry\n          try {\n            const span = trace.getSpan(otContext.active());\n            if (span) {\n              const { captureLiquidEvaluation } = require('../telemetry/state-capture');\n              captureLiquidEvaluation(span, transform, transformContext, rendered);\n            }\n          } catch {\n            // Ignore telemetry errors\n          }\n        } catch (error) {\n          logger.error(\n            `âœ— Failed to apply Liquid transform: ${error instanceof Error ? error.message : 'Unknown error'}`\n          );\n          return {\n            issues: [\n              {\n                file: 'command',\n                line: 0,\n                ruleId: 'command/transform_error',\n                message: `Failed to apply Liquid transform: ${error instanceof Error ? error.message : 'Unknown error'}`,\n                severity: 'error',\n                category: 'logic',\n              },\n            ],\n          };\n        }\n      }\n\n      // Then apply JavaScript transform if present\n      if (transformJs) {\n        try {\n          // For transform_js, provide a JSON-smart wrapper that:\n          //  - behaves like a string when coerced (so JSON.parse(output) still works)\n          //  - exposes parsed JSON properties if stdout is valid JSON (so output.key works)\n          const jsContext = {\n            output: this.makeJsonSmart(rawOutput),\n            pr: templateContext.pr,\n            files: templateContext.files,\n            outputs: this.makeOutputsJsonSmart(templateContext.outputs),\n            inputs: templateContext.inputs || {},\n            env: templateContext.env,\n            permissions: createPermissionHelpers(\n              resolveAssociationFromEvent((prInfo as any).eventContext, prInfo.authorAssociation),\n              detectLocalMode()\n            ),\n          };\n\n          // Compile and execute the JavaScript expression\n          // Use direct property access instead of destructuring to avoid syntax issues\n          const trimmedTransform = transformJs.trim();\n          // Build a safe function body that supports statements + implicit last-expression return.\n          const buildBodyWithReturn = (raw: string): string => {\n            const t = raw.trim();\n            // Find last non-empty line\n            const lines = t.split(/\\n/);\n            let i = lines.length - 1;\n            while (i >= 0 && lines[i].trim().length === 0) i--;\n            if (i < 0) return 'return undefined;';\n            const lastLine = lines[i].trim();\n            if (/^return\\b/i.test(lastLine)) {\n              return t;\n            }\n            const idx = t.lastIndexOf(lastLine);\n            const head = idx >= 0 ? t.slice(0, idx) : '';\n            const lastExpr = lastLine.replace(/;\\s*$/, '');\n            return `${head}\\nreturn (${lastExpr});`;\n          };\n          const bodyWithReturn = buildBodyWithReturn(trimmedTransform);\n\n          const code = `\n            const output = scope.output;\n            const pr = scope.pr;\n            const files = scope.files;\n            const outputs = scope.outputs;\n            const inputs = scope.inputs;\n            const env = scope.env;\n            const log = (...args) => { console.log('ðŸ” Debug:', ...args); };\n            const hasMinPermission = scope.permissions.hasMinPermission;\n            const isOwner = scope.permissions.isOwner;\n            const isMember = scope.permissions.isMember;\n            const isCollaborator = scope.permissions.isCollaborator;\n            const isContributor = scope.permissions.isContributor;\n            const isFirstTimer = scope.permissions.isFirstTimer;\n            const __result = (function(){\n${bodyWithReturn}\n            })();\n            return __result;\n          `;\n\n          // Execute user code exclusively inside the sandbox\n          if (!this.sandbox) {\n            this.sandbox = this.createSecureSandbox();\n          }\n          // Try to serialize result to JSON string inside sandbox to preserve primitives like booleans\n          let parsedFromSandboxJson: any = undefined;\n          try {\n            const stringifyCode = `\n              const output = scope.output;\n              const pr = scope.pr;\n              const files = scope.files;\n              const outputs = scope.outputs;\n              const env = scope.env;\n              const log = (...args) => { console.log('ðŸ” Debug:', ...args); };\n              const hasMinPermission = scope.permissions.hasMinPermission;\n              const isOwner = scope.permissions.isOwner;\n              const isMember = scope.permissions.isMember;\n              const isCollaborator = scope.permissions.isCollaborator;\n              const isContributor = scope.permissions.isContributor;\n              const isFirstTimer = scope.permissions.isFirstTimer;\n              const __ret = (function(){\n${bodyWithReturn}\n              })();\n              return typeof __ret === 'object' && __ret !== null ? JSON.stringify(__ret) : null;\n            `;\n            const stringifyExec = this.sandbox.compile(stringifyCode);\n            const jsonStr = stringifyExec({ scope: jsContext }).run();\n            if (typeof jsonStr === 'string' && jsonStr.trim().startsWith('{')) {\n              parsedFromSandboxJson = JSON.parse(jsonStr);\n            }\n          } catch {}\n\n          if (parsedFromSandboxJson !== undefined) {\n            finalOutput = parsedFromSandboxJson;\n          } else {\n            finalOutput = compileAndRun<unknown>(\n              this.sandbox,\n              code,\n              { scope: jsContext },\n              { injectLog: false, wrapFunction: false }\n            );\n          }\n\n          // Create a plain JSON snapshot of the transform result to avoid proxy/getter surprises\n          // Prefer JSON stringify inside the sandbox realm (so it knows how to serialize its own objects),\n          // then fall back to host-side JSON clone and finally to a shallow copy of own enumerable properties.\n          let finalSnapshot: Record<string, unknown> | null = null;\n          try {\n            if (finalOutput && typeof finalOutput === 'object' && !Array.isArray(finalOutput)) {\n              // Try realm-local stringify first\n              try {\n                const stringifyExec = this.sandbox!.compile('return JSON.stringify(scope.obj);');\n                const jsonStr = stringifyExec({ obj: finalOutput }).run();\n                if (typeof jsonStr === 'string' && jsonStr.trim().startsWith('{')) {\n                  finalSnapshot = JSON.parse(jsonStr);\n                }\n              } catch {}\n              if (!finalSnapshot) {\n                try {\n                  finalSnapshot = JSON.parse(JSON.stringify(finalOutput));\n                } catch {}\n              }\n              if (!finalSnapshot) {\n                const tmp: Record<string, unknown> = {};\n                for (const k of Object.keys(finalOutput as Record<string, unknown>)) {\n                  (tmp as any)[k] = (finalOutput as any)[k];\n                }\n                finalSnapshot = tmp;\n              }\n            }\n          } catch {}\n          // @ts-ignore store for later extraction path\n          (this as any).__lastTransformSnapshot = finalSnapshot;\n          try {\n            const isObj =\n              finalOutput && typeof finalOutput === 'object' && !Array.isArray(finalOutput);\n            const keys = isObj\n              ? Object.keys(finalOutput as Record<string, unknown>).join(',')\n              : typeof finalOutput;\n            logger.debug(\n              `  transform_js: output typeof=${Array.isArray(finalOutput) ? 'array' : typeof finalOutput} keys=${keys}`\n            );\n            if (isObj && (finalOutput as any).issues) {\n              const mi: any = (finalOutput as any).issues;\n              logger.debug(\n                `  transform_js: issues typeof=${Array.isArray(mi) ? 'array' : typeof mi} len=${(mi && mi.length) || 0}`\n              );\n            }\n            try {\n              if (isObj)\n                logger.debug(`  transform_js: error value=${String((finalOutput as any).error)}`);\n            } catch {}\n          } catch {}\n\n          logger.verbose(`âœ“ Applied JavaScript transform successfully`);\n          // Already normalized in sandbox result\n          // no debug\n        } catch (error) {\n          logger.error(\n            `âœ— Failed to apply JavaScript transform: ${error instanceof Error ? error.message : 'Unknown error'}`\n          );\n          return {\n            issues: [\n              {\n                file: 'command',\n                line: 0,\n                ruleId: 'command/transform_js_error',\n                message: `Failed to apply JavaScript transform: ${error instanceof Error ? error.message : 'Unknown error'}`,\n                severity: 'error',\n                category: 'logic',\n              },\n            ],\n          };\n        }\n      }\n\n      // Extract structured issues when the command returns them (skip for forEach parents)\n      // no debug\n      let issues: ReviewIssue[] = [];\n      let outputForDependents: unknown = finalOutput;\n      // Capture a shallow snapshot created earlier if available (within transform_js path)\n      // @ts-ignore - finalSnapshot is defined in the transform_js scope above when applicable\n      // @ts-ignore retrieve snapshot captured after transform_js (if any)\n      const snapshotForExtraction: Record<string, unknown> | null =\n        (this as any).__lastTransformSnapshot || null;\n      try {\n        if (snapshotForExtraction) {\n          logger.debug(`  provider: snapshot keys=${Object.keys(snapshotForExtraction).join(',')}`);\n        } else {\n          logger.debug(`  provider: snapshot is null`);\n        }\n      } catch {}\n      // Some shells may wrap JSON output inside a one-element array due to quoting.\n      // If we see a single-element array containing a JSON string or object, unwrap it.\n      try {\n        if (Array.isArray(outputForDependents) && (outputForDependents as unknown[]).length === 1) {\n          const first = (outputForDependents as unknown[])[0];\n          if (typeof first === 'string') {\n            try {\n              outputForDependents = JSON.parse(first);\n            } catch {}\n          } else if (first && typeof first === 'object') {\n            outputForDependents = first as unknown;\n          }\n        }\n      } catch {}\n\n      let content: string | undefined;\n      let extracted: { issues: ReviewIssue[]; remainingOutput: unknown } | null = null;\n\n      const trimmedRawOutput = typeof rawOutput === 'string' ? rawOutput.trim() : undefined;\n\n      const commandConfig = config as CheckProviderConfig & { forEach?: boolean };\n      const isForEachParent = commandConfig.forEach === true;\n\n      if (!isForEachParent) {\n        // Generic: if transform output is an object and contains an 'issues' field,\n        // expose all other fields to dependents regardless of whether we successfully\n        // normalized the issues array. This preserves flags like 'error' for fail_if.\n        try {\n          const baseObj = (snapshotForExtraction || (finalOutput as any)) as Record<\n            string,\n            unknown\n          >;\n          if (\n            baseObj &&\n            typeof baseObj === 'object' &&\n            Object.prototype.hasOwnProperty.call(baseObj, 'issues')\n          ) {\n            const remaining = { ...baseObj } as Record<string, unknown>;\n            delete (remaining as any).issues;\n            outputForDependents = Object.keys(remaining).length > 0 ? remaining : undefined;\n            try {\n              const k =\n                outputForDependents && typeof outputForDependents === 'object'\n                  ? Object.keys(outputForDependents as any).join(',')\n                  : String(outputForDependents);\n              logger.debug(`  provider: generic-remaining keys=${k}`);\n            } catch {}\n          }\n        } catch {}\n        // Fast path for transform_js objects that include an issues array (realm-agnostic)\n        const objForExtraction = (snapshotForExtraction || (finalOutput as any)) as Record<\n          string,\n          unknown\n        >;\n        if (objForExtraction && typeof objForExtraction === 'object') {\n          try {\n            const rec = objForExtraction;\n            const maybeIssues: any = (rec as any).issues;\n            const toPlainArray = (v: any): any[] | null => {\n              if (Array.isArray(v)) return v;\n              try {\n                if (v && typeof v === 'object' && typeof v[Symbol.iterator] === 'function') {\n                  return Array.from(v);\n                }\n              } catch {}\n              const len = Number((v || {}).length);\n              if (Number.isFinite(len) && len >= 0) {\n                const arr: any[] = [];\n                for (let i = 0; i < len; i++) arr.push(v[i]);\n                return arr;\n              }\n              try {\n                const cloned = JSON.parse(JSON.stringify(v));\n                return Array.isArray(cloned) ? cloned : null;\n              } catch {\n                return null;\n              }\n            };\n            try {\n              const ctor =\n                maybeIssues && (maybeIssues as any).constructor\n                  ? (maybeIssues as any).constructor.name\n                  : 'unknown';\n              logger.debug(\n                `  provider: issues inspect typeof=${typeof maybeIssues} Array.isArray=${Array.isArray(\n                  maybeIssues\n                )} ctor=${ctor} keys=${Object.keys((maybeIssues || {}) as any).join(',')}`\n              );\n            } catch {}\n            const arr = toPlainArray(maybeIssues);\n            if (arr) {\n              const norm = this.normalizeIssueArray(arr);\n              if (norm) {\n                issues = norm;\n                const remaining = { ...rec } as Record<string, unknown>;\n                delete (remaining as any).issues;\n                outputForDependents = Object.keys(remaining).length > 0 ? remaining : undefined;\n                try {\n                  const keys =\n                    outputForDependents && typeof outputForDependents === 'object'\n                      ? Object.keys(outputForDependents as any).join(',')\n                      : String(outputForDependents);\n                  logger.info(\n                    `  provider: fast-path issues=${issues.length} remaining keys=${keys}`\n                  );\n                } catch {}\n              } else {\n                try {\n                  logger.info('  provider: fast-path norm failed');\n                } catch {}\n              }\n            } else {\n              try {\n                logger.info('  provider: fast-path arr unavailable');\n              } catch {}\n            }\n          } catch {}\n        }\n        // Normalize extraction target: unwrap one-element arrays like [\"{...}\"] or [{...}]\n        let extractionTarget: unknown = snapshotForExtraction || finalOutput;\n        try {\n          if (Array.isArray(extractionTarget) && (extractionTarget as unknown[]).length === 1) {\n            const first = (extractionTarget as unknown[])[0];\n            if (typeof first === 'string') {\n              try {\n                extractionTarget = JSON.parse(first);\n              } catch {\n                extractionTarget = first;\n              }\n            } else if (first && typeof first === 'object') {\n              extractionTarget = first as unknown;\n            }\n          }\n        } catch {}\n        extracted = this.extractIssuesFromOutput(extractionTarget);\n        try {\n          if (extractionTarget !== (snapshotForExtraction || finalOutput)) {\n            finalOutput = extractionTarget;\n          }\n        } catch {}\n        // no debug\n        // Handle cross-realm Arrays from sandbox: issues may look like an array but fail Array.isArray\n        if (!extracted && finalOutput && typeof finalOutput === 'object') {\n          try {\n            const rec = finalOutput as Record<string, unknown>;\n            const maybeIssues: any = (rec as any).issues;\n            if (maybeIssues && typeof maybeIssues === 'object') {\n              let arr: any[] | null = null;\n              // Prefer iterator if present\n              try {\n                if (typeof maybeIssues[Symbol.iterator] === 'function') {\n                  arr = Array.from(maybeIssues);\n                }\n              } catch {}\n              // Fallback to length-based copy\n              if (!arr) {\n                const len = Number((maybeIssues as any).length);\n                if (Number.isFinite(len) && len >= 0) {\n                  arr = [];\n                  for (let i = 0; i < len; i++) arr.push(maybeIssues[i]);\n                }\n              }\n              // Last resort: JSON clone\n              if (!arr) {\n                try {\n                  arr = JSON.parse(JSON.stringify(maybeIssues));\n                } catch {}\n              }\n              if (arr && Array.isArray(arr)) {\n                const norm = this.normalizeIssueArray(arr);\n                if (norm) {\n                  issues = norm;\n                  const remaining = { ...rec } as Record<string, unknown>;\n                  delete (remaining as any).issues;\n                  outputForDependents = Object.keys(remaining).length > 0 ? remaining : undefined;\n                }\n              }\n            }\n          } catch {}\n        }\n        if (!extracted && typeof finalOutput === 'string') {\n          // Attempt to parse string output as JSON and extract issues again\n          try {\n            const parsed = JSON.parse(finalOutput);\n            extracted = this.extractIssuesFromOutput(parsed);\n            if (extracted) {\n              issues = extracted.issues;\n              outputForDependents = extracted.remainingOutput;\n              // If remainingOutput carries a content field, pick it up\n              if (\n                typeof extracted.remainingOutput === 'object' &&\n                extracted.remainingOutput !== null &&\n                typeof (extracted.remainingOutput as any).content === 'string'\n              ) {\n                const c = String((extracted.remainingOutput as any).content).trim();\n                if (c) content = c;\n              }\n            }\n          } catch {\n            // Try to salvage JSON from anywhere within the string (stripped logs/ansi)\n            try {\n              const any = this.extractJsonAnywhere(finalOutput);\n              if (any) {\n                const parsed = JSON.parse(any);\n                extracted = this.extractIssuesFromOutput(parsed);\n                if (extracted) {\n                  issues = extracted.issues;\n                  outputForDependents = extracted.remainingOutput;\n                  if (\n                    typeof extracted.remainingOutput === 'object' &&\n                    extracted.remainingOutput !== null &&\n                    typeof (extracted.remainingOutput as any).content === 'string'\n                  ) {\n                    const c = String((extracted.remainingOutput as any).content).trim();\n                    if (c) content = c;\n                  }\n                }\n              }\n            } catch {\n              // leave as-is\n            }\n          }\n        } else if (extracted) {\n          issues = extracted.issues;\n          outputForDependents = extracted.remainingOutput;\n          // Also propagate embedded content when remainingOutput is an object { content, ... }\n          if (\n            typeof extracted.remainingOutput === 'object' &&\n            extracted.remainingOutput !== null &&\n            typeof (extracted.remainingOutput as any).content === 'string'\n          ) {\n            const c = String((extracted.remainingOutput as any).content).trim();\n            if (c) content = c;\n          }\n        }\n\n        if (!issues.length && this.shouldTreatAsTextOutput(trimmedRawOutput)) {\n          content = trimmedRawOutput;\n        } else if (issues.length && typeof extracted?.remainingOutput === 'string') {\n          const trimmed = extracted.remainingOutput.trim();\n          if (trimmed) {\n            content = trimmed;\n          }\n        }\n\n        // Generic fallback: if issues are still empty, try to parse raw stdout as JSON and extract issues.\n        if (!issues.length && typeof trimmedRawOutput === 'string') {\n          try {\n            const tryParsed = JSON.parse(trimmedRawOutput);\n            const reextract = this.extractIssuesFromOutput(tryParsed);\n            if (reextract && reextract.issues && reextract.issues.length) {\n              issues = reextract.issues;\n              if (!outputForDependents && reextract.remainingOutput) {\n                outputForDependents = reextract.remainingOutput;\n              }\n            } else if (Array.isArray(tryParsed)) {\n              // Treat parsed array as potential issues array or array of { issues: [...] }\n              const first = tryParsed[0];\n              if (first && typeof first === 'object' && Array.isArray((first as any).issues)) {\n                const merged: unknown[] = [];\n                for (const el of tryParsed as unknown[]) {\n                  if (el && typeof el === 'object' && Array.isArray((el as any).issues)) {\n                    merged.push(...((el as any).issues as unknown[]));\n                  }\n                }\n                const flat = this.normalizeIssueArray(merged);\n                if (flat) issues = flat;\n              } else {\n                // Try to parse string elements into JSON objects and extract\n                const converted: unknown[] = [];\n                for (const el of tryParsed as unknown[]) {\n                  if (typeof el === 'string') {\n                    try {\n                      const obj = JSON.parse(el);\n                      converted.push(obj);\n                    } catch {\n                      // keep as-is\n                    }\n                  } else {\n                    converted.push(el);\n                  }\n                }\n                const flat = this.normalizeIssueArray(converted as unknown[]);\n                if (flat) issues = flat;\n              }\n            }\n          } catch {}\n          if (!issues.length) {\n            try {\n              const any = this.extractJsonAnywhere(trimmedRawOutput);\n              if (any) {\n                const tryParsed = JSON.parse(any);\n                const reextract = this.extractIssuesFromOutput(tryParsed);\n                if (reextract && reextract.issues && reextract.issues.length) {\n                  issues = reextract.issues;\n                  if (!outputForDependents && reextract.remainingOutput) {\n                    outputForDependents = reextract.remainingOutput;\n                  }\n                }\n              }\n            } catch {}\n          }\n        }\n\n        // Preserve all primitive flags (boolean/number/string) from original transform output\n        try {\n          const srcObj = (snapshotForExtraction || (finalOutput as any)) as Record<string, unknown>;\n          if (\n            outputForDependents &&\n            typeof outputForDependents === 'object' &&\n            srcObj &&\n            typeof srcObj === 'object'\n          ) {\n            for (const k of Object.keys(srcObj)) {\n              const v: any = (srcObj as any)[k];\n              if (typeof v === 'boolean' || typeof v === 'number' || typeof v === 'string') {\n                (outputForDependents as any)[k] = v;\n              }\n            }\n          }\n        } catch {}\n\n        // Normalize output object to a plain shallow object (avoid JSON stringify drop of false booleans)\n        try {\n          if (\n            outputForDependents &&\n            typeof outputForDependents === 'object' &&\n            !Array.isArray(outputForDependents)\n          ) {\n            const plain: Record<string, unknown> = {};\n            for (const k of Object.keys(outputForDependents as any)) {\n              (plain as any)[k] = (outputForDependents as any)[k];\n            }\n            outputForDependents = plain;\n          }\n        } catch {}\n      }\n\n      if (!content && this.shouldTreatAsTextOutput(trimmedRawOutput) && !isForEachParent) {\n        content = trimmedRawOutput;\n      }\n\n      // Normalize output object to plain JSON to avoid cross-realm proxy quirks\n      try {\n        if (outputForDependents && typeof outputForDependents === 'object') {\n          outputForDependents = JSON.parse(JSON.stringify(outputForDependents));\n        }\n      } catch {}\n\n      // Promote primitive flags from original transform output to top-level result fields (schema-agnostic)\n      const promoted: Record<string, unknown> = {};\n      try {\n        const srcObj = (snapshotForExtraction || (finalOutput as any)) as Record<string, unknown>;\n        if (srcObj && typeof srcObj === 'object') {\n          for (const k of Object.keys(srcObj)) {\n            const v: any = (srcObj as any)[k];\n            if (typeof v === 'boolean') {\n              if (v === true && promoted[k] === undefined) promoted[k] = true;\n            } else if (\n              (typeof v === 'number' || typeof v === 'string') &&\n              promoted[k] === undefined\n            ) {\n              promoted[k] = v;\n            }\n          }\n        }\n      } catch {}\n\n      // Return the output and issues as part of the review summary so dependent checks can use them\n      const result = {\n        issues,\n        output: outputForDependents,\n        ...(content ? { content } : {}),\n        ...promoted,\n      } as ReviewSummary;\n\n      // Capture output and transform details in active OTEL span\n      try {\n        const span = trace.getSpan(otContext.active());\n        if (span) {\n          captureCheckOutput(span, outputForDependents);\n          if (transformJs && output !== finalOutput) {\n            captureTransformJS(span, transformJs, output, finalOutput);\n          }\n        }\n      } catch {\n        // Ignore telemetry errors\n      }\n      // Fallback NDJSON for output (non-OTEL environments)\n      try {\n        const checkId = (config as any).checkName || (config as any).id || 'unknown';\n        const outJson = JSON.stringify((result as any).output ?? result);\n        const { emitNdjsonSpanWithEvents } = require('../telemetry/fallback-ndjson');\n        emitNdjsonSpanWithEvents(\n          'visor.check',\n          { 'visor.check.id': checkId, 'visor.check.output': outJson },\n          [{ name: 'check.started' }, { name: 'check.completed' }]\n        );\n      } catch {}\n\n      // Attach raw transform object only when transform_js was used (avoid polluting plain command outputs)\n      try {\n        if (transformJs) {\n          const rawObj = (snapshotForExtraction || (finalOutput as any)) as Record<string, unknown>;\n          if (rawObj && typeof rawObj === 'object') {\n            (result as any).__raw = rawObj;\n          }\n        }\n      } catch {}\n\n      // Final safeguard: ensure primitive flags from original transform output are present in result.output.\n      // Do this without dropping explicit false values (important for fail_if like `output.error`).\n      try {\n        const srcObj = (snapshotForExtraction || (finalOutput as any)) as Record<string, unknown>;\n        const srcErr = ((): boolean | undefined => {\n          try {\n            if (\n              snapshotForExtraction &&\n              typeof snapshotForExtraction === 'object' &&\n              (snapshotForExtraction as any).error !== undefined\n            ) {\n              return Boolean((snapshotForExtraction as any).error);\n            }\n            if (\n              finalOutput &&\n              typeof finalOutput === 'object' &&\n              (finalOutput as any).error !== undefined\n            ) {\n              return Boolean((finalOutput as any).error);\n            }\n          } catch {}\n          return undefined;\n        })();\n        const dst = (result as any).output;\n        if (srcObj && typeof srcObj === 'object' && dst && typeof dst === 'object') {\n          try {\n            logger.debug(\n              `  provider: safeguard src.error typeof=${typeof (srcObj as any).error} val=${String((srcObj as any).error)} dst.hasErrorBefore=${String((dst as any).error !== undefined)}`\n            );\n          } catch {}\n          for (const k of Object.keys(srcObj)) {\n            const v: any = (srcObj as any)[k];\n            if (typeof v === 'boolean' || typeof v === 'number' || typeof v === 'string') {\n              (dst as any)[k] = v;\n            }\n          }\n          // Explicitly normalize a common flag used in tests/pipelines\n          if (srcErr !== undefined && (dst as any).error === undefined) {\n            (dst as any).error = srcErr;\n            try {\n              const k = Object.keys(dst as any).join(',');\n              logger.debug(\n                `  provider: safeguard merged error -> output keys=${k} val=${String((dst as any).error)}`\n              );\n            } catch {}\n          }\n        }\n      } catch {}\n\n      try {\n        const out: any = (result as any).output;\n        if (out && typeof out === 'object') {\n          const k = Object.keys(out as Record<string, unknown>).join(',');\n          logger.debug(`  provider: return output keys=${k}`);\n        } else {\n          logger.debug(`  provider: return output type=${typeof out}`);\n        }\n      } catch {}\n\n      // no debug\n\n      return result;\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n\n      // Check if this is a timeout error\n      let isTimeout = false;\n      if (error && typeof error === 'object') {\n        const execError = error as { killed?: boolean; signal?: string; code?: string | number };\n        // Node's child_process sets killed=true and signal='SIGTERM' on timeout\n        if (execError.killed && execError.signal === 'SIGTERM') {\n          isTimeout = true;\n        }\n        // Some versions may also set code to 'ETIMEDOUT'\n        if (execError.code === 'ETIMEDOUT') {\n          isTimeout = true;\n        }\n      }\n      // Fallback: detect timeout based on error message text\n      if (!isTimeout && error instanceof Error) {\n        if (/timed out/i.test(error.message)) {\n          isTimeout = true;\n        }\n      }\n\n      // Extract stderr from the error if available (child_process errors include stdout/stderr)\n      let stderrOutput = '';\n      if (error && typeof error === 'object') {\n        const execError = error as { stderr?: string; stdout?: string };\n        if (execError.stderr) {\n          stderrOutput = execError.stderr.trim();\n        }\n      }\n\n      // Construct detailed error message\n      let detailedMessage: string;\n      let ruleId: string;\n\n      if (isTimeout) {\n        const timeoutMs = (config.timeout as number) || 60000;\n        detailedMessage = `Command execution timed out after ${timeoutMs} milliseconds`;\n        if (stderrOutput) {\n          detailedMessage += `\\n\\nStderr output:\\n${stderrOutput}`;\n        }\n        ruleId = 'command/timeout';\n      } else {\n        detailedMessage = stderrOutput\n          ? `Command execution failed: ${errorMessage}\\n\\nStderr output:\\n${stderrOutput}`\n          : `Command execution failed: ${errorMessage}`;\n        ruleId = 'command/execution_error';\n      }\n\n      logger.error(`âœ— ${detailedMessage}`);\n\n      // Build error output so workflow tools can propagate errors to AI\n      const errorOutput = {\n        error: true,\n        timeout: isTimeout,\n        message: detailedMessage,\n        text: detailedMessage,\n      };\n\n      // Capture error output in telemetry\n      try {\n        const span = trace.getSpan(otContext.active());\n        if (span) {\n          captureCheckOutput(span, errorOutput);\n        }\n      } catch {\n        // Ignore telemetry errors\n      }\n\n      return {\n        issues: [\n          {\n            file: 'command',\n            line: 0,\n            ruleId,\n            message: detailedMessage,\n            severity: 'error',\n            category: 'logic',\n          },\n        ],\n        output: errorOutput,\n      } as ReviewSummary & { output: unknown };\n    }\n  }\n\n  private buildOutputContext(\n    dependencyResults?: Map<string, ReviewSummary>,\n    outputHistory?: Map<string, unknown[]>\n  ): Record<string, unknown> {\n    if (!dependencyResults) {\n      return {};\n    }\n\n    const outputs: Record<string, unknown> = {};\n    const history: Record<string, unknown[]> = {};\n\n    for (const [checkName, result] of dependencyResults) {\n      // If the result has a direct output field, use it directly\n      // Otherwise, expose the entire result as-is\n      const summary = result as ReviewSummary & { output?: unknown };\n      const value = summary.output !== undefined ? summary.output : summary;\n      outputs[checkName] = this.makeJsonSmart(value);\n    }\n\n    // Add history for each check if available\n    if (outputHistory) {\n      for (const [checkName, historyArray] of outputHistory) {\n        history[checkName] = historyArray.map(val => this.makeJsonSmart(val));\n      }\n    }\n\n    // Attach history to the outputs object\n    (outputs as any).history = history;\n\n    return outputs;\n  }\n\n  /**\n   * Wrap a value with JSON-smart behavior:\n   *  - If it's a JSON string, expose parsed properties via Proxy (e.g., value.key)\n   *  - When coerced to string (toString/valueOf/Symbol.toPrimitive), return the original raw string\n   *  - If parsing fails or value is not a string, return the value unchanged\n   *  - Attempts to extract JSON from the end of the output if full parse fails\n   */\n  private makeJsonSmart<T = unknown>(value: T): T | any {\n    if (typeof value !== 'string') {\n      return value;\n    }\n\n    const raw = value as unknown as string;\n    let parsed: any;\n\n    // First try: parse the entire string as JSON\n    try {\n      parsed = JSON.parse(raw);\n    } catch {\n      // Second try: extract JSON from the end of the output\n      // Look for { or [ at the start of a line and take everything after it\n      const jsonMatch = this.extractJsonFromEnd(raw);\n      if (jsonMatch) {\n        try {\n          parsed = JSON.parse(jsonMatch);\n          logger.debug(\n            `ðŸ”§ Debug: Extracted JSON from end of output (${jsonMatch.length} chars from ${raw.length} total)`\n          );\n        } catch {\n          // Not valid JSON even after extraction, return original string\n          return raw;\n        }\n      } else {\n        // Not JSON, return original string\n        return raw;\n      }\n    }\n\n    // Use a boxed string so string methods still work via Proxy fallback\n    const boxed = new String(raw);\n    const handler: ProxyHandler<any> = {\n      get(target, prop, receiver) {\n        if (prop === 'toString' || prop === 'valueOf') {\n          return () => raw;\n        }\n        if (prop === Symbol.toPrimitive) {\n          return () => raw;\n        }\n        if (parsed != null && (typeof parsed === 'object' || Array.isArray(parsed))) {\n          if (prop in parsed) {\n            return (parsed as any)[prop as any];\n          }\n        }\n        return Reflect.get(target, prop, receiver);\n      },\n      has(_target, prop) {\n        if (parsed != null && (typeof parsed === 'object' || Array.isArray(parsed))) {\n          if (prop in parsed) return true;\n        }\n        return false;\n      },\n      ownKeys(_target) {\n        if (parsed != null && (typeof parsed === 'object' || Array.isArray(parsed))) {\n          try {\n            return Reflect.ownKeys(parsed);\n          } catch {\n            return [];\n          }\n        }\n        return [];\n      },\n      getOwnPropertyDescriptor(_target, prop) {\n        if (parsed != null && (typeof parsed === 'object' || Array.isArray(parsed))) {\n          const descriptor = Object.getOwnPropertyDescriptor(parsed, prop as any);\n          if (descriptor) return descriptor;\n        }\n        return {\n          configurable: true,\n          enumerable: true,\n          writable: false,\n          value: undefined,\n        };\n      },\n    };\n    return new Proxy(boxed, handler);\n  }\n\n  /**\n   * Extract JSON from the end of a string that may contain logs/debug output\n   * Looks for the last occurrence of { or [ and tries to parse from there\n   */\n  private extractJsonFromEnd(text: string): string | null {\n    // Robust strategy: find the last closing brace/bracket, then walk backwards to the matching opener\n    const lastBrace = Math.max(text.lastIndexOf('}'), text.lastIndexOf(']'));\n    if (lastBrace === -1) return null;\n    // Scan backwards to find matching opener with a simple counter\n    let open = 0;\n    for (let i = lastBrace; i >= 0; i--) {\n      const ch = text[i];\n      if (ch === '}' || ch === ']') open++;\n      else if (ch === '{' || ch === '[') open--;\n      if (open === 0 && (ch === '{' || ch === '[')) {\n        const candidate = text.slice(i, lastBrace + 1).trim();\n        try {\n          JSON.parse(candidate);\n          return candidate;\n        } catch {\n          return null;\n        }\n      }\n    }\n    return null;\n  }\n\n  // Extract any balanced JSON object/array substring from anywhere in the text\n  private extractJsonAnywhere(text: string): string | null {\n    const n = text.length;\n    let best: string | null = null;\n    for (let i = 0; i < n; i++) {\n      const start = text[i];\n      if (start !== '{' && start !== '[') continue;\n      let open = 0;\n      let inString = false;\n      let escape = false;\n      for (let j = i; j < n; j++) {\n        const ch = text[j];\n        if (escape) {\n          escape = false;\n          continue;\n        }\n        if (ch === '\\\\') {\n          escape = true;\n          continue;\n        }\n        if (ch === '\"') {\n          inString = !inString;\n          continue;\n        }\n        if (inString) continue;\n        if (ch === '{' || ch === '[') open++;\n        else if (ch === '}' || ch === ']') open--;\n        if (open === 0 && (ch === '}' || ch === ']')) {\n          const candidate = text.slice(i, j + 1).trim();\n          try {\n            JSON.parse(candidate);\n            best = candidate; // keep the last valid one we find\n          } catch {\n            // Try a loose-to-strict conversion (quote keys and barewords)\n            const strict = this.looseJsonToStrict(candidate);\n            if (strict) {\n              try {\n                JSON.parse(strict);\n                best = strict;\n              } catch {}\n            }\n          }\n          break;\n        }\n      }\n    }\n    return best;\n  }\n\n  // Best-effort conversion of object-literal-like strings to strict JSON\n  private looseJsonToStrict(candidate: string): string | null {\n    try {\n      let s = candidate.trim();\n      // Convert single quotes to double quotes conservatively\n      s = s.replace(/'/g, '\"');\n      // Quote unquoted keys: {key: ...} or ,key: ...\n      s = s.replace(/([\\{,]\\s*)([A-Za-z_][A-Za-z0-9_-]*)\\s*:/g, '$1\"$2\":');\n      // Quote bareword values except true/false/null and numbers\n      s = s.replace(/:\\s*([A-Za-z_][A-Za-z0-9_-]*)\\s*(?=[,}])/g, (_match, word) => {\n        const lw = String(word).toLowerCase();\n        if (lw === 'true' || lw === 'false' || lw === 'null') return `:${lw}`;\n        return `:\"${word}\"`;\n      });\n      return s;\n    } catch {\n      return null;\n    }\n  }\n\n  /**\n   * Recursively apply JSON-smart wrapper to outputs object values\n   */\n  private makeOutputsJsonSmart(outputs: Record<string, unknown>): Record<string, unknown> {\n    const wrapped: Record<string, unknown> = {};\n    for (const [k, v] of Object.entries(outputs || {})) {\n      wrapped[k] = this.makeJsonSmart(v);\n    }\n    return wrapped;\n  }\n\n  private getSafeEnvironmentVariables(): Record<string, string> {\n    const safeVars: Record<string, string> = {};\n    const { buildSandboxEnv } = require('../utils/env-exposure');\n    const merged = buildSandboxEnv(process.env);\n    for (const [key, value] of Object.entries(merged)) {\n      safeVars[key] = String(value);\n    }\n\n    // Add current working directory\n    safeVars['PWD'] = process.cwd();\n\n    return safeVars;\n  }\n\n  getSupportedConfigKeys(): string[] {\n    return [\n      'type',\n      'exec',\n      'transform',\n      'transform_js',\n      'env',\n      'timeout',\n      'depends_on',\n      'on',\n      'if',\n      'group',\n      'forEach',\n    ];\n  }\n\n  async isAvailable(): Promise<boolean> {\n    // Command provider is always available as long as we can execute commands\n    return true;\n  }\n\n  getRequirements(): string[] {\n    return [\n      'Valid shell command to execute',\n      'Shell environment available',\n      'Optional: Transform template for processing output',\n    ];\n  }\n\n  private extractIssuesFromOutput(\n    output: unknown\n  ): { issues: ReviewIssue[]; remainingOutput: unknown } | null {\n    try {\n      logger.info(\n        `  extractIssuesFromOutput: typeof=${Array.isArray(output) ? 'array' : typeof output}`\n      );\n      if (typeof output === 'object' && output) {\n        const rec = output as Record<string, unknown>;\n        logger.info(\n          `  extractIssuesFromOutput: keys=${Object.keys(rec).join(',')} issuesIsArray=${Array.isArray(\n            (rec as any).issues\n          )}`\n        );\n      }\n    } catch {}\n    if (output === null || output === undefined) {\n      return null;\n    }\n\n    // If output is already a string, do not treat it as issues here (caller may try parsing JSON)\n    if (typeof output === 'string') {\n      return null;\n    }\n\n    if (Array.isArray(output)) {\n      // Two supported shapes:\n      //  1) Array<ReviewIssue-like>\n      //  2) Array<{ issues: Array<ReviewIssue-like> }>\n      const first = output[0];\n      if (\n        first &&\n        typeof first === 'object' &&\n        !Array.isArray((first as any).message) &&\n        Array.isArray((first as any).issues)\n      ) {\n        // flatten nested issues arrays\n        const merged: unknown[] = [];\n        for (const el of output as unknown[]) {\n          if (el && typeof el === 'object' && Array.isArray((el as any).issues)) {\n            merged.push(...((el as any).issues as unknown[]));\n          }\n        }\n        const flat = this.normalizeIssueArray(merged);\n        if (flat) return { issues: flat, remainingOutput: undefined };\n      } else {\n        const issues = this.normalizeIssueArray(output);\n        if (issues) {\n          return { issues, remainingOutput: undefined };\n        }\n      }\n      return null;\n    }\n\n    if (typeof output === 'object') {\n      const record = output as Record<string, unknown>;\n\n      if (Array.isArray(record.issues)) {\n        const issues = this.normalizeIssueArray(record.issues);\n        if (!issues) {\n          return null;\n        }\n\n        const remaining = { ...record };\n        delete (remaining as { issues?: unknown }).issues;\n\n        const remainingKeys = Object.keys(remaining);\n        const remainingOutput = remainingKeys.length > 0 ? remaining : undefined;\n\n        return {\n          issues,\n          remainingOutput,\n        };\n      }\n\n      const singleIssue = this.normalizeIssue(record);\n      if (singleIssue) {\n        return { issues: [singleIssue], remainingOutput: undefined };\n      }\n    }\n\n    return null;\n  }\n\n  private shouldTreatAsTextOutput(value?: string): value is string {\n    if (!value) {\n      return false;\n    }\n\n    const trimmed = value.trim();\n    if (!trimmed) {\n      return false;\n    }\n\n    // Heuristic: consider it JSON-like if it starts with { or [ and ends with } or ]\n    const startsJson =\n      (trimmed.startsWith('{') && trimmed.endsWith('}')) ||\n      (trimmed.startsWith('[') && trimmed.endsWith(']'));\n\n    return !startsJson;\n  }\n\n  private normalizeIssueArray(values: unknown[]): ReviewIssue[] | null {\n    const normalized: ReviewIssue[] = [];\n\n    for (const value of values) {\n      const issue = this.normalizeIssue(value);\n      if (!issue) {\n        return null;\n      }\n      normalized.push(issue);\n    }\n\n    return normalized;\n  }\n\n  private normalizeIssue(raw: unknown): ReviewIssue | null {\n    if (!raw || typeof raw !== 'object') {\n      return null;\n    }\n\n    const data = raw as Record<string, unknown>;\n\n    const message = this.toTrimmedString(\n      data.message || data.text || data.description || data.summary\n    );\n    if (!message) {\n      return null;\n    }\n\n    // Require at least one issue-specific field beyond just a message-like field.\n    // This prevents objects like {text: \"...\"} from being treated as issues.\n    const hasIssueField =\n      data.file !== undefined ||\n      data.path !== undefined ||\n      data.filename !== undefined ||\n      data.line !== undefined ||\n      data.startLine !== undefined ||\n      data.lineNumber !== undefined ||\n      data.severity !== undefined ||\n      data.level !== undefined ||\n      data.priority !== undefined ||\n      data.ruleId !== undefined ||\n      data.rule !== undefined ||\n      data.category !== undefined ||\n      data.type !== undefined;\n    if (!hasIssueField) {\n      return null;\n    }\n\n    const allowedSeverities = new Set(['info', 'warning', 'error', 'critical']);\n    const severityRaw = this.toTrimmedString(data.severity || data.level || data.priority);\n    let severity: ReviewIssue['severity'] = 'warning';\n    if (severityRaw) {\n      const lower = severityRaw.toLowerCase();\n      if (allowedSeverities.has(lower)) {\n        severity = lower as ReviewIssue['severity'];\n      } else if (['fatal', 'high'].includes(lower)) {\n        severity = 'error';\n      } else if (['medium', 'moderate'].includes(lower)) {\n        severity = 'warning';\n      } else if (['low', 'minor'].includes(lower)) {\n        severity = 'info';\n      }\n    }\n\n    const allowedCategories = new Set([\n      'security',\n      'performance',\n      'style',\n      'logic',\n      'documentation',\n    ]);\n    const categoryRaw = this.toTrimmedString(data.category || data.type || data.group);\n    let category: ReviewIssue['category'] = 'logic';\n    if (categoryRaw && allowedCategories.has(categoryRaw.toLowerCase())) {\n      category = categoryRaw.toLowerCase() as ReviewIssue['category'];\n    }\n\n    const file = this.toTrimmedString(data.file || data.path || data.filename) || 'system';\n\n    const line = this.toNumber(data.line || data.startLine || data.lineNumber) ?? 0;\n    const endLine = this.toNumber(data.endLine || data.end_line || data.stopLine);\n\n    const suggestion = this.toTrimmedString(data.suggestion);\n    const replacement = this.toTrimmedString(data.replacement);\n\n    const ruleId =\n      this.toTrimmedString(data.ruleId || data.rule || data.id || data.check) || 'command';\n\n    return {\n      file,\n      line,\n      endLine: endLine ?? undefined,\n      ruleId,\n      message,\n      severity,\n      category,\n      suggestion: suggestion || undefined,\n      replacement: replacement || undefined,\n    };\n  }\n\n  private toTrimmedString(value: unknown): string | null {\n    if (typeof value === 'string') {\n      const trimmed = value.trim();\n      return trimmed.length > 0 ? trimmed : null;\n    }\n    if (value !== null && value !== undefined && typeof value.toString === 'function') {\n      const converted = String(value).trim();\n      return converted.length > 0 ? converted : null;\n    }\n    return null;\n  }\n\n  private toNumber(value: unknown): number | null {\n    if (value === null || value === undefined) {\n      return null;\n    }\n    const num = Number(value);\n    if (Number.isFinite(num)) {\n      return Math.trunc(num);\n    }\n    return null;\n  }\n\n  private async renderCommandTemplate(\n    template: string,\n    context: {\n      pr: Record<string, unknown>;\n      files: unknown[];\n      outputs: Record<string, unknown>;\n      env: Record<string, string>;\n    }\n  ): Promise<string> {\n    try {\n      // Best-effort compatibility: allow double-quoted bracket keys inside Liquid tags.\n      // e.g., {{ outputs[\"fetch-tickets\"].key }} â†’ {{ outputs['fetch-tickets'].key }}\n      let tpl = template;\n      if (tpl.includes('{{')) {\n        tpl = tpl.replace(/\\{\\{([\\s\\S]*?)\\}\\}/g, (_m, inner) => {\n          const fixed = String(inner).replace(/\\[\\\"/g, \"['\").replace(/\\\"\\]/g, \"']\");\n          return `{{ ${fixed} }}`;\n        });\n      }\n      let rendered = await this.liquid.parseAndRender(tpl, context);\n      // If Liquid left unresolved tags (common when users write JS expressions inside {{ }}),\n      // fall back to a safe JS-expression renderer for the remaining tags.\n      if (/\\{\\{[\\s\\S]*?\\}\\}/.test(rendered)) {\n        try {\n          rendered = this.renderWithJsExpressions(rendered, context);\n        } catch {\n          // keep Liquid-rendered result as-is\n        }\n      }\n      return rendered;\n    } catch (error) {\n      logger.debug(`ðŸ”§ Debug: Liquid templating failed, trying JS-expression fallback: ${error}`);\n      try {\n        return this.renderWithJsExpressions(template, context);\n      } catch {\n        return template;\n      }\n    }\n  }\n\n  private renderWithJsExpressions(\n    template: string,\n    context: {\n      pr: Record<string, unknown>;\n      files: unknown[];\n      outputs: Record<string, unknown>;\n      env: Record<string, string>;\n    }\n  ): string {\n    const scope = {\n      pr: context.pr,\n      files: context.files,\n      outputs: context.outputs,\n      env: context.env,\n    };\n\n    const expressionRegex = /\\{\\{\\s*([^{}]+?)\\s*\\}\\}/g;\n    return template.replace(expressionRegex, (_match, expr) => {\n      const expression = String(expr).trim();\n      if (!expression) return '';\n      try {\n        const evalCode = `\n          const pr = scope.pr;\n          const files = scope.files;\n          const outputs = scope.outputs;\n          const env = scope.env;\n          return (${expression});\n        `;\n        if (!this.sandbox) this.sandbox = this.createSecureSandbox();\n        const evaluator = this.sandbox.compile(evalCode);\n        const result = evaluator({ scope }).run();\n        return result === undefined || result === null ? '' : String(result);\n      } catch {\n        return '';\n      }\n    });\n  }\n}\n","import { MemoryStore } from '../memory-store';\n\n/**\n * Create synchronous memory helpers for sandboxed script execution. These mirror\n * the legacy behavior previously used for in-provider scripting: mutate in-memory state\n * synchronously and perform at most one save() afterward if needed.\n */\nexport function createSyncMemoryOps(store: MemoryStore): {\n  ops: {\n    get: (key: string, ns?: string) => unknown;\n    has: (key: string, ns?: string) => boolean;\n    list: (ns?: string) => string[];\n    getAll: (ns?: string) => Record<string, unknown>;\n    set: (key: string, value: unknown, ns?: string) => unknown;\n    append: (key: string, value: unknown, ns?: string) => unknown[];\n    increment: (key: string, amount?: number, ns?: string) => number;\n    delete: (key: string, ns?: string) => boolean;\n    clear: (ns?: string) => void;\n  };\n  needsSave: () => boolean;\n} {\n  let saveNeeded = false;\n\n  const ensureNs = (ns?: string) => {\n    const nsName = ns || store.getDefaultNamespace();\n    const anyStore = store as unknown as { data: Map<string, Map<string, unknown>> };\n    if (!anyStore['data'].has(nsName)) {\n      anyStore['data'].set(nsName, new Map());\n    }\n    return nsName;\n  };\n\n  const ops = {\n    get: (key: string, ns?: string) => store.get(key, ns),\n    has: (key: string, ns?: string) => store.has(key, ns),\n    list: (ns?: string) => store.list(ns),\n    getAll: (ns?: string) => store.getAll(ns),\n    set: (key: string, value: unknown, ns?: string) => {\n      const nsName = ensureNs(ns);\n      (store as any)['data'].get(nsName)!.set(key, value);\n      saveNeeded = true;\n      return value;\n    },\n    append: (key: string, value: unknown, ns?: string) => {\n      const existing = store.get(key, ns);\n      let newValue: unknown[];\n      if (existing === undefined) newValue = [value];\n      else if (Array.isArray(existing)) newValue = [...existing, value];\n      else newValue = [existing, value];\n      const nsName = ensureNs(ns);\n      (store as any)['data'].get(nsName)!.set(key, newValue);\n      saveNeeded = true;\n      return newValue;\n    },\n    increment: (key: string, amount = 1, ns?: string) => {\n      const nsName = ensureNs(ns);\n      const current = store.get(key, nsName);\n      const numCurrent = typeof current === 'number' ? (current as number) : 0;\n      const newValue = numCurrent + amount;\n      (store as any)['data'].get(nsName)!.set(key, newValue);\n      saveNeeded = true;\n      return newValue;\n    },\n    delete: (key: string, ns?: string) => {\n      const nsName = ensureNs(ns);\n      const d = (store as any)['data'].get(nsName)?.delete(key) || false;\n      if (d) saveNeeded = true;\n      return d;\n    },\n    clear: (ns?: string) => {\n      if (ns) (store as any)['data'].delete(ns);\n      else (store as any)['data'].clear();\n      saveNeeded = true;\n    },\n  } as const;\n\n  return { ops: ops as any, needsSave: () => saveNeeded };\n}\n","import { CheckProvider, CheckProviderConfig } from './check-provider.interface';\nimport { PRInfo } from '../pr-analyzer';\nimport { ReviewSummary } from '../reviewer';\nimport { MemoryStore } from '../memory-store';\nimport { Liquid } from 'liquidjs';\nimport { createExtendedLiquid } from '../liquid-extensions';\nimport { logger } from '../logger';\nimport Sandbox from '@nyariv/sandboxjs';\nimport { createSecureSandbox, compileAndRun } from '../utils/sandbox';\nimport { buildProviderTemplateContext } from '../utils/template-context';\nimport { createSyncMemoryOps } from '../utils/script-memory-ops';\n\n/**\n * Memory operation types\n */\nexport type MemoryOperation = 'get' | 'set' | 'append' | 'increment' | 'delete' | 'clear' | 'list';\n\n/**\n * Check provider for memory/state management\n * Supports in-memory and persistent storage with namespace isolation\n */\nexport class MemoryCheckProvider extends CheckProvider {\n  private liquid: Liquid;\n  private sandbox?: Sandbox;\n\n  constructor() {\n    super();\n    this.liquid = createExtendedLiquid({\n      strictVariables: false,\n      strictFilters: false,\n    });\n  }\n\n  /**\n   * Create a secure sandbox for JavaScript execution\n   */\n  private createSecureSandbox(): Sandbox {\n    return createSecureSandbox();\n  }\n\n  getName(): string {\n    return 'memory';\n  }\n\n  getDescription(): string {\n    return 'Memory/state management provider for persistent key-value storage across checks';\n  }\n\n  async validateConfig(config: unknown): Promise<boolean> {\n    if (!config || typeof config !== 'object') {\n      return false;\n    }\n\n    const cfg = config as CheckProviderConfig;\n\n    // Type must be 'memory'\n    if (cfg.type !== 'memory') {\n      return false;\n    }\n\n    // Operation is required\n    if (!cfg.operation || typeof cfg.operation !== 'string') {\n      return false;\n    }\n\n    const operation = cfg.operation as string;\n    const validOps = ['get', 'set', 'append', 'increment', 'delete', 'clear', 'list'];\n    if (!validOps.includes(operation)) {\n      return false;\n    }\n\n    // Key is required for get, set, append, increment, delete\n    if (['get', 'set', 'append', 'increment', 'delete'].includes(operation)) {\n      if (!cfg.key || typeof cfg.key !== 'string') {\n        return false;\n      }\n    }\n\n    // Value or value_js is required for set and append\n    if (['set', 'append'].includes(operation)) {\n      if (cfg.value === undefined && !cfg.value_js) {\n        return false;\n      }\n    }\n\n    // For custom scripting use the ScriptCheckProvider (type: 'script').\n\n    return true;\n  }\n\n  async execute(\n    prInfo: PRInfo,\n    config: CheckProviderConfig,\n    dependencyResults?: Map<string, ReviewSummary>,\n    _sessionInfo?: {\n      parentSessionId?: string;\n      reuseSession?: boolean;\n    } & import('./check-provider.interface').ExecutionContext\n  ): Promise<ReviewSummary> {\n    const operation = config.operation as MemoryOperation | undefined;\n    const key = config.key as string | undefined;\n    const namespace = config.namespace as string | undefined;\n\n    // Get memory store instance\n    const memoryStore = MemoryStore.getInstance();\n\n    // Build template context for value computation\n    const templateContext = this.buildTemplateContext(\n      prInfo,\n      dependencyResults,\n      memoryStore,\n      config.__outputHistory as Map<string, unknown[]> | undefined,\n      (_sessionInfo as any)?.stageHistoryBase as Record<string, number> | undefined,\n      _sessionInfo?.args\n    );\n\n    let result: unknown;\n\n    // No implicit fallbacks; operation must be explicitly provided.\n\n    try {\n      switch (operation) {\n        case 'get':\n          result = await this.handleGet(memoryStore, key!, namespace);\n          break;\n        case 'set':\n          result = await this.handleSet(memoryStore, key!, config, namespace, templateContext);\n          break;\n        case 'append':\n          result = await this.handleAppend(memoryStore, key!, config, namespace, templateContext);\n          break;\n        case 'increment':\n          result = await this.handleIncrement(\n            memoryStore,\n            key!,\n            config,\n            namespace,\n            templateContext\n          );\n          break;\n        case 'delete':\n          result = await this.handleDelete(memoryStore, key!, namespace);\n          break;\n        case 'clear':\n          result = await this.handleClear(memoryStore, namespace);\n          break;\n        case 'list':\n          result = await this.handleList(memoryStore, namespace);\n          break;\n        default:\n          throw new Error(`Unknown memory operation: ${operation}`);\n      }\n\n      // Return result as output\n      return {\n        issues: [],\n        output: result,\n      } as ReviewSummary & { output: unknown };\n    } catch (error) {\n      const errorMsg = error instanceof Error ? error.message : 'Unknown error in memory operation';\n      logger.error(`Memory operation failed: ${errorMsg}`);\n\n      return {\n        issues: [],\n        output: null,\n        error: errorMsg,\n      } as ReviewSummary & { output: null; error: string };\n    }\n  }\n\n  private async handleGet(store: MemoryStore, key: string, namespace?: string): Promise<unknown> {\n    const value = store.get(key, namespace);\n    logger.debug(\n      `Memory GET: ${namespace || store.getDefaultNamespace()}.${key} = ${JSON.stringify(value)}`\n    );\n    return value;\n  }\n\n  private async handleSet(\n    store: MemoryStore,\n    key: string,\n    config: CheckProviderConfig,\n    namespace: string | undefined,\n    context: Record<string, unknown>\n  ): Promise<unknown> {\n    const value = await this.computeValue(config, context);\n    await store.set(key, value, namespace);\n    logger.debug(\n      `Memory SET: ${namespace || store.getDefaultNamespace()}.${key} = ${JSON.stringify(value)}`\n    );\n    return value;\n  }\n\n  private async handleAppend(\n    store: MemoryStore,\n    key: string,\n    config: CheckProviderConfig,\n    namespace: string | undefined,\n    context: Record<string, unknown>\n  ): Promise<unknown> {\n    const value = await this.computeValue(config, context);\n    await store.append(key, value, namespace);\n    const result = store.get(key, namespace);\n    logger.debug(\n      `Memory APPEND: ${namespace || store.getDefaultNamespace()}.${key} += ${JSON.stringify(value)} (now: ${JSON.stringify(result)})`\n    );\n    return result;\n  }\n\n  private async handleIncrement(\n    store: MemoryStore,\n    key: string,\n    config: CheckProviderConfig,\n    namespace: string | undefined,\n    context: Record<string, unknown>\n  ): Promise<number> {\n    // Compute amount - default to 1 if not specified\n    let amount = 1;\n    if (config.value !== undefined || config.value_js) {\n      const computedValue = await this.computeValue(config, context);\n      if (typeof computedValue === 'number') {\n        amount = computedValue;\n      } else {\n        throw new Error(`Increment amount must be a number, got ${typeof computedValue}`);\n      }\n    }\n\n    const result = await store.increment(key, amount, namespace);\n    logger.debug(\n      `Memory INCREMENT: ${namespace || store.getDefaultNamespace()}.${key} += ${amount} (now: ${result})`\n    );\n    return result;\n  }\n\n  private async handleDelete(\n    store: MemoryStore,\n    key: string,\n    namespace?: string\n  ): Promise<boolean> {\n    const deleted = await store.delete(key, namespace);\n    logger.debug(\n      `Memory DELETE: ${namespace || store.getDefaultNamespace()}.${key} (deleted: ${deleted})`\n    );\n    return deleted;\n  }\n\n  private async handleClear(store: MemoryStore, namespace?: string): Promise<void> {\n    await store.clear(namespace);\n    logger.debug(`Memory CLEAR: ${namespace ? `namespace ${namespace}` : 'all namespaces'}`);\n  }\n\n  private async handleList(store: MemoryStore, namespace?: string): Promise<string[]> {\n    const keys = store.list(namespace);\n    logger.debug(`Memory LIST: ${namespace || store.getDefaultNamespace()} (${keys.length} keys)`);\n    return keys;\n  }\n\n  // For custom JavaScript execution use ScriptCheckProvider.\n\n  /**\n   * Compute value from config using value, value_js, transform, or transform_js\n   */\n  private async computeValue(\n    config: CheckProviderConfig,\n    context: Record<string, unknown>\n  ): Promise<unknown> {\n    let value: unknown;\n\n    // Start with direct value or value_js\n    if (config.value_js && typeof config.value_js === 'string') {\n      value = this.evaluateJavaScript(config.value_js, context);\n    } else {\n      value = config.value;\n    }\n\n    // Apply transform template if provided\n    if (config.transform && typeof config.transform === 'string') {\n      const rendered = await this.liquid.parseAndRender(config.transform, {\n        ...context,\n        value,\n      });\n      value = rendered;\n    }\n\n    // Apply transform_js if provided\n    if (config.transform_js && typeof config.transform_js === 'string') {\n      value = this.evaluateJavaScript(config.transform_js, { ...context, value });\n    }\n\n    return value;\n  }\n\n  /**\n   * Evaluate JavaScript expression in context using SandboxJS for secure execution\n   */\n  private evaluateJavaScript(expression: string, context: Record<string, unknown>): unknown {\n    this.sandbox = this.createSecureSandbox();\n\n    try {\n      const scope: Record<string, unknown> = { ...context };\n      return compileAndRun<unknown>(this.sandbox, `return (${expression});`, scope, {\n        injectLog: true,\n        wrapFunction: false,\n        logPrefix: '[memory:value_js]',\n      });\n    } catch (error) {\n      const errorMsg = error instanceof Error ? error.message : 'Unknown error';\n      throw new Error(`Failed to evaluate value_js: ${errorMsg}`);\n    }\n  }\n\n  // No full-script execution in memory provider. Use ScriptCheckProvider.\n\n  /**\n   * Build template context for Liquid and JS evaluation\n   */\n  private buildTemplateContext(\n    prInfo: PRInfo,\n    dependencyResults?: Map<string, ReviewSummary>,\n    memoryStore?: MemoryStore,\n    outputHistory?: Map<string, unknown[]>,\n    stageHistoryBase?: Record<string, number>,\n    args?: Record<string, unknown>\n  ): Record<string, unknown> {\n    const base = buildProviderTemplateContext(\n      prInfo,\n      dependencyResults,\n      memoryStore,\n      outputHistory as Map<string, unknown[]> | undefined,\n      stageHistoryBase,\n      { attachMemoryReadHelpers: true, args }\n    );\n    if (memoryStore) {\n      const { ops } = createSyncMemoryOps(memoryStore);\n      (base as any).memory = ops;\n    }\n    return base;\n  }\n\n  getSupportedConfigKeys(): string[] {\n    return [\n      'type',\n      'operation',\n      'key',\n      'value',\n      'value_js',\n      'transform',\n      'transform_js',\n      'namespace',\n      'depends_on',\n      'group',\n      'command',\n      'on',\n      'if',\n      'fail_if',\n      'on_fail',\n      'on_success',\n    ];\n  }\n\n  async isAvailable(): Promise<boolean> {\n    // Memory provider is always available\n    return true;\n  }\n\n  getRequirements(): string[] {\n    return [\n      'No external dependencies required',\n      'Used for state management and persistent storage across checks',\n    ];\n  }\n}\n","module.exports = {\n  kClose: Symbol('close'),\n  kDestroy: Symbol('destroy'),\n  kDispatch: Symbol('dispatch'),\n  kUrl: Symbol('url'),\n  kWriting: Symbol('writing'),\n  kResuming: Symbol('resuming'),\n  kQueue: Symbol('queue'),\n  kConnect: Symbol('connect'),\n  kConnecting: Symbol('connecting'),\n  kHeadersList: Symbol('headers list'),\n  kKeepAliveDefaultTimeout: Symbol('default keep alive timeout'),\n  kKeepAliveMaxTimeout: Symbol('max keep alive timeout'),\n  kKeepAliveTimeoutThreshold: Symbol('keep alive timeout threshold'),\n  kKeepAliveTimeoutValue: Symbol('keep alive timeout'),\n  kKeepAlive: Symbol('keep alive'),\n  kHeadersTimeout: Symbol('headers timeout'),\n  kBodyTimeout: Symbol('body timeout'),\n  kServerName: Symbol('server name'),\n  kLocalAddress: Symbol('local address'),\n  kHost: Symbol('host'),\n  kNoRef: Symbol('no ref'),\n  kBodyUsed: Symbol('used'),\n  kRunning: Symbol('running'),\n  kBlocking: Symbol('blocking'),\n  kPending: Symbol('pending'),\n  kSize: Symbol('size'),\n  kBusy: Symbol('busy'),\n  kQueued: Symbol('queued'),\n  kFree: Symbol('free'),\n  kConnected: Symbol('connected'),\n  kClosed: Symbol('closed'),\n  kNeedDrain: Symbol('need drain'),\n  kReset: Symbol('reset'),\n  kDestroyed: Symbol.for('nodejs.stream.destroyed'),\n  kMaxHeadersSize: Symbol('max headers size'),\n  kRunningIdx: Symbol('running index'),\n  kPendingIdx: Symbol('pending index'),\n  kError: Symbol('error'),\n  kClients: Symbol('clients'),\n  kClient: Symbol('client'),\n  kParser: Symbol('parser'),\n  kOnDestroyed: Symbol('destroy callbacks'),\n  kPipelining: Symbol('pipelining'),\n  kSocket: Symbol('socket'),\n  kHostHeader: Symbol('host header'),\n  kConnector: Symbol('connector'),\n  kStrictContentLength: Symbol('strict content length'),\n  kMaxRedirections: Symbol('maxRedirections'),\n  kMaxRequests: Symbol('maxRequestsPerClient'),\n  kProxy: Symbol('proxy agent options'),\n  kCounter: Symbol('socket request counter'),\n  kInterceptors: Symbol('dispatch interceptors'),\n  kMaxResponseSize: Symbol('max response size'),\n  kHTTP2Session: Symbol('http2Session'),\n  kHTTP2SessionState: Symbol('http2Session state'),\n  kHTTP2BuildRequest: Symbol('http2 build request'),\n  kHTTP1BuildRequest: Symbol('http1 build request'),\n  kHTTP2CopyHeaders: Symbol('http2 copy headers'),\n  kHTTPConnVersion: Symbol('http connection version'),\n  kRetryHandlerDefaultRetry: Symbol('retry agent default retry'),\n  kConstruct: Symbol('constructable')\n}\n","'use strict'\n\nclass UndiciError extends Error {\n  constructor (message) {\n    super(message)\n    this.name = 'UndiciError'\n    this.code = 'UND_ERR'\n  }\n}\n\nclass ConnectTimeoutError extends UndiciError {\n  constructor (message) {\n    super(message)\n    Error.captureStackTrace(this, ConnectTimeoutError)\n    this.name = 'ConnectTimeoutError'\n    this.message = message || 'Connect Timeout Error'\n    this.code = 'UND_ERR_CONNECT_TIMEOUT'\n  }\n}\n\nclass HeadersTimeoutError extends UndiciError {\n  constructor (message) {\n    super(message)\n    Error.captureStackTrace(this, HeadersTimeoutError)\n    this.name = 'HeadersTimeoutError'\n    this.message = message || 'Headers Timeout Error'\n    this.code = 'UND_ERR_HEADERS_TIMEOUT'\n  }\n}\n\nclass HeadersOverflowError extends UndiciError {\n  constructor (message) {\n    super(message)\n    Error.captureStackTrace(this, HeadersOverflowError)\n    this.name = 'HeadersOverflowError'\n    this.message = message || 'Headers Overflow Error'\n    this.code = 'UND_ERR_HEADERS_OVERFLOW'\n  }\n}\n\nclass BodyTimeoutError extends UndiciError {\n  constructor (message) {\n    super(message)\n    Error.captureStackTrace(this, BodyTimeoutError)\n    this.name = 'BodyTimeoutError'\n    this.message = message || 'Body Timeout Error'\n    this.code = 'UND_ERR_BODY_TIMEOUT'\n  }\n}\n\nclass ResponseStatusCodeError extends UndiciError {\n  constructor (message, statusCode, headers, body) {\n    super(message)\n    Error.captureStackTrace(this, ResponseStatusCodeError)\n    this.name = 'ResponseStatusCodeError'\n    this.message = message || 'Response Status Code Error'\n    this.code = 'UND_ERR_RESPONSE_STATUS_CODE'\n    this.body = body\n    this.status = statusCode\n    this.statusCode = statusCode\n    this.headers = headers\n  }\n}\n\nclass InvalidArgumentError extends UndiciError {\n  constructor (message) {\n    super(message)\n    Error.captureStackTrace(this, InvalidArgumentError)\n    this.name = 'InvalidArgumentError'\n    this.message = message || 'Invalid Argument Error'\n    this.code = 'UND_ERR_INVALID_ARG'\n  }\n}\n\nclass InvalidReturnValueError extends UndiciError {\n  constructor (message) {\n    super(message)\n    Error.captureStackTrace(this, InvalidReturnValueError)\n    this.name = 'InvalidReturnValueError'\n    this.message = message || 'Invalid Return Value Error'\n    this.code = 'UND_ERR_INVALID_RETURN_VALUE'\n  }\n}\n\nclass RequestAbortedError extends UndiciError {\n  constructor (message) {\n    super(message)\n    Error.captureStackTrace(this, RequestAbortedError)\n    this.name = 'AbortError'\n    this.message = message || 'Request aborted'\n    this.code = 'UND_ERR_ABORTED'\n  }\n}\n\nclass InformationalError extends UndiciError {\n  constructor (message) {\n    super(message)\n    Error.captureStackTrace(this, InformationalError)\n    this.name = 'InformationalError'\n    this.message = message || 'Request information'\n    this.code = 'UND_ERR_INFO'\n  }\n}\n\nclass RequestContentLengthMismatchError extends UndiciError {\n  constructor (message) {\n    super(message)\n    Error.captureStackTrace(this, RequestContentLengthMismatchError)\n    this.name = 'RequestContentLengthMismatchError'\n    this.message = message || 'Request body length does not match content-length header'\n    this.code = 'UND_ERR_REQ_CONTENT_LENGTH_MISMATCH'\n  }\n}\n\nclass ResponseContentLengthMismatchError extends UndiciError {\n  constructor (message) {\n    super(message)\n    Error.captureStackTrace(this, ResponseContentLengthMismatchError)\n    this.name = 'ResponseContentLengthMismatchError'\n    this.message = message || 'Response body length does not match content-length header'\n    this.code = 'UND_ERR_RES_CONTENT_LENGTH_MISMATCH'\n  }\n}\n\nclass ClientDestroyedError extends UndiciError {\n  constructor (message) {\n    super(message)\n    Error.captureStackTrace(this, ClientDestroyedError)\n    this.name = 'ClientDestroyedError'\n    this.message = message || 'The client is destroyed'\n    this.code = 'UND_ERR_DESTROYED'\n  }\n}\n\nclass ClientClosedError extends UndiciError {\n  constructor (message) {\n    super(message)\n    Error.captureStackTrace(this, ClientClosedError)\n    this.name = 'ClientClosedError'\n    this.message = message || 'The client is closed'\n    this.code = 'UND_ERR_CLOSED'\n  }\n}\n\nclass SocketError extends UndiciError {\n  constructor (message, socket) {\n    super(message)\n    Error.captureStackTrace(this, SocketError)\n    this.name = 'SocketError'\n    this.message = message || 'Socket error'\n    this.code = 'UND_ERR_SOCKET'\n    this.socket = socket\n  }\n}\n\nclass NotSupportedError extends UndiciError {\n  constructor (message) {\n    super(message)\n    Error.captureStackTrace(this, NotSupportedError)\n    this.name = 'NotSupportedError'\n    this.message = message || 'Not supported error'\n    this.code = 'UND_ERR_NOT_SUPPORTED'\n  }\n}\n\nclass BalancedPoolMissingUpstreamError extends UndiciError {\n  constructor (message) {\n    super(message)\n    Error.captureStackTrace(this, NotSupportedError)\n    this.name = 'MissingUpstreamError'\n    this.message = message || 'No upstream has been added to the BalancedPool'\n    this.code = 'UND_ERR_BPL_MISSING_UPSTREAM'\n  }\n}\n\nclass HTTPParserError extends Error {\n  constructor (message, code, data) {\n    super(message)\n    Error.captureStackTrace(this, HTTPParserError)\n    this.name = 'HTTPParserError'\n    this.code = code ? `HPE_${code}` : undefined\n    this.data = data ? data.toString() : undefined\n  }\n}\n\nclass ResponseExceededMaxSizeError extends UndiciError {\n  constructor (message) {\n    super(message)\n    Error.captureStackTrace(this, ResponseExceededMaxSizeError)\n    this.name = 'ResponseExceededMaxSizeError'\n    this.message = message || 'Response content exceeded max size'\n    this.code = 'UND_ERR_RES_EXCEEDED_MAX_SIZE'\n  }\n}\n\nclass RequestRetryError extends UndiciError {\n  constructor (message, code, { headers, data }) {\n    super(message)\n    Error.captureStackTrace(this, RequestRetryError)\n    this.name = 'RequestRetryError'\n    this.message = message || 'Request retry error'\n    this.code = 'UND_ERR_REQ_RETRY'\n    this.statusCode = code\n    this.data = data\n    this.headers = headers\n  }\n}\n\nmodule.exports = {\n  HTTPParserError,\n  UndiciError,\n  HeadersTimeoutError,\n  HeadersOverflowError,\n  BodyTimeoutError,\n  RequestContentLengthMismatchError,\n  ConnectTimeoutError,\n  ResponseStatusCodeError,\n  InvalidArgumentError,\n  InvalidReturnValueError,\n  RequestAbortedError,\n  ClientDestroyedError,\n  ClientClosedError,\n  InformationalError,\n  SocketError,\n  NotSupportedError,\n  ResponseContentLengthMismatchError,\n  BalancedPoolMissingUpstreamError,\n  ResponseExceededMaxSizeError,\n  RequestRetryError\n}\n","'use strict'\n\n/** @type {Record<string, string | undefined>} */\nconst headerNameLowerCasedRecord = {}\n\n// https://developer.mozilla.org/docs/Web/HTTP/Headers\nconst wellknownHeaderNames = [\n  'Accept',\n  'Accept-Encoding',\n  'Accept-Language',\n  'Accept-Ranges',\n  'Access-Control-Allow-Credentials',\n  'Access-Control-Allow-Headers',\n  'Access-Control-Allow-Methods',\n  'Access-Control-Allow-Origin',\n  'Access-Control-Expose-Headers',\n  'Access-Control-Max-Age',\n  'Access-Control-Request-Headers',\n  'Access-Control-Request-Method',\n  'Age',\n  'Allow',\n  'Alt-Svc',\n  'Alt-Used',\n  'Authorization',\n  'Cache-Control',\n  'Clear-Site-Data',\n  'Connection',\n  'Content-Disposition',\n  'Content-Encoding',\n  'Content-Language',\n  'Content-Length',\n  'Content-Location',\n  'Content-Range',\n  'Content-Security-Policy',\n  'Content-Security-Policy-Report-Only',\n  'Content-Type',\n  'Cookie',\n  'Cross-Origin-Embedder-Policy',\n  'Cross-Origin-Opener-Policy',\n  'Cross-Origin-Resource-Policy',\n  'Date',\n  'Device-Memory',\n  'Downlink',\n  'ECT',\n  'ETag',\n  'Expect',\n  'Expect-CT',\n  'Expires',\n  'Forwarded',\n  'From',\n  'Host',\n  'If-Match',\n  'If-Modified-Since',\n  'If-None-Match',\n  'If-Range',\n  'If-Unmodified-Since',\n  'Keep-Alive',\n  'Last-Modified',\n  'Link',\n  'Location',\n  'Max-Forwards',\n  'Origin',\n  'Permissions-Policy',\n  'Pragma',\n  'Proxy-Authenticate',\n  'Proxy-Authorization',\n  'RTT',\n  'Range',\n  'Referer',\n  'Referrer-Policy',\n  'Refresh',\n  'Retry-After',\n  'Sec-WebSocket-Accept',\n  'Sec-WebSocket-Extensions',\n  'Sec-WebSocket-Key',\n  'Sec-WebSocket-Protocol',\n  'Sec-WebSocket-Version',\n  'Server',\n  'Server-Timing',\n  'Service-Worker-Allowed',\n  'Service-Worker-Navigation-Preload',\n  'Set-Cookie',\n  'SourceMap',\n  'Strict-Transport-Security',\n  'Supports-Loading-Mode',\n  'TE',\n  'Timing-Allow-Origin',\n  'Trailer',\n  'Transfer-Encoding',\n  'Upgrade',\n  'Upgrade-Insecure-Requests',\n  'User-Agent',\n  'Vary',\n  'Via',\n  'WWW-Authenticate',\n  'X-Content-Type-Options',\n  'X-DNS-Prefetch-Control',\n  'X-Frame-Options',\n  'X-Permitted-Cross-Domain-Policies',\n  'X-Powered-By',\n  'X-Requested-With',\n  'X-XSS-Protection'\n]\n\nfor (let i = 0; i < wellknownHeaderNames.length; ++i) {\n  const key = wellknownHeaderNames[i]\n  const lowerCasedKey = key.toLowerCase()\n  headerNameLowerCasedRecord[key] = headerNameLowerCasedRecord[lowerCasedKey] =\n    lowerCasedKey\n}\n\n// Note: object prototypes should not be able to be referenced. e.g. `Object#hasOwnProperty`.\nObject.setPrototypeOf(headerNameLowerCasedRecord, null)\n\nmodule.exports = {\n  wellknownHeaderNames,\n  headerNameLowerCasedRecord\n}\n","'use strict'\n\nconst assert = require('assert')\nconst { kDestroyed, kBodyUsed } = require('./symbols')\nconst { IncomingMessage } = require('http')\nconst stream = require('stream')\nconst net = require('net')\nconst { InvalidArgumentError } = require('./errors')\nconst { Blob } = require('buffer')\nconst nodeUtil = require('util')\nconst { stringify } = require('querystring')\nconst { headerNameLowerCasedRecord } = require('./constants')\n\nconst [nodeMajor, nodeMinor] = process.versions.node.split('.').map(v => Number(v))\n\nfunction nop () {}\n\nfunction isStream (obj) {\n  return obj && typeof obj === 'object' && typeof obj.pipe === 'function' && typeof obj.on === 'function'\n}\n\n// based on https://github.com/node-fetch/fetch-blob/blob/8ab587d34080de94140b54f07168451e7d0b655e/index.js#L229-L241 (MIT License)\nfunction isBlobLike (object) {\n  return (Blob && object instanceof Blob) || (\n    object &&\n    typeof object === 'object' &&\n    (typeof object.stream === 'function' ||\n      typeof object.arrayBuffer === 'function') &&\n    /^(Blob|File)$/.test(object[Symbol.toStringTag])\n  )\n}\n\nfunction buildURL (url, queryParams) {\n  if (url.includes('?') || url.includes('#')) {\n    throw new Error('Query params cannot be passed when url already contains \"?\" or \"#\".')\n  }\n\n  const stringified = stringify(queryParams)\n\n  if (stringified) {\n    url += '?' + stringified\n  }\n\n  return url\n}\n\nfunction parseURL (url) {\n  if (typeof url === 'string') {\n    url = new URL(url)\n\n    if (!/^https?:/.test(url.origin || url.protocol)) {\n      throw new InvalidArgumentError('Invalid URL protocol: the URL must start with `http:` or `https:`.')\n    }\n\n    return url\n  }\n\n  if (!url || typeof url !== 'object') {\n    throw new InvalidArgumentError('Invalid URL: The URL argument must be a non-null object.')\n  }\n\n  if (!/^https?:/.test(url.origin || url.protocol)) {\n    throw new InvalidArgumentError('Invalid URL protocol: the URL must start with `http:` or `https:`.')\n  }\n\n  if (!(url instanceof URL)) {\n    if (url.port != null && url.port !== '' && !Number.isFinite(parseInt(url.port))) {\n      throw new InvalidArgumentError('Invalid URL: port must be a valid integer or a string representation of an integer.')\n    }\n\n    if (url.path != null && typeof url.path !== 'string') {\n      throw new InvalidArgumentError('Invalid URL path: the path must be a string or null/undefined.')\n    }\n\n    if (url.pathname != null && typeof url.pathname !== 'string') {\n      throw new InvalidArgumentError('Invalid URL pathname: the pathname must be a string or null/undefined.')\n    }\n\n    if (url.hostname != null && typeof url.hostname !== 'string') {\n      throw new InvalidArgumentError('Invalid URL hostname: the hostname must be a string or null/undefined.')\n    }\n\n    if (url.origin != null && typeof url.origin !== 'string') {\n      throw new InvalidArgumentError('Invalid URL origin: the origin must be a string or null/undefined.')\n    }\n\n    const port = url.port != null\n      ? url.port\n      : (url.protocol === 'https:' ? 443 : 80)\n    let origin = url.origin != null\n      ? url.origin\n      : `${url.protocol}//${url.hostname}:${port}`\n    let path = url.path != null\n      ? url.path\n      : `${url.pathname || ''}${url.search || ''}`\n\n    if (origin.endsWith('/')) {\n      origin = origin.substring(0, origin.length - 1)\n    }\n\n    if (path && !path.startsWith('/')) {\n      path = `/${path}`\n    }\n    // new URL(path, origin) is unsafe when `path` contains an absolute URL\n    // From https://developer.mozilla.org/en-US/docs/Web/API/URL/URL:\n    // If first parameter is a relative URL, second param is required, and will be used as the base URL.\n    // If first parameter is an absolute URL, a given second param will be ignored.\n    url = new URL(origin + path)\n  }\n\n  return url\n}\n\nfunction parseOrigin (url) {\n  url = parseURL(url)\n\n  if (url.pathname !== '/' || url.search || url.hash) {\n    throw new InvalidArgumentError('invalid url')\n  }\n\n  return url\n}\n\nfunction getHostname (host) {\n  if (host[0] === '[') {\n    const idx = host.indexOf(']')\n\n    assert(idx !== -1)\n    return host.substring(1, idx)\n  }\n\n  const idx = host.indexOf(':')\n  if (idx === -1) return host\n\n  return host.substring(0, idx)\n}\n\n// IP addresses are not valid server names per RFC6066\n// > Currently, the only server names supported are DNS hostnames\nfunction getServerName (host) {\n  if (!host) {\n    return null\n  }\n\n  assert.strictEqual(typeof host, 'string')\n\n  const servername = getHostname(host)\n  if (net.isIP(servername)) {\n    return ''\n  }\n\n  return servername\n}\n\nfunction deepClone (obj) {\n  return JSON.parse(JSON.stringify(obj))\n}\n\nfunction isAsyncIterable (obj) {\n  return !!(obj != null && typeof obj[Symbol.asyncIterator] === 'function')\n}\n\nfunction isIterable (obj) {\n  return !!(obj != null && (typeof obj[Symbol.iterator] === 'function' || typeof obj[Symbol.asyncIterator] === 'function'))\n}\n\nfunction bodyLength (body) {\n  if (body == null) {\n    return 0\n  } else if (isStream(body)) {\n    const state = body._readableState\n    return state && state.objectMode === false && state.ended === true && Number.isFinite(state.length)\n      ? state.length\n      : null\n  } else if (isBlobLike(body)) {\n    return body.size != null ? body.size : null\n  } else if (isBuffer(body)) {\n    return body.byteLength\n  }\n\n  return null\n}\n\nfunction isDestroyed (stream) {\n  return !stream || !!(stream.destroyed || stream[kDestroyed])\n}\n\nfunction isReadableAborted (stream) {\n  const state = stream && stream._readableState\n  return isDestroyed(stream) && state && !state.endEmitted\n}\n\nfunction destroy (stream, err) {\n  if (stream == null || !isStream(stream) || isDestroyed(stream)) {\n    return\n  }\n\n  if (typeof stream.destroy === 'function') {\n    if (Object.getPrototypeOf(stream).constructor === IncomingMessage) {\n      // See: https://github.com/nodejs/node/pull/38505/files\n      stream.socket = null\n    }\n\n    stream.destroy(err)\n  } else if (err) {\n    process.nextTick((stream, err) => {\n      stream.emit('error', err)\n    }, stream, err)\n  }\n\n  if (stream.destroyed !== true) {\n    stream[kDestroyed] = true\n  }\n}\n\nconst KEEPALIVE_TIMEOUT_EXPR = /timeout=(\\d+)/\nfunction parseKeepAliveTimeout (val) {\n  const m = val.toString().match(KEEPALIVE_TIMEOUT_EXPR)\n  return m ? parseInt(m[1], 10) * 1000 : null\n}\n\n/**\n * Retrieves a header name and returns its lowercase value.\n * @param {string | Buffer} value Header name\n * @returns {string}\n */\nfunction headerNameToString (value) {\n  return headerNameLowerCasedRecord[value] || value.toLowerCase()\n}\n\nfunction parseHeaders (headers, obj = {}) {\n  // For H2 support\n  if (!Array.isArray(headers)) return headers\n\n  for (let i = 0; i < headers.length; i += 2) {\n    const key = headers[i].toString().toLowerCase()\n    let val = obj[key]\n\n    if (!val) {\n      if (Array.isArray(headers[i + 1])) {\n        obj[key] = headers[i + 1].map(x => x.toString('utf8'))\n      } else {\n        obj[key] = headers[i + 1].toString('utf8')\n      }\n    } else {\n      if (!Array.isArray(val)) {\n        val = [val]\n        obj[key] = val\n      }\n      val.push(headers[i + 1].toString('utf8'))\n    }\n  }\n\n  // See https://github.com/nodejs/node/pull/46528\n  if ('content-length' in obj && 'content-disposition' in obj) {\n    obj['content-disposition'] = Buffer.from(obj['content-disposition']).toString('latin1')\n  }\n\n  return obj\n}\n\nfunction parseRawHeaders (headers) {\n  const ret = []\n  let hasContentLength = false\n  let contentDispositionIdx = -1\n\n  for (let n = 0; n < headers.length; n += 2) {\n    const key = headers[n + 0].toString()\n    const val = headers[n + 1].toString('utf8')\n\n    if (key.length === 14 && (key === 'content-length' || key.toLowerCase() === 'content-length')) {\n      ret.push(key, val)\n      hasContentLength = true\n    } else if (key.length === 19 && (key === 'content-disposition' || key.toLowerCase() === 'content-disposition')) {\n      contentDispositionIdx = ret.push(key, val) - 1\n    } else {\n      ret.push(key, val)\n    }\n  }\n\n  // See https://github.com/nodejs/node/pull/46528\n  if (hasContentLength && contentDispositionIdx !== -1) {\n    ret[contentDispositionIdx] = Buffer.from(ret[contentDispositionIdx]).toString('latin1')\n  }\n\n  return ret\n}\n\nfunction isBuffer (buffer) {\n  // See, https://github.com/mcollina/undici/pull/319\n  return buffer instanceof Uint8Array || Buffer.isBuffer(buffer)\n}\n\nfunction validateHandler (handler, method, upgrade) {\n  if (!handler || typeof handler !== 'object') {\n    throw new InvalidArgumentError('handler must be an object')\n  }\n\n  if (typeof handler.onConnect !== 'function') {\n    throw new InvalidArgumentError('invalid onConnect method')\n  }\n\n  if (typeof handler.onError !== 'function') {\n    throw new InvalidArgumentError('invalid onError method')\n  }\n\n  if (typeof handler.onBodySent !== 'function' && handler.onBodySent !== undefined) {\n    throw new InvalidArgumentError('invalid onBodySent method')\n  }\n\n  if (upgrade || method === 'CONNECT') {\n    if (typeof handler.onUpgrade !== 'function') {\n      throw new InvalidArgumentError('invalid onUpgrade method')\n    }\n  } else {\n    if (typeof handler.onHeaders !== 'function') {\n      throw new InvalidArgumentError('invalid onHeaders method')\n    }\n\n    if (typeof handler.onData !== 'function') {\n      throw new InvalidArgumentError('invalid onData method')\n    }\n\n    if (typeof handler.onComplete !== 'function') {\n      throw new InvalidArgumentError('invalid onComplete method')\n    }\n  }\n}\n\n// A body is disturbed if it has been read from and it cannot\n// be re-used without losing state or data.\nfunction isDisturbed (body) {\n  return !!(body && (\n    stream.isDisturbed\n      ? stream.isDisturbed(body) || body[kBodyUsed] // TODO (fix): Why is body[kBodyUsed] needed?\n      : body[kBodyUsed] ||\n        body.readableDidRead ||\n        (body._readableState && body._readableState.dataEmitted) ||\n        isReadableAborted(body)\n  ))\n}\n\nfunction isErrored (body) {\n  return !!(body && (\n    stream.isErrored\n      ? stream.isErrored(body)\n      : /state: 'errored'/.test(nodeUtil.inspect(body)\n      )))\n}\n\nfunction isReadable (body) {\n  return !!(body && (\n    stream.isReadable\n      ? stream.isReadable(body)\n      : /state: 'readable'/.test(nodeUtil.inspect(body)\n      )))\n}\n\nfunction getSocketInfo (socket) {\n  return {\n    localAddress: socket.localAddress,\n    localPort: socket.localPort,\n    remoteAddress: socket.remoteAddress,\n    remotePort: socket.remotePort,\n    remoteFamily: socket.remoteFamily,\n    timeout: socket.timeout,\n    bytesWritten: socket.bytesWritten,\n    bytesRead: socket.bytesRead\n  }\n}\n\nasync function * convertIterableToBuffer (iterable) {\n  for await (const chunk of iterable) {\n    yield Buffer.isBuffer(chunk) ? chunk : Buffer.from(chunk)\n  }\n}\n\nlet ReadableStream\nfunction ReadableStreamFrom (iterable) {\n  if (!ReadableStream) {\n    ReadableStream = require('stream/web').ReadableStream\n  }\n\n  if (ReadableStream.from) {\n    return ReadableStream.from(convertIterableToBuffer(iterable))\n  }\n\n  let iterator\n  return new ReadableStream(\n    {\n      async start () {\n        iterator = iterable[Symbol.asyncIterator]()\n      },\n      async pull (controller) {\n        const { done, value } = await iterator.next()\n        if (done) {\n          queueMicrotask(() => {\n            controller.close()\n          })\n        } else {\n          const buf = Buffer.isBuffer(value) ? value : Buffer.from(value)\n          controller.enqueue(new Uint8Array(buf))\n        }\n        return controller.desiredSize > 0\n      },\n      async cancel (reason) {\n        await iterator.return()\n      }\n    },\n    0\n  )\n}\n\n// The chunk should be a FormData instance and contains\n// all the required methods.\nfunction isFormDataLike (object) {\n  return (\n    object &&\n    typeof object === 'object' &&\n    typeof object.append === 'function' &&\n    typeof object.delete === 'function' &&\n    typeof object.get === 'function' &&\n    typeof object.getAll === 'function' &&\n    typeof object.has === 'function' &&\n    typeof object.set === 'function' &&\n    object[Symbol.toStringTag] === 'FormData'\n  )\n}\n\nfunction throwIfAborted (signal) {\n  if (!signal) { return }\n  if (typeof signal.throwIfAborted === 'function') {\n    signal.throwIfAborted()\n  } else {\n    if (signal.aborted) {\n      // DOMException not available < v17.0.0\n      const err = new Error('The operation was aborted')\n      err.name = 'AbortError'\n      throw err\n    }\n  }\n}\n\nfunction addAbortListener (signal, listener) {\n  if ('addEventListener' in signal) {\n    signal.addEventListener('abort', listener, { once: true })\n    return () => signal.removeEventListener('abort', listener)\n  }\n  signal.addListener('abort', listener)\n  return () => signal.removeListener('abort', listener)\n}\n\nconst hasToWellFormed = !!String.prototype.toWellFormed\n\n/**\n * @param {string} val\n */\nfunction toUSVString (val) {\n  if (hasToWellFormed) {\n    return `${val}`.toWellFormed()\n  } else if (nodeUtil.toUSVString) {\n    return nodeUtil.toUSVString(val)\n  }\n\n  return `${val}`\n}\n\n// Parsed accordingly to RFC 9110\n// https://www.rfc-editor.org/rfc/rfc9110#field.content-range\nfunction parseRangeHeader (range) {\n  if (range == null || range === '') return { start: 0, end: null, size: null }\n\n  const m = range ? range.match(/^bytes (\\d+)-(\\d+)\\/(\\d+)?$/) : null\n  return m\n    ? {\n        start: parseInt(m[1]),\n        end: m[2] ? parseInt(m[2]) : null,\n        size: m[3] ? parseInt(m[3]) : null\n      }\n    : null\n}\n\nconst kEnumerableProperty = Object.create(null)\nkEnumerableProperty.enumerable = true\n\nmodule.exports = {\n  kEnumerableProperty,\n  nop,\n  isDisturbed,\n  isErrored,\n  isReadable,\n  toUSVString,\n  isReadableAborted,\n  isBlobLike,\n  parseOrigin,\n  parseURL,\n  getServerName,\n  isStream,\n  isIterable,\n  isAsyncIterable,\n  isDestroyed,\n  headerNameToString,\n  parseRawHeaders,\n  parseHeaders,\n  parseKeepAliveTimeout,\n  destroy,\n  bodyLength,\n  deepClone,\n  ReadableStreamFrom,\n  isBuffer,\n  validateHandler,\n  getSocketInfo,\n  isFormDataLike,\n  buildURL,\n  throwIfAborted,\n  addAbortListener,\n  parseRangeHeader,\n  nodeMajor,\n  nodeMinor,\n  nodeHasAutoSelectFamily: nodeMajor > 18 || (nodeMajor === 18 && nodeMinor >= 13),\n  safeHTTPMethods: ['GET', 'HEAD', 'OPTIONS', 'TRACE']\n}\n","'use strict'\n\nlet fastNow = Date.now()\nlet fastNowTimeout\n\nconst fastTimers = []\n\nfunction onTimeout () {\n  fastNow = Date.now()\n\n  let len = fastTimers.length\n  let idx = 0\n  while (idx < len) {\n    const timer = fastTimers[idx]\n\n    if (timer.state === 0) {\n      timer.state = fastNow + timer.delay\n    } else if (timer.state > 0 && fastNow >= timer.state) {\n      timer.state = -1\n      timer.callback(timer.opaque)\n    }\n\n    if (timer.state === -1) {\n      timer.state = -2\n      if (idx !== len - 1) {\n        fastTimers[idx] = fastTimers.pop()\n      } else {\n        fastTimers.pop()\n      }\n      len -= 1\n    } else {\n      idx += 1\n    }\n  }\n\n  if (fastTimers.length > 0) {\n    refreshTimeout()\n  }\n}\n\nfunction refreshTimeout () {\n  if (fastNowTimeout && fastNowTimeout.refresh) {\n    fastNowTimeout.refresh()\n  } else {\n    clearTimeout(fastNowTimeout)\n    fastNowTimeout = setTimeout(onTimeout, 1e3)\n    if (fastNowTimeout.unref) {\n      fastNowTimeout.unref()\n    }\n  }\n}\n\nclass Timeout {\n  constructor (callback, delay, opaque) {\n    this.callback = callback\n    this.delay = delay\n    this.opaque = opaque\n\n    //  -2 not in timer list\n    //  -1 in timer list but inactive\n    //   0 in timer list waiting for time\n    // > 0 in timer list waiting for time to expire\n    this.state = -2\n\n    this.refresh()\n  }\n\n  refresh () {\n    if (this.state === -2) {\n      fastTimers.push(this)\n      if (!fastNowTimeout || fastTimers.length === 1) {\n        refreshTimeout()\n      }\n    }\n\n    this.state = 0\n  }\n\n  clear () {\n    this.state = -1\n  }\n}\n\nmodule.exports = {\n  setTimeout (callback, delay, opaque) {\n    return delay < 1e3\n      ? setTimeout(callback, delay, opaque)\n      : new Timeout(callback, delay, opaque)\n  },\n  clearTimeout (timeout) {\n    if (timeout instanceof Timeout) {\n      timeout.clear()\n    } else {\n      clearTimeout(timeout)\n    }\n  }\n}\n","'use strict'\n\n/**\n * Copyright Brian White. All rights reserved.\n *\n * @see https://github.com/mscdex/streamsearch\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to\n * deal in the Software without restriction, including without limitation the\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n * sell copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n *\n * Based heavily on the Streaming Boyer-Moore-Horspool C++ implementation\n * by Hongli Lai at: https://github.com/FooBarWidget/boyer-moore-horspool\n */\nconst EventEmitter = require('node:events').EventEmitter\nconst inherits = require('node:util').inherits\n\nfunction SBMH (needle) {\n  if (typeof needle === 'string') {\n    needle = Buffer.from(needle)\n  }\n\n  if (!Buffer.isBuffer(needle)) {\n    throw new TypeError('The needle has to be a String or a Buffer.')\n  }\n\n  const needleLength = needle.length\n\n  if (needleLength === 0) {\n    throw new Error('The needle cannot be an empty String/Buffer.')\n  }\n\n  if (needleLength > 256) {\n    throw new Error('The needle cannot have a length bigger than 256.')\n  }\n\n  this.maxMatches = Infinity\n  this.matches = 0\n\n  this._occ = new Array(256)\n    .fill(needleLength) // Initialize occurrence table.\n  this._lookbehind_size = 0\n  this._needle = needle\n  this._bufpos = 0\n\n  this._lookbehind = Buffer.alloc(needleLength)\n\n  // Populate occurrence table with analysis of the needle,\n  // ignoring last letter.\n  for (var i = 0; i < needleLength - 1; ++i) { // eslint-disable-line no-var\n    this._occ[needle[i]] = needleLength - 1 - i\n  }\n}\ninherits(SBMH, EventEmitter)\n\nSBMH.prototype.reset = function () {\n  this._lookbehind_size = 0\n  this.matches = 0\n  this._bufpos = 0\n}\n\nSBMH.prototype.push = function (chunk, pos) {\n  if (!Buffer.isBuffer(chunk)) {\n    chunk = Buffer.from(chunk, 'binary')\n  }\n  const chlen = chunk.length\n  this._bufpos = pos || 0\n  let r\n  while (r !== chlen && this.matches < this.maxMatches) { r = this._sbmh_feed(chunk) }\n  return r\n}\n\nSBMH.prototype._sbmh_feed = function (data) {\n  const len = data.length\n  const needle = this._needle\n  const needleLength = needle.length\n  const lastNeedleChar = needle[needleLength - 1]\n\n  // Positive: points to a position in `data`\n  //           pos == 3 points to data[3]\n  // Negative: points to a position in the lookbehind buffer\n  //           pos == -2 points to lookbehind[lookbehind_size - 2]\n  let pos = -this._lookbehind_size\n  let ch\n\n  if (pos < 0) {\n    // Lookbehind buffer is not empty. Perform Boyer-Moore-Horspool\n    // search with character lookup code that considers both the\n    // lookbehind buffer and the current round's haystack data.\n    //\n    // Loop until\n    //   there is a match.\n    // or until\n    //   we've moved past the position that requires the\n    //   lookbehind buffer. In this case we switch to the\n    //   optimized loop.\n    // or until\n    //   the character to look at lies outside the haystack.\n    while (pos < 0 && pos <= len - needleLength) {\n      ch = this._sbmh_lookup_char(data, pos + needleLength - 1)\n\n      if (\n        ch === lastNeedleChar &&\n        this._sbmh_memcmp(data, pos, needleLength - 1)\n      ) {\n        this._lookbehind_size = 0\n        ++this.matches\n        this.emit('info', true)\n\n        return (this._bufpos = pos + needleLength)\n      }\n      pos += this._occ[ch]\n    }\n\n    // No match.\n\n    if (pos < 0) {\n      // There's too few data for Boyer-Moore-Horspool to run,\n      // so let's use a different algorithm to skip as much as\n      // we can.\n      // Forward pos until\n      //   the trailing part of lookbehind + data\n      //   looks like the beginning of the needle\n      // or until\n      //   pos == 0\n      while (pos < 0 && !this._sbmh_memcmp(data, pos, len - pos)) { ++pos }\n    }\n\n    if (pos >= 0) {\n      // Discard lookbehind buffer.\n      this.emit('info', false, this._lookbehind, 0, this._lookbehind_size)\n      this._lookbehind_size = 0\n    } else {\n      // Cut off part of the lookbehind buffer that has\n      // been processed and append the entire haystack\n      // into it.\n      const bytesToCutOff = this._lookbehind_size + pos\n      if (bytesToCutOff > 0) {\n        // The cut off data is guaranteed not to contain the needle.\n        this.emit('info', false, this._lookbehind, 0, bytesToCutOff)\n      }\n\n      this._lookbehind.copy(this._lookbehind, 0, bytesToCutOff,\n        this._lookbehind_size - bytesToCutOff)\n      this._lookbehind_size -= bytesToCutOff\n\n      data.copy(this._lookbehind, this._lookbehind_size)\n      this._lookbehind_size += len\n\n      this._bufpos = len\n      return len\n    }\n  }\n\n  pos += (pos >= 0) * this._bufpos\n\n  // Lookbehind buffer is now empty. We only need to check if the\n  // needle is in the haystack.\n  if (data.indexOf(needle, pos) !== -1) {\n    pos = data.indexOf(needle, pos)\n    ++this.matches\n    if (pos > 0) { this.emit('info', true, data, this._bufpos, pos) } else { this.emit('info', true) }\n\n    return (this._bufpos = pos + needleLength)\n  } else {\n    pos = len - needleLength\n  }\n\n  // There was no match. If there's trailing haystack data that we cannot\n  // match yet using the Boyer-Moore-Horspool algorithm (because the trailing\n  // data is less than the needle size) then match using a modified\n  // algorithm that starts matching from the beginning instead of the end.\n  // Whatever trailing data is left after running this algorithm is added to\n  // the lookbehind buffer.\n  while (\n    pos < len &&\n    (\n      data[pos] !== needle[0] ||\n      (\n        (Buffer.compare(\n          data.subarray(pos, pos + len - pos),\n          needle.subarray(0, len - pos)\n        ) !== 0)\n      )\n    )\n  ) {\n    ++pos\n  }\n  if (pos < len) {\n    data.copy(this._lookbehind, 0, pos, pos + (len - pos))\n    this._lookbehind_size = len - pos\n  }\n\n  // Everything until pos is guaranteed not to contain needle data.\n  if (pos > 0) { this.emit('info', false, data, this._bufpos, pos < len ? pos : len) }\n\n  this._bufpos = len\n  return len\n}\n\nSBMH.prototype._sbmh_lookup_char = function (data, pos) {\n  return (pos < 0)\n    ? this._lookbehind[this._lookbehind_size + pos]\n    : data[pos]\n}\n\nSBMH.prototype._sbmh_memcmp = function (data, pos, len) {\n  for (var i = 0; i < len; ++i) { // eslint-disable-line no-var\n    if (this._sbmh_lookup_char(data, pos + i) !== this._needle[i]) { return false }\n  }\n  return true\n}\n\nmodule.exports = SBMH\n","'use strict'\n\nconst inherits = require('node:util').inherits\nconst ReadableStream = require('node:stream').Readable\n\nfunction PartStream (opts) {\n  ReadableStream.call(this, opts)\n}\ninherits(PartStream, ReadableStream)\n\nPartStream.prototype._read = function (n) {}\n\nmodule.exports = PartStream\n","'use strict'\n\nmodule.exports = function getLimit (limits, name, defaultLimit) {\n  if (\n    !limits ||\n    limits[name] === undefined ||\n    limits[name] === null\n  ) { return defaultLimit }\n\n  if (\n    typeof limits[name] !== 'number' ||\n    isNaN(limits[name])\n  ) { throw new TypeError('Limit ' + name + ' is not a valid number') }\n\n  return limits[name]\n}\n","'use strict'\n\nconst EventEmitter = require('node:events').EventEmitter\nconst inherits = require('node:util').inherits\nconst getLimit = require('../../../lib/utils/getLimit')\n\nconst StreamSearch = require('../../streamsearch/sbmh')\n\nconst B_DCRLF = Buffer.from('\\r\\n\\r\\n')\nconst RE_CRLF = /\\r\\n/g\nconst RE_HDR = /^([^:]+):[ \\t]?([\\x00-\\xFF]+)?$/ // eslint-disable-line no-control-regex\n\nfunction HeaderParser (cfg) {\n  EventEmitter.call(this)\n\n  cfg = cfg || {}\n  const self = this\n  this.nread = 0\n  this.maxed = false\n  this.npairs = 0\n  this.maxHeaderPairs = getLimit(cfg, 'maxHeaderPairs', 2000)\n  this.maxHeaderSize = getLimit(cfg, 'maxHeaderSize', 80 * 1024)\n  this.buffer = ''\n  this.header = {}\n  this.finished = false\n  this.ss = new StreamSearch(B_DCRLF)\n  this.ss.on('info', function (isMatch, data, start, end) {\n    if (data && !self.maxed) {\n      if (self.nread + end - start >= self.maxHeaderSize) {\n        end = self.maxHeaderSize - self.nread + start\n        self.nread = self.maxHeaderSize\n        self.maxed = true\n      } else { self.nread += (end - start) }\n\n      self.buffer += data.toString('binary', start, end)\n    }\n    if (isMatch) { self._finish() }\n  })\n}\ninherits(HeaderParser, EventEmitter)\n\nHeaderParser.prototype.push = function (data) {\n  const r = this.ss.push(data)\n  if (this.finished) { return r }\n}\n\nHeaderParser.prototype.reset = function () {\n  this.finished = false\n  this.buffer = ''\n  this.header = {}\n  this.ss.reset()\n}\n\nHeaderParser.prototype._finish = function () {\n  if (this.buffer) { this._parseHeader() }\n  this.ss.matches = this.ss.maxMatches\n  const header = this.header\n  this.header = {}\n  this.buffer = ''\n  this.finished = true\n  this.nread = this.npairs = 0\n  this.maxed = false\n  this.emit('header', header)\n}\n\nHeaderParser.prototype._parseHeader = function () {\n  if (this.npairs === this.maxHeaderPairs) { return }\n\n  const lines = this.buffer.split(RE_CRLF)\n  const len = lines.length\n  let m, h\n\n  for (var i = 0; i < len; ++i) { // eslint-disable-line no-var\n    if (lines[i].length === 0) { continue }\n    if (lines[i][0] === '\\t' || lines[i][0] === ' ') {\n      // folded header content\n      // RFC2822 says to just remove the CRLF and not the whitespace following\n      // it, so we follow the RFC and include the leading whitespace ...\n      if (h) {\n        this.header[h][this.header[h].length - 1] += lines[i]\n        continue\n      }\n    }\n\n    const posColon = lines[i].indexOf(':')\n    if (\n      posColon === -1 ||\n      posColon === 0\n    ) {\n      return\n    }\n    m = RE_HDR.exec(lines[i])\n    h = m[1].toLowerCase()\n    this.header[h] = this.header[h] || []\n    this.header[h].push((m[2] || ''))\n    if (++this.npairs === this.maxHeaderPairs) { break }\n  }\n}\n\nmodule.exports = HeaderParser\n","'use strict'\n\nconst WritableStream = require('node:stream').Writable\nconst inherits = require('node:util').inherits\n\nconst StreamSearch = require('../../streamsearch/sbmh')\n\nconst PartStream = require('./PartStream')\nconst HeaderParser = require('./HeaderParser')\n\nconst DASH = 45\nconst B_ONEDASH = Buffer.from('-')\nconst B_CRLF = Buffer.from('\\r\\n')\nconst EMPTY_FN = function () {}\n\nfunction Dicer (cfg) {\n  if (!(this instanceof Dicer)) { return new Dicer(cfg) }\n  WritableStream.call(this, cfg)\n\n  if (!cfg || (!cfg.headerFirst && typeof cfg.boundary !== 'string')) { throw new TypeError('Boundary required') }\n\n  if (typeof cfg.boundary === 'string') { this.setBoundary(cfg.boundary) } else { this._bparser = undefined }\n\n  this._headerFirst = cfg.headerFirst\n\n  this._dashes = 0\n  this._parts = 0\n  this._finished = false\n  this._realFinish = false\n  this._isPreamble = true\n  this._justMatched = false\n  this._firstWrite = true\n  this._inHeader = true\n  this._part = undefined\n  this._cb = undefined\n  this._ignoreData = false\n  this._partOpts = { highWaterMark: cfg.partHwm }\n  this._pause = false\n\n  const self = this\n  this._hparser = new HeaderParser(cfg)\n  this._hparser.on('header', function (header) {\n    self._inHeader = false\n    self._part.emit('header', header)\n  })\n}\ninherits(Dicer, WritableStream)\n\nDicer.prototype.emit = function (ev) {\n  if (ev === 'finish' && !this._realFinish) {\n    if (!this._finished) {\n      const self = this\n      process.nextTick(function () {\n        self.emit('error', new Error('Unexpected end of multipart data'))\n        if (self._part && !self._ignoreData) {\n          const type = (self._isPreamble ? 'Preamble' : 'Part')\n          self._part.emit('error', new Error(type + ' terminated early due to unexpected end of multipart data'))\n          self._part.push(null)\n          process.nextTick(function () {\n            self._realFinish = true\n            self.emit('finish')\n            self._realFinish = false\n          })\n          return\n        }\n        self._realFinish = true\n        self.emit('finish')\n        self._realFinish = false\n      })\n    }\n  } else { WritableStream.prototype.emit.apply(this, arguments) }\n}\n\nDicer.prototype._write = function (data, encoding, cb) {\n  // ignore unexpected data (e.g. extra trailer data after finished)\n  if (!this._hparser && !this._bparser) { return cb() }\n\n  if (this._headerFirst && this._isPreamble) {\n    if (!this._part) {\n      this._part = new PartStream(this._partOpts)\n      if (this.listenerCount('preamble') !== 0) { this.emit('preamble', this._part) } else { this._ignore() }\n    }\n    const r = this._hparser.push(data)\n    if (!this._inHeader && r !== undefined && r < data.length) { data = data.slice(r) } else { return cb() }\n  }\n\n  // allows for \"easier\" testing\n  if (this._firstWrite) {\n    this._bparser.push(B_CRLF)\n    this._firstWrite = false\n  }\n\n  this._bparser.push(data)\n\n  if (this._pause) { this._cb = cb } else { cb() }\n}\n\nDicer.prototype.reset = function () {\n  this._part = undefined\n  this._bparser = undefined\n  this._hparser = undefined\n}\n\nDicer.prototype.setBoundary = function (boundary) {\n  const self = this\n  this._bparser = new StreamSearch('\\r\\n--' + boundary)\n  this._bparser.on('info', function (isMatch, data, start, end) {\n    self._oninfo(isMatch, data, start, end)\n  })\n}\n\nDicer.prototype._ignore = function () {\n  if (this._part && !this._ignoreData) {\n    this._ignoreData = true\n    this._part.on('error', EMPTY_FN)\n    // we must perform some kind of read on the stream even though we are\n    // ignoring the data, otherwise node's Readable stream will not emit 'end'\n    // after pushing null to the stream\n    this._part.resume()\n  }\n}\n\nDicer.prototype._oninfo = function (isMatch, data, start, end) {\n  let buf; const self = this; let i = 0; let r; let shouldWriteMore = true\n\n  if (!this._part && this._justMatched && data) {\n    while (this._dashes < 2 && (start + i) < end) {\n      if (data[start + i] === DASH) {\n        ++i\n        ++this._dashes\n      } else {\n        if (this._dashes) { buf = B_ONEDASH }\n        this._dashes = 0\n        break\n      }\n    }\n    if (this._dashes === 2) {\n      if ((start + i) < end && this.listenerCount('trailer') !== 0) { this.emit('trailer', data.slice(start + i, end)) }\n      this.reset()\n      this._finished = true\n      // no more parts will be added\n      if (self._parts === 0) {\n        self._realFinish = true\n        self.emit('finish')\n        self._realFinish = false\n      }\n    }\n    if (this._dashes) { return }\n  }\n  if (this._justMatched) { this._justMatched = false }\n  if (!this._part) {\n    this._part = new PartStream(this._partOpts)\n    this._part._read = function (n) {\n      self._unpause()\n    }\n    if (this._isPreamble && this.listenerCount('preamble') !== 0) {\n      this.emit('preamble', this._part)\n    } else if (this._isPreamble !== true && this.listenerCount('part') !== 0) {\n      this.emit('part', this._part)\n    } else {\n      this._ignore()\n    }\n    if (!this._isPreamble) { this._inHeader = true }\n  }\n  if (data && start < end && !this._ignoreData) {\n    if (this._isPreamble || !this._inHeader) {\n      if (buf) { shouldWriteMore = this._part.push(buf) }\n      shouldWriteMore = this._part.push(data.slice(start, end))\n      if (!shouldWriteMore) { this._pause = true }\n    } else if (!this._isPreamble && this._inHeader) {\n      if (buf) { this._hparser.push(buf) }\n      r = this._hparser.push(data.slice(start, end))\n      if (!this._inHeader && r !== undefined && r < end) { this._oninfo(false, data, start + r, end) }\n    }\n  }\n  if (isMatch) {\n    this._hparser.reset()\n    if (this._isPreamble) { this._isPreamble = false } else {\n      if (start !== end) {\n        ++this._parts\n        this._part.on('end', function () {\n          if (--self._parts === 0) {\n            if (self._finished) {\n              self._realFinish = true\n              self.emit('finish')\n              self._realFinish = false\n            } else {\n              self._unpause()\n            }\n          }\n        })\n      }\n    }\n    this._part.push(null)\n    this._part = undefined\n    this._ignoreData = false\n    this._justMatched = true\n    this._dashes = 0\n  }\n}\n\nDicer.prototype._unpause = function () {\n  if (!this._pause) { return }\n\n  this._pause = false\n  if (this._cb) {\n    const cb = this._cb\n    this._cb = undefined\n    cb()\n  }\n}\n\nmodule.exports = Dicer\n","'use strict'\n\n// Node has always utf-8\nconst utf8Decoder = new TextDecoder('utf-8')\nconst textDecoders = new Map([\n  ['utf-8', utf8Decoder],\n  ['utf8', utf8Decoder]\n])\n\nfunction getDecoder (charset) {\n  let lc\n  while (true) {\n    switch (charset) {\n      case 'utf-8':\n      case 'utf8':\n        return decoders.utf8\n      case 'latin1':\n      case 'ascii': // TODO: Make these a separate, strict decoder?\n      case 'us-ascii':\n      case 'iso-8859-1':\n      case 'iso8859-1':\n      case 'iso88591':\n      case 'iso_8859-1':\n      case 'windows-1252':\n      case 'iso_8859-1:1987':\n      case 'cp1252':\n      case 'x-cp1252':\n        return decoders.latin1\n      case 'utf16le':\n      case 'utf-16le':\n      case 'ucs2':\n      case 'ucs-2':\n        return decoders.utf16le\n      case 'base64':\n        return decoders.base64\n      default:\n        if (lc === undefined) {\n          lc = true\n          charset = charset.toLowerCase()\n          continue\n        }\n        return decoders.other.bind(charset)\n    }\n  }\n}\n\nconst decoders = {\n  utf8: (data, sourceEncoding) => {\n    if (data.length === 0) {\n      return ''\n    }\n    if (typeof data === 'string') {\n      data = Buffer.from(data, sourceEncoding)\n    }\n    return data.utf8Slice(0, data.length)\n  },\n\n  latin1: (data, sourceEncoding) => {\n    if (data.length === 0) {\n      return ''\n    }\n    if (typeof data === 'string') {\n      return data\n    }\n    return data.latin1Slice(0, data.length)\n  },\n\n  utf16le: (data, sourceEncoding) => {\n    if (data.length === 0) {\n      return ''\n    }\n    if (typeof data === 'string') {\n      data = Buffer.from(data, sourceEncoding)\n    }\n    return data.ucs2Slice(0, data.length)\n  },\n\n  base64: (data, sourceEncoding) => {\n    if (data.length === 0) {\n      return ''\n    }\n    if (typeof data === 'string') {\n      data = Buffer.from(data, sourceEncoding)\n    }\n    return data.base64Slice(0, data.length)\n  },\n\n  other: (data, sourceEncoding) => {\n    if (data.length === 0) {\n      return ''\n    }\n    if (typeof data === 'string') {\n      data = Buffer.from(data, sourceEncoding)\n    }\n\n    if (textDecoders.has(this.toString())) {\n      try {\n        return textDecoders.get(this).decode(data)\n      } catch {}\n    }\n    return typeof data === 'string'\n      ? data\n      : data.toString()\n  }\n}\n\nfunction decodeText (text, sourceEncoding, destEncoding) {\n  if (text) {\n    return getDecoder(destEncoding)(text, sourceEncoding)\n  }\n  return text\n}\n\nmodule.exports = decodeText\n","/* eslint-disable object-property-newline */\n'use strict'\n\nconst decodeText = require('./decodeText')\n\nconst RE_ENCODED = /%[a-fA-F0-9][a-fA-F0-9]/g\n\nconst EncodedLookup = {\n  '%00': '\\x00', '%01': '\\x01', '%02': '\\x02', '%03': '\\x03', '%04': '\\x04',\n  '%05': '\\x05', '%06': '\\x06', '%07': '\\x07', '%08': '\\x08', '%09': '\\x09',\n  '%0a': '\\x0a', '%0A': '\\x0a', '%0b': '\\x0b', '%0B': '\\x0b', '%0c': '\\x0c',\n  '%0C': '\\x0c', '%0d': '\\x0d', '%0D': '\\x0d', '%0e': '\\x0e', '%0E': '\\x0e',\n  '%0f': '\\x0f', '%0F': '\\x0f', '%10': '\\x10', '%11': '\\x11', '%12': '\\x12',\n  '%13': '\\x13', '%14': '\\x14', '%15': '\\x15', '%16': '\\x16', '%17': '\\x17',\n  '%18': '\\x18', '%19': '\\x19', '%1a': '\\x1a', '%1A': '\\x1a', '%1b': '\\x1b',\n  '%1B': '\\x1b', '%1c': '\\x1c', '%1C': '\\x1c', '%1d': '\\x1d', '%1D': '\\x1d',\n  '%1e': '\\x1e', '%1E': '\\x1e', '%1f': '\\x1f', '%1F': '\\x1f', '%20': '\\x20',\n  '%21': '\\x21', '%22': '\\x22', '%23': '\\x23', '%24': '\\x24', '%25': '\\x25',\n  '%26': '\\x26', '%27': '\\x27', '%28': '\\x28', '%29': '\\x29', '%2a': '\\x2a',\n  '%2A': '\\x2a', '%2b': '\\x2b', '%2B': '\\x2b', '%2c': '\\x2c', '%2C': '\\x2c',\n  '%2d': '\\x2d', '%2D': '\\x2d', '%2e': '\\x2e', '%2E': '\\x2e', '%2f': '\\x2f',\n  '%2F': '\\x2f', '%30': '\\x30', '%31': '\\x31', '%32': '\\x32', '%33': '\\x33',\n  '%34': '\\x34', '%35': '\\x35', '%36': '\\x36', '%37': '\\x37', '%38': '\\x38',\n  '%39': '\\x39', '%3a': '\\x3a', '%3A': '\\x3a', '%3b': '\\x3b', '%3B': '\\x3b',\n  '%3c': '\\x3c', '%3C': '\\x3c', '%3d': '\\x3d', '%3D': '\\x3d', '%3e': '\\x3e',\n  '%3E': '\\x3e', '%3f': '\\x3f', '%3F': '\\x3f', '%40': '\\x40', '%41': '\\x41',\n  '%42': '\\x42', '%43': '\\x43', '%44': '\\x44', '%45': '\\x45', '%46': '\\x46',\n  '%47': '\\x47', '%48': '\\x48', '%49': '\\x49', '%4a': '\\x4a', '%4A': '\\x4a',\n  '%4b': '\\x4b', '%4B': '\\x4b', '%4c': '\\x4c', '%4C': '\\x4c', '%4d': '\\x4d',\n  '%4D': '\\x4d', '%4e': '\\x4e', '%4E': '\\x4e', '%4f': '\\x4f', '%4F': '\\x4f',\n  '%50': '\\x50', '%51': '\\x51', '%52': '\\x52', '%53': '\\x53', '%54': '\\x54',\n  '%55': '\\x55', '%56': '\\x56', '%57': '\\x57', '%58': '\\x58', '%59': '\\x59',\n  '%5a': '\\x5a', '%5A': '\\x5a', '%5b': '\\x5b', '%5B': '\\x5b', '%5c': '\\x5c',\n  '%5C': '\\x5c', '%5d': '\\x5d', '%5D': '\\x5d', '%5e': '\\x5e', '%5E': '\\x5e',\n  '%5f': '\\x5f', '%5F': '\\x5f', '%60': '\\x60', '%61': '\\x61', '%62': '\\x62',\n  '%63': '\\x63', '%64': '\\x64', '%65': '\\x65', '%66': '\\x66', '%67': '\\x67',\n  '%68': '\\x68', '%69': '\\x69', '%6a': '\\x6a', '%6A': '\\x6a', '%6b': '\\x6b',\n  '%6B': '\\x6b', '%6c': '\\x6c', '%6C': '\\x6c', '%6d': '\\x6d', '%6D': '\\x6d',\n  '%6e': '\\x6e', '%6E': '\\x6e', '%6f': '\\x6f', '%6F': '\\x6f', '%70': '\\x70',\n  '%71': '\\x71', '%72': '\\x72', '%73': '\\x73', '%74': '\\x74', '%75': '\\x75',\n  '%76': '\\x76', '%77': '\\x77', '%78': '\\x78', '%79': '\\x79', '%7a': '\\x7a',\n  '%7A': '\\x7a', '%7b': '\\x7b', '%7B': '\\x7b', '%7c': '\\x7c', '%7C': '\\x7c',\n  '%7d': '\\x7d', '%7D': '\\x7d', '%7e': '\\x7e', '%7E': '\\x7e', '%7f': '\\x7f',\n  '%7F': '\\x7f', '%80': '\\x80', '%81': '\\x81', '%82': '\\x82', '%83': '\\x83',\n  '%84': '\\x84', '%85': '\\x85', '%86': '\\x86', '%87': '\\x87', '%88': '\\x88',\n  '%89': '\\x89', '%8a': '\\x8a', '%8A': '\\x8a', '%8b': '\\x8b', '%8B': '\\x8b',\n  '%8c': '\\x8c', '%8C': '\\x8c', '%8d': '\\x8d', '%8D': '\\x8d', '%8e': '\\x8e',\n  '%8E': '\\x8e', '%8f': '\\x8f', '%8F': '\\x8f', '%90': '\\x90', '%91': '\\x91',\n  '%92': '\\x92', '%93': '\\x93', '%94': '\\x94', '%95': '\\x95', '%96': '\\x96',\n  '%97': '\\x97', '%98': '\\x98', '%99': '\\x99', '%9a': '\\x9a', '%9A': '\\x9a',\n  '%9b': '\\x9b', '%9B': '\\x9b', '%9c': '\\x9c', '%9C': '\\x9c', '%9d': '\\x9d',\n  '%9D': '\\x9d', '%9e': '\\x9e', '%9E': '\\x9e', '%9f': '\\x9f', '%9F': '\\x9f',\n  '%a0': '\\xa0', '%A0': '\\xa0', '%a1': '\\xa1', '%A1': '\\xa1', '%a2': '\\xa2',\n  '%A2': '\\xa2', '%a3': '\\xa3', '%A3': '\\xa3', '%a4': '\\xa4', '%A4': '\\xa4',\n  '%a5': '\\xa5', '%A5': '\\xa5', '%a6': '\\xa6', '%A6': '\\xa6', '%a7': '\\xa7',\n  '%A7': '\\xa7', '%a8': '\\xa8', '%A8': '\\xa8', '%a9': '\\xa9', '%A9': '\\xa9',\n  '%aa': '\\xaa', '%Aa': '\\xaa', '%aA': '\\xaa', '%AA': '\\xaa', '%ab': '\\xab',\n  '%Ab': '\\xab', '%aB': '\\xab', '%AB': '\\xab', '%ac': '\\xac', '%Ac': '\\xac',\n  '%aC': '\\xac', '%AC': '\\xac', '%ad': '\\xad', '%Ad': '\\xad', '%aD': '\\xad',\n  '%AD': '\\xad', '%ae': '\\xae', '%Ae': '\\xae', '%aE': '\\xae', '%AE': '\\xae',\n  '%af': '\\xaf', '%Af': '\\xaf', '%aF': '\\xaf', '%AF': '\\xaf', '%b0': '\\xb0',\n  '%B0': '\\xb0', '%b1': '\\xb1', '%B1': '\\xb1', '%b2': '\\xb2', '%B2': '\\xb2',\n  '%b3': '\\xb3', '%B3': '\\xb3', '%b4': '\\xb4', '%B4': '\\xb4', '%b5': '\\xb5',\n  '%B5': '\\xb5', '%b6': '\\xb6', '%B6': '\\xb6', '%b7': '\\xb7', '%B7': '\\xb7',\n  '%b8': '\\xb8', '%B8': '\\xb8', '%b9': '\\xb9', '%B9': '\\xb9', '%ba': '\\xba',\n  '%Ba': '\\xba', '%bA': '\\xba', '%BA': '\\xba', '%bb': '\\xbb', '%Bb': '\\xbb',\n  '%bB': '\\xbb', '%BB': '\\xbb', '%bc': '\\xbc', '%Bc': '\\xbc', '%bC': '\\xbc',\n  '%BC': '\\xbc', '%bd': '\\xbd', '%Bd': '\\xbd', '%bD': '\\xbd', '%BD': '\\xbd',\n  '%be': '\\xbe', '%Be': '\\xbe', '%bE': '\\xbe', '%BE': '\\xbe', '%bf': '\\xbf',\n  '%Bf': '\\xbf', '%bF': '\\xbf', '%BF': '\\xbf', '%c0': '\\xc0', '%C0': '\\xc0',\n  '%c1': '\\xc1', '%C1': '\\xc1', '%c2': '\\xc2', '%C2': '\\xc2', '%c3': '\\xc3',\n  '%C3': '\\xc3', '%c4': '\\xc4', '%C4': '\\xc4', '%c5': '\\xc5', '%C5': '\\xc5',\n  '%c6': '\\xc6', '%C6': '\\xc6', '%c7': '\\xc7', '%C7': '\\xc7', '%c8': '\\xc8',\n  '%C8': '\\xc8', '%c9': '\\xc9', '%C9': '\\xc9', '%ca': '\\xca', '%Ca': '\\xca',\n  '%cA': '\\xca', '%CA': '\\xca', '%cb': '\\xcb', '%Cb': '\\xcb', '%cB': '\\xcb',\n  '%CB': '\\xcb', '%cc': '\\xcc', '%Cc': '\\xcc', '%cC': '\\xcc', '%CC': '\\xcc',\n  '%cd': '\\xcd', '%Cd': '\\xcd', '%cD': '\\xcd', '%CD': '\\xcd', '%ce': '\\xce',\n  '%Ce': '\\xce', '%cE': '\\xce', '%CE': '\\xce', '%cf': '\\xcf', '%Cf': '\\xcf',\n  '%cF': '\\xcf', '%CF': '\\xcf', '%d0': '\\xd0', '%D0': '\\xd0', '%d1': '\\xd1',\n  '%D1': '\\xd1', '%d2': '\\xd2', '%D2': '\\xd2', '%d3': '\\xd3', '%D3': '\\xd3',\n  '%d4': '\\xd4', '%D4': '\\xd4', '%d5': '\\xd5', '%D5': '\\xd5', '%d6': '\\xd6',\n  '%D6': '\\xd6', '%d7': '\\xd7', '%D7': '\\xd7', '%d8': '\\xd8', '%D8': '\\xd8',\n  '%d9': '\\xd9', '%D9': '\\xd9', '%da': '\\xda', '%Da': '\\xda', '%dA': '\\xda',\n  '%DA': '\\xda', '%db': '\\xdb', '%Db': '\\xdb', '%dB': '\\xdb', '%DB': '\\xdb',\n  '%dc': '\\xdc', '%Dc': '\\xdc', '%dC': '\\xdc', '%DC': '\\xdc', '%dd': '\\xdd',\n  '%Dd': '\\xdd', '%dD': '\\xdd', '%DD': '\\xdd', '%de': '\\xde', '%De': '\\xde',\n  '%dE': '\\xde', '%DE': '\\xde', '%df': '\\xdf', '%Df': '\\xdf', '%dF': '\\xdf',\n  '%DF': '\\xdf', '%e0': '\\xe0', '%E0': '\\xe0', '%e1': '\\xe1', '%E1': '\\xe1',\n  '%e2': '\\xe2', '%E2': '\\xe2', '%e3': '\\xe3', '%E3': '\\xe3', '%e4': '\\xe4',\n  '%E4': '\\xe4', '%e5': '\\xe5', '%E5': '\\xe5', '%e6': '\\xe6', '%E6': '\\xe6',\n  '%e7': '\\xe7', '%E7': '\\xe7', '%e8': '\\xe8', '%E8': '\\xe8', '%e9': '\\xe9',\n  '%E9': '\\xe9', '%ea': '\\xea', '%Ea': '\\xea', '%eA': '\\xea', '%EA': '\\xea',\n  '%eb': '\\xeb', '%Eb': '\\xeb', '%eB': '\\xeb', '%EB': '\\xeb', '%ec': '\\xec',\n  '%Ec': '\\xec', '%eC': '\\xec', '%EC': '\\xec', '%ed': '\\xed', '%Ed': '\\xed',\n  '%eD': '\\xed', '%ED': '\\xed', '%ee': '\\xee', '%Ee': '\\xee', '%eE': '\\xee',\n  '%EE': '\\xee', '%ef': '\\xef', '%Ef': '\\xef', '%eF': '\\xef', '%EF': '\\xef',\n  '%f0': '\\xf0', '%F0': '\\xf0', '%f1': '\\xf1', '%F1': '\\xf1', '%f2': '\\xf2',\n  '%F2': '\\xf2', '%f3': '\\xf3', '%F3': '\\xf3', '%f4': '\\xf4', '%F4': '\\xf4',\n  '%f5': '\\xf5', '%F5': '\\xf5', '%f6': '\\xf6', '%F6': '\\xf6', '%f7': '\\xf7',\n  '%F7': '\\xf7', '%f8': '\\xf8', '%F8': '\\xf8', '%f9': '\\xf9', '%F9': '\\xf9',\n  '%fa': '\\xfa', '%Fa': '\\xfa', '%fA': '\\xfa', '%FA': '\\xfa', '%fb': '\\xfb',\n  '%Fb': '\\xfb', '%fB': '\\xfb', '%FB': '\\xfb', '%fc': '\\xfc', '%Fc': '\\xfc',\n  '%fC': '\\xfc', '%FC': '\\xfc', '%fd': '\\xfd', '%Fd': '\\xfd', '%fD': '\\xfd',\n  '%FD': '\\xfd', '%fe': '\\xfe', '%Fe': '\\xfe', '%fE': '\\xfe', '%FE': '\\xfe',\n  '%ff': '\\xff', '%Ff': '\\xff', '%fF': '\\xff', '%FF': '\\xff'\n}\n\nfunction encodedReplacer (match) {\n  return EncodedLookup[match]\n}\n\nconst STATE_KEY = 0\nconst STATE_VALUE = 1\nconst STATE_CHARSET = 2\nconst STATE_LANG = 3\n\nfunction parseParams (str) {\n  const res = []\n  let state = STATE_KEY\n  let charset = ''\n  let inquote = false\n  let escaping = false\n  let p = 0\n  let tmp = ''\n  const len = str.length\n\n  for (var i = 0; i < len; ++i) { // eslint-disable-line no-var\n    const char = str[i]\n    if (char === '\\\\' && inquote) {\n      if (escaping) { escaping = false } else {\n        escaping = true\n        continue\n      }\n    } else if (char === '\"') {\n      if (!escaping) {\n        if (inquote) {\n          inquote = false\n          state = STATE_KEY\n        } else { inquote = true }\n        continue\n      } else { escaping = false }\n    } else {\n      if (escaping && inquote) { tmp += '\\\\' }\n      escaping = false\n      if ((state === STATE_CHARSET || state === STATE_LANG) && char === \"'\") {\n        if (state === STATE_CHARSET) {\n          state = STATE_LANG\n          charset = tmp.substring(1)\n        } else { state = STATE_VALUE }\n        tmp = ''\n        continue\n      } else if (state === STATE_KEY &&\n        (char === '*' || char === '=') &&\n        res.length) {\n        state = char === '*'\n          ? STATE_CHARSET\n          : STATE_VALUE\n        res[p] = [tmp, undefined]\n        tmp = ''\n        continue\n      } else if (!inquote && char === ';') {\n        state = STATE_KEY\n        if (charset) {\n          if (tmp.length) {\n            tmp = decodeText(tmp.replace(RE_ENCODED, encodedReplacer),\n              'binary',\n              charset)\n          }\n          charset = ''\n        } else if (tmp.length) {\n          tmp = decodeText(tmp, 'binary', 'utf8')\n        }\n        if (res[p] === undefined) { res[p] = tmp } else { res[p][1] = tmp }\n        tmp = ''\n        ++p\n        continue\n      } else if (!inquote && (char === ' ' || char === '\\t')) { continue }\n    }\n    tmp += char\n  }\n  if (charset && tmp.length) {\n    tmp = decodeText(tmp.replace(RE_ENCODED, encodedReplacer),\n      'binary',\n      charset)\n  } else if (tmp) {\n    tmp = decodeText(tmp, 'binary', 'utf8')\n  }\n\n  if (res[p] === undefined) {\n    if (tmp) { res[p] = tmp }\n  } else { res[p][1] = tmp }\n\n  return res\n}\n\nmodule.exports = parseParams\n","'use strict'\n\nmodule.exports = function basename (path) {\n  if (typeof path !== 'string') { return '' }\n  for (var i = path.length - 1; i >= 0; --i) { // eslint-disable-line no-var\n    switch (path.charCodeAt(i)) {\n      case 0x2F: // '/'\n      case 0x5C: // '\\'\n        path = path.slice(i + 1)\n        return (path === '..' || path === '.' ? '' : path)\n    }\n  }\n  return (path === '..' || path === '.' ? '' : path)\n}\n","'use strict'\n\n// TODO:\n//  * support 1 nested multipart level\n//    (see second multipart example here:\n//     http://www.w3.org/TR/html401/interact/forms.html#didx-multipartform-data)\n//  * support limits.fieldNameSize\n//     -- this will require modifications to utils.parseParams\n\nconst { Readable } = require('node:stream')\nconst { inherits } = require('node:util')\n\nconst Dicer = require('../../deps/dicer/lib/Dicer')\n\nconst parseParams = require('../utils/parseParams')\nconst decodeText = require('../utils/decodeText')\nconst basename = require('../utils/basename')\nconst getLimit = require('../utils/getLimit')\n\nconst RE_BOUNDARY = /^boundary$/i\nconst RE_FIELD = /^form-data$/i\nconst RE_CHARSET = /^charset$/i\nconst RE_FILENAME = /^filename$/i\nconst RE_NAME = /^name$/i\n\nMultipart.detect = /^multipart\\/form-data/i\nfunction Multipart (boy, cfg) {\n  let i\n  let len\n  const self = this\n  let boundary\n  const limits = cfg.limits\n  const isPartAFile = cfg.isPartAFile || ((fieldName, contentType, fileName) => (contentType === 'application/octet-stream' || fileName !== undefined))\n  const parsedConType = cfg.parsedConType || []\n  const defCharset = cfg.defCharset || 'utf8'\n  const preservePath = cfg.preservePath\n  const fileOpts = { highWaterMark: cfg.fileHwm }\n\n  for (i = 0, len = parsedConType.length; i < len; ++i) {\n    if (Array.isArray(parsedConType[i]) &&\n      RE_BOUNDARY.test(parsedConType[i][0])) {\n      boundary = parsedConType[i][1]\n      break\n    }\n  }\n\n  function checkFinished () {\n    if (nends === 0 && finished && !boy._done) {\n      finished = false\n      self.end()\n    }\n  }\n\n  if (typeof boundary !== 'string') { throw new Error('Multipart: Boundary not found') }\n\n  const fieldSizeLimit = getLimit(limits, 'fieldSize', 1 * 1024 * 1024)\n  const fileSizeLimit = getLimit(limits, 'fileSize', Infinity)\n  const filesLimit = getLimit(limits, 'files', Infinity)\n  const fieldsLimit = getLimit(limits, 'fields', Infinity)\n  const partsLimit = getLimit(limits, 'parts', Infinity)\n  const headerPairsLimit = getLimit(limits, 'headerPairs', 2000)\n  const headerSizeLimit = getLimit(limits, 'headerSize', 80 * 1024)\n\n  let nfiles = 0\n  let nfields = 0\n  let nends = 0\n  let curFile\n  let curField\n  let finished = false\n\n  this._needDrain = false\n  this._pause = false\n  this._cb = undefined\n  this._nparts = 0\n  this._boy = boy\n\n  const parserCfg = {\n    boundary,\n    maxHeaderPairs: headerPairsLimit,\n    maxHeaderSize: headerSizeLimit,\n    partHwm: fileOpts.highWaterMark,\n    highWaterMark: cfg.highWaterMark\n  }\n\n  this.parser = new Dicer(parserCfg)\n  this.parser.on('drain', function () {\n    self._needDrain = false\n    if (self._cb && !self._pause) {\n      const cb = self._cb\n      self._cb = undefined\n      cb()\n    }\n  }).on('part', function onPart (part) {\n    if (++self._nparts > partsLimit) {\n      self.parser.removeListener('part', onPart)\n      self.parser.on('part', skipPart)\n      boy.hitPartsLimit = true\n      boy.emit('partsLimit')\n      return skipPart(part)\n    }\n\n    // hack because streams2 _always_ doesn't emit 'end' until nextTick, so let\n    // us emit 'end' early since we know the part has ended if we are already\n    // seeing the next part\n    if (curField) {\n      const field = curField\n      field.emit('end')\n      field.removeAllListeners('end')\n    }\n\n    part.on('header', function (header) {\n      let contype\n      let fieldname\n      let parsed\n      let charset\n      let encoding\n      let filename\n      let nsize = 0\n\n      if (header['content-type']) {\n        parsed = parseParams(header['content-type'][0])\n        if (parsed[0]) {\n          contype = parsed[0].toLowerCase()\n          for (i = 0, len = parsed.length; i < len; ++i) {\n            if (RE_CHARSET.test(parsed[i][0])) {\n              charset = parsed[i][1].toLowerCase()\n              break\n            }\n          }\n        }\n      }\n\n      if (contype === undefined) { contype = 'text/plain' }\n      if (charset === undefined) { charset = defCharset }\n\n      if (header['content-disposition']) {\n        parsed = parseParams(header['content-disposition'][0])\n        if (!RE_FIELD.test(parsed[0])) { return skipPart(part) }\n        for (i = 0, len = parsed.length; i < len; ++i) {\n          if (RE_NAME.test(parsed[i][0])) {\n            fieldname = parsed[i][1]\n          } else if (RE_FILENAME.test(parsed[i][0])) {\n            filename = parsed[i][1]\n            if (!preservePath) { filename = basename(filename) }\n          }\n        }\n      } else { return skipPart(part) }\n\n      if (header['content-transfer-encoding']) { encoding = header['content-transfer-encoding'][0].toLowerCase() } else { encoding = '7bit' }\n\n      let onData,\n        onEnd\n\n      if (isPartAFile(fieldname, contype, filename)) {\n        // file/binary field\n        if (nfiles === filesLimit) {\n          if (!boy.hitFilesLimit) {\n            boy.hitFilesLimit = true\n            boy.emit('filesLimit')\n          }\n          return skipPart(part)\n        }\n\n        ++nfiles\n\n        if (boy.listenerCount('file') === 0) {\n          self.parser._ignore()\n          return\n        }\n\n        ++nends\n        const file = new FileStream(fileOpts)\n        curFile = file\n        file.on('end', function () {\n          --nends\n          self._pause = false\n          checkFinished()\n          if (self._cb && !self._needDrain) {\n            const cb = self._cb\n            self._cb = undefined\n            cb()\n          }\n        })\n        file._read = function (n) {\n          if (!self._pause) { return }\n          self._pause = false\n          if (self._cb && !self._needDrain) {\n            const cb = self._cb\n            self._cb = undefined\n            cb()\n          }\n        }\n        boy.emit('file', fieldname, file, filename, encoding, contype)\n\n        onData = function (data) {\n          if ((nsize += data.length) > fileSizeLimit) {\n            const extralen = fileSizeLimit - nsize + data.length\n            if (extralen > 0) { file.push(data.slice(0, extralen)) }\n            file.truncated = true\n            file.bytesRead = fileSizeLimit\n            part.removeAllListeners('data')\n            file.emit('limit')\n            return\n          } else if (!file.push(data)) { self._pause = true }\n\n          file.bytesRead = nsize\n        }\n\n        onEnd = function () {\n          curFile = undefined\n          file.push(null)\n        }\n      } else {\n        // non-file field\n        if (nfields === fieldsLimit) {\n          if (!boy.hitFieldsLimit) {\n            boy.hitFieldsLimit = true\n            boy.emit('fieldsLimit')\n          }\n          return skipPart(part)\n        }\n\n        ++nfields\n        ++nends\n        let buffer = ''\n        let truncated = false\n        curField = part\n\n        onData = function (data) {\n          if ((nsize += data.length) > fieldSizeLimit) {\n            const extralen = (fieldSizeLimit - (nsize - data.length))\n            buffer += data.toString('binary', 0, extralen)\n            truncated = true\n            part.removeAllListeners('data')\n          } else { buffer += data.toString('binary') }\n        }\n\n        onEnd = function () {\n          curField = undefined\n          if (buffer.length) { buffer = decodeText(buffer, 'binary', charset) }\n          boy.emit('field', fieldname, buffer, false, truncated, encoding, contype)\n          --nends\n          checkFinished()\n        }\n      }\n\n      /* As of node@2efe4ab761666 (v0.10.29+/v0.11.14+), busboy had become\n         broken. Streams2/streams3 is a huge black box of confusion, but\n         somehow overriding the sync state seems to fix things again (and still\n         seems to work for previous node versions).\n      */\n      part._readableState.sync = false\n\n      part.on('data', onData)\n      part.on('end', onEnd)\n    }).on('error', function (err) {\n      if (curFile) { curFile.emit('error', err) }\n    })\n  }).on('error', function (err) {\n    boy.emit('error', err)\n  }).on('finish', function () {\n    finished = true\n    checkFinished()\n  })\n}\n\nMultipart.prototype.write = function (chunk, cb) {\n  const r = this.parser.write(chunk)\n  if (r && !this._pause) {\n    cb()\n  } else {\n    this._needDrain = !r\n    this._cb = cb\n  }\n}\n\nMultipart.prototype.end = function () {\n  const self = this\n\n  if (self.parser.writable) {\n    self.parser.end()\n  } else if (!self._boy._done) {\n    process.nextTick(function () {\n      self._boy._done = true\n      self._boy.emit('finish')\n    })\n  }\n}\n\nfunction skipPart (part) {\n  part.resume()\n}\n\nfunction FileStream (opts) {\n  Readable.call(this, opts)\n\n  this.bytesRead = 0\n\n  this.truncated = false\n}\n\ninherits(FileStream, Readable)\n\nFileStream.prototype._read = function (n) {}\n\nmodule.exports = Multipart\n","'use strict'\n\nconst RE_PLUS = /\\+/g\n\nconst HEX = [\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,\n  0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0\n]\n\nfunction Decoder () {\n  this.buffer = undefined\n}\nDecoder.prototype.write = function (str) {\n  // Replace '+' with ' ' before decoding\n  str = str.replace(RE_PLUS, ' ')\n  let res = ''\n  let i = 0; let p = 0; const len = str.length\n  for (; i < len; ++i) {\n    if (this.buffer !== undefined) {\n      if (!HEX[str.charCodeAt(i)]) {\n        res += '%' + this.buffer\n        this.buffer = undefined\n        --i // retry character\n      } else {\n        this.buffer += str[i]\n        ++p\n        if (this.buffer.length === 2) {\n          res += String.fromCharCode(parseInt(this.buffer, 16))\n          this.buffer = undefined\n        }\n      }\n    } else if (str[i] === '%') {\n      if (i > p) {\n        res += str.substring(p, i)\n        p = i\n      }\n      this.buffer = ''\n      ++p\n    }\n  }\n  if (p < len && this.buffer === undefined) { res += str.substring(p) }\n  return res\n}\nDecoder.prototype.reset = function () {\n  this.buffer = undefined\n}\n\nmodule.exports = Decoder\n","'use strict'\n\nconst Decoder = require('../utils/Decoder')\nconst decodeText = require('../utils/decodeText')\nconst getLimit = require('../utils/getLimit')\n\nconst RE_CHARSET = /^charset$/i\n\nUrlEncoded.detect = /^application\\/x-www-form-urlencoded/i\nfunction UrlEncoded (boy, cfg) {\n  const limits = cfg.limits\n  const parsedConType = cfg.parsedConType\n  this.boy = boy\n\n  this.fieldSizeLimit = getLimit(limits, 'fieldSize', 1 * 1024 * 1024)\n  this.fieldNameSizeLimit = getLimit(limits, 'fieldNameSize', 100)\n  this.fieldsLimit = getLimit(limits, 'fields', Infinity)\n\n  let charset\n  for (var i = 0, len = parsedConType.length; i < len; ++i) { // eslint-disable-line no-var\n    if (Array.isArray(parsedConType[i]) &&\n        RE_CHARSET.test(parsedConType[i][0])) {\n      charset = parsedConType[i][1].toLowerCase()\n      break\n    }\n  }\n\n  if (charset === undefined) { charset = cfg.defCharset || 'utf8' }\n\n  this.decoder = new Decoder()\n  this.charset = charset\n  this._fields = 0\n  this._state = 'key'\n  this._checkingBytes = true\n  this._bytesKey = 0\n  this._bytesVal = 0\n  this._key = ''\n  this._val = ''\n  this._keyTrunc = false\n  this._valTrunc = false\n  this._hitLimit = false\n}\n\nUrlEncoded.prototype.write = function (data, cb) {\n  if (this._fields === this.fieldsLimit) {\n    if (!this.boy.hitFieldsLimit) {\n      this.boy.hitFieldsLimit = true\n      this.boy.emit('fieldsLimit')\n    }\n    return cb()\n  }\n\n  let idxeq; let idxamp; let i; let p = 0; const len = data.length\n\n  while (p < len) {\n    if (this._state === 'key') {\n      idxeq = idxamp = undefined\n      for (i = p; i < len; ++i) {\n        if (!this._checkingBytes) { ++p }\n        if (data[i] === 0x3D/* = */) {\n          idxeq = i\n          break\n        } else if (data[i] === 0x26/* & */) {\n          idxamp = i\n          break\n        }\n        if (this._checkingBytes && this._bytesKey === this.fieldNameSizeLimit) {\n          this._hitLimit = true\n          break\n        } else if (this._checkingBytes) { ++this._bytesKey }\n      }\n\n      if (idxeq !== undefined) {\n        // key with assignment\n        if (idxeq > p) { this._key += this.decoder.write(data.toString('binary', p, idxeq)) }\n        this._state = 'val'\n\n        this._hitLimit = false\n        this._checkingBytes = true\n        this._val = ''\n        this._bytesVal = 0\n        this._valTrunc = false\n        this.decoder.reset()\n\n        p = idxeq + 1\n      } else if (idxamp !== undefined) {\n        // key with no assignment\n        ++this._fields\n        let key; const keyTrunc = this._keyTrunc\n        if (idxamp > p) { key = (this._key += this.decoder.write(data.toString('binary', p, idxamp))) } else { key = this._key }\n\n        this._hitLimit = false\n        this._checkingBytes = true\n        this._key = ''\n        this._bytesKey = 0\n        this._keyTrunc = false\n        this.decoder.reset()\n\n        if (key.length) {\n          this.boy.emit('field', decodeText(key, 'binary', this.charset),\n            '',\n            keyTrunc,\n            false)\n        }\n\n        p = idxamp + 1\n        if (this._fields === this.fieldsLimit) { return cb() }\n      } else if (this._hitLimit) {\n        // we may not have hit the actual limit if there are encoded bytes...\n        if (i > p) { this._key += this.decoder.write(data.toString('binary', p, i)) }\n        p = i\n        if ((this._bytesKey = this._key.length) === this.fieldNameSizeLimit) {\n          // yep, we actually did hit the limit\n          this._checkingBytes = false\n          this._keyTrunc = true\n        }\n      } else {\n        if (p < len) { this._key += this.decoder.write(data.toString('binary', p)) }\n        p = len\n      }\n    } else {\n      idxamp = undefined\n      for (i = p; i < len; ++i) {\n        if (!this._checkingBytes) { ++p }\n        if (data[i] === 0x26/* & */) {\n          idxamp = i\n          break\n        }\n        if (this._checkingBytes && this._bytesVal === this.fieldSizeLimit) {\n          this._hitLimit = true\n          break\n        } else if (this._checkingBytes) { ++this._bytesVal }\n      }\n\n      if (idxamp !== undefined) {\n        ++this._fields\n        if (idxamp > p) { this._val += this.decoder.write(data.toString('binary', p, idxamp)) }\n        this.boy.emit('field', decodeText(this._key, 'binary', this.charset),\n          decodeText(this._val, 'binary', this.charset),\n          this._keyTrunc,\n          this._valTrunc)\n        this._state = 'key'\n\n        this._hitLimit = false\n        this._checkingBytes = true\n        this._key = ''\n        this._bytesKey = 0\n        this._keyTrunc = false\n        this.decoder.reset()\n\n        p = idxamp + 1\n        if (this._fields === this.fieldsLimit) { return cb() }\n      } else if (this._hitLimit) {\n        // we may not have hit the actual limit if there are encoded bytes...\n        if (i > p) { this._val += this.decoder.write(data.toString('binary', p, i)) }\n        p = i\n        if ((this._val === '' && this.fieldSizeLimit === 0) ||\n            (this._bytesVal = this._val.length) === this.fieldSizeLimit) {\n          // yep, we actually did hit the limit\n          this._checkingBytes = false\n          this._valTrunc = true\n        }\n      } else {\n        if (p < len) { this._val += this.decoder.write(data.toString('binary', p)) }\n        p = len\n      }\n    }\n  }\n  cb()\n}\n\nUrlEncoded.prototype.end = function () {\n  if (this.boy._done) { return }\n\n  if (this._state === 'key' && this._key.length > 0) {\n    this.boy.emit('field', decodeText(this._key, 'binary', this.charset),\n      '',\n      this._keyTrunc,\n      false)\n  } else if (this._state === 'val') {\n    this.boy.emit('field', decodeText(this._key, 'binary', this.charset),\n      decodeText(this._val, 'binary', this.charset),\n      this._keyTrunc,\n      this._valTrunc)\n  }\n  this.boy._done = true\n  this.boy.emit('finish')\n}\n\nmodule.exports = UrlEncoded\n","'use strict'\n\nconst WritableStream = require('node:stream').Writable\nconst { inherits } = require('node:util')\nconst Dicer = require('../deps/dicer/lib/Dicer')\n\nconst MultipartParser = require('./types/multipart')\nconst UrlencodedParser = require('./types/urlencoded')\nconst parseParams = require('./utils/parseParams')\n\nfunction Busboy (opts) {\n  if (!(this instanceof Busboy)) { return new Busboy(opts) }\n\n  if (typeof opts !== 'object') {\n    throw new TypeError('Busboy expected an options-Object.')\n  }\n  if (typeof opts.headers !== 'object') {\n    throw new TypeError('Busboy expected an options-Object with headers-attribute.')\n  }\n  if (typeof opts.headers['content-type'] !== 'string') {\n    throw new TypeError('Missing Content-Type-header.')\n  }\n\n  const {\n    headers,\n    ...streamOptions\n  } = opts\n\n  this.opts = {\n    autoDestroy: false,\n    ...streamOptions\n  }\n  WritableStream.call(this, this.opts)\n\n  this._done = false\n  this._parser = this.getParserByHeaders(headers)\n  this._finished = false\n}\ninherits(Busboy, WritableStream)\n\nBusboy.prototype.emit = function (ev) {\n  if (ev === 'finish') {\n    if (!this._done) {\n      this._parser?.end()\n      return\n    } else if (this._finished) {\n      return\n    }\n    this._finished = true\n  }\n  WritableStream.prototype.emit.apply(this, arguments)\n}\n\nBusboy.prototype.getParserByHeaders = function (headers) {\n  const parsed = parseParams(headers['content-type'])\n\n  const cfg = {\n    defCharset: this.opts.defCharset,\n    fileHwm: this.opts.fileHwm,\n    headers,\n    highWaterMark: this.opts.highWaterMark,\n    isPartAFile: this.opts.isPartAFile,\n    limits: this.opts.limits,\n    parsedConType: parsed,\n    preservePath: this.opts.preservePath\n  }\n\n  if (MultipartParser.detect.test(parsed[0])) {\n    return new MultipartParser(this, cfg)\n  }\n  if (UrlencodedParser.detect.test(parsed[0])) {\n    return new UrlencodedParser(this, cfg)\n  }\n  throw new Error('Unsupported Content-Type.')\n}\n\nBusboy.prototype._write = function (chunk, encoding, cb) {\n  this._parser.write(chunk, cb)\n}\n\nmodule.exports = Busboy\nmodule.exports.default = Busboy\nmodule.exports.Busboy = Busboy\n\nmodule.exports.Dicer = Dicer\n","'use strict'\n\nconst { MessageChannel, receiveMessageOnPort } = require('worker_threads')\n\nconst corsSafeListedMethods = ['GET', 'HEAD', 'POST']\nconst corsSafeListedMethodsSet = new Set(corsSafeListedMethods)\n\nconst nullBodyStatus = [101, 204, 205, 304]\n\nconst redirectStatus = [301, 302, 303, 307, 308]\nconst redirectStatusSet = new Set(redirectStatus)\n\n// https://fetch.spec.whatwg.org/#block-bad-port\nconst badPorts = [\n  '1', '7', '9', '11', '13', '15', '17', '19', '20', '21', '22', '23', '25', '37', '42', '43', '53', '69', '77', '79',\n  '87', '95', '101', '102', '103', '104', '109', '110', '111', '113', '115', '117', '119', '123', '135', '137',\n  '139', '143', '161', '179', '389', '427', '465', '512', '513', '514', '515', '526', '530', '531', '532',\n  '540', '548', '554', '556', '563', '587', '601', '636', '989', '990', '993', '995', '1719', '1720', '1723',\n  '2049', '3659', '4045', '5060', '5061', '6000', '6566', '6665', '6666', '6667', '6668', '6669', '6697',\n  '10080'\n]\n\nconst badPortsSet = new Set(badPorts)\n\n// https://w3c.github.io/webappsec-referrer-policy/#referrer-policies\nconst referrerPolicy = [\n  '',\n  'no-referrer',\n  'no-referrer-when-downgrade',\n  'same-origin',\n  'origin',\n  'strict-origin',\n  'origin-when-cross-origin',\n  'strict-origin-when-cross-origin',\n  'unsafe-url'\n]\nconst referrerPolicySet = new Set(referrerPolicy)\n\nconst requestRedirect = ['follow', 'manual', 'error']\n\nconst safeMethods = ['GET', 'HEAD', 'OPTIONS', 'TRACE']\nconst safeMethodsSet = new Set(safeMethods)\n\nconst requestMode = ['navigate', 'same-origin', 'no-cors', 'cors']\n\nconst requestCredentials = ['omit', 'same-origin', 'include']\n\nconst requestCache = [\n  'default',\n  'no-store',\n  'reload',\n  'no-cache',\n  'force-cache',\n  'only-if-cached'\n]\n\n// https://fetch.spec.whatwg.org/#request-body-header-name\nconst requestBodyHeader = [\n  'content-encoding',\n  'content-language',\n  'content-location',\n  'content-type',\n  // See https://github.com/nodejs/undici/issues/2021\n  // 'Content-Length' is a forbidden header name, which is typically\n  // removed in the Headers implementation. However, undici doesn't\n  // filter out headers, so we add it here.\n  'content-length'\n]\n\n// https://fetch.spec.whatwg.org/#enumdef-requestduplex\nconst requestDuplex = [\n  'half'\n]\n\n// http://fetch.spec.whatwg.org/#forbidden-method\nconst forbiddenMethods = ['CONNECT', 'TRACE', 'TRACK']\nconst forbiddenMethodsSet = new Set(forbiddenMethods)\n\nconst subresource = [\n  'audio',\n  'audioworklet',\n  'font',\n  'image',\n  'manifest',\n  'paintworklet',\n  'script',\n  'style',\n  'track',\n  'video',\n  'xslt',\n  ''\n]\nconst subresourceSet = new Set(subresource)\n\n/** @type {globalThis['DOMException']} */\nconst DOMException = globalThis.DOMException ?? (() => {\n  // DOMException was only made a global in Node v17.0.0,\n  // but fetch supports >= v16.8.\n  try {\n    atob('~')\n  } catch (err) {\n    return Object.getPrototypeOf(err).constructor\n  }\n})()\n\nlet channel\n\n/** @type {globalThis['structuredClone']} */\nconst structuredClone =\n  globalThis.structuredClone ??\n  // https://github.com/nodejs/node/blob/b27ae24dcc4251bad726d9d84baf678d1f707fed/lib/internal/structured_clone.js\n  // structuredClone was added in v17.0.0, but fetch supports v16.8\n  function structuredClone (value, options = undefined) {\n    if (arguments.length === 0) {\n      throw new TypeError('missing argument')\n    }\n\n    if (!channel) {\n      channel = new MessageChannel()\n    }\n    channel.port1.unref()\n    channel.port2.unref()\n    channel.port1.postMessage(value, options?.transfer)\n    return receiveMessageOnPort(channel.port2).message\n  }\n\nmodule.exports = {\n  DOMException,\n  structuredClone,\n  subresource,\n  forbiddenMethods,\n  requestBodyHeader,\n  referrerPolicy,\n  requestRedirect,\n  requestMode,\n  requestCredentials,\n  requestCache,\n  redirectStatus,\n  corsSafeListedMethods,\n  nullBodyStatus,\n  safeMethods,\n  badPorts,\n  requestDuplex,\n  subresourceSet,\n  badPortsSet,\n  redirectStatusSet,\n  corsSafeListedMethodsSet,\n  safeMethodsSet,\n  forbiddenMethodsSet,\n  referrerPolicySet\n}\n","'use strict'\n\n// In case of breaking changes, increase the version\n// number to avoid conflicts.\nconst globalOrigin = Symbol.for('undici.globalOrigin.1')\n\nfunction getGlobalOrigin () {\n  return globalThis[globalOrigin]\n}\n\nfunction setGlobalOrigin (newOrigin) {\n  if (newOrigin === undefined) {\n    Object.defineProperty(globalThis, globalOrigin, {\n      value: undefined,\n      writable: true,\n      enumerable: false,\n      configurable: false\n    })\n\n    return\n  }\n\n  const parsedURL = new URL(newOrigin)\n\n  if (parsedURL.protocol !== 'http:' && parsedURL.protocol !== 'https:') {\n    throw new TypeError(`Only http & https urls are allowed, received ${parsedURL.protocol}`)\n  }\n\n  Object.defineProperty(globalThis, globalOrigin, {\n    value: parsedURL,\n    writable: true,\n    enumerable: false,\n    configurable: false\n  })\n}\n\nmodule.exports = {\n  getGlobalOrigin,\n  setGlobalOrigin\n}\n","'use strict'\n\nconst { redirectStatusSet, referrerPolicySet: referrerPolicyTokens, badPortsSet } = require('./constants')\nconst { getGlobalOrigin } = require('./global')\nconst { performance } = require('perf_hooks')\nconst { isBlobLike, toUSVString, ReadableStreamFrom } = require('../core/util')\nconst assert = require('assert')\nconst { isUint8Array } = require('util/types')\n\nlet supportedHashes = []\n\n// https://nodejs.org/api/crypto.html#determining-if-crypto-support-is-unavailable\n/** @type {import('crypto')|undefined} */\nlet crypto\n\ntry {\n  crypto = require('crypto')\n  const possibleRelevantHashes = ['sha256', 'sha384', 'sha512']\n  supportedHashes = crypto.getHashes().filter((hash) => possibleRelevantHashes.includes(hash))\n/* c8 ignore next 3 */\n} catch {\n}\n\nfunction responseURL (response) {\n  // https://fetch.spec.whatwg.org/#responses\n  // A response has an associated URL. It is a pointer to the last URL\n  // in responseâ€™s URL list and null if responseâ€™s URL list is empty.\n  const urlList = response.urlList\n  const length = urlList.length\n  return length === 0 ? null : urlList[length - 1].toString()\n}\n\n// https://fetch.spec.whatwg.org/#concept-response-location-url\nfunction responseLocationURL (response, requestFragment) {\n  // 1. If responseâ€™s status is not a redirect status, then return null.\n  if (!redirectStatusSet.has(response.status)) {\n    return null\n  }\n\n  // 2. Let location be the result of extracting header list values given\n  // `Location` and responseâ€™s header list.\n  let location = response.headersList.get('location')\n\n  // 3. If location is a header value, then set location to the result of\n  //    parsing location with responseâ€™s URL.\n  if (location !== null && isValidHeaderValue(location)) {\n    location = new URL(location, responseURL(response))\n  }\n\n  // 4. If location is a URL whose fragment is null, then set locationâ€™s\n  // fragment to requestFragment.\n  if (location && !location.hash) {\n    location.hash = requestFragment\n  }\n\n  // 5. Return location.\n  return location\n}\n\n/** @returns {URL} */\nfunction requestCurrentURL (request) {\n  return request.urlList[request.urlList.length - 1]\n}\n\nfunction requestBadPort (request) {\n  // 1. Let url be requestâ€™s current URL.\n  const url = requestCurrentURL(request)\n\n  // 2. If urlâ€™s scheme is an HTTP(S) scheme and urlâ€™s port is a bad port,\n  // then return blocked.\n  if (urlIsHttpHttpsScheme(url) && badPortsSet.has(url.port)) {\n    return 'blocked'\n  }\n\n  // 3. Return allowed.\n  return 'allowed'\n}\n\nfunction isErrorLike (object) {\n  return object instanceof Error || (\n    object?.constructor?.name === 'Error' ||\n    object?.constructor?.name === 'DOMException'\n  )\n}\n\n// Check whether |statusText| is a ByteString and\n// matches the Reason-Phrase token production.\n// RFC 2616: https://tools.ietf.org/html/rfc2616\n// RFC 7230: https://tools.ietf.org/html/rfc7230\n// \"reason-phrase = *( HTAB / SP / VCHAR / obs-text )\"\n// https://github.com/chromium/chromium/blob/94.0.4604.1/third_party/blink/renderer/core/fetch/response.cc#L116\nfunction isValidReasonPhrase (statusText) {\n  for (let i = 0; i < statusText.length; ++i) {\n    const c = statusText.charCodeAt(i)\n    if (\n      !(\n        (\n          c === 0x09 || // HTAB\n          (c >= 0x20 && c <= 0x7e) || // SP / VCHAR\n          (c >= 0x80 && c <= 0xff)\n        ) // obs-text\n      )\n    ) {\n      return false\n    }\n  }\n  return true\n}\n\n/**\n * @see https://tools.ietf.org/html/rfc7230#section-3.2.6\n * @param {number} c\n */\nfunction isTokenCharCode (c) {\n  switch (c) {\n    case 0x22:\n    case 0x28:\n    case 0x29:\n    case 0x2c:\n    case 0x2f:\n    case 0x3a:\n    case 0x3b:\n    case 0x3c:\n    case 0x3d:\n    case 0x3e:\n    case 0x3f:\n    case 0x40:\n    case 0x5b:\n    case 0x5c:\n    case 0x5d:\n    case 0x7b:\n    case 0x7d:\n      // DQUOTE and \"(),/:;<=>?@[\\]{}\"\n      return false\n    default:\n      // VCHAR %x21-7E\n      return c >= 0x21 && c <= 0x7e\n  }\n}\n\n/**\n * @param {string} characters\n */\nfunction isValidHTTPToken (characters) {\n  if (characters.length === 0) {\n    return false\n  }\n  for (let i = 0; i < characters.length; ++i) {\n    if (!isTokenCharCode(characters.charCodeAt(i))) {\n      return false\n    }\n  }\n  return true\n}\n\n/**\n * @see https://fetch.spec.whatwg.org/#header-name\n * @param {string} potentialValue\n */\nfunction isValidHeaderName (potentialValue) {\n  return isValidHTTPToken(potentialValue)\n}\n\n/**\n * @see https://fetch.spec.whatwg.org/#header-value\n * @param {string} potentialValue\n */\nfunction isValidHeaderValue (potentialValue) {\n  // - Has no leading or trailing HTTP tab or space bytes.\n  // - Contains no 0x00 (NUL) or HTTP newline bytes.\n  if (\n    potentialValue.startsWith('\\t') ||\n    potentialValue.startsWith(' ') ||\n    potentialValue.endsWith('\\t') ||\n    potentialValue.endsWith(' ')\n  ) {\n    return false\n  }\n\n  if (\n    potentialValue.includes('\\0') ||\n    potentialValue.includes('\\r') ||\n    potentialValue.includes('\\n')\n  ) {\n    return false\n  }\n\n  return true\n}\n\n// https://w3c.github.io/webappsec-referrer-policy/#set-requests-referrer-policy-on-redirect\nfunction setRequestReferrerPolicyOnRedirect (request, actualResponse) {\n  //  Given a request request and a response actualResponse, this algorithm\n  //  updates requestâ€™s referrer policy according to the Referrer-Policy\n  //  header (if any) in actualResponse.\n\n  // 1. Let policy be the result of executing Â§ 8.1 Parse a referrer policy\n  // from a Referrer-Policy header on actualResponse.\n\n  // 8.1 Parse a referrer policy from a Referrer-Policy header\n  // 1. Let policy-tokens be the result of extracting header list values given `Referrer-Policy` and responseâ€™s header list.\n  const { headersList } = actualResponse\n  // 2. Let policy be the empty string.\n  // 3. For each token in policy-tokens, if token is a referrer policy and token is not the empty string, then set policy to token.\n  // 4. Return policy.\n  const policyHeader = (headersList.get('referrer-policy') ?? '').split(',')\n\n  // Note: As the referrer-policy can contain multiple policies\n  // separated by comma, we need to loop through all of them\n  // and pick the first valid one.\n  // Ref: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy#specify_a_fallback_policy\n  let policy = ''\n  if (policyHeader.length > 0) {\n    // The right-most policy takes precedence.\n    // The left-most policy is the fallback.\n    for (let i = policyHeader.length; i !== 0; i--) {\n      const token = policyHeader[i - 1].trim()\n      if (referrerPolicyTokens.has(token)) {\n        policy = token\n        break\n      }\n    }\n  }\n\n  // 2. If policy is not the empty string, then set requestâ€™s referrer policy to policy.\n  if (policy !== '') {\n    request.referrerPolicy = policy\n  }\n}\n\n// https://fetch.spec.whatwg.org/#cross-origin-resource-policy-check\nfunction crossOriginResourcePolicyCheck () {\n  // TODO\n  return 'allowed'\n}\n\n// https://fetch.spec.whatwg.org/#concept-cors-check\nfunction corsCheck () {\n  // TODO\n  return 'success'\n}\n\n// https://fetch.spec.whatwg.org/#concept-tao-check\nfunction TAOCheck () {\n  // TODO\n  return 'success'\n}\n\nfunction appendFetchMetadata (httpRequest) {\n  //  https://w3c.github.io/webappsec-fetch-metadata/#sec-fetch-dest-header\n  //  TODO\n\n  //  https://w3c.github.io/webappsec-fetch-metadata/#sec-fetch-mode-header\n\n  //  1. Assert: râ€™s url is a potentially trustworthy URL.\n  //  TODO\n\n  //  2. Let header be a Structured Header whose value is a token.\n  let header = null\n\n  //  3. Set headerâ€™s value to râ€™s mode.\n  header = httpRequest.mode\n\n  //  4. Set a structured field value `Sec-Fetch-Mode`/header in râ€™s header list.\n  httpRequest.headersList.set('sec-fetch-mode', header)\n\n  //  https://w3c.github.io/webappsec-fetch-metadata/#sec-fetch-site-header\n  //  TODO\n\n  //  https://w3c.github.io/webappsec-fetch-metadata/#sec-fetch-user-header\n  //  TODO\n}\n\n// https://fetch.spec.whatwg.org/#append-a-request-origin-header\nfunction appendRequestOriginHeader (request) {\n  // 1. Let serializedOrigin be the result of byte-serializing a request origin with request.\n  let serializedOrigin = request.origin\n\n  // 2. If requestâ€™s response tainting is \"cors\" or requestâ€™s mode is \"websocket\", then append (`Origin`, serializedOrigin) to requestâ€™s header list.\n  if (request.responseTainting === 'cors' || request.mode === 'websocket') {\n    if (serializedOrigin) {\n      request.headersList.append('origin', serializedOrigin)\n    }\n\n  // 3. Otherwise, if requestâ€™s method is neither `GET` nor `HEAD`, then:\n  } else if (request.method !== 'GET' && request.method !== 'HEAD') {\n    // 1. Switch on requestâ€™s referrer policy:\n    switch (request.referrerPolicy) {\n      case 'no-referrer':\n        // Set serializedOrigin to `null`.\n        serializedOrigin = null\n        break\n      case 'no-referrer-when-downgrade':\n      case 'strict-origin':\n      case 'strict-origin-when-cross-origin':\n        // If requestâ€™s origin is a tuple origin, its scheme is \"https\", and requestâ€™s current URLâ€™s scheme is not \"https\", then set serializedOrigin to `null`.\n        if (request.origin && urlHasHttpsScheme(request.origin) && !urlHasHttpsScheme(requestCurrentURL(request))) {\n          serializedOrigin = null\n        }\n        break\n      case 'same-origin':\n        // If requestâ€™s origin is not same origin with requestâ€™s current URLâ€™s origin, then set serializedOrigin to `null`.\n        if (!sameOrigin(request, requestCurrentURL(request))) {\n          serializedOrigin = null\n        }\n        break\n      default:\n        // Do nothing.\n    }\n\n    if (serializedOrigin) {\n      // 2. Append (`Origin`, serializedOrigin) to requestâ€™s header list.\n      request.headersList.append('origin', serializedOrigin)\n    }\n  }\n}\n\nfunction coarsenedSharedCurrentTime (crossOriginIsolatedCapability) {\n  // TODO\n  return performance.now()\n}\n\n// https://fetch.spec.whatwg.org/#create-an-opaque-timing-info\nfunction createOpaqueTimingInfo (timingInfo) {\n  return {\n    startTime: timingInfo.startTime ?? 0,\n    redirectStartTime: 0,\n    redirectEndTime: 0,\n    postRedirectStartTime: timingInfo.startTime ?? 0,\n    finalServiceWorkerStartTime: 0,\n    finalNetworkResponseStartTime: 0,\n    finalNetworkRequestStartTime: 0,\n    endTime: 0,\n    encodedBodySize: 0,\n    decodedBodySize: 0,\n    finalConnectionTimingInfo: null\n  }\n}\n\n// https://html.spec.whatwg.org/multipage/origin.html#policy-container\nfunction makePolicyContainer () {\n  // Note: the fetch spec doesn't make use of embedder policy or CSP list\n  return {\n    referrerPolicy: 'strict-origin-when-cross-origin'\n  }\n}\n\n// https://html.spec.whatwg.org/multipage/origin.html#clone-a-policy-container\nfunction clonePolicyContainer (policyContainer) {\n  return {\n    referrerPolicy: policyContainer.referrerPolicy\n  }\n}\n\n// https://w3c.github.io/webappsec-referrer-policy/#determine-requests-referrer\nfunction determineRequestsReferrer (request) {\n  // 1. Let policy be request's referrer policy.\n  const policy = request.referrerPolicy\n\n  // Note: policy cannot (shouldn't) be null or an empty string.\n  assert(policy)\n\n  // 2. Let environment be requestâ€™s client.\n\n  let referrerSource = null\n\n  // 3. Switch on requestâ€™s referrer:\n  if (request.referrer === 'client') {\n    // Note: node isn't a browser and doesn't implement document/iframes,\n    // so we bypass this step and replace it with our own.\n\n    const globalOrigin = getGlobalOrigin()\n\n    if (!globalOrigin || globalOrigin.origin === 'null') {\n      return 'no-referrer'\n    }\n\n    // note: we need to clone it as it's mutated\n    referrerSource = new URL(globalOrigin)\n  } else if (request.referrer instanceof URL) {\n    // Let referrerSource be requestâ€™s referrer.\n    referrerSource = request.referrer\n  }\n\n  // 4. Let requestâ€™s referrerURL be the result of stripping referrerSource for\n  //    use as a referrer.\n  let referrerURL = stripURLForReferrer(referrerSource)\n\n  // 5. Let referrerOrigin be the result of stripping referrerSource for use as\n  //    a referrer, with the origin-only flag set to true.\n  const referrerOrigin = stripURLForReferrer(referrerSource, true)\n\n  // 6. If the result of serializing referrerURL is a string whose length is\n  //    greater than 4096, set referrerURL to referrerOrigin.\n  if (referrerURL.toString().length > 4096) {\n    referrerURL = referrerOrigin\n  }\n\n  const areSameOrigin = sameOrigin(request, referrerURL)\n  const isNonPotentiallyTrustWorthy = isURLPotentiallyTrustworthy(referrerURL) &&\n    !isURLPotentiallyTrustworthy(request.url)\n\n  // 8. Execute the switch statements corresponding to the value of policy:\n  switch (policy) {\n    case 'origin': return referrerOrigin != null ? referrerOrigin : stripURLForReferrer(referrerSource, true)\n    case 'unsafe-url': return referrerURL\n    case 'same-origin':\n      return areSameOrigin ? referrerOrigin : 'no-referrer'\n    case 'origin-when-cross-origin':\n      return areSameOrigin ? referrerURL : referrerOrigin\n    case 'strict-origin-when-cross-origin': {\n      const currentURL = requestCurrentURL(request)\n\n      // 1. If the origin of referrerURL and the origin of requestâ€™s current\n      //    URL are the same, then return referrerURL.\n      if (sameOrigin(referrerURL, currentURL)) {\n        return referrerURL\n      }\n\n      // 2. If referrerURL is a potentially trustworthy URL and requestâ€™s\n      //    current URL is not a potentially trustworthy URL, then return no\n      //    referrer.\n      if (isURLPotentiallyTrustworthy(referrerURL) && !isURLPotentiallyTrustworthy(currentURL)) {\n        return 'no-referrer'\n      }\n\n      // 3. Return referrerOrigin.\n      return referrerOrigin\n    }\n    case 'strict-origin': // eslint-disable-line\n      /**\n         * 1. If referrerURL is a potentially trustworthy URL and\n         * requestâ€™s current URL is not a potentially trustworthy URL,\n         * then return no referrer.\n         * 2. Return referrerOrigin\n        */\n    case 'no-referrer-when-downgrade': // eslint-disable-line\n      /**\n       * 1. If referrerURL is a potentially trustworthy URL and\n       * requestâ€™s current URL is not a potentially trustworthy URL,\n       * then return no referrer.\n       * 2. Return referrerOrigin\n      */\n\n    default: // eslint-disable-line\n      return isNonPotentiallyTrustWorthy ? 'no-referrer' : referrerOrigin\n  }\n}\n\n/**\n * @see https://w3c.github.io/webappsec-referrer-policy/#strip-url\n * @param {URL} url\n * @param {boolean|undefined} originOnly\n */\nfunction stripURLForReferrer (url, originOnly) {\n  // 1. Assert: url is a URL.\n  assert(url instanceof URL)\n\n  // 2. If urlâ€™s scheme is a local scheme, then return no referrer.\n  if (url.protocol === 'file:' || url.protocol === 'about:' || url.protocol === 'blank:') {\n    return 'no-referrer'\n  }\n\n  // 3. Set urlâ€™s username to the empty string.\n  url.username = ''\n\n  // 4. Set urlâ€™s password to the empty string.\n  url.password = ''\n\n  // 5. Set urlâ€™s fragment to null.\n  url.hash = ''\n\n  // 6. If the origin-only flag is true, then:\n  if (originOnly) {\n    // 1. Set urlâ€™s path to Â« the empty string Â».\n    url.pathname = ''\n\n    // 2. Set urlâ€™s query to null.\n    url.search = ''\n  }\n\n  // 7. Return url.\n  return url\n}\n\nfunction isURLPotentiallyTrustworthy (url) {\n  if (!(url instanceof URL)) {\n    return false\n  }\n\n  // If child of about, return true\n  if (url.href === 'about:blank' || url.href === 'about:srcdoc') {\n    return true\n  }\n\n  // If scheme is data, return true\n  if (url.protocol === 'data:') return true\n\n  // If file, return true\n  if (url.protocol === 'file:') return true\n\n  return isOriginPotentiallyTrustworthy(url.origin)\n\n  function isOriginPotentiallyTrustworthy (origin) {\n    // If origin is explicitly null, return false\n    if (origin == null || origin === 'null') return false\n\n    const originAsURL = new URL(origin)\n\n    // If secure, return true\n    if (originAsURL.protocol === 'https:' || originAsURL.protocol === 'wss:') {\n      return true\n    }\n\n    // If localhost or variants, return true\n    if (/^127(?:\\.[0-9]+){0,2}\\.[0-9]+$|^\\[(?:0*:)*?:?0*1\\]$/.test(originAsURL.hostname) ||\n     (originAsURL.hostname === 'localhost' || originAsURL.hostname.includes('localhost.')) ||\n     (originAsURL.hostname.endsWith('.localhost'))) {\n      return true\n    }\n\n    // If any other, return false\n    return false\n  }\n}\n\n/**\n * @see https://w3c.github.io/webappsec-subresource-integrity/#does-response-match-metadatalist\n * @param {Uint8Array} bytes\n * @param {string} metadataList\n */\nfunction bytesMatch (bytes, metadataList) {\n  // If node is not built with OpenSSL support, we cannot check\n  // a request's integrity, so allow it by default (the spec will\n  // allow requests if an invalid hash is given, as precedence).\n  /* istanbul ignore if: only if node is built with --without-ssl */\n  if (crypto === undefined) {\n    return true\n  }\n\n  // 1. Let parsedMetadata be the result of parsing metadataList.\n  const parsedMetadata = parseMetadata(metadataList)\n\n  // 2. If parsedMetadata is no metadata, return true.\n  if (parsedMetadata === 'no metadata') {\n    return true\n  }\n\n  // 3. If response is not eligible for integrity validation, return false.\n  // TODO\n\n  // 4. If parsedMetadata is the empty set, return true.\n  if (parsedMetadata.length === 0) {\n    return true\n  }\n\n  // 5. Let metadata be the result of getting the strongest\n  //    metadata from parsedMetadata.\n  const strongest = getStrongestMetadata(parsedMetadata)\n  const metadata = filterMetadataListByAlgorithm(parsedMetadata, strongest)\n\n  // 6. For each item in metadata:\n  for (const item of metadata) {\n    // 1. Let algorithm be the alg component of item.\n    const algorithm = item.algo\n\n    // 2. Let expectedValue be the val component of item.\n    const expectedValue = item.hash\n\n    // See https://github.com/web-platform-tests/wpt/commit/e4c5cc7a5e48093220528dfdd1c4012dc3837a0e\n    // \"be liberal with padding\". This is annoying, and it's not even in the spec.\n\n    // 3. Let actualValue be the result of applying algorithm to bytes.\n    let actualValue = crypto.createHash(algorithm).update(bytes).digest('base64')\n\n    if (actualValue[actualValue.length - 1] === '=') {\n      if (actualValue[actualValue.length - 2] === '=') {\n        actualValue = actualValue.slice(0, -2)\n      } else {\n        actualValue = actualValue.slice(0, -1)\n      }\n    }\n\n    // 4. If actualValue is a case-sensitive match for expectedValue,\n    //    return true.\n    if (compareBase64Mixed(actualValue, expectedValue)) {\n      return true\n    }\n  }\n\n  // 7. Return false.\n  return false\n}\n\n// https://w3c.github.io/webappsec-subresource-integrity/#grammardef-hash-with-options\n// https://www.w3.org/TR/CSP2/#source-list-syntax\n// https://www.rfc-editor.org/rfc/rfc5234#appendix-B.1\nconst parseHashWithOptions = /(?<algo>sha256|sha384|sha512)-((?<hash>[A-Za-z0-9+/]+|[A-Za-z0-9_-]+)={0,2}(?:\\s|$)( +[!-~]*)?)?/i\n\n/**\n * @see https://w3c.github.io/webappsec-subresource-integrity/#parse-metadata\n * @param {string} metadata\n */\nfunction parseMetadata (metadata) {\n  // 1. Let result be the empty set.\n  /** @type {{ algo: string, hash: string }[]} */\n  const result = []\n\n  // 2. Let empty be equal to true.\n  let empty = true\n\n  // 3. For each token returned by splitting metadata on spaces:\n  for (const token of metadata.split(' ')) {\n    // 1. Set empty to false.\n    empty = false\n\n    // 2. Parse token as a hash-with-options.\n    const parsedToken = parseHashWithOptions.exec(token)\n\n    // 3. If token does not parse, continue to the next token.\n    if (\n      parsedToken === null ||\n      parsedToken.groups === undefined ||\n      parsedToken.groups.algo === undefined\n    ) {\n      // Note: Chromium blocks the request at this point, but Firefox\n      // gives a warning that an invalid integrity was given. The\n      // correct behavior is to ignore these, and subsequently not\n      // check the integrity of the resource.\n      continue\n    }\n\n    // 4. Let algorithm be the hash-algo component of token.\n    const algorithm = parsedToken.groups.algo.toLowerCase()\n\n    // 5. If algorithm is a hash function recognized by the user\n    //    agent, add the parsed token to result.\n    if (supportedHashes.includes(algorithm)) {\n      result.push(parsedToken.groups)\n    }\n  }\n\n  // 4. Return no metadata if empty is true, otherwise return result.\n  if (empty === true) {\n    return 'no metadata'\n  }\n\n  return result\n}\n\n/**\n * @param {{ algo: 'sha256' | 'sha384' | 'sha512' }[]} metadataList\n */\nfunction getStrongestMetadata (metadataList) {\n  // Let algorithm be the algo component of the first item in metadataList.\n  // Can be sha256\n  let algorithm = metadataList[0].algo\n  // If the algorithm is sha512, then it is the strongest\n  // and we can return immediately\n  if (algorithm[3] === '5') {\n    return algorithm\n  }\n\n  for (let i = 1; i < metadataList.length; ++i) {\n    const metadata = metadataList[i]\n    // If the algorithm is sha512, then it is the strongest\n    // and we can break the loop immediately\n    if (metadata.algo[3] === '5') {\n      algorithm = 'sha512'\n      break\n    // If the algorithm is sha384, then a potential sha256 or sha384 is ignored\n    } else if (algorithm[3] === '3') {\n      continue\n    // algorithm is sha256, check if algorithm is sha384 and if so, set it as\n    // the strongest\n    } else if (metadata.algo[3] === '3') {\n      algorithm = 'sha384'\n    }\n  }\n  return algorithm\n}\n\nfunction filterMetadataListByAlgorithm (metadataList, algorithm) {\n  if (metadataList.length === 1) {\n    return metadataList\n  }\n\n  let pos = 0\n  for (let i = 0; i < metadataList.length; ++i) {\n    if (metadataList[i].algo === algorithm) {\n      metadataList[pos++] = metadataList[i]\n    }\n  }\n\n  metadataList.length = pos\n\n  return metadataList\n}\n\n/**\n * Compares two base64 strings, allowing for base64url\n * in the second string.\n *\n* @param {string} actualValue always base64\n * @param {string} expectedValue base64 or base64url\n * @returns {boolean}\n */\nfunction compareBase64Mixed (actualValue, expectedValue) {\n  if (actualValue.length !== expectedValue.length) {\n    return false\n  }\n  for (let i = 0; i < actualValue.length; ++i) {\n    if (actualValue[i] !== expectedValue[i]) {\n      if (\n        (actualValue[i] === '+' && expectedValue[i] === '-') ||\n        (actualValue[i] === '/' && expectedValue[i] === '_')\n      ) {\n        continue\n      }\n      return false\n    }\n  }\n\n  return true\n}\n\n// https://w3c.github.io/webappsec-upgrade-insecure-requests/#upgrade-request\nfunction tryUpgradeRequestToAPotentiallyTrustworthyURL (request) {\n  // TODO\n}\n\n/**\n * @link {https://html.spec.whatwg.org/multipage/origin.html#same-origin}\n * @param {URL} A\n * @param {URL} B\n */\nfunction sameOrigin (A, B) {\n  // 1. If A and B are the same opaque origin, then return true.\n  if (A.origin === B.origin && A.origin === 'null') {\n    return true\n  }\n\n  // 2. If A and B are both tuple origins and their schemes,\n  //    hosts, and port are identical, then return true.\n  if (A.protocol === B.protocol && A.hostname === B.hostname && A.port === B.port) {\n    return true\n  }\n\n  // 3. Return false.\n  return false\n}\n\nfunction createDeferredPromise () {\n  let res\n  let rej\n  const promise = new Promise((resolve, reject) => {\n    res = resolve\n    rej = reject\n  })\n\n  return { promise, resolve: res, reject: rej }\n}\n\nfunction isAborted (fetchParams) {\n  return fetchParams.controller.state === 'aborted'\n}\n\nfunction isCancelled (fetchParams) {\n  return fetchParams.controller.state === 'aborted' ||\n    fetchParams.controller.state === 'terminated'\n}\n\nconst normalizeMethodRecord = {\n  delete: 'DELETE',\n  DELETE: 'DELETE',\n  get: 'GET',\n  GET: 'GET',\n  head: 'HEAD',\n  HEAD: 'HEAD',\n  options: 'OPTIONS',\n  OPTIONS: 'OPTIONS',\n  post: 'POST',\n  POST: 'POST',\n  put: 'PUT',\n  PUT: 'PUT'\n}\n\n// Note: object prototypes should not be able to be referenced. e.g. `Object#hasOwnProperty`.\nObject.setPrototypeOf(normalizeMethodRecord, null)\n\n/**\n * @see https://fetch.spec.whatwg.org/#concept-method-normalize\n * @param {string} method\n */\nfunction normalizeMethod (method) {\n  return normalizeMethodRecord[method.toLowerCase()] ?? method\n}\n\n// https://infra.spec.whatwg.org/#serialize-a-javascript-value-to-a-json-string\nfunction serializeJavascriptValueToJSONString (value) {\n  // 1. Let result be ? Call(%JSON.stringify%, undefined, Â« value Â»).\n  const result = JSON.stringify(value)\n\n  // 2. If result is undefined, then throw a TypeError.\n  if (result === undefined) {\n    throw new TypeError('Value is not JSON serializable')\n  }\n\n  // 3. Assert: result is a string.\n  assert(typeof result === 'string')\n\n  // 4. Return result.\n  return result\n}\n\n// https://tc39.es/ecma262/#sec-%25iteratorprototype%25-object\nconst esIteratorPrototype = Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]()))\n\n/**\n * @see https://webidl.spec.whatwg.org/#dfn-iterator-prototype-object\n * @param {() => unknown[]} iterator\n * @param {string} name name of the instance\n * @param {'key'|'value'|'key+value'} kind\n */\nfunction makeIterator (iterator, name, kind) {\n  const object = {\n    index: 0,\n    kind,\n    target: iterator\n  }\n\n  const i = {\n    next () {\n      // 1. Let interface be the interface for which the iterator prototype object exists.\n\n      // 2. Let thisValue be the this value.\n\n      // 3. Let object be ? ToObject(thisValue).\n\n      // 4. If object is a platform object, then perform a security\n      //    check, passing:\n\n      // 5. If object is not a default iterator object for interface,\n      //    then throw a TypeError.\n      if (Object.getPrototypeOf(this) !== i) {\n        throw new TypeError(\n          `'next' called on an object that does not implement interface ${name} Iterator.`\n        )\n      }\n\n      // 6. Let index be objectâ€™s index.\n      // 7. Let kind be objectâ€™s kind.\n      // 8. Let values be objectâ€™s target's value pairs to iterate over.\n      const { index, kind, target } = object\n      const values = target()\n\n      // 9. Let len be the length of values.\n      const len = values.length\n\n      // 10. If index is greater than or equal to len, then return\n      //     CreateIterResultObject(undefined, true).\n      if (index >= len) {\n        return { value: undefined, done: true }\n      }\n\n      // 11. Let pair be the entry in values at index index.\n      const pair = values[index]\n\n      // 12. Set objectâ€™s index to index + 1.\n      object.index = index + 1\n\n      // 13. Return the iterator result for pair and kind.\n      return iteratorResult(pair, kind)\n    },\n    // The class string of an iterator prototype object for a given interface is the\n    // result of concatenating the identifier of the interface and the string \" Iterator\".\n    [Symbol.toStringTag]: `${name} Iterator`\n  }\n\n  // The [[Prototype]] internal slot of an iterator prototype object must be %IteratorPrototype%.\n  Object.setPrototypeOf(i, esIteratorPrototype)\n  // esIteratorPrototype needs to be the prototype of i\n  // which is the prototype of an empty object. Yes, it's confusing.\n  return Object.setPrototypeOf({}, i)\n}\n\n// https://webidl.spec.whatwg.org/#iterator-result\nfunction iteratorResult (pair, kind) {\n  let result\n\n  // 1. Let result be a value determined by the value of kind:\n  switch (kind) {\n    case 'key': {\n      // 1. Let idlKey be pairâ€™s key.\n      // 2. Let key be the result of converting idlKey to an\n      //    ECMAScript value.\n      // 3. result is key.\n      result = pair[0]\n      break\n    }\n    case 'value': {\n      // 1. Let idlValue be pairâ€™s value.\n      // 2. Let value be the result of converting idlValue to\n      //    an ECMAScript value.\n      // 3. result is value.\n      result = pair[1]\n      break\n    }\n    case 'key+value': {\n      // 1. Let idlKey be pairâ€™s key.\n      // 2. Let idlValue be pairâ€™s value.\n      // 3. Let key be the result of converting idlKey to an\n      //    ECMAScript value.\n      // 4. Let value be the result of converting idlValue to\n      //    an ECMAScript value.\n      // 5. Let array be ! ArrayCreate(2).\n      // 6. Call ! CreateDataProperty(array, \"0\", key).\n      // 7. Call ! CreateDataProperty(array, \"1\", value).\n      // 8. result is array.\n      result = pair\n      break\n    }\n  }\n\n  // 2. Return CreateIterResultObject(result, false).\n  return { value: result, done: false }\n}\n\n/**\n * @see https://fetch.spec.whatwg.org/#body-fully-read\n */\nasync function fullyReadBody (body, processBody, processBodyError) {\n  // 1. If taskDestination is null, then set taskDestination to\n  //    the result of starting a new parallel queue.\n\n  // 2. Let successSteps given a byte sequence bytes be to queue a\n  //    fetch task to run processBody given bytes, with taskDestination.\n  const successSteps = processBody\n\n  // 3. Let errorSteps be to queue a fetch task to run processBodyError,\n  //    with taskDestination.\n  const errorSteps = processBodyError\n\n  // 4. Let reader be the result of getting a reader for bodyâ€™s stream.\n  //    If that threw an exception, then run errorSteps with that\n  //    exception and return.\n  let reader\n\n  try {\n    reader = body.stream.getReader()\n  } catch (e) {\n    errorSteps(e)\n    return\n  }\n\n  // 5. Read all bytes from reader, given successSteps and errorSteps.\n  try {\n    const result = await readAllBytes(reader)\n    successSteps(result)\n  } catch (e) {\n    errorSteps(e)\n  }\n}\n\n/** @type {ReadableStream} */\nlet ReadableStream = globalThis.ReadableStream\n\nfunction isReadableStreamLike (stream) {\n  if (!ReadableStream) {\n    ReadableStream = require('stream/web').ReadableStream\n  }\n\n  return stream instanceof ReadableStream || (\n    stream[Symbol.toStringTag] === 'ReadableStream' &&\n    typeof stream.tee === 'function'\n  )\n}\n\nconst MAXIMUM_ARGUMENT_LENGTH = 65535\n\n/**\n * @see https://infra.spec.whatwg.org/#isomorphic-decode\n * @param {number[]|Uint8Array} input\n */\nfunction isomorphicDecode (input) {\n  // 1. To isomorphic decode a byte sequence input, return a string whose code point\n  //    length is equal to inputâ€™s length and whose code points have the same values\n  //    as the values of inputâ€™s bytes, in the same order.\n\n  if (input.length < MAXIMUM_ARGUMENT_LENGTH) {\n    return String.fromCharCode(...input)\n  }\n\n  return input.reduce((previous, current) => previous + String.fromCharCode(current), '')\n}\n\n/**\n * @param {ReadableStreamController<Uint8Array>} controller\n */\nfunction readableStreamClose (controller) {\n  try {\n    controller.close()\n  } catch (err) {\n    // TODO: add comment explaining why this error occurs.\n    if (!err.message.includes('Controller is already closed')) {\n      throw err\n    }\n  }\n}\n\n/**\n * @see https://infra.spec.whatwg.org/#isomorphic-encode\n * @param {string} input\n */\nfunction isomorphicEncode (input) {\n  // 1. Assert: input contains no code points greater than U+00FF.\n  for (let i = 0; i < input.length; i++) {\n    assert(input.charCodeAt(i) <= 0xFF)\n  }\n\n  // 2. Return a byte sequence whose length is equal to inputâ€™s code\n  //    point length and whose bytes have the same values as the\n  //    values of inputâ€™s code points, in the same order\n  return input\n}\n\n/**\n * @see https://streams.spec.whatwg.org/#readablestreamdefaultreader-read-all-bytes\n * @see https://streams.spec.whatwg.org/#read-loop\n * @param {ReadableStreamDefaultReader} reader\n */\nasync function readAllBytes (reader) {\n  const bytes = []\n  let byteLength = 0\n\n  while (true) {\n    const { done, value: chunk } = await reader.read()\n\n    if (done) {\n      // 1. Call successSteps with bytes.\n      return Buffer.concat(bytes, byteLength)\n    }\n\n    // 1. If chunk is not a Uint8Array object, call failureSteps\n    //    with a TypeError and abort these steps.\n    if (!isUint8Array(chunk)) {\n      throw new TypeError('Received non-Uint8Array chunk')\n    }\n\n    // 2. Append the bytes represented by chunk to bytes.\n    bytes.push(chunk)\n    byteLength += chunk.length\n\n    // 3. Read-loop given reader, bytes, successSteps, and failureSteps.\n  }\n}\n\n/**\n * @see https://fetch.spec.whatwg.org/#is-local\n * @param {URL} url\n */\nfunction urlIsLocal (url) {\n  assert('protocol' in url) // ensure it's a url object\n\n  const protocol = url.protocol\n\n  return protocol === 'about:' || protocol === 'blob:' || protocol === 'data:'\n}\n\n/**\n * @param {string|URL} url\n */\nfunction urlHasHttpsScheme (url) {\n  if (typeof url === 'string') {\n    return url.startsWith('https:')\n  }\n\n  return url.protocol === 'https:'\n}\n\n/**\n * @see https://fetch.spec.whatwg.org/#http-scheme\n * @param {URL} url\n */\nfunction urlIsHttpHttpsScheme (url) {\n  assert('protocol' in url) // ensure it's a url object\n\n  const protocol = url.protocol\n\n  return protocol === 'http:' || protocol === 'https:'\n}\n\n/**\n * Fetch supports node >= 16.8.0, but Object.hasOwn was added in v16.9.0.\n */\nconst hasOwn = Object.hasOwn || ((dict, key) => Object.prototype.hasOwnProperty.call(dict, key))\n\nmodule.exports = {\n  isAborted,\n  isCancelled,\n  createDeferredPromise,\n  ReadableStreamFrom,\n  toUSVString,\n  tryUpgradeRequestToAPotentiallyTrustworthyURL,\n  coarsenedSharedCurrentTime,\n  determineRequestsReferrer,\n  makePolicyContainer,\n  clonePolicyContainer,\n  appendFetchMetadata,\n  appendRequestOriginHeader,\n  TAOCheck,\n  corsCheck,\n  crossOriginResourcePolicyCheck,\n  createOpaqueTimingInfo,\n  setRequestReferrerPolicyOnRedirect,\n  isValidHTTPToken,\n  requestBadPort,\n  requestCurrentURL,\n  responseURL,\n  responseLocationURL,\n  isBlobLike,\n  isURLPotentiallyTrustworthy,\n  isValidReasonPhrase,\n  sameOrigin,\n  normalizeMethod,\n  serializeJavascriptValueToJSONString,\n  makeIterator,\n  isValidHeaderName,\n  isValidHeaderValue,\n  hasOwn,\n  isErrorLike,\n  fullyReadBody,\n  bytesMatch,\n  isReadableStreamLike,\n  readableStreamClose,\n  isomorphicEncode,\n  isomorphicDecode,\n  urlIsLocal,\n  urlHasHttpsScheme,\n  urlIsHttpHttpsScheme,\n  readAllBytes,\n  normalizeMethodRecord,\n  parseMetadata\n}\n","'use strict'\n\nmodule.exports = {\n  kUrl: Symbol('url'),\n  kHeaders: Symbol('headers'),\n  kSignal: Symbol('signal'),\n  kState: Symbol('state'),\n  kGuard: Symbol('guard'),\n  kRealm: Symbol('realm')\n}\n","'use strict'\n\nconst { types } = require('util')\nconst { hasOwn, toUSVString } = require('./util')\n\n/** @type {import('../../types/webidl').Webidl} */\nconst webidl = {}\nwebidl.converters = {}\nwebidl.util = {}\nwebidl.errors = {}\n\nwebidl.errors.exception = function (message) {\n  return new TypeError(`${message.header}: ${message.message}`)\n}\n\nwebidl.errors.conversionFailed = function (context) {\n  const plural = context.types.length === 1 ? '' : ' one of'\n  const message =\n    `${context.argument} could not be converted to` +\n    `${plural}: ${context.types.join(', ')}.`\n\n  return webidl.errors.exception({\n    header: context.prefix,\n    message\n  })\n}\n\nwebidl.errors.invalidArgument = function (context) {\n  return webidl.errors.exception({\n    header: context.prefix,\n    message: `\"${context.value}\" is an invalid ${context.type}.`\n  })\n}\n\n// https://webidl.spec.whatwg.org/#implements\nwebidl.brandCheck = function (V, I, opts = undefined) {\n  if (opts?.strict !== false && !(V instanceof I)) {\n    throw new TypeError('Illegal invocation')\n  } else {\n    return V?.[Symbol.toStringTag] === I.prototype[Symbol.toStringTag]\n  }\n}\n\nwebidl.argumentLengthCheck = function ({ length }, min, ctx) {\n  if (length < min) {\n    throw webidl.errors.exception({\n      message: `${min} argument${min !== 1 ? 's' : ''} required, ` +\n               `but${length ? ' only' : ''} ${length} found.`,\n      ...ctx\n    })\n  }\n}\n\nwebidl.illegalConstructor = function () {\n  throw webidl.errors.exception({\n    header: 'TypeError',\n    message: 'Illegal constructor'\n  })\n}\n\n// https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values\nwebidl.util.Type = function (V) {\n  switch (typeof V) {\n    case 'undefined': return 'Undefined'\n    case 'boolean': return 'Boolean'\n    case 'string': return 'String'\n    case 'symbol': return 'Symbol'\n    case 'number': return 'Number'\n    case 'bigint': return 'BigInt'\n    case 'function':\n    case 'object': {\n      if (V === null) {\n        return 'Null'\n      }\n\n      return 'Object'\n    }\n  }\n}\n\n// https://webidl.spec.whatwg.org/#abstract-opdef-converttoint\nwebidl.util.ConvertToInt = function (V, bitLength, signedness, opts = {}) {\n  let upperBound\n  let lowerBound\n\n  // 1. If bitLength is 64, then:\n  if (bitLength === 64) {\n    // 1. Let upperBound be 2^53 âˆ’ 1.\n    upperBound = Math.pow(2, 53) - 1\n\n    // 2. If signedness is \"unsigned\", then let lowerBound be 0.\n    if (signedness === 'unsigned') {\n      lowerBound = 0\n    } else {\n      // 3. Otherwise let lowerBound be âˆ’2^53 + 1.\n      lowerBound = Math.pow(-2, 53) + 1\n    }\n  } else if (signedness === 'unsigned') {\n    // 2. Otherwise, if signedness is \"unsigned\", then:\n\n    // 1. Let lowerBound be 0.\n    lowerBound = 0\n\n    // 2. Let upperBound be 2^bitLength âˆ’ 1.\n    upperBound = Math.pow(2, bitLength) - 1\n  } else {\n    // 3. Otherwise:\n\n    // 1. Let lowerBound be -2^bitLength âˆ’ 1.\n    lowerBound = Math.pow(-2, bitLength) - 1\n\n    // 2. Let upperBound be 2^bitLength âˆ’ 1 âˆ’ 1.\n    upperBound = Math.pow(2, bitLength - 1) - 1\n  }\n\n  // 4. Let x be ? ToNumber(V).\n  let x = Number(V)\n\n  // 5. If x is âˆ’0, then set x to +0.\n  if (x === 0) {\n    x = 0\n  }\n\n  // 6. If the conversion is to an IDL type associated\n  //    with the [EnforceRange] extended attribute, then:\n  if (opts.enforceRange === true) {\n    // 1. If x is NaN, +âˆž, or âˆ’âˆž, then throw a TypeError.\n    if (\n      Number.isNaN(x) ||\n      x === Number.POSITIVE_INFINITY ||\n      x === Number.NEGATIVE_INFINITY\n    ) {\n      throw webidl.errors.exception({\n        header: 'Integer conversion',\n        message: `Could not convert ${V} to an integer.`\n      })\n    }\n\n    // 2. Set x to IntegerPart(x).\n    x = webidl.util.IntegerPart(x)\n\n    // 3. If x < lowerBound or x > upperBound, then\n    //    throw a TypeError.\n    if (x < lowerBound || x > upperBound) {\n      throw webidl.errors.exception({\n        header: 'Integer conversion',\n        message: `Value must be between ${lowerBound}-${upperBound}, got ${x}.`\n      })\n    }\n\n    // 4. Return x.\n    return x\n  }\n\n  // 7. If x is not NaN and the conversion is to an IDL\n  //    type associated with the [Clamp] extended\n  //    attribute, then:\n  if (!Number.isNaN(x) && opts.clamp === true) {\n    // 1. Set x to min(max(x, lowerBound), upperBound).\n    x = Math.min(Math.max(x, lowerBound), upperBound)\n\n    // 2. Round x to the nearest integer, choosing the\n    //    even integer if it lies halfway between two,\n    //    and choosing +0 rather than âˆ’0.\n    if (Math.floor(x) % 2 === 0) {\n      x = Math.floor(x)\n    } else {\n      x = Math.ceil(x)\n    }\n\n    // 3. Return x.\n    return x\n  }\n\n  // 8. If x is NaN, +0, +âˆž, or âˆ’âˆž, then return +0.\n  if (\n    Number.isNaN(x) ||\n    (x === 0 && Object.is(0, x)) ||\n    x === Number.POSITIVE_INFINITY ||\n    x === Number.NEGATIVE_INFINITY\n  ) {\n    return 0\n  }\n\n  // 9. Set x to IntegerPart(x).\n  x = webidl.util.IntegerPart(x)\n\n  // 10. Set x to x modulo 2^bitLength.\n  x = x % Math.pow(2, bitLength)\n\n  // 11. If signedness is \"signed\" and x â‰¥ 2^bitLength âˆ’ 1,\n  //    then return x âˆ’ 2^bitLength.\n  if (signedness === 'signed' && x >= Math.pow(2, bitLength) - 1) {\n    return x - Math.pow(2, bitLength)\n  }\n\n  // 12. Otherwise, return x.\n  return x\n}\n\n// https://webidl.spec.whatwg.org/#abstract-opdef-integerpart\nwebidl.util.IntegerPart = function (n) {\n  // 1. Let r be floor(abs(n)).\n  const r = Math.floor(Math.abs(n))\n\n  // 2. If n < 0, then return -1 Ã— r.\n  if (n < 0) {\n    return -1 * r\n  }\n\n  // 3. Otherwise, return r.\n  return r\n}\n\n// https://webidl.spec.whatwg.org/#es-sequence\nwebidl.sequenceConverter = function (converter) {\n  return (V) => {\n    // 1. If Type(V) is not Object, throw a TypeError.\n    if (webidl.util.Type(V) !== 'Object') {\n      throw webidl.errors.exception({\n        header: 'Sequence',\n        message: `Value of type ${webidl.util.Type(V)} is not an Object.`\n      })\n    }\n\n    // 2. Let method be ? GetMethod(V, @@iterator).\n    /** @type {Generator} */\n    const method = V?.[Symbol.iterator]?.()\n    const seq = []\n\n    // 3. If method is undefined, throw a TypeError.\n    if (\n      method === undefined ||\n      typeof method.next !== 'function'\n    ) {\n      throw webidl.errors.exception({\n        header: 'Sequence',\n        message: 'Object is not an iterator.'\n      })\n    }\n\n    // https://webidl.spec.whatwg.org/#create-sequence-from-iterable\n    while (true) {\n      const { done, value } = method.next()\n\n      if (done) {\n        break\n      }\n\n      seq.push(converter(value))\n    }\n\n    return seq\n  }\n}\n\n// https://webidl.spec.whatwg.org/#es-to-record\nwebidl.recordConverter = function (keyConverter, valueConverter) {\n  return (O) => {\n    // 1. If Type(O) is not Object, throw a TypeError.\n    if (webidl.util.Type(O) !== 'Object') {\n      throw webidl.errors.exception({\n        header: 'Record',\n        message: `Value of type ${webidl.util.Type(O)} is not an Object.`\n      })\n    }\n\n    // 2. Let result be a new empty instance of record<K, V>.\n    const result = {}\n\n    if (!types.isProxy(O)) {\n      // Object.keys only returns enumerable properties\n      const keys = Object.keys(O)\n\n      for (const key of keys) {\n        // 1. Let typedKey be key converted to an IDL value of type K.\n        const typedKey = keyConverter(key)\n\n        // 2. Let value be ? Get(O, key).\n        // 3. Let typedValue be value converted to an IDL value of type V.\n        const typedValue = valueConverter(O[key])\n\n        // 4. Set result[typedKey] to typedValue.\n        result[typedKey] = typedValue\n      }\n\n      // 5. Return result.\n      return result\n    }\n\n    // 3. Let keys be ? O.[[OwnPropertyKeys]]().\n    const keys = Reflect.ownKeys(O)\n\n    // 4. For each key of keys.\n    for (const key of keys) {\n      // 1. Let desc be ? O.[[GetOwnProperty]](key).\n      const desc = Reflect.getOwnPropertyDescriptor(O, key)\n\n      // 2. If desc is not undefined and desc.[[Enumerable]] is true:\n      if (desc?.enumerable) {\n        // 1. Let typedKey be key converted to an IDL value of type K.\n        const typedKey = keyConverter(key)\n\n        // 2. Let value be ? Get(O, key).\n        // 3. Let typedValue be value converted to an IDL value of type V.\n        const typedValue = valueConverter(O[key])\n\n        // 4. Set result[typedKey] to typedValue.\n        result[typedKey] = typedValue\n      }\n    }\n\n    // 5. Return result.\n    return result\n  }\n}\n\nwebidl.interfaceConverter = function (i) {\n  return (V, opts = {}) => {\n    if (opts.strict !== false && !(V instanceof i)) {\n      throw webidl.errors.exception({\n        header: i.name,\n        message: `Expected ${V} to be an instance of ${i.name}.`\n      })\n    }\n\n    return V\n  }\n}\n\nwebidl.dictionaryConverter = function (converters) {\n  return (dictionary) => {\n    const type = webidl.util.Type(dictionary)\n    const dict = {}\n\n    if (type === 'Null' || type === 'Undefined') {\n      return dict\n    } else if (type !== 'Object') {\n      throw webidl.errors.exception({\n        header: 'Dictionary',\n        message: `Expected ${dictionary} to be one of: Null, Undefined, Object.`\n      })\n    }\n\n    for (const options of converters) {\n      const { key, defaultValue, required, converter } = options\n\n      if (required === true) {\n        if (!hasOwn(dictionary, key)) {\n          throw webidl.errors.exception({\n            header: 'Dictionary',\n            message: `Missing required key \"${key}\".`\n          })\n        }\n      }\n\n      let value = dictionary[key]\n      const hasDefault = hasOwn(options, 'defaultValue')\n\n      // Only use defaultValue if value is undefined and\n      // a defaultValue options was provided.\n      if (hasDefault && value !== null) {\n        value = value ?? defaultValue\n      }\n\n      // A key can be optional and have no default value.\n      // When this happens, do not perform a conversion,\n      // and do not assign the key a value.\n      if (required || hasDefault || value !== undefined) {\n        value = converter(value)\n\n        if (\n          options.allowedValues &&\n          !options.allowedValues.includes(value)\n        ) {\n          throw webidl.errors.exception({\n            header: 'Dictionary',\n            message: `${value} is not an accepted type. Expected one of ${options.allowedValues.join(', ')}.`\n          })\n        }\n\n        dict[key] = value\n      }\n    }\n\n    return dict\n  }\n}\n\nwebidl.nullableConverter = function (converter) {\n  return (V) => {\n    if (V === null) {\n      return V\n    }\n\n    return converter(V)\n  }\n}\n\n// https://webidl.spec.whatwg.org/#es-DOMString\nwebidl.converters.DOMString = function (V, opts = {}) {\n  // 1. If V is null and the conversion is to an IDL type\n  //    associated with the [LegacyNullToEmptyString]\n  //    extended attribute, then return the DOMString value\n  //    that represents the empty string.\n  if (V === null && opts.legacyNullToEmptyString) {\n    return ''\n  }\n\n  // 2. Let x be ? ToString(V).\n  if (typeof V === 'symbol') {\n    throw new TypeError('Could not convert argument of type symbol to string.')\n  }\n\n  // 3. Return the IDL DOMString value that represents the\n  //    same sequence of code units as the one the\n  //    ECMAScript String value x represents.\n  return String(V)\n}\n\n// https://webidl.spec.whatwg.org/#es-ByteString\nwebidl.converters.ByteString = function (V) {\n  // 1. Let x be ? ToString(V).\n  // Note: DOMString converter perform ? ToString(V)\n  const x = webidl.converters.DOMString(V)\n\n  // 2. If the value of any element of x is greater than\n  //    255, then throw a TypeError.\n  for (let index = 0; index < x.length; index++) {\n    if (x.charCodeAt(index) > 255) {\n      throw new TypeError(\n        'Cannot convert argument to a ByteString because the character at ' +\n        `index ${index} has a value of ${x.charCodeAt(index)} which is greater than 255.`\n      )\n    }\n  }\n\n  // 3. Return an IDL ByteString value whose length is the\n  //    length of x, and where the value of each element is\n  //    the value of the corresponding element of x.\n  return x\n}\n\n// https://webidl.spec.whatwg.org/#es-USVString\nwebidl.converters.USVString = toUSVString\n\n// https://webidl.spec.whatwg.org/#es-boolean\nwebidl.converters.boolean = function (V) {\n  // 1. Let x be the result of computing ToBoolean(V).\n  const x = Boolean(V)\n\n  // 2. Return the IDL boolean value that is the one that represents\n  //    the same truth value as the ECMAScript Boolean value x.\n  return x\n}\n\n// https://webidl.spec.whatwg.org/#es-any\nwebidl.converters.any = function (V) {\n  return V\n}\n\n// https://webidl.spec.whatwg.org/#es-long-long\nwebidl.converters['long long'] = function (V) {\n  // 1. Let x be ? ConvertToInt(V, 64, \"signed\").\n  const x = webidl.util.ConvertToInt(V, 64, 'signed')\n\n  // 2. Return the IDL long long value that represents\n  //    the same numeric value as x.\n  return x\n}\n\n// https://webidl.spec.whatwg.org/#es-unsigned-long-long\nwebidl.converters['unsigned long long'] = function (V) {\n  // 1. Let x be ? ConvertToInt(V, 64, \"unsigned\").\n  const x = webidl.util.ConvertToInt(V, 64, 'unsigned')\n\n  // 2. Return the IDL unsigned long long value that\n  //    represents the same numeric value as x.\n  return x\n}\n\n// https://webidl.spec.whatwg.org/#es-unsigned-long\nwebidl.converters['unsigned long'] = function (V) {\n  // 1. Let x be ? ConvertToInt(V, 32, \"unsigned\").\n  const x = webidl.util.ConvertToInt(V, 32, 'unsigned')\n\n  // 2. Return the IDL unsigned long value that\n  //    represents the same numeric value as x.\n  return x\n}\n\n// https://webidl.spec.whatwg.org/#es-unsigned-short\nwebidl.converters['unsigned short'] = function (V, opts) {\n  // 1. Let x be ? ConvertToInt(V, 16, \"unsigned\").\n  const x = webidl.util.ConvertToInt(V, 16, 'unsigned', opts)\n\n  // 2. Return the IDL unsigned short value that represents\n  //    the same numeric value as x.\n  return x\n}\n\n// https://webidl.spec.whatwg.org/#idl-ArrayBuffer\nwebidl.converters.ArrayBuffer = function (V, opts = {}) {\n  // 1. If Type(V) is not Object, or V does not have an\n  //    [[ArrayBufferData]] internal slot, then throw a\n  //    TypeError.\n  // see: https://tc39.es/ecma262/#sec-properties-of-the-arraybuffer-instances\n  // see: https://tc39.es/ecma262/#sec-properties-of-the-sharedarraybuffer-instances\n  if (\n    webidl.util.Type(V) !== 'Object' ||\n    !types.isAnyArrayBuffer(V)\n  ) {\n    throw webidl.errors.conversionFailed({\n      prefix: `${V}`,\n      argument: `${V}`,\n      types: ['ArrayBuffer']\n    })\n  }\n\n  // 2. If the conversion is not to an IDL type associated\n  //    with the [AllowShared] extended attribute, and\n  //    IsSharedArrayBuffer(V) is true, then throw a\n  //    TypeError.\n  if (opts.allowShared === false && types.isSharedArrayBuffer(V)) {\n    throw webidl.errors.exception({\n      header: 'ArrayBuffer',\n      message: 'SharedArrayBuffer is not allowed.'\n    })\n  }\n\n  // 3. If the conversion is not to an IDL type associated\n  //    with the [AllowResizable] extended attribute, and\n  //    IsResizableArrayBuffer(V) is true, then throw a\n  //    TypeError.\n  // Note: resizable ArrayBuffers are currently a proposal.\n\n  // 4. Return the IDL ArrayBuffer value that is a\n  //    reference to the same object as V.\n  return V\n}\n\nwebidl.converters.TypedArray = function (V, T, opts = {}) {\n  // 1. Let T be the IDL type V is being converted to.\n\n  // 2. If Type(V) is not Object, or V does not have a\n  //    [[TypedArrayName]] internal slot with a value\n  //    equal to Tâ€™s name, then throw a TypeError.\n  if (\n    webidl.util.Type(V) !== 'Object' ||\n    !types.isTypedArray(V) ||\n    V.constructor.name !== T.name\n  ) {\n    throw webidl.errors.conversionFailed({\n      prefix: `${T.name}`,\n      argument: `${V}`,\n      types: [T.name]\n    })\n  }\n\n  // 3. If the conversion is not to an IDL type associated\n  //    with the [AllowShared] extended attribute, and\n  //    IsSharedArrayBuffer(V.[[ViewedArrayBuffer]]) is\n  //    true, then throw a TypeError.\n  if (opts.allowShared === false && types.isSharedArrayBuffer(V.buffer)) {\n    throw webidl.errors.exception({\n      header: 'ArrayBuffer',\n      message: 'SharedArrayBuffer is not allowed.'\n    })\n  }\n\n  // 4. If the conversion is not to an IDL type associated\n  //    with the [AllowResizable] extended attribute, and\n  //    IsResizableArrayBuffer(V.[[ViewedArrayBuffer]]) is\n  //    true, then throw a TypeError.\n  // Note: resizable array buffers are currently a proposal\n\n  // 5. Return the IDL value of type T that is a reference\n  //    to the same object as V.\n  return V\n}\n\nwebidl.converters.DataView = function (V, opts = {}) {\n  // 1. If Type(V) is not Object, or V does not have a\n  //    [[DataView]] internal slot, then throw a TypeError.\n  if (webidl.util.Type(V) !== 'Object' || !types.isDataView(V)) {\n    throw webidl.errors.exception({\n      header: 'DataView',\n      message: 'Object is not a DataView.'\n    })\n  }\n\n  // 2. If the conversion is not to an IDL type associated\n  //    with the [AllowShared] extended attribute, and\n  //    IsSharedArrayBuffer(V.[[ViewedArrayBuffer]]) is true,\n  //    then throw a TypeError.\n  if (opts.allowShared === false && types.isSharedArrayBuffer(V.buffer)) {\n    throw webidl.errors.exception({\n      header: 'ArrayBuffer',\n      message: 'SharedArrayBuffer is not allowed.'\n    })\n  }\n\n  // 3. If the conversion is not to an IDL type associated\n  //    with the [AllowResizable] extended attribute, and\n  //    IsResizableArrayBuffer(V.[[ViewedArrayBuffer]]) is\n  //    true, then throw a TypeError.\n  // Note: resizable ArrayBuffers are currently a proposal\n\n  // 4. Return the IDL DataView value that is a reference\n  //    to the same object as V.\n  return V\n}\n\n// https://webidl.spec.whatwg.org/#BufferSource\nwebidl.converters.BufferSource = function (V, opts = {}) {\n  if (types.isAnyArrayBuffer(V)) {\n    return webidl.converters.ArrayBuffer(V, opts)\n  }\n\n  if (types.isTypedArray(V)) {\n    return webidl.converters.TypedArray(V, V.constructor)\n  }\n\n  if (types.isDataView(V)) {\n    return webidl.converters.DataView(V, opts)\n  }\n\n  throw new TypeError(`Could not convert ${V} to a BufferSource.`)\n}\n\nwebidl.converters['sequence<ByteString>'] = webidl.sequenceConverter(\n  webidl.converters.ByteString\n)\n\nwebidl.converters['sequence<sequence<ByteString>>'] = webidl.sequenceConverter(\n  webidl.converters['sequence<ByteString>']\n)\n\nwebidl.converters['record<ByteString, ByteString>'] = webidl.recordConverter(\n  webidl.converters.ByteString,\n  webidl.converters.ByteString\n)\n\nmodule.exports = {\n  webidl\n}\n","const assert = require('assert')\nconst { atob } = require('buffer')\nconst { isomorphicDecode } = require('./util')\n\nconst encoder = new TextEncoder()\n\n/**\n * @see https://mimesniff.spec.whatwg.org/#http-token-code-point\n */\nconst HTTP_TOKEN_CODEPOINTS = /^[!#$%&'*+-.^_|~A-Za-z0-9]+$/\nconst HTTP_WHITESPACE_REGEX = /(\\u000A|\\u000D|\\u0009|\\u0020)/ // eslint-disable-line\n/**\n * @see https://mimesniff.spec.whatwg.org/#http-quoted-string-token-code-point\n */\nconst HTTP_QUOTED_STRING_TOKENS = /[\\u0009|\\u0020-\\u007E|\\u0080-\\u00FF]/ // eslint-disable-line\n\n// https://fetch.spec.whatwg.org/#data-url-processor\n/** @param {URL} dataURL */\nfunction dataURLProcessor (dataURL) {\n  // 1. Assert: dataURLâ€™s scheme is \"data\".\n  assert(dataURL.protocol === 'data:')\n\n  // 2. Let input be the result of running the URL\n  // serializer on dataURL with exclude fragment\n  // set to true.\n  let input = URLSerializer(dataURL, true)\n\n  // 3. Remove the leading \"data:\" string from input.\n  input = input.slice(5)\n\n  // 4. Let position point at the start of input.\n  const position = { position: 0 }\n\n  // 5. Let mimeType be the result of collecting a\n  // sequence of code points that are not equal\n  // to U+002C (,), given position.\n  let mimeType = collectASequenceOfCodePointsFast(\n    ',',\n    input,\n    position\n  )\n\n  // 6. Strip leading and trailing ASCII whitespace\n  // from mimeType.\n  // Undici implementation note: we need to store the\n  // length because if the mimetype has spaces removed,\n  // the wrong amount will be sliced from the input in\n  // step #9\n  const mimeTypeLength = mimeType.length\n  mimeType = removeASCIIWhitespace(mimeType, true, true)\n\n  // 7. If position is past the end of input, then\n  // return failure\n  if (position.position >= input.length) {\n    return 'failure'\n  }\n\n  // 8. Advance position by 1.\n  position.position++\n\n  // 9. Let encodedBody be the remainder of input.\n  const encodedBody = input.slice(mimeTypeLength + 1)\n\n  // 10. Let body be the percent-decoding of encodedBody.\n  let body = stringPercentDecode(encodedBody)\n\n  // 11. If mimeType ends with U+003B (;), followed by\n  // zero or more U+0020 SPACE, followed by an ASCII\n  // case-insensitive match for \"base64\", then:\n  if (/;(\\u0020){0,}base64$/i.test(mimeType)) {\n    // 1. Let stringBody be the isomorphic decode of body.\n    const stringBody = isomorphicDecode(body)\n\n    // 2. Set body to the forgiving-base64 decode of\n    // stringBody.\n    body = forgivingBase64(stringBody)\n\n    // 3. If body is failure, then return failure.\n    if (body === 'failure') {\n      return 'failure'\n    }\n\n    // 4. Remove the last 6 code points from mimeType.\n    mimeType = mimeType.slice(0, -6)\n\n    // 5. Remove trailing U+0020 SPACE code points from mimeType,\n    // if any.\n    mimeType = mimeType.replace(/(\\u0020)+$/, '')\n\n    // 6. Remove the last U+003B (;) code point from mimeType.\n    mimeType = mimeType.slice(0, -1)\n  }\n\n  // 12. If mimeType starts with U+003B (;), then prepend\n  // \"text/plain\" to mimeType.\n  if (mimeType.startsWith(';')) {\n    mimeType = 'text/plain' + mimeType\n  }\n\n  // 13. Let mimeTypeRecord be the result of parsing\n  // mimeType.\n  let mimeTypeRecord = parseMIMEType(mimeType)\n\n  // 14. If mimeTypeRecord is failure, then set\n  // mimeTypeRecord to text/plain;charset=US-ASCII.\n  if (mimeTypeRecord === 'failure') {\n    mimeTypeRecord = parseMIMEType('text/plain;charset=US-ASCII')\n  }\n\n  // 15. Return a new data: URL struct whose MIME\n  // type is mimeTypeRecord and body is body.\n  // https://fetch.spec.whatwg.org/#data-url-struct\n  return { mimeType: mimeTypeRecord, body }\n}\n\n// https://url.spec.whatwg.org/#concept-url-serializer\n/**\n * @param {URL} url\n * @param {boolean} excludeFragment\n */\nfunction URLSerializer (url, excludeFragment = false) {\n  if (!excludeFragment) {\n    return url.href\n  }\n\n  const href = url.href\n  const hashLength = url.hash.length\n\n  return hashLength === 0 ? href : href.substring(0, href.length - hashLength)\n}\n\n// https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points\n/**\n * @param {(char: string) => boolean} condition\n * @param {string} input\n * @param {{ position: number }} position\n */\nfunction collectASequenceOfCodePoints (condition, input, position) {\n  // 1. Let result be the empty string.\n  let result = ''\n\n  // 2. While position doesnâ€™t point past the end of input and the\n  // code point at position within input meets the condition condition:\n  while (position.position < input.length && condition(input[position.position])) {\n    // 1. Append that code point to the end of result.\n    result += input[position.position]\n\n    // 2. Advance position by 1.\n    position.position++\n  }\n\n  // 3. Return result.\n  return result\n}\n\n/**\n * A faster collectASequenceOfCodePoints that only works when comparing a single character.\n * @param {string} char\n * @param {string} input\n * @param {{ position: number }} position\n */\nfunction collectASequenceOfCodePointsFast (char, input, position) {\n  const idx = input.indexOf(char, position.position)\n  const start = position.position\n\n  if (idx === -1) {\n    position.position = input.length\n    return input.slice(start)\n  }\n\n  position.position = idx\n  return input.slice(start, position.position)\n}\n\n// https://url.spec.whatwg.org/#string-percent-decode\n/** @param {string} input */\nfunction stringPercentDecode (input) {\n  // 1. Let bytes be the UTF-8 encoding of input.\n  const bytes = encoder.encode(input)\n\n  // 2. Return the percent-decoding of bytes.\n  return percentDecode(bytes)\n}\n\n// https://url.spec.whatwg.org/#percent-decode\n/** @param {Uint8Array} input */\nfunction percentDecode (input) {\n  // 1. Let output be an empty byte sequence.\n  /** @type {number[]} */\n  const output = []\n\n  // 2. For each byte byte in input:\n  for (let i = 0; i < input.length; i++) {\n    const byte = input[i]\n\n    // 1. If byte is not 0x25 (%), then append byte to output.\n    if (byte !== 0x25) {\n      output.push(byte)\n\n    // 2. Otherwise, if byte is 0x25 (%) and the next two bytes\n    // after byte in input are not in the ranges\n    // 0x30 (0) to 0x39 (9), 0x41 (A) to 0x46 (F),\n    // and 0x61 (a) to 0x66 (f), all inclusive, append byte\n    // to output.\n    } else if (\n      byte === 0x25 &&\n      !/^[0-9A-Fa-f]{2}$/i.test(String.fromCharCode(input[i + 1], input[i + 2]))\n    ) {\n      output.push(0x25)\n\n    // 3. Otherwise:\n    } else {\n      // 1. Let bytePoint be the two bytes after byte in input,\n      // decoded, and then interpreted as hexadecimal number.\n      const nextTwoBytes = String.fromCharCode(input[i + 1], input[i + 2])\n      const bytePoint = Number.parseInt(nextTwoBytes, 16)\n\n      // 2. Append a byte whose value is bytePoint to output.\n      output.push(bytePoint)\n\n      // 3. Skip the next two bytes in input.\n      i += 2\n    }\n  }\n\n  // 3. Return output.\n  return Uint8Array.from(output)\n}\n\n// https://mimesniff.spec.whatwg.org/#parse-a-mime-type\n/** @param {string} input */\nfunction parseMIMEType (input) {\n  // 1. Remove any leading and trailing HTTP whitespace\n  // from input.\n  input = removeHTTPWhitespace(input, true, true)\n\n  // 2. Let position be a position variable for input,\n  // initially pointing at the start of input.\n  const position = { position: 0 }\n\n  // 3. Let type be the result of collecting a sequence\n  // of code points that are not U+002F (/) from\n  // input, given position.\n  const type = collectASequenceOfCodePointsFast(\n    '/',\n    input,\n    position\n  )\n\n  // 4. If type is the empty string or does not solely\n  // contain HTTP token code points, then return failure.\n  // https://mimesniff.spec.whatwg.org/#http-token-code-point\n  if (type.length === 0 || !HTTP_TOKEN_CODEPOINTS.test(type)) {\n    return 'failure'\n  }\n\n  // 5. If position is past the end of input, then return\n  // failure\n  if (position.position > input.length) {\n    return 'failure'\n  }\n\n  // 6. Advance position by 1. (This skips past U+002F (/).)\n  position.position++\n\n  // 7. Let subtype be the result of collecting a sequence of\n  // code points that are not U+003B (;) from input, given\n  // position.\n  let subtype = collectASequenceOfCodePointsFast(\n    ';',\n    input,\n    position\n  )\n\n  // 8. Remove any trailing HTTP whitespace from subtype.\n  subtype = removeHTTPWhitespace(subtype, false, true)\n\n  // 9. If subtype is the empty string or does not solely\n  // contain HTTP token code points, then return failure.\n  if (subtype.length === 0 || !HTTP_TOKEN_CODEPOINTS.test(subtype)) {\n    return 'failure'\n  }\n\n  const typeLowercase = type.toLowerCase()\n  const subtypeLowercase = subtype.toLowerCase()\n\n  // 10. Let mimeType be a new MIME type record whose type\n  // is type, in ASCII lowercase, and subtype is subtype,\n  // in ASCII lowercase.\n  // https://mimesniff.spec.whatwg.org/#mime-type\n  const mimeType = {\n    type: typeLowercase,\n    subtype: subtypeLowercase,\n    /** @type {Map<string, string>} */\n    parameters: new Map(),\n    // https://mimesniff.spec.whatwg.org/#mime-type-essence\n    essence: `${typeLowercase}/${subtypeLowercase}`\n  }\n\n  // 11. While position is not past the end of input:\n  while (position.position < input.length) {\n    // 1. Advance position by 1. (This skips past U+003B (;).)\n    position.position++\n\n    // 2. Collect a sequence of code points that are HTTP\n    // whitespace from input given position.\n    collectASequenceOfCodePoints(\n      // https://fetch.spec.whatwg.org/#http-whitespace\n      char => HTTP_WHITESPACE_REGEX.test(char),\n      input,\n      position\n    )\n\n    // 3. Let parameterName be the result of collecting a\n    // sequence of code points that are not U+003B (;)\n    // or U+003D (=) from input, given position.\n    let parameterName = collectASequenceOfCodePoints(\n      (char) => char !== ';' && char !== '=',\n      input,\n      position\n    )\n\n    // 4. Set parameterName to parameterName, in ASCII\n    // lowercase.\n    parameterName = parameterName.toLowerCase()\n\n    // 5. If position is not past the end of input, then:\n    if (position.position < input.length) {\n      // 1. If the code point at position within input is\n      // U+003B (;), then continue.\n      if (input[position.position] === ';') {\n        continue\n      }\n\n      // 2. Advance position by 1. (This skips past U+003D (=).)\n      position.position++\n    }\n\n    // 6. If position is past the end of input, then break.\n    if (position.position > input.length) {\n      break\n    }\n\n    // 7. Let parameterValue be null.\n    let parameterValue = null\n\n    // 8. If the code point at position within input is\n    // U+0022 (\"), then:\n    if (input[position.position] === '\"') {\n      // 1. Set parameterValue to the result of collecting\n      // an HTTP quoted string from input, given position\n      // and the extract-value flag.\n      parameterValue = collectAnHTTPQuotedString(input, position, true)\n\n      // 2. Collect a sequence of code points that are not\n      // U+003B (;) from input, given position.\n      collectASequenceOfCodePointsFast(\n        ';',\n        input,\n        position\n      )\n\n    // 9. Otherwise:\n    } else {\n      // 1. Set parameterValue to the result of collecting\n      // a sequence of code points that are not U+003B (;)\n      // from input, given position.\n      parameterValue = collectASequenceOfCodePointsFast(\n        ';',\n        input,\n        position\n      )\n\n      // 2. Remove any trailing HTTP whitespace from parameterValue.\n      parameterValue = removeHTTPWhitespace(parameterValue, false, true)\n\n      // 3. If parameterValue is the empty string, then continue.\n      if (parameterValue.length === 0) {\n        continue\n      }\n    }\n\n    // 10. If all of the following are true\n    // - parameterName is not the empty string\n    // - parameterName solely contains HTTP token code points\n    // - parameterValue solely contains HTTP quoted-string token code points\n    // - mimeTypeâ€™s parameters[parameterName] does not exist\n    // then set mimeTypeâ€™s parameters[parameterName] to parameterValue.\n    if (\n      parameterName.length !== 0 &&\n      HTTP_TOKEN_CODEPOINTS.test(parameterName) &&\n      (parameterValue.length === 0 || HTTP_QUOTED_STRING_TOKENS.test(parameterValue)) &&\n      !mimeType.parameters.has(parameterName)\n    ) {\n      mimeType.parameters.set(parameterName, parameterValue)\n    }\n  }\n\n  // 12. Return mimeType.\n  return mimeType\n}\n\n// https://infra.spec.whatwg.org/#forgiving-base64-decode\n/** @param {string} data */\nfunction forgivingBase64 (data) {\n  // 1. Remove all ASCII whitespace from data.\n  data = data.replace(/[\\u0009\\u000A\\u000C\\u000D\\u0020]/g, '')  // eslint-disable-line\n\n  // 2. If dataâ€™s code point length divides by 4 leaving\n  // no remainder, then:\n  if (data.length % 4 === 0) {\n    // 1. If data ends with one or two U+003D (=) code points,\n    // then remove them from data.\n    data = data.replace(/=?=$/, '')\n  }\n\n  // 3. If dataâ€™s code point length divides by 4 leaving\n  // a remainder of 1, then return failure.\n  if (data.length % 4 === 1) {\n    return 'failure'\n  }\n\n  // 4. If data contains a code point that is not one of\n  //  U+002B (+)\n  //  U+002F (/)\n  //  ASCII alphanumeric\n  // then return failure.\n  if (/[^+/0-9A-Za-z]/.test(data)) {\n    return 'failure'\n  }\n\n  const binary = atob(data)\n  const bytes = new Uint8Array(binary.length)\n\n  for (let byte = 0; byte < binary.length; byte++) {\n    bytes[byte] = binary.charCodeAt(byte)\n  }\n\n  return bytes\n}\n\n// https://fetch.spec.whatwg.org/#collect-an-http-quoted-string\n// tests: https://fetch.spec.whatwg.org/#example-http-quoted-string\n/**\n * @param {string} input\n * @param {{ position: number }} position\n * @param {boolean?} extractValue\n */\nfunction collectAnHTTPQuotedString (input, position, extractValue) {\n  // 1. Let positionStart be position.\n  const positionStart = position.position\n\n  // 2. Let value be the empty string.\n  let value = ''\n\n  // 3. Assert: the code point at position within input\n  // is U+0022 (\").\n  assert(input[position.position] === '\"')\n\n  // 4. Advance position by 1.\n  position.position++\n\n  // 5. While true:\n  while (true) {\n    // 1. Append the result of collecting a sequence of code points\n    // that are not U+0022 (\") or U+005C (\\) from input, given\n    // position, to value.\n    value += collectASequenceOfCodePoints(\n      (char) => char !== '\"' && char !== '\\\\',\n      input,\n      position\n    )\n\n    // 2. If position is past the end of input, then break.\n    if (position.position >= input.length) {\n      break\n    }\n\n    // 3. Let quoteOrBackslash be the code point at position within\n    // input.\n    const quoteOrBackslash = input[position.position]\n\n    // 4. Advance position by 1.\n    position.position++\n\n    // 5. If quoteOrBackslash is U+005C (\\), then:\n    if (quoteOrBackslash === '\\\\') {\n      // 1. If position is past the end of input, then append\n      // U+005C (\\) to value and break.\n      if (position.position >= input.length) {\n        value += '\\\\'\n        break\n      }\n\n      // 2. Append the code point at position within input to value.\n      value += input[position.position]\n\n      // 3. Advance position by 1.\n      position.position++\n\n    // 6. Otherwise:\n    } else {\n      // 1. Assert: quoteOrBackslash is U+0022 (\").\n      assert(quoteOrBackslash === '\"')\n\n      // 2. Break.\n      break\n    }\n  }\n\n  // 6. If the extract-value flag is set, then return value.\n  if (extractValue) {\n    return value\n  }\n\n  // 7. Return the code points from positionStart to position,\n  // inclusive, within input.\n  return input.slice(positionStart, position.position)\n}\n\n/**\n * @see https://mimesniff.spec.whatwg.org/#serialize-a-mime-type\n */\nfunction serializeAMimeType (mimeType) {\n  assert(mimeType !== 'failure')\n  const { parameters, essence } = mimeType\n\n  // 1. Let serialization be the concatenation of mimeTypeâ€™s\n  //    type, U+002F (/), and mimeTypeâ€™s subtype.\n  let serialization = essence\n\n  // 2. For each name â†’ value of mimeTypeâ€™s parameters:\n  for (let [name, value] of parameters.entries()) {\n    // 1. Append U+003B (;) to serialization.\n    serialization += ';'\n\n    // 2. Append name to serialization.\n    serialization += name\n\n    // 3. Append U+003D (=) to serialization.\n    serialization += '='\n\n    // 4. If value does not solely contain HTTP token code\n    //    points or value is the empty string, then:\n    if (!HTTP_TOKEN_CODEPOINTS.test(value)) {\n      // 1. Precede each occurence of U+0022 (\") or\n      //    U+005C (\\) in value with U+005C (\\).\n      value = value.replace(/(\\\\|\")/g, '\\\\$1')\n\n      // 2. Prepend U+0022 (\") to value.\n      value = '\"' + value\n\n      // 3. Append U+0022 (\") to value.\n      value += '\"'\n    }\n\n    // 5. Append value to serialization.\n    serialization += value\n  }\n\n  // 3. Return serialization.\n  return serialization\n}\n\n/**\n * @see https://fetch.spec.whatwg.org/#http-whitespace\n * @param {string} char\n */\nfunction isHTTPWhiteSpace (char) {\n  return char === '\\r' || char === '\\n' || char === '\\t' || char === ' '\n}\n\n/**\n * @see https://fetch.spec.whatwg.org/#http-whitespace\n * @param {string} str\n */\nfunction removeHTTPWhitespace (str, leading = true, trailing = true) {\n  let lead = 0\n  let trail = str.length - 1\n\n  if (leading) {\n    for (; lead < str.length && isHTTPWhiteSpace(str[lead]); lead++);\n  }\n\n  if (trailing) {\n    for (; trail > 0 && isHTTPWhiteSpace(str[trail]); trail--);\n  }\n\n  return str.slice(lead, trail + 1)\n}\n\n/**\n * @see https://infra.spec.whatwg.org/#ascii-whitespace\n * @param {string} char\n */\nfunction isASCIIWhitespace (char) {\n  return char === '\\r' || char === '\\n' || char === '\\t' || char === '\\f' || char === ' '\n}\n\n/**\n * @see https://infra.spec.whatwg.org/#strip-leading-and-trailing-ascii-whitespace\n */\nfunction removeASCIIWhitespace (str, leading = true, trailing = true) {\n  let lead = 0\n  let trail = str.length - 1\n\n  if (leading) {\n    for (; lead < str.length && isASCIIWhitespace(str[lead]); lead++);\n  }\n\n  if (trailing) {\n    for (; trail > 0 && isASCIIWhitespace(str[trail]); trail--);\n  }\n\n  return str.slice(lead, trail + 1)\n}\n\nmodule.exports = {\n  dataURLProcessor,\n  URLSerializer,\n  collectASequenceOfCodePoints,\n  collectASequenceOfCodePointsFast,\n  stringPercentDecode,\n  parseMIMEType,\n  collectAnHTTPQuotedString,\n  serializeAMimeType\n}\n","'use strict'\n\nconst { Blob, File: NativeFile } = require('buffer')\nconst { types } = require('util')\nconst { kState } = require('./symbols')\nconst { isBlobLike } = require('./util')\nconst { webidl } = require('./webidl')\nconst { parseMIMEType, serializeAMimeType } = require('./dataURL')\nconst { kEnumerableProperty } = require('../core/util')\nconst encoder = new TextEncoder()\n\nclass File extends Blob {\n  constructor (fileBits, fileName, options = {}) {\n    // The File constructor is invoked with two or three parameters, depending\n    // on whether the optional dictionary parameter is used. When the File()\n    // constructor is invoked, user agents must run the following steps:\n    webidl.argumentLengthCheck(arguments, 2, { header: 'File constructor' })\n\n    fileBits = webidl.converters['sequence<BlobPart>'](fileBits)\n    fileName = webidl.converters.USVString(fileName)\n    options = webidl.converters.FilePropertyBag(options)\n\n    // 1. Let bytes be the result of processing blob parts given fileBits and\n    // options.\n    // Note: Blob handles this for us\n\n    // 2. Let n be the fileName argument to the constructor.\n    const n = fileName\n\n    // 3. Process FilePropertyBag dictionary argument by running the following\n    // substeps:\n\n    //    1. If the type member is provided and is not the empty string, let t\n    //    be set to the type dictionary member. If t contains any characters\n    //    outside the range U+0020 to U+007E, then set t to the empty string\n    //    and return from these substeps.\n    //    2. Convert every character in t to ASCII lowercase.\n    let t = options.type\n    let d\n\n    // eslint-disable-next-line no-labels\n    substep: {\n      if (t) {\n        t = parseMIMEType(t)\n\n        if (t === 'failure') {\n          t = ''\n          // eslint-disable-next-line no-labels\n          break substep\n        }\n\n        t = serializeAMimeType(t).toLowerCase()\n      }\n\n      //    3. If the lastModified member is provided, let d be set to the\n      //    lastModified dictionary member. If it is not provided, set d to the\n      //    current date and time represented as the number of milliseconds since\n      //    the Unix Epoch (which is the equivalent of Date.now() [ECMA-262]).\n      d = options.lastModified\n    }\n\n    // 4. Return a new File object F such that:\n    // F refers to the bytes byte sequence.\n    // F.size is set to the number of total bytes in bytes.\n    // F.name is set to n.\n    // F.type is set to t.\n    // F.lastModified is set to d.\n\n    super(processBlobParts(fileBits, options), { type: t })\n    this[kState] = {\n      name: n,\n      lastModified: d,\n      type: t\n    }\n  }\n\n  get name () {\n    webidl.brandCheck(this, File)\n\n    return this[kState].name\n  }\n\n  get lastModified () {\n    webidl.brandCheck(this, File)\n\n    return this[kState].lastModified\n  }\n\n  get type () {\n    webidl.brandCheck(this, File)\n\n    return this[kState].type\n  }\n}\n\nclass FileLike {\n  constructor (blobLike, fileName, options = {}) {\n    // TODO: argument idl type check\n\n    // The File constructor is invoked with two or three parameters, depending\n    // on whether the optional dictionary parameter is used. When the File()\n    // constructor is invoked, user agents must run the following steps:\n\n    // 1. Let bytes be the result of processing blob parts given fileBits and\n    // options.\n\n    // 2. Let n be the fileName argument to the constructor.\n    const n = fileName\n\n    // 3. Process FilePropertyBag dictionary argument by running the following\n    // substeps:\n\n    //    1. If the type member is provided and is not the empty string, let t\n    //    be set to the type dictionary member. If t contains any characters\n    //    outside the range U+0020 to U+007E, then set t to the empty string\n    //    and return from these substeps.\n    //    TODO\n    const t = options.type\n\n    //    2. Convert every character in t to ASCII lowercase.\n    //    TODO\n\n    //    3. If the lastModified member is provided, let d be set to the\n    //    lastModified dictionary member. If it is not provided, set d to the\n    //    current date and time represented as the number of milliseconds since\n    //    the Unix Epoch (which is the equivalent of Date.now() [ECMA-262]).\n    const d = options.lastModified ?? Date.now()\n\n    // 4. Return a new File object F such that:\n    // F refers to the bytes byte sequence.\n    // F.size is set to the number of total bytes in bytes.\n    // F.name is set to n.\n    // F.type is set to t.\n    // F.lastModified is set to d.\n\n    this[kState] = {\n      blobLike,\n      name: n,\n      type: t,\n      lastModified: d\n    }\n  }\n\n  stream (...args) {\n    webidl.brandCheck(this, FileLike)\n\n    return this[kState].blobLike.stream(...args)\n  }\n\n  arrayBuffer (...args) {\n    webidl.brandCheck(this, FileLike)\n\n    return this[kState].blobLike.arrayBuffer(...args)\n  }\n\n  slice (...args) {\n    webidl.brandCheck(this, FileLike)\n\n    return this[kState].blobLike.slice(...args)\n  }\n\n  text (...args) {\n    webidl.brandCheck(this, FileLike)\n\n    return this[kState].blobLike.text(...args)\n  }\n\n  get size () {\n    webidl.brandCheck(this, FileLike)\n\n    return this[kState].blobLike.size\n  }\n\n  get type () {\n    webidl.brandCheck(this, FileLike)\n\n    return this[kState].blobLike.type\n  }\n\n  get name () {\n    webidl.brandCheck(this, FileLike)\n\n    return this[kState].name\n  }\n\n  get lastModified () {\n    webidl.brandCheck(this, FileLike)\n\n    return this[kState].lastModified\n  }\n\n  get [Symbol.toStringTag] () {\n    return 'File'\n  }\n}\n\nObject.defineProperties(File.prototype, {\n  [Symbol.toStringTag]: {\n    value: 'File',\n    configurable: true\n  },\n  name: kEnumerableProperty,\n  lastModified: kEnumerableProperty\n})\n\nwebidl.converters.Blob = webidl.interfaceConverter(Blob)\n\nwebidl.converters.BlobPart = function (V, opts) {\n  if (webidl.util.Type(V) === 'Object') {\n    if (isBlobLike(V)) {\n      return webidl.converters.Blob(V, { strict: false })\n    }\n\n    if (\n      ArrayBuffer.isView(V) ||\n      types.isAnyArrayBuffer(V)\n    ) {\n      return webidl.converters.BufferSource(V, opts)\n    }\n  }\n\n  return webidl.converters.USVString(V, opts)\n}\n\nwebidl.converters['sequence<BlobPart>'] = webidl.sequenceConverter(\n  webidl.converters.BlobPart\n)\n\n// https://www.w3.org/TR/FileAPI/#dfn-FilePropertyBag\nwebidl.converters.FilePropertyBag = webidl.dictionaryConverter([\n  {\n    key: 'lastModified',\n    converter: webidl.converters['long long'],\n    get defaultValue () {\n      return Date.now()\n    }\n  },\n  {\n    key: 'type',\n    converter: webidl.converters.DOMString,\n    defaultValue: ''\n  },\n  {\n    key: 'endings',\n    converter: (value) => {\n      value = webidl.converters.DOMString(value)\n      value = value.toLowerCase()\n\n      if (value !== 'native') {\n        value = 'transparent'\n      }\n\n      return value\n    },\n    defaultValue: 'transparent'\n  }\n])\n\n/**\n * @see https://www.w3.org/TR/FileAPI/#process-blob-parts\n * @param {(NodeJS.TypedArray|Blob|string)[]} parts\n * @param {{ type: string, endings: string }} options\n */\nfunction processBlobParts (parts, options) {\n  // 1. Let bytes be an empty sequence of bytes.\n  /** @type {NodeJS.TypedArray[]} */\n  const bytes = []\n\n  // 2. For each element in parts:\n  for (const element of parts) {\n    // 1. If element is a USVString, run the following substeps:\n    if (typeof element === 'string') {\n      // 1. Let s be element.\n      let s = element\n\n      // 2. If the endings member of options is \"native\", set s\n      //    to the result of converting line endings to native\n      //    of element.\n      if (options.endings === 'native') {\n        s = convertLineEndingsNative(s)\n      }\n\n      // 3. Append the result of UTF-8 encoding s to bytes.\n      bytes.push(encoder.encode(s))\n    } else if (\n      types.isAnyArrayBuffer(element) ||\n      types.isTypedArray(element)\n    ) {\n      // 2. If element is a BufferSource, get a copy of the\n      //    bytes held by the buffer source, and append those\n      //    bytes to bytes.\n      if (!element.buffer) { // ArrayBuffer\n        bytes.push(new Uint8Array(element))\n      } else {\n        bytes.push(\n          new Uint8Array(element.buffer, element.byteOffset, element.byteLength)\n        )\n      }\n    } else if (isBlobLike(element)) {\n      // 3. If element is a Blob, append the bytes it represents\n      //    to bytes.\n      bytes.push(element)\n    }\n  }\n\n  // 3. Return bytes.\n  return bytes\n}\n\n/**\n * @see https://www.w3.org/TR/FileAPI/#convert-line-endings-to-native\n * @param {string} s\n */\nfunction convertLineEndingsNative (s) {\n  // 1. Let native line ending be be the code point U+000A LF.\n  let nativeLineEnding = '\\n'\n\n  // 2. If the underlying platformâ€™s conventions are to\n  //    represent newlines as a carriage return and line feed\n  //    sequence, set native line ending to the code point\n  //    U+000D CR followed by the code point U+000A LF.\n  if (process.platform === 'win32') {\n    nativeLineEnding = '\\r\\n'\n  }\n\n  return s.replace(/\\r?\\n/g, nativeLineEnding)\n}\n\n// If this function is moved to ./util.js, some tools (such as\n// rollup) will warn about circular dependencies. See:\n// https://github.com/nodejs/undici/issues/1629\nfunction isFileLike (object) {\n  return (\n    (NativeFile && object instanceof NativeFile) ||\n    object instanceof File || (\n      object &&\n      (typeof object.stream === 'function' ||\n      typeof object.arrayBuffer === 'function') &&\n      object[Symbol.toStringTag] === 'File'\n    )\n  )\n}\n\nmodule.exports = { File, FileLike, isFileLike }\n","'use strict'\n\nconst { isBlobLike, toUSVString, makeIterator } = require('./util')\nconst { kState } = require('./symbols')\nconst { File: UndiciFile, FileLike, isFileLike } = require('./file')\nconst { webidl } = require('./webidl')\nconst { Blob, File: NativeFile } = require('buffer')\n\n/** @type {globalThis['File']} */\nconst File = NativeFile ?? UndiciFile\n\n// https://xhr.spec.whatwg.org/#formdata\nclass FormData {\n  constructor (form) {\n    if (form !== undefined) {\n      throw webidl.errors.conversionFailed({\n        prefix: 'FormData constructor',\n        argument: 'Argument 1',\n        types: ['undefined']\n      })\n    }\n\n    this[kState] = []\n  }\n\n  append (name, value, filename = undefined) {\n    webidl.brandCheck(this, FormData)\n\n    webidl.argumentLengthCheck(arguments, 2, { header: 'FormData.append' })\n\n    if (arguments.length === 3 && !isBlobLike(value)) {\n      throw new TypeError(\n        \"Failed to execute 'append' on 'FormData': parameter 2 is not of type 'Blob'\"\n      )\n    }\n\n    // 1. Let value be value if given; otherwise blobValue.\n\n    name = webidl.converters.USVString(name)\n    value = isBlobLike(value)\n      ? webidl.converters.Blob(value, { strict: false })\n      : webidl.converters.USVString(value)\n    filename = arguments.length === 3\n      ? webidl.converters.USVString(filename)\n      : undefined\n\n    // 2. Let entry be the result of creating an entry with\n    // name, value, and filename if given.\n    const entry = makeEntry(name, value, filename)\n\n    // 3. Append entry to thisâ€™s entry list.\n    this[kState].push(entry)\n  }\n\n  delete (name) {\n    webidl.brandCheck(this, FormData)\n\n    webidl.argumentLengthCheck(arguments, 1, { header: 'FormData.delete' })\n\n    name = webidl.converters.USVString(name)\n\n    // The delete(name) method steps are to remove all entries whose name\n    // is name from thisâ€™s entry list.\n    this[kState] = this[kState].filter(entry => entry.name !== name)\n  }\n\n  get (name) {\n    webidl.brandCheck(this, FormData)\n\n    webidl.argumentLengthCheck(arguments, 1, { header: 'FormData.get' })\n\n    name = webidl.converters.USVString(name)\n\n    // 1. If there is no entry whose name is name in thisâ€™s entry list,\n    // then return null.\n    const idx = this[kState].findIndex((entry) => entry.name === name)\n    if (idx === -1) {\n      return null\n    }\n\n    // 2. Return the value of the first entry whose name is name from\n    // thisâ€™s entry list.\n    return this[kState][idx].value\n  }\n\n  getAll (name) {\n    webidl.brandCheck(this, FormData)\n\n    webidl.argumentLengthCheck(arguments, 1, { header: 'FormData.getAll' })\n\n    name = webidl.converters.USVString(name)\n\n    // 1. If there is no entry whose name is name in thisâ€™s entry list,\n    // then return the empty list.\n    // 2. Return the values of all entries whose name is name, in order,\n    // from thisâ€™s entry list.\n    return this[kState]\n      .filter((entry) => entry.name === name)\n      .map((entry) => entry.value)\n  }\n\n  has (name) {\n    webidl.brandCheck(this, FormData)\n\n    webidl.argumentLengthCheck(arguments, 1, { header: 'FormData.has' })\n\n    name = webidl.converters.USVString(name)\n\n    // The has(name) method steps are to return true if there is an entry\n    // whose name is name in thisâ€™s entry list; otherwise false.\n    return this[kState].findIndex((entry) => entry.name === name) !== -1\n  }\n\n  set (name, value, filename = undefined) {\n    webidl.brandCheck(this, FormData)\n\n    webidl.argumentLengthCheck(arguments, 2, { header: 'FormData.set' })\n\n    if (arguments.length === 3 && !isBlobLike(value)) {\n      throw new TypeError(\n        \"Failed to execute 'set' on 'FormData': parameter 2 is not of type 'Blob'\"\n      )\n    }\n\n    // The set(name, value) and set(name, blobValue, filename) method steps\n    // are:\n\n    // 1. Let value be value if given; otherwise blobValue.\n\n    name = webidl.converters.USVString(name)\n    value = isBlobLike(value)\n      ? webidl.converters.Blob(value, { strict: false })\n      : webidl.converters.USVString(value)\n    filename = arguments.length === 3\n      ? toUSVString(filename)\n      : undefined\n\n    // 2. Let entry be the result of creating an entry with name, value, and\n    // filename if given.\n    const entry = makeEntry(name, value, filename)\n\n    // 3. If there are entries in thisâ€™s entry list whose name is name, then\n    // replace the first such entry with entry and remove the others.\n    const idx = this[kState].findIndex((entry) => entry.name === name)\n    if (idx !== -1) {\n      this[kState] = [\n        ...this[kState].slice(0, idx),\n        entry,\n        ...this[kState].slice(idx + 1).filter((entry) => entry.name !== name)\n      ]\n    } else {\n      // 4. Otherwise, append entry to thisâ€™s entry list.\n      this[kState].push(entry)\n    }\n  }\n\n  entries () {\n    webidl.brandCheck(this, FormData)\n\n    return makeIterator(\n      () => this[kState].map(pair => [pair.name, pair.value]),\n      'FormData',\n      'key+value'\n    )\n  }\n\n  keys () {\n    webidl.brandCheck(this, FormData)\n\n    return makeIterator(\n      () => this[kState].map(pair => [pair.name, pair.value]),\n      'FormData',\n      'key'\n    )\n  }\n\n  values () {\n    webidl.brandCheck(this, FormData)\n\n    return makeIterator(\n      () => this[kState].map(pair => [pair.name, pair.value]),\n      'FormData',\n      'value'\n    )\n  }\n\n  /**\n   * @param {(value: string, key: string, self: FormData) => void} callbackFn\n   * @param {unknown} thisArg\n   */\n  forEach (callbackFn, thisArg = globalThis) {\n    webidl.brandCheck(this, FormData)\n\n    webidl.argumentLengthCheck(arguments, 1, { header: 'FormData.forEach' })\n\n    if (typeof callbackFn !== 'function') {\n      throw new TypeError(\n        \"Failed to execute 'forEach' on 'FormData': parameter 1 is not of type 'Function'.\"\n      )\n    }\n\n    for (const [key, value] of this) {\n      callbackFn.apply(thisArg, [value, key, this])\n    }\n  }\n}\n\nFormData.prototype[Symbol.iterator] = FormData.prototype.entries\n\nObject.defineProperties(FormData.prototype, {\n  [Symbol.toStringTag]: {\n    value: 'FormData',\n    configurable: true\n  }\n})\n\n/**\n * @see https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#create-an-entry\n * @param {string} name\n * @param {string|Blob} value\n * @param {?string} filename\n * @returns\n */\nfunction makeEntry (name, value, filename) {\n  // 1. Set name to the result of converting name into a scalar value string.\n  // \"To convert a string into a scalar value string, replace any surrogates\n  //  with U+FFFD.\"\n  // see: https://nodejs.org/dist/latest-v18.x/docs/api/buffer.html#buftostringencoding-start-end\n  name = Buffer.from(name).toString('utf8')\n\n  // 2. If value is a string, then set value to the result of converting\n  //    value into a scalar value string.\n  if (typeof value === 'string') {\n    value = Buffer.from(value).toString('utf8')\n  } else {\n    // 3. Otherwise:\n\n    // 1. If value is not a File object, then set value to a new File object,\n    //    representing the same bytes, whose name attribute value is \"blob\"\n    if (!isFileLike(value)) {\n      value = value instanceof Blob\n        ? new File([value], 'blob', { type: value.type })\n        : new FileLike(value, 'blob', { type: value.type })\n    }\n\n    // 2. If filename is given, then set value to a new File object,\n    //    representing the same bytes, whose name attribute is filename.\n    if (filename !== undefined) {\n      /** @type {FilePropertyBag} */\n      const options = {\n        type: value.type,\n        lastModified: value.lastModified\n      }\n\n      value = (NativeFile && value instanceof NativeFile) || value instanceof UndiciFile\n        ? new File([value], filename, options)\n        : new FileLike(value, filename, options)\n    }\n  }\n\n  // 4. Return an entry whose name is name and whose value is value.\n  return { name, value }\n}\n\nmodule.exports = { FormData }\n","'use strict'\n\nconst Busboy = require('@fastify/busboy')\nconst util = require('../core/util')\nconst {\n  ReadableStreamFrom,\n  isBlobLike,\n  isReadableStreamLike,\n  readableStreamClose,\n  createDeferredPromise,\n  fullyReadBody\n} = require('./util')\nconst { FormData } = require('./formdata')\nconst { kState } = require('./symbols')\nconst { webidl } = require('./webidl')\nconst { DOMException, structuredClone } = require('./constants')\nconst { Blob, File: NativeFile } = require('buffer')\nconst { kBodyUsed } = require('../core/symbols')\nconst assert = require('assert')\nconst { isErrored } = require('../core/util')\nconst { isUint8Array, isArrayBuffer } = require('util/types')\nconst { File: UndiciFile } = require('./file')\nconst { parseMIMEType, serializeAMimeType } = require('./dataURL')\n\nlet random\ntry {\n  const crypto = require('node:crypto')\n  random = (max) => crypto.randomInt(0, max)\n} catch {\n  random = (max) => Math.floor(Math.random(max))\n}\n\nlet ReadableStream = globalThis.ReadableStream\n\n/** @type {globalThis['File']} */\nconst File = NativeFile ?? UndiciFile\nconst textEncoder = new TextEncoder()\nconst textDecoder = new TextDecoder()\n\n// https://fetch.spec.whatwg.org/#concept-bodyinit-extract\nfunction extractBody (object, keepalive = false) {\n  if (!ReadableStream) {\n    ReadableStream = require('stream/web').ReadableStream\n  }\n\n  // 1. Let stream be null.\n  let stream = null\n\n  // 2. If object is a ReadableStream object, then set stream to object.\n  if (object instanceof ReadableStream) {\n    stream = object\n  } else if (isBlobLike(object)) {\n    // 3. Otherwise, if object is a Blob object, set stream to the\n    //    result of running objectâ€™s get stream.\n    stream = object.stream()\n  } else {\n    // 4. Otherwise, set stream to a new ReadableStream object, and set\n    //    up stream.\n    stream = new ReadableStream({\n      async pull (controller) {\n        controller.enqueue(\n          typeof source === 'string' ? textEncoder.encode(source) : source\n        )\n        queueMicrotask(() => readableStreamClose(controller))\n      },\n      start () {},\n      type: undefined\n    })\n  }\n\n  // 5. Assert: stream is a ReadableStream object.\n  assert(isReadableStreamLike(stream))\n\n  // 6. Let action be null.\n  let action = null\n\n  // 7. Let source be null.\n  let source = null\n\n  // 8. Let length be null.\n  let length = null\n\n  // 9. Let type be null.\n  let type = null\n\n  // 10. Switch on object:\n  if (typeof object === 'string') {\n    // Set source to the UTF-8 encoding of object.\n    // Note: setting source to a Uint8Array here breaks some mocking assumptions.\n    source = object\n\n    // Set type to `text/plain;charset=UTF-8`.\n    type = 'text/plain;charset=UTF-8'\n  } else if (object instanceof URLSearchParams) {\n    // URLSearchParams\n\n    // spec says to run application/x-www-form-urlencoded on body.list\n    // this is implemented in Node.js as apart of an URLSearchParams instance toString method\n    // See: https://github.com/nodejs/node/blob/e46c680bf2b211bbd52cf959ca17ee98c7f657f5/lib/internal/url.js#L490\n    // and https://github.com/nodejs/node/blob/e46c680bf2b211bbd52cf959ca17ee98c7f657f5/lib/internal/url.js#L1100\n\n    // Set source to the result of running the application/x-www-form-urlencoded serializer with objectâ€™s list.\n    source = object.toString()\n\n    // Set type to `application/x-www-form-urlencoded;charset=UTF-8`.\n    type = 'application/x-www-form-urlencoded;charset=UTF-8'\n  } else if (isArrayBuffer(object)) {\n    // BufferSource/ArrayBuffer\n\n    // Set source to a copy of the bytes held by object.\n    source = new Uint8Array(object.slice())\n  } else if (ArrayBuffer.isView(object)) {\n    // BufferSource/ArrayBufferView\n\n    // Set source to a copy of the bytes held by object.\n    source = new Uint8Array(object.buffer.slice(object.byteOffset, object.byteOffset + object.byteLength))\n  } else if (util.isFormDataLike(object)) {\n    const boundary = `----formdata-undici-0${`${random(1e11)}`.padStart(11, '0')}`\n    const prefix = `--${boundary}\\r\\nContent-Disposition: form-data`\n\n    /*! formdata-polyfill. MIT License. Jimmy WÃ¤rting <https://jimmy.warting.se/opensource> */\n    const escape = (str) =>\n      str.replace(/\\n/g, '%0A').replace(/\\r/g, '%0D').replace(/\"/g, '%22')\n    const normalizeLinefeeds = (value) => value.replace(/\\r?\\n|\\r/g, '\\r\\n')\n\n    // Set action to this step: run the multipart/form-data\n    // encoding algorithm, with objectâ€™s entry list and UTF-8.\n    // - This ensures that the body is immutable and can't be changed afterwords\n    // - That the content-length is calculated in advance.\n    // - And that all parts are pre-encoded and ready to be sent.\n\n    const blobParts = []\n    const rn = new Uint8Array([13, 10]) // '\\r\\n'\n    length = 0\n    let hasUnknownSizeValue = false\n\n    for (const [name, value] of object) {\n      if (typeof value === 'string') {\n        const chunk = textEncoder.encode(prefix +\n          `; name=\"${escape(normalizeLinefeeds(name))}\"` +\n          `\\r\\n\\r\\n${normalizeLinefeeds(value)}\\r\\n`)\n        blobParts.push(chunk)\n        length += chunk.byteLength\n      } else {\n        const chunk = textEncoder.encode(`${prefix}; name=\"${escape(normalizeLinefeeds(name))}\"` +\n          (value.name ? `; filename=\"${escape(value.name)}\"` : '') + '\\r\\n' +\n          `Content-Type: ${\n            value.type || 'application/octet-stream'\n          }\\r\\n\\r\\n`)\n        blobParts.push(chunk, value, rn)\n        if (typeof value.size === 'number') {\n          length += chunk.byteLength + value.size + rn.byteLength\n        } else {\n          hasUnknownSizeValue = true\n        }\n      }\n    }\n\n    const chunk = textEncoder.encode(`--${boundary}--`)\n    blobParts.push(chunk)\n    length += chunk.byteLength\n    if (hasUnknownSizeValue) {\n      length = null\n    }\n\n    // Set source to object.\n    source = object\n\n    action = async function * () {\n      for (const part of blobParts) {\n        if (part.stream) {\n          yield * part.stream()\n        } else {\n          yield part\n        }\n      }\n    }\n\n    // Set type to `multipart/form-data; boundary=`,\n    // followed by the multipart/form-data boundary string generated\n    // by the multipart/form-data encoding algorithm.\n    type = 'multipart/form-data; boundary=' + boundary\n  } else if (isBlobLike(object)) {\n    // Blob\n\n    // Set source to object.\n    source = object\n\n    // Set length to objectâ€™s size.\n    length = object.size\n\n    // If objectâ€™s type attribute is not the empty byte sequence, set\n    // type to its value.\n    if (object.type) {\n      type = object.type\n    }\n  } else if (typeof object[Symbol.asyncIterator] === 'function') {\n    // If keepalive is true, then throw a TypeError.\n    if (keepalive) {\n      throw new TypeError('keepalive')\n    }\n\n    // If object is disturbed or locked, then throw a TypeError.\n    if (util.isDisturbed(object) || object.locked) {\n      throw new TypeError(\n        'Response body object should not be disturbed or locked'\n      )\n    }\n\n    stream =\n      object instanceof ReadableStream ? object : ReadableStreamFrom(object)\n  }\n\n  // 11. If source is a byte sequence, then set action to a\n  // step that returns source and length to sourceâ€™s length.\n  if (typeof source === 'string' || util.isBuffer(source)) {\n    length = Buffer.byteLength(source)\n  }\n\n  // 12. If action is non-null, then run these steps in in parallel:\n  if (action != null) {\n    // Run action.\n    let iterator\n    stream = new ReadableStream({\n      async start () {\n        iterator = action(object)[Symbol.asyncIterator]()\n      },\n      async pull (controller) {\n        const { value, done } = await iterator.next()\n        if (done) {\n          // When running action is done, close stream.\n          queueMicrotask(() => {\n            controller.close()\n          })\n        } else {\n          // Whenever one or more bytes are available and stream is not errored,\n          // enqueue a Uint8Array wrapping an ArrayBuffer containing the available\n          // bytes into stream.\n          if (!isErrored(stream)) {\n            controller.enqueue(new Uint8Array(value))\n          }\n        }\n        return controller.desiredSize > 0\n      },\n      async cancel (reason) {\n        await iterator.return()\n      },\n      type: undefined\n    })\n  }\n\n  // 13. Let body be a body whose stream is stream, source is source,\n  // and length is length.\n  const body = { stream, source, length }\n\n  // 14. Return (body, type).\n  return [body, type]\n}\n\n// https://fetch.spec.whatwg.org/#bodyinit-safely-extract\nfunction safelyExtractBody (object, keepalive = false) {\n  if (!ReadableStream) {\n    // istanbul ignore next\n    ReadableStream = require('stream/web').ReadableStream\n  }\n\n  // To safely extract a body and a `Content-Type` value from\n  // a byte sequence or BodyInit object object, run these steps:\n\n  // 1. If object is a ReadableStream object, then:\n  if (object instanceof ReadableStream) {\n    // Assert: object is neither disturbed nor locked.\n    // istanbul ignore next\n    assert(!util.isDisturbed(object), 'The body has already been consumed.')\n    // istanbul ignore next\n    assert(!object.locked, 'The stream is locked.')\n  }\n\n  // 2. Return the results of extracting object.\n  return extractBody(object, keepalive)\n}\n\nfunction cloneBody (body) {\n  // To clone a body body, run these steps:\n\n  // https://fetch.spec.whatwg.org/#concept-body-clone\n\n  // 1. Let Â« out1, out2 Â» be the result of teeing bodyâ€™s stream.\n  const [out1, out2] = body.stream.tee()\n  const out2Clone = structuredClone(out2, { transfer: [out2] })\n  // This, for whatever reasons, unrefs out2Clone which allows\n  // the process to exit by itself.\n  const [, finalClone] = out2Clone.tee()\n\n  // 2. Set bodyâ€™s stream to out1.\n  body.stream = out1\n\n  // 3. Return a body whose stream is out2 and other members are copied from body.\n  return {\n    stream: finalClone,\n    length: body.length,\n    source: body.source\n  }\n}\n\nasync function * consumeBody (body) {\n  if (body) {\n    if (isUint8Array(body)) {\n      yield body\n    } else {\n      const stream = body.stream\n\n      if (util.isDisturbed(stream)) {\n        throw new TypeError('The body has already been consumed.')\n      }\n\n      if (stream.locked) {\n        throw new TypeError('The stream is locked.')\n      }\n\n      // Compat.\n      stream[kBodyUsed] = true\n\n      yield * stream\n    }\n  }\n}\n\nfunction throwIfAborted (state) {\n  if (state.aborted) {\n    throw new DOMException('The operation was aborted.', 'AbortError')\n  }\n}\n\nfunction bodyMixinMethods (instance) {\n  const methods = {\n    blob () {\n      // The blob() method steps are to return the result of\n      // running consume body with this and the following step\n      // given a byte sequence bytes: return a Blob whose\n      // contents are bytes and whose type attribute is thisâ€™s\n      // MIME type.\n      return specConsumeBody(this, (bytes) => {\n        let mimeType = bodyMimeType(this)\n\n        if (mimeType === 'failure') {\n          mimeType = ''\n        } else if (mimeType) {\n          mimeType = serializeAMimeType(mimeType)\n        }\n\n        // Return a Blob whose contents are bytes and type attribute\n        // is mimeType.\n        return new Blob([bytes], { type: mimeType })\n      }, instance)\n    },\n\n    arrayBuffer () {\n      // The arrayBuffer() method steps are to return the result\n      // of running consume body with this and the following step\n      // given a byte sequence bytes: return a new ArrayBuffer\n      // whose contents are bytes.\n      return specConsumeBody(this, (bytes) => {\n        return new Uint8Array(bytes).buffer\n      }, instance)\n    },\n\n    text () {\n      // The text() method steps are to return the result of running\n      // consume body with this and UTF-8 decode.\n      return specConsumeBody(this, utf8DecodeBytes, instance)\n    },\n\n    json () {\n      // The json() method steps are to return the result of running\n      // consume body with this and parse JSON from bytes.\n      return specConsumeBody(this, parseJSONFromBytes, instance)\n    },\n\n    async formData () {\n      webidl.brandCheck(this, instance)\n\n      throwIfAborted(this[kState])\n\n      const contentType = this.headers.get('Content-Type')\n\n      // If mimeTypeâ€™s essence is \"multipart/form-data\", then:\n      if (/multipart\\/form-data/.test(contentType)) {\n        const headers = {}\n        for (const [key, value] of this.headers) headers[key.toLowerCase()] = value\n\n        const responseFormData = new FormData()\n\n        let busboy\n\n        try {\n          busboy = new Busboy({\n            headers,\n            preservePath: true\n          })\n        } catch (err) {\n          throw new DOMException(`${err}`, 'AbortError')\n        }\n\n        busboy.on('field', (name, value) => {\n          responseFormData.append(name, value)\n        })\n        busboy.on('file', (name, value, filename, encoding, mimeType) => {\n          const chunks = []\n\n          if (encoding === 'base64' || encoding.toLowerCase() === 'base64') {\n            let base64chunk = ''\n\n            value.on('data', (chunk) => {\n              base64chunk += chunk.toString().replace(/[\\r\\n]/gm, '')\n\n              const end = base64chunk.length - base64chunk.length % 4\n              chunks.push(Buffer.from(base64chunk.slice(0, end), 'base64'))\n\n              base64chunk = base64chunk.slice(end)\n            })\n            value.on('end', () => {\n              chunks.push(Buffer.from(base64chunk, 'base64'))\n              responseFormData.append(name, new File(chunks, filename, { type: mimeType }))\n            })\n          } else {\n            value.on('data', (chunk) => {\n              chunks.push(chunk)\n            })\n            value.on('end', () => {\n              responseFormData.append(name, new File(chunks, filename, { type: mimeType }))\n            })\n          }\n        })\n\n        const busboyResolve = new Promise((resolve, reject) => {\n          busboy.on('finish', resolve)\n          busboy.on('error', (err) => reject(new TypeError(err)))\n        })\n\n        if (this.body !== null) for await (const chunk of consumeBody(this[kState].body)) busboy.write(chunk)\n        busboy.end()\n        await busboyResolve\n\n        return responseFormData\n      } else if (/application\\/x-www-form-urlencoded/.test(contentType)) {\n        // Otherwise, if mimeTypeâ€™s essence is \"application/x-www-form-urlencoded\", then:\n\n        // 1. Let entries be the result of parsing bytes.\n        let entries\n        try {\n          let text = ''\n          // application/x-www-form-urlencoded parser will keep the BOM.\n          // https://url.spec.whatwg.org/#concept-urlencoded-parser\n          // Note that streaming decoder is stateful and cannot be reused\n          const streamingDecoder = new TextDecoder('utf-8', { ignoreBOM: true })\n\n          for await (const chunk of consumeBody(this[kState].body)) {\n            if (!isUint8Array(chunk)) {\n              throw new TypeError('Expected Uint8Array chunk')\n            }\n            text += streamingDecoder.decode(chunk, { stream: true })\n          }\n          text += streamingDecoder.decode()\n          entries = new URLSearchParams(text)\n        } catch (err) {\n          // istanbul ignore next: Unclear when new URLSearchParams can fail on a string.\n          // 2. If entries is failure, then throw a TypeError.\n          throw Object.assign(new TypeError(), { cause: err })\n        }\n\n        // 3. Return a new FormData object whose entries are entries.\n        const formData = new FormData()\n        for (const [name, value] of entries) {\n          formData.append(name, value)\n        }\n        return formData\n      } else {\n        // Wait a tick before checking if the request has been aborted.\n        // Otherwise, a TypeError can be thrown when an AbortError should.\n        await Promise.resolve()\n\n        throwIfAborted(this[kState])\n\n        // Otherwise, throw a TypeError.\n        throw webidl.errors.exception({\n          header: `${instance.name}.formData`,\n          message: 'Could not parse content as FormData.'\n        })\n      }\n    }\n  }\n\n  return methods\n}\n\nfunction mixinBody (prototype) {\n  Object.assign(prototype.prototype, bodyMixinMethods(prototype))\n}\n\n/**\n * @see https://fetch.spec.whatwg.org/#concept-body-consume-body\n * @param {Response|Request} object\n * @param {(value: unknown) => unknown} convertBytesToJSValue\n * @param {Response|Request} instance\n */\nasync function specConsumeBody (object, convertBytesToJSValue, instance) {\n  webidl.brandCheck(object, instance)\n\n  throwIfAborted(object[kState])\n\n  // 1. If object is unusable, then return a promise rejected\n  //    with a TypeError.\n  if (bodyUnusable(object[kState].body)) {\n    throw new TypeError('Body is unusable')\n  }\n\n  // 2. Let promise be a new promise.\n  const promise = createDeferredPromise()\n\n  // 3. Let errorSteps given error be to reject promise with error.\n  const errorSteps = (error) => promise.reject(error)\n\n  // 4. Let successSteps given a byte sequence data be to resolve\n  //    promise with the result of running convertBytesToJSValue\n  //    with data. If that threw an exception, then run errorSteps\n  //    with that exception.\n  const successSteps = (data) => {\n    try {\n      promise.resolve(convertBytesToJSValue(data))\n    } catch (e) {\n      errorSteps(e)\n    }\n  }\n\n  // 5. If objectâ€™s body is null, then run successSteps with an\n  //    empty byte sequence.\n  if (object[kState].body == null) {\n    successSteps(new Uint8Array())\n    return promise.promise\n  }\n\n  // 6. Otherwise, fully read objectâ€™s body given successSteps,\n  //    errorSteps, and objectâ€™s relevant global object.\n  await fullyReadBody(object[kState].body, successSteps, errorSteps)\n\n  // 7. Return promise.\n  return promise.promise\n}\n\n// https://fetch.spec.whatwg.org/#body-unusable\nfunction bodyUnusable (body) {\n  // An object including the Body interface mixin is\n  // said to be unusable if its body is non-null and\n  // its bodyâ€™s stream is disturbed or locked.\n  return body != null && (body.stream.locked || util.isDisturbed(body.stream))\n}\n\n/**\n * @see https://encoding.spec.whatwg.org/#utf-8-decode\n * @param {Buffer} buffer\n */\nfunction utf8DecodeBytes (buffer) {\n  if (buffer.length === 0) {\n    return ''\n  }\n\n  // 1. Let buffer be the result of peeking three bytes from\n  //    ioQueue, converted to a byte sequence.\n\n  // 2. If buffer is 0xEF 0xBB 0xBF, then read three\n  //    bytes from ioQueue. (Do nothing with those bytes.)\n  if (buffer[0] === 0xEF && buffer[1] === 0xBB && buffer[2] === 0xBF) {\n    buffer = buffer.subarray(3)\n  }\n\n  // 3. Process a queue with an instance of UTF-8â€™s\n  //    decoder, ioQueue, output, and \"replacement\".\n  const output = textDecoder.decode(buffer)\n\n  // 4. Return output.\n  return output\n}\n\n/**\n * @see https://infra.spec.whatwg.org/#parse-json-bytes-to-a-javascript-value\n * @param {Uint8Array} bytes\n */\nfunction parseJSONFromBytes (bytes) {\n  return JSON.parse(utf8DecodeBytes(bytes))\n}\n\n/**\n * @see https://fetch.spec.whatwg.org/#concept-body-mime-type\n * @param {import('./response').Response|import('./request').Request} object\n */\nfunction bodyMimeType (object) {\n  const { headersList } = object[kState]\n  const contentType = headersList.get('content-type')\n\n  if (contentType === null) {\n    return 'failure'\n  }\n\n  return parseMIMEType(contentType)\n}\n\nmodule.exports = {\n  extractBody,\n  safelyExtractBody,\n  cloneBody,\n  mixinBody\n}\n","'use strict'\n\nconst {\n  InvalidArgumentError,\n  NotSupportedError\n} = require('./errors')\nconst assert = require('assert')\nconst { kHTTP2BuildRequest, kHTTP2CopyHeaders, kHTTP1BuildRequest } = require('./symbols')\nconst util = require('./util')\n\n// tokenRegExp and headerCharRegex have been lifted from\n// https://github.com/nodejs/node/blob/main/lib/_http_common.js\n\n/**\n * Verifies that the given val is a valid HTTP token\n * per the rules defined in RFC 7230\n * See https://tools.ietf.org/html/rfc7230#section-3.2.6\n */\nconst tokenRegExp = /^[\\^_`a-zA-Z\\-0-9!#$%&'*+.|~]+$/\n\n/**\n * Matches if val contains an invalid field-vchar\n *  field-value    = *( field-content / obs-fold )\n *  field-content  = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n *  field-vchar    = VCHAR / obs-text\n */\nconst headerCharRegex = /[^\\t\\x20-\\x7e\\x80-\\xff]/\n\n// Verifies that a given path is valid does not contain control chars \\x00 to \\x20\nconst invalidPathRegex = /[^\\u0021-\\u00ff]/\n\nconst kHandler = Symbol('handler')\n\nconst channels = {}\n\nlet extractBody\n\ntry {\n  const diagnosticsChannel = require('diagnostics_channel')\n  channels.create = diagnosticsChannel.channel('undici:request:create')\n  channels.bodySent = diagnosticsChannel.channel('undici:request:bodySent')\n  channels.headers = diagnosticsChannel.channel('undici:request:headers')\n  channels.trailers = diagnosticsChannel.channel('undici:request:trailers')\n  channels.error = diagnosticsChannel.channel('undici:request:error')\n} catch {\n  channels.create = { hasSubscribers: false }\n  channels.bodySent = { hasSubscribers: false }\n  channels.headers = { hasSubscribers: false }\n  channels.trailers = { hasSubscribers: false }\n  channels.error = { hasSubscribers: false }\n}\n\nclass Request {\n  constructor (origin, {\n    path,\n    method,\n    body,\n    headers,\n    query,\n    idempotent,\n    blocking,\n    upgrade,\n    headersTimeout,\n    bodyTimeout,\n    reset,\n    throwOnError,\n    expectContinue\n  }, handler) {\n    if (typeof path !== 'string') {\n      throw new InvalidArgumentError('path must be a string')\n    } else if (\n      path[0] !== '/' &&\n      !(path.startsWith('http://') || path.startsWith('https://')) &&\n      method !== 'CONNECT'\n    ) {\n      throw new InvalidArgumentError('path must be an absolute URL or start with a slash')\n    } else if (invalidPathRegex.exec(path) !== null) {\n      throw new InvalidArgumentError('invalid request path')\n    }\n\n    if (typeof method !== 'string') {\n      throw new InvalidArgumentError('method must be a string')\n    } else if (tokenRegExp.exec(method) === null) {\n      throw new InvalidArgumentError('invalid request method')\n    }\n\n    if (upgrade && typeof upgrade !== 'string') {\n      throw new InvalidArgumentError('upgrade must be a string')\n    }\n\n    if (headersTimeout != null && (!Number.isFinite(headersTimeout) || headersTimeout < 0)) {\n      throw new InvalidArgumentError('invalid headersTimeout')\n    }\n\n    if (bodyTimeout != null && (!Number.isFinite(bodyTimeout) || bodyTimeout < 0)) {\n      throw new InvalidArgumentError('invalid bodyTimeout')\n    }\n\n    if (reset != null && typeof reset !== 'boolean') {\n      throw new InvalidArgumentError('invalid reset')\n    }\n\n    if (expectContinue != null && typeof expectContinue !== 'boolean') {\n      throw new InvalidArgumentError('invalid expectContinue')\n    }\n\n    this.headersTimeout = headersTimeout\n\n    this.bodyTimeout = bodyTimeout\n\n    this.throwOnError = throwOnError === true\n\n    this.method = method\n\n    this.abort = null\n\n    if (body == null) {\n      this.body = null\n    } else if (util.isStream(body)) {\n      this.body = body\n\n      const rState = this.body._readableState\n      if (!rState || !rState.autoDestroy) {\n        this.endHandler = function autoDestroy () {\n          util.destroy(this)\n        }\n        this.body.on('end', this.endHandler)\n      }\n\n      this.errorHandler = err => {\n        if (this.abort) {\n          this.abort(err)\n        } else {\n          this.error = err\n        }\n      }\n      this.body.on('error', this.errorHandler)\n    } else if (util.isBuffer(body)) {\n      this.body = body.byteLength ? body : null\n    } else if (ArrayBuffer.isView(body)) {\n      this.body = body.buffer.byteLength ? Buffer.from(body.buffer, body.byteOffset, body.byteLength) : null\n    } else if (body instanceof ArrayBuffer) {\n      this.body = body.byteLength ? Buffer.from(body) : null\n    } else if (typeof body === 'string') {\n      this.body = body.length ? Buffer.from(body) : null\n    } else if (util.isFormDataLike(body) || util.isIterable(body) || util.isBlobLike(body)) {\n      this.body = body\n    } else {\n      throw new InvalidArgumentError('body must be a string, a Buffer, a Readable stream, an iterable, or an async iterable')\n    }\n\n    this.completed = false\n\n    this.aborted = false\n\n    this.upgrade = upgrade || null\n\n    this.path = query ? util.buildURL(path, query) : path\n\n    this.origin = origin\n\n    this.idempotent = idempotent == null\n      ? method === 'HEAD' || method === 'GET'\n      : idempotent\n\n    this.blocking = blocking == null ? false : blocking\n\n    this.reset = reset == null ? null : reset\n\n    this.host = null\n\n    this.contentLength = null\n\n    this.contentType = null\n\n    this.headers = ''\n\n    // Only for H2\n    this.expectContinue = expectContinue != null ? expectContinue : false\n\n    if (Array.isArray(headers)) {\n      if (headers.length % 2 !== 0) {\n        throw new InvalidArgumentError('headers array must be even')\n      }\n      for (let i = 0; i < headers.length; i += 2) {\n        processHeader(this, headers[i], headers[i + 1])\n      }\n    } else if (headers && typeof headers === 'object') {\n      const keys = Object.keys(headers)\n      for (let i = 0; i < keys.length; i++) {\n        const key = keys[i]\n        processHeader(this, key, headers[key])\n      }\n    } else if (headers != null) {\n      throw new InvalidArgumentError('headers must be an object or an array')\n    }\n\n    if (util.isFormDataLike(this.body)) {\n      if (util.nodeMajor < 16 || (util.nodeMajor === 16 && util.nodeMinor < 8)) {\n        throw new InvalidArgumentError('Form-Data bodies are only supported in node v16.8 and newer.')\n      }\n\n      if (!extractBody) {\n        extractBody = require('../fetch/body.js').extractBody\n      }\n\n      const [bodyStream, contentType] = extractBody(body)\n      if (this.contentType == null) {\n        this.contentType = contentType\n        this.headers += `content-type: ${contentType}\\r\\n`\n      }\n      this.body = bodyStream.stream\n      this.contentLength = bodyStream.length\n    } else if (util.isBlobLike(body) && this.contentType == null && body.type) {\n      this.contentType = body.type\n      this.headers += `content-type: ${body.type}\\r\\n`\n    }\n\n    util.validateHandler(handler, method, upgrade)\n\n    this.servername = util.getServerName(this.host)\n\n    this[kHandler] = handler\n\n    if (channels.create.hasSubscribers) {\n      channels.create.publish({ request: this })\n    }\n  }\n\n  onBodySent (chunk) {\n    if (this[kHandler].onBodySent) {\n      try {\n        return this[kHandler].onBodySent(chunk)\n      } catch (err) {\n        this.abort(err)\n      }\n    }\n  }\n\n  onRequestSent () {\n    if (channels.bodySent.hasSubscribers) {\n      channels.bodySent.publish({ request: this })\n    }\n\n    if (this[kHandler].onRequestSent) {\n      try {\n        return this[kHandler].onRequestSent()\n      } catch (err) {\n        this.abort(err)\n      }\n    }\n  }\n\n  onConnect (abort) {\n    assert(!this.aborted)\n    assert(!this.completed)\n\n    if (this.error) {\n      abort(this.error)\n    } else {\n      this.abort = abort\n      return this[kHandler].onConnect(abort)\n    }\n  }\n\n  onHeaders (statusCode, headers, resume, statusText) {\n    assert(!this.aborted)\n    assert(!this.completed)\n\n    if (channels.headers.hasSubscribers) {\n      channels.headers.publish({ request: this, response: { statusCode, headers, statusText } })\n    }\n\n    try {\n      return this[kHandler].onHeaders(statusCode, headers, resume, statusText)\n    } catch (err) {\n      this.abort(err)\n    }\n  }\n\n  onData (chunk) {\n    assert(!this.aborted)\n    assert(!this.completed)\n\n    try {\n      return this[kHandler].onData(chunk)\n    } catch (err) {\n      this.abort(err)\n      return false\n    }\n  }\n\n  onUpgrade (statusCode, headers, socket) {\n    assert(!this.aborted)\n    assert(!this.completed)\n\n    return this[kHandler].onUpgrade(statusCode, headers, socket)\n  }\n\n  onComplete (trailers) {\n    this.onFinally()\n\n    assert(!this.aborted)\n\n    this.completed = true\n    if (channels.trailers.hasSubscribers) {\n      channels.trailers.publish({ request: this, trailers })\n    }\n\n    try {\n      return this[kHandler].onComplete(trailers)\n    } catch (err) {\n      // TODO (fix): This might be a bad idea?\n      this.onError(err)\n    }\n  }\n\n  onError (error) {\n    this.onFinally()\n\n    if (channels.error.hasSubscribers) {\n      channels.error.publish({ request: this, error })\n    }\n\n    if (this.aborted) {\n      return\n    }\n    this.aborted = true\n\n    return this[kHandler].onError(error)\n  }\n\n  onFinally () {\n    if (this.errorHandler) {\n      this.body.off('error', this.errorHandler)\n      this.errorHandler = null\n    }\n\n    if (this.endHandler) {\n      this.body.off('end', this.endHandler)\n      this.endHandler = null\n    }\n  }\n\n  // TODO: adjust to support H2\n  addHeader (key, value) {\n    processHeader(this, key, value)\n    return this\n  }\n\n  static [kHTTP1BuildRequest] (origin, opts, handler) {\n    // TODO: Migrate header parsing here, to make Requests\n    // HTTP agnostic\n    return new Request(origin, opts, handler)\n  }\n\n  static [kHTTP2BuildRequest] (origin, opts, handler) {\n    const headers = opts.headers\n    opts = { ...opts, headers: null }\n\n    const request = new Request(origin, opts, handler)\n\n    request.headers = {}\n\n    if (Array.isArray(headers)) {\n      if (headers.length % 2 !== 0) {\n        throw new InvalidArgumentError('headers array must be even')\n      }\n      for (let i = 0; i < headers.length; i += 2) {\n        processHeader(request, headers[i], headers[i + 1], true)\n      }\n    } else if (headers && typeof headers === 'object') {\n      const keys = Object.keys(headers)\n      for (let i = 0; i < keys.length; i++) {\n        const key = keys[i]\n        processHeader(request, key, headers[key], true)\n      }\n    } else if (headers != null) {\n      throw new InvalidArgumentError('headers must be an object or an array')\n    }\n\n    return request\n  }\n\n  static [kHTTP2CopyHeaders] (raw) {\n    const rawHeaders = raw.split('\\r\\n')\n    const headers = {}\n\n    for (const header of rawHeaders) {\n      const [key, value] = header.split(': ')\n\n      if (value == null || value.length === 0) continue\n\n      if (headers[key]) headers[key] += `,${value}`\n      else headers[key] = value\n    }\n\n    return headers\n  }\n}\n\nfunction processHeaderValue (key, val, skipAppend) {\n  if (val && typeof val === 'object') {\n    throw new InvalidArgumentError(`invalid ${key} header`)\n  }\n\n  val = val != null ? `${val}` : ''\n\n  if (headerCharRegex.exec(val) !== null) {\n    throw new InvalidArgumentError(`invalid ${key} header`)\n  }\n\n  return skipAppend ? val : `${key}: ${val}\\r\\n`\n}\n\nfunction processHeader (request, key, val, skipAppend = false) {\n  if (val && (typeof val === 'object' && !Array.isArray(val))) {\n    throw new InvalidArgumentError(`invalid ${key} header`)\n  } else if (val === undefined) {\n    return\n  }\n\n  if (\n    request.host === null &&\n    key.length === 4 &&\n    key.toLowerCase() === 'host'\n  ) {\n    if (headerCharRegex.exec(val) !== null) {\n      throw new InvalidArgumentError(`invalid ${key} header`)\n    }\n    // Consumed by Client\n    request.host = val\n  } else if (\n    request.contentLength === null &&\n    key.length === 14 &&\n    key.toLowerCase() === 'content-length'\n  ) {\n    request.contentLength = parseInt(val, 10)\n    if (!Number.isFinite(request.contentLength)) {\n      throw new InvalidArgumentError('invalid content-length header')\n    }\n  } else if (\n    request.contentType === null &&\n    key.length === 12 &&\n    key.toLowerCase() === 'content-type'\n  ) {\n    request.contentType = val\n    if (skipAppend) request.headers[key] = processHeaderValue(key, val, skipAppend)\n    else request.headers += processHeaderValue(key, val)\n  } else if (\n    key.length === 17 &&\n    key.toLowerCase() === 'transfer-encoding'\n  ) {\n    throw new InvalidArgumentError('invalid transfer-encoding header')\n  } else if (\n    key.length === 10 &&\n    key.toLowerCase() === 'connection'\n  ) {\n    const value = typeof val === 'string' ? val.toLowerCase() : null\n    if (value !== 'close' && value !== 'keep-alive') {\n      throw new InvalidArgumentError('invalid connection header')\n    } else if (value === 'close') {\n      request.reset = true\n    }\n  } else if (\n    key.length === 10 &&\n    key.toLowerCase() === 'keep-alive'\n  ) {\n    throw new InvalidArgumentError('invalid keep-alive header')\n  } else if (\n    key.length === 7 &&\n    key.toLowerCase() === 'upgrade'\n  ) {\n    throw new InvalidArgumentError('invalid upgrade header')\n  } else if (\n    key.length === 6 &&\n    key.toLowerCase() === 'expect'\n  ) {\n    throw new NotSupportedError('expect header not supported')\n  } else if (tokenRegExp.exec(key) === null) {\n    throw new InvalidArgumentError('invalid header key')\n  } else {\n    if (Array.isArray(val)) {\n      for (let i = 0; i < val.length; i++) {\n        if (skipAppend) {\n          if (request.headers[key]) request.headers[key] += `,${processHeaderValue(key, val[i], skipAppend)}`\n          else request.headers[key] = processHeaderValue(key, val[i], skipAppend)\n        } else {\n          request.headers += processHeaderValue(key, val[i])\n        }\n      }\n    } else {\n      if (skipAppend) request.headers[key] = processHeaderValue(key, val, skipAppend)\n      else request.headers += processHeaderValue(key, val)\n    }\n  }\n}\n\nmodule.exports = Request\n","'use strict'\n\nconst EventEmitter = require('events')\n\nclass Dispatcher extends EventEmitter {\n  dispatch () {\n    throw new Error('not implemented')\n  }\n\n  close () {\n    throw new Error('not implemented')\n  }\n\n  destroy () {\n    throw new Error('not implemented')\n  }\n}\n\nmodule.exports = Dispatcher\n","'use strict'\n\nconst Dispatcher = require('./dispatcher')\nconst {\n  ClientDestroyedError,\n  ClientClosedError,\n  InvalidArgumentError\n} = require('./core/errors')\nconst { kDestroy, kClose, kDispatch, kInterceptors } = require('./core/symbols')\n\nconst kDestroyed = Symbol('destroyed')\nconst kClosed = Symbol('closed')\nconst kOnDestroyed = Symbol('onDestroyed')\nconst kOnClosed = Symbol('onClosed')\nconst kInterceptedDispatch = Symbol('Intercepted Dispatch')\n\nclass DispatcherBase extends Dispatcher {\n  constructor () {\n    super()\n\n    this[kDestroyed] = false\n    this[kOnDestroyed] = null\n    this[kClosed] = false\n    this[kOnClosed] = []\n  }\n\n  get destroyed () {\n    return this[kDestroyed]\n  }\n\n  get closed () {\n    return this[kClosed]\n  }\n\n  get interceptors () {\n    return this[kInterceptors]\n  }\n\n  set interceptors (newInterceptors) {\n    if (newInterceptors) {\n      for (let i = newInterceptors.length - 1; i >= 0; i--) {\n        const interceptor = this[kInterceptors][i]\n        if (typeof interceptor !== 'function') {\n          throw new InvalidArgumentError('interceptor must be an function')\n        }\n      }\n    }\n\n    this[kInterceptors] = newInterceptors\n  }\n\n  close (callback) {\n    if (callback === undefined) {\n      return new Promise((resolve, reject) => {\n        this.close((err, data) => {\n          return err ? reject(err) : resolve(data)\n        })\n      })\n    }\n\n    if (typeof callback !== 'function') {\n      throw new InvalidArgumentError('invalid callback')\n    }\n\n    if (this[kDestroyed]) {\n      queueMicrotask(() => callback(new ClientDestroyedError(), null))\n      return\n    }\n\n    if (this[kClosed]) {\n      if (this[kOnClosed]) {\n        this[kOnClosed].push(callback)\n      } else {\n        queueMicrotask(() => callback(null, null))\n      }\n      return\n    }\n\n    this[kClosed] = true\n    this[kOnClosed].push(callback)\n\n    const onClosed = () => {\n      const callbacks = this[kOnClosed]\n      this[kOnClosed] = null\n      for (let i = 0; i < callbacks.length; i++) {\n        callbacks[i](null, null)\n      }\n    }\n\n    // Should not error.\n    this[kClose]()\n      .then(() => this.destroy())\n      .then(() => {\n        queueMicrotask(onClosed)\n      })\n  }\n\n  destroy (err, callback) {\n    if (typeof err === 'function') {\n      callback = err\n      err = null\n    }\n\n    if (callback === undefined) {\n      return new Promise((resolve, reject) => {\n        this.destroy(err, (err, data) => {\n          return err ? /* istanbul ignore next: should never error */ reject(err) : resolve(data)\n        })\n      })\n    }\n\n    if (typeof callback !== 'function') {\n      throw new InvalidArgumentError('invalid callback')\n    }\n\n    if (this[kDestroyed]) {\n      if (this[kOnDestroyed]) {\n        this[kOnDestroyed].push(callback)\n      } else {\n        queueMicrotask(() => callback(null, null))\n      }\n      return\n    }\n\n    if (!err) {\n      err = new ClientDestroyedError()\n    }\n\n    this[kDestroyed] = true\n    this[kOnDestroyed] = this[kOnDestroyed] || []\n    this[kOnDestroyed].push(callback)\n\n    const onDestroyed = () => {\n      const callbacks = this[kOnDestroyed]\n      this[kOnDestroyed] = null\n      for (let i = 0; i < callbacks.length; i++) {\n        callbacks[i](null, null)\n      }\n    }\n\n    // Should not error.\n    this[kDestroy](err).then(() => {\n      queueMicrotask(onDestroyed)\n    })\n  }\n\n  [kInterceptedDispatch] (opts, handler) {\n    if (!this[kInterceptors] || this[kInterceptors].length === 0) {\n      this[kInterceptedDispatch] = this[kDispatch]\n      return this[kDispatch](opts, handler)\n    }\n\n    let dispatch = this[kDispatch].bind(this)\n    for (let i = this[kInterceptors].length - 1; i >= 0; i--) {\n      dispatch = this[kInterceptors][i](dispatch)\n    }\n    this[kInterceptedDispatch] = dispatch\n    return dispatch(opts, handler)\n  }\n\n  dispatch (opts, handler) {\n    if (!handler || typeof handler !== 'object') {\n      throw new InvalidArgumentError('handler must be an object')\n    }\n\n    try {\n      if (!opts || typeof opts !== 'object') {\n        throw new InvalidArgumentError('opts must be an object.')\n      }\n\n      if (this[kDestroyed] || this[kOnDestroyed]) {\n        throw new ClientDestroyedError()\n      }\n\n      if (this[kClosed]) {\n        throw new ClientClosedError()\n      }\n\n      return this[kInterceptedDispatch](opts, handler)\n    } catch (err) {\n      if (typeof handler.onError !== 'function') {\n        throw new InvalidArgumentError('invalid onError method')\n      }\n\n      handler.onError(err)\n\n      return false\n    }\n  }\n}\n\nmodule.exports = DispatcherBase\n","'use strict'\n\nconst net = require('net')\nconst assert = require('assert')\nconst util = require('./util')\nconst { InvalidArgumentError, ConnectTimeoutError } = require('./errors')\n\nlet tls // include tls conditionally since it is not always available\n\n// TODO: session re-use does not wait for the first\n// connection to resolve the session and might therefore\n// resolve the same servername multiple times even when\n// re-use is enabled.\n\nlet SessionCache\n// FIXME: remove workaround when the Node bug is fixed\n// https://github.com/nodejs/node/issues/49344#issuecomment-1741776308\nif (global.FinalizationRegistry && !process.env.NODE_V8_COVERAGE) {\n  SessionCache = class WeakSessionCache {\n    constructor (maxCachedSessions) {\n      this._maxCachedSessions = maxCachedSessions\n      this._sessionCache = new Map()\n      this._sessionRegistry = new global.FinalizationRegistry((key) => {\n        if (this._sessionCache.size < this._maxCachedSessions) {\n          return\n        }\n\n        const ref = this._sessionCache.get(key)\n        if (ref !== undefined && ref.deref() === undefined) {\n          this._sessionCache.delete(key)\n        }\n      })\n    }\n\n    get (sessionKey) {\n      const ref = this._sessionCache.get(sessionKey)\n      return ref ? ref.deref() : null\n    }\n\n    set (sessionKey, session) {\n      if (this._maxCachedSessions === 0) {\n        return\n      }\n\n      this._sessionCache.set(sessionKey, new WeakRef(session))\n      this._sessionRegistry.register(session, sessionKey)\n    }\n  }\n} else {\n  SessionCache = class SimpleSessionCache {\n    constructor (maxCachedSessions) {\n      this._maxCachedSessions = maxCachedSessions\n      this._sessionCache = new Map()\n    }\n\n    get (sessionKey) {\n      return this._sessionCache.get(sessionKey)\n    }\n\n    set (sessionKey, session) {\n      if (this._maxCachedSessions === 0) {\n        return\n      }\n\n      if (this._sessionCache.size >= this._maxCachedSessions) {\n        // remove the oldest session\n        const { value: oldestKey } = this._sessionCache.keys().next()\n        this._sessionCache.delete(oldestKey)\n      }\n\n      this._sessionCache.set(sessionKey, session)\n    }\n  }\n}\n\nfunction buildConnector ({ allowH2, maxCachedSessions, socketPath, timeout, ...opts }) {\n  if (maxCachedSessions != null && (!Number.isInteger(maxCachedSessions) || maxCachedSessions < 0)) {\n    throw new InvalidArgumentError('maxCachedSessions must be a positive integer or zero')\n  }\n\n  const options = { path: socketPath, ...opts }\n  const sessionCache = new SessionCache(maxCachedSessions == null ? 100 : maxCachedSessions)\n  timeout = timeout == null ? 10e3 : timeout\n  allowH2 = allowH2 != null ? allowH2 : false\n  return function connect ({ hostname, host, protocol, port, servername, localAddress, httpSocket }, callback) {\n    let socket\n    if (protocol === 'https:') {\n      if (!tls) {\n        tls = require('tls')\n      }\n      servername = servername || options.servername || util.getServerName(host) || null\n\n      const sessionKey = servername || hostname\n      const session = sessionCache.get(sessionKey) || null\n\n      assert(sessionKey)\n\n      socket = tls.connect({\n        highWaterMark: 16384, // TLS in node can't have bigger HWM anyway...\n        ...options,\n        servername,\n        session,\n        localAddress,\n        // TODO(HTTP/2): Add support for h2c\n        ALPNProtocols: allowH2 ? ['http/1.1', 'h2'] : ['http/1.1'],\n        socket: httpSocket, // upgrade socket connection\n        port: port || 443,\n        host: hostname\n      })\n\n      socket\n        .on('session', function (session) {\n          // TODO (fix): Can a session become invalid once established? Don't think so?\n          sessionCache.set(sessionKey, session)\n        })\n    } else {\n      assert(!httpSocket, 'httpSocket can only be sent on TLS update')\n      socket = net.connect({\n        highWaterMark: 64 * 1024, // Same as nodejs fs streams.\n        ...options,\n        localAddress,\n        port: port || 80,\n        host: hostname\n      })\n    }\n\n    // Set TCP keep alive options on the socket here instead of in connect() for the case of assigning the socket\n    if (options.keepAlive == null || options.keepAlive) {\n      const keepAliveInitialDelay = options.keepAliveInitialDelay === undefined ? 60e3 : options.keepAliveInitialDelay\n      socket.setKeepAlive(true, keepAliveInitialDelay)\n    }\n\n    const cancelTimeout = setupTimeout(() => onConnectTimeout(socket), timeout)\n\n    socket\n      .setNoDelay(true)\n      .once(protocol === 'https:' ? 'secureConnect' : 'connect', function () {\n        cancelTimeout()\n\n        if (callback) {\n          const cb = callback\n          callback = null\n          cb(null, this)\n        }\n      })\n      .on('error', function (err) {\n        cancelTimeout()\n\n        if (callback) {\n          const cb = callback\n          callback = null\n          cb(err)\n        }\n      })\n\n    return socket\n  }\n}\n\nfunction setupTimeout (onConnectTimeout, timeout) {\n  if (!timeout) {\n    return () => {}\n  }\n\n  let s1 = null\n  let s2 = null\n  const timeoutId = setTimeout(() => {\n    // setImmediate is added to make sure that we priotorise socket error events over timeouts\n    s1 = setImmediate(() => {\n      if (process.platform === 'win32') {\n        // Windows needs an extra setImmediate probably due to implementation differences in the socket logic\n        s2 = setImmediate(() => onConnectTimeout())\n      } else {\n        onConnectTimeout()\n      }\n    })\n  }, timeout)\n  return () => {\n    clearTimeout(timeoutId)\n    clearImmediate(s1)\n    clearImmediate(s2)\n  }\n}\n\nfunction onConnectTimeout (socket) {\n  util.destroy(socket, new ConnectTimeoutError())\n}\n\nmodule.exports = buildConnector\n",null,null,"'use strict'\n\nconst util = require('../core/util')\nconst { kBodyUsed } = require('../core/symbols')\nconst assert = require('assert')\nconst { InvalidArgumentError } = require('../core/errors')\nconst EE = require('events')\n\nconst redirectableStatusCodes = [300, 301, 302, 303, 307, 308]\n\nconst kBody = Symbol('body')\n\nclass BodyAsyncIterable {\n  constructor (body) {\n    this[kBody] = body\n    this[kBodyUsed] = false\n  }\n\n  async * [Symbol.asyncIterator] () {\n    assert(!this[kBodyUsed], 'disturbed')\n    this[kBodyUsed] = true\n    yield * this[kBody]\n  }\n}\n\nclass RedirectHandler {\n  constructor (dispatch, maxRedirections, opts, handler) {\n    if (maxRedirections != null && (!Number.isInteger(maxRedirections) || maxRedirections < 0)) {\n      throw new InvalidArgumentError('maxRedirections must be a positive number')\n    }\n\n    util.validateHandler(handler, opts.method, opts.upgrade)\n\n    this.dispatch = dispatch\n    this.location = null\n    this.abort = null\n    this.opts = { ...opts, maxRedirections: 0 } // opts must be a copy\n    this.maxRedirections = maxRedirections\n    this.handler = handler\n    this.history = []\n\n    if (util.isStream(this.opts.body)) {\n      // TODO (fix): Provide some way for the user to cache the file to e.g. /tmp\n      // so that it can be dispatched again?\n      // TODO (fix): Do we need 100-expect support to provide a way to do this properly?\n      if (util.bodyLength(this.opts.body) === 0) {\n        this.opts.body\n          .on('data', function () {\n            assert(false)\n          })\n      }\n\n      if (typeof this.opts.body.readableDidRead !== 'boolean') {\n        this.opts.body[kBodyUsed] = false\n        EE.prototype.on.call(this.opts.body, 'data', function () {\n          this[kBodyUsed] = true\n        })\n      }\n    } else if (this.opts.body && typeof this.opts.body.pipeTo === 'function') {\n      // TODO (fix): We can't access ReadableStream internal state\n      // to determine whether or not it has been disturbed. This is just\n      // a workaround.\n      this.opts.body = new BodyAsyncIterable(this.opts.body)\n    } else if (\n      this.opts.body &&\n      typeof this.opts.body !== 'string' &&\n      !ArrayBuffer.isView(this.opts.body) &&\n      util.isIterable(this.opts.body)\n    ) {\n      // TODO: Should we allow re-using iterable if !this.opts.idempotent\n      // or through some other flag?\n      this.opts.body = new BodyAsyncIterable(this.opts.body)\n    }\n  }\n\n  onConnect (abort) {\n    this.abort = abort\n    this.handler.onConnect(abort, { history: this.history })\n  }\n\n  onUpgrade (statusCode, headers, socket) {\n    this.handler.onUpgrade(statusCode, headers, socket)\n  }\n\n  onError (error) {\n    this.handler.onError(error)\n  }\n\n  onHeaders (statusCode, headers, resume, statusText) {\n    this.location = this.history.length >= this.maxRedirections || util.isDisturbed(this.opts.body)\n      ? null\n      : parseLocation(statusCode, headers)\n\n    if (this.opts.origin) {\n      this.history.push(new URL(this.opts.path, this.opts.origin))\n    }\n\n    if (!this.location) {\n      return this.handler.onHeaders(statusCode, headers, resume, statusText)\n    }\n\n    const { origin, pathname, search } = util.parseURL(new URL(this.location, this.opts.origin && new URL(this.opts.path, this.opts.origin)))\n    const path = search ? `${pathname}${search}` : pathname\n\n    // Remove headers referring to the original URL.\n    // By default it is Host only, unless it's a 303 (see below), which removes also all Content-* headers.\n    // https://tools.ietf.org/html/rfc7231#section-6.4\n    this.opts.headers = cleanRequestHeaders(this.opts.headers, statusCode === 303, this.opts.origin !== origin)\n    this.opts.path = path\n    this.opts.origin = origin\n    this.opts.maxRedirections = 0\n    this.opts.query = null\n\n    // https://tools.ietf.org/html/rfc7231#section-6.4.4\n    // In case of HTTP 303, always replace method to be either HEAD or GET\n    if (statusCode === 303 && this.opts.method !== 'HEAD') {\n      this.opts.method = 'GET'\n      this.opts.body = null\n    }\n  }\n\n  onData (chunk) {\n    if (this.location) {\n      /*\n        https://tools.ietf.org/html/rfc7231#section-6.4\n\n        TLDR: undici always ignores 3xx response bodies.\n\n        Redirection is used to serve the requested resource from another URL, so it is assumes that\n        no body is generated (and thus can be ignored). Even though generating a body is not prohibited.\n\n        For status 301, 302, 303, 307 and 308 (the latter from RFC 7238), the specs mention that the body usually\n        (which means it's optional and not mandated) contain just an hyperlink to the value of\n        the Location response header, so the body can be ignored safely.\n\n        For status 300, which is \"Multiple Choices\", the spec mentions both generating a Location\n        response header AND a response body with the other possible location to follow.\n        Since the spec explicitily chooses not to specify a format for such body and leave it to\n        servers and browsers implementors, we ignore the body as there is no specified way to eventually parse it.\n      */\n    } else {\n      return this.handler.onData(chunk)\n    }\n  }\n\n  onComplete (trailers) {\n    if (this.location) {\n      /*\n        https://tools.ietf.org/html/rfc7231#section-6.4\n\n        TLDR: undici always ignores 3xx response trailers as they are not expected in case of redirections\n        and neither are useful if present.\n\n        See comment on onData method above for more detailed informations.\n      */\n\n      this.location = null\n      this.abort = null\n\n      this.dispatch(this.opts, this)\n    } else {\n      this.handler.onComplete(trailers)\n    }\n  }\n\n  onBodySent (chunk) {\n    if (this.handler.onBodySent) {\n      this.handler.onBodySent(chunk)\n    }\n  }\n}\n\nfunction parseLocation (statusCode, headers) {\n  if (redirectableStatusCodes.indexOf(statusCode) === -1) {\n    return null\n  }\n\n  for (let i = 0; i < headers.length; i += 2) {\n    if (headers[i].toString().toLowerCase() === 'location') {\n      return headers[i + 1]\n    }\n  }\n}\n\n// https://tools.ietf.org/html/rfc7231#section-6.4.4\nfunction shouldRemoveHeader (header, removeContent, unknownOrigin) {\n  if (header.length === 4) {\n    return util.headerNameToString(header) === 'host'\n  }\n  if (removeContent && util.headerNameToString(header).startsWith('content-')) {\n    return true\n  }\n  if (unknownOrigin && (header.length === 13 || header.length === 6 || header.length === 19)) {\n    const name = util.headerNameToString(header)\n    return name === 'authorization' || name === 'cookie' || name === 'proxy-authorization'\n  }\n  return false\n}\n\n// https://tools.ietf.org/html/rfc7231#section-6.4\nfunction cleanRequestHeaders (headers, removeContent, unknownOrigin) {\n  const ret = []\n  if (Array.isArray(headers)) {\n    for (let i = 0; i < headers.length; i += 2) {\n      if (!shouldRemoveHeader(headers[i], removeContent, unknownOrigin)) {\n        ret.push(headers[i], headers[i + 1])\n      }\n    }\n  } else if (headers && typeof headers === 'object') {\n    for (const key of Object.keys(headers)) {\n      if (!shouldRemoveHeader(key, removeContent, unknownOrigin)) {\n        ret.push(key, headers[key])\n      }\n    }\n  } else {\n    assert(headers == null, 'headers must be an object or an array')\n  }\n  return ret\n}\n\nmodule.exports = RedirectHandler\n","'use strict'\n\nconst RedirectHandler = require('../handler/RedirectHandler')\n\nfunction createRedirectInterceptor ({ maxRedirections: defaultMaxRedirections }) {\n  return (dispatch) => {\n    return function Intercept (opts, handler) {\n      const { maxRedirections = defaultMaxRedirections } = opts\n\n      if (!maxRedirections) {\n        return dispatch(opts, handler)\n      }\n\n      const redirectHandler = new RedirectHandler(dispatch, maxRedirections, opts, handler)\n      opts = { ...opts, maxRedirections: 0 } // Stop sub dispatcher from also redirecting.\n      return dispatch(opts, redirectHandler)\n    }\n  }\n}\n\nmodule.exports = createRedirectInterceptor\n","module.exports = 'AGFzbQEAAAABMAhgAX8Bf2ADf39/AX9gBH9/f38Bf2AAAGADf39/AGABfwBgAn9/AGAGf39/f39/AALLAQgDZW52GHdhc21fb25faGVhZGVyc19jb21wbGV0ZQACA2VudhV3YXNtX29uX21lc3NhZ2VfYmVnaW4AAANlbnYLd2FzbV9vbl91cmwAAQNlbnYOd2FzbV9vbl9zdGF0dXMAAQNlbnYUd2FzbV9vbl9oZWFkZXJfZmllbGQAAQNlbnYUd2FzbV9vbl9oZWFkZXJfdmFsdWUAAQNlbnYMd2FzbV9vbl9ib2R5AAEDZW52GHdhc21fb25fbWVzc2FnZV9jb21wbGV0ZQAAA0ZFAwMEAAAFAAAAAAAABQEFAAUFBQAABgAAAAAGBgYGAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQABAAABAQcAAAUFAwABBAUBcAESEgUDAQACBggBfwFBgNQECwfRBSIGbWVtb3J5AgALX2luaXRpYWxpemUACRlfX2luZGlyZWN0X2Z1bmN0aW9uX3RhYmxlAQALbGxodHRwX2luaXQAChhsbGh0dHBfc2hvdWxkX2tlZXBfYWxpdmUAQQxsbGh0dHBfYWxsb2MADAZtYWxsb2MARgtsbGh0dHBfZnJlZQANBGZyZWUASA9sbGh0dHBfZ2V0X3R5cGUADhVsbGh0dHBfZ2V0X2h0dHBfbWFqb3IADxVsbGh0dHBfZ2V0X2h0dHBfbWlub3IAEBFsbGh0dHBfZ2V0X21ldGhvZAARFmxsaHR0cF9nZXRfc3RhdHVzX2NvZGUAEhJsbGh0dHBfZ2V0X3VwZ3JhZGUAEwxsbGh0dHBfcmVzZXQAFA5sbGh0dHBfZXhlY3V0ZQAVFGxsaHR0cF9zZXR0aW5nc19pbml0ABYNbGxodHRwX2ZpbmlzaAAXDGxsaHR0cF9wYXVzZQAYDWxsaHR0cF9yZXN1bWUAGRtsbGh0dHBfcmVzdW1lX2FmdGVyX3VwZ3JhZGUAGhBsbGh0dHBfZ2V0X2Vycm5vABsXbGxodHRwX2dldF9lcnJvcl9yZWFzb24AHBdsbGh0dHBfc2V0X2Vycm9yX3JlYXNvbgAdFGxsaHR0cF9nZXRfZXJyb3JfcG9zAB4RbGxodHRwX2Vycm5vX25hbWUAHxJsbGh0dHBfbWV0aG9kX25hbWUAIBJsbGh0dHBfc3RhdHVzX25hbWUAIRpsbGh0dHBfc2V0X2xlbmllbnRfaGVhZGVycwAiIWxsaHR0cF9zZXRfbGVuaWVudF9jaHVua2VkX2xlbmd0aAAjHWxsaHR0cF9zZXRfbGVuaWVudF9rZWVwX2FsaXZlACQkbGxodHRwX3NldF9sZW5pZW50X3RyYW5zZmVyX2VuY29kaW5nACUYbGxodHRwX21lc3NhZ2VfbmVlZHNfZW9mAD8JFwEAQQELEQECAwQFCwYHNTk3MS8tJyspCsLgAkUCAAsIABCIgICAAAsZACAAEMKAgIAAGiAAIAI2AjggACABOgAoCxwAIAAgAC8BMiAALQAuIAAQwYCAgAAQgICAgAALKgEBf0HAABDGgICAACIBEMKAgIAAGiABQYCIgIAANgI4IAEgADoAKCABCwoAIAAQyICAgAALBwAgAC0AKAsHACAALQAqCwcAIAAtACsLBwAgAC0AKQsHACAALwEyCwcAIAAtAC4LRQEEfyAAKAIYIQEgAC0ALSECIAAtACghAyAAKAI4IQQgABDCgICAABogACAENgI4IAAgAzoAKCAAIAI6AC0gACABNgIYCxEAIAAgASABIAJqEMOAgIAACxAAIABBAEHcABDMgICAABoLZwEBf0EAIQECQCAAKAIMDQACQAJAAkACQCAALQAvDgMBAAMCCyAAKAI4IgFFDQAgASgCLCIBRQ0AIAAgARGAgICAAAAiAQ0DC0EADwsQyoCAgAAACyAAQcOWgIAANgIQQQ4hAQsgAQseAAJAIAAoAgwNACAAQdGbgIAANgIQIABBFTYCDAsLFgACQCAAKAIMQRVHDQAgAEEANgIMCwsWAAJAIAAoAgxBFkcNACAAQQA2AgwLCwcAIAAoAgwLBwAgACgCEAsJACAAIAE2AhALBwAgACgCFAsiAAJAIABBJEkNABDKgICAAAALIABBAnRBoLOAgABqKAIACyIAAkAgAEEuSQ0AEMqAgIAAAAsgAEECdEGwtICAAGooAgAL7gsBAX9B66iAgAAhAQJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAIABBnH9qDvQDY2IAAWFhYWFhYQIDBAVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhBgcICQoLDA0OD2FhYWFhEGFhYWFhYWFhYWFhEWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYRITFBUWFxgZGhthYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhHB0eHyAhIiMkJSYnKCkqKywtLi8wMTIzNDU2YTc4OTphYWFhYWFhYTthYWE8YWFhYT0+P2FhYWFhYWFhQGFhQWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYUJDREVGR0hJSktMTU5PUFFSU2FhYWFhYWFhVFVWV1hZWlthXF1hYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFeYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhX2BhC0Hhp4CAAA8LQaShgIAADwtBy6yAgAAPC0H+sYCAAA8LQcCkgIAADwtBq6SAgAAPC0GNqICAAA8LQeKmgIAADwtBgLCAgAAPC0G5r4CAAA8LQdekgIAADwtB75+AgAAPC0Hhn4CAAA8LQfqfgIAADwtB8qCAgAAPC0Gor4CAAA8LQa6ygIAADwtBiLCAgAAPC0Hsp4CAAA8LQYKigIAADwtBjp2AgAAPC0HQroCAAA8LQcqjgIAADwtBxbKAgAAPC0HfnICAAA8LQdKcgIAADwtBxKCAgAAPC0HXoICAAA8LQaKfgIAADwtB7a6AgAAPC0GrsICAAA8LQdSlgIAADwtBzK6AgAAPC0H6roCAAA8LQfyrgIAADwtB0rCAgAAPC0HxnYCAAA8LQbuggIAADwtB96uAgAAPC0GQsYCAAA8LQdexgIAADwtBoq2AgAAPC0HUp4CAAA8LQeCrgIAADwtBn6yAgAAPC0HrsYCAAA8LQdWfgIAADwtByrGAgAAPC0HepYCAAA8LQdSegIAADwtB9JyAgAAPC0GnsoCAAA8LQbGdgIAADwtBoJ2AgAAPC0G5sYCAAA8LQbywgIAADwtBkqGAgAAPC0GzpoCAAA8LQemsgIAADwtBrJ6AgAAPC0HUq4CAAA8LQfemgIAADwtBgKaAgAAPC0GwoYCAAA8LQf6egIAADwtBjaOAgAAPC0GJrYCAAA8LQfeigIAADwtBoLGAgAAPC0Gun4CAAA8LQcalgIAADwtB6J6AgAAPC0GTooCAAA8LQcKvgIAADwtBw52AgAAPC0GLrICAAA8LQeGdgIAADwtBja+AgAAPC0HqoYCAAA8LQbStgIAADwtB0q+AgAAPC0HfsoCAAA8LQdKygIAADwtB8LCAgAAPC0GpooCAAA8LQfmjgIAADwtBmZ6AgAAPC0G1rICAAA8LQZuwgIAADwtBkrKAgAAPC0G2q4CAAA8LQcKigIAADwtB+LKAgAAPC0GepYCAAA8LQdCigIAADwtBup6AgAAPC0GBnoCAAA8LEMqAgIAAAAtB1qGAgAAhAQsgAQsWACAAIAAtAC1B/gFxIAFBAEdyOgAtCxkAIAAgAC0ALUH9AXEgAUEAR0EBdHI6AC0LGQAgACAALQAtQfsBcSABQQBHQQJ0cjoALQsZACAAIAAtAC1B9wFxIAFBAEdBA3RyOgAtCy4BAn9BACEDAkAgACgCOCIERQ0AIAQoAgAiBEUNACAAIAQRgICAgAAAIQMLIAMLSQECf0EAIQMCQCAAKAI4IgRFDQAgBCgCBCIERQ0AIAAgASACIAFrIAQRgYCAgAAAIgNBf0cNACAAQcaRgIAANgIQQRghAwsgAwsuAQJ/QQAhAwJAIAAoAjgiBEUNACAEKAIwIgRFDQAgACAEEYCAgIAAACEDCyADC0kBAn9BACEDAkAgACgCOCIERQ0AIAQoAggiBEUNACAAIAEgAiABayAEEYGAgIAAACIDQX9HDQAgAEH2ioCAADYCEEEYIQMLIAMLLgECf0EAIQMCQCAAKAI4IgRFDQAgBCgCNCIERQ0AIAAgBBGAgICAAAAhAwsgAwtJAQJ/QQAhAwJAIAAoAjgiBEUNACAEKAIMIgRFDQAgACABIAIgAWsgBBGBgICAAAAiA0F/Rw0AIABB7ZqAgAA2AhBBGCEDCyADCy4BAn9BACEDAkAgACgCOCIERQ0AIAQoAjgiBEUNACAAIAQRgICAgAAAIQMLIAMLSQECf0EAIQMCQCAAKAI4IgRFDQAgBCgCECIERQ0AIAAgASACIAFrIAQRgYCAgAAAIgNBf0cNACAAQZWQgIAANgIQQRghAwsgAwsuAQJ/QQAhAwJAIAAoAjgiBEUNACAEKAI8IgRFDQAgACAEEYCAgIAAACEDCyADC0kBAn9BACEDAkAgACgCOCIERQ0AIAQoAhQiBEUNACAAIAEgAiABayAEEYGAgIAAACIDQX9HDQAgAEGqm4CAADYCEEEYIQMLIAMLLgECf0EAIQMCQCAAKAI4IgRFDQAgBCgCQCIERQ0AIAAgBBGAgICAAAAhAwsgAwtJAQJ/QQAhAwJAIAAoAjgiBEUNACAEKAIYIgRFDQAgACABIAIgAWsgBBGBgICAAAAiA0F/Rw0AIABB7ZOAgAA2AhBBGCEDCyADCy4BAn9BACEDAkAgACgCOCIERQ0AIAQoAkQiBEUNACAAIAQRgICAgAAAIQMLIAMLLgECf0EAIQMCQCAAKAI4IgRFDQAgBCgCJCIERQ0AIAAgBBGAgICAAAAhAwsgAwsuAQJ/QQAhAwJAIAAoAjgiBEUNACAEKAIsIgRFDQAgACAEEYCAgIAAACEDCyADC0kBAn9BACEDAkAgACgCOCIERQ0AIAQoAigiBEUNACAAIAEgAiABayAEEYGAgIAAACIDQX9HDQAgAEH2iICAADYCEEEYIQMLIAMLLgECf0EAIQMCQCAAKAI4IgRFDQAgBCgCUCIERQ0AIAAgBBGAgICAAAAhAwsgAwtJAQJ/QQAhAwJAIAAoAjgiBEUNACAEKAIcIgRFDQAgACABIAIgAWsgBBGBgICAAAAiA0F/Rw0AIABBwpmAgAA2AhBBGCEDCyADCy4BAn9BACEDAkAgACgCOCIERQ0AIAQoAkgiBEUNACAAIAQRgICAgAAAIQMLIAMLSQECf0EAIQMCQCAAKAI4IgRFDQAgBCgCICIERQ0AIAAgASACIAFrIAQRgYCAgAAAIgNBf0cNACAAQZSUgIAANgIQQRghAwsgAwsuAQJ/QQAhAwJAIAAoAjgiBEUNACAEKAJMIgRFDQAgACAEEYCAgIAAACEDCyADCy4BAn9BACEDAkAgACgCOCIERQ0AIAQoAlQiBEUNACAAIAQRgICAgAAAIQMLIAMLLgECf0EAIQMCQCAAKAI4IgRFDQAgBCgCWCIERQ0AIAAgBBGAgICAAAAhAwsgAwtFAQF/AkACQCAALwEwQRRxQRRHDQBBASEDIAAtAChBAUYNASAALwEyQeUARiEDDAELIAAtAClBBUYhAwsgACADOgAuQQAL/gEBA39BASEDAkAgAC8BMCIEQQhxDQAgACkDIEIAUiEDCwJAAkAgAC0ALkUNAEEBIQUgAC0AKUEFRg0BQQEhBSAEQcAAcUUgA3FBAUcNAQtBACEFIARBwABxDQBBAiEFIARB//8DcSIDQQhxDQACQCADQYAEcUUNAAJAIAAtAChBAUcNACAALQAtQQpxDQBBBQ8LQQQPCwJAIANBIHENAAJAIAAtAChBAUYNACAALwEyQf//A3EiAEGcf2pB5ABJDQAgAEHMAUYNACAAQbACRg0AQQQhBSAEQShxRQ0CIANBiARxQYAERg0CC0EADwtBAEEDIAApAyBQGyEFCyAFC2IBAn9BACEBAkAgAC0AKEEBRg0AIAAvATJB//8DcSICQZx/akHkAEkNACACQcwBRg0AIAJBsAJGDQAgAC8BMCIAQcAAcQ0AQQEhASAAQYgEcUGABEYNACAAQShxRSEBCyABC6cBAQN/AkACQAJAIAAtACpFDQAgAC0AK0UNAEEAIQMgAC8BMCIEQQJxRQ0BDAILQQAhAyAALwEwIgRBAXFFDQELQQEhAyAALQAoQQFGDQAgAC8BMkH//wNxIgVBnH9qQeQASQ0AIAVBzAFGDQAgBUGwAkYNACAEQcAAcQ0AQQAhAyAEQYgEcUGABEYNACAEQShxQQBHIQMLIABBADsBMCAAQQA6AC8gAwuZAQECfwJAAkACQCAALQAqRQ0AIAAtACtFDQBBACEBIAAvATAiAkECcUUNAQwCC0EAIQEgAC8BMCICQQFxRQ0BC0EBIQEgAC0AKEEBRg0AIAAvATJB//8DcSIAQZx/akHkAEkNACAAQcwBRg0AIABBsAJGDQAgAkHAAHENAEEAIQEgAkGIBHFBgARGDQAgAkEocUEARyEBCyABC1kAIABBGGpCADcDACAAQgA3AwAgAEE4akIANwMAIABBMGpCADcDACAAQShqQgA3AwAgAEEgakIANwMAIABBEGpCADcDACAAQQhqQgA3AwAgAEHdATYCHEEAC3sBAX8CQCAAKAIMIgMNAAJAIAAoAgRFDQAgACABNgIECwJAIAAgASACEMSAgIAAIgMNACAAKAIMDwsgACADNgIcQQAhAyAAKAIEIgFFDQAgACABIAIgACgCCBGBgICAAAAiAUUNACAAIAI2AhQgACABNgIMIAEhAwsgAwvk8wEDDn8DfgR/I4CAgIAAQRBrIgMkgICAgAAgASEEIAEhBSABIQYgASEHIAEhCCABIQkgASEKIAEhCyABIQwgASENIAEhDiABIQ8CQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAgACgCHCIQQX9qDt0B2gEB2QECAwQFBgcICQoLDA0O2AEPENcBERLWARMUFRYXGBkaG+AB3wEcHR7VAR8gISIjJCXUASYnKCkqKyzTAdIBLS7RAdABLzAxMjM0NTY3ODk6Ozw9Pj9AQUJDREVG2wFHSElKzwHOAUvNAUzMAU1OT1BRUlNUVVZXWFlaW1xdXl9gYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXp7fH1+f4ABgQGCAYMBhAGFAYYBhwGIAYkB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QAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAC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FCAAIBA2AgxBACEQDLIBCyAAKAIEIRAgAEEANgIEAkAgACAQIAEQp4CAgAAiEA0AIAEhAQxNCyAAQdMANgIcIAAgATYCFCAAIBA2AgxBACEQDLEBCyAAKAIEIRAgAEEANgIEAkAgACAQIAEQp4CAgAAiEA0AIAEhAQxRCyAAQeUANgIcIAAgATYCFCAAIBA2AgxBACEQDLABCyAAQQA2AhwgACABNgIUIABBxoqAgAA2AhAgAEEHNgIMQQAhEAyvAQsgACgCBCEQIABBADYCBAJAIAAgECABEKeAgIAAIhANACABIQEMSQsgAEHSADYCHCAAIAE2AhQgACAQNgIMQQAhEAyuAQsgACgCBCEQIABBADYCBAJAIAAgECABEKeAgIAAIhANACABIQEMSQsgAEHTADYCHCAAIAE2AhQgACAQNgIMQQAhEAytAQsgACgCBCEQIABBADYCBAJAIAAgECABEKeAgIAAIhANACABIQEMTQsgAEHlADYCHCAAIAE2AhQgACAQNgIMQQAhEAysAQsgAEEANgIcIAAgATYCFCAAQdyIgIAANgIQIABBBzYCDEEAIRAMqwELIBBBP0cNASABQQFqIQELQQUhEAyQAQtBACEQIABBADYCHCAAIAE2AhQgAEH9koCAADYCECAAQQc2AgwMqAELIAAoAgQhECAAQQA2AgQCQCAAIBAgARCngICAACIQDQAgASEBDEILIABB0gA2AhwgACABNgIUIAAgEDYCDEEAIRAMpwELIAAoAgQhECAAQQA2AgQCQCAAIBAgARCngICAACIQDQAgASEBDEILIABB0wA2AhwgACABNgIUIAAgEDYCDEEAIRAMpgELIAAoAgQhECAAQQA2AgQCQCAAIBAgARCngICAACIQDQAgASEBDEYLIABB5QA2AhwgACABNgIUIAAgEDYCDEEAIRAMpQELIAAoAgQhASAAQQA2AgQCQCAAIAEgFBCngICAACIBDQAgFCEBDD8LIABB0gA2AhwgACAUNgIUIAAgATYCDEEAIRAMpAELIAAoAgQhASAAQQA2AgQCQCAAIAEgFBCngICAACIBDQAgFCEBDD8LIABB0wA2AhwgACAUNgIUIAAgATYCDEEAIRAMowELIAAoAgQhASAAQQA2AgQCQCAAIAEgFBCngICAACIBDQAgFCEBDEMLIABB5QA2AhwgACAU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YWdlX2JlZ2luYCBjYWxsYmFjayBlcnJvcgBgb25fY2h1bmtfZXh0ZW5zaW9uX3ZhbHVlYCBjYWxsYmFjayBlcnJvcgBgb25fc3RhdHVzX2NvbXBsZXRlYCBjYWxsYmFjayBlcnJvcgBgb25fdmVyc2lvbl9jb21wbGV0ZWAgY2FsbGJhY2sgZXJyb3IAYG9uX3VybF9jb21wbGV0ZWAgY2FsbGJhY2sgZXJyb3IAYG9uX2NodW5rX2NvbXBsZXRlYCBjYWxsYmFjayBlcnJvcgBgb25faGVhZGVyX3ZhbHVlX2NvbXBsZXRlYCBjYWxsYmFjayBlcnJvcgBgb25fbWVzc2FnZV9jb21wbGV0ZWAgY2FsbGJhY2sgZXJyb3IAYG9uX21ldGhvZF9jb21wbGV0ZWAgY2FsbGJhY2sgZXJyb3IAYG9uX2hlYWRlcl9maWVsZF9jb21wbGV0ZWAgY2FsbGJhY2sgZXJyb3IAYG9uX2NodW5rX2V4dGVuc2lvbl9uYW1lYCBjYWxsYmFjayBlcnJvcgBVbmV4cGVjdGVkIGNoYXIgaW4gdXJsIHNlcnZlcgBJbnZhbGlkIGhlYWRlciB2YWx1ZSBjaGFyAEludmFsaWQgaGVhZGVyIGZpZWxkIGNoYXIAU3BhbiBjYWxsYmFjayBlcnJvciBpbiBvbl92ZXJzaW9uAEludmFsaWQgbWlub3IgdmVyc2lvbgBJbnZhbGlkIG1ham9yIHZlcnNpb24ARXhwZWN0ZWQgc3BhY2UgYWZ0ZXIgdmVyc2lvbgBFeHBlY3RlZCBDUkxGIGFmdGVyIHZlcnNpb24ASW52YWxpZCBIVFRQIHZlcnNpb24ASW52YWxpZCBoZWFkZXIgdG9rZW4AU3BhbiBjYWxsYmFjayBlcnJvciBpbiBvbl91cmwASW52YWxpZCBjaGFyYWN0ZXJzIGluIHVybABVbmV4cGVjdGVkIHN0YXJ0IGNoYXIgaW4gdXJsAERvdWJsZSBAIGluIHVybABFbXB0eSBDb250ZW50LUxlbmd0aABJbnZhbGlkIGNoYXJhY3RlciBpbiBDb250ZW50LUxlbmd0aABEdXBsaWNhdGUgQ29udGVudC1MZW5ndGgASW52YWxpZCBjaGFyIGluIHVybCBwYXRoAENvbnRlbnQtTGVuZ3RoIGNhbid0IGJlIHByZXNlbnQgd2l0aCBUcmFuc2Zlci1FbmNvZGluZwBJbnZhbGlkIGNoYXJhY3RlciBpbiBjaHVuayBzaXplAFNwYW4gY2FsbGJhY2sgZXJyb3IgaW4gb25faGVhZGVyX3ZhbHVlAFNwYW4gY2FsbGJhY2sgZXJyb3IgaW4gb25fY2h1bmtfZXh0ZW5zaW9uX3ZhbHVlAEludmFsaWQgY2hhcmFjdGVyIGluIGNodW5rIGV4dGVuc2lvbnMgdmFsdWUATWlzc2luZyBleHBlY3RlZCBMRiBhZnRlciBoZWFkZXIgdmFsdWUASW52YWxpZCBgVHJhbnNmZXItRW5jb2RpbmdgIGhlYWRlciB2YWx1ZQBJbnZhbGlkIGNoYXJhY3RlciBpbiBjaHVuayBleHRlbnNpb25zIHF1b3RlIHZhbHVlAEludmFsaWQgY2hhcmFjdGVyIGluIGNodW5rIGV4dGVuc2lvbnMgcXVvdGVkIHZhbHVlAFBhdXNlZCBieSBvbl9oZWFkZXJzX2NvbXBsZXRlAEludmFsaWQgRU9GIHN0YXRlAG9uX3Jlc2V0IHBhdXNlAG9uX2NodW5rX2hlYWRlciBwYXVzZQBvbl9tZXNzYWdlX2JlZ2luIHBhdXNlAG9uX2NodW5rX2V4dGVuc2lvbl92YWx1ZSBwYXVzZQBvbl9zdGF0dXNfY29tcGxldGUgcGF1c2UAb25fdmVyc2lvbl9jb21wbGV0ZSBwYXVzZQBvbl91cmxfY29tcGxldGUgcGF1c2UAb25fY2h1bmtfY29tcGxldGUgcGF1c2UAb25faGVhZGVyX3ZhbHVlX2NvbXBsZXRlIHBhdXNlAG9uX21lc3NhZ2VfY29tcGxldGUgcGF1c2UAb25fbWV0aG9kX2NvbXBsZXRlIHBhdXNlAG9uX2hlYWRlcl9maWVsZF9jb21wbGV0ZSBwYXVzZQBvbl9jaHVua19leHRlbnNpb25fbmFtZSBwYXVzZQBVbmV4cGVjdGVkIHNwYWNlIGFmdGVyIHN0YXJ0IGxpbmUAU3BhbiBjYWxsYmFjayBlcnJvciBpbiBvbl9jaHVua19leHRlbnNpb25fbmFtZQBJbnZhbGlkIGNoYXJhY3RlciBpbiBjaHVuayBleHRlbnNpb25zIG5hbWUAUGF1c2Ugb24gQ09OTkVDVC9VcGdyYWRlAFBhdXNlIG9uIFBSSS9VcGdyYWRlAEV4cGVjdGVkIEhUVFAvMiBDb25uZWN0aW9uIFByZWZhY2UAU3BhbiBjYWxsYmFjayBlcnJvciBpbiBvbl9tZXRob2QARXhwZWN0ZWQgc3BhY2UgYWZ0ZXIgbWV0aG9kAFNwYW4gY2FsbGJhY2sgZXJyb3IgaW4gb25faGVhZGVyX2ZpZWxkAFBhdXNlZABJbnZhbGlkIHdvcmQgZW5jb3VudGVyZWQASW52YWxpZCBtZXRob2QgZW5jb3VudGVyZWQAVW5leHBlY3RlZCBjaGFyIGluIHVybCBzY2hlbWEAUmVxdWVzdCBoYXMgaW52YWxpZCBgVHJhbnNmZXItRW5jb2RpbmdgAFNXSVRDSF9QUk9YWQBVU0VfUFJPWFkATUtBQ1RJVklUWQBVTlBST0NFU1NBQkxFX0VOVElUWQBDT1BZAE1PVkVEX1BFUk1BTkVOVExZAFRPT19FQVJMWQBOT1RJRlkARkFJTEVEX0RFUEVOREVOQ1kAQkFEX0dBVEVXQVkAUExBWQBQVVQAQ0hFQ0tPVVQAR0FURVdBWV9USU1FT1VUAFJFUVVFU1RfVElNRU9VVABORVRXT1JLX0NPTk5FQ1RfVElNRU9VVABDT05ORUNUSU9OX1RJTUVPVVQATE9HSU5fVElNRU9VVABORVRXT1JLX1JFQURfVElNRU9VVABQT1NUAE1JU0RJUkVDVEVEX1JFUVVFU1QAQ0xJRU5UX0NMT1NFRF9SRVFVRVNUAENMSUVOVF9DTE9TRURfTE9BRF9CQUxBTkNFRF9SRVFVRVNUAEJBRF9SRVFVRVNUAEhUVFBfUkVRVUVTVF9TRU5UX1RPX0hUVFBTX1BPUlQAUkVQT1JUAElNX0FfVEVBUE9UAFJFU0VUX0NPTlRFTlQATk9fQ09OVEVOVABQQVJUSUFMX0NPTlRFTlQASFBFX0lOVkFMSURfQ09OU1RBTlQASFBFX0NCX1JFU0VUAEdFVABIUEVfU1RSSUNUAENPTkZMSUNUAFRFTVBPUkFSWV9SRURJUkVDVABQRVJNQU5FTlRfUkVESVJFQ1QAQ09OTkVDVABNVUxUSV9TVEFUVVMASFBFX0lOVkFMSURfU1RBVFVTAFRPT19NQU5ZX1JFUVVFU1RTAEVBUkxZX0hJTlRTAFVOQVZBSUxBQkxFX0ZPUl9MRUdBTF9SRUFTT05TAE9QVElPTlMAU1dJVENISU5HX1BST1RPQ09MUwBWQVJJQU5UX0FMU09fTkVHT1RJQVRFUwBNVUxUSVBMRV9DSE9JQ0VTAElOVEVSTkFMX1NFUlZFUl9FUlJPUgBXRUJfU0VSVkVSX1VOS05PV05fRVJST1IAUkFJTEdVTl9FUlJPUgBJREVOVElUWV9QUk9WSURFUl9BVVRIRU5USUNBVElPTl9FUlJPUgBTU0xfQ0VSVElGSUNBVEVfRVJST1IASU5WQUxJRF9YX0ZPUldBUkRFRF9GT1IAU0VUX1BBUkFNRVRFUgBHRVRfUEFSQU1FVEVSAEhQRV9VU0VSAFNFRV9PVEhFUgBIUEVfQ0JfQ0hVTktfSEVBREVSAE1LQ0FMRU5EQVIAU0VUVVAAV0VCX1NFUlZFUl9JU19ET1dOAFRFQVJET1dOAEhQRV9DTE9TRURfQ09OTkVDVElPTgBIRVVSSVNUSUNfRVhQSVJBVElPTgBESVNDT05ORUNURURfT1BFUkFUSU9OAE5PTl9BVVRIT1JJVEFUSVZFX0lORk9STUFUSU9OAEhQRV9JTlZBTElEX1ZFUlNJT04ASFBFX0NCX01FU1NBR0VfQkVHSU4AU0lURV9JU19GUk9aRU4ASFBFX0lOVkFMSURfSEVBREVSX1RPS0VOAElOVkFMSURfVE9LRU4ARk9SQklEREVOAEVOSEFOQ0VfWU9VUl9DQUxNAEhQRV9JTlZBTElEX1VSTABCTE9DS0VEX0JZX1BBUkVOVEFMX0NPTlRST0wATUtDT0wAQUNMAEhQRV9JTlRFUk5BTABSRVFVRVNUX0hFQURFUl9GSUVMRFNfVE9PX0xBUkdFX1VOT0ZGSUNJQUwASFBFX09LAFVOTElOSwBVTkxPQ0sAUFJJAFJFVFJZX1dJVEgASFBFX0lOVkFMSURfQ09OVEVOVF9MRU5HVEgASFBFX1VORVhQRUNURURfQ09OVEVOVF9MRU5HVEgARkxVU0gAUFJPUFBBVENIAE0tU0VBUkNIAFVSSV9UT09fTE9ORwBQUk9DRVNTSU5HAE1JU0NFTExBTkVPVVNfUEVSU0lTVEVOVF9XQVJOSU5HAE1JU0NFTExBTkVPVVNfV0FSTklORwBIUEVfSU5WQUxJRF9UUkFOU0ZFUl9FTkNPRElORwBFeHBlY3RlZCBDUkxGAEhQRV9JTlZBTElEX0NIVU5LX1NJWkUATU9WRQBDT05USU5VRQBIUEVfQ0JfU1RBVFVTX0NPTVBMRVRFAEhQRV9DQl9IRUFERVJTX0NPTVBMRVRFAEhQRV9DQl9WRVJTSU9OX0NPTVBMRVRFAEhQRV9DQl9VUkxfQ09NUExFVEUASFBFX0NCX0NIVU5LX0NPTVBMRVRFAEhQRV9DQl9IRUFERVJfVkFMVUVfQ09NUExFVEUASFBFX0NCX0NIVU5LX0VYVEVOU0lPTl9WQUxVRV9DT01QTEVURQBIUEVfQ0JfQ0hVTktfRVhURU5TSU9OX05BTUVfQ09NUExFVEUASFBFX0NCX01FU1NBR0VfQ09NUExFVEUASFBFX0NCX01FVEhPRF9DT01QTEVURQBIUEVfQ0JfSEVBREVSX0ZJRUxEX0NPTVBMRVRFAERFTEVURQBIUEVfSU5WQUxJRF9FT0ZfU1RBVEUASU5WQUxJRF9TU0xfQ0VSVElGSUNBVEUAUEFVU0UATk9fUkVTUE9OU0UAVU5TVVBQT1JURURfTUVESUFfVFlQRQBHT05FAE5PVF9BQ0NFUFRBQkxFAFNFUlZJQ0VfVU5BVkFJTEFCTEUAUkFOR0VfTk9UX1NBVElTRklBQkxFAE9SSUdJTl9JU19VTlJFQUNIQUJMRQBSRVNQT05TRV9JU19TVEFMRQBQVVJHRQBNRVJHRQBSRVFVRVNUX0hFQURFUl9GSUVMRFNfVE9PX0xBUkdFAFJFUVVFU1RfSEVBREVSX1RPT19MQVJHRQBQQVlMT0FEX1RPT19MQVJHRQBJTlNVRkZJQ0lFTlRfU1RPUkFHRQBIUEVfUEFVU0VEX1VQR1JBREUASFBFX1BBVVNFRF9IMl9VUEdSQURFAFNPVVJDRQBBTk5PVU5DRQBUUkFDRQBIUEVfVU5FWFBFQ1RFRF9TUEFDRQBERVNDUklCRQBVTlNVQlNDUklCRQBSRUNPUkQASFBFX0lOVkFMSURfTUVUSE9EAE5PVF9GT1VORABQUk9QRklORABVTkJJTkQAUkVCSU5EAFVOQVVUSE9SSVpFRABNRVRIT0RfTk9UX0FMTE9XRUQASFRUUF9WRVJTSU9OX05PVF9TVVBQT1JURUQAQUxSRUFEWV9SRVBPUlRFRABBQ0NFUFRFRABOT1RfSU1QTEVNRU5URUQATE9PUF9ERVRFQ1RFRABIUEVfQ1JfRVhQRUNURUQASFBFX0xGX0VYUEVDVEVEAENSRUFURUQASU1fVVNFRABIUEVfUEFVU0VEAFRJTUVPVVRfT0NDVVJFRABQQVlNRU5UX1JFUVVJUkVEAFBSRUNPTkRJVElPTl9SRVFVSVJFRABQUk9YWV9BVVRIRU5USUNBVElPTl9SRVFVSVJFRABORVRXT1JLX0FVVEhFTlRJQ0FUSU9OX1JFUVVJUkVEAExFTkdUSF9SRVFVSVJFRABTU0xfQ0VSVElGSUNBVEVfUkVRVUlSRUQAVVBHUkFERV9SRVFVSVJFRABQQUdFX0VYUElSRUQAUFJFQ09ORElUSU9OX0ZBSUxFRABFWFBFQ1RBVElPTl9GQUlMRUQAUkVWQUxJREFUSU9OX0ZBSUxFRABTU0xfSEFORFNIQUtFX0ZBSUxFRABMT0NLRUQAVFJBTlNGT1JNQVRJT05fQVBQTElFRABOT1RfTU9ESUZJRUQATk9UX0VYVEVOREVEAEJBTkRXSURUSF9MSU1JVF9FWENFRURFRABTSVRFX0lTX09WRVJMT0FERUQASEVBRABFeHBlY3RlZCBIVFRQLwAAXhMAACYTAAAwEAAA8BcAAJ0TAAAVEgAAORcAAPASAAAKEAAAdRIAAK0SAACCEwAATxQAAH8QAACgFQAAIxQAAIkSAACLFAAATRUAANQRAADPFAAAEBgAAMkWAADcFgAAwREAAOAXAAC7FAAAdBQAAHwVAADlFAAACBcAAB8QAABlFQAAoxQAACgVAAACFQAAmRUAACwQAACLGQAATw8AANQOAABqEAAAzhAAAAIXAACJDgAAbhMAABwTAABmFAAAVhcAAMETAADNEwAAbBMAAGgXAABmFwAAXxcAACITAADODwAAaQ4AANgOAABjFgAAyxMAAKoOAAAoFwAAJhcAAMUTAABdFgAA6BEAAGcTAABlEwAA8hYAAHMTAAAdFwAA+RYAAPMRAADPDgAAzhUAAAwSAACzEQAApREAAGEQAAAyFwAAuxMAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQIBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAIDAgICAgIAAAICAAICAAICAgICAgICAgIABAAAAAAAAgICAgICAgICAgICAgICAgICAgICAgICAgIAAAACAgICAgICAgICAgICAgICAgICAgICAgICAgICAgACAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAACAAICAgICAAACAgACAgACAgICAgICAgICAAMABAAAAAICAgICAgICAgICAgICAgICAgICAgICAgICAAAAAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAAgACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbG9zZWVlcC1hbGl2ZQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEBAQEBAQEBAQIBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBY2h1bmtlZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAQEBAQEAAAEBAAEBAAEBAQEBAQEBAQEAAAAAAAAAAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQABAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABlY3Rpb25lbnQtbGVuZ3Rob25yb3h5LWNvbm5lY3Rpb24AAAAAAAAAAAAAAAAAAAByYW5zZmVyLWVuY29kaW5ncGdyYWRlDQoNCg0KU00NCg0KVFRQL0NFL1RTUC8AAAAAAAAAAAAAAAABAgABAwAAAAAAAAAAAAAAAAAAAAAAAAQBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAAAAAAAAAAAQIAAQMAAAAAAAAAAAAAAAAAAAAAAAAEAQEFAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAAAAAAAAEAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAAAAAAAAAAAQAAAgAAAAAAAAAAAAAAAAAAAAAAAAMEAAAEBAQEBAQEBAQEBAUEBAQEBAQEBAQEBAQABAAGBwQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAEAAQABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAEAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAADAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwAAAAAAAAMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAABAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAIAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMAAAAAAAADAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABOT1VOQ0VFQ0tPVVRORUNURVRFQ1JJQkVMVVNIRVRFQURTRUFSQ0hSR0VDVElWSVRZTEVOREFSVkVPVElGWVBUSU9OU0NIU0VBWVNUQVRDSEdFT1JESVJFQ1RPUlRSQ0hQQVJBTUVURVJVUkNFQlNDUklCRUFSRE9XTkFDRUlORE5LQ0tVQlNDUklCRUhUVFAvQURUUC8='\n","module.exports = 'AGFzbQEAAAABMAhgAX8Bf2ADf39/AX9gBH9/f38Bf2AAAGADf39/AGABfwBgAn9/AGAGf39/f39/AALLAQgDZW52GHdhc21fb25faGVhZGVyc19jb21wbGV0ZQACA2VudhV3YXNtX29uX21lc3NhZ2VfYmVnaW4AAANlbnYLd2FzbV9vbl91cmwAAQNlbnYOd2FzbV9vbl9zdGF0dXMAAQNlbnYUd2FzbV9vbl9oZWFkZXJfZmllbGQAAQNlbnYUd2FzbV9vbl9oZWFkZXJfdmFsdWUAAQNlbnYMd2FzbV9vbl9ib2R5AAEDZW52GHdhc21fb25fbWVzc2FnZV9jb21wbGV0ZQAAA0ZFAwMEAAAFAAAAAAAABQEFAAUFBQAABgAAAAAGBgYGAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQABAAABAQcAAAUFAwABBAUBcAESEgUDAQACBggBfwFBgNQECwfRBSIGbWVtb3J5AgALX2luaXRpYWxpemUACRlfX2luZGlyZWN0X2Z1bmN0aW9uX3RhYmxlAQALbGxodHRwX2luaXQAChhsbGh0dHBfc2hvdWxkX2tlZXBfYWxpdmUAQQxsbGh0dHBfYWxsb2MADAZtYWxsb2MARgtsbGh0dHBfZnJlZQANBGZyZWUASA9sbGh0dHBfZ2V0X3R5cGUADhVsbGh0dHBfZ2V0X2h0dHBfbWFqb3IADxVsbGh0dHBfZ2V0X2h0dHBfbWlub3IAEBFsbGh0dHBfZ2V0X21ldGhvZAARFmxsaHR0cF9nZXRfc3RhdHVzX2NvZGUAEhJsbGh0dHBfZ2V0X3VwZ3JhZGUAEwxsbGh0dHBfcmVzZXQAFA5sbGh0dHBfZXhlY3V0ZQAVFGxsaHR0cF9zZXR0aW5nc19pbml0ABYNbGxodHRwX2ZpbmlzaAAXDGxsaHR0cF9wYXVzZQAYDWxsaHR0cF9yZXN1bWUAGRtsbGh0dHBfcmVzdW1lX2FmdGVyX3VwZ3JhZGUAGhBsbGh0dHBfZ2V0X2Vycm5vABsXbGxodHRwX2dldF9lcnJvcl9yZWFzb24AHBdsbGh0dHBfc2V0X2Vycm9yX3JlYXNvbgAdFGxsaHR0cF9nZXRfZXJyb3JfcG9zAB4RbGxodHRwX2Vycm5vX25hbWUAHxJsbGh0dHBfbWV0aG9kX25hbWUAIBJs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IAH9CwMAIABBMGogAf0LAwAgAEEgaiAB/QsDACAAQd0BNgIcQQALewEBfwJAIAAoAgwiAw0AAkAgACgCBEUNACAAIAE2AgQLAkAgACABIAIQxICAgAAiAw0AIAAoAgwPCyAAIAM2AhxBACEDIAAoAgQiAUUNACAAIAEgAiAAKAIIEYGAgIAAACIBRQ0AIAAgAjYCFCAAIAE2AgwgASEDCyADC+TzAQMOfwN+BH8jgICAgABBEGsiAySAgICAACABIQQgASEFIAEhBiABIQcgASEIIAEhCSABIQogASELIAEhDCABIQ0gASEOIAEhDwJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQCAAKAIcIhBBf2oO3QHaAQHZAQIDBAUGBwgJCgsMDQ7YAQ8Q1wEREtYBExQVFhcYGRob4AHfARwdHtUBHyAhIiMkJdQBJicoKSorLNMB0gEtLtEB0AEvMDEyMzQ1Njc4OTo7PD0+P0BBQkNERUbbAUdISUrPAc4BS80BTMwBTU5PUFFSU1RVVldYWVpbXF1eX2BhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ent8fX5/gAGBAYIBgwGEAYUBhgGHAYgBiQGKAYsBjAGNAY4BjwGQAZEB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QAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAIBAOxwEAAQIDBAUGBwgJCgsMDQ4PEBESExQVFhcYGRobHB4fICEjJSg/QEFERUZHSElKS0xNT1BRUlPeA1dZW1xdYGJlZmdoaWprbG1vcHFyc3R1dnd4eXp7fH1+gAGCAYUBhgGHAYkBiwGMAY0BjgGPAZABkQGUAZUBlgGXAZgBmQGaAZsBnAGdAZ4BnwGgAaEBogGjAaQBpQGmAacBqAGpAaoBqwGsAa0BrgGvAbABsQGyAbMBtAG1AbYBtwG4AbkBugG7AbwBvQG+Ab8BwAHBAcIBwwHEAcUBxgHHAcgByQHKAcsBzAHNAc4BzwHQAdEB0gHTAdQB1QHWAdcB2AHZAdoB2wHcAd0B3gHgAeEB4gHjAeQB5QHmAecB6AHpAeoB6wHsAe0B7gHvAfAB8QHyAfMBmQKkArAC/gL+AgsgASIEIAJHDfMBQd0BIRAM/wMLIAEiECACRw3dAUHDASEQDP4DCyABIgEgAkcNkAFB9wAhEAz9AwsgASIBIAJHDYYBQe8AIRAM/AMLIAEiASACRw1/QeoAIRAM+wMLIAEiASACRw17QegAIRAM+gMLIAEiASACRw14QeYAIRAM+QMLIAEiASACRw0aQRghEAz4AwsgASIBIAJHDRRBEiEQDPcDCyABIgEgAkcNWUHFACEQDPYDCyABIgEgAkcNSkE/IRAM9QMLIAEiASACRw1IQTwhEAz0AwsgASIBIAJHDUFBMSEQDPMDCyAALQAuQQFGDesDDIcCCyAAIAEiASACEMCAgIAAQQFHDeYBIABCADcDIAznAQsgACABIgEgAhC0gICAACIQDecBIAEhAQz1AgsCQCABIgEgAkcNAEEGIRAM8AMLIAAgAUEBaiIBIAIQu4CAgAAiEA3oASABIQEMMQsgAEIANwMgQRIhEAzVAwsgASIQIAJHDStBHSEQDO0DCwJAIAEiASACRg0AIAFBAWohAUEQIRAM1AMLQQchEAzsAwsgAEIAIAApAyAiESACIAEiEGutIhJ9IhMgEyARVhs3AyAgESASViIURQ3lAUEIIRAM6wMLAkAgASIBIAJGDQAgAEGJgICAADYCCCAAIAE2AgQgASEBQRQhEAzSAwtBCSEQDOoDCyABIQEgACkDIFAN5AEgASEBDPICCwJAIAEiASACRw0AQQshEAzpAwsgACABQQFqIgEgAhC2gICAACIQDeUBIAEhAQzyAgsgACABIgEgAhC4gICAACIQDeUBIAEhAQzyAgsgACABIgEgAhC4gICAACIQDeYBIAEhAQwNCyAAIAEiASACELqAgIAAIhAN5wEgASEBDPACCwJAIAEiASACRw0AQQ8hEAzlAwsgAS0AACIQQTtGDQggEEENRw3oASABQQFqIQEM7wILIAAgASIBIAIQuoCAgAAiEA3oASABIQEM8gILA0ACQCABLQAAQfC1gIAAai0AACIQQQFGDQAgEEECRw3rASAAKAIEIRAgAEEANgIEIAAgECABQQFqIgEQuYCAgAAiEA3qASABIQEM9AILIAFBAWoiASACRw0AC0ESIRAM4gMLIAAgASIBIAIQuoCAgAAiEA3pASABIQEMCgsgASIBIAJHDQZBGyEQDOADCwJAIAEiASACRw0AQRYhEAzgAwsgAEGKgICAADYCCCAAIAE2AgQgACABIAIQuICAgAAiEA3qASABIQFBICEQDMYDCwJAIAEiASACRg0AA0ACQCABLQAAQfC3gIAAai0AACIQQQJGDQACQCAQQX9qDgTlAewBAOsB7AELIAFBAWohAUEIIRAMyAMLIAFBAWoiASACRw0AC0EVIRAM3wMLQRUhEAzeAwsDQAJAIAEtAABB8LmAgABqLQAAIhBBAkYNACAQQX9qDgTeAewB4AHrAewBCyABQQFqIgEgAkcNAAtBGCEQDN0DCwJAIAEiASACRg0AIABBi4CAgAA2AgggACABNgIEIAEhAUEHIRAMxAMLQRkhEAzcAwsgAUEBaiEBDAILAkAgASIUIAJHDQBBGiEQDNsDCyAUIQECQCAULQAAQXNqDhTdAu4C7gLuAu4C7gLuAu4C7gLuAu4C7gLuAu4C7gLuAu4C7gLuAgDuAgtBACEQIABBADYCHCAAQa+LgIAANgIQIABBAjYCDCAAIBRBAWo2AhQM2gMLAkAgAS0AACIQQTtGDQAgEEENRw3oASABQQFqIQEM5QILIAFBAWohAQtBIiEQDL8DCwJAIAEiECACRw0AQRwhEAzYAwtCACERIBAhASAQLQAAQVBqDjfnAeYBAQIDBAUGBwgAAAAAAAAACQoLDA0OAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPEBESExQAC0EeIRAMvQMLQgIhEQzlAQtCAyERDOQBC0IEIREM4wELQgUhEQziAQtCBiERDOEBC0IHIREM4AELQgghEQzfAQtCCSERDN4BC0IKIREM3QELQgshEQzcAQtCDCERDNsBC0INIREM2gELQg4hEQzZAQtCDyERDNgBC0IKIREM1wELQgshEQzWAQtCDCERDNUBC0INIREM1AELQg4hEQzTAQtCDyERDNIBC0IAIRECQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAIBAtAABBUGoON+UB5AEAAQIDBAUGB+YB5gHmAeYB5gHmAeYBCAkKCwwN5gHmAeYB5gHmAeYB5gHmAeYB5gHmAeYB5gHmAeYB5gHmAeYB5gHmAeYB5gHmAeYB5gHmAQ4PEBESE+YBC0ICIREM5AELQgMhEQzjAQtCBCERDOIBC0IFIREM4QELQgYhEQzgAQtCByERDN8BC0IIIREM3gELQgkhEQzdAQtCCiERDNwBC0ILIREM2wELQgwhEQzaAQtCDSERDNkBC0IOIREM2AELQg8hEQzXAQtCCiERDNYBC0ILIREM1QELQgwhEQzUAQtCDSERDNMBC0IOIREM0gELQg8hEQzRAQsgAEIAIAApAyAiESACIAEiEGutIhJ9IhMgEyARVhs3AyAgESASViIURQ3SAUEfIRAMwAMLAkAgASIBIAJGDQAgAEGJgICAADYCCCAAIAE2AgQgASEBQSQhEAynAwtBICEQDL8DCyAAIAEiECACEL6AgIAAQX9qDgW2AQDFAgHRAdIBC0ERIRAMpAMLIABBAToALyAQIQEMuwMLIAEiASACRw3SAUEkIRAMuwMLIAEiDSACRw0eQcYAIRAMugMLIAAgASIBIAIQsoCAgAAiEA3UASABIQEMtQELIAEiECACRw0mQdAAIRAMuAMLAkAgASIBIAJHDQBBKCEQDLgDCyAAQQA2AgQgAEGMgICAADYCCCAAIAEgARCxgICAACIQDdMBIAEhAQzYAQsCQCABIhAgAkcNAEEpIRAMtwMLIBAtAAAiAUEgRg0UIAFBCUcN0wEgEEEBaiEBDBULAkAgASIBIAJGDQAgAUEBaiEBDBcLQSohEAy1AwsCQCABIhAgAkcNAEErIRAMtQMLAkAgEC0AACIBQQlGDQAgAUEgRw3VAQsgAC0ALEEIRg3TASAQIQEMkQMLAkAgASIBIAJHDQBBLCEQDLQDCyABLQAAQQpHDdUBIAFBAWohAQzJAgsgASIOIAJHDdUBQS8hEAyyAwsDQAJAIAEtAAAiEEEgRg0AAkAgEEF2ag4EANwB3AEA2gELIAEhAQzgAQsgAUEBaiIBIAJHDQALQTEhEAyxAwtBMiEQIAEiFCACRg2wAyACIBRrIAAoAgAiAWohFSAUIAFrQQNqIRYCQANAIBQtAAAiF0EgciAXIBdBv39qQf8BcUEaSRtB/wFxIAFB8LuAgABqLQAARw0BAkAgAUEDRw0AQQYhAQyWAwsgAUEBaiEBIBRBAWoiFCACRw0ACyAAIBU2AgAMsQMLIABBADYCACAUIQEM2QELQTMhECABIhQgAkYNrwMgAiAUayAAKAIAIgFqIRUgFCABa0EIaiEWAkADQCAULQAAIhdBIHIgFyAXQb9/akH/AXFBGkkbQf8BcSABQfS7gIAAai0AAEcNAQJAIAFBCEcNAEEFIQEMlQMLIAFBAWohASAUQQFqIhQgAkcNAAsgACAVNgIADLADCyAAQQA2AgAgFCEBDNgBC0E0IRAgASIUIAJGDa4DIAIgFGsgACgCACIBaiEVIBQgAWtBBWohFgJAA0AgFC0AACIXQSByIBcgF0G/f2pB/wFxQRpJG0H/AXEgAUHQwoCAAGotAABHDQECQCABQQVHDQBBByEBDJQDCyABQQFqIQEgFEEBaiIUIAJHDQALIAAgFTYCAAyvAwsgAEEANgIAIBQhAQzXAQsCQCABIgEgAkYNAANAAkAgAS0AAEGAvoCAAGotAAAiEEEBRg0AIBBBAkYNCiABIQEM3QELIAFBAWoiASACRw0AC0EwIRAMrgMLQTAhEAytAwsCQCABIgEgAkYNAANAAkAgAS0AACIQQSBGDQAgEEF2ag4E2QHaAdoB2QHaAQsgAUEBaiIBIAJHDQALQTghEAytAwtBOCEQDKwDCwNAAkAgAS0AACIQQSBGDQAgEEEJRw0DCyABQQFqIgEgAkcNAAtBPCEQDKsDCwNAAkAgAS0AACIQQSBGDQACQAJAIBBBdmoOBNoBAQHaAQALIBBBLEYN2wELIAEhAQwECyABQQFqIgEgAkcNAAtBPyEQDKoDCyABIQEM2wELQcAAIRAgASIUIAJGDagDIAIgFGsgACgCACIBaiEWIBQgAWtBBmohFwJAA0AgFC0AAEEgciABQYDAgIAAai0AAEcNASABQQZGDY4DIAFBAWohASAUQQFqIhQgAkcNAAsgACAWNgIADKkDCyAAQQA2AgAgFCEBC0E2IRAMjgMLAkAgASIPIAJHDQBBwQAhEAynAwsgAEGMgICAADYCCCAAIA82AgQgDyEBIAAtACxBf2oOBM0B1QHXAdkBhwMLIAFBAWohAQzMAQsCQCABIgEgAkYNAANAAkAgAS0AACIQQSByIBAgEEG/f2pB/wFxQRpJG0H/AXEiEEEJRg0AIBBBIEYNAAJAAkACQAJAIBBBnX9qDhMAAwMDAwMDAwEDAwMDAwMDAwMCAwsgAUEBaiEBQTEhEAyRAwsgAUEBaiEBQTIhEAyQAwsgAUEBaiEBQTMhEAyPAwsgASEBDNABCyABQQFqIgEgAkcNAAtBNSEQDKUDC0E1IRAMpAMLAkAgASIBIAJGDQADQAJAIAEtAABBgLyAgABqLQAAQQFGDQAgASEBDNMBCyABQQFqIgEgAkcNAAtBPSEQDKQDC0E9IRAMowMLIAAgASIBIAIQsICAgAAiEA3WASABIQEMAQsgEEEBaiEBC0E8IRAMhwMLAkAgASIBIAJHDQBBwgAhEAygAwsCQANAAkAgAS0AAEF3ag4YAAL+Av4ChAP+Av4C/gL+Av4C/gL+Av4C/gL+Av4C/gL+Av4C/gL+Av4C/gIA/gILIAFBAWoiASACRw0AC0HCACEQDKADCyABQQFqIQEgAC0ALUEBcUUNvQEgASEBC0EsIRAMhQMLIAEiASACRw3TAUHEACEQDJ0DCwNAAkAgAS0AAEGQwICAAGotAABBAUYNACABIQEMtwILIAFBAWoiASACRw0AC0HFACEQDJwDCyANLQAAIhBBIEYNswEgEEE6Rw2BAyAAKAIEIQEgAEEANgIEIAAgASANEK+AgIAAIgEN0AEgDUEBaiEBDLMCC0HHACEQIAEiDSACRg2aAyACIA1rIAAoAgAiAWohFiANIAFrQQVqIRcDQCANLQAAIhRBIHIgFCAUQb9/akH/AXFBGkkbQf8BcSABQZDCgIAAai0AAEcNgAMgAUEFRg30AiABQQFqIQEgDUEBaiINIAJHDQALIAAgFjYCAAyaAwtByAAhECABIg0gAkYNmQMgAiANayAAKAIAIgFqIRYgDSABa0EJaiEXA0AgDS0AACIUQSByIBQgFEG/f2pB/wFxQRpJG0H/AXEgAUGWwoCAAGotAABHDf8CAkAgAUEJRw0AQQIhAQz1AgsgAUEBaiEBIA1BAWoiDSACRw0ACyAAIBY2AgAMmQMLAkAgASINIAJHDQBByQAhEAyZAwsCQAJAIA0tAAAiAUEgciABIAFBv39qQf8BcUEaSRtB/wFxQZJ/ag4HAIADgAOAA4ADgAMBgAMLIA1BAWohAUE+IRAMgAMLIA1BAWohAUE/IRAM/wILQcoAIRAgASINIAJGDZcDIAIgDWsgACgCACIBaiEWIA0gAWtBAWohFwNAIA0tAAAiFEEgciAUIBRBv39qQf8BcUEaSRtB/wFxIAFBoMKAgABqLQAARw39AiABQQFGDfACIAFBAWohASANQQFqIg0gAkcNAAsgACAWNgIADJcDC0HLACEQIAEiDSACRg2WAyACIA1rIAAoAgAiAWohFiANIAFrQQ5qIRcDQCANLQAAIhRBIHIgFCAUQb9/akH/AXFBGkkbQf8BcSABQaLCgIAAai0AAEcN/AIgAUEORg3wAiABQQFqIQEgDUEBaiINIAJHDQALIAAgFjYCAAyWAwtBzAAhECABIg0gAkYNlQMgAiANayAAKAIAIgFqIRYgDSABa0EPaiEXA0AgDS0AACIUQSByIBQgFEG/f2pB/wFxQRpJG0H/AXEgAUHAwoCAAGotAABHDfsCAkAgAUEPRw0AQQMhAQzxAgsgAUEBaiEBIA1BAWoiDSACRw0ACyAAIBY2AgAMlQMLQc0AIRAgASINIAJGDZQDIAIgDWsgACgCACIBaiEWIA0gAWtBBWohFwNAIA0tAAAiFEEgciAUIBRBv39qQf8BcUEaSRtB/wFxIAFB0MKAgABqLQAARw36AgJAIAFBBUcNAEEEIQEM8AILIAFBAWohASANQQFqIg0gAkcNAAsgACAWNgIADJQDCwJAIAEiDSACRw0AQc4AIRAMlAMLAkACQAJAAkAgDS0AACIBQSByIAEgAUG/f2pB/wFxQRpJG0H/AXFBnX9qDhMA/QL9Av0C/QL9Av0C/QL9Av0C/QL9Av0CAf0C/QL9AgID/QILIA1BAWohAUHBACEQDP0CCyANQQFqIQFBwgAhEAz8AgsgDUEBaiEBQcMAIRAM+wILIA1BAWohAUHEACEQDPoCCwJAIAEiASACRg0AIABBjYCAgAA2AgggACABNgIEIAEhAUHFACEQDPoCC0HPACEQDJIDCyAQIQECQAJAIBAtAABBdmoOBAGoAqgCAKgCCyAQQQFqIQELQSchEAz4AgsCQCABIgEgAkcNAEHRACEQDJEDCwJAIAEtAABBIEYNACABIQEMjQELIAFBAWohASAALQAtQQFxRQ3HASABIQEMjAELIAEiFyACRw3IAUHSACEQDI8DC0HTACEQIAEiFCACRg2OAyACIBRrIAAoAgAiAWohFiAUIAFrQQFqIRcDQCAULQAAIAFB1sKAgABqLQAARw3MASABQQFGDccBIAFBAWohASAUQQFqIhQgAkcNAAsgACAWNgIADI4DCwJAIAEiASACRw0AQdUAIRAMjgMLIAEtAABBCkcNzAEgAUEBaiEBDMcBCwJAIAEiASACRw0AQdYAIRAMjQMLAkACQCABLQAAQXZqDgQAzQHNAQHNAQsgAUEBaiEBDMcBCyABQQFqIQFBygAhEAzzAgsgACABIgEgAhCugICAACIQDcsBIAEhAUHNACEQDPICCyAALQApQSJGDYUDDKYCCwJAIAEiASACRw0AQdsAIRAMigMLQQAhFEEBIRdBASEWQQAhEAJAAkACQAJAAkACQAJAAkACQCABLQAAQVBqDgrUAdMBAAECAwQFBgjVAQtBAiEQDAYLQQMhEAwFC0EEIRAMBAtBBSEQDAMLQQYhEAwCC0EHIRAMAQtBCCEQC0EAIRdBACEWQQAhFAzMAQtBCSEQQQEhFEEAIRdBACEWDMsBCwJAIAEiASACRw0AQd0AIRAMiQMLIAEtAABBLkcNzAEgAUEBaiEBDKYCCyABIgEgAkcNzAFB3wAhEAyHAwsCQCABIgEgAkYNACAAQY6AgIAANgIIIAAgATYCBCABIQFB0AAhEAzuAgtB4AAhEAyGAwtB4QAhECABIgEgAkYNhQMgAiABayAAKAIAIhRqIRYgASAUa0EDaiEXA0AgAS0AACAUQeLCgIAAai0AAEcNzQEgFEEDRg3MASAUQQFqIRQgAUEBaiIBIAJHDQALIAAgFjYCAAyFAwtB4gAhECABIgEgAkYNhAMgAiABayAAKAIAIhRqIRYgASAUa0ECaiEXA0AgAS0AACAUQebCgIAAai0AAEcNzAEgFEECRg3OASAUQQFqIRQgAUEBaiIBIAJHDQALIAAgFjYCAAyEAwtB4wAhECABIgEgAkYNgwMgAiABayAAKAIAIhRqIRYgASAUa0EDaiEXA0AgAS0AACAUQenCgIAAai0AAEcNywEgFEEDRg3OASAUQQFqIRQgAUEBaiIBIAJHDQALIAAgFjYCAAyDAwsCQCABIgEgAkcNAEHlACEQDIMDCyAAIAFBAWoiASACEKiAgIAAIhANzQEgASEBQdYAIRAM6QILAkAgASIBIAJGDQADQAJAIAEtAAAiEEEgRg0AAkACQAJAIBBBuH9qDgsAAc8BzwHPAc8BzwHPAc8BzwECzwELIAFBAWohAUHSACEQDO0CCyABQQFqIQFB0wAhEAzsAgsgAUEBaiEBQdQAIRAM6wILIAFBAWoiASACRw0AC0HkACEQDIIDC0HkACEQDIEDCwNAAkAgAS0AAEHwwoCAAGotAAAiEEEBRg0AIBBBfmoOA88B0AHRAdIBCyABQQFqIgEgAkcNAAtB5gAhEAyAAwsCQCABIgEgAkYNACABQQFqIQEMAwtB5wAhEAz/AgsDQAJAIAEtAABB8MSAgABqLQAAIhBBAUYNAAJAIBBBfmoOBNIB0wHUAQDVAQsgASEBQdcAIRAM5wILIAFBAWoiASACRw0AC0HoACEQDP4CCwJAIAEiASACRw0AQekAIRAM/gILAkAgAS0AACIQQXZqDhq6AdUB1QG8AdUB1QHVAdUB1QHVAdUB1QHVAdUB1QHVAdUB1QHVAdUB1QHVAcoB1QHVAQDTAQsgAUEBaiEBC0EGIRAM4wILA0ACQCABLQAAQfDGgIAAai0AAEEBRg0AIAEhAQyeAgsgAUEBaiIBIAJHDQALQeoAIRAM+wILAkAgASIBIAJGDQAgAUEBaiEBDAMLQesAIRAM+gILAkAgASIBIAJHDQBB7AAhEAz6AgsgAUEBaiEBDAELAkAgASIBIAJHDQBB7QAhEAz5AgsgAUEBaiEBC0EEIRAM3gILAkAgASIUIAJHDQBB7gAhEAz3AgsgFCEBAkACQAJAIBQtAABB8MiAgABqLQAAQX9qDgfUAdUB1gEAnAIBAtcBCyAUQQFqIQEMCgsgFEEBaiEBDM0BC0EAIRAgAEEANgIcIABBm5KAgAA2AhAgAEEHNgIMIAAgFEEBajYCFAz2AgsCQANAAkAgAS0AAEHwyICAAGotAAAiEEEERg0AAkACQCAQQX9qDgfSAdMB1AHZAQAEAdkBCyABIQFB2gAhEAzgAgsgAUEBaiEBQdwAIRAM3wILIAFBAWoiASACRw0AC0HvACEQDPYCCyABQQFqIQEMywELAkAgASIUIAJHDQBB8AAhEAz1AgsgFC0AAEEvRw3UASAUQQFqIQEMBgsCQCABIhQgAkcNAEHxACEQDPQCCwJAIBQtAAAiAUEvRw0AIBRBAWohAUHdACEQDNsCCyABQXZqIgRBFksN0wFBASAEdEGJgIACcUUN0wEMygILAkAgASIBIAJGDQAgAUEBaiEBQd4AIRAM2gILQfIAIRAM8gILAkAgASIUIAJHDQBB9AAhEAzyAgsgFCEBAkAgFC0AAEHwzICAAGotAABBf2oOA8kClAIA1AELQeEAIRAM2AILAkAgASIUIAJGDQADQAJAIBQtAABB8MqAgABqLQAAIgFBA0YNAAJAIAFBf2oOAssCANUBCyAUIQFB3wAhEAzaAgsgFEEBaiIUIAJHDQALQfMAIRAM8QILQfMAIRAM8AILAkAgASIBIAJGDQAgAEGPgICAADYCCCAAIAE2AgQgASEBQeAAIRAM1wILQfUAIRAM7wILAkAgASIBIAJHDQBB9gAhEAzvAgsgAEGPgICAADYCCCAAIAE2AgQgASEBC0EDIRAM1AILA0AgAS0AAEEgRw3DAiABQQFqIgEgAkcNAAtB9wAhEAzsAgsCQCABIgEgAkcNAEH4ACEQDOwCCyABLQAAQSBHDc4BIAFBAWohAQzvAQsgACABIgEgAhCsgICAACIQDc4BIAEhAQyOAgsCQCABIgQgAkcNAEH6ACEQDOoCCyAELQAAQcwARw3RASAEQQFqIQFBEyEQDM8BCwJAIAEiBCACRw0AQfsAIRAM6QILIAIgBGsgACgCACIBaiEUIAQgAWtBBWohEANAIAQtAAAgAUHwzoCAAGotAABHDdABIAFBBUYNzgEgAUEBaiEBIARBAWoiBCACRw0ACyAAIBQ2AgBB+wAhEAzoAgsCQCABIgQgAkcNAEH8ACEQDOgCCwJAAkAgBC0AAEG9f2oODADRAdEB0QHRAdEB0QHRAdEB0QHRAQHRAQsgBEEBaiEBQeYAIRAMzwILIARBAWohAUHnACEQDM4CCwJAIAEiBCACRw0AQf0AIRAM5wILIAIgBGsgACgCACIBaiEUIAQgAWtBAmohEAJAA0AgBC0AACABQe3PgIAAai0AAEcNzwEgAUECRg0BIAFBAWohASAEQQFqIgQgAkcNAAsgACAUNgIAQf0AIRAM5wILIABBADYCACAQQQFqIQFBECEQDMwBCwJAIAEiBCACRw0AQf4AIRAM5gILIAIgBGsgACgCACIBaiEUIAQgAWtBBWohEAJAA0AgBC0AACABQfbOgIAAai0AAEcNzgEgAUEFRg0BIAFBAWohASAEQQFqIgQgAkcNAAsgACAUNgIAQf4AIRAM5gILIABBADYCACAQQQFqIQFBFiEQDMsBCwJAIAEiBCACRw0AQf8AIRAM5QILIAIgBGsgACgCACIBaiEUIAQgAWtBA2ohEAJAA0AgBC0AACABQfzOgIAAai0AAEcNzQEgAUEDRg0BIAFBAWohASAEQQFqIgQgAkcNAAsgACAUNgIAQf8AIRAM5QILIABBADYCACAQQQFqIQFBBSEQDMoBCwJAIAEiBCACRw0AQYABIRAM5AILIAQtAABB2QBHDcsBIARBAWohAUEIIRAMyQELAkAgASIEIAJHDQBBgQEhEAzjAgsCQAJAIAQtAABBsn9qDgMAzAEBzAELIARBAWohAUHrACEQDMoCCyAEQQFqIQFB7AAhEAzJAgsCQCABIgQgAkcNAEGCASEQDOICCwJAAkAgBC0AAEG4f2oOCADLAcsBywHLAcsBywEBywELIARBAWohAUHqACEQDMkCCyAEQQFqIQFB7QAhEAzIAgsCQCABIgQgAkcNAEGDASEQDOECCyACIARrIAAoAgAiAWohECAEIAFrQQJqIRQCQANAIAQtAAAgAUGAz4CAAGotAABHDckBIAFBAkYNASABQQFqIQEgBEEBaiIEIAJHDQALIAAgEDYCAEGDASEQDOECC0EAIRAgAEEANgIAIBRBAWohAQzGAQsCQCABIgQgAkcNAEGEASEQDOACCyACIARrIAAoAgAiAWohFCAEIAFrQQRqIRACQANAIAQtAAAgAUGDz4CAAGotAABHDcgBIAFBBEYNASABQQFqIQEgBEEBaiIEIAJHDQALIAAgFDYCAEGEASEQDOACCyAAQQA2AgAgEEEBaiEBQSMhEAzFAQsCQCABIgQgAkcNAEGFASEQDN8CCwJAAkAgBC0AAEG0f2oOCADIAcgByAHIAcgByAEByAELIARBAWohAUHvACEQDMYCCyAEQQFqIQFB8AAhEAzFAgsCQCABIgQgAkcNAEGGASEQDN4CCyAELQAAQcUARw3FASAEQQFqIQEMgwILAkAgASIEIAJHDQBBhwEhEAzdAgsgAiAEayAAKAIAIgFqIRQgBCABa0EDaiEQAkADQCAELQAAIAFBiM+AgABqLQAARw3FASABQQNGDQEgAUEBaiEBIARBAWoiBCACRw0ACyAAIBQ2AgBBhwEhEAzdAgsgAEEANgIAIBBBAWohAUEtIRAMwgELAkAgASIEIAJHDQBBiAEhEAzcAgsgAiAEayAAKAIAIgFqIRQgBCABa0EIaiEQAkADQCAELQAAIAFB0M+AgABqLQAARw3EASABQQhGDQEgAUEBaiEBIARBAWoiBCACRw0ACyAAIBQ2AgBBiAEhEAzcAgsgAEEANgIAIBBBAWohAUEpIRAMwQELAkAgASIBIAJHDQBBiQEhEAzbAgtBASEQIAEtAABB3wBHDcABIAFBAWohAQyBAgsCQCABIgQgAkcNAEGKASEQDNoCCyACIARrIAAoAgAiAWohFCAEIAFrQQFqIRADQCAELQAAIAFBjM+AgABqLQAARw3BASABQQFGDa8CIAFBAWohASAEQQFqIgQgAkcNAAsgACAUNgIAQYoBIRAM2QILAkAgASIEIAJHDQBBiwEhEAzZAgsgAiAEayAAKAIAIgFqIRQgBCABa0ECaiEQAkADQCAELQAAIAFBjs+AgABqLQAARw3BASABQQJGDQEgAUEBaiEBIARBAWoiBCACRw0ACyAAIBQ2AgBBiwEhEAzZAgsgAEEANgIAIBBBAWohAUECIRAMvgELAkAgASIEIAJHDQBBjAEhEAzYAgsgAiAEayAAKAIAIgFqIRQgBCABa0EBaiEQAkADQCAELQAAIAFB8M+AgABqLQAARw3AASABQQFGDQEgAUEBaiEBIARBAWoiBCACRw0ACyAAIBQ2AgBBjAEhEAzYAgsgAEEANgIAIBBBAWohAUEfIRAMvQELAkAgASIEIAJHDQBBjQEhEAzXAgsgAiAEayAAKAIAIgFqIRQgBCABa0EBaiEQAkADQCAELQAAIAFB8s+AgABqLQAARw2/ASABQQFGDQEgAUEBaiEBIARBAWoiBCACRw0ACyAAIBQ2AgBBjQEhEAzXAgsgAEEANgIAIBBBAWohAUEJIRAMvAELAkAgASIEIAJHDQBBjgEhEAzWAgsCQAJAIAQtAABBt39qDgcAvwG/Ab8BvwG/AQG/AQsgBEEBaiEBQfgAIRAMvQILIARBAWohAUH5ACEQDLwCCwJAIAEiBCACRw0AQY8BIRAM1QILIAIgBGsgACgCACIBaiEUIAQgAWtBBWohEAJAA0AgBC0AACABQZHPgIAAai0AAEcNvQEgAUEFRg0BIAFBAWohASAEQQFqIgQgAkcNAAsgACAUNgIAQY8BIRAM1QILIABBADYCACAQQQFqIQFBGCEQDLoBCwJAIAEiBCACRw0AQZABIRAM1AILIAIgBGsgACgCACIBaiEUIAQgAWtBAmohEAJAA0AgBC0AACABQZfPgIAAai0AAEcNvAEgAUECRg0BIAFBAWohASAEQQFqIgQgAkcNAAsgACAUNgIAQZABIRAM1AILIABBADYCACAQQQFqIQFBFyEQDLkBCwJAIAEiBCACRw0AQZEBIRAM0wILIAIgBGsgACgCACIBaiEUIAQgAWtBBmohEAJAA0AgBC0AACABQZrPgIAAai0AAEcNuwEgAUEGRg0BIAFBAWohASAEQQFqIgQgAkcNAAsgACAUNgIAQZEBIRAM0wILIABBADYCACAQQQFqIQFBFSEQDLgBCwJAIAEiBCACRw0AQZIBIRAM0gILIAIgBGsgACgCACIBaiEUIAQgAWtBBWohEAJAA0AgBC0AACABQaHPgIAAai0AAEcNugEgAUEFRg0BIAFBAWohASAEQQFqIgQgAkcNAAsgACAUNgIAQZIBIRAM0gILIABBADYCACAQQQFqIQFBHiEQDLcBCwJAIAEiBCACRw0AQZMBIRAM0QILIAQtAABBzABHDbgBIARBAWohAUEKIRAMtgELAkAgBCACRw0AQZQBIRAM0AILAkACQCAELQAAQb9/ag4PALkBuQG5AbkBuQG5AbkBuQG5AbkBuQG5AbkBAbkBCyAEQQFqIQFB/gAhEAy3AgsgBEEBaiEBQf8AIRAMtgILAkAgBCACRw0AQZUBIRAMzwILAkACQCAELQAAQb9/ag4DALgBAbgBCyAEQQFqIQFB/QAhEAy2AgsgBEEBaiEEQYABIRAMtQILAkAgBCACRw0AQZYBIRAMzgILIAIgBGsgACgCACIBaiEUIAQgAWtBAWohEAJAA0AgBC0AACABQafPgIAAai0AAEcNtgEgAUEBRg0BIAFBAWohASAEQQFqIgQgAkcNAAsgACAUNgIAQZYBIRAMzgILIABBADYCACAQQQFqIQFBCyEQDLMBCwJAIAQgAkcNAEGXASEQDM0CCwJAAkACQAJAIAQtAABBU2oOIwC4AbgBuAG4AbgBuAG4AbgBuAG4AbgBuAG4AbgBuAG4AbgBuAG4AbgBuAG4AbgBAbgBuAG4AbgBuAECuAG4AbgBA7gBCyAEQQFqIQFB+wAhEAy2AgsgBEEBaiEBQfwAIRAMtQILIARBAWohBEGBASEQDLQCCyAEQQFqIQRBggEhEAyzAgsCQCAEIAJHDQBBmAEhEAzMAgsgAiAEayAAKAIAIgFqIRQgBCABa0EEaiEQAkADQCAELQAAIAFBqc+AgABqLQAARw20ASABQQRGDQEgAUEBaiEBIARBAWoiBCACRw0ACyAAIBQ2AgBBmAEhEAzMAgsgAEEANgIAIBBBAWohAUEZIRAMsQELAkAgBCACRw0AQZkBIRAMywILIAIgBGsgACgCACIBaiEUIAQgAWtBBWohEAJAA0AgBC0AACABQa7PgIAAai0AAEcNswEgAUEFRg0BIAFBAWohASAEQQFqIgQgAkcNAAsgACAUNgIAQZkBIRAMywILIABBADYCACAQQQFqIQFBBiEQDLABCwJAIAQgAkcNAEGaASEQDMoCCyACIARrIAAoAgAiAWohFCAEIAFrQQFqIRACQANAIAQtAAAgAUG0z4CAAGotAABHDbIBIAFBAUYNASABQQFqIQEgBEEBaiIEIAJHDQALIAAgFDYCAEGaASEQDMoCCyAAQQA2AgAgEEEBaiEBQRwhEAyvAQsCQCAEIAJHDQBBmwEhEAzJAgsgAiAEayAAKAIAIgFqIRQgBCABa0EBaiEQAkADQCAELQAAIAFBts+AgABqLQAARw2xASABQQFGDQEgAUEBaiEBIARBAWoiBCACRw0ACyAAIBQ2AgBBmwEhEAzJAgsgAEEANgIAIBBBAWohAUEnIRAMrgELAkAgBCACRw0AQZwBIRAMyAILAkACQCAELQAAQax/ag4CAAGxAQsgBEEBaiEEQYYBIRAMrwILIARBAWohBEGHASEQDK4CCwJAIAQgAkcNAEGdASEQDMcCCyACIARrIAAoAgAiAWohFCAEIAFrQQFqIRACQANAIAQtAAAgAUG4z4CAAGotAABHDa8BIAFBAUYNASABQQFqIQEgBEEBaiIEIAJHDQALIAAgFDYCAEGdASEQDMcCCyAAQQA2AgAgEEEBaiEBQSYhEAysAQsCQCAEIAJHDQBBngEhEAzGAgsgAiAEayAAKAIAIgFqIRQgBCABa0EBaiEQAkADQCAELQAAIAFBus+AgABqLQAARw2uASABQQFGDQEgAUEBaiEBIARBAWoiBCACRw0ACyAAIBQ2AgBBngEhEAzGAgsgAEEANgIAIBBBAWohAUEDIRAMqwELAkAgBCACRw0AQZ8BIRAMxQILIAIgBGsgACgCACIBaiEUIAQgAWtBAmohEAJAA0AgBC0AACABQe3PgIAAai0AAEcNrQEgAUECRg0BIAFBAWohASAEQQFqIgQgAkcNAAsgACAUNgIAQZ8BIRAMxQILIABBADYCACAQQQFqIQFBDCEQDKoBCwJAIAQgAkcNAEGgASEQDMQCCyACIARrIAAoAgAiAWohFCAEIAFrQQNqIRACQANAIAQtAAAgAUG8z4CAAGotAABHDawBIAFBA0YNASABQQFqIQEgBEEBaiIEIAJHDQALIAAgFDYCAEGgASEQDMQCCyAAQQA2AgAgEEEBaiEBQQ0hEAypAQsCQCAEIAJHDQBBoQEhEAzDAgsCQAJAIAQtAABBun9qDgsArAGsAawBrAGsAawBrAGsAawBAawBCyAEQQFqIQRBiwEhEAyqAgsgBEEBaiEEQYwBIRAMqQILAkAgBCACRw0AQaIBIRAMwgILIAQtAABB0ABHDakBIARBAWohBAzpAQsCQCAEIAJHDQBBowEhEAzBAgsCQAJAIAQtAABBt39qDgcBqgGqAaoBqgGqAQCqAQsgBEEBaiEEQY4BIRAMqAILIARBAWohAUEiIRAMpgELAkAgBCACRw0AQaQBIRAMwAILIAIgBGsgACgCACIBaiEUIAQgAWtBAWohEAJAA0AgBC0AACABQcDPgIAAai0AAEcNqAEgAUEBRg0BIAFBAWohASAEQQFqIgQgAkcNAAsgACAUNgIAQaQBIRAMwAILIABBADYCACAQQQFqIQFBHSEQDKUBCwJAIAQgAkcNAEGlASEQDL8CCwJAAkAgBC0AAEGuf2oOAwCoAQGoAQsgBEEBaiEEQZABIRAMpgILIARBAWohAUEEIRAMpAELAkAgBCACRw0AQaYBIRAMvgILAkACQAJAAkACQCAELQAAQb9/ag4VAKoBqgGqAaoBqgGqAaoBqgGqAaoBAaoBqgECqgGqAQOqAaoBBKoBCyAEQQFqIQRBiAEhEAyoAgsgBEEBaiEEQYkBIRAMpwILIARBAWohBEGKASEQDKYCCyAEQQFqIQRBjwEhEAylAgsgBEEBaiEEQZEBIRAMpAILAkAgBCACRw0AQacBIRAMvQILIAIgBGsgACgCACIBaiEUIAQgAWtBAmohEAJAA0AgBC0AACABQe3PgIAAai0AAEcNpQEgAUECRg0BIAFBAWohASAEQQFqIgQgAkcNAAsgACAUNgIAQacBIRAMvQILIABBADYCACAQQQFqIQFBESEQDKIBCwJAIAQgAkcNAEGoASEQDLwCCyACIARrIAAoAgAiAWohFCAEIAFrQQJqIRACQANAIAQtAAAgAUHCz4CAAGotAABHDaQBIAFBAkYNASABQQFqIQEgBEEBaiIEIAJHDQALIAAgFDYCAEGoASEQDLwCCyAAQQA2AgAgEEEBaiEBQSwhEAyhAQsCQCAEIAJHDQBBqQEhEAy7AgsgAiAEayAAKAIAIgFqIRQgBCABa0EEaiEQAkADQCAELQAAIAFBxc+AgABqLQAARw2jASABQQRGDQEgAUEBaiEBIARBAWoiBCACRw0ACyAAIBQ2AgBBqQEhEAy7AgsgAEEANgIAIBBBAWohAUErIRAMoAELAkAgBCACRw0AQaoBIRAMugILIAIgBGsgACgCACIBaiEUIAQgAWtBAmohEAJAA0AgBC0AACABQcrPgIAAai0AAEcNogEgAUECRg0BIAFBAWohASAEQQFqIgQgAkcNAAsgACAUNgIAQaoBIRAMugILIABBADYCACAQQQFqIQFBFCEQDJ8BCwJAIAQgAkcNAEGrASEQDLkCCwJAAkACQAJAIAQtAABBvn9qDg8AAQKkAaQBpAGkAaQBpAGkAaQBpAGkAaQBA6QBCyAEQQFqIQRBkwEhEAyiAgsgBEEBaiEEQZQBIRAMoQILIARBAWohBEGVASEQDKACCyAEQQFqIQRBlgEhEAyfAgsCQCAEIAJHDQBBrAEhEAy4AgsgBC0AAEHFAEcNnwEgBEEBaiEEDOABCwJAIAQgAkcNAEGtASEQDLcCCyACIARrIAAoAgAiAWohFCAEIAFrQQJqIRACQANAIAQtAAAgAUHNz4CAAGotAABHDZ8BIAFBAkYNASABQQFqIQEgBEEBaiIEIAJHDQALIAAgFDYCAEGtASEQDLcCCyAAQQA2AgAgEEEBaiEBQQ4hEAycAQsCQCAEIAJHDQBBrgEhEAy2AgsgBC0AAEHQAEcNnQEgBEEBaiEBQSUhEAybAQsCQCAEIAJHDQBBrwEhEAy1AgsgAiAEayAAKAIAIgFqIRQgBCABa0EIaiEQAkADQCAELQAAIAFB0M+AgABqLQAARw2dASABQQhGDQEgAUEBaiEBIARBAWoiBCACRw0ACyAAIBQ2AgBBrwEhEAy1AgsgAEEANgIAIBBBAWohAUEqIRAMmgELAkAgBCACRw0AQbABIRAMtAILAkACQCAELQAAQat/ag4LAJ0BnQGdAZ0BnQGdAZ0BnQGdAQGdAQsgBEEBaiEEQZoBIRAMmwILIARBAWohBEGbASEQDJoCCwJAIAQgAkcNAEGxASEQDLMCCwJAAkAgBC0AAEG/f2oOFACcAZwBnAGcAZwBnAGcAZwBnAGcAZwBnAGcAZwBnAGcAZwBnAEBnAELIARBAWohBEGZASEQDJoCCyAEQQFqIQRBnAEhEAyZAgsCQCAEIAJHDQBBsgEhEAyyAgsgAiAEayAAKAIAIgFqIRQgBCABa0EDaiEQAkADQCAELQAAIAFB2c+AgABqLQAARw2aASABQQNGDQEgAUEBaiEBIARBAWoiBCACRw0ACyAAIBQ2AgBBsgEhEAyyAgsgAEEANgIAIBBBAWohAUEhIRAMlwELAkAgBCACRw0AQbMBIRAMsQILIAIgBGsgACgCACIBaiEUIAQgAWtBBmohEAJAA0AgBC0AACABQd3PgIAAai0AAEcNmQEgAUEGRg0BIAFBAWohASAEQQFqIgQgAkcNAAsgACAUNgIAQbMBIRAMsQILIABBADYCACAQQQFqIQFBGiEQDJYBCwJAIAQgAkcNAEG0ASEQDLACCwJAAkACQCAELQAAQbt/ag4RAJoBmgGaAZoBmgGaAZoBmgGaAQGaAZoBmgGaAZoBApoBCyAEQQFqIQRBnQEhEAyYAgsgBEEBaiEEQZ4BIRAMlwILIARBAWohBEGfASEQDJYCCwJAIAQgAkcNAEG1ASEQDK8CCyACIARrIAAoAgAiAWohFCAEIAFrQQVqIRACQANAIAQtAAAgAUHkz4CAAGotAABHDZcBIAFBBUYNASABQQFqIQEgBEEBaiIEIAJHDQALIAAgFDYCAEG1ASEQDK8CCyAAQQA2AgAgEEEBaiEBQSghEAyUAQsCQCAEIAJHDQBBtgEhEAyuAgsgAiAEayAAKAIAIgFqIRQgBCABa0ECaiEQAkADQCAELQAAIAFB6s+AgABqLQAARw2WASABQQJGDQEgAUEBaiEBIARBAWoiBCACRw0ACyAAIBQ2AgBBtgEhEAyuAgsgAEEANgIAIBBBAWohAUEHIRAMkwELAkAgBCACRw0AQbcBIRAMrQILAkACQCAELQAAQbt/ag4OAJYBlgGWAZYBlgGWAZYBlgGWAZYBlgGWAQGWAQsgBEEBaiEEQaEBIRAMlAILIARBAWohBEGiASEQDJMCCwJAIAQgAkcNAEG4ASEQDKwCCyACIARrIAAoAgAiAWohFCAEIAFrQQJqIRACQANAIAQtAAAgAUHtz4CAAGotAABHDZQBIAFBAkYNASABQQFqIQEgBEEBaiIEIAJHDQALIAAgFDYCAEG4ASEQDKwCCyAAQQA2AgAgEEEBaiEBQRIhEAyRAQsCQCAEIAJHDQBBuQEhEAyrAgsgAiAEayAAKAIAIgFqIRQgBCABa0EBaiEQAkADQCAELQAAIAFB8M+AgABqLQAARw2TASABQQFGDQEgAUEBaiEBIARBAWoiBCACRw0ACyAAIBQ2AgBBuQEhEAyrAgsgAEEANgIAIBBBAWohAUEgIRAMkAELAkAgBCACRw0AQboBIRAMqgILIAIgBGsgACgCACIBaiEUIAQgAWtBAWohEAJAA0AgBC0AACABQfLPgIAAai0AAEcNkgEgAUEBRg0BIAFBAWohASAEQQFqIgQgAkcNAAsgACAUNgIAQboBIRAMqgILIABBADYCACAQQQFqIQFBDyEQDI8BCwJAIAQgAkcNAEG7ASEQDKkCCwJAAkAgBC0AAEG3f2oOBwCSAZIBkgGSAZIBAZIBCyAEQQFqIQRBpQEhEAyQAgsgBEEBaiEEQaYBIRAMjwILAkAgBCACRw0AQbwBIRAMqAILIAIgBGsgACgCACIBaiEUIAQgAWtBB2ohEAJAA0AgBC0AACABQfTPgIAAai0AAEcNkAEgAUEHRg0BIAFBAWohASAEQQFqIgQgAkcNAAsgACAUNgIAQbwBIRAMqAILIABBADYCACAQQQFqIQFBGyEQDI0BCwJAIAQgAkcNAEG9ASEQDKcCCwJAAkACQCAELQAAQb5/ag4SAJEBkQGRAZEBkQGRAZEBkQGRAQGRAZEBkQGRAZEBkQECkQELIARBAWohBEGkASEQDI8CCyAEQQFqIQRBpwEhEAyOAgsgBEEBaiEEQagBIRAMjQILAkAgBCACRw0AQb4BIRAMpgILIAQtAABBzgBHDY0BIARBAWohBAzPAQsCQCAEIAJHDQBBvwEhEAylAgsCQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQCAELQAAQb9/ag4VAAECA5wBBAUGnAGcAZwBBwgJCgucAQwNDg+cAQsgBEEBaiEBQegAIRAMmgILIARBAWohAUHpACEQDJkCCyAEQQFqIQFB7gAhEAyYAgsgBEEBaiEBQfIAIRAMlwILIARBAWohAUHzACEQDJYCCyAEQQFqIQFB9gAhEAyVAgsgBEEBaiEBQfcAIRAMlAILIARBAWohAUH6ACEQDJMCCyAEQQFqIQRBgwEhEAySAgsgBEEBaiEEQYQBIRAMkQILIARBAWohBEGFASEQDJACCyAEQQFqIQRBkgEhEAyPAgsgBEEBaiEEQZgBIRAMjgILIARBAWohBEGgASEQDI0CCyAEQQFqIQRBowEhEAyMAgsgBEEBaiEEQaoBIRAMiwILAkAgBCACRg0AIABBkICAgAA2AgggACAENgIEQasBIRAMiwILQcABIRAMowILIAAgBSACEKqAgIAAIgENiwEgBSEBDFwLAkAgBiACRg0AIAZBAWohBQyNAQtBwgEhEAyhAgsDQAJAIBAtAABBdmoOBIwBAACPAQALIBBBAWoiECACRw0AC0HDASEQDKACCwJAIAcgAkYNACAAQZGAgIAANgIIIAAgBzYCBCAHIQFBASEQDIcCC0HEASEQDJ8CCwJAIAcgAkcNAEHFASEQDJ8CCwJAAkAgBy0AAEF2ag4EAc4BzgEAzgELIAdBAWohBgyNAQsgB0EBaiEFDIkBCwJAIAcgAkcNAEHGASEQDJ4CCwJAAkAgBy0AAEF2ag4XAY8BjwEBjwGPAY8BjwGPAY8BjwGPAY8BjwGPAY8BjwGPAY8BjwGPAY8BAI8BCyAHQQFqIQcLQbABIRAMhAILAkAgCCACRw0AQcgBIRAMnQILIAgtAABBIEcNjQEgAEEAOwEyIAhBAWohAUGzASEQDIMCCyABIRcCQANAIBciByACRg0BIActAABBUGpB/wFxIhBBCk8NzAECQCAALwEyIhRBmTNLDQAgACAUQQpsIhQ7ATIgEEH//wNzIBRB/v8DcUkNACAHQQFqIRcgACAUIBBqIhA7ATIgEEH//wNxQegHSQ0BCwtBACEQIABBADYCHCAAQcGJgIAANgIQIABBDTYCDCAAIAdBAWo2AhQMnAILQccBIRAMmwILIAAgCCACEK6AgIAAIhBFDcoBIBBBFUcNjAEgAEHIATYCHCAAIAg2AhQgAEHJl4CAADYCECAAQRU2AgxBACEQDJoCCwJAIAkgAkcNAEHMASEQDJoCC0EAIRRBASEXQQEhFkEAIRACQAJAAkACQAJAAkACQAJAAkAgCS0AAEFQag4KlgGVAQABAgMEBQYIlwELQQIhEAwGC0EDIRAMBQtBBCEQDAQLQQUhEAwDC0EGIRAMAgtBByEQDAELQQghEAtBACEXQQAhFkEAIRQMjgELQQkhEEEBIRRBACEXQQAhFgyNAQsCQCAKIAJHDQBBzgEhEAyZAgsgCi0AAEEuRw2OASAKQQFqIQkMygELIAsgAkcNjgFB0AEhEAyXAgsCQCALIAJGDQAgAEGOgICAADYCCCAAIAs2AgRBtwEhEAz+AQtB0QEhEAyWAgsCQCAEIAJHDQBB0gEhEAyWAgsgAiAEayAAKAIAIhBqIRQgBCAQa0EEaiELA0AgBC0AACAQQfzPgIAAai0AAEcNjgEgEEEERg3pASAQQQFqIRAgBEEBaiIEIAJHDQALIAAgFDYCAEHSASEQDJUCCyAAIAwgAhCsgICAACIBDY0BIAwhAQy4AQsCQCAEIAJHDQBB1AEhEAyUAgsgAiAEayAAKAIAIhBqIRQgBCAQa0EBaiEMA0AgBC0AACAQQYHQgIAAai0AAEcNjwEgEEEBRg2OASAQQQFqIRAgBEEBaiIEIAJHDQALIAAgFDYCAEHUASEQDJMCCwJAIAQgAkcNAEHWASEQDJMCCyACIARrIAAoAgAiEGohFCAEIBBrQQJqIQsDQCAELQAAIBBBg9CAgABqLQAARw2OASAQQQJGDZABIBBBAWohECAEQQFqIgQgAkcNAAsgACAUNgIAQdYBIRAMkgILAkAgBCACRw0AQdcBIRAMkgILAkACQCAELQAAQbt/ag4QAI8BjwGPAY8BjwGPAY8BjwGPAY8BjwGPAY8BjwEBjwELIARBAWohBEG7ASEQDPkBCyAEQQFqIQRBvAEhEAz4AQsCQCAEIAJHDQBB2AEhEAyRAgsgBC0AAEHIAEcNjAEgBEEBaiEEDMQBCwJAIAQgAkYNACAAQZCAgIAANgIIIAAgBDYCBEG+ASEQDPcBC0HZASEQDI8CCwJAIAQgAkcNAEHaASEQDI8CCyAELQAAQcgARg3DASAAQQE6ACgMuQELIABBAjoALyAAIAQgAhCmgICAACIQDY0BQcIBIRAM9AELIAAtAChBf2oOArcBuQG4AQsDQAJAIAQtAABBdmoOBACOAY4BAI4BCyAEQQFqIgQgAkcNAAtB3QEhEAyLAgsgAEEAOgAvIAAtAC1BBHFFDYQCCyAAQQA6AC8gAEEBOgA0IAEhAQyMAQsgEEEVRg3aASAAQQA2AhwgACABNgIUIABBp46AgAA2AhAgAEESNgIMQQAhEAyIAgsCQCAAIBAgAhC0gICAACIEDQAgECEBDIECCwJAIARBFUcNACAAQQM2AhwgACAQNgIUIABBsJiAgAA2AhAgAEEVNgIMQQAhEAyIAgsgAEEANgIcIAAgEDYCFCAAQaeOgIAANgIQIABBEjYCDEEAIRAMhwILIBBBFUYN1gEgAEEANgIcIAAgATYCFCAAQdqNgIAANgIQIABBFDYCDEEAIRAMhgILIAAoAgQhFyAAQQA2AgQgECARp2oiFiEBIAAgFyAQIBYgFBsiEBC1gICAACIURQ2NASAAQQc2AhwgACAQNgIUIAAgFDYCDEEAIRAMhQILIAAgAC8BMEGAAXI7ATAgASEBC0EqIRAM6gELIBBBFUYN0QEgAEEANgIcIAAgATYCFCAAQYOMgIAANgIQIABBEzYCDEEAIRAMggILIBBBFUYNzwEgAEEANgIcIAAgATYCFCAAQZqPgIAANgIQIABBIjYCDEEAIRAMgQILIAAoAgQhECAAQQA2AgQCQCAAIBAgARC3gICAACIQDQAgAUEBaiEBDI0BCyAAQQw2AhwgACAQNgIMIAAgAUEBajYCFEEAIRAMgAILIBBBFUYNzAEgAEEANgIcIAAgATYCFCAAQZqPgIAANgIQIABBIjYCDEEAIRAM/wELIAAoAgQhECAAQQA2AgQCQCAAIBAgARC3gICAACIQDQAgAUEBaiEBDIwBCyAAQQ02AhwgACAQNgIMIAAgAUEBajYCFEEAIRAM/gELIBBBFUYNyQEgAEEANgIcIAAgATYCFCAAQcaMgIAANgIQIABBIzYCDEEAIRAM/QELIAAoAgQhECAAQQA2AgQCQCAAIBAgARC5gICAACIQDQAgAUEBaiEBDIsBCyAAQQ42AhwgACAQNgIMIAAgAUEBajYCFEEAIRAM/AELIABBADYCHCAAIAE2AhQgAEHAlYCAADYCECAAQQI2AgxBACEQDPsBCyAQQRVGDcUBIABBADYCHCAAIAE2AhQgAEHGjICAADYCECAAQSM2AgxBACEQDPoBCyAAQRA2AhwgACABNgIUIAAgEDYCDEEAIRAM+QELIAAoAgQhBCAAQQA2AgQCQCAAIAQgARC5gICAACIEDQAgAUEBaiEBDPEBCyAAQRE2AhwgACAENgIMIAAgAUEBajYCFEEAIRAM+AELIBBBFUYNwQEgAEEANgIcIAAgATYCFCAAQcaMgIAANgIQIABBIzYCDEEAIRAM9wELIAAoAgQhECAAQQA2AgQCQCAAIBAgARC5gICAACIQDQAgAUEBaiEBDIgBCyAAQRM2AhwgACAQNgIMIAAgAUEBajYCFEEAIRAM9gELIAAoAgQhBCAAQQA2AgQCQCAAIAQgARC5gICAACIEDQAgAUEBaiEBDO0BCyAAQRQ2AhwgACAENgIMIAAgAUEBajYCFEEAIRAM9QELIBBBFUYNvQEgAEEANgIcIAAgATYCFCAAQZqPgIAANgIQIABBIjYCDEEAIRAM9AELIAAoAgQhECAAQQA2AgQCQCAAIBAgARC3gICAACIQDQAgAUEBaiEBDIYBCyAAQRY2AhwgACAQNgIMIAAgAUEBajYCFEEAIRAM8wELIAAoAgQhBCAAQQA2AgQCQCAAIAQgARC3gICAACIEDQAgAUEBaiEBDOkBCyAAQRc2AhwgACAENgIMIAAgAUEBajYCFEEAIRAM8gELIABBADYCHCAAIAE2AhQgAEHNk4CAADYCECAAQQw2AgxBACEQDPEBC0IBIRELIBBBAWohAQJAIAApAyAiEkL//////////w9WDQAgACASQgSGIBGENwMgIAEhAQyEAQsgAEEANgIcIAAgATYCFCAAQa2JgIAANgIQIABBDDYCDEEAIRAM7wELIABBADYCHCAAIBA2AhQgAEHNk4CAADYCECAAQQw2AgxBACEQDO4BCyAAKAIEIRcgAEEANgIEIBAgEadqIhYhASAAIBcgECAWIBQbIhAQtYCAgAAiFEUNcyAAQQU2AhwgACAQNgIUIAAgFDYCDEEAIRAM7QELIABBADYCHCAAIBA2AhQgAEGqnICAADYCECAAQQ82AgxBACEQDOwBCyAAIBAgAhC0gICAACIBDQEgECEBC0EOIRAM0QELAkAgAUEVRw0AIABBAjYCHCAAIBA2AhQgAEGwmICAADYCECAAQRU2AgxBACEQDOoBCyAAQQA2AhwgACAQNgIUIABBp46AgAA2AhAgAEESNgIMQQAhEAzpAQsgAUEBaiEQAkAgAC8BMCIBQYABcUUNAAJAIAAgECACELuAgIAAIgENACAQIQEMcAsgAUEVRw26ASAAQQU2AhwgACAQNgIUIABB+ZeAgAA2AhAgAEEVNgIMQQAhEAzpAQsCQCABQaAEcUGgBEcNACAALQAtQQJxDQAgAEEANgIcIAAgEDYCFCAAQZaTgIAANgIQIABBBDYCDEEAIRAM6QELIAAgECACEL2AgIAAGiAQIQECQAJAAkACQAJAIAAgECACELOAgIAADhYCAQAEBAQEBAQEBAQEBAQEBAQEBAQDBAsgAEEBOgAuCyAAIAAvATBBwAByOwEwIBAhAQtBJiEQDNEBCyAAQSM2AhwgACAQNgIUIABBpZaAgAA2AhAgAEEVNgIMQQAhEAzpAQsgAEEANgIcIAAgEDYCFCAAQdWLgIAANgIQIABBETYCDEEAIRAM6AELIAAtAC1BAXFFDQFBwwEhEAzOAQsCQCANIAJGDQADQAJAIA0tAABBIEYNACANIQEMxAELIA1BAWoiDSACRw0AC0ElIRAM5wELQSUhEAzmAQsgACgCBCEEIABBADYCBCAAIAQgDRCvgICAACIERQ2tASAAQSY2AhwgACAENgIMIAAgDUEBajYCFEEAIRAM5QELIBBBFUYNqwEgAEEANgIcIAAgATYCFCAAQf2NgIAANgIQIABBHTYCDEEAIRAM5AELIABBJzYCHCAAIAE2AhQgACAQNgIMQQAhEAzjAQsgECEBQQEhFAJAAkACQAJAAkACQAJAIAAtACxBfmoOBwYFBQMBAgAFCyAAIAAvATBBCHI7ATAMAwtBAiEUDAELQQQhFAsgAEEBOgAsIAAgAC8BMCAUcjsBMAsgECEBC0ErIRAMygELIABBADYCHCAAIBA2AhQgAEGrkoCAADYCECAAQQs2AgxBACEQDOIBCyAAQQA2AhwgACABNgIUIABB4Y+AgAA2AhAgAEEKNgIMQQAhEAzhAQsgAEEAOgAsIBAhAQy9AQsgECEBQQEhFAJAAkACQAJAAkAgAC0ALEF7ag4EAwECAAULIAAgAC8BMEEIcjsBMAwDC0ECIRQMAQtBBCEUCyAAQQE6ACwgACAALwEwIBRyOwEwCyAQIQELQSkhEAzFAQsgAEEANgIcIAAgATYCFCAAQfCUgIAANgIQIABBAzYCDEEAIRAM3QELAkAgDi0AAEENRw0AIAAoAgQhASAAQQA2AgQCQCAAIAEgDhCxgICAACIBDQAgDkEBaiEBDHULIABBLDYCHCAAIAE2AgwgACAOQQFqNgIUQQAhEAzdAQsgAC0ALUEBcUUNAUHEASEQDMMBCwJAIA4gAkcNAEEtIRAM3AELAkACQANAAkAgDi0AAEF2ag4EAgAAAwALIA5BAWoiDiACRw0AC0EtIRAM3QELIAAoAgQhASAAQQA2AgQCQCAAIAEgDhCxgICAACIBDQAgDiEBDHQLIABBLDYCHCAAIA42AhQgACABNgIMQQAhEAzcAQsgACgCBCEBIABBADYCBAJAIAAgASAOELGAgIAAIgENACAOQQFqIQEMcwsgAEEsNgIcIAAgATYCDCAAIA5BAWo2AhRBACEQDNsBCyAAKAIEIQQgAEEANgIEIAAgBCAOELGAgIAAIgQNoAEgDiEBDM4BCyAQQSxHDQEgAUEBaiEQQQEhAQJAAkACQAJAAkAgAC0ALEF7ag4EAwECBAALIBAhAQwEC0ECIQEMAQtBBCEBCyAAQQE6ACwgACAALwEwIAFyOwEwIBAhAQwBCyAAIAAvATBBCHI7ATAgECEBC0E5IRAMvwELIABBADoALCABIQELQTQhEAy9AQsgACAALwEwQSByOwEwIAEhAQwCCyAAKAIEIQQgAEEANgIEAkAgACAEIAEQsYCAgAAiBA0AIAEhAQzHAQsgAEE3NgIcIAAgATYCFCAAIAQ2AgxBACEQDNQBCyAAQQg6ACwgASEBC0EwIRAMuQELAkAgAC0AKEEBRg0AIAEhAQwECyAALQAtQQhxRQ2TASABIQEMAwsgAC0AMEEgcQ2UAUHFASEQDLcBCwJAIA8gAkYNAAJAA0ACQCAPLQAAQVBqIgFB/wFxQQpJDQAgDyEBQTUhEAy6AQsgACkDICIRQpmz5syZs+bMGVYNASAAIBFCCn4iETcDICARIAGtQv8BgyISQn+FVg0BIAAgESASfDcDICAPQQFqIg8gAkcNAAtBOSEQDNEBCyAAKAIEIQIgAEEANgIEIAAgAiAPQQFqIgQQsYCAgAAiAg2VASAEIQEMwwELQTkhEAzPAQsCQCAALwEwIgFBCHFFDQAgAC0AKEEBRw0AIAAtAC1BCHFFDZABCyAAIAFB9/sDcUGABHI7ATAgDyEBC0E3IRAMtAELIAAgAC8BMEEQcjsBMAyrAQsgEEEVRg2LASAAQQA2AhwgACABNgIUIABB8I6AgAA2AhAgAEEcNgIMQQAhEAzLAQsgAEHDADYCHCAAIAE2AgwgACANQQFqNgIUQQAhEAzKAQsCQCABLQAAQTpHDQAgACgCBCEQIABBADYCBAJAIAAgECABEK+AgIAAIhANACABQQFqIQEMYwsgAEHDADYCHCAAIBA2AgwgACABQQFqNgIUQQAhEAzKAQsgAEEANgIcIAAgATYCFCAAQbGRgIAANgIQIABBCjYCDEEAIRAMyQELIABBADYCHCAAIAE2AhQgAEGgmYCAADYCECAAQR42AgxBACEQDMgBCyAAQQA2AgALIABBgBI7ASogACAXQQFqIgEgAhCogICAACIQDQEgASEBC0HHACEQDKwBCyAQQRVHDYMBIABB0QA2AhwgACABNgIUIABB45eAgAA2AhAgAEEVNgIMQQAhEAzEAQsgACgCBCEQIABBADYCBAJAIAAgECABEKeAgIAAIhANACABIQEMXgsgAEHSADYCHCAAIAE2AhQgACAQNgIMQQAhEAzDAQsgAEEANgIcIAAgFDYCFCAAQcGogIAANgIQIABBBzYCDCAAQQA2AgBBACEQDMIBCyAAKAIEIRAgAEEANgIEAkAgACAQIAEQp4CAgAAiEA0AIAEhAQxdCyAAQdMANgIcIAAgATYCFCAAIBA2AgxBACEQDMEBC0EAIRAgAEEANgIcIAAgATYCFCAAQYCRgIAANgIQIABBCTYCDAzAAQsgEEEVRg19IABBADYCHCAAIAE2AhQgAEGUjYCAADYCECAAQSE2AgxBACEQDL8BC0EBIRZBACEXQQAhFEEBIRALIAAgEDoAKyABQQFqIQECQAJAIAAtAC1BEHENAAJAAkACQCAALQAqDgMBAAIECyAWRQ0DDAILIBQNAQwCCyAXRQ0BCyAAKAIEIRAgAEEANgIEAkAgACAQIAEQrYCAgAAiEA0AIAEhAQxcCyAAQdgANgIcIAAgATYCFCAAIBA2AgxBACEQDL4BCyAAKAIEIQQgAEEANgIEAkAgACAEIAEQrYCAgAAiBA0AIAEhAQytAQsgAEHZADYCHCAAIAE2AhQgACAENgIMQQAhEAy9AQsgACgCBCEEIABBADYCBAJAIAAgBCABEK2AgIAAIgQNACABIQEMqwELIABB2gA2AhwgACABNgIUIAAgBDYCDEEAIRAMvAELIAAoAgQhBCAAQQA2AgQCQCAAIAQgARCtgICAACIEDQAgASEBDKkBCyAAQdwANgIcIAAgATYCFCAAIAQ2AgxBACEQDLsBCwJAIAEtAABBUGoiEEH/AXFBCk8NACAAIBA6ACogAUEBaiEBQc8AIRAMogELIAAoAgQhBCAAQQA2AgQCQCAAIAQgARCtgICAACIEDQAgASEBDKcBCyAAQd4ANgIcIAAgATYCFCAAIAQ2AgxBACEQDLoBCyAAQQA2AgAgF0EBaiEBAkAgAC0AKUEjTw0AIAEhAQxZCyAAQQA2AhwgACABNgIUIABB04mAgAA2AhAgAEEINgIMQQAhEAy5AQsgAEEANgIAC0EAIRAgAEEANgIcIAAgATYCFCAAQZCzgIAANgIQIABBCDYCDAy3AQsgAEEANgIAIBdBAWohAQJAIAAtAClBIUcNACABIQEMVgsgAEEANgIcIAAgATYCFCAAQZuKgIAANgIQIABBCDYCDEEAIRAMtgELIABBADYCACAXQQFqIQECQCAALQApIhBBXWpBC08NACABIQEMVQsCQCAQQQZLDQBBASAQdEHKAHFFDQAgASEBDFULQQAhECAAQQA2AhwgACABNgIUIABB94mAgAA2AhAgAEEINgIMDLUBCyAQQRVGDXEgAEEANgIcIAAgATYCFCAAQbmNgIAANgIQIABBGjYCDEEAIRAMtAELIAAoAgQhECAAQQA2AgQCQCAAIBAgARCngICAACIQDQAgASEBDFQLIABB5QA2AhwgACABNgIUIAAgEDYCDEEAIRAMswELIAAoAgQhECAAQQA2AgQCQCAAIBAgARCngICAACIQDQAgASEBDE0LIABB0gA2AhwgACABNgIUIAAgEDYCDEEAIRAMsgELIAAoAgQhECAAQQA2AgQCQCAAIBAgARCngICAACIQDQAgASEBDE0LIABB0wA2AhwgACABNgIUIAAgEDYCDEEAIRAMsQELIAAoAgQhECAAQQA2AgQCQCAAIBAgARCngICAACIQDQAgASEBDFELIABB5QA2AhwgACABNgIUIAAgEDYCDEEAIRAMsAELIABBADYCHCAAIAE2AhQgAEHGioCAADYCECAAQQc2AgxBACEQDK8BCyAAKAIEIRAgAEEANgIEAkAgACAQIAEQp4CAgAAiEA0AIAEhAQxJCyAAQdIANgIcIAAgATYCFCAAIBA2AgxBACEQDK4BCyAAKAIEIRAgAEEANgIEAkAgACAQIAEQp4CAgAAiEA0AIAEhAQxJCyAAQdMANgIcIAAgATYCFCAAIBA2AgxBACEQDK0BCyAAKAIEIRAgAEEANgIEAkAgACAQIAEQp4CAgAAiEA0AIAEhAQxNCyAAQeUANgIcIAAgATYCFCAAIBA2AgxBACEQDKwBCyAAQQA2AhwgACABNgIUIABB3IiAgAA2AhAgAEEHNgIMQQAhEAyrAQsgEEE/Rw0BIAFBAWohAQtBBSEQDJABC0EAIRAgAEEANgIcIAAgATYCFCAAQf2SgIAANgIQIABBBzYCDAyoAQsgACgCBCEQIABBADYCBAJAIAAgECABEKeAgIAAIhANACABIQEMQgsgAEHSADYCHCAAIAE2AhQgACAQNgIMQQAhEAynAQsgACgCBCEQIABBADYCBAJAIAAgECABEKeAgIAAIhANACABIQEMQgsgAEHTADYCHCAAIAE2AhQgACAQNgIMQQAhEAymAQsgACgCBCEQIABBADYCBAJAIAAgECABEKeAgIAAIhANACABIQEMRgsgAEHlADYCHCAAIAE2AhQgACAQNgIMQQAhEAylAQsgACgCBCEBIABBADYCBAJAIAAgASAUEKeAgIAAIgENACAUIQEMPwsgAEHSADYCHCAAIBQ2AhQgACABNgIMQQAhEAykAQsgACgCBCEBIABBADYCBAJAIAAgASAUEKeAgIAAIgENACAUIQEMPwsgAEHTADYCHCAAIBQ2AhQgACABNgIMQQAhEAyjAQsgACgCBCEBIABBADYCBAJAIAAgASAUEKeAgIAAIgENACAUIQEMQwsgAEHlADYCHCAAIBQ2AhQgACABNgIMQQAhEAyiAQsgAEEANgIcIAAgFDYCFCAAQcOPgIAANgIQIABBBzYCDEEAIRAMoQELIABBADYCHCAAIAE2AhQgAEHDj4CAADYCECAAQQc2AgxBACEQDKABC0EAIRAgAEEANgIcIAAgFDYCFCAAQYycgIAANgIQIABBBzYCDAyfAQsgAEEANgIcIAAgFDYCFCAAQYycgIAANgIQIABBBzYCDEEAIRAMngELIABBADYCHCAAIBQ2AhQgAEH+kYCAADYCECAAQQc2AgxBACEQDJ0BCyAAQQA2AhwgACABNgIUIABBjpuAgAA2AhAgAEEGNgIMQQAhEAycAQsgEEEVRg1XIABBADYCHCAAIAE2AhQgAEHMjoCAADYCECAAQSA2AgxBACEQDJsBCyAAQQA2AgAgEEEBaiEBQSQhEAsgACAQOgApIAAoAgQhECAAQQA2AgQgACAQIAEQq4CAgAAiEA1UIAEhAQw+CyAAQQA2AgALQQAhECAAQQA2AhwgACAENgIUIABB8ZuAgAA2AhAgAEEGNgIMDJcBCyABQRVGDVAgAEEANgIcIAAgBTYCFCAAQfCMgIAANgIQIABBGzYCDEEAIRAMlgELIAAoAgQhBSAAQQA2AgQgACAFIBAQqYCAgAAiBQ0BIBBBAWohBQtBrQEhEAx7CyAAQcEBNgIcIAAgBTYCDCAAIBBBAWo2AhRBACEQDJMBCyAAKAIEIQYgAEEANgIEIAAgBiAQEKmAgIAAIgYNASAQQQFqIQYLQa4BIRAMeAsgAEHCATYCHCAAIAY2AgwgACAQQQFqNgIUQQAhEAyQAQsgAEEANgIcIAAgBzYCFCAAQZeLgIAANgIQIABBDTYCDEEAIRAMjwELIABBADYCHCAAIAg2AhQgAEHjkICAADYCECAAQQk2AgxBACEQDI4BCyAAQQA2AhwgACAINgIUIABBlI2AgAA2AhAgAEEhNgIMQQAhEAyNAQtBASEWQQAhF0EAIRRBASEQCyAAIBA6ACsgCUEBaiEIAkACQCAALQAtQRBxDQACQAJAAkAgAC0AKg4DAQACBAsgFkUNAwwCCyAUDQEMAgsgF0UNAQsgACgCBCEQIABBADYCBCAAIBAgCBCtgICAACIQRQ09IABByQE2AhwgACAINgIUIAAgEDYCDEEAIRAMjAELIAAoAgQhBCAAQQA2AgQgACAEIAgQrYCAgAAiBEUNdiAAQcoBNgIcIAAgCDYCFCAAIAQ2AgxBACEQDIsBCyAAKAIEIQQgAEEANgIEIAAgBCAJEK2AgIAAIgRFDXQgAEHLATYCHCAAIAk2AhQgACAENgIMQQAhEAyKAQsgACgCBCEEIABBADYCBCAAIAQgChCtgICAACIERQ1yIABBzQE2AhwgACAKNgIUIAAgBDYCDEEAIRAMiQELAkAgCy0AAEFQaiIQQf8BcUEKTw0AIAAgEDoAKiALQQFqIQpBtgEhEAxwCyAAKAIEIQQgAEEANgIEIAAgBCALEK2AgIAAIgRFDXAgAEHPATYCHCAAIAs2AhQgACAENgIMQQAhEAyIAQsgAEEANgIcIAAgBDYCFCAAQZCzgIAANgIQIABBCDYCDCAAQQA2AgBBACEQDIcBCyABQRVGDT8gAEEANgIcIAAgDDYCFCAAQcyOgIAANgIQIABBIDYCDEEAIRAMhgELIABBgQQ7ASggACgCBCEQIABCADcDACAAIBAgDEEBaiIMEKuAgIAAIhBFDTggAEHTATYCHCAAIAw2AhQgACAQNgIMQQAhEAyFAQsgAEEANgIAC0EAIRAgAEEANgIcIAAgBDYCFCAAQdibgIAANgIQIABBCDYCDAyDAQsgACgCBCEQIABCADcDACAAIBAgC0EBaiILEKuAgIAAIhANAUHGASEQDGkLIABBAjoAKAxVCyAAQdUBNgIcIAAgCzYCFCAAIBA2AgxBACEQDIABCyAQQRVGDTcgAEEANgIcIAAgBDYCFCAAQaSMgIAANgIQIABBEDYCDEEAIRAMfwsgAC0ANEEBRw00IAAgBCACELyAgIAAIhBFDTQgEEEVRw01IABB3AE2AhwgACAENgIUIABB1ZaAgAA2AhAgAEEVNgIMQQAhEAx+C0EAIRAgAEEANgIcIABBr4uAgAA2AhAgAEECNgIMIAAgFEEBajYCFAx9C0EAIRAMYwtBAiEQDGILQQ0hEAxhC0EPIRAMYAtBJSEQDF8LQRMhEAxeC0EVIRAMXQtBFiEQDFwLQRchEAxbC0EYIRAMWgtBGSEQDFkLQRohEAxYC0EbIRAMVwtBHCEQDFYLQR0hEAxVC0EfIRAMVAtBISEQDFMLQSMhEAxSC0HGACEQDFELQS4hEAxQC0EvIRAMTwtBOyEQDE4LQT0hEAxNC0HIACEQDEwLQckAIRAMSwtBywAhEAxKC0HMACEQDEkLQc4AIRAMSAtB0QAhEAxHC0HVACEQDEYLQdgAIRAMRQtB2QAhEAxEC0HbACEQDEMLQeQAIRAMQgtB5QAhEAxBC0HxACEQDEALQfQAIRAMPwtBjQEhEAw+C0GXASEQDD0LQakBIRAMPAtBrAEhEAw7C0HAASEQDDoLQbkBIRAMOQtBrwEhEAw4C0GxASEQDDcLQbIBIRAMNgtBtAEhEAw1C0G1ASEQDDQLQboBIRAMMwtBvQEhEAwyC0G/ASEQDDELQcEBIRAMMAsgAEEANgIcIAAgBDYCFCAAQemLgIAANgIQIABBHzYCDEEAIRAMSAsgAEHbATYCHCAAIAQ2AhQgAEH6loCAADYCECAAQRU2AgxBACEQDEcLIABB+AA2AhwgACAMNgIUIABBypiAgAA2AhAgAEEVNgIMQQAhEAxGCyAAQdEANgIcIAAgBTYCFCAAQbCXgIAANgIQIABBFTYCDEEAIRAMRQsgAEH5ADYCHCAAIAE2AhQgACAQNgIMQQAhEAxECyAAQfgANgIcIAAgATYCFCAAQcqYgIAANgIQIABBFTYCDEEAIRAMQwsgAEHkADYCHCAAIAE2AhQgAEHjl4CAADYCECAAQRU2AgxBACEQDEILIABB1wA2AhwgACABNgIUIABByZeAgAA2AhAgAEEVNgIMQQAhEAxBCyAAQQA2AhwgACABNgIUIABBuY2AgAA2AhAgAEEaNgIMQQAhEAxACyAAQcIANgIcIAAgATYCFCAAQeOYgIAANgIQIABBFTYCDEEAIRAMPwsgAEEANgIEIAAgDyAPELGAgIAAIgRFDQEgAEE6NgIcIAAgBDYCDCAAIA9BAWo2AhRBACEQDD4LIAAoAgQhBCAAQQA2AgQCQCAAIAQgARCxgICAACIERQ0AIABBOzYCHCAAIAQ2AgwgACABQQFqNgIUQQAhEAw+CyABQQFqIQEMLQsgD0EBaiEBDC0LIABBADYCHCAAIA82AhQgAEHkkoCAADYCECAAQQQ2AgxBACEQDDsLIABBNjYCHCAAIAQ2AhQgACACNgIMQQAhEAw6CyAAQS42AhwgACAONgIUIAAgBDYCDEEAIRAMOQsgAEHQADYCHCAAIAE2AhQgAEGRmICAADYCECAAQRU2AgxBACEQDDgLIA1BAWohAQwsCyAAQRU2AhwgACABNgIUIABBgpmAgAA2AhAgAEEVNgIMQQAhEAw2CyAAQRs2AhwgACABNgIUIABBkZeAgAA2AhAgAEEVNgIMQQAhEAw1CyAAQQ82AhwgACABNgIUIABBkZeAgAA2AhAgAEEVNgIMQQAhEAw0CyAAQQs2AhwgACABNgIUIABBkZeAgAA2AhAgAEEVNgIMQQAhEAwzCyAAQRo2AhwgACABNgIUIABBgpmAgAA2AhAgAEEVNgIMQQAhEAwyCyAAQQs2AhwgACABNgIUIABBgpmAgAA2AhAgAEEVNgIMQQAhEAwxCyAAQQo2AhwgACABNgIUIABB5JaAgAA2AhAgAEEVNgIMQQAhEAwwCyAAQR42AhwgACABNgIUIABB+ZeAgAA2AhAgAEEVNgIMQQAhEAwvCyAAQQA2AhwgACAQNgIUIABB2o2AgAA2AhAgAEEUNgIMQQAhEAwuCyAAQQQ2AhwgACABNgIUIABBsJiAgAA2AhAgAEEVNgIMQQAhEAwtCyAAQQA2AgAgC0EBaiELC0G4ASEQDBILIABBADYCACAQQQFqIQFB9QAhEAwRCyABIQECQCAALQApQQVHDQBB4wAhEAwRC0HiACEQDBALQQAhECAAQQA2AhwgAEHkkYCAADYCECAAQQc2AgwgACAUQQFqNgIUDCgLIABBADYCACAXQQFqIQFBwAAhEAwOC0EBIQELIAAgAToALCAAQQA2AgAgF0EBaiEBC0EoIRAMCwsgASEBC0E4IRAMCQsCQCABIg8gAkYNAANAAkAgDy0AAEGAvoCAAGotAAAiAUEBRg0AIAFBAkcNAyAPQQFqIQEMBAsgD0EBaiIPIAJHDQALQT4hEAwiC0E+IRAMIQsgAEEAOgAsIA8hAQwBC0ELIRAMBgtBOiEQDAULIAFBAWohAUEtIRAMBAsgACABOgAsIABBADYCACAWQQFqIQFBDCEQDAMLIABBADYCACAXQQFqIQFBCiEQDAILIABBADYCAAsgAEEAOgAsIA0hAUEJIRAMAAsLQQAhECAAQQA2AhwgACALNgIUIABBzZCAgAA2AhAgAEEJNgIMDBcLQQAhECAAQQA2AhwgACAKNgIUIABB6YqAgAA2AhAgAEEJNgIMDBYLQQAhECAAQQA2AhwgACAJNgIUIABBt5CAgAA2AhAgAEEJNgIMDBULQQAhECAAQQA2AhwgACAINgIUIABBnJGAgAA2AhAgAEEJNgIMDBQLQQAhECAAQQA2AhwgACABNgIUIABBzZCAgAA2AhAgAEEJNgIMDBMLQQAhECAAQQA2AhwgACABNgIUIABB6YqAgAA2AhAgAEEJNgIMDBILQQAhECAAQQA2AhwgACABNgIUIABBt5CAgAA2AhAgAEEJNgIMDBELQQAhECAAQQA2AhwgACABNgIUIABBnJGAgAA2AhAgAEEJNgIMDBALQQAhECAAQQA2AhwgACABNgIUIABBl5WAgAA2AhAgAEEPNgIMDA8LQQAhECAAQQA2AhwgACABNgIUIABBl5WAgAA2AhAgAEEPNgIMDA4LQQAhECAAQQA2AhwgACABNgIUIABBwJKAgAA2AhAgAEELNgIMDA0LQQAhECAAQQA2AhwgACABNgIUIABBlYmAgAA2AhAgAEELNgIMDAwLQQAhECAAQQA2AhwgACABNgIUIABB4Y+AgAA2AhAgAEEKNgIMDAsLQQAhECAAQQA2AhwgACABNgIUIABB+4+AgAA2AhAgAEEKNgIMDAoLQQAhECAAQQA2AhwgACABNgIUIABB8ZmAgAA2AhAgAEECNgIMDAkLQQAhECAAQQA2AhwgACABNgIUIABBxJSAgAA2AhAgAEECNgIMDAgLQQAhECAAQQA2AhwgACABNgIUIABB8pWAgAA2AhAgAEECNgIMDAcLIABBAjYCHCAAIAE2AhQgAEGcmoCAADYCECAAQRY2AgxBACEQDAYLQQEhEAwFC0HUACEQIAEiBCACRg0EIANBCGogACAEIAJB2MKAgABBChDFgICAACADKAIMIQQgAygCCA4DAQQCAAsQyoCAgAAACyAAQQA2AhwgAEG1moCAADYCECAAQRc2AgwgACAEQQFqNgIUQQAhEAwCCyAAQQA2AhwgACAENgIUIABBypqAgAA2AhAgAEEJNgIMQQAhEAwBCwJAIAEiBCACRw0AQSIhEAwBCyAAQYmAgIAANgIIIAAgBDYCBEEhIRALIANBEGokgICAgAAgEAuvAQECfyABKAIAIQYCQAJAIAIgA0YNACAEIAZqIQQgBiADaiACayEHIAIgBkF/cyAFaiIGaiEFA0ACQCACLQAAIAQtAABGDQBBAiEEDAMLAkAgBg0AQQAhBCAFIQIMAwsgBkF/aiEGIARBAWohBCACQQFqIgIgA0cNAAsgByEGIAMhAgsgAEEBNgIAIAEgBjYCACAAIAI2AgQPCyABQQA2AgAgACAENgIAIAAgAjYCBAsKACAAEMeAgIAAC/I2AQt/I4CAgIAAQRBrIgEkgICAgAACQEEAKAKg0ICAAA0AQQAQy4CAgABBgNSEgABrIgJB2QBJDQBBACEDAkBBACgC4NOAgAAiBA0AQQBCfzcC7NOAgABBAEKAgISAgIDAADcC5NOAgABBACABQQhqQXBxQdiq1aoFcyIENgLg04CAAEEAQQA2AvTTgIAAQQBBADYCxNOAgAALQQAgAjYCzNOAgABBAEGA1ISAADYCyNOAgABBAEGA1ISAADYCmNCAgABBACAENgKs0ICAAEEAQX82AqjQgIAAA0AgA0HE0ICAAGogA0G40ICAAGoiBDYCACAEIANBsNCAgABqIgU2AgAgA0G80ICAAGogBTYCACADQczQgIAAaiADQcDQgIAAaiIFNgIAIAUgBDYCACADQdTQgIAAaiADQcjQgIAAaiIENgIAIAQgBTYCACADQdDQgIAAaiAENgIAIANBIGoiA0GAAkcNAAtBgNSEgABBeEGA1ISAAGtBD3FBAEGA1ISAAEEIakEPcRsiA2oiBEEEaiACQUhqIgUgA2siA0EBcjYCAEEAQQAoAvDTgIAANgKk0ICAAEEAIAM2ApTQgIAAQQAgBDYCoNCAgABBgNSEgAAgBWpBODYCBAsCQAJAAkACQAJAAkACQAJAAkACQAJAAkAgAEHsAUsNAAJAQQAoAojQgIAAIgZBECAAQRNqQXBxIABBC0kbIgJBA3YiBHYiA0EDcUUNAAJAAkAgA0EBcSAEckEBcyIFQQN0IgRBsNCAgABqIgMgBEG40ICAAGooAgAiBCgCCCICRw0AQQAgBkF+IAV3cTYCiNCAgAAMAQsgAyACNgIIIAIgAzYCDAsgBEEIaiEDIAQgBUEDdCIFQQNyNgIEIAQgBWoiBCAEKAIEQQFyNgIEDAwLIAJBACgCkNCAgAAiB00NAQJAIANFDQACQAJAIAMgBHRBAiAEdCIDQQAgA2tycSIDQQAgA2txQX9qIgMgA0EMdkEQcSIDdiIEQQV2QQhxIgUgA3IgBCAFdiIDQQJ2QQRxIgRyIAMgBHYiA0EBdkECcSIEciADIAR2IgNBAXZBAXEiBHIgAyAEdmoiBEEDdCIDQbDQgIAAaiIFIANBuNCAgABqKAIAIgMoAggiAEcNAEEAIAZBfiAEd3EiBjYCiNCAgAAMAQsgBSAANgIIIAAgBTYCDAsgAyACQQNyNgIEIAMgBEEDdCIEaiAEIAJrIgU2AgAgAyACaiIAIAVBAXI2AgQCQCAHRQ0AIAdBeHFBsNCAgABqIQJBACgCnNCAgAAhBAJAAkAgBkEBIAdBA3Z0IghxDQBBACAGIAhyNgKI0ICAACACIQgMAQsgAigCCCEICyAIIAQ2AgwgAiAENgIIIAQgAjYCDCAEIAg2AggLIANBCGohA0EAIAA2ApzQgIAAQQAgBTYCkNCAgAAMDAtBACgCjNCAgAAiCUUNASAJQQAgCWtxQX9qIgMgA0EMdkEQcSIDdiIEQQV2QQhxIgUgA3IgBCAFdiIDQQJ2QQRxIgRyIAMgBHYiA0EBdkECcSIEciADIAR2IgNBAXZBAXEiBHIgAyAEdmpBAnRBuNKAgABqKAIAIgAoAgRBeHEgAmshBCAAIQUCQANAAkAgBSgCECIDDQAgBUEUaigCACIDRQ0CCyADKAIEQXhxIAJrIgUgBCAFIARJIgUbIQQgAyAAIAUbIQAgAyEFDAALCyAAKAIYIQoCQCAAKAIMIgggAEYNACAAKAIIIgNBACgCmNCAgABJGiAIIAM2AgggAyAINgIMDAsLAkAgAEEUaiIFKAIAIgMNACAAKAIQIgNFDQMgAEEQaiEFCwNAIAUhCyADIghBFGoiBSgCACIDDQAgCEEQaiEFIAgoAhAiAw0ACyALQQA2AgAMCgtBfyECIABBv39LDQAgAEETaiIDQXBxIQJBACgCjNCAgAAiB0UNAEEAIQsCQCACQYACSQ0AQR8hCyACQf///wdLDQAgA0EIdiIDIANBgP4/akEQdkEIcSIDdCIEIARBgOAfakEQdkEEcSIEdCIFIAVBgIAPakEQdkECcSIFdEEPdiADIARyIAVyayIDQQF0IAIgA0EVanZBAXFyQRxqIQsLQQAgAmshBAJAAkACQAJAIAtBAnRBuNKAgABqKAIAIgUNAEEAIQNBACEIDAELQQAhAyACQQBBGSALQQF2ayALQR9GG3QhAEEAIQgDQAJAIAUoAgRBeHEgAmsiBiAETw0AIAYhBCAFIQggBg0AQQAhBCAFIQggBSEDDAMLIAMgBUEUaigCACIGIAYgBSAAQR12QQRxakEQaigCACIFRhsgAyAGGyEDIABBAXQhACAFDQALCwJAIAMgCHINAEEAIQhBAiALdCIDQQAgA2tyIAdxIgNFDQMgA0EAIANrcUF/aiIDIANBDHZBEHEiA3YiBUEFdkEIcSIAIANyIAUgAHYiA0ECdkEEcSIFciADIAV2IgNBAXZBAnEiBXIgAyAFdiIDQQF2QQFxIgVyIAMgBXZqQQJ0QbjSgIAAaigCACEDCyADRQ0BCwNAIAMoAgRBeHEgAmsiBiAESSEAAkAgAygCECIFDQAgA0EUaigCACEFCyAGIAQgABshBCADIAggABshCCAFIQMgBQ0ACwsgCEUNACAEQQAoApDQgIAAIAJrTw0AIAgoAhghCwJAIAgoAgwiACAIRg0AIAgoAggiA0EAKAKY0ICAAEkaIAAgAzYCCCADIAA2AgwMCQsCQCAIQRRqIgUoAgAiAw0AIAgoAhAiA0UNAyAIQRBqIQULA0AgBSEGIAMiAEEUaiIFKAIAIgMNACAAQRBqIQUgACgCECIDDQALIAZBADYCAAwICwJAQQAoApDQgIAAIgMgAkkNAEEAKAKc0ICAACEEAkACQCADIAJrIgVBEEkNACAEIAJqIgAgBUEBcjYCBEEAIAU2ApDQgIAAQQAgADYCnNCAgAAgBCADaiAFNgIAIAQgAkEDcjYCBAwBCyAEIANBA3I2AgQgBCADaiIDIAMoAgRBAXI2AgRBAEEANgKc0ICAAEEAQQA2ApDQgIAACyAEQQhqIQMMCgsCQEEAKAKU0ICAACIAIAJNDQBBACgCoNCAgAAiAyACaiIEIAAgAmsiBUEBcjYCBEEAIAU2ApTQgIAAQQAgBDYCoNCAgAAgAyACQQNyNgIEIANBCGohAwwKCwJAAkBBACgC4NOAgABFDQBBACgC6NOAgAAhBAwBC0EAQn83AuzTgIAAQQBCgICEgICAwAA3AuTTgIAAQQAgAUEMakFwcUHYqtWqBXM2AuDTgIAAQQBBADYC9NOAgABBAEEANgLE04CAAEGAgAQhBAtBACEDAkAgBCACQccAaiIHaiIGQQAgBGsiC3EiCCACSw0AQQBBMDYC+NOAgAAMCgsCQEEAKALA04CAACIDRQ0AAkBBACgCuNOAgAAiBCAIaiIFIARNDQAgBSADTQ0BC0EAIQNBAEEwNgL404CAAAwKC0EALQDE04CAAEEEcQ0EAkACQAJAQQAoAqDQgIAAIgRFDQBByNOAgAAhAwNAAkAgAygCACIFIARLDQAgBSADKAIEaiAESw0DCyADKAIIIgMNAAsLQQAQy4CAgAAiAEF/Rg0FIAghBgJAQQAoAuTTgIAAIgNBf2oiBCAAcUUNACAIIABrIAQgAGpBACADa3FqIQYLIAYgAk0NBSAGQf7///8HSw0FAkBBACgCwNOAgAAiA0UNAEEAKAK404CAACIEIAZqIgUgBE0NBiAFIANLDQYLIAYQy4CAgAAiAyAARw0BDAcLIAYgAGsgC3EiBkH+////B0sNBCAGEMuAgIAAIgAgAygCACADKAIEakYNAyAAIQMLAkAgA0F/Rg0AIAJByABqIAZNDQACQCAHIAZrQQAoAujTgIAAIgRqQQAgBGtxIgRB/v///wdNDQAgAyEADAcLAkAgBBDLgICAAEF/Rg0AIAQgBmohBiADIQAMBwtBACAGaxDLgICAABoMBAsgAyEAIANBf0cNBQwDC0EAIQgMBwtBACEADAULIABBf0cNAgtBAEEAKALE04CAAEEEcjYCxNOAgAALIAhB/v///wdLDQEgCBDLgICAACEAQQAQy4CAgAAhAyAAQX9GDQEgA0F/Rg0BIAAgA08NASADIABrIgYgAkE4ak0NAQtBAEEAKAK404CAACAGaiIDNgK404CAAAJAIANBACgCvNOAgABNDQBBACADNgK804CAAAsCQAJAAkACQEEAKAKg0ICAACIERQ0AQcjTgIAAIQMDQCAAIAMoAgAiBSADKAIEIghqRg0CIAMoAggiAw0ADAMLCwJAAkBBACgCmNCAgAAiA0UNACAAIANPDQELQQAgADYCmNCAgAALQQAhA0EAIAY2AszTgIAAQQAgADYCyNOAgABBAEF/NgKo0ICAAEEAQQAoAuDTgIAANgKs0ICAAEEAQQA2AtTTgIAAA0AgA0HE0ICAAGogA0G40ICAAGoiBDYCACAEIANBsNCAgABqIgU2AgAgA0G80ICAAGogBTYCACADQczQgIAAaiADQcDQgIAAaiIFNgIAIAUgBDYCACADQdTQgIAAaiADQcjQgIAAaiIENgIAIAQgBTYCACADQdDQgIAAaiAENgIAIANBIGoiA0GAAkcNAAsgAEF4IABrQQ9xQQAgAEEIakEPcRsiA2oiBCAGQUhqIgUgA2siA0EBcjYCBEEAQQAoAvDTgIAANgKk0ICAAEEAIAM2ApTQgIAAQQAgBDYCoNCAgAAgACAFakE4NgIEDAILIAMtAAxBCHENACAEIAVJDQAgBCAATw0AIARBeCAEa0EPcUEAIARBCGpBD3EbIgVqIgBBACgClNCAgAAgBmoiCyAFayIFQQFyNgIEIAMgCCAGajYCBEEAQQAoAvDTgIAANgKk0ICAAEEAIAU2ApTQgIAAQQAgADYCoNCAgAAgBCALakE4NgIEDAELAkAgAEEAKAKY0ICAACIITw0AQQAgADYCmNCAgAAgACEICyAAIAZqIQVByNOAgAAhAwJAAkACQAJAAkACQAJAA0AgAygCACAFRg0BIAMoAggiAw0ADAILCyADLQAMQQhxRQ0BC0HI04CAACEDA0ACQCADKAIAIgUgBEsNACAFIAMoAgRqIgUgBEsNAwsgAygCCCEDDAALCyADIAA2AgAgAyADKAIEIAZqNgIEIABBeCAAa0EPcUEAIABBCGpBD3EbaiILIAJBA3I2AgQgBUF4IAVrQQ9xQQAgBUEIakEPcRtqIgYgCyACaiICayEDAkAgBiAERw0AQQAgAjYCoNCAgABBAEEAKAKU0ICAACADaiIDNgKU0ICAACACIANBAXI2AgQMAwsCQCAGQQAoApzQgIAARw0AQQAgAjYCnNCAgABBAEEAKAKQ0ICAACADaiIDNgKQ0ICAACACIANBAXI2AgQgAiADaiADNgIADAMLAkAgBigCBCIEQQNxQQFHDQAgBEF4cSEHAkACQCAEQf8BSw0AIAYoAggiBSAEQQN2IghBA3RBsNCAgABqIgBGGgJAIAYoAgwiBCAFRw0AQQBBACgCiNCAgABBfiAId3E2AojQgIAADAILIAQgAEYaIAQgBTYCCCAFIAQ2AgwMAQsgBigCGCEJAkACQCAGKAIMIgAgBkYNACAGKAIIIgQgCEkaIAAgBDYCCCAEIAA2AgwMAQsCQCAGQRRqIgQoAgAiBQ0AIAZBEGoiBCgCACIFDQBBACEADAELA0AgBCEIIAUiAEEUaiIEKAIAIgUNACAAQRBqIQQgACgCECIFDQALIAhBADYCAAsgCUUNAAJAAkAgBiAGKAIcIgVBAnRBuNKAgABqIgQoAgBHDQAgBCAANgIAIAANAUEAQQAoAozQgIAAQX4gBXdxNgKM0ICAAAwCCyAJQRBBFCAJKAIQIAZGG2ogADYCACAARQ0BCyAAIAk2AhgCQCAGKAIQIgRFDQAgACAENgIQIAQgADYCGAsgBigCFCIERQ0AIABBFGogBDYCACAEIAA2AhgLIAcgA2ohAyAGIAdqIgYoAgQhBAsgBiAEQX5xNgIEIAIgA2ogAzYCACACIANBAXI2AgQCQCADQf8BSw0AIANBeHFBsNCAgABqIQQCQAJAQQAoAojQgIAAIgVBASADQQN2dCIDcQ0AQQAgBSADcjYCiNCAgAAgBCEDDAELIAQoAgghAwsgAyACNgIMIAQgAjYCCCACIAQ2AgwgAiADNgIIDAMLQR8hBAJAIANB////B0sNACADQQh2IgQgBEGA/j9qQRB2QQhxIgR0IgUgBUGA4B9qQRB2QQRxIgV0IgAgAEGAgA9qQRB2QQJxIgB0QQ92IAQgBXIgAHJrIgRBAXQgAyAEQRVqdkEBcXJBHGohBAsgAiAENgIcIAJCADcCECAEQQJ0QbjSgIAAaiEFAkBBACgCjNCAgAAiAEEBIAR0IghxDQAgBSACNgIAQQAgACAIcjYCjNCAgAAgAiAFNgIYIAIgAjYCCCACIAI2AgwMAwsgA0EAQRkgBEEBdmsgBEEfRht0IQQgBSgCACEAA0AgACIFKAIEQXhxIANGDQIgBEEddiEAIARBAXQhBCAFIABBBHFqQRBqIggoAgAiAA0ACyAIIAI2AgAgAiAFNgIYIAIgAjYCDCACIAI2AggMAgsgAEF4IABrQQ9xQQAgAEEIakEPcRsiA2oiCyAGQUhqIgggA2siA0EBcjYCBCAAIAhqQTg2AgQgBCAFQTcgBWtBD3FBACAFQUlqQQ9xG2pBQWoiCCAIIARBEGpJGyIIQSM2AgRBAEEAKALw04CAADYCpNCAgABBACADNgKU0ICAAEEAIAs2AqDQgIAAIAhBEGpBACkC0NOAgAA3AgAgCEEAKQLI04CAADcCCEEAIAhBCGo2AtDTgIAAQQAgBjYCzNOAgABBACAANgLI04CAAEEAQQA2AtTTgIAAIAhBJGohAwNAIANBBzYCACADQQRqIgMgBUkNAAsgCCAERg0DIAggCCgCBEF+cTYCBCAIIAggBGsiADYCACAEIABBAXI2AgQCQCAAQf8BSw0AIABBeHFBsNCAgABqIQMCQAJAQQAoAojQgIAAIgVBASAAQQN2dCIAcQ0AQQAgBSAAcjYCiNCAgAAgAyEFDAELIAMoAgghBQsgBSAENgIMIAMgBDYCCCAEIAM2AgwgBCAFNgIIDAQLQR8hAwJAIABB////B0sNACAAQQh2IgMgA0GA/j9qQRB2QQhxIgN0IgUgBUGA4B9qQRB2QQRxIgV0IgggCEGAgA9qQRB2QQJxIgh0QQ92IAMgBXIgCHJrIgNBAXQgACADQRVqdkEBcXJBHGohAwsgBCADNgIcIARCADcCECADQQJ0QbjSgIAAaiEFAkBBACgCjNCAgAAiCEEBIAN0IgZxDQAgBSAENgIAQQAgCCAGcjYCjNCAgAAgBCAFNgIYIAQgBDYCCCAEIAQ2AgwMBAsgAEEAQRkgA0EBdmsgA0EfRht0IQMgBSgCACEIA0AgCCIFKAIEQXhxIABGDQMgA0EddiEIIANBAXQhAyAFIAhBBHFqQRBqIgYoAgAiCA0ACyAGIAQ2AgAgBCAFNgIYIAQgBDYCDCAEIAQ2AggMAwsgBSgCCCIDIAI2AgwgBSACNgIIIAJBADYCGCACIAU2AgwgAiADNgIICyALQQhqIQMMBQsgBSgCCCIDIAQ2AgwgBSAENgIIIARBADYCGCAEIAU2AgwgBCADNgIIC0EAKAKU0ICAACIDIAJNDQBBACgCoNCAgAAiBCACaiIFIAMgAmsiA0EBcjYCBEEAIAM2ApTQgIAAQQAgBTYCoNCAgAAgBCACQQNyNgIEIARBCGohAwwDC0EAIQNBAEEwNgL404CAAAwCCwJAIAtFDQACQAJAIAggCCgCHCIFQQJ0QbjSgIAAaiIDKAIARw0AIAMgADYCACAADQFBACAHQX4gBXdxIgc2AozQgIAADAILIAtBEEEUIAsoAhAgCEYbaiAANgIAIABFDQELIAAgCzYCGAJAIAgoAhAiA0UNACAAIAM2AhAgAyAANgIYCyAIQRRqKAIAIgNFDQAgAEEUaiADNgIAIAMgADYCGAsCQAJAIARBD0sNACAIIAQgAmoiA0EDcjYCBCAIIANqIgMgAygCBEEBcjYCBAwBCyAIIAJqIgAgBEEBcjYCBCAIIAJBA3I2AgQgACAEaiAENgIAAkAgBEH/AUsNACAEQXhxQbDQgIAAaiEDAkACQEEAKAKI0ICAACIFQQEgBEEDdnQiBHENAEEAIAUgBHI2AojQgIAAIAMhBAwBCyADKAIIIQQLIAQgADYCDCADIAA2AgggACADNgIMIAAgBDYCCAwBC0EfIQMCQCAEQf///wdLDQAgBEEIdiIDIANBgP4/akEQdkEIcSIDdCIFIAVBgOAfakEQdkEEcSIFdCICIAJBgIAPakEQdkECcSICdEEPdiADIAVyIAJyayIDQQF0IAQgA0EVanZBAXFyQRxqIQMLIAAgAzYCHCAAQgA3AhAgA0ECdEG40oCAAGohBQJAIAdBASADdCICcQ0AIAUgADYCAEEAIAcgAnI2AozQgIAAIAAgBTYCGCAAIAA2AgggACAANgIMDAELIARBAEEZIANBAXZrIANBH0YbdCEDIAUoAgAhAgJAA0AgAiIFKAIEQXhxIARGDQEgA0EddiECIANBAXQhAyAFIAJBBHFqQRBqIgYoAgAiAg0ACyAGIAA2AgAgACAFNgIYIAAgADYCDCAAIAA2AggMAQsgBSgCCCIDIAA2AgwgBSAANgIIIABBADYCGCAAIAU2AgwgACADNgIICyAIQQhqIQMMAQsCQCAKRQ0AAkACQCAAIAAoAhwiBUECdEG40oCAAGoiAygCAEcNACADIAg2AgAgCA0BQQAgCUF+IAV3cTYCjNCAgAAMAgsgCkEQQRQgCigCECAARhtqIAg2AgAgCEUNAQsgCCAKNgIYAkAgACgCECIDRQ0AIAggAzYCECADIAg2AhgLIABBFGooAgAiA0UNACAIQRRqIAM2AgAgAyAINgIYCwJAAkAgBEEPSw0AIAAgBCACaiIDQQNyNgIEIAAgA2oiAyADKAIEQQFyNgIEDAELIAAgAmoiBSAEQQFyNgIEIAAgAkEDcjYCBCAFIARqIAQ2AgACQCAHRQ0AIAdBeHFBsNCAgABqIQJBACgCnNCAgAAhAwJAAkBBASAHQQN2dCIIIAZxDQBBACAIIAZyNgKI0ICAACACIQgMAQsgAigCCCEICyAIIAM2AgwgAiADNgIIIAMgAjYCDCADIAg2AggLQQAgBTYCnNCAgABBACAENgKQ0ICAAAsgAEEIaiEDCyABQRBqJICAgIAAIAMLCgAgABDJgICAAAviDQEHfwJAIABFDQAgAEF4aiIBIABBfGooAgAiAkF4cSIAaiEDAkAgAkEBcQ0AIAJBA3FFDQEgASABKAIAIgJrIgFBACgCmNCAgAAiBEkNASACIABqIQACQCABQQAoApzQgIAARg0AAkAgAkH/AUsNACABKAIIIgQgAkEDdiIFQQN0QbDQgIAAaiIGRhoCQCABKAIMIgIgBEcNAEEAQQAoAojQgIAAQX4gBXdxNgKI0ICAAAwDCyACIAZGGiACIAQ2AgggBCACNgIMDAILIAEoAhghBwJAAkAgASgCDCIGIAFGDQAgASgCCCICIARJGiAGIAI2AgggAiAGNgIMDAELAkAgAUEUaiICKAIAIgQNACABQRBqIgIoAgAiBA0AQQAhBgwBCwNAIAIhBSAEIgZBFGoiAigCACIEDQAgBkEQaiECIAYoAhAiBA0ACyAFQQA2AgALIAdFDQECQAJAIAEgASgCHCIEQQJ0QbjSgIAAaiICKAIARw0AIAIgBjYCACAGDQFBAEEAKAKM0ICAAEF+IAR3cTYCjNCAgAAMAwsgB0EQQRQgBygCECABRhtqIAY2AgAgBkUNAgsgBiAHNgIYAkAgASgCECICRQ0AIAYgAjYCECACIAY2AhgLIAEoAhQiAkUNASAGQRRqIAI2AgAgAiAGNgIYDAELIAMoAgQiAkEDcUEDRw0AIAMgAkF+cTYCBEEAIAA2ApDQgIAAIAEgAGogADYCACABIABBAXI2AgQPCyABIANPDQAgAygCBCICQQFxRQ0AAkACQCACQQJxDQACQCADQQAoAqDQgIAARw0AQQAgATYCoNCAgABBAEEAKAKU0ICAACAAaiIANgKU0ICAACABIABBAXI2AgQgAUEAKAKc0ICAAEcNA0EAQQA2ApDQgIAAQQBBADYCnNCAgAAPCwJAIANBACgCnNCAgABHDQBBACABNgKc0ICAAEEAQQAoApDQgIAAIABqIgA2ApDQgIAAIAEgAEEBcjYCBCABIABqIAA2AgAPCyACQXhxIABqIQACQAJAIAJB/wFLDQAgAygCCCIEIAJBA3YiBUEDdEGw0ICAAGoiBkYaAkAgAygCDCICIARHDQBBAEEAKAKI0ICAAEF+IAV3cTYCiNCAgAAMAgsgAiAGRhogAiAENgIIIAQgAjYCDAwBCyADKAIYIQcCQAJAIAMoAgwiBiADRg0AIAMoAggiAkEAKAKY0ICAAEkaIAYgAjYCCCACIAY2AgwMAQsCQCADQRRqIgIoAgAiBA0AIANBEGoiAigCACIEDQBBACEGDAELA0AgAiEFIAQiBkEUaiICKAIAIgQNACAGQRBqIQIgBigCECIEDQALIAVBADYCAAsgB0UNAAJAAkAgAyADKAIcIgRBAnRBuNKAgABqIgIoAgBHDQAgAiAGNgIAIAYNAUEAQQAoAozQgIAAQX4gBHdxNgKM0ICAAAwCCyAHQRBBFCAHKAIQIANGG2ogBjYCACAGRQ0BCyAGIAc2AhgCQCADKAIQIgJFDQAgBiACNgIQIAIgBjYCGAsgAygCFCICRQ0AIAZBFGogAjYCACACIAY2AhgLIAEgAGogADYCACABIABBAXI2AgQgAUEAKAKc0ICAAEcNAUEAIAA2ApDQgIAADwsgAyACQX5xNgIEIAEgAGogADYCACABIABBAXI2AgQLAkAgAEH/AUsNACAAQXhxQbDQgIAAaiECAkACQEEAKAKI0ICAACIEQQEgAEEDdnQiAHENAEEAIAQgAHI2AojQgIAAIAIhAAwBCyACKAIIIQALIAAgATYCDCACIAE2AgggASACNgIMIAEgADYCCA8LQR8hAgJAIABB////B0sNACAAQQh2IgIgAkGA/j9qQRB2QQhxIgJ0IgQgBEGA4B9qQRB2QQRxIgR0IgYgBkGAgA9qQRB2QQJxIgZ0QQ92IAIgBHIgBnJrIgJBAXQgACACQRVqdkEBcXJBHGohAgsgASACNgIcIAFCADcCECACQQJ0QbjSgIAAaiEEAkACQEEAKAKM0ICAACIGQQEgAnQiA3ENACAEIAE2AgBBACAGIANyNgKM0ICAACABIAQ2AhggASABNgIIIAEgATYCDAwBCyAAQQBBGSACQQF2ayACQR9GG3QhAiAEKAIAIQYCQANAIAYiBCgCBEF4cSAARg0BIAJBHXYhBiACQQF0IQIgBCAGQQRxakEQaiIDKAIAIgYNAAsgAyABNgIAIAEgBDYCGCABIAE2AgwgASABNgIIDAELIAQoAggiACABNgIMIAQgATYCCCABQQA2AhggASAENgIMIAEgADYCCAtBAEEAKAKo0ICAAEF/aiIBQX8gARs2AqjQgIAACwsEAAAAC04AAkAgAA0APwBBEHQPCwJAIABB//8DcQ0AIABBf0wNAAJAIABBEHZAACIAQX9HDQBBAEEwNgL404CAAEF/DwsgAEEQdA8LEMqAgIAAAAvyAgIDfwF+AkAgAkUNACAAIAE6AAAgAiAAaiIDQX9qIAE6AAAgAkEDSQ0AIAAgAToAAiAAIAE6AAEgA0F9aiABOgAAIANBfmogAToAACACQQdJDQAgACABOgADIANBfGogAToAACACQQlJDQAgAEEAIABrQQNxIgRqIgMgAUH/AXFBgYKECGwiATYCACADIAIgBGtBfHEiBGoiAkF8aiABNgIAIARBCUkNACADIAE2AgggAyABNgIEIAJBeGogATYCACACQXRqIAE2AgAgBEEZSQ0AIAMgATYCGCADIAE2AhQgAyABNgIQIAMgATYCDCACQXBqIAE2AgAgAkFsaiABNgIAIAJBaGogATYCACACQWRqIAE2AgAgBCADQQRxQRhyIgVrIgJBIEkNACABrUKBgICAEH4hBiADIAVqIQEDQCABIAY3AxggASAGNwMQIAEgBjcDCCABIAY3AwAgAUEgaiEBIAJBYGoiAkEfSw0ACwsgAAsLjkgBAEGACAuGSAEAAAACAAAAAwAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAYAAAAHAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASW52YWxpZCBjaGFyIGluIHVybCBxdWVyeQBTcGFuIGNhbGxiYWNrIGVycm9yIGluIG9uX2JvZHkAQ29udGVudC1MZW5ndGggb3ZlcmZsb3cAQ2h1bmsgc2l6ZSBvdmVyZmxvdwBSZXNwb25zZSBvdmVyZmxvdwBJbnZhbGlkIG1ldGhvZCBmb3IgSFRUUC94LnggcmVxdWVzdABJbnZhbGlkIG1ldGhvZCBmb3IgUlRTUC94LnggcmVxdWVzdABFeHBlY3RlZCBTT1VSQ0UgbWV0aG9kIGZvciBJQ0UveC54IHJlcXVlc3QASW52YWxpZCBjaGFyIGluIHVybCBmcmFnbWVudCBzdGFydABFeHBlY3RlZCBkb3QAU3BhbiBjYWxsYmFjayBlcnJvciBpbiBvbl9zdGF0dXMASW52YWxpZCByZXNwb25zZSBzdGF0dXMASW52YWxpZCBjaGFyYWN0ZXIgaW4gY2h1bmsgZXh0ZW5zaW9ucwBVc2VyIGNhbGxiYWNrIGVycm9yAGBvbl9yZXNldGAgY2FsbGJhY2sgZXJyb3IAYG9uX2NodW5rX2hlYWRlcmAgY2FsbGJhY2sgZXJyb3IAYG9uX21lc3NhZ2VfYmVnaW5gIGNhbGxiYWNrIGVycm9yAGBvbl9jaHVua19leHRlbnNpb25fdmFsdWVgIGNhbGxiYWNrIGVycm9yAGBvbl9zdGF0dXNfY29tcGxldGVgIGNhbGxiYWNrIGVycm9yAGBvbl92ZXJzaW9uX2NvbXBsZXRlYCBjYWxsYmFjayBlcnJvcgBgb25fdXJsX2NvbXBsZXRlYCBjYWxsYmFjayBlcnJvcgBgb25fY2h1bmtfY29tcGxldGVgIGNhbGxiYWNrIGVycm9yAGBvbl9oZWFkZXJfdmFsdWVfY29tcGxldGVgIGNhbGxiYWNrIGVycm9yAGBvbl9tZXNzYWdlX2NvbXBsZXRlYCBjYWxsYmFjayBlcnJvcgBgb25fbWV0aG9kX2NvbXBsZXRlYCBjYWxsYmFjayBlcnJvcgBgb25faGVhZGVyX2ZpZWxkX2NvbXBsZXRlYCBjYWxsYmFjayBlcnJvcgBgb25fY2h1bmtfZXh0ZW5zaW9uX25hbWVgIGNhbGxiYWNrIGVycm9yAFVuZXhwZWN0ZWQgY2hhciBpbiB1cmwgc2VydmVyAEludmFsaWQgaGVhZGVyIHZhbHVlIGNoYXIASW52YWxpZCBoZWFkZXIgZmllbGQgY2hhcgBTcGFuIGNhbGxiYWNrIGVycm9yIGluIG9uX3ZlcnNpb24ASW52YWxpZCBtaW5vciB2ZXJzaW9uAEludmFsaWQgbWFqb3IgdmVyc2lvbgBFeHBlY3RlZCBzcGFjZSBhZnRlciB2ZXJzaW9uAEV4cGVjdGVkIENSTEYgYWZ0ZXIgdmVyc2lvbgBJbnZhbGlkIEhUVFAgdmVyc2lvbgBJbnZhbGlkIGhlYWRlciB0b2tlbgBTcGFuIGNhbGxiYWNrIGVycm9yIGluIG9uX3VybABJbnZhbGlkIGNoYXJhY3RlcnMgaW4gdXJsAFVuZXhwZWN0ZWQgc3RhcnQgY2hhciBpbiB1cmwARG91YmxlIEAgaW4gdXJsAEVtcHR5IENvbnRlbnQtTGVuZ3RoAEludmFsaWQgY2hhcmFjdGVyIGluIENvbnRlbnQtTGVuZ3RoAER1cGxpY2F0ZSBDb250ZW50LUxlbmd0aABJbnZhbGlkIGNoYXIgaW4gdXJsIHBhdGgAQ29udGVudC1MZW5ndGggY2FuJ3QgYmUgcHJlc2VudCB3aXRoIFRyYW5zZmVyLUVuY29kaW5nAEludmFsaWQgY2hhcmFjdGVyIGluIGNodW5rIHNpemUAU3BhbiBjYWxsYmFjayBlcnJvciBpbiBvbl9oZWFkZXJfdmFsdWUAU3BhbiBjYWxsYmFjayBlcnJvciBpbiBvbl9jaHVua19leHRlbnNpb25fdmFsdWUASW52YWxpZCBjaGFyYWN0ZXIgaW4gY2h1bmsgZXh0ZW5zaW9ucyB2YWx1ZQBNaXNzaW5nIGV4cGVjdGVkIExGIGFmdGVyIGhlYWRlciB2YWx1ZQBJbnZhbGlkIGBUcmFuc2Zlci1FbmNvZGluZ2AgaGVhZGVyIHZhbHVlAEludmFsaWQgY2hhcmFjdGVyIGluIGNodW5rIGV4dGVuc2lvbnMgcXVvdGUgdmFsdWUASW52YWxpZCBjaGFyYWN0ZXIgaW4gY2h1bmsgZXh0ZW5zaW9ucyBxdW90ZWQgdmFsdWUAUGF1c2VkIGJ5IG9uX2hlYWRlcnNfY29tcGxldGUASW52YWxpZCBFT0Ygc3RhdGUAb25fcmVzZXQgcGF1c2UAb25fY2h1bmtfaGVhZGVyIHBhdXNlAG9uX21lc3NhZ2VfYmVnaW4gcGF1c2UAb25fY2h1bmtfZXh0ZW5zaW9uX3ZhbHVlIHBhdXNlAG9uX3N0YXR1c19jb21wbGV0ZSBwYXVzZQBvbl92ZXJzaW9uX2NvbXBsZXRlIHBhdXNlAG9uX3VybF9jb21wbGV0ZSBwYXVzZQBvbl9jaHVua19jb21wbGV0ZSBwYXVzZQBvbl9oZWFkZXJfdmFsdWVfY29tcGxldGUgcGF1c2UAb25fbWVzc2FnZV9jb21wbGV0ZSBwYXVzZQBvbl9tZXRob2RfY29tcGxldGUgcGF1c2UAb25faGVhZGVyX2ZpZWxkX2NvbXBsZXRlIHBhdXNlAG9uX2NodW5rX2V4dGVuc2lvbl9uYW1lIHBhdXNlAFVuZXhwZWN0ZWQgc3BhY2UgYWZ0ZXIgc3RhcnQgbGluZQBTcGFuIGNhbGxiYWNrIGVycm9yIGluIG9uX2NodW5rX2V4dGVuc2lvbl9uYW1lAEludmFsaWQgY2hhcmFjdGVyIGluIGNodW5rIGV4dGVuc2lvbnMgbmFtZQBQYXVzZSBvbiBDT05ORUNUL1VwZ3JhZGUAUGF1c2Ugb24gUFJJL1VwZ3JhZGUARXhwZWN0ZWQgSFRUUC8yIENvbm5lY3Rpb24gUHJlZmFjZQBTcGFuIGNhbGxiYWNrIGVycm9yIGluIG9uX21ldGhvZABFeHBlY3RlZCBzcGFjZSBhZnRlciBtZXRob2QAU3BhbiBjYWxsYmFjayBlcnJvciBpbiBvbl9oZWFkZXJfZmllbGQAUGF1c2VkAEludmFsaWQgd29yZCBlbmNvdW50ZXJlZABJbnZhbGlkIG1ldGhvZCBlbmNvdW50ZXJlZABVbmV4cGVjdGVkIGNoYXIgaW4gdXJsIHNjaGVtYQBSZXF1ZXN0IGhhcyBpbnZhbGlkIGBUcmFuc2Zlci1FbmNvZGluZ2AAU1dJVENIX1BST1hZAFVTRV9QUk9YWQBNS0FDVElWSVRZAFVOUFJPQ0VTU0FCTEVfRU5USVRZAENPUFkATU9WRURfUEVSTUFORU5UTFkAVE9PX0VBUkxZAE5PVElGWQBGQUlMRURfREVQRU5ERU5DWQBCQURfR0FURVdBWQBQTEFZAFBVVABDSEVDS09VVABHQVRFV0FZX1RJTUVPVVQAUkVRVUVTVF9USU1FT1VUAE5FVFdPUktfQ09OTkVDVF9USU1FT1VUAENPTk5FQ1RJT05fVElNRU9VVABMT0dJTl9USU1FT1VUAE5FVFdPUktfUkVBRF9USU1FT1VUAFBPU1QATUlTRElSRUNURURfUkVRVUVTVABDTElFTlRfQ0xPU0VEX1JFUVVFU1QAQ0xJRU5UX0NMT1NFRF9MT0FEX0JBTEFOQ0VEX1JFUVVFU1QAQkFEX1JFUVVFU1QASFRUUF9SRVFVRVNUX1NFTlRfVE9fSFRUUFNfUE9SVABSRVBPUlQASU1fQV9URUFQT1QAUkVTRVRfQ09OVEVOVABOT19DT05URU5UAFBBUlRJQUxfQ09OVEVOVABIUEVfSU5WQUxJRF9DT05TVEFOVABIUEVfQ0JfUkVTRVQAR0VUAEhQRV9TVFJJQ1QAQ09ORkxJQ1QAVEVNUE9SQVJZX1JFRElSRUNUAFBFUk1BTkVOVF9SRURJUkVDVABDT05ORUNUAE1VTFRJX1NUQVRVUwBIUEVfSU5WQUxJRF9TVEFUVVMAVE9PX01BTllfUkVRVUVTVFMARUFSTFlfSElOVFMAVU5BVkFJTEFCTEVfRk9SX0xFR0FMX1JFQVNPTlMAT1BUSU9OUwBTV0lUQ0hJTkdfUFJPVE9DT0xTAFZBUklBTlRfQUxTT19ORUdPVElBVEVTAE1VTFRJUExFX0NIT0lDRVMASU5URVJOQUxfU0VSVkVSX0VSUk9SAFdFQl9TRVJWRVJfVU5LTk9XTl9FUlJPUgBSQUlMR1VOX0VSUk9SAElERU5USVRZX1BST1ZJREVSX0FVVEhFTlRJQ0FUSU9OX0VSUk9SAFNTTF9DRVJUSUZJQ0FURV9FUlJPUgBJTlZBTElEX1hfRk9SV0FSREVEX0ZPUgBTRVRfUEFSQU1FVEVSAEdFVF9QQVJBTUVURVIASFBFX1VTRVIAU0VFX09USEVSAEhQRV9DQl9DSFVOS19IRUFERVIATUtDQUxFTkRBUgBTRVRVUABXRUJfU0VSVkVSX0lTX0RPV04AVEVBUkRPV04ASFBFX0NMT1NFRF9DT05ORUNUSU9OAEhFVVJJU1RJQ19FWFBJUkFUSU9OAERJU0NPTk5FQ1RFRF9PUEVSQVRJT04ATk9OX0FVVEhPUklUQVRJVkVfSU5GT1JNQVRJT04ASFBFX0lOVkFMSURfVkVSU0lPTgBIUEVfQ0JfTUVTU0FHRV9CRUdJTgBTSVRFX0lTX0ZST1pFTgBIUEVfSU5WQUxJRF9IRUFERVJfVE9LRU4ASU5WQUxJRF9UT0tFTgBGT1JCSURERU4ARU5IQU5DRV9ZT1VSX0NBTE0ASFBFX0lOVkFMSURfVVJMAEJMT0NLRURfQllfUEFSRU5UQUxfQ09OVFJPTABNS0NPTABBQ0wASFBFX0lOVEVSTkFMAFJFUVVFU1RfSEVBREVSX0ZJRUxEU19UT09fTEFSR0VfVU5PRkZJQ0lBTABIUEVfT0sAVU5MSU5LAFVOTE9DSwBQUkkAUkVUUllfV0lUSABIUEVfSU5WQUxJRF9DT05URU5UX0xFTkdUSABIUEVfVU5FWFBFQ1RFRF9DT05URU5UX0xFTkdUSABGTFVTSABQUk9QUEFUQ0gATS1TRUFSQ0gAVVJJX1RPT19MT05HAFBST0NFU1NJTkcATUlTQ0VMTEFORU9VU19QRVJTSVNURU5UX1dBUk5JTkcATUlTQ0VMTEFORU9VU19XQVJOSU5HAEhQRV9JTlZBTElEX1RSQU5TRkVSX0VOQ09ESU5HAEV4cGVjdGVkIENSTEYASFBFX0lOVkFMSURfQ0hVTktfU0laRQBNT1ZFAENPTlRJTlVFAEhQRV9DQl9TVEFUVVNfQ09NUExFVEUASFBFX0NCX0hFQURFUlNfQ09NUExFVEUASFBFX0NCX1ZFUlNJT05fQ09NUExFVEUASFBFX0NCX1VSTF9DT01QTEVURQBIUEVfQ0JfQ0hVTktfQ09NUExFVEUASFBFX0NCX0hFQURFUl9WQUxVRV9DT01QTEVURQBIUEVfQ0JfQ0hVTktfRVhURU5TSU9OX1ZBTFVFX0NPTVBMRVRFAEhQRV9DQl9DSFVOS19FWFRFTlNJT05fTkFNRV9DT01QTEVURQBIUEVfQ0JfTUVTU0FHRV9DT01QTEVURQBIUEVfQ0JfTUVUSE9EX0NPTVBMRVRFAEhQRV9DQl9IRUFERVJfRklFTERfQ09NUExFVEUAREVMRVRFAEhQRV9JTlZBTElEX0VPRl9TVEFURQBJTlZBTElEX1NTTF9DRVJUSUZJQ0FURQBQQVVTRQBOT19SRVNQT05TRQBVTlNVUFBPUlRFRF9NRURJQV9UWVBFAEdPTkUATk9UX0FDQ0VQVEFCTEUAU0VSVklDRV9VTkFWQUlMQUJMRQBSQU5HRV9OT1RfU0FUSVNGSUFCTEUAT1JJR0lOX0lTX1VOUkVBQ0hBQkxFAFJFU1BPTlNFX0lTX1NUQUxFAFBVUkdFAE1FUkdFAFJFUVVFU1RfSEVBREVSX0ZJRUxEU19UT09fTEFSR0UAUkVRVUVTVF9IRUFERVJfVE9PX0xBUkdFAFBBWUxPQURfVE9PX0xBUkdFAElOU1VGRklDSUVOVF9TVE9SQUdFAEhQRV9QQVVTRURfVVBHUkFERQBIUEVfUEFVU0VEX0gyX1VQR1JBREUAU09VUkNFAEFOTk9VTkNFAFRSQUNFAEhQRV9VTkVYUEVDVEVEX1NQQUNFAERFU0NSSUJFAFVOU1VCU0NSSUJFAFJFQ09SRABIUEVfSU5WQUxJRF9NRVRIT0QATk9UX0ZPVU5EAFBST1BGSU5EAFVOQklORABSRUJJTkQAVU5BVVRIT1JJWkVEAE1FVEhPRF9OT1RfQUxMT1dFRABIVFRQX1ZFUlNJT05fTk9UX1NVUFBPUlRFRABBTFJFQURZX1JFUE9SVEVEAEFDQ0VQVEVEAE5PVF9JTVBMRU1FTlRFRABMT09QX0RFVEVDVEVEAEhQRV9DUl9FWFBFQ1RFRABIUEVfTEZfRVhQRUNURUQAQ1JFQVRFRABJTV9VU0VEAEhQRV9QQVVTRUQAVElNRU9VVF9PQ0NVUkVEAFBBWU1FTlRfUkVRVUlSRUQAUFJFQ09ORElUSU9OX1JFUVVJUkVEAFBST1hZX0FVVEhFTlRJQ0FUSU9OX1JFUVVJUkVEAE5FVFdPUktfQVVUSEVOVElDQVRJT05fUkVRVUlSRUQATEVOR1RIX1JFUVVJUkVEAFNTTF9DRVJUSUZJQ0FURV9SRVFVSVJFRABVUEdSQURFX1JFUVVJUkVEAFBBR0VfRVhQSVJFRABQUkVDT05ESVRJT05fRkFJTEVEAEVYUEVDVEFUSU9OX0ZBSUxFRABSRVZBTElEQVRJT05fRkFJTEVEAFNTTF9IQU5EU0hBS0VfRkFJTEVEAExPQ0tFRABUUkFOU0ZPUk1BVElPTl9BUFBMSUVEAE5PVF9NT0RJRklFRABOT1RfRVhURU5ERUQAQkFORFdJRFRIX0xJTUlUX0VYQ0VFREVEAFNJVEVfSVNfT1ZFUkxPQURFRABIRUFEAEV4cGVjdGVkIEhUVFAvAABeEwAAJhMAADAQAADwFwAAnRMAABUSAAA5FwAA8BIAAAoQAAB1EgAArRIAAIITAABPFAAAfxAAAKAVAAAjFAAAiRIAAIsUAABNFQAA1BEAAM8UAAAQGAAAyRYAANwWAADBEQAA4BcAALsUAAB0FAAAfBUAAOUUAAAIFwAAHxAAAGUVAACjFAAAKBUAAAIVAACZFQAALBAAAIsZAABPDwAA1A4AAGoQAADOEAAAAhcAAIkOAABuEwAAHBMAAGYUAABWFwAAwRMAAM0TAABsEwAAaBcAAGYXAABfFwAAIhMAAM4PAABpDgAA2A4AAGMWAADLEwAAqg4AACgXAAAmFwAAxRMAAF0WAADoEQAAZxMAAGUTAADyFgAAcxMAAB0XAAD5FgAA8xEAAM8OAADOFQAADBIAALMRAAClEQAAYRAAADIXAAC7EwAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAgEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAgMCAgICAgAAAgIAAgIAAgICAgICAgICAgAEAAAAAAACAgICAgICAgICAgICAgICAgICAgICAgICAgAAAAICAgICAgICAgICAgICAgICAgICAgICAgICAgICAAIAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAIAAgICAgIAAAICAAICAAICAgICAgICAgIAAwAEAAAAAgICAgICAgICAgICAgICAgICAgICAgICAgIAAAACAgICAgICAgICAgICAgICAgICAgICAgICAgICAgACAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABsb3NlZWVwLWFsaXZlAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAQEBAQEBAQEBAgEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQFjaHVua2VkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQABAQEBAQAAAQEAAQEAAQEBAQEBAQEBAQAAAAAAAAABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGVjdGlvbmVudC1sZW5ndGhvbnJveHktY29ubmVjdGlvbgAAAAAAAAAAAAAAAAAAAHJhbnNmZXItZW5jb2RpbmdwZ3JhZGUNCg0KDQpTTQ0KDQpUVFAvQ0UvVFNQLwAAAAAAAAAAAAAAAAECAAEDAAAAAAAAAAAAAAAAAAAAAAAABAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAAAAAAAAAAABAgABAwAAAAAAAAAAAAAAAAAAAAAAAAQBAQUBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAAAAAAAAAAAQAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAAAAAAAAAAAAABAAACAAAAAAAAAAAAAAAAAAAAAAAAAwQAAAQEBAQEBAQEBAQEBQQEBAQEBAQEBAQEBAAEAAYHBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAAQABAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAQAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAAAAAAAAAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAEAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAgAAAAACAAAAAAAAAAAAAAAAAAAAAAADAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwAAAAAAAAMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE5PVU5DRUVDS09VVE5FQ1RFVEVDUklCRUxVU0hFVEVBRFNFQVJDSFJHRUNUSVZJVFlMRU5EQVJWRU9USUZZUFRJT05TQ0hTRUFZU1RBVENIR0VPUkRJUkVDVE9SVFJDSFBBUkFNRVRFUlVSQ0VCU0NSSUJFQVJET1dOQUNFSU5ETktDS1VCU0NSSUJFSFRUUC9BRFRQLw=='\n","// @ts-check\n\n'use strict'\n\n/* global WebAssembly */\n\nconst assert = require('assert')\nconst net = require('net')\nconst http = require('http')\nconst { pipeline } = require('stream')\nconst util = require('./core/util')\nconst timers = require('./timers')\nconst Request = require('./core/request')\nconst DispatcherBase = require('./dispatcher-base')\nconst {\n  RequestContentLengthMismatchError,\n  ResponseContentLengthMismatchError,\n  InvalidArgumentError,\n  RequestAbortedError,\n  HeadersTimeoutError,\n  HeadersOverflowError,\n  SocketError,\n  InformationalError,\n  BodyTimeoutError,\n  HTTPParserError,\n  ResponseExceededMaxSizeError,\n  ClientDestroyedError\n} = require('./core/errors')\nconst buildConnector = require('./core/connect')\nconst {\n  kUrl,\n  kReset,\n  kServerName,\n  kClient,\n  kBusy,\n  kParser,\n  kConnect,\n  kBlocking,\n  kResuming,\n  kRunning,\n  kPending,\n  kSize,\n  kWriting,\n  kQueue,\n  kConnected,\n  kConnecting,\n  kNeedDrain,\n  kNoRef,\n  kKeepAliveDefaultTimeout,\n  kHostHeader,\n  kPendingIdx,\n  kRunningIdx,\n  kError,\n  kPipelining,\n  kSocket,\n  kKeepAliveTimeoutValue,\n  kMaxHeadersSize,\n  kKeepAliveMaxTimeout,\n  kKeepAliveTimeoutThreshold,\n  kHeadersTimeout,\n  kBodyTimeout,\n  kStrictContentLength,\n  kConnector,\n  kMaxRedirections,\n  kMaxRequests,\n  kCounter,\n  kClose,\n  kDestroy,\n  kDispatch,\n  kInterceptors,\n  kLocalAddress,\n  kMaxResponseSize,\n  kHTTPConnVersion,\n  // HTTP2\n  kHost,\n  kHTTP2Session,\n  kHTTP2SessionState,\n  kHTTP2BuildRequest,\n  kHTTP2CopyHeaders,\n  kHTTP1BuildRequest\n} = require('./core/symbols')\n\n/** @type {import('http2')} */\nlet http2\ntry {\n  http2 = require('http2')\n} catch {\n  // @ts-ignore\n  http2 = { constants: {} }\n}\n\nconst {\n  constants: {\n    HTTP2_HEADER_AUTHORITY,\n    HTTP2_HEADER_METHOD,\n    HTTP2_HEADER_PATH,\n    HTTP2_HEADER_SCHEME,\n    HTTP2_HEADER_CONTENT_LENGTH,\n    HTTP2_HEADER_EXPECT,\n    HTTP2_HEADER_STATUS\n  }\n} = http2\n\n// Experimental\nlet h2ExperimentalWarned = false\n\nconst FastBuffer = Buffer[Symbol.species]\n\nconst kClosedResolve = Symbol('kClosedResolve')\n\nconst channels = {}\n\ntry {\n  const diagnosticsChannel = require('diagnostics_channel')\n  channels.sendHeaders = diagnosticsChannel.channel('undici:client:sendHeaders')\n  channels.beforeConnect = diagnosticsChannel.channel('undici:client:beforeConnect')\n  channels.connectError = diagnosticsChannel.channel('undici:client:connectError')\n  channels.connected = diagnosticsChannel.channel('undici:client:connected')\n} catch {\n  channels.sendHeaders = { hasSubscribers: false }\n  channels.beforeConnect = { hasSubscribers: false }\n  channels.connectError = { hasSubscribers: false }\n  channels.connected = { hasSubscribers: false }\n}\n\n/**\n * @type {import('../types/client').default}\n */\nclass Client extends DispatcherBase {\n  /**\n   *\n   * @param {string|URL} url\n   * @param {import('../types/client').Client.Options} options\n   */\n  constructor (url, {\n    interceptors,\n    maxHeaderSize,\n    headersTimeout,\n    socketTimeout,\n    requestTimeout,\n    connectTimeout,\n    bodyTimeout,\n    idleTimeout,\n    keepAlive,\n    keepAliveTimeout,\n    maxKeepAliveTimeout,\n    keepAliveMaxTimeout,\n    keepAliveTimeoutThreshold,\n    socketPath,\n    pipelining,\n    tls,\n    strictContentLength,\n    maxCachedSessions,\n    maxRedirections,\n    connect,\n    maxRequestsPerClient,\n    localAddress,\n    maxResponseSize,\n    autoSelectFamily,\n    autoSelectFamilyAttemptTimeout,\n    // h2\n    allowH2,\n    maxConcurrentStreams\n  } = {}) {\n    super()\n\n    if (keepAlive !== undefined) {\n      throw new InvalidArgumentError('unsupported keepAlive, use pipelining=0 instead')\n    }\n\n    if (socketTimeout !== undefined) {\n      throw new InvalidArgumentError('unsupported socketTimeout, use headersTimeout & bodyTimeout instead')\n    }\n\n    if (requestTimeout !== undefined) {\n      throw new InvalidArgumentError('unsupported requestTimeout, use headersTimeout & bodyTimeout instead')\n    }\n\n    if (idleTimeout !== undefined) {\n      throw new InvalidArgumentError('unsupported idleTimeout, use keepAliveTimeout instead')\n    }\n\n    if (maxKeepAliveTimeout !== undefined) {\n      throw new InvalidArgumentError('unsupported maxKeepAliveTimeout, use keepAliveMaxTimeout instead')\n    }\n\n    if (maxHeaderSize != null && !Number.isFinite(maxHeaderSize)) {\n      throw new InvalidArgumentError('invalid maxHeaderSize')\n    }\n\n    if (socketPath != null && typeof socketPath !== 'string') {\n      throw new InvalidArgumentError('invalid socketPath')\n    }\n\n    if (connectTimeout != null && (!Number.isFinite(connectTimeout) || connectTimeout < 0)) {\n      throw new InvalidArgumentError('invalid connectTimeout')\n    }\n\n    if (keepAliveTimeout != null && (!Number.isFinite(keepAliveTimeout) || keepAliveTimeout <= 0)) {\n      throw new InvalidArgumentError('invalid keepAliveTimeout')\n    }\n\n    if (keepAliveMaxTimeout != null && (!Number.isFinite(keepAliveMaxTimeout) || keepAliveMaxTimeout <= 0)) {\n      throw new InvalidArgumentError('invalid keepAliveMaxTimeout')\n    }\n\n    if (keepAliveTimeoutThreshold != null && !Number.isFinite(keepAliveTimeoutThreshold)) {\n      throw new InvalidArgumentError('invalid keepAliveTimeoutThreshold')\n    }\n\n    if (headersTimeout != null && (!Number.isInteger(headersTimeout) || headersTimeout < 0)) {\n      throw new InvalidArgumentError('headersTimeout must be a positive integer or zero')\n    }\n\n    if (bodyTimeout != null && (!Number.isInteger(bodyTimeout) || bodyTimeout < 0)) {\n      throw new InvalidArgumentError('bodyTimeout must be a positive integer or zero')\n    }\n\n    if (connect != null && typeof connect !== 'function' && typeof connect !== 'object') {\n      throw new InvalidArgumentError('connect must be a function or an object')\n    }\n\n    if (maxRedirections != null && (!Number.isInteger(maxRedirections) || maxRedirections < 0)) {\n      throw new InvalidArgumentError('maxRedirections must be a positive number')\n    }\n\n    if (maxRequestsPerClient != null && (!Number.isInteger(maxRequestsPerClient) || maxRequestsPerClient < 0)) {\n      throw new InvalidArgumentError('maxRequestsPerClient must be a positive number')\n    }\n\n    if (localAddress != null && (typeof localAddress !== 'string' || net.isIP(localAddress) === 0)) {\n      throw new InvalidArgumentError('localAddress must be valid string IP address')\n    }\n\n    if (maxResponseSize != null && (!Number.isInteger(maxResponseSize) || maxResponseSize < -1)) {\n      throw new InvalidArgumentError('maxResponseSize must be a positive number')\n    }\n\n    if (\n      autoSelectFamilyAttemptTimeout != null &&\n      (!Number.isInteger(autoSelectFamilyAttemptTimeout) || autoSelectFamilyAttemptTimeout < -1)\n    ) {\n      throw new InvalidArgumentError('autoSelectFamilyAttemptTimeout must be a positive number')\n    }\n\n    // h2\n    if (allowH2 != null && typeof allowH2 !== 'boolean') {\n      throw new InvalidArgumentError('allowH2 must be a valid boolean value')\n    }\n\n    if (maxConcurrentStreams != null && (typeof maxConcurrentStreams !== 'number' || maxConcurrentStreams < 1)) {\n      throw new InvalidArgumentError('maxConcurrentStreams must be a possitive integer, greater than 0')\n    }\n\n    if (typeof connect !== 'function') {\n      connect = buildConnector({\n        ...tls,\n        maxCachedSessions,\n        allowH2,\n        socketPath,\n        timeout: connectTimeout,\n        ...(util.nodeHasAutoSelectFamily && autoSelectFamily ? { autoSelectFamily, autoSelectFamilyAttemptTimeout } : undefined),\n        ...connect\n      })\n    }\n\n    this[kInterceptors] = interceptors && interceptors.Client && Array.isArray(interceptors.Client)\n      ? interceptors.Client\n      : [createRedirectInterceptor({ maxRedirections })]\n    this[kUrl] = util.parseOrigin(url)\n    this[kConnector] = connect\n    this[kSocket] = null\n    this[kPipelining] = pipelining != null ? pipelining : 1\n    this[kMaxHeadersSize] = maxHeaderSize || http.maxHeaderSize\n    this[kKeepAliveDefaultTimeout] = keepAliveTimeout == null ? 4e3 : keepAliveTimeout\n    this[kKeepAliveMaxTimeout] = keepAliveMaxTimeout == null ? 600e3 : keepAliveMaxTimeout\n    this[kKeepAliveTimeoutThreshold] = keepAliveTimeoutThreshold == null ? 1e3 : keepAliveTimeoutThreshold\n    this[kKeepAliveTimeoutValue] = this[kKeepAliveDefaultTimeout]\n    this[kServerName] = null\n    this[kLocalAddress] = localAddress != null ? localAddress : null\n    this[kResuming] = 0 // 0, idle, 1, scheduled, 2 resuming\n    this[kNeedDrain] = 0 // 0, idle, 1, scheduled, 2 resuming\n    this[kHostHeader] = `host: ${this[kUrl].hostname}${this[kUrl].port ? `:${this[kUrl].port}` : ''}\\r\\n`\n    this[kBodyTimeout] = bodyTimeout != null ? bodyTimeout : 300e3\n    this[kHeadersTimeout] = headersTimeout != null ? headersTimeout : 300e3\n    this[kStrictContentLength] = strictContentLength == null ? true : strictContentLength\n    this[kMaxRedirections] = maxRedirections\n    this[kMaxRequests] = maxRequestsPerClient\n    this[kClosedResolve] = null\n    this[kMaxResponseSize] = maxResponseSize > -1 ? maxResponseSize : -1\n    this[kHTTPConnVersion] = 'h1'\n\n    // HTTP/2\n    this[kHTTP2Session] = null\n    this[kHTTP2SessionState] = !allowH2\n      ? null\n      : {\n        // streams: null, // Fixed queue of streams - For future support of `push`\n          openStreams: 0, // Keep track of them to decide wether or not unref the session\n          maxConcurrentStreams: maxConcurrentStreams != null ? maxConcurrentStreams : 100 // Max peerConcurrentStreams for a Node h2 server\n        }\n    this[kHost] = `${this[kUrl].hostname}${this[kUrl].port ? `:${this[kUrl].port}` : ''}`\n\n    // kQueue is built up of 3 sections separated by\n    // the kRunningIdx and kPendingIdx indices.\n    // |   complete   |   running   |   pending   |\n    //                ^ kRunningIdx ^ kPendingIdx ^ kQueue.length\n    // kRunningIdx points to the first running element.\n    // kPendingIdx points to the first pending element.\n    // This implements a fast queue with an amortized\n    // time of O(1).\n\n    this[kQueue] = []\n    this[kRunningIdx] = 0\n    this[kPendingIdx] = 0\n  }\n\n  get pipelining () {\n    return this[kPipelining]\n  }\n\n  set pipelining (value) {\n    this[kPipelining] = value\n    resume(this, true)\n  }\n\n  get [kPending] () {\n    return this[kQueue].length - this[kPendingIdx]\n  }\n\n  get [kRunning] () {\n    return this[kPendingIdx] - this[kRunningIdx]\n  }\n\n  get [kSize] () {\n    return this[kQueue].length - this[kRunningIdx]\n  }\n\n  get [kConnected] () {\n    return !!this[kSocket] && !this[kConnecting] && !this[kSocket].destroyed\n  }\n\n  get [kBusy] () {\n    const socket = this[kSocket]\n    return (\n      (socket && (socket[kReset] || socket[kWriting] || socket[kBlocking])) ||\n      (this[kSize] >= (this[kPipelining] || 1)) ||\n      this[kPending] > 0\n    )\n  }\n\n  /* istanbul ignore: only used for test */\n  [kConnect] (cb) {\n    connect(this)\n    this.once('connect', cb)\n  }\n\n  [kDispatch] (opts, handler) {\n    const origin = opts.origin || this[kUrl].origin\n\n    const request = this[kHTTPConnVersion] === 'h2'\n      ? Request[kHTTP2BuildRequest](origin, opts, handler)\n      : Request[kHTTP1BuildRequest](origin, opts, handler)\n\n    this[kQueue].push(request)\n    if (this[kResuming]) {\n      // Do nothing.\n    } else if (util.bodyLength(request.body) == null && util.isIterable(request.body)) {\n      // Wait a tick in case stream/iterator is ended in the same tick.\n      this[kResuming] = 1\n      process.nextTick(resume, this)\n    } else {\n      resume(this, true)\n    }\n\n    if (this[kResuming] && this[kNeedDrain] !== 2 && this[kBusy]) {\n      this[kNeedDrain] = 2\n    }\n\n    return this[kNeedDrain] < 2\n  }\n\n  async [kClose] () {\n    // TODO: for H2 we need to gracefully flush the remaining enqueued\n    // request and close each stream.\n    return new Promise((resolve) => {\n      if (!this[kSize]) {\n        resolve(null)\n      } else {\n        this[kClosedResolve] = resolve\n      }\n    })\n  }\n\n  async [kDestroy] (err) {\n    return new Promise((resolve) => {\n      const requests = this[kQueue].splice(this[kPendingIdx])\n      for (let i = 0; i < requests.length; i++) {\n        const request = requests[i]\n        errorRequest(this, request, err)\n      }\n\n      const callback = () => {\n        if (this[kClosedResolve]) {\n          // TODO (fix): Should we error here with ClientDestroyedError?\n          this[kClosedResolve]()\n          this[kClosedResolve] = null\n        }\n        resolve()\n      }\n\n      if (this[kHTTP2Session] != null) {\n        util.destroy(this[kHTTP2Session], err)\n        this[kHTTP2Session] = null\n        this[kHTTP2SessionState] = null\n      }\n\n      if (!this[kSocket]) {\n        queueMicrotask(callback)\n      } else {\n        util.destroy(this[kSocket].on('close', callback), err)\n      }\n\n      resume(this)\n    })\n  }\n}\n\nfunction onHttp2SessionError (err) {\n  assert(err.code !== 'ERR_TLS_CERT_ALTNAME_INVALID')\n\n  this[kSocket][kError] = err\n\n  onError(this[kClient], err)\n}\n\nfunction onHttp2FrameError (type, code, id) {\n  const err = new InformationalError(`HTTP/2: \"frameError\" received - type ${type}, code ${code}`)\n\n  if (id === 0) {\n    this[kSocket][kError] = err\n    onError(this[kClient], err)\n  }\n}\n\nfunction onHttp2SessionEnd () {\n  util.destroy(this, new SocketError('other side closed'))\n  util.destroy(this[kSocket], new SocketError('other side closed'))\n}\n\nfunction onHTTP2GoAway (code) {\n  const client = this[kClient]\n  const err = new InformationalError(`HTTP/2: \"GOAWAY\" frame received with code ${code}`)\n  client[kSocket] = null\n  client[kHTTP2Session] = null\n\n  if (client.destroyed) {\n    assert(this[kPending] === 0)\n\n    // Fail entire queue.\n    const requests = client[kQueue].splice(client[kRunningIdx])\n    for (let i = 0; i < requests.length; i++) {\n      const request = requests[i]\n      errorRequest(this, request, err)\n    }\n  } else if (client[kRunning] > 0) {\n    // Fail head of pipeline.\n    const request = client[kQueue][client[kRunningIdx]]\n    client[kQueue][client[kRunningIdx]++] = null\n\n    errorRequest(client, request, err)\n  }\n\n  client[kPendingIdx] = client[kRunningIdx]\n\n  assert(client[kRunning] === 0)\n\n  client.emit('disconnect',\n    client[kUrl],\n    [client],\n    err\n  )\n\n  resume(client)\n}\n\nconst constants = require('./llhttp/constants')\nconst createRedirectInterceptor = require('./interceptor/redirectInterceptor')\nconst EMPTY_BUF = Buffer.alloc(0)\n\nasync function lazyllhttp () {\n  const llhttpWasmData = process.env.JEST_WORKER_ID ? require('./llhttp/llhttp-wasm.js') : undefined\n\n  let mod\n  try {\n    mod = await WebAssembly.compile(Buffer.from(require('./llhttp/llhttp_simd-wasm.js'), 'base64'))\n  } catch (e) {\n    /* istanbul ignore next */\n\n    // We could check if the error was caused by the simd option not\n    // being enabled, but the occurring of this other error\n    // * https://github.com/emscripten-core/emscripten/issues/11495\n    // got me to remove that check to avoid breaking Node 12.\n    mod = await WebAssembly.compile(Buffer.from(llhttpWasmData || require('./llhttp/llhttp-wasm.js'), 'base64'))\n  }\n\n  return await WebAssembly.instantiate(mod, {\n    env: {\n      /* eslint-disable camelcase */\n\n      wasm_on_url: (p, at, len) => {\n        /* istanbul ignore next */\n        return 0\n      },\n      wasm_on_status: (p, at, len) => {\n        assert.strictEqual(currentParser.ptr, p)\n        const start = at - currentBufferPtr + currentBufferRef.byteOffset\n        return currentParser.onStatus(new FastBuffer(currentBufferRef.buffer, start, len)) || 0\n      },\n      wasm_on_message_begin: (p) => {\n        assert.strictEqual(currentParser.ptr, p)\n        return currentParser.onMessageBegin() || 0\n      },\n      wasm_on_header_field: (p, at, len) => {\n        assert.strictEqual(currentParser.ptr, p)\n        const start = at - currentBufferPtr + currentBufferRef.byteOffset\n        return currentParser.onHeaderField(new FastBuffer(currentBufferRef.buffer, start, len)) || 0\n      },\n      wasm_on_header_value: (p, at, len) => {\n        assert.strictEqual(currentParser.ptr, p)\n        const start = at - currentBufferPtr + currentBufferRef.byteOffset\n        return currentParser.onHeaderValue(new FastBuffer(currentBufferRef.buffer, start, len)) || 0\n      },\n      wasm_on_headers_complete: (p, statusCode, upgrade, shouldKeepAlive) => {\n        assert.strictEqual(currentParser.ptr, p)\n        return currentParser.onHeadersComplete(statusCode, Boolean(upgrade), Boolean(shouldKeepAlive)) || 0\n      },\n      wasm_on_body: (p, at, len) => {\n        assert.strictEqual(currentParser.ptr, p)\n        const start = at - currentBufferPtr + currentBufferRef.byteOffset\n        return currentParser.onBody(new FastBuffer(currentBufferRef.buffer, start, len)) || 0\n      },\n      wasm_on_message_complete: (p) => {\n        assert.strictEqual(currentParser.ptr, p)\n        return currentParser.onMessageComplete() || 0\n      }\n\n      /* eslint-enable camelcase */\n    }\n  })\n}\n\nlet llhttpInstance = null\nlet llhttpPromise = lazyllhttp()\nllhttpPromise.catch()\n\nlet currentParser = null\nlet currentBufferRef = null\nlet currentBufferSize = 0\nlet currentBufferPtr = null\n\nconst TIMEOUT_HEADERS = 1\nconst TIMEOUT_BODY = 2\nconst TIMEOUT_IDLE = 3\n\nclass Parser {\n  constructor (client, socket, { exports }) {\n    assert(Number.isFinite(client[kMaxHeadersSize]) && client[kMaxHeadersSize] > 0)\n\n    this.llhttp = exports\n    this.ptr = this.llhttp.llhttp_alloc(constants.TYPE.RESPONSE)\n    this.client = client\n    this.socket = socket\n    this.timeout = null\n    this.timeoutValue = null\n    this.timeoutType = null\n    this.statusCode = null\n    this.statusText = ''\n    this.upgrade = false\n    this.headers = []\n    this.headersSize = 0\n    this.headersMaxSize = client[kMaxHeadersSize]\n    this.shouldKeepAlive = false\n    this.paused = false\n    this.resume = this.resume.bind(this)\n\n    this.bytesRead = 0\n\n    this.keepAlive = ''\n    this.contentLength = ''\n    this.connection = ''\n    this.maxResponseSize = client[kMaxResponseSize]\n  }\n\n  setTimeout (value, type) {\n    this.timeoutType = type\n    if (value !== this.timeoutValue) {\n      timers.clearTimeout(this.timeout)\n      if (value) {\n        this.timeout = timers.setTimeout(onParserTimeout, value, this)\n        // istanbul ignore else: only for jest\n        if (this.timeout.unref) {\n          this.timeout.unref()\n        }\n      } else {\n        this.timeout = null\n      }\n      this.timeoutValue = value\n    } else if (this.timeout) {\n      // istanbul ignore else: only for jest\n      if (this.timeout.refresh) {\n        this.timeout.refresh()\n      }\n    }\n  }\n\n  resume () {\n    if (this.socket.destroyed || !this.paused) {\n      return\n    }\n\n    assert(this.ptr != null)\n    assert(currentParser == null)\n\n    this.llhttp.llhttp_resume(this.ptr)\n\n    assert(this.timeoutType === TIMEOUT_BODY)\n    if (this.timeout) {\n      // istanbul ignore else: only for jest\n      if (this.timeout.refresh) {\n        this.timeout.refresh()\n      }\n    }\n\n    this.paused = false\n    this.execute(this.socket.read() || EMPTY_BUF) // Flush parser.\n    this.readMore()\n  }\n\n  readMore () {\n    while (!this.paused && this.ptr) {\n      const chunk = this.socket.read()\n      if (chunk === null) {\n        break\n      }\n      this.execute(chunk)\n    }\n  }\n\n  execute (data) {\n    assert(this.ptr != null)\n    assert(currentParser == null)\n    assert(!this.paused)\n\n    const { socket, llhttp } = this\n\n    if (data.length > currentBufferSize) {\n      if (currentBufferPtr) {\n        llhttp.free(currentBufferPtr)\n      }\n      currentBufferSize = Math.ceil(data.length / 4096) * 4096\n      currentBufferPtr = llhttp.malloc(currentBufferSize)\n    }\n\n    new Uint8Array(llhttp.memory.buffer, currentBufferPtr, currentBufferSize).set(data)\n\n    // Call `execute` on the wasm parser.\n    // We pass the `llhttp_parser` pointer address, the pointer address of buffer view data,\n    // and finally the length of bytes to parse.\n    // The return value is an error code or `constants.ERROR.OK`.\n    try {\n      let ret\n\n      try {\n        currentBufferRef = data\n        currentParser = this\n        ret = llhttp.llhttp_execute(this.ptr, currentBufferPtr, data.length)\n        /* eslint-disable-next-line no-useless-catch */\n      } catch (err) {\n        /* istanbul ignore next: difficult to make a test case for */\n        throw err\n      } finally {\n        currentParser = null\n        currentBufferRef = null\n      }\n\n      const offset = llhttp.llhttp_get_error_pos(this.ptr) - currentBufferPtr\n\n      if (ret === constants.ERROR.PAUSED_UPGRADE) {\n        this.onUpgrade(data.slice(offset))\n      } else if (ret === constants.ERROR.PAUSED) {\n        this.paused = true\n        socket.unshift(data.slice(offset))\n      } else if (ret !== constants.ERROR.OK) {\n        const ptr = llhttp.llhttp_get_error_reason(this.ptr)\n        let message = ''\n        /* istanbul ignore else: difficult to make a test case for */\n        if (ptr) {\n          const len = new Uint8Array(llhttp.memory.buffer, ptr).indexOf(0)\n          message =\n            'Response does not match the HTTP/1.1 protocol (' +\n            Buffer.from(llhttp.memory.buffer, ptr, len).toString() +\n            ')'\n        }\n        throw new HTTPParserError(message, constants.ERROR[ret], data.slice(offset))\n      }\n    } catch (err) {\n      util.destroy(socket, err)\n    }\n  }\n\n  destroy () {\n    assert(this.ptr != null)\n    assert(currentParser == null)\n\n    this.llhttp.llhttp_free(this.ptr)\n    this.ptr = null\n\n    timers.clearTimeout(this.timeout)\n    this.timeout = null\n    this.timeoutValue = null\n    this.timeoutType = null\n\n    this.paused = false\n  }\n\n  onStatus (buf) {\n    this.statusText = buf.toString()\n  }\n\n  onMessageBegin () {\n    const { socket, client } = this\n\n    /* istanbul ignore next: difficult to make a test case for */\n    if (socket.destroyed) {\n      return -1\n    }\n\n    const request = client[kQueue][client[kRunningIdx]]\n    if (!request) {\n      return -1\n    }\n  }\n\n  onHeaderField (buf) {\n    const len = this.headers.length\n\n    if ((len & 1) === 0) {\n      this.headers.push(buf)\n    } else {\n      this.headers[len - 1] = Buffer.concat([this.headers[len - 1], buf])\n    }\n\n    this.trackHeader(buf.length)\n  }\n\n  onHeaderValue (buf) {\n    let len = this.headers.length\n\n    if ((len & 1) === 1) {\n      this.headers.push(buf)\n      len += 1\n    } else {\n      this.headers[len - 1] = Buffer.concat([this.headers[len - 1], buf])\n    }\n\n    const key = this.headers[len - 2]\n    if (key.length === 10 && key.toString().toLowerCase() === 'keep-alive') {\n      this.keepAlive += buf.toString()\n    } else if (key.length === 10 && key.toString().toLowerCase() === 'connection') {\n      this.connection += buf.toString()\n    } else if (key.length === 14 && key.toString().toLowerCase() === 'content-length') {\n      this.contentLength += buf.toString()\n    }\n\n    this.trackHeader(buf.length)\n  }\n\n  trackHeader (len) {\n    this.headersSize += len\n    if (this.headersSize >= this.headersMaxSize) {\n      util.destroy(this.socket, new HeadersOverflowError())\n    }\n  }\n\n  onUpgrade (head) {\n    const { upgrade, client, socket, headers, statusCode } = this\n\n    assert(upgrade)\n\n    const request = client[kQueue][client[kRunningIdx]]\n    assert(request)\n\n    assert(!socket.destroyed)\n    assert(socket === client[kSocket])\n    assert(!this.paused)\n    assert(request.upgrade || request.method === 'CONNECT')\n\n    this.statusCode = null\n    this.statusText = ''\n    this.shouldKeepAlive = null\n\n    assert(this.headers.length % 2 === 0)\n    this.headers = []\n    this.headersSize = 0\n\n    socket.unshift(head)\n\n    socket[kParser].destroy()\n    socket[kParser] = null\n\n    socket[kClient] = null\n    socket[kError] = null\n    socket\n      .removeListener('error', onSocketError)\n      .removeListener('readable', onSocketReadable)\n      .removeListener('end', onSocketEnd)\n      .removeListener('close', onSocketClose)\n\n    client[kSocket] = null\n    client[kQueue][client[kRunningIdx]++] = null\n    client.emit('disconnect', client[kUrl], [client], new InformationalError('upgrade'))\n\n    try {\n      request.onUpgrade(statusCode, headers, socket)\n    } catch (err) {\n      util.destroy(socket, err)\n    }\n\n    resume(client)\n  }\n\n  onHeadersComplete (statusCode, upgrade, shouldKeepAlive) {\n    const { client, socket, headers, statusText } = this\n\n    /* istanbul ignore next: difficult to make a test case for */\n    if (socket.destroyed) {\n      return -1\n    }\n\n    const request = client[kQueue][client[kRunningIdx]]\n\n    /* istanbul ignore next: difficult to make a test case for */\n    if (!request) {\n      return -1\n    }\n\n    assert(!this.upgrade)\n    assert(this.statusCode < 200)\n\n    if (statusCode === 100) {\n      util.destroy(socket, new SocketError('bad response', util.getSocketInfo(socket)))\n      return -1\n    }\n\n    /* this can only happen if server is misbehaving */\n    if (upgrade && !request.upgrade) {\n      util.destroy(socket, new SocketError('bad upgrade', util.getSocketInfo(socket)))\n      return -1\n    }\n\n    assert.strictEqual(this.timeoutType, TIMEOUT_HEADERS)\n\n    this.statusCode = statusCode\n    this.shouldKeepAlive = (\n      shouldKeepAlive ||\n      // Override llhttp value which does not allow keepAlive for HEAD.\n      (request.method === 'HEAD' && !socket[kReset] && this.connection.toLowerCase() === 'keep-alive')\n    )\n\n    if (this.statusCode >= 200) {\n      const bodyTimeout = request.bodyTimeout != null\n        ? request.bodyTimeout\n        : client[kBodyTimeout]\n      this.setTimeout(bodyTimeout, TIMEOUT_BODY)\n    } else if (this.timeout) {\n      // istanbul ignore else: only for jest\n      if (this.timeout.refresh) {\n        this.timeout.refresh()\n      }\n    }\n\n    if (request.method === 'CONNECT') {\n      assert(client[kRunning] === 1)\n      this.upgrade = true\n      return 2\n    }\n\n    if (upgrade) {\n      assert(client[kRunning] === 1)\n      this.upgrade = true\n      return 2\n    }\n\n    assert(this.headers.length % 2 === 0)\n    this.headers = []\n    this.headersSize = 0\n\n    if (this.shouldKeepAlive && client[kPipelining]) {\n      const keepAliveTimeout = this.keepAlive ? util.parseKeepAliveTimeout(this.keepAlive) : null\n\n      if (keepAliveTimeout != null) {\n        const timeout = Math.min(\n          keepAliveTimeout - client[kKeepAliveTimeoutThreshold],\n          client[kKeepAliveMaxTimeout]\n        )\n        if (timeout <= 0) {\n          socket[kReset] = true\n        } else {\n          client[kKeepAliveTimeoutValue] = timeout\n        }\n      } else {\n        client[kKeepAliveTimeoutValue] = client[kKeepAliveDefaultTimeout]\n      }\n    } else {\n      // Stop more requests from being dispatched.\n      socket[kReset] = true\n    }\n\n    const pause = request.onHeaders(statusCode, headers, this.resume, statusText) === false\n\n    if (request.aborted) {\n      return -1\n    }\n\n    if (request.method === 'HEAD') {\n      return 1\n    }\n\n    if (statusCode < 200) {\n      return 1\n    }\n\n    if (socket[kBlocking]) {\n      socket[kBlocking] = false\n      resume(client)\n    }\n\n    return pause ? constants.ERROR.PAUSED : 0\n  }\n\n  onBody (buf) {\n    const { client, socket, statusCode, maxResponseSize } = this\n\n    if (socket.destroyed) {\n      return -1\n    }\n\n    const request = client[kQueue][client[kRunningIdx]]\n    assert(request)\n\n    assert.strictEqual(this.timeoutType, TIMEOUT_BODY)\n    if (this.timeout) {\n      // istanbul ignore else: only for jest\n      if (this.timeout.refresh) {\n        this.timeout.refresh()\n      }\n    }\n\n    assert(statusCode >= 200)\n\n    if (maxResponseSize > -1 && this.bytesRead + buf.length > maxResponseSize) {\n      util.destroy(socket, new ResponseExceededMaxSizeError())\n      return -1\n    }\n\n    this.bytesRead += buf.length\n\n    if (request.onData(buf) === false) {\n      return constants.ERROR.PAUSED\n    }\n  }\n\n  onMessageComplete () {\n    const { client, socket, statusCode, upgrade, headers, contentLength, bytesRead, shouldKeepAlive } = this\n\n    if (socket.destroyed && (!statusCode || shouldKeepAlive)) {\n      return -1\n    }\n\n    if (upgrade) {\n      return\n    }\n\n    const request = client[kQueue][client[kRunningIdx]]\n    assert(request)\n\n    assert(statusCode >= 100)\n\n    this.statusCode = null\n    this.statusText = ''\n    this.bytesRead = 0\n    this.contentLength = ''\n    this.keepAlive = ''\n    this.connection = ''\n\n    assert(this.headers.length % 2 === 0)\n    this.headers = []\n    this.headersSize = 0\n\n    if (statusCode < 200) {\n      return\n    }\n\n    /* istanbul ignore next: should be handled by llhttp? */\n    if (request.method !== 'HEAD' && contentLength && bytesRead !== parseInt(contentLength, 10)) {\n      util.destroy(socket, new ResponseContentLengthMismatchError())\n      return -1\n    }\n\n    request.onComplete(headers)\n\n    client[kQueue][client[kRunningIdx]++] = null\n\n    if (socket[kWriting]) {\n      assert.strictEqual(client[kRunning], 0)\n      // Response completed before request.\n      util.destroy(socket, new InformationalError('reset'))\n      return constants.ERROR.PAUSED\n    } else if (!shouldKeepAlive) {\n      util.destroy(socket, new InformationalError('reset'))\n      return constants.ERROR.PAUSED\n    } else if (socket[kReset] && client[kRunning] === 0) {\n      // Destroy socket once all requests have completed.\n      // The request at the tail of the pipeline is the one\n      // that requested reset and no further requests should\n      // have been queued since then.\n      util.destroy(socket, new InformationalError('reset'))\n      return constants.ERROR.PAUSED\n    } else if (client[kPipelining] === 1) {\n      // We must wait a full event loop cycle to reuse this socket to make sure\n      // that non-spec compliant servers are not closing the connection even if they\n      // said they won't.\n      setImmediate(resume, client)\n    } else {\n      resume(client)\n    }\n  }\n}\n\nfunction onParserTimeout (parser) {\n  const { socket, timeoutType, client } = parser\n\n  /* istanbul ignore else */\n  if (timeoutType === TIMEOUT_HEADERS) {\n    if (!socket[kWriting] || socket.writableNeedDrain || client[kRunning] > 1) {\n      assert(!parser.paused, 'cannot be paused while waiting for headers')\n      util.destroy(socket, new HeadersTimeoutError())\n    }\n  } else if (timeoutType === TIMEOUT_BODY) {\n    if (!parser.paused) {\n      util.destroy(socket, new BodyTimeoutError())\n    }\n  } else if (timeoutType === TIMEOUT_IDLE) {\n    assert(client[kRunning] === 0 && client[kKeepAliveTimeoutValue])\n    util.destroy(socket, new InformationalError('socket idle timeout'))\n  }\n}\n\nfunction onSocketReadable () {\n  const { [kParser]: parser } = this\n  if (parser) {\n    parser.readMore()\n  }\n}\n\nfunction onSocketError (err) {\n  const { [kClient]: client, [kParser]: parser } = this\n\n  assert(err.code !== 'ERR_TLS_CERT_ALTNAME_INVALID')\n\n  if (client[kHTTPConnVersion] !== 'h2') {\n    // On Mac OS, we get an ECONNRESET even if there is a full body to be forwarded\n    // to the user.\n    if (err.code === 'ECONNRESET' && parser.statusCode && !parser.shouldKeepAlive) {\n      // We treat all incoming data so for as a valid response.\n      parser.onMessageComplete()\n      return\n    }\n  }\n\n  this[kError] = err\n\n  onError(this[kClient], err)\n}\n\nfunction onError (client, err) {\n  if (\n    client[kRunning] === 0 &&\n    err.code !== 'UND_ERR_INFO' &&\n    err.code !== 'UND_ERR_SOCKET'\n  ) {\n    // Error is not caused by running request and not a recoverable\n    // socket error.\n\n    assert(client[kPendingIdx] === client[kRunningIdx])\n\n    const requests = client[kQueue].splice(client[kRunningIdx])\n    for (let i = 0; i < requests.length; i++) {\n      const request = requests[i]\n      errorRequest(client, request, err)\n    }\n    assert(client[kSize] === 0)\n  }\n}\n\nfunction onSocketEnd () {\n  const { [kParser]: parser, [kClient]: client } = this\n\n  if (client[kHTTPConnVersion] !== 'h2') {\n    if (parser.statusCode && !parser.shouldKeepAlive) {\n      // We treat all incoming data so far as a valid response.\n      parser.onMessageComplete()\n      return\n    }\n  }\n\n  util.destroy(this, new SocketError('other side closed', util.getSocketInfo(this)))\n}\n\nfunction onSocketClose () {\n  const { [kClient]: client, [kParser]: parser } = this\n\n  if (client[kHTTPConnVersion] === 'h1' && parser) {\n    if (!this[kError] && parser.statusCode && !parser.shouldKeepAlive) {\n      // We treat all incoming data so far as a valid response.\n      parser.onMessageComplete()\n    }\n\n    this[kParser].destroy()\n    this[kParser] = null\n  }\n\n  const err = this[kError] || new SocketError('closed', util.getSocketInfo(this))\n\n  client[kSocket] = null\n\n  if (client.destroyed) {\n    assert(client[kPending] === 0)\n\n    // Fail entire queue.\n    const requests = client[kQueue].splice(client[kRunningIdx])\n    for (let i = 0; i < requests.length; i++) {\n      const request = requests[i]\n      errorRequest(client, request, err)\n    }\n  } else if (client[kRunning] > 0 && err.code !== 'UND_ERR_INFO') {\n    // Fail head of pipeline.\n    const request = client[kQueue][client[kRunningIdx]]\n    client[kQueue][client[kRunningIdx]++] = null\n\n    errorRequest(client, request, err)\n  }\n\n  client[kPendingIdx] = client[kRunningIdx]\n\n  assert(client[kRunning] === 0)\n\n  client.emit('disconnect', client[kUrl], [client], err)\n\n  resume(client)\n}\n\nasync function connect (client) {\n  assert(!client[kConnecting])\n  assert(!client[kSocket])\n\n  let { host, hostname, protocol, port } = client[kUrl]\n\n  // Resolve ipv6\n  if (hostname[0] === '[') {\n    const idx = hostname.indexOf(']')\n\n    assert(idx !== -1)\n    const ip = hostname.substring(1, idx)\n\n    assert(net.isIP(ip))\n    hostname = ip\n  }\n\n  client[kConnecting] = true\n\n  if (channels.beforeConnect.hasSubscribers) {\n    channels.beforeConnect.publish({\n      connectParams: {\n        host,\n        hostname,\n        protocol,\n        port,\n        servername: client[kServerName],\n        localAddress: client[kLocalAddress]\n      },\n      connector: client[kConnector]\n    })\n  }\n\n  try {\n    const socket = await new Promise((resolve, reject) => {\n      client[kConnector]({\n        host,\n        hostname,\n        protocol,\n        port,\n        servername: client[kServerName],\n        localAddress: client[kLocalAddress]\n      }, (err, socket) => {\n        if (err) {\n          reject(err)\n        } else {\n          resolve(socket)\n        }\n      })\n    })\n\n    if (client.destroyed) {\n      util.destroy(socket.on('error', () => {}), new ClientDestroyedError())\n      return\n    }\n\n    client[kConnecting] = false\n\n    assert(socket)\n\n    const isH2 = socket.alpnProtocol === 'h2'\n    if (isH2) {\n      if (!h2ExperimentalWarned) {\n        h2ExperimentalWarned = true\n        process.emitWarning('H2 support is experimental, expect them to change at any time.', {\n          code: 'UNDICI-H2'\n        })\n      }\n\n      const session = http2.connect(client[kUrl], {\n        createConnection: () => socket,\n        peerMaxConcurrentStreams: client[kHTTP2SessionState].maxConcurrentStreams\n      })\n\n      client[kHTTPConnVersion] = 'h2'\n      session[kClient] = client\n      session[kSocket] = socket\n      session.on('error', onHttp2SessionError)\n      session.on('frameError', onHttp2FrameError)\n      session.on('end', onHttp2SessionEnd)\n      session.on('goaway', onHTTP2GoAway)\n      session.on('close', onSocketClose)\n      session.unref()\n\n      client[kHTTP2Session] = session\n      socket[kHTTP2Session] = session\n    } else {\n      if (!llhttpInstance) {\n        llhttpInstance = await llhttpPromise\n        llhttpPromise = null\n      }\n\n      socket[kNoRef] = false\n      socket[kWriting] = false\n      socket[kReset] = false\n      socket[kBlocking] = false\n      socket[kParser] = new Parser(client, socket, llhttpInstance)\n    }\n\n    socket[kCounter] = 0\n    socket[kMaxRequests] = client[kMaxRequests]\n    socket[kClient] = client\n    socket[kError] = null\n\n    socket\n      .on('error', onSocketError)\n      .on('readable', onSocketReadable)\n      .on('end', onSocketEnd)\n      .on('close', onSocketClose)\n\n    client[kSocket] = socket\n\n    if (channels.connected.hasSubscribers) {\n      channels.connected.publish({\n        connectParams: {\n          host,\n          hostname,\n          protocol,\n          port,\n          servername: client[kServerName],\n          localAddress: client[kLocalAddress]\n        },\n        connector: client[kConnector],\n        socket\n      })\n    }\n    client.emit('connect', client[kUrl], [client])\n  } catch (err) {\n    if (client.destroyed) {\n      return\n    }\n\n    client[kConnecting] = false\n\n    if (channels.connectError.hasSubscribers) {\n      channels.connectError.publish({\n        connectParams: {\n          host,\n          hostname,\n          protocol,\n          port,\n          servername: client[kServerName],\n          localAddress: client[kLocalAddress]\n        },\n        connector: client[kConnector],\n        error: err\n      })\n    }\n\n    if (err.code === 'ERR_TLS_CERT_ALTNAME_INVALID') {\n      assert(client[kRunning] === 0)\n      while (client[kPending] > 0 && client[kQueue][client[kPendingIdx]].servername === client[kServerName]) {\n        const request = client[kQueue][client[kPendingIdx]++]\n        errorRequest(client, request, err)\n      }\n    } else {\n      onError(client, err)\n    }\n\n    client.emit('connectionError', client[kUrl], [client], err)\n  }\n\n  resume(client)\n}\n\nfunction emitDrain (client) {\n  client[kNeedDrain] = 0\n  client.emit('drain', client[kUrl], [client])\n}\n\nfunction resume (client, sync) {\n  if (client[kResuming] === 2) {\n    return\n  }\n\n  client[kResuming] = 2\n\n  _resume(client, sync)\n  client[kResuming] = 0\n\n  if (client[kRunningIdx] > 256) {\n    client[kQueue].splice(0, client[kRunningIdx])\n    client[kPendingIdx] -= client[kRunningIdx]\n    client[kRunningIdx] = 0\n  }\n}\n\nfunction _resume (client, sync) {\n  while (true) {\n    if (client.destroyed) {\n      assert(client[kPending] === 0)\n      return\n    }\n\n    if (client[kClosedResolve] && !client[kSize]) {\n      client[kClosedResolve]()\n      client[kClosedResolve] = null\n      return\n    }\n\n    const socket = client[kSocket]\n\n    if (socket && !socket.destroyed && socket.alpnProtocol !== 'h2') {\n      if (client[kSize] === 0) {\n        if (!socket[kNoRef] && socket.unref) {\n          socket.unref()\n          socket[kNoRef] = true\n        }\n      } else if (socket[kNoRef] && socket.ref) {\n        socket.ref()\n        socket[kNoRef] = false\n      }\n\n      if (client[kSize] === 0) {\n        if (socket[kParser].timeoutType !== TIMEOUT_IDLE) {\n          socket[kParser].setTimeout(client[kKeepAliveTimeoutValue], TIMEOUT_IDLE)\n        }\n      } else if (client[kRunning] > 0 && socket[kParser].statusCode < 200) {\n        if (socket[kParser].timeoutType !== TIMEOUT_HEADERS) {\n          const request = client[kQueue][client[kRunningIdx]]\n          const headersTimeout = request.headersTimeout != null\n            ? request.headersTimeout\n            : client[kHeadersTimeout]\n          socket[kParser].setTimeout(headersTimeout, TIMEOUT_HEADERS)\n        }\n      }\n    }\n\n    if (client[kBusy]) {\n      client[kNeedDrain] = 2\n    } else if (client[kNeedDrain] === 2) {\n      if (sync) {\n        client[kNeedDrain] = 1\n        process.nextTick(emitDrain, client)\n      } else {\n        emitDrain(client)\n      }\n      continue\n    }\n\n    if (client[kPending] === 0) {\n      return\n    }\n\n    if (client[kRunning] >= (client[kPipelining] || 1)) {\n      return\n    }\n\n    const request = client[kQueue][client[kPendingIdx]]\n\n    if (client[kUrl].protocol === 'https:' && client[kServerName] !== request.servername) {\n      if (client[kRunning] > 0) {\n        return\n      }\n\n      client[kServerName] = request.servername\n\n      if (socket && socket.servername !== request.servername) {\n        util.destroy(socket, new InformationalError('servername changed'))\n        return\n      }\n    }\n\n    if (client[kConnecting]) {\n      return\n    }\n\n    if (!socket && !client[kHTTP2Session]) {\n      connect(client)\n      return\n    }\n\n    if (socket.destroyed || socket[kWriting] || socket[kReset] || socket[kBlocking]) {\n      return\n    }\n\n    if (client[kRunning] > 0 && !request.idempotent) {\n      // Non-idempotent request cannot be retried.\n      // Ensure that no other requests are inflight and\n      // could cause failure.\n      return\n    }\n\n    if (client[kRunning] > 0 && (request.upgrade || request.method === 'CONNECT')) {\n      // Don't dispatch an upgrade until all preceding requests have completed.\n      // A misbehaving server might upgrade the connection before all pipelined\n      // request has completed.\n      return\n    }\n\n    if (client[kRunning] > 0 && util.bodyLength(request.body) !== 0 &&\n      (util.isStream(request.body) || util.isAsyncIterable(request.body))) {\n      // Request with stream or iterator body can error while other requests\n      // are inflight and indirectly error those as well.\n      // Ensure this doesn't happen by waiting for inflight\n      // to complete before dispatching.\n\n      // Request with stream or iterator body cannot be retried.\n      // Ensure that no other requests are inflight and\n      // could cause failure.\n      return\n    }\n\n    if (!request.aborted && write(client, request)) {\n      client[kPendingIdx]++\n    } else {\n      client[kQueue].splice(client[kPendingIdx], 1)\n    }\n  }\n}\n\n// https://www.rfc-editor.org/rfc/rfc7230#section-3.3.2\nfunction shouldSendContentLength (method) {\n  return method !== 'GET' && method !== 'HEAD' && method !== 'OPTIONS' && method !== 'TRACE' && method !== 'CONNECT'\n}\n\nfunction write (client, request) {\n  if (client[kHTTPConnVersion] === 'h2') {\n    writeH2(client, client[kHTTP2Session], request)\n    return\n  }\n\n  const { body, method, path, host, upgrade, headers, blocking, reset } = request\n\n  // https://tools.ietf.org/html/rfc7231#section-4.3.1\n  // https://tools.ietf.org/html/rfc7231#section-4.3.2\n  // https://tools.ietf.org/html/rfc7231#section-4.3.5\n\n  // Sending a payload body on a request that does not\n  // expect it can cause undefined behavior on some\n  // servers and corrupt connection state. Do not\n  // re-use the connection for further requests.\n\n  const expectsPayload = (\n    method === 'PUT' ||\n    method === 'POST' ||\n    method === 'PATCH'\n  )\n\n  if (body && typeof body.read === 'function') {\n    // Try to read EOF in order to get length.\n    body.read(0)\n  }\n\n  const bodyLength = util.bodyLength(body)\n\n  let contentLength = bodyLength\n\n  if (contentLength === null) {\n    contentLength = request.contentLength\n  }\n\n  if (contentLength === 0 && !expectsPayload) {\n    // https://tools.ietf.org/html/rfc7230#section-3.3.2\n    // A user agent SHOULD NOT send a Content-Length header field when\n    // the request message does not contain a payload body and the method\n    // semantics do not anticipate such a body.\n\n    contentLength = null\n  }\n\n  // https://github.com/nodejs/undici/issues/2046\n  // A user agent may send a Content-Length header with 0 value, this should be allowed.\n  if (shouldSendContentLength(method) && contentLength > 0 && request.contentLength !== null && request.contentLength !== contentLength) {\n    if (client[kStrictContentLength]) {\n      errorRequest(client, request, new RequestContentLengthMismatchError())\n      return false\n    }\n\n    process.emitWarning(new RequestContentLengthMismatchError())\n  }\n\n  const socket = client[kSocket]\n\n  try {\n    request.onConnect((err) => {\n      if (request.aborted || request.completed) {\n        return\n      }\n\n      errorRequest(client, request, err || new RequestAbortedError())\n\n      util.destroy(socket, new InformationalError('aborted'))\n    })\n  } catch (err) {\n    errorRequest(client, request, err)\n  }\n\n  if (request.aborted) {\n    return false\n  }\n\n  if (method === 'HEAD') {\n    // https://github.com/mcollina/undici/issues/258\n    // Close after a HEAD request to interop with misbehaving servers\n    // that may send a body in the response.\n\n    socket[kReset] = true\n  }\n\n  if (upgrade || method === 'CONNECT') {\n    // On CONNECT or upgrade, block pipeline from dispatching further\n    // requests on this connection.\n\n    socket[kReset] = true\n  }\n\n  if (reset != null) {\n    socket[kReset] = reset\n  }\n\n  if (client[kMaxRequests] && socket[kCounter]++ >= client[kMaxRequests]) {\n    socket[kReset] = true\n  }\n\n  if (blocking) {\n    socket[kBlocking] = true\n  }\n\n  let header = `${method} ${path} HTTP/1.1\\r\\n`\n\n  if (typeof host === 'string') {\n    header += `host: ${host}\\r\\n`\n  } else {\n    header += client[kHostHeader]\n  }\n\n  if (upgrade) {\n    header += `connection: upgrade\\r\\nupgrade: ${upgrade}\\r\\n`\n  } else if (client[kPipelining] && !socket[kReset]) {\n    header += 'connection: keep-alive\\r\\n'\n  } else {\n    header += 'connection: close\\r\\n'\n  }\n\n  if (headers) {\n    header += headers\n  }\n\n  if (channels.sendHeaders.hasSubscribers) {\n    channels.sendHeaders.publish({ request, headers: header, socket })\n  }\n\n  /* istanbul ignore else: assertion */\n  if (!body || bodyLength === 0) {\n    if (contentLength === 0) {\n      socket.write(`${header}content-length: 0\\r\\n\\r\\n`, 'latin1')\n    } else {\n      assert(contentLength === null, 'no body must not have content length')\n      socket.write(`${header}\\r\\n`, 'latin1')\n    }\n    request.onRequestSent()\n  } else if (util.isBuffer(body)) {\n    assert(contentLength === body.byteLength, 'buffer body must have content length')\n\n    socket.cork()\n    socket.write(`${header}content-length: ${contentLength}\\r\\n\\r\\n`, 'latin1')\n    socket.write(body)\n    socket.uncork()\n    request.onBodySent(body)\n    request.onRequestSent()\n    if (!expectsPayload) {\n      socket[kReset] = true\n    }\n  } else if (util.isBlobLike(body)) {\n    if (typeof body.stream === 'function') {\n      writeIterable({ body: body.stream(), client, request, socket, contentLength, header, expectsPayload })\n    } else {\n      writeBlob({ body, client, request, socket, contentLength, header, expectsPayload })\n    }\n  } else if (util.isStream(body)) {\n    writeStream({ body, client, request, socket, contentLength, header, expectsPayload })\n  } else if (util.isIterable(body)) {\n    writeIterable({ body, client, request, socket, contentLength, header, expectsPayload })\n  } else {\n    assert(false)\n  }\n\n  return true\n}\n\nfunction writeH2 (client, session, request) {\n  const { body, method, path, host, upgrade, expectContinue, signal, headers: reqHeaders } = request\n\n  let headers\n  if (typeof reqHeaders === 'string') headers = Request[kHTTP2CopyHeaders](reqHeaders.trim())\n  else headers = reqHeaders\n\n  if (upgrade) {\n    errorRequest(client, request, new Error('Upgrade not supported for H2'))\n    return false\n  }\n\n  try {\n    // TODO(HTTP/2): Should we call onConnect immediately or on stream ready event?\n    request.onConnect((err) => {\n      if (request.aborted || request.completed) {\n        return\n      }\n\n      errorRequest(client, request, err || new RequestAbortedError())\n    })\n  } catch (err) {\n    errorRequest(client, request, err)\n  }\n\n  if (request.aborted) {\n    return false\n  }\n\n  /** @type {import('node:http2').ClientHttp2Stream} */\n  let stream\n  const h2State = client[kHTTP2SessionState]\n\n  headers[HTTP2_HEADER_AUTHORITY] = host || client[kHost]\n  headers[HTTP2_HEADER_METHOD] = method\n\n  if (method === 'CONNECT') {\n    session.ref()\n    // we are already connected, streams are pending, first request\n    // will create a new stream. We trigger a request to create the stream and wait until\n    // `ready` event is triggered\n    // We disabled endStream to allow the user to write to the stream\n    stream = session.request(headers, { endStream: false, signal })\n\n    if (stream.id && !stream.pending) {\n      request.onUpgrade(null, null, stream)\n      ++h2State.openStreams\n    } else {\n      stream.once('ready', () => {\n        request.onUpgrade(null, null, stream)\n        ++h2State.openStreams\n      })\n    }\n\n    stream.once('close', () => {\n      h2State.openStreams -= 1\n      // TODO(HTTP/2): unref only if current streams count is 0\n      if (h2State.openStreams === 0) session.unref()\n    })\n\n    return true\n  }\n\n  // https://tools.ietf.org/html/rfc7540#section-8.3\n  // :path and :scheme headers must be omited when sending CONNECT\n\n  headers[HTTP2_HEADER_PATH] = path\n  headers[HTTP2_HEADER_SCHEME] = 'https'\n\n  // https://tools.ietf.org/html/rfc7231#section-4.3.1\n  // https://tools.ietf.org/html/rfc7231#section-4.3.2\n  // https://tools.ietf.org/html/rfc7231#section-4.3.5\n\n  // Sending a payload body on a request that does not\n  // expect it can cause undefined behavior on some\n  // servers and corrupt connection state. Do not\n  // re-use the connection for further requests.\n\n  const expectsPayload = (\n    method === 'PUT' ||\n    method === 'POST' ||\n    method === 'PATCH'\n  )\n\n  if (body && typeof body.read === 'function') {\n    // Try to read EOF in order to get length.\n    body.read(0)\n  }\n\n  let contentLength = util.bodyLength(body)\n\n  if (contentLength == null) {\n    contentLength = request.contentLength\n  }\n\n  if (contentLength === 0 || !expectsPayload) {\n    // https://tools.ietf.org/html/rfc7230#section-3.3.2\n    // A user agent SHOULD NOT send a Content-Length header field when\n    // the request message does not contain a payload body and the method\n    // semantics do not anticipate such a body.\n\n    contentLength = null\n  }\n\n  // https://github.com/nodejs/undici/issues/2046\n  // A user agent may send a Content-Length header with 0 value, this should be allowed.\n  if (shouldSendContentLength(method) && contentLength > 0 && request.contentLength != null && request.contentLength !== contentLength) {\n    if (client[kStrictContentLength]) {\n      errorRequest(client, request, new RequestContentLengthMismatchError())\n      return false\n    }\n\n    process.emitWarning(new RequestContentLengthMismatchError())\n  }\n\n  if (contentLength != null) {\n    assert(body, 'no body must not have content length')\n    headers[HTTP2_HEADER_CONTENT_LENGTH] = `${contentLength}`\n  }\n\n  session.ref()\n\n  const shouldEndStream = method === 'GET' || method === 'HEAD'\n  if (expectContinue) {\n    headers[HTTP2_HEADER_EXPECT] = '100-continue'\n    stream = session.request(headers, { endStream: shouldEndStream, signal })\n\n    stream.once('continue', writeBodyH2)\n  } else {\n    stream = session.request(headers, {\n      endStream: shouldEndStream,\n      signal\n    })\n    writeBodyH2()\n  }\n\n  // Increment counter as we have new several streams open\n  ++h2State.openStreams\n\n  stream.once('response', headers => {\n    const { [HTTP2_HEADER_STATUS]: statusCode, ...realHeaders } = headers\n\n    if (request.onHeaders(Number(statusCode), realHeaders, stream.resume.bind(stream), '') === false) {\n      stream.pause()\n    }\n  })\n\n  stream.once('end', () => {\n    request.onComplete([])\n  })\n\n  stream.on('data', (chunk) => {\n    if (request.onData(chunk) === false) {\n      stream.pause()\n    }\n  })\n\n  stream.once('close', () => {\n    h2State.openStreams -= 1\n    // TODO(HTTP/2): unref only if current streams count is 0\n    if (h2State.openStreams === 0) {\n      session.unref()\n    }\n  })\n\n  stream.once('error', function (err) {\n    if (client[kHTTP2Session] && !client[kHTTP2Session].destroyed && !this.closed && !this.destroyed) {\n      h2State.streams -= 1\n      util.destroy(stream, err)\n    }\n  })\n\n  stream.once('frameError', (type, code) => {\n    const err = new InformationalError(`HTTP/2: \"frameError\" received - type ${type}, code ${code}`)\n    errorRequest(client, request, err)\n\n    if (client[kHTTP2Session] && !client[kHTTP2Session].destroyed && !this.closed && !this.destroyed) {\n      h2State.streams -= 1\n      util.destroy(stream, err)\n    }\n  })\n\n  // stream.on('aborted', () => {\n  //   // TODO(HTTP/2): Support aborted\n  // })\n\n  // stream.on('timeout', () => {\n  //   // TODO(HTTP/2): Support timeout\n  // })\n\n  // stream.on('push', headers => {\n  //   // TODO(HTTP/2): Suppor push\n  // })\n\n  // stream.on('trailers', headers => {\n  //   // TODO(HTTP/2): Support trailers\n  // })\n\n  return true\n\n  function writeBodyH2 () {\n    /* istanbul ignore else: assertion */\n    if (!body) {\n      request.onRequestSent()\n    } else if (util.isBuffer(body)) {\n      assert(contentLength === body.byteLength, 'buffer body must have content length')\n      stream.cork()\n      stream.write(body)\n      stream.uncork()\n      stream.end()\n      request.onBodySent(body)\n      request.onRequestSent()\n    } else if (util.isBlobLike(body)) {\n      if (typeof body.stream === 'function') {\n        writeIterable({\n          client,\n          request,\n          contentLength,\n          h2stream: stream,\n          expectsPayload,\n          body: body.stream(),\n          socket: client[kSocket],\n          header: ''\n        })\n      } else {\n        writeBlob({\n          body,\n          client,\n          request,\n          contentLength,\n          expectsPayload,\n          h2stream: stream,\n          header: '',\n          socket: client[kSocket]\n        })\n      }\n    } else if (util.isStream(body)) {\n      writeStream({\n        body,\n        client,\n        request,\n        contentLength,\n        expectsPayload,\n        socket: client[kSocket],\n        h2stream: stream,\n        header: ''\n      })\n    } else if (util.isIterable(body)) {\n      writeIterable({\n        body,\n        client,\n        request,\n        contentLength,\n        expectsPayload,\n        header: '',\n        h2stream: stream,\n        socket: client[kSocket]\n      })\n    } else {\n      assert(false)\n    }\n  }\n}\n\nfunction writeStream ({ h2stream, body, client, request, socket, contentLength, header, expectsPayload }) {\n  assert(contentLength !== 0 || client[kRunning] === 0, 'stream body cannot be pipelined')\n\n  if (client[kHTTPConnVersion] === 'h2') {\n    // For HTTP/2, is enough to pipe the stream\n    const pipe = pipeline(\n      body,\n      h2stream,\n      (err) => {\n        if (err) {\n          util.destroy(body, err)\n          util.destroy(h2stream, err)\n        } else {\n          request.onRequestSent()\n        }\n      }\n    )\n\n    pipe.on('data', onPipeData)\n    pipe.once('end', () => {\n      pipe.removeListener('data', onPipeData)\n      util.destroy(pipe)\n    })\n\n    function onPipeData (chunk) {\n      request.onBodySent(chunk)\n    }\n\n    return\n  }\n\n  let finished = false\n\n  const writer = new AsyncWriter({ socket, request, contentLength, client, expectsPayload, header })\n\n  const onData = function (chunk) {\n    if (finished) {\n      return\n    }\n\n    try {\n      if (!writer.write(chunk) && this.pause) {\n        this.pause()\n      }\n    } catch (err) {\n      util.destroy(this, err)\n    }\n  }\n  const onDrain = function () {\n    if (finished) {\n      return\n    }\n\n    if (body.resume) {\n      body.resume()\n    }\n  }\n  const onAbort = function () {\n    if (finished) {\n      return\n    }\n    const err = new RequestAbortedError()\n    queueMicrotask(() => onFinished(err))\n  }\n  const onFinished = function (err) {\n    if (finished) {\n      return\n    }\n\n    finished = true\n\n    assert(socket.destroyed || (socket[kWriting] && client[kRunning] <= 1))\n\n    socket\n      .off('drain', onDrain)\n      .off('error', onFinished)\n\n    body\n      .removeListener('data', onData)\n      .removeListener('end', onFinished)\n      .removeListener('error', onFinished)\n      .removeListener('close', onAbort)\n\n    if (!err) {\n      try {\n        writer.end()\n      } catch (er) {\n        err = er\n      }\n    }\n\n    writer.destroy(err)\n\n    if (err && (err.code !== 'UND_ERR_INFO' || err.message !== 'reset')) {\n      util.destroy(body, err)\n    } else {\n      util.destroy(body)\n    }\n  }\n\n  body\n    .on('data', onData)\n    .on('end', onFinished)\n    .on('error', onFinished)\n    .on('close', onAbort)\n\n  if (body.resume) {\n    body.resume()\n  }\n\n  socket\n    .on('drain', onDrain)\n    .on('error', onFinished)\n}\n\nasync function writeBlob ({ h2stream, body, client, request, socket, contentLength, header, expectsPayload }) {\n  assert(contentLength === body.size, 'blob body must have content length')\n\n  const isH2 = client[kHTTPConnVersion] === 'h2'\n  try {\n    if (contentLength != null && contentLength !== body.size) {\n      throw new RequestContentLengthMismatchError()\n    }\n\n    const buffer = Buffer.from(await body.arrayBuffer())\n\n    if (isH2) {\n      h2stream.cork()\n      h2stream.write(buffer)\n      h2stream.uncork()\n    } else {\n      socket.cork()\n      socket.write(`${header}content-length: ${contentLength}\\r\\n\\r\\n`, 'latin1')\n      socket.write(buffer)\n      socket.uncork()\n    }\n\n    request.onBodySent(buffer)\n    request.onRequestSent()\n\n    if (!expectsPayload) {\n      socket[kReset] = true\n    }\n\n    resume(client)\n  } catch (err) {\n    util.destroy(isH2 ? h2stream : socket, err)\n  }\n}\n\nasync function writeIterable ({ h2stream, body, client, request, socket, contentLength, header, expectsPayload }) {\n  assert(contentLength !== 0 || client[kRunning] === 0, 'iterator body cannot be pipelined')\n\n  let callback = null\n  function onDrain () {\n    if (callback) {\n      const cb = callback\n      callback = null\n      cb()\n    }\n  }\n\n  const waitForDrain = () => new Promise((resolve, reject) => {\n    assert(callback === null)\n\n    if (socket[kError]) {\n      reject(socket[kError])\n    } else {\n      callback = resolve\n    }\n  })\n\n  if (client[kHTTPConnVersion] === 'h2') {\n    h2stream\n      .on('close', onDrain)\n      .on('drain', onDrain)\n\n    try {\n      // It's up to the user to somehow abort the async iterable.\n      for await (const chunk of body) {\n        if (socket[kError]) {\n          throw socket[kError]\n        }\n\n        const res = h2stream.write(chunk)\n        request.onBodySent(chunk)\n        if (!res) {\n          await waitForDrain()\n        }\n      }\n    } catch (err) {\n      h2stream.destroy(err)\n    } finally {\n      request.onRequestSent()\n      h2stream.end()\n      h2stream\n        .off('close', onDrain)\n        .off('drain', onDrain)\n    }\n\n    return\n  }\n\n  socket\n    .on('close', onDrain)\n    .on('drain', onDrain)\n\n  const writer = new AsyncWriter({ socket, request, contentLength, client, expectsPayload, header })\n  try {\n    // It's up to the user to somehow abort the async iterable.\n    for await (const chunk of body) {\n      if (socket[kError]) {\n        throw socket[kError]\n      }\n\n      if (!writer.write(chunk)) {\n        await waitForDrain()\n      }\n    }\n\n    writer.end()\n  } catch (err) {\n    writer.destroy(err)\n  } finally {\n    socket\n      .off('close', onDrain)\n      .off('drain', onDrain)\n  }\n}\n\nclass AsyncWriter {\n  constructor ({ socket, request, contentLength, client, expectsPayload, header }) {\n    this.socket = socket\n    this.request = request\n    this.contentLength = contentLength\n    this.client = client\n    this.bytesWritten = 0\n    this.expectsPayload = expectsPayload\n    this.header = header\n\n    socket[kWriting] = true\n  }\n\n  write (chunk) {\n    const { socket, request, contentLength, client, bytesWritten, expectsPayload, header } = this\n\n    if (socket[kError]) {\n      throw socket[kError]\n    }\n\n    if (socket.destroyed) {\n      return false\n    }\n\n    const len = Buffer.byteLength(chunk)\n    if (!len) {\n      return true\n    }\n\n    // We should defer writing chunks.\n    if (contentLength !== null && bytesWritten + len > contentLength) {\n      if (client[kStrictContentLength]) {\n        throw new RequestContentLengthMismatchError()\n      }\n\n      process.emitWarning(new RequestContentLengthMismatchError())\n    }\n\n    socket.cork()\n\n    if (bytesWritten === 0) {\n      if (!expectsPayload) {\n        socket[kReset] = true\n      }\n\n      if (contentLength === null) {\n        socket.write(`${header}transfer-encoding: chunked\\r\\n`, 'latin1')\n      } else {\n        socket.write(`${header}content-length: ${contentLength}\\r\\n\\r\\n`, 'latin1')\n      }\n    }\n\n    if (contentLength === null) {\n      socket.write(`\\r\\n${len.toString(16)}\\r\\n`, 'latin1')\n    }\n\n    this.bytesWritten += len\n\n    const ret = socket.write(chunk)\n\n    socket.uncork()\n\n    request.onBodySent(chunk)\n\n    if (!ret) {\n      if (socket[kParser].timeout && socket[kParser].timeoutType === TIMEOUT_HEADERS) {\n        // istanbul ignore else: only for jest\n        if (socket[kParser].timeout.refresh) {\n          socket[kParser].timeout.refresh()\n        }\n      }\n    }\n\n    return ret\n  }\n\n  end () {\n    const { socket, contentLength, client, bytesWritten, expectsPayload, header, request } = this\n    request.onRequestSent()\n\n    socket[kWriting] = false\n\n    if (socket[kError]) {\n      throw socket[kError]\n    }\n\n    if (socket.destroyed) {\n      return\n    }\n\n    if (bytesWritten === 0) {\n      if (expectsPayload) {\n        // https://tools.ietf.org/html/rfc7230#section-3.3.2\n        // A user agent SHOULD send a Content-Length in a request message when\n        // no Transfer-Encoding is sent and the request method defines a meaning\n        // for an enclosed payload body.\n\n        socket.write(`${header}content-length: 0\\r\\n\\r\\n`, 'latin1')\n      } else {\n        socket.write(`${header}\\r\\n`, 'latin1')\n      }\n    } else if (contentLength === null) {\n      socket.write('\\r\\n0\\r\\n\\r\\n', 'latin1')\n    }\n\n    if (contentLength !== null && bytesWritten !== contentLength) {\n      if (client[kStrictContentLength]) {\n        throw new RequestContentLengthMismatchError()\n      } else {\n        process.emitWarning(new RequestContentLengthMismatchError())\n      }\n    }\n\n    if (socket[kParser].timeout && socket[kParser].timeoutType === TIMEOUT_HEADERS) {\n      // istanbul ignore else: only for jest\n      if (socket[kParser].timeout.refresh) {\n        socket[kParser].timeout.refresh()\n      }\n    }\n\n    resume(client)\n  }\n\n  destroy (err) {\n    const { socket, client } = this\n\n    socket[kWriting] = false\n\n    if (err) {\n      assert(client[kRunning] <= 1, 'pipeline should only contain this request')\n      util.destroy(socket, err)\n    }\n  }\n}\n\nfunction errorRequest (client, request, err) {\n  try {\n    request.onError(err)\n    assert(request.aborted)\n  } catch (err) {\n    client.emit('error', err)\n  }\n}\n\nmodule.exports = Client\n","/* eslint-disable */\n\n'use strict'\n\n// Extracted from node/lib/internal/fixed_queue.js\n\n// Currently optimal queue size, tested on V8 6.0 - 6.6. Must be power of two.\nconst kSize = 2048;\nconst kMask = kSize - 1;\n\n// The FixedQueue is implemented as a singly-linked list of fixed-size\n// circular buffers. It looks something like this:\n//\n//  head                                                       tail\n//    |                                                          |\n//    v                                                          v\n// +-----------+ <-----\\       +-----------+ <------\\         +-----------+\n// |  [null]   |        \\----- |   next    |         \\------- |   next    |\n// +-----------+               +-----------+                  +-----------+\n// |   item    | <-- bottom    |   item    | <-- bottom       |  [empty]  |\n// |   item    |               |   item    |                  |  [empty]  |\n// |   item    |               |   item    |                  |  [empty]  |\n// |   item    |               |   item    |                  |  [empty]  |\n// |   item    |               |   item    |       bottom --> |   item    |\n// |   item    |               |   item    |                  |   item    |\n// |    ...    |               |    ...    |                  |    ...    |\n// |   item    |               |   item    |                  |   item    |\n// |   item    |               |   item    |                  |   item    |\n// |  [empty]  | <-- top       |   item    |                  |   item    |\n// |  [empty]  |               |   item    |                  |   item    |\n// |  [empty]  |               |  [empty]  | <-- top  top --> |  [empty]  |\n// +-----------+               +-----------+                  +-----------+\n//\n// Or, if there is only one circular buffer, it looks something\n// like either of these:\n//\n//  head   tail                                 head   tail\n//    |     |                                     |     |\n//    v     v                                     v     v\n// +-----------+                               +-----------+\n// |  [null]   |                               |  [null]   |\n// +-----------+                               +-----------+\n// |  [empty]  |                               |   item    |\n// |  [empty]  |                               |   item    |\n// |   item    | <-- bottom            top --> |  [empty]  |\n// |   item    |                               |  [empty]  |\n// |  [empty]  | <-- top            bottom --> |   item    |\n// |  [empty]  |                               |   item    |\n// +-----------+                               +-----------+\n//\n// Adding a value means moving `top` forward by one, removing means\n// moving `bottom` forward by one. After reaching the end, the queue\n// wraps around.\n//\n// When `top === bottom` the current queue is empty and when\n// `top + 1 === bottom` it's full. This wastes a single space of storage\n// but allows much quicker checks.\n\nclass FixedCircularBuffer {\n  constructor() {\n    this.bottom = 0;\n    this.top = 0;\n    this.list = new Array(kSize);\n    this.next = null;\n  }\n\n  isEmpty() {\n    return this.top === this.bottom;\n  }\n\n  isFull() {\n    return ((this.top + 1) & kMask) === this.bottom;\n  }\n\n  push(data) {\n    this.list[this.top] = data;\n    this.top = (this.top + 1) & kMask;\n  }\n\n  shift() {\n    const nextItem = this.list[this.bottom];\n    if (nextItem === undefined)\n      return null;\n    this.list[this.bottom] = undefined;\n    this.bottom = (this.bottom + 1) & kMask;\n    return nextItem;\n  }\n}\n\nmodule.exports = class FixedQueue {\n  constructor() {\n    this.head = this.tail = new FixedCircularBuffer();\n  }\n\n  isEmpty() {\n    return this.head.isEmpty();\n  }\n\n  push(data) {\n    if (this.head.isFull()) {\n      // Head is full: Creates a new queue, sets the old queue's `.next` to it,\n      // and sets it as the new main queue.\n      this.head = this.head.next = new FixedCircularBuffer();\n    }\n    this.head.push(data);\n  }\n\n  shift() {\n    const tail = this.tail;\n    const next = tail.shift();\n    if (tail.isEmpty() && tail.next !== null) {\n      // If there is another queue, it forms the new tail.\n      this.tail = tail.next;\n    }\n    return next;\n  }\n};\n","const { kFree, kConnected, kPending, kQueued, kRunning, kSize } = require('./core/symbols')\nconst kPool = Symbol('pool')\n\nclass PoolStats {\n  constructor (pool) {\n    this[kPool] = pool\n  }\n\n  get connected () {\n    return this[kPool][kConnected]\n  }\n\n  get free () {\n    return this[kPool][kFree]\n  }\n\n  get pending () {\n    return this[kPool][kPending]\n  }\n\n  get queued () {\n    return this[kPool][kQueued]\n  }\n\n  get running () {\n    return this[kPool][kRunning]\n  }\n\n  get size () {\n    return this[kPool][kSize]\n  }\n}\n\nmodule.exports = PoolStats\n","'use strict'\n\nconst DispatcherBase = require('./dispatcher-base')\nconst FixedQueue = require('./node/fixed-queue')\nconst { kConnected, kSize, kRunning, kPending, kQueued, kBusy, kFree, kUrl, kClose, kDestroy, kDispatch } = require('./core/symbols')\nconst PoolStats = require('./pool-stats')\n\nconst kClients = Symbol('clients')\nconst kNeedDrain = Symbol('needDrain')\nconst kQueue = Symbol('queue')\nconst kClosedResolve = Symbol('closed resolve')\nconst kOnDrain = Symbol('onDrain')\nconst kOnConnect = Symbol('onConnect')\nconst kOnDisconnect = Symbol('onDisconnect')\nconst kOnConnectionError = Symbol('onConnectionError')\nconst kGetDispatcher = Symbol('get dispatcher')\nconst kAddClient = Symbol('add client')\nconst kRemoveClient = Symbol('remove client')\nconst kStats = Symbol('stats')\n\nclass PoolBase extends DispatcherBase {\n  constructor () {\n    super()\n\n    this[kQueue] = new FixedQueue()\n    this[kClients] = []\n    this[kQueued] = 0\n\n    const pool = this\n\n    this[kOnDrain] = function onDrain (origin, targets) {\n      const queue = pool[kQueue]\n\n      let needDrain = false\n\n      while (!needDrain) {\n        const item = queue.shift()\n        if (!item) {\n          break\n        }\n        pool[kQueued]--\n        needDrain = !this.dispatch(item.opts, item.handler)\n      }\n\n      this[kNeedDrain] = needDrain\n\n      if (!this[kNeedDrain] && pool[kNeedDrain]) {\n        pool[kNeedDrain] = false\n        pool.emit('drain', origin, [pool, ...targets])\n      }\n\n      if (pool[kClosedResolve] && queue.isEmpty()) {\n        Promise\n          .all(pool[kClients].map(c => c.close()))\n          .then(pool[kClosedResolve])\n      }\n    }\n\n    this[kOnConnect] = (origin, targets) => {\n      pool.emit('connect', origin, [pool, ...targets])\n    }\n\n    this[kOnDisconnect] = (origin, targets, err) => {\n      pool.emit('disconnect', origin, [pool, ...targets], err)\n    }\n\n    this[kOnConnectionError] = (origin, targets, err) => {\n      pool.emit('connectionError', origin, [pool, ...targets], err)\n    }\n\n    this[kStats] = new PoolStats(this)\n  }\n\n  get [kBusy] () {\n    return this[kNeedDrain]\n  }\n\n  get [kConnected] () {\n    return this[kClients].filter(client => client[kConnected]).length\n  }\n\n  get [kFree] () {\n    return this[kClients].filter(client => client[kConnected] && !client[kNeedDrain]).length\n  }\n\n  get [kPending] () {\n    let ret = this[kQueued]\n    for (const { [kPending]: pending } of this[kClients]) {\n      ret += pending\n    }\n    return ret\n  }\n\n  get [kRunning] () {\n    let ret = 0\n    for (const { [kRunning]: running } of this[kClients]) {\n      ret += running\n    }\n    return ret\n  }\n\n  get [kSize] () {\n    let ret = this[kQueued]\n    for (const { [kSize]: size } of this[kClients]) {\n      ret += size\n    }\n    return ret\n  }\n\n  get stats () {\n    return this[kStats]\n  }\n\n  async [kClose] () {\n    if (this[kQueue].isEmpty()) {\n      return Promise.all(this[kClients].map(c => c.close()))\n    } else {\n      return new Promise((resolve) => {\n        this[kClosedResolve] = resolve\n      })\n    }\n  }\n\n  async [kDestroy] (err) {\n    while (true) {\n      const item = this[kQueue].shift()\n      if (!item) {\n        break\n      }\n      item.handler.onError(err)\n    }\n\n    return Promise.all(this[kClients].map(c => c.destroy(err)))\n  }\n\n  [kDispatch] (opts, handler) {\n    const dispatcher = this[kGetDispatcher]()\n\n    if (!dispatcher) {\n      this[kNeedDrain] = true\n      this[kQueue].push({ opts, handler })\n      this[kQueued]++\n    } else if (!dispatcher.dispatch(opts, handler)) {\n      dispatcher[kNeedDrain] = true\n      this[kNeedDrain] = !this[kGetDispatcher]()\n    }\n\n    return !this[kNeedDrain]\n  }\n\n  [kAddClient] (client) {\n    client\n      .on('drain', this[kOnDrain])\n      .on('connect', this[kOnConnect])\n      .on('disconnect', this[kOnDisconnect])\n      .on('connectionError', this[kOnConnectionError])\n\n    this[kClients].push(client)\n\n    if (this[kNeedDrain]) {\n      process.nextTick(() => {\n        if (this[kNeedDrain]) {\n          this[kOnDrain](client[kUrl], [this, client])\n        }\n      })\n    }\n\n    return this\n  }\n\n  [kRemoveClient] (client) {\n    client.close(() => {\n      const idx = this[kClients].indexOf(client)\n      if (idx !== -1) {\n        this[kClients].splice(idx, 1)\n      }\n    })\n\n    this[kNeedDrain] = this[kClients].some(dispatcher => (\n      !dispatcher[kNeedDrain] &&\n      dispatcher.closed !== true &&\n      dispatcher.destroyed !== true\n    ))\n  }\n}\n\nmodule.exports = {\n  PoolBase,\n  kClients,\n  kNeedDrain,\n  kAddClient,\n  kRemoveClient,\n  kGetDispatcher\n}\n","'use strict'\n\nconst {\n  PoolBase,\n  kClients,\n  kNeedDrain,\n  kAddClient,\n  kGetDispatcher\n} = require('./pool-base')\nconst Client = require('./client')\nconst {\n  InvalidArgumentError\n} = require('./core/errors')\nconst util = require('./core/util')\nconst { kUrl, kInterceptors } = require('./core/symbols')\nconst buildConnector = require('./core/connect')\n\nconst kOptions = Symbol('options')\nconst kConnections = Symbol('connections')\nconst kFactory = Symbol('factory')\n\nfunction defaultFactory (origin, opts) {\n  return new Client(origin, opts)\n}\n\nclass Pool extends PoolBase {\n  constructor (origin, {\n    connections,\n    factory = defaultFactory,\n    connect,\n    connectTimeout,\n    tls,\n    maxCachedSessions,\n    socketPath,\n    autoSelectFamily,\n    autoSelectFamilyAttemptTimeout,\n    allowH2,\n    ...options\n  } = {}) {\n    super()\n\n    if (connections != null && (!Number.isFinite(connections) || connections < 0)) {\n      throw new InvalidArgumentError('invalid connections')\n    }\n\n    if (typeof factory !== 'function') {\n      throw new InvalidArgumentError('factory must be a function.')\n    }\n\n    if (connect != null && typeof connect !== 'function' && typeof connect !== 'object') {\n      throw new InvalidArgumentError('connect must be a function or an object')\n    }\n\n    if (typeof connect !== 'function') {\n      connect = buildConnector({\n        ...tls,\n        maxCachedSessions,\n        allowH2,\n        socketPath,\n        timeout: connectTimeout,\n        ...(util.nodeHasAutoSelectFamily && autoSelectFamily ? { autoSelectFamily, autoSelectFamilyAttemptTimeout } : undefined),\n        ...connect\n      })\n    }\n\n    this[kInterceptors] = options.interceptors && options.interceptors.Pool && Array.isArray(options.interceptors.Pool)\n      ? options.interceptors.Pool\n      : []\n    this[kConnections] = connections || null\n    this[kUrl] = util.parseOrigin(origin)\n    this[kOptions] = { ...util.deepClone(options), connect, allowH2 }\n    this[kOptions].interceptors = options.interceptors\n      ? { ...options.interceptors }\n      : undefined\n    this[kFactory] = factory\n\n    this.on('connectionError', (origin, targets, error) => {\n      // If a connection error occurs, we remove the client from the pool,\n      // and emit a connectionError event. They will not be re-used.\n      // Fixes https://github.com/nodejs/undici/issues/3895\n      for (const target of targets) {\n        // Do not use kRemoveClient here, as it will close the client,\n        // but the client cannot be closed in this state.\n        const idx = this[kClients].indexOf(target)\n        if (idx !== -1) {\n          this[kClients].splice(idx, 1)\n        }\n      }\n    })\n  }\n\n  [kGetDispatcher] () {\n    let dispatcher = this[kClients].find(dispatcher => !dispatcher[kNeedDrain])\n\n    if (dispatcher) {\n      return dispatcher\n    }\n\n    if (!this[kConnections] || this[kClients].length < this[kConnections]) {\n      dispatcher = this[kFactory](this[kUrl], this[kOptions])\n      this[kAddClient](dispatcher)\n    }\n\n    return dispatcher\n  }\n}\n\nmodule.exports = Pool\n","'use strict'\n\nconst {\n  BalancedPoolMissingUpstreamError,\n  InvalidArgumentError\n} = require('./core/errors')\nconst {\n  PoolBase,\n  kClients,\n  kNeedDrain,\n  kAddClient,\n  kRemoveClient,\n  kGetDispatcher\n} = require('./pool-base')\nconst Pool = require('./pool')\nconst { kUrl, kInterceptors } = require('./core/symbols')\nconst { parseOrigin } = require('./core/util')\nconst kFactory = Symbol('factory')\n\nconst kOptions = Symbol('options')\nconst kGreatestCommonDivisor = Symbol('kGreatestCommonDivisor')\nconst kCurrentWeight = Symbol('kCurrentWeight')\nconst kIndex = Symbol('kIndex')\nconst kWeight = Symbol('kWeight')\nconst kMaxWeightPerServer = Symbol('kMaxWeightPerServer')\nconst kErrorPenalty = Symbol('kErrorPenalty')\n\nfunction getGreatestCommonDivisor (a, b) {\n  if (b === 0) return a\n  return getGreatestCommonDivisor(b, a % b)\n}\n\nfunction defaultFactory (origin, opts) {\n  return new Pool(origin, opts)\n}\n\nclass BalancedPool extends PoolBase {\n  constructor (upstreams = [], { factory = defaultFactory, ...opts } = {}) {\n    super()\n\n    this[kOptions] = opts\n    this[kIndex] = -1\n    this[kCurrentWeight] = 0\n\n    this[kMaxWeightPerServer] = this[kOptions].maxWeightPerServer || 100\n    this[kErrorPenalty] = this[kOptions].errorPenalty || 15\n\n    if (!Array.isArray(upstreams)) {\n      upstreams = [upstreams]\n    }\n\n    if (typeof factory !== 'function') {\n      throw new InvalidArgumentError('factory must be a function.')\n    }\n\n    this[kInterceptors] = opts.interceptors && opts.interceptors.BalancedPool && Array.isArray(opts.interceptors.BalancedPool)\n      ? opts.interceptors.BalancedPool\n      : []\n    this[kFactory] = factory\n\n    for (const upstream of upstreams) {\n      this.addUpstream(upstream)\n    }\n    this._updateBalancedPoolStats()\n  }\n\n  addUpstream (upstream) {\n    const upstreamOrigin = parseOrigin(upstream).origin\n\n    if (this[kClients].find((pool) => (\n      pool[kUrl].origin === upstreamOrigin &&\n      pool.closed !== true &&\n      pool.destroyed !== true\n    ))) {\n      return this\n    }\n    const pool = this[kFactory](upstreamOrigin, Object.assign({}, this[kOptions]))\n\n    this[kAddClient](pool)\n    pool.on('connect', () => {\n      pool[kWeight] = Math.min(this[kMaxWeightPerServer], pool[kWeight] + this[kErrorPenalty])\n    })\n\n    pool.on('connectionError', () => {\n      pool[kWeight] = Math.max(1, pool[kWeight] - this[kErrorPenalty])\n      this._updateBalancedPoolStats()\n    })\n\n    pool.on('disconnect', (...args) => {\n      const err = args[2]\n      if (err && err.code === 'UND_ERR_SOCKET') {\n        // decrease the weight of the pool.\n        pool[kWeight] = Math.max(1, pool[kWeight] - this[kErrorPenalty])\n        this._updateBalancedPoolStats()\n      }\n    })\n\n    for (const client of this[kClients]) {\n      client[kWeight] = this[kMaxWeightPerServer]\n    }\n\n    this._updateBalancedPoolStats()\n\n    return this\n  }\n\n  _updateBalancedPoolStats () {\n    this[kGreatestCommonDivisor] = this[kClients].map(p => p[kWeight]).reduce(getGreatestCommonDivisor, 0)\n  }\n\n  removeUpstream (upstream) {\n    const upstreamOrigin = parseOrigin(upstream).origin\n\n    const pool = this[kClients].find((pool) => (\n      pool[kUrl].origin === upstreamOrigin &&\n      pool.closed !== true &&\n      pool.destroyed !== true\n    ))\n\n    if (pool) {\n      this[kRemoveClient](pool)\n    }\n\n    return this\n  }\n\n  get upstreams () {\n    return this[kClients]\n      .filter(dispatcher => dispatcher.closed !== true && dispatcher.destroyed !== true)\n      .map((p) => p[kUrl].origin)\n  }\n\n  [kGetDispatcher] () {\n    // We validate that pools is greater than 0,\n    // otherwise we would have to wait until an upstream\n    // is added, which might never happen.\n    if (this[kClients].length === 0) {\n      throw new BalancedPoolMissingUpstreamError()\n    }\n\n    const dispatcher = this[kClients].find(dispatcher => (\n      !dispatcher[kNeedDrain] &&\n      dispatcher.closed !== true &&\n      dispatcher.destroyed !== true\n    ))\n\n    if (!dispatcher) {\n      return\n    }\n\n    const allClientsBusy = this[kClients].map(pool => pool[kNeedDrain]).reduce((a, b) => a && b, true)\n\n    if (allClientsBusy) {\n      return\n    }\n\n    let counter = 0\n\n    let maxWeightIndex = this[kClients].findIndex(pool => !pool[kNeedDrain])\n\n    while (counter++ < this[kClients].length) {\n      this[kIndex] = (this[kIndex] + 1) % this[kClients].length\n      const pool = this[kClients][this[kIndex]]\n\n      // find pool index with the largest weight\n      if (pool[kWeight] > this[kClients][maxWeightIndex][kWeight] && !pool[kNeedDrain]) {\n        maxWeightIndex = this[kIndex]\n      }\n\n      // decrease the current weight every `this[kClients].length`.\n      if (this[kIndex] === 0) {\n        // Set the current weight to the next lower weight.\n        this[kCurrentWeight] = this[kCurrentWeight] - this[kGreatestCommonDivisor]\n\n        if (this[kCurrentWeight] <= 0) {\n          this[kCurrentWeight] = this[kMaxWeightPerServer]\n        }\n      }\n      if (pool[kWeight] >= this[kCurrentWeight] && (!pool[kNeedDrain])) {\n        return pool\n      }\n    }\n\n    this[kCurrentWeight] = this[kClients][maxWeightIndex][kWeight]\n    this[kIndex] = maxWeightIndex\n    return this[kClients][maxWeightIndex]\n  }\n}\n\nmodule.exports = BalancedPool\n","'use strict'\n\n/* istanbul ignore file: only for Node 12 */\n\nconst { kConnected, kSize } = require('../core/symbols')\n\nclass CompatWeakRef {\n  constructor (value) {\n    this.value = value\n  }\n\n  deref () {\n    return this.value[kConnected] === 0 && this.value[kSize] === 0\n      ? undefined\n      : this.value\n  }\n}\n\nclass CompatFinalizer {\n  constructor (finalizer) {\n    this.finalizer = finalizer\n  }\n\n  register (dispatcher, key) {\n    if (dispatcher.on) {\n      dispatcher.on('disconnect', () => {\n        if (dispatcher[kConnected] === 0 && dispatcher[kSize] === 0) {\n          this.finalizer(key)\n        }\n      })\n    }\n  }\n}\n\nmodule.exports = function () {\n  // FIXME: remove workaround when the Node bug is fixed\n  // https://github.com/nodejs/node/issues/49344#issuecomment-1741776308\n  if (process.env.NODE_V8_COVERAGE) {\n    return {\n      WeakRef: CompatWeakRef,\n      FinalizationRegistry: CompatFinalizer\n    }\n  }\n  return {\n    WeakRef: global.WeakRef || CompatWeakRef,\n    FinalizationRegistry: global.FinalizationRegistry || CompatFinalizer\n  }\n}\n","'use strict'\n\nconst { InvalidArgumentError } = require('./core/errors')\nconst { kClients, kRunning, kClose, kDestroy, kDispatch, kInterceptors } = require('./core/symbols')\nconst DispatcherBase = require('./dispatcher-base')\nconst Pool = require('./pool')\nconst Client = require('./client')\nconst util = require('./core/util')\nconst createRedirectInterceptor = require('./interceptor/redirectInterceptor')\nconst { WeakRef, FinalizationRegistry } = require('./compat/dispatcher-weakref')()\n\nconst kOnConnect = Symbol('onConnect')\nconst kOnDisconnect = Symbol('onDisconnect')\nconst kOnConnectionError = Symbol('onConnectionError')\nconst kMaxRedirections = Symbol('maxRedirections')\nconst kOnDrain = Symbol('onDrain')\nconst kFactory = Symbol('factory')\nconst kFinalizer = Symbol('finalizer')\nconst kOptions = Symbol('options')\n\nfunction defaultFactory (origin, opts) {\n  return opts && opts.connections === 1\n    ? new Client(origin, opts)\n    : new Pool(origin, opts)\n}\n\nclass Agent extends DispatcherBase {\n  constructor ({ factory = defaultFactory, maxRedirections = 0, connect, ...options } = {}) {\n    super()\n\n    if (typeof factory !== 'function') {\n      throw new InvalidArgumentError('factory must be a function.')\n    }\n\n    if (connect != null && typeof connect !== 'function' && typeof connect !== 'object') {\n      throw new InvalidArgumentError('connect must be a function or an object')\n    }\n\n    if (!Number.isInteger(maxRedirections) || maxRedirections < 0) {\n      throw new InvalidArgumentError('maxRedirections must be a positive number')\n    }\n\n    if (connect && typeof connect !== 'function') {\n      connect = { ...connect }\n    }\n\n    this[kInterceptors] = options.interceptors && options.interceptors.Agent && Array.isArray(options.interceptors.Agent)\n      ? options.interceptors.Agent\n      : [createRedirectInterceptor({ maxRedirections })]\n\n    this[kOptions] = { ...util.deepClone(options), connect }\n    this[kOptions].interceptors = options.interceptors\n      ? { ...options.interceptors }\n      : undefined\n    this[kMaxRedirections] = maxRedirections\n    this[kFactory] = factory\n    this[kClients] = new Map()\n    this[kFinalizer] = new FinalizationRegistry(/* istanbul ignore next: gc is undeterministic */ key => {\n      const ref = this[kClients].get(key)\n      if (ref !== undefined && ref.deref() === undefined) {\n        this[kClients].delete(key)\n      }\n    })\n\n    const agent = this\n\n    this[kOnDrain] = (origin, targets) => {\n      agent.emit('drain', origin, [agent, ...targets])\n    }\n\n    this[kOnConnect] = (origin, targets) => {\n      agent.emit('connect', origin, [agent, ...targets])\n    }\n\n    this[kOnDisconnect] = (origin, targets, err) => {\n      agent.emit('disconnect', origin, [agent, ...targets], err)\n    }\n\n    this[kOnConnectionError] = (origin, targets, err) => {\n      agent.emit('connectionError', origin, [agent, ...targets], err)\n    }\n  }\n\n  get [kRunning] () {\n    let ret = 0\n    for (const ref of this[kClients].values()) {\n      const client = ref.deref()\n      /* istanbul ignore next: gc is undeterministic */\n      if (client) {\n        ret += client[kRunning]\n      }\n    }\n    return ret\n  }\n\n  [kDispatch] (opts, handler) {\n    let key\n    if (opts.origin && (typeof opts.origin === 'string' || opts.origin instanceof URL)) {\n      key = String(opts.origin)\n    } else {\n      throw new InvalidArgumentError('opts.origin must be a non-empty string or URL.')\n    }\n\n    const ref = this[kClients].get(key)\n\n    let dispatcher = ref ? ref.deref() : null\n    if (!dispatcher) {\n      dispatcher = this[kFactory](opts.origin, this[kOptions])\n        .on('drain', this[kOnDrain])\n        .on('connect', this[kOnConnect])\n        .on('disconnect', this[kOnDisconnect])\n        .on('connectionError', this[kOnConnectionError])\n\n      this[kClients].set(key, new WeakRef(dispatcher))\n      this[kFinalizer].register(dispatcher, key)\n    }\n\n    return dispatcher.dispatch(opts, handler)\n  }\n\n  async [kClose] () {\n    const closePromises = []\n    for (const ref of this[kClients].values()) {\n      const client = ref.deref()\n      /* istanbul ignore else: gc is undeterministic */\n      if (client) {\n        closePromises.push(client.close())\n      }\n    }\n\n    await Promise.all(closePromises)\n  }\n\n  async [kDestroy] (err) {\n    const destroyPromises = []\n    for (const ref of this[kClients].values()) {\n      const client = ref.deref()\n      /* istanbul ignore else: gc is undeterministic */\n      if (client) {\n        destroyPromises.push(client.destroy(err))\n      }\n    }\n\n    await Promise.all(destroyPromises)\n  }\n}\n\nmodule.exports = Agent\n","// Ported from https://github.com/nodejs/undici/pull/907\n\n'use strict'\n\nconst assert = require('assert')\nconst { Readable } = require('stream')\nconst { RequestAbortedError, NotSupportedError, InvalidArgumentError } = require('../core/errors')\nconst util = require('../core/util')\nconst { ReadableStreamFrom, toUSVString } = require('../core/util')\n\nlet Blob\n\nconst kConsume = Symbol('kConsume')\nconst kReading = Symbol('kReading')\nconst kBody = Symbol('kBody')\nconst kAbort = Symbol('abort')\nconst kContentType = Symbol('kContentType')\n\nconst noop = () => {}\n\nmodule.exports = class BodyReadable extends Readable {\n  constructor ({\n    resume,\n    abort,\n    contentType = '',\n    highWaterMark = 64 * 1024 // Same as nodejs fs streams.\n  }) {\n    super({\n      autoDestroy: true,\n      read: resume,\n      highWaterMark\n    })\n\n    this._readableState.dataEmitted = false\n\n    this[kAbort] = abort\n    this[kConsume] = null\n    this[kBody] = null\n    this[kContentType] = contentType\n\n    // Is stream being consumed through Readable API?\n    // This is an optimization so that we avoid checking\n    // for 'data' and 'readable' listeners in the hot path\n    // inside push().\n    this[kReading] = false\n  }\n\n  destroy (err) {\n    if (this.destroyed) {\n      // Node < 16\n      return this\n    }\n\n    if (!err && !this._readableState.endEmitted) {\n      err = new RequestAbortedError()\n    }\n\n    if (err) {\n      this[kAbort]()\n    }\n\n    return super.destroy(err)\n  }\n\n  emit (ev, ...args) {\n    if (ev === 'data') {\n      // Node < 16.7\n      this._readableState.dataEmitted = true\n    } else if (ev === 'error') {\n      // Node < 16\n      this._readableState.errorEmitted = true\n    }\n    return super.emit(ev, ...args)\n  }\n\n  on (ev, ...args) {\n    if (ev === 'data' || ev === 'readable') {\n      this[kReading] = true\n    }\n    return super.on(ev, ...args)\n  }\n\n  addListener (ev, ...args) {\n    return this.on(ev, ...args)\n  }\n\n  off (ev, ...args) {\n    const ret = super.off(ev, ...args)\n    if (ev === 'data' || ev === 'readable') {\n      this[kReading] = (\n        this.listenerCount('data') > 0 ||\n        this.listenerCount('readable') > 0\n      )\n    }\n    return ret\n  }\n\n  removeListener (ev, ...args) {\n    return this.off(ev, ...args)\n  }\n\n  push (chunk) {\n    if (this[kConsume] && chunk !== null && this.readableLength === 0) {\n      consumePush(this[kConsume], chunk)\n      return this[kReading] ? super.push(chunk) : true\n    }\n    return super.push(chunk)\n  }\n\n  // https://fetch.spec.whatwg.org/#dom-body-text\n  async text () {\n    return consume(this, 'text')\n  }\n\n  // https://fetch.spec.whatwg.org/#dom-body-json\n  async json () {\n    return consume(this, 'json')\n  }\n\n  // https://fetch.spec.whatwg.org/#dom-body-blob\n  async blob () {\n    return consume(this, 'blob')\n  }\n\n  // https://fetch.spec.whatwg.org/#dom-body-arraybuffer\n  async arrayBuffer () {\n    return consume(this, 'arrayBuffer')\n  }\n\n  // https://fetch.spec.whatwg.org/#dom-body-formdata\n  async formData () {\n    // TODO: Implement.\n    throw new NotSupportedError()\n  }\n\n  // https://fetch.spec.whatwg.org/#dom-body-bodyused\n  get bodyUsed () {\n    return util.isDisturbed(this)\n  }\n\n  // https://fetch.spec.whatwg.org/#dom-body-body\n  get body () {\n    if (!this[kBody]) {\n      this[kBody] = ReadableStreamFrom(this)\n      if (this[kConsume]) {\n        // TODO: Is this the best way to force a lock?\n        this[kBody].getReader() // Ensure stream is locked.\n        assert(this[kBody].locked)\n      }\n    }\n    return this[kBody]\n  }\n\n  dump (opts) {\n    let limit = opts && Number.isFinite(opts.limit) ? opts.limit : 262144\n    const signal = opts && opts.signal\n\n    if (signal) {\n      try {\n        if (typeof signal !== 'object' || !('aborted' in signal)) {\n          throw new InvalidArgumentError('signal must be an AbortSignal')\n        }\n        util.throwIfAborted(signal)\n      } catch (err) {\n        return Promise.reject(err)\n      }\n    }\n\n    if (this.closed) {\n      return Promise.resolve(null)\n    }\n\n    return new Promise((resolve, reject) => {\n      const signalListenerCleanup = signal\n        ? util.addAbortListener(signal, () => {\n          this.destroy()\n        })\n        : noop\n\n      this\n        .on('close', function () {\n          signalListenerCleanup()\n          if (signal && signal.aborted) {\n            reject(signal.reason || Object.assign(new Error('The operation was aborted'), { name: 'AbortError' }))\n          } else {\n            resolve(null)\n          }\n        })\n        .on('error', noop)\n        .on('data', function (chunk) {\n          limit -= chunk.length\n          if (limit <= 0) {\n            this.destroy()\n          }\n        })\n        .resume()\n    })\n  }\n}\n\n// https://streams.spec.whatwg.org/#readablestream-locked\nfunction isLocked (self) {\n  // Consume is an implicit lock.\n  return (self[kBody] && self[kBody].locked === true) || self[kConsume]\n}\n\n// https://fetch.spec.whatwg.org/#body-unusable\nfunction isUnusable (self) {\n  return util.isDisturbed(self) || isLocked(self)\n}\n\nasync function consume (stream, type) {\n  if (isUnusable(stream)) {\n    throw new TypeError('unusable')\n  }\n\n  assert(!stream[kConsume])\n\n  return new Promise((resolve, reject) => {\n    stream[kConsume] = {\n      type,\n      stream,\n      resolve,\n      reject,\n      length: 0,\n      body: []\n    }\n\n    stream\n      .on('error', function (err) {\n        consumeFinish(this[kConsume], err)\n      })\n      .on('close', function () {\n        if (this[kConsume].body !== null) {\n          consumeFinish(this[kConsume], new RequestAbortedError())\n        }\n      })\n\n    process.nextTick(consumeStart, stream[kConsume])\n  })\n}\n\nfunction consumeStart (consume) {\n  if (consume.body === null) {\n    return\n  }\n\n  const { _readableState: state } = consume.stream\n\n  for (const chunk of state.buffer) {\n    consumePush(consume, chunk)\n  }\n\n  if (state.endEmitted) {\n    consumeEnd(this[kConsume])\n  } else {\n    consume.stream.on('end', function () {\n      consumeEnd(this[kConsume])\n    })\n  }\n\n  consume.stream.resume()\n\n  while (consume.stream.read() != null) {\n    // Loop\n  }\n}\n\nfunction consumeEnd (consume) {\n  const { type, body, resolve, stream, length } = consume\n\n  try {\n    if (type === 'text') {\n      resolve(toUSVString(Buffer.concat(body)))\n    } else if (type === 'json') {\n      resolve(JSON.parse(Buffer.concat(body)))\n    } else if (type === 'arrayBuffer') {\n      const dst = new Uint8Array(length)\n\n      let pos = 0\n      for (const buf of body) {\n        dst.set(buf, pos)\n        pos += buf.byteLength\n      }\n\n      resolve(dst.buffer)\n    } else if (type === 'blob') {\n      if (!Blob) {\n        Blob = require('buffer').Blob\n      }\n      resolve(new Blob(body, { type: stream[kContentType] }))\n    }\n\n    consumeFinish(consume)\n  } catch (err) {\n    stream.destroy(err)\n  }\n}\n\nfunction consumePush (consume, chunk) {\n  consume.length += chunk.length\n  consume.body.push(chunk)\n}\n\nfunction consumeFinish (consume, err) {\n  if (consume.body === null) {\n    return\n  }\n\n  if (err) {\n    consume.reject(err)\n  } else {\n    consume.resolve()\n  }\n\n  consume.type = null\n  consume.stream = null\n  consume.resolve = null\n  consume.reject = null\n  consume.length = 0\n  consume.body = null\n}\n","const assert = require('assert')\nconst {\n  ResponseStatusCodeError\n} = require('../core/errors')\nconst { toUSVString } = require('../core/util')\n\nasync function getResolveErrorBodyCallback ({ callback, body, contentType, statusCode, statusMessage, headers }) {\n  assert(body)\n\n  let chunks = []\n  let limit = 0\n\n  for await (const chunk of body) {\n    chunks.push(chunk)\n    limit += chunk.length\n    if (limit > 128 * 1024) {\n      chunks = null\n      break\n    }\n  }\n\n  if (statusCode === 204 || !contentType || !chunks) {\n    process.nextTick(callback, new ResponseStatusCodeError(`Response status code ${statusCode}${statusMessage ? `: ${statusMessage}` : ''}`, statusCode, headers))\n    return\n  }\n\n  try {\n    if (contentType.startsWith('application/json')) {\n      const payload = JSON.parse(toUSVString(Buffer.concat(chunks)))\n      process.nextTick(callback, new ResponseStatusCodeError(`Response status code ${statusCode}${statusMessage ? `: ${statusMessage}` : ''}`, statusCode, headers, payload))\n      return\n    }\n\n    if (contentType.startsWith('text/')) {\n      const payload = toUSVString(Buffer.concat(chunks))\n      process.nextTick(callback, new ResponseStatusCodeError(`Response status code ${statusCode}${statusMessage ? `: ${statusMessage}` : ''}`, statusCode, headers, payload))\n      return\n    }\n  } catch (err) {\n    // Process in a fallback if error\n  }\n\n  process.nextTick(callback, new ResponseStatusCodeError(`Response status code ${statusCode}${statusMessage ? `: ${statusMessage}` : ''}`, statusCode, headers))\n}\n\nmodule.exports = { getResolveErrorBodyCallback }\n","const { addAbortListener } = require('../core/util')\nconst { RequestAbortedError } = require('../core/errors')\n\nconst kListener = Symbol('kListener')\nconst kSignal = Symbol('kSignal')\n\nfunction abort (self) {\n  if (self.abort) {\n    self.abort()\n  } else {\n    self.onError(new RequestAbortedError())\n  }\n}\n\nfunction addSignal (self, signal) {\n  self[kSignal] = null\n  self[kListener] = null\n\n  if (!signal) {\n    return\n  }\n\n  if (signal.aborted) {\n    abort(self)\n    return\n  }\n\n  self[kSignal] = signal\n  self[kListener] = () => {\n    abort(self)\n  }\n\n  addAbortListener(self[kSignal], self[kListener])\n}\n\nfunction removeSignal (self) {\n  if (!self[kSignal]) {\n    return\n  }\n\n  if ('removeEventListener' in self[kSignal]) {\n    self[kSignal].removeEventListener('abort', self[kListener])\n  } else {\n    self[kSignal].removeListener('abort', self[kListener])\n  }\n\n  self[kSignal] = null\n  self[kListener] = null\n}\n\nmodule.exports = {\n  addSignal,\n  removeSignal\n}\n","'use strict'\n\nconst Readable = require('./readable')\nconst {\n  InvalidArgumentError,\n  RequestAbortedError\n} = require('../core/errors')\nconst util = require('../core/util')\nconst { getResolveErrorBodyCallback } = require('./util')\nconst { AsyncResource } = require('async_hooks')\nconst { addSignal, removeSignal } = require('./abort-signal')\n\nclass RequestHandler extends AsyncResource {\n  constructor (opts, callback) {\n    if (!opts || typeof opts !== 'object') {\n      throw new InvalidArgumentError('invalid opts')\n    }\n\n    const { signal, method, opaque, body, onInfo, responseHeaders, throwOnError, highWaterMark } = opts\n\n    try {\n      if (typeof callback !== 'function') {\n        throw new InvalidArgumentError('invalid callback')\n      }\n\n      if (highWaterMark && (typeof highWaterMark !== 'number' || highWaterMark < 0)) {\n        throw new InvalidArgumentError('invalid highWaterMark')\n      }\n\n      if (signal && typeof signal.on !== 'function' && typeof signal.addEventListener !== 'function') {\n        throw new InvalidArgumentError('signal must be an EventEmitter or EventTarget')\n      }\n\n      if (method === 'CONNECT') {\n        throw new InvalidArgumentError('invalid method')\n      }\n\n      if (onInfo && typeof onInfo !== 'function') {\n        throw new InvalidArgumentError('invalid onInfo callback')\n      }\n\n      super('UNDICI_REQUEST')\n    } catch (err) {\n      if (util.isStream(body)) {\n        util.destroy(body.on('error', util.nop), err)\n      }\n      throw err\n    }\n\n    this.responseHeaders = responseHeaders || null\n    this.opaque = opaque || null\n    this.callback = callback\n    this.res = null\n    this.abort = null\n    this.body = body\n    this.trailers = {}\n    this.context = null\n    this.onInfo = onInfo || null\n    this.throwOnError = throwOnError\n    this.highWaterMark = highWaterMark\n\n    if (util.isStream(body)) {\n      body.on('error', (err) => {\n        this.onError(err)\n      })\n    }\n\n    addSignal(this, signal)\n  }\n\n  onConnect (abort, context) {\n    if (!this.callback) {\n      throw new RequestAbortedError()\n    }\n\n    this.abort = abort\n    this.context = context\n  }\n\n  onHeaders (statusCode, rawHeaders, resume, statusMessage) {\n    const { callback, opaque, abort, context, responseHeaders, highWaterMark } = this\n\n    const headers = responseHeaders === 'raw' ? util.parseRawHeaders(rawHeaders) : util.parseHeaders(rawHeaders)\n\n    if (statusCode < 200) {\n      if (this.onInfo) {\n        this.onInfo({ statusCode, headers })\n      }\n      return\n    }\n\n    const parsedHeaders = responseHeaders === 'raw' ? util.parseHeaders(rawHeaders) : headers\n    const contentType = parsedHeaders['content-type']\n    const body = new Readable({ resume, abort, contentType, highWaterMark })\n\n    this.callback = null\n    this.res = body\n    if (callback !== null) {\n      if (this.throwOnError && statusCode >= 400) {\n        this.runInAsyncScope(getResolveErrorBodyCallback, null,\n          { callback, body, contentType, statusCode, statusMessage, headers }\n        )\n      } else {\n        this.runInAsyncScope(callback, null, null, {\n          statusCode,\n          headers,\n          trailers: this.trailers,\n          opaque,\n          body,\n          context\n        })\n      }\n    }\n  }\n\n  onData (chunk) {\n    const { res } = this\n    return res.push(chunk)\n  }\n\n  onComplete (trailers) {\n    const { res } = this\n\n    removeSignal(this)\n\n    util.parseHeaders(trailers, this.trailers)\n\n    res.push(null)\n  }\n\n  onError (err) {\n    const { res, callback, body, opaque } = this\n\n    removeSignal(this)\n\n    if (callback) {\n      // TODO: Does this need queueMicrotask?\n      this.callback = null\n      queueMicrotask(() => {\n        this.runInAsyncScope(callback, null, err, { opaque })\n      })\n    }\n\n    if (res) {\n      this.res = null\n      // Ensure all queued handlers are invoked before destroying res.\n      queueMicrotask(() => {\n        util.destroy(res, err)\n      })\n    }\n\n    if (body) {\n      this.body = null\n      util.destroy(body, err)\n    }\n  }\n}\n\nfunction request (opts, callback) {\n  if (callback === undefined) {\n    return new Promise((resolve, reject) => {\n      request.call(this, opts, (err, data) => {\n        return err ? reject(err) : resolve(data)\n      })\n    })\n  }\n\n  try {\n    this.dispatch(opts, new RequestHandler(opts, callback))\n  } catch (err) {\n    if (typeof callback !== 'function') {\n      throw err\n    }\n    const opaque = opts && opts.opaque\n    queueMicrotask(() => callback(err, { opaque }))\n  }\n}\n\nmodule.exports = request\nmodule.exports.RequestHandler = RequestHandler\n","'use strict'\n\nconst { finished, PassThrough } = require('stream')\nconst {\n  InvalidArgumentError,\n  InvalidReturnValueError,\n  RequestAbortedError\n} = require('../core/errors')\nconst util = require('../core/util')\nconst { getResolveErrorBodyCallback } = require('./util')\nconst { AsyncResource } = require('async_hooks')\nconst { addSignal, removeSignal } = require('./abort-signal')\n\nclass StreamHandler extends AsyncResource {\n  constructor (opts, factory, callback) {\n    if (!opts || typeof opts !== 'object') {\n      throw new InvalidArgumentError('invalid opts')\n    }\n\n    const { signal, method, opaque, body, onInfo, responseHeaders, throwOnError } = opts\n\n    try {\n      if (typeof callback !== 'function') {\n        throw new InvalidArgumentError('invalid callback')\n      }\n\n      if (typeof factory !== 'function') {\n        throw new InvalidArgumentError('invalid factory')\n      }\n\n      if (signal && typeof signal.on !== 'function' && typeof signal.addEventListener !== 'function') {\n        throw new InvalidArgumentError('signal must be an EventEmitter or EventTarget')\n      }\n\n      if (method === 'CONNECT') {\n        throw new InvalidArgumentError('invalid method')\n      }\n\n      if (onInfo && typeof onInfo !== 'function') {\n        throw new InvalidArgumentError('invalid onInfo callback')\n      }\n\n      super('UNDICI_STREAM')\n    } catch (err) {\n      if (util.isStream(body)) {\n        util.destroy(body.on('error', util.nop), err)\n      }\n      throw err\n    }\n\n    this.responseHeaders = responseHeaders || null\n    this.opaque = opaque || null\n    this.factory = factory\n    this.callback = callback\n    this.res = null\n    this.abort = null\n    this.context = null\n    this.trailers = null\n    this.body = body\n    this.onInfo = onInfo || null\n    this.throwOnError = throwOnError || false\n\n    if (util.isStream(body)) {\n      body.on('error', (err) => {\n        this.onError(err)\n      })\n    }\n\n    addSignal(this, signal)\n  }\n\n  onConnect (abort, context) {\n    if (!this.callback) {\n      throw new RequestAbortedError()\n    }\n\n    this.abort = abort\n    this.context = context\n  }\n\n  onHeaders (statusCode, rawHeaders, resume, statusMessage) {\n    const { factory, opaque, context, callback, responseHeaders } = this\n\n    const headers = responseHeaders === 'raw' ? util.parseRawHeaders(rawHeaders) : util.parseHeaders(rawHeaders)\n\n    if (statusCode < 200) {\n      if (this.onInfo) {\n        this.onInfo({ statusCode, headers })\n      }\n      return\n    }\n\n    this.factory = null\n\n    let res\n\n    if (this.throwOnError && statusCode >= 400) {\n      const parsedHeaders = responseHeaders === 'raw' ? util.parseHeaders(rawHeaders) : headers\n      const contentType = parsedHeaders['content-type']\n      res = new PassThrough()\n\n      this.callback = null\n      this.runInAsyncScope(getResolveErrorBodyCallback, null,\n        { callback, body: res, contentType, statusCode, statusMessage, headers }\n      )\n    } else {\n      if (factory === null) {\n        return\n      }\n\n      res = this.runInAsyncScope(factory, null, {\n        statusCode,\n        headers,\n        opaque,\n        context\n      })\n\n      if (\n        !res ||\n        typeof res.write !== 'function' ||\n        typeof res.end !== 'function' ||\n        typeof res.on !== 'function'\n      ) {\n        throw new InvalidReturnValueError('expected Writable')\n      }\n\n      // TODO: Avoid finished. It registers an unnecessary amount of listeners.\n      finished(res, { readable: false }, (err) => {\n        const { callback, res, opaque, trailers, abort } = this\n\n        this.res = null\n        if (err || !res.readable) {\n          util.destroy(res, err)\n        }\n\n        this.callback = null\n        this.runInAsyncScope(callback, null, err || null, { opaque, trailers })\n\n        if (err) {\n          abort()\n        }\n      })\n    }\n\n    res.on('drain', resume)\n\n    this.res = res\n\n    const needDrain = res.writableNeedDrain !== undefined\n      ? res.writableNeedDrain\n      : res._writableState && res._writableState.needDrain\n\n    return needDrain !== true\n  }\n\n  onData (chunk) {\n    const { res } = this\n\n    return res ? res.write(chunk) : true\n  }\n\n  onComplete (trailers) {\n    const { res } = this\n\n    removeSignal(this)\n\n    if (!res) {\n      return\n    }\n\n    this.trailers = util.parseHeaders(trailers)\n\n    res.end()\n  }\n\n  onError (err) {\n    const { res, callback, opaque, body } = this\n\n    removeSignal(this)\n\n    this.factory = null\n\n    if (res) {\n      this.res = null\n      util.destroy(res, err)\n    } else if (callback) {\n      this.callback = null\n      queueMicrotask(() => {\n        this.runInAsyncScope(callback, null, err, { opaque })\n      })\n    }\n\n    if (body) {\n      this.body = null\n      util.destroy(body, err)\n    }\n  }\n}\n\nfunction stream (opts, factory, callback) {\n  if (callback === undefined) {\n    return new Promise((resolve, reject) => {\n      stream.call(this, opts, factory, (err, data) => {\n        return err ? reject(err) : resolve(data)\n      })\n    })\n  }\n\n  try {\n    this.dispatch(opts, new StreamHandler(opts, factory, callback))\n  } catch (err) {\n    if (typeof callback !== 'function') {\n      throw err\n    }\n    const opaque = opts && opts.opaque\n    queueMicrotask(() => callback(err, { opaque }))\n  }\n}\n\nmodule.exports = stream\n","'use strict'\n\nconst {\n  Readable,\n  Duplex,\n  PassThrough\n} = require('stream')\nconst {\n  InvalidArgumentError,\n  InvalidReturnValueError,\n  RequestAbortedError\n} = require('../core/errors')\nconst util = require('../core/util')\nconst { AsyncResource } = require('async_hooks')\nconst { addSignal, removeSignal } = require('./abort-signal')\nconst assert = require('assert')\n\nconst kResume = Symbol('resume')\n\nclass PipelineRequest extends Readable {\n  constructor () {\n    super({ autoDestroy: true })\n\n    this[kResume] = null\n  }\n\n  _read () {\n    const { [kResume]: resume } = this\n\n    if (resume) {\n      this[kResume] = null\n      resume()\n    }\n  }\n\n  _destroy (err, callback) {\n    this._read()\n\n    callback(err)\n  }\n}\n\nclass PipelineResponse extends Readable {\n  constructor (resume) {\n    super({ autoDestroy: true })\n    this[kResume] = resume\n  }\n\n  _read () {\n    this[kResume]()\n  }\n\n  _destroy (err, callback) {\n    if (!err && !this._readableState.endEmitted) {\n      err = new RequestAbortedError()\n    }\n\n    callback(err)\n  }\n}\n\nclass PipelineHandler extends AsyncResource {\n  constructor (opts, handler) {\n    if (!opts || typeof opts !== 'object') {\n      throw new InvalidArgumentError('invalid opts')\n    }\n\n    if (typeof handler !== 'function') {\n      throw new InvalidArgumentError('invalid handler')\n    }\n\n    const { signal, method, opaque, onInfo, responseHeaders } = opts\n\n    if (signal && typeof signal.on !== 'function' && typeof signal.addEventListener !== 'function') {\n      throw new InvalidArgumentError('signal must be an EventEmitter or EventTarget')\n    }\n\n    if (method === 'CONNECT') {\n      throw new InvalidArgumentError('invalid method')\n    }\n\n    if (onInfo && typeof onInfo !== 'function') {\n      throw new InvalidArgumentError('invalid onInfo callback')\n    }\n\n    super('UNDICI_PIPELINE')\n\n    this.opaque = opaque || null\n    this.responseHeaders = responseHeaders || null\n    this.handler = handler\n    this.abort = null\n    this.context = null\n    this.onInfo = onInfo || null\n\n    this.req = new PipelineRequest().on('error', util.nop)\n\n    this.ret = new Duplex({\n      readableObjectMode: opts.objectMode,\n      autoDestroy: true,\n      read: () => {\n        const { body } = this\n\n        if (body && body.resume) {\n          body.resume()\n        }\n      },\n      write: (chunk, encoding, callback) => {\n        const { req } = this\n\n        if (req.push(chunk, encoding) || req._readableState.destroyed) {\n          callback()\n        } else {\n          req[kResume] = callback\n        }\n      },\n      destroy: (err, callback) => {\n        const { body, req, res, ret, abort } = this\n\n        if (!err && !ret._readableState.endEmitted) {\n          err = new RequestAbortedError()\n        }\n\n        if (abort && err) {\n          abort()\n        }\n\n        util.destroy(body, err)\n        util.destroy(req, err)\n        util.destroy(res, err)\n\n        removeSignal(this)\n\n        callback(err)\n      }\n    }).on('prefinish', () => {\n      const { req } = this\n\n      // Node < 15 does not call _final in same tick.\n      req.push(null)\n    })\n\n    this.res = null\n\n    addSignal(this, signal)\n  }\n\n  onConnect (abort, context) {\n    const { ret, res } = this\n\n    assert(!res, 'pipeline cannot be retried')\n\n    if (ret.destroyed) {\n      throw new RequestAbortedError()\n    }\n\n    this.abort = abort\n    this.context = context\n  }\n\n  onHeaders (statusCode, rawHeaders, resume) {\n    const { opaque, handler, context } = this\n\n    if (statusCode < 200) {\n      if (this.onInfo) {\n        const headers = this.responseHeaders === 'raw' ? util.parseRawHeaders(rawHeaders) : util.parseHeaders(rawHeaders)\n        this.onInfo({ statusCode, headers })\n      }\n      return\n    }\n\n    this.res = new PipelineResponse(resume)\n\n    let body\n    try {\n      this.handler = null\n      const headers = this.responseHeaders === 'raw' ? util.parseRawHeaders(rawHeaders) : util.parseHeaders(rawHeaders)\n      body = this.runInAsyncScope(handler, null, {\n        statusCode,\n        headers,\n        opaque,\n        body: this.res,\n        context\n      })\n    } catch (err) {\n      this.res.on('error', util.nop)\n      throw err\n    }\n\n    if (!body || typeof body.on !== 'function') {\n      throw new InvalidReturnValueError('expected Readable')\n    }\n\n    body\n      .on('data', (chunk) => {\n        const { ret, body } = this\n\n        if (!ret.push(chunk) && body.pause) {\n          body.pause()\n        }\n      })\n      .on('error', (err) => {\n        const { ret } = this\n\n        util.destroy(ret, err)\n      })\n      .on('end', () => {\n        const { ret } = this\n\n        ret.push(null)\n      })\n      .on('close', () => {\n        const { ret } = this\n\n        if (!ret._readableState.ended) {\n          util.destroy(ret, new RequestAbortedError())\n        }\n      })\n\n    this.body = body\n  }\n\n  onData (chunk) {\n    const { res } = this\n    return res.push(chunk)\n  }\n\n  onComplete (trailers) {\n    const { res } = this\n    res.push(null)\n  }\n\n  onError (err) {\n    const { ret } = this\n    this.handler = null\n    util.destroy(ret, err)\n  }\n}\n\nfunction pipeline (opts, handler) {\n  try {\n    const pipelineHandler = new PipelineHandler(opts, handler)\n    this.dispatch({ ...opts, body: pipelineHandler.req }, pipelineHandler)\n    return pipelineHandler.ret\n  } catch (err) {\n    return new PassThrough().destroy(err)\n  }\n}\n\nmodule.exports = pipeline\n","'use strict'\n\nconst { InvalidArgumentError, RequestAbortedError, SocketError } = require('../core/errors')\nconst { AsyncResource } = require('async_hooks')\nconst util = require('../core/util')\nconst { addSignal, removeSignal } = require('./abort-signal')\nconst assert = require('assert')\n\nclass UpgradeHandler extends AsyncResource {\n  constructor (opts, callback) {\n    if (!opts || typeof opts !== 'object') {\n      throw new InvalidArgumentError('invalid opts')\n    }\n\n    if (typeof callback !== 'function') {\n      throw new InvalidArgumentError('invalid callback')\n    }\n\n    const { signal, opaque, responseHeaders } = opts\n\n    if (signal && typeof signal.on !== 'function' && typeof signal.addEventListener !== 'function') {\n      throw new InvalidArgumentError('signal must be an EventEmitter or EventTarget')\n    }\n\n    super('UNDICI_UPGRADE')\n\n    this.responseHeaders = responseHeaders || null\n    this.opaque = opaque || null\n    this.callback = callback\n    this.abort = null\n    this.context = null\n\n    addSignal(this, signal)\n  }\n\n  onConnect (abort, context) {\n    if (!this.callback) {\n      throw new RequestAbortedError()\n    }\n\n    this.abort = abort\n    this.context = null\n  }\n\n  onHeaders () {\n    throw new SocketError('bad upgrade', null)\n  }\n\n  onUpgrade (statusCode, rawHeaders, socket) {\n    const { callback, opaque, context } = this\n\n    assert.strictEqual(statusCode, 101)\n\n    removeSignal(this)\n\n    this.callback = null\n    const headers = this.responseHeaders === 'raw' ? util.parseRawHeaders(rawHeaders) : util.parseHeaders(rawHeaders)\n    this.runInAsyncScope(callback, null, null, {\n      headers,\n      socket,\n      opaque,\n      context\n    })\n  }\n\n  onError (err) {\n    const { callback, opaque } = this\n\n    removeSignal(this)\n\n    if (callback) {\n      this.callback = null\n      queueMicrotask(() => {\n        this.runInAsyncScope(callback, null, err, { opaque })\n      })\n    }\n  }\n}\n\nfunction upgrade (opts, callback) {\n  if (callback === undefined) {\n    return new Promise((resolve, reject) => {\n      upgrade.call(this, opts, (err, data) => {\n        return err ? reject(err) : resolve(data)\n      })\n    })\n  }\n\n  try {\n    const upgradeHandler = new UpgradeHandler(opts, callback)\n    this.dispatch({\n      ...opts,\n      method: opts.method || 'GET',\n      upgrade: opts.protocol || 'Websocket'\n    }, upgradeHandler)\n  } catch (err) {\n    if (typeof callback !== 'function') {\n      throw err\n    }\n    const opaque = opts && opts.opaque\n    queueMicrotask(() => callback(err, { opaque }))\n  }\n}\n\nmodule.exports = upgrade\n","'use strict'\n\nconst { AsyncResource } = require('async_hooks')\nconst { InvalidArgumentError, RequestAbortedError, SocketError } = require('../core/errors')\nconst util = require('../core/util')\nconst { addSignal, removeSignal } = require('./abort-signal')\n\nclass ConnectHandler extends AsyncResource {\n  constructor (opts, callback) {\n    if (!opts || typeof opts !== 'object') {\n      throw new InvalidArgumentError('invalid opts')\n    }\n\n    if (typeof callback !== 'function') {\n      throw new InvalidArgumentError('invalid callback')\n    }\n\n    const { signal, opaque, responseHeaders } = opts\n\n    if (signal && typeof signal.on !== 'function' && typeof signal.addEventListener !== 'function') {\n      throw new InvalidArgumentError('signal must be an EventEmitter or EventTarget')\n    }\n\n    super('UNDICI_CONNECT')\n\n    this.opaque = opaque || null\n    this.responseHeaders = responseHeaders || null\n    this.callback = callback\n    this.abort = null\n\n    addSignal(this, signal)\n  }\n\n  onConnect (abort, context) {\n    if (!this.callback) {\n      throw new RequestAbortedError()\n    }\n\n    this.abort = abort\n    this.context = context\n  }\n\n  onHeaders () {\n    throw new SocketError('bad connect', null)\n  }\n\n  onUpgrade (statusCode, rawHeaders, socket) {\n    const { callback, opaque, context } = this\n\n    removeSignal(this)\n\n    this.callback = null\n\n    let headers = rawHeaders\n    // Indicates is an HTTP2Session\n    if (headers != null) {\n      headers = this.responseHeaders === 'raw' ? util.parseRawHeaders(rawHeaders) : util.parseHeaders(rawHeaders)\n    }\n\n    this.runInAsyncScope(callback, null, null, {\n      statusCode,\n      headers,\n      socket,\n      opaque,\n      context\n    })\n  }\n\n  onError (err) {\n    const { callback, opaque } = this\n\n    removeSignal(this)\n\n    if (callback) {\n      this.callback = null\n      queueMicrotask(() => {\n        this.runInAsyncScope(callback, null, err, { opaque })\n      })\n    }\n  }\n}\n\nfunction connect (opts, callback) {\n  if (callback === undefined) {\n    return new Promise((resolve, reject) => {\n      connect.call(this, opts, (err, data) => {\n        return err ? reject(err) : resolve(data)\n      })\n    })\n  }\n\n  try {\n    const connectHandler = new ConnectHandler(opts, callback)\n    this.dispatch({ ...opts, method: 'CONNECT' }, connectHandler)\n  } catch (err) {\n    if (typeof callback !== 'function') {\n      throw err\n    }\n    const opaque = opts && opts.opaque\n    queueMicrotask(() => callback(err, { opaque }))\n  }\n}\n\nmodule.exports = connect\n","'use strict'\n\nmodule.exports.request = require('./api-request')\nmodule.exports.stream = require('./api-stream')\nmodule.exports.pipeline = require('./api-pipeline')\nmodule.exports.upgrade = require('./api-upgrade')\nmodule.exports.connect = require('./api-connect')\n","'use strict'\n\nconst { UndiciError } = require('../core/errors')\n\nclass MockNotMatchedError extends UndiciError {\n  constructor (message) {\n    super(message)\n    Error.captureStackTrace(this, MockNotMatchedError)\n    this.name = 'MockNotMatchedError'\n    this.message = message || 'The request does not match any registered mock dispatches'\n    this.code = 'UND_MOCK_ERR_MOCK_NOT_MATCHED'\n  }\n}\n\nmodule.exports = {\n  MockNotMatchedError\n}\n","'use strict'\n\nmodule.exports = {\n  kAgent: Symbol('agent'),\n  kOptions: Symbol('options'),\n  kFactory: Symbol('factory'),\n  kDispatches: Symbol('dispatches'),\n  kDispatchKey: Symbol('dispatch key'),\n  kDefaultHeaders: Symbol('default headers'),\n  kDefaultTrailers: Symbol('default trailers'),\n  kContentLength: Symbol('content length'),\n  kMockAgent: Symbol('mock agent'),\n  kMockAgentSet: Symbol('mock agent set'),\n  kMockAgentGet: Symbol('mock agent get'),\n  kMockDispatch: Symbol('mock dispatch'),\n  kClose: Symbol('close'),\n  kOriginalClose: Symbol('original agent close'),\n  kOrigin: Symbol('origin'),\n  kIsMockActive: Symbol('is mock active'),\n  kNetConnect: Symbol('net connect'),\n  kGetNetConnect: Symbol('get net connect'),\n  kConnected: Symbol('connected')\n}\n","'use strict'\n\nconst { MockNotMatchedError } = require('./mock-errors')\nconst {\n  kDispatches,\n  kMockAgent,\n  kOriginalDispatch,\n  kOrigin,\n  kGetNetConnect\n} = require('./mock-symbols')\nconst { buildURL, nop } = require('../core/util')\nconst { STATUS_CODES } = require('http')\nconst {\n  types: {\n    isPromise\n  }\n} = require('util')\n\nfunction matchValue (match, value) {\n  if (typeof match === 'string') {\n    return match === value\n  }\n  if (match instanceof RegExp) {\n    return match.test(value)\n  }\n  if (typeof match === 'function') {\n    return match(value) === true\n  }\n  return false\n}\n\nfunction lowerCaseEntries (headers) {\n  return Object.fromEntries(\n    Object.entries(headers).map(([headerName, headerValue]) => {\n      return [headerName.toLocaleLowerCase(), headerValue]\n    })\n  )\n}\n\n/**\n * @param {import('../../index').Headers|string[]|Record<string, string>} headers\n * @param {string} key\n */\nfunction getHeaderByName (headers, key) {\n  if (Array.isArray(headers)) {\n    for (let i = 0; i < headers.length; i += 2) {\n      if (headers[i].toLocaleLowerCase() === key.toLocaleLowerCase()) {\n        return headers[i + 1]\n      }\n    }\n\n    return undefined\n  } else if (typeof headers.get === 'function') {\n    return headers.get(key)\n  } else {\n    return lowerCaseEntries(headers)[key.toLocaleLowerCase()]\n  }\n}\n\n/** @param {string[]} headers */\nfunction buildHeadersFromArray (headers) { // fetch HeadersList\n  const clone = headers.slice()\n  const entries = []\n  for (let index = 0; index < clone.length; index += 2) {\n    entries.push([clone[index], clone[index + 1]])\n  }\n  return Object.fromEntries(entries)\n}\n\nfunction matchHeaders (mockDispatch, headers) {\n  if (typeof mockDispatch.headers === 'function') {\n    if (Array.isArray(headers)) { // fetch HeadersList\n      headers = buildHeadersFromArray(headers)\n    }\n    return mockDispatch.headers(headers ? lowerCaseEntries(headers) : {})\n  }\n  if (typeof mockDispatch.headers === 'undefined') {\n    return true\n  }\n  if (typeof headers !== 'object' || typeof mockDispatch.headers !== 'object') {\n    return false\n  }\n\n  for (const [matchHeaderName, matchHeaderValue] of Object.entries(mockDispatch.headers)) {\n    const headerValue = getHeaderByName(headers, matchHeaderName)\n\n    if (!matchValue(matchHeaderValue, headerValue)) {\n      return false\n    }\n  }\n  return true\n}\n\nfunction safeUrl (path) {\n  if (typeof path !== 'string') {\n    return path\n  }\n\n  const pathSegments = path.split('?')\n\n  if (pathSegments.length !== 2) {\n    return path\n  }\n\n  const qp = new URLSearchParams(pathSegments.pop())\n  qp.sort()\n  return [...pathSegments, qp.toString()].join('?')\n}\n\nfunction matchKey (mockDispatch, { path, method, body, headers }) {\n  const pathMatch = matchValue(mockDispatch.path, path)\n  const methodMatch = matchValue(mockDispatch.method, method)\n  const bodyMatch = typeof mockDispatch.body !== 'undefined' ? matchValue(mockDispatch.body, body) : true\n  const headersMatch = matchHeaders(mockDispatch, headers)\n  return pathMatch && methodMatch && bodyMatch && headersMatch\n}\n\nfunction getResponseData (data) {\n  if (Buffer.isBuffer(data)) {\n    return data\n  } else if (typeof data === 'object') {\n    return JSON.stringify(data)\n  } else {\n    return data.toString()\n  }\n}\n\nfunction getMockDispatch (mockDispatches, key) {\n  const basePath = key.query ? buildURL(key.path, key.query) : key.path\n  const resolvedPath = typeof basePath === 'string' ? safeUrl(basePath) : basePath\n\n  // Match path\n  let matchedMockDispatches = mockDispatches.filter(({ consumed }) => !consumed).filter(({ path }) => matchValue(safeUrl(path), resolvedPath))\n  if (matchedMockDispatches.length === 0) {\n    throw new MockNotMatchedError(`Mock dispatch not matched for path '${resolvedPath}'`)\n  }\n\n  // Match method\n  matchedMockDispatches = matchedMockDispatches.filter(({ method }) => matchValue(method, key.method))\n  if (matchedMockDispatches.length === 0) {\n    throw new MockNotMatchedError(`Mock dispatch not matched for method '${key.method}'`)\n  }\n\n  // Match body\n  matchedMockDispatches = matchedMockDispatches.filter(({ body }) => typeof body !== 'undefined' ? matchValue(body, key.body) : true)\n  if (matchedMockDispatches.length === 0) {\n    throw new MockNotMatchedError(`Mock dispatch not matched for body '${key.body}'`)\n  }\n\n  // Match headers\n  matchedMockDispatches = matchedMockDispatches.filter((mockDispatch) => matchHeaders(mockDispatch, key.headers))\n  if (matchedMockDispatches.length === 0) {\n    throw new MockNotMatchedError(`Mock dispatch not matched for headers '${typeof key.headers === 'object' ? JSON.stringify(key.headers) : key.headers}'`)\n  }\n\n  return matchedMockDispatches[0]\n}\n\nfunction addMockDispatch (mockDispatches, key, data) {\n  const baseData = { timesInvoked: 0, times: 1, persist: false, consumed: false }\n  const replyData = typeof data === 'function' ? { callback: data } : { ...data }\n  const newMockDispatch = { ...baseData, ...key, pending: true, data: { error: null, ...replyData } }\n  mockDispatches.push(newMockDispatch)\n  return newMockDispatch\n}\n\nfunction deleteMockDispatch (mockDispatches, key) {\n  const index = mockDispatches.findIndex(dispatch => {\n    if (!dispatch.consumed) {\n      return false\n    }\n    return matchKey(dispatch, key)\n  })\n  if (index !== -1) {\n    mockDispatches.splice(index, 1)\n  }\n}\n\nfunction buildKey (opts) {\n  const { path, method, body, headers, query } = opts\n  return {\n    path,\n    method,\n    body,\n    headers,\n    query\n  }\n}\n\nfunction generateKeyValues (data) {\n  return Object.entries(data).reduce((keyValuePairs, [key, value]) => [\n    ...keyValuePairs,\n    Buffer.from(`${key}`),\n    Array.isArray(value) ? value.map(x => Buffer.from(`${x}`)) : Buffer.from(`${value}`)\n  ], [])\n}\n\n/**\n * @see https://developer.mozilla.org/en-US/docs/Web/HTTP/Status\n * @param {number} statusCode\n */\nfunction getStatusText (statusCode) {\n  return STATUS_CODES[statusCode] || 'unknown'\n}\n\nasync function getResponse (body) {\n  const buffers = []\n  for await (const data of body) {\n    buffers.push(data)\n  }\n  return Buffer.concat(buffers).toString('utf8')\n}\n\n/**\n * Mock dispatch function used to simulate undici dispatches\n */\nfunction mockDispatch (opts, handler) {\n  // Get mock dispatch from built key\n  const key = buildKey(opts)\n  const mockDispatch = getMockDispatch(this[kDispatches], key)\n\n  mockDispatch.timesInvoked++\n\n  // Here's where we resolve a callback if a callback is present for the dispatch data.\n  if (mockDispatch.data.callback) {\n    mockDispatch.data = { ...mockDispatch.data, ...mockDispatch.data.callback(opts) }\n  }\n\n  // Parse mockDispatch data\n  const { data: { statusCode, data, headers, trailers, error }, delay, persist } = mockDispatch\n  const { timesInvoked, times } = mockDispatch\n\n  // If it's used up and not persistent, mark as consumed\n  mockDispatch.consumed = !persist && timesInvoked >= times\n  mockDispatch.pending = timesInvoked < times\n\n  // If specified, trigger dispatch error\n  if (error !== null) {\n    deleteMockDispatch(this[kDispatches], key)\n    handler.onError(error)\n    return true\n  }\n\n  // Handle the request with a delay if necessary\n  if (typeof delay === 'number' && delay > 0) {\n    setTimeout(() => {\n      handleReply(this[kDispatches])\n    }, delay)\n  } else {\n    handleReply(this[kDispatches])\n  }\n\n  function handleReply (mockDispatches, _data = data) {\n    // fetch's HeadersList is a 1D string array\n    const optsHeaders = Array.isArray(opts.headers)\n      ? buildHeadersFromArray(opts.headers)\n      : opts.headers\n    const body = typeof _data === 'function'\n      ? _data({ ...opts, headers: optsHeaders })\n      : _data\n\n    // util.types.isPromise is likely needed for jest.\n    if (isPromise(body)) {\n      // If handleReply is asynchronous, throwing an error\n      // in the callback will reject the promise, rather than\n      // synchronously throw the error, which breaks some tests.\n      // Rather, we wait for the callback to resolve if it is a\n      // promise, and then re-run handleReply with the new body.\n      body.then((newData) => handleReply(mockDispatches, newData))\n      return\n    }\n\n    const responseData = getResponseData(body)\n    const responseHeaders = generateKeyValues(headers)\n    const responseTrailers = generateKeyValues(trailers)\n\n    handler.abort = nop\n    handler.onHeaders(statusCode, responseHeaders, resume, getStatusText(statusCode))\n    handler.onData(Buffer.from(responseData))\n    handler.onComplete(responseTrailers)\n    deleteMockDispatch(mockDispatches, key)\n  }\n\n  function resume () {}\n\n  return true\n}\n\nfunction buildMockDispatch () {\n  const agent = this[kMockAgent]\n  const origin = this[kOrigin]\n  const originalDispatch = this[kOriginalDispatch]\n\n  return function dispatch (opts, handler) {\n    if (agent.isMockActive) {\n      try {\n        mockDispatch.call(this, opts, handler)\n      } catch (error) {\n        if (error instanceof MockNotMatchedError) {\n          const netConnect = agent[kGetNetConnect]()\n          if (netConnect === false) {\n            throw new MockNotMatchedError(`${error.message}: subsequent request to origin ${origin} was not allowed (net.connect disabled)`)\n          }\n          if (checkNetConnect(netConnect, origin)) {\n            originalDispatch.call(this, opts, handler)\n          } else {\n            throw new MockNotMatchedError(`${error.message}: subsequent request to origin ${origin} was not allowed (net.connect is not enabled for this origin)`)\n          }\n        } else {\n          throw error\n        }\n      }\n    } else {\n      originalDispatch.call(this, opts, handler)\n    }\n  }\n}\n\nfunction checkNetConnect (netConnect, origin) {\n  const url = new URL(origin)\n  if (netConnect === true) {\n    return true\n  } else if (Array.isArray(netConnect) && netConnect.some((matcher) => matchValue(matcher, url.host))) {\n    return true\n  }\n  return false\n}\n\nfunction buildMockOptions (opts) {\n  if (opts) {\n    const { agent, ...mockOptions } = opts\n    return mockOptions\n  }\n}\n\nmodule.exports = {\n  getResponseData,\n  getMockDispatch,\n  addMockDispatch,\n  deleteMockDispatch,\n  buildKey,\n  generateKeyValues,\n  matchValue,\n  getResponse,\n  getStatusText,\n  mockDispatch,\n  buildMockDispatch,\n  checkNetConnect,\n  buildMockOptions,\n  getHeaderByName\n}\n","'use strict'\n\nconst { getResponseData, buildKey, addMockDispatch } = require('./mock-utils')\nconst {\n  kDispatches,\n  kDispatchKey,\n  kDefaultHeaders,\n  kDefaultTrailers,\n  kContentLength,\n  kMockDispatch\n} = require('./mock-symbols')\nconst { InvalidArgumentError } = require('../core/errors')\nconst { buildURL } = require('../core/util')\n\n/**\n * Defines the scope API for an interceptor reply\n */\nclass MockScope {\n  constructor (mockDispatch) {\n    this[kMockDispatch] = mockDispatch\n  }\n\n  /**\n   * Delay a reply by a set amount in ms.\n   */\n  delay (waitInMs) {\n    if (typeof waitInMs !== 'number' || !Number.isInteger(waitInMs) || waitInMs <= 0) {\n      throw new InvalidArgumentError('waitInMs must be a valid integer > 0')\n    }\n\n    this[kMockDispatch].delay = waitInMs\n    return this\n  }\n\n  /**\n   * For a defined reply, never mark as consumed.\n   */\n  persist () {\n    this[kMockDispatch].persist = true\n    return this\n  }\n\n  /**\n   * Allow one to define a reply for a set amount of matching requests.\n   */\n  times (repeatTimes) {\n    if (typeof repeatTimes !== 'number' || !Number.isInteger(repeatTimes) || repeatTimes <= 0) {\n      throw new InvalidArgumentError('repeatTimes must be a valid integer > 0')\n    }\n\n    this[kMockDispatch].times = repeatTimes\n    return this\n  }\n}\n\n/**\n * Defines an interceptor for a Mock\n */\nclass MockInterceptor {\n  constructor (opts, mockDispatches) {\n    if (typeof opts !== 'object') {\n      throw new InvalidArgumentError('opts must be an object')\n    }\n    if (typeof opts.path === 'undefined') {\n      throw new InvalidArgumentError('opts.path must be defined')\n    }\n    if (typeof opts.method === 'undefined') {\n      opts.method = 'GET'\n    }\n    // See https://github.com/nodejs/undici/issues/1245\n    // As per RFC 3986, clients are not supposed to send URI\n    // fragments to servers when they retrieve a document,\n    if (typeof opts.path === 'string') {\n      if (opts.query) {\n        opts.path = buildURL(opts.path, opts.query)\n      } else {\n        // Matches https://github.com/nodejs/undici/blob/main/lib/fetch/index.js#L1811\n        const parsedURL = new URL(opts.path, 'data://')\n        opts.path = parsedURL.pathname + parsedURL.search\n      }\n    }\n    if (typeof opts.method === 'string') {\n      opts.method = opts.method.toUpperCase()\n    }\n\n    this[kDispatchKey] = buildKey(opts)\n    this[kDispatches] = mockDispatches\n    this[kDefaultHeaders] = {}\n    this[kDefaultTrailers] = {}\n    this[kContentLength] = false\n  }\n\n  createMockScopeDispatchData (statusCode, data, responseOptions = {}) {\n    const responseData = getResponseData(data)\n    const contentLength = this[kContentLength] ? { 'content-length': responseData.length } : {}\n    const headers = { ...this[kDefaultHeaders], ...contentLength, ...responseOptions.headers }\n    const trailers = { ...this[kDefaultTrailers], ...responseOptions.trailers }\n\n    return { statusCode, data, headers, trailers }\n  }\n\n  validateReplyParameters (statusCode, data, responseOptions) {\n    if (typeof statusCode === 'undefined') {\n      throw new InvalidArgumentError('statusCode must be defined')\n    }\n    if (typeof data === 'undefined') {\n      throw new InvalidArgumentError('data must be defined')\n    }\n    if (typeof responseOptions !== 'object') {\n      throw new InvalidArgumentError('responseOptions must be an object')\n    }\n  }\n\n  /**\n   * Mock an undici request with a defined reply.\n   */\n  reply (replyData) {\n    // Values of reply aren't available right now as they\n    // can only be available when the reply callback is invoked.\n    if (typeof replyData === 'function') {\n      // We'll first wrap the provided callback in another function,\n      // this function will properly resolve the data from the callback\n      // when invoked.\n      const wrappedDefaultsCallback = (opts) => {\n        // Our reply options callback contains the parameter for statusCode, data and options.\n        const resolvedData = replyData(opts)\n\n        // Check if it is in the right format\n        if (typeof resolvedData !== 'object') {\n          throw new InvalidArgumentError('reply options callback must return an object')\n        }\n\n        const { statusCode, data = '', responseOptions = {} } = resolvedData\n        this.validateReplyParameters(statusCode, data, responseOptions)\n        // Since the values can be obtained immediately we return them\n        // from this higher order function that will be resolved later.\n        return {\n          ...this.createMockScopeDispatchData(statusCode, data, responseOptions)\n        }\n      }\n\n      // Add usual dispatch data, but this time set the data parameter to function that will eventually provide data.\n      const newMockDispatch = addMockDispatch(this[kDispatches], this[kDispatchKey], wrappedDefaultsCallback)\n      return new MockScope(newMockDispatch)\n    }\n\n    // We can have either one or three parameters, if we get here,\n    // we should have 1-3 parameters. So we spread the arguments of\n    // this function to obtain the parameters, since replyData will always\n    // just be the statusCode.\n    const [statusCode, data = '', responseOptions = {}] = [...arguments]\n    this.validateReplyParameters(statusCode, data, responseOptions)\n\n    // Send in-already provided data like usual\n    const dispatchData = this.createMockScopeDispatchData(statusCode, data, responseOptions)\n    const newMockDispatch = addMockDispatch(this[kDispatches], this[kDispatchKey], dispatchData)\n    return new MockScope(newMockDispatch)\n  }\n\n  /**\n   * Mock an undici request with a defined error.\n   */\n  replyWithError (error) {\n    if (typeof error === 'undefined') {\n      throw new InvalidArgumentError('error must be defined')\n    }\n\n    const newMockDispatch = addMockDispatch(this[kDispatches], this[kDispatchKey], { error })\n    return new MockScope(newMockDispatch)\n  }\n\n  /**\n   * Set default reply headers on the interceptor for subsequent replies\n   */\n  defaultReplyHeaders (headers) {\n    if (typeof headers === 'undefined') {\n      throw new InvalidArgumentError('headers must be defined')\n    }\n\n    this[kDefaultHeaders] = headers\n    return this\n  }\n\n  /**\n   * Set default reply trailers on the interceptor for subsequent replies\n   */\n  defaultReplyTrailers (trailers) {\n    if (typeof trailers === 'undefined') {\n      throw new InvalidArgumentError('trailers must be defined')\n    }\n\n    this[kDefaultTrailers] = trailers\n    return this\n  }\n\n  /**\n   * Set reply content length header for replies on the interceptor\n   */\n  replyContentLength () {\n    this[kContentLength] = true\n    return this\n  }\n}\n\nmodule.exports.MockInterceptor = MockInterceptor\nmodule.exports.MockScope = MockScope\n","'use strict'\n\nconst { promisify } = require('util')\nconst Client = require('../client')\nconst { buildMockDispatch } = require('./mock-utils')\nconst {\n  kDispatches,\n  kMockAgent,\n  kClose,\n  kOriginalClose,\n  kOrigin,\n  kOriginalDispatch,\n  kConnected\n} = require('./mock-symbols')\nconst { MockInterceptor } = require('./mock-interceptor')\nconst Symbols = require('../core/symbols')\nconst { InvalidArgumentError } = require('../core/errors')\n\n/**\n * MockClient provides an API that extends the Client to influence the mockDispatches.\n */\nclass MockClient extends Client {\n  constructor (origin, opts) {\n    super(origin, opts)\n\n    if (!opts || !opts.agent || typeof opts.agent.dispatch !== 'function') {\n      throw new InvalidArgumentError('Argument opts.agent must implement Agent')\n    }\n\n    this[kMockAgent] = opts.agent\n    this[kOrigin] = origin\n    this[kDispatches] = []\n    this[kConnected] = 1\n    this[kOriginalDispatch] = this.dispatch\n    this[kOriginalClose] = this.close.bind(this)\n\n    this.dispatch = buildMockDispatch.call(this)\n    this.close = this[kClose]\n  }\n\n  get [Symbols.kConnected] () {\n    return this[kConnected]\n  }\n\n  /**\n   * Sets up the base interceptor for mocking replies from undici.\n   */\n  intercept (opts) {\n    return new MockInterceptor(opts, this[kDispatches])\n  }\n\n  async [kClose] () {\n    await promisify(this[kOriginalClose])()\n    this[kConnected] = 0\n    this[kMockAgent][Symbols.kClients].delete(this[kOrigin])\n  }\n}\n\nmodule.exports = MockClient\n","'use strict'\n\nconst { promisify } = require('util')\nconst Pool = require('../pool')\nconst { buildMockDispatch } = require('./mock-utils')\nconst {\n  kDispatches,\n  kMockAgent,\n  kClose,\n  kOriginalClose,\n  kOrigin,\n  kOriginalDispatch,\n  kConnected\n} = require('./mock-symbols')\nconst { MockInterceptor } = require('./mock-interceptor')\nconst Symbols = require('../core/symbols')\nconst { InvalidArgumentError } = require('../core/errors')\n\n/**\n * MockPool provides an API that extends the Pool to influence the mockDispatches.\n */\nclass MockPool extends Pool {\n  constructor (origin, opts) {\n    super(origin, opts)\n\n    if (!opts || !opts.agent || typeof opts.agent.dispatch !== 'function') {\n      throw new InvalidArgumentError('Argument opts.agent must implement Agent')\n    }\n\n    this[kMockAgent] = opts.agent\n    this[kOrigin] = origin\n    this[kDispatches] = []\n    this[kConnected] = 1\n    this[kOriginalDispatch] = this.dispatch\n    this[kOriginalClose] = this.close.bind(this)\n\n    this.dispatch = buildMockDispatch.call(this)\n    this.close = this[kClose]\n  }\n\n  get [Symbols.kConnected] () {\n    return this[kConnected]\n  }\n\n  /**\n   * Sets up the base interceptor for mocking replies from undici.\n   */\n  intercept (opts) {\n    return new MockInterceptor(opts, this[kDispatches])\n  }\n\n  async [kClose] () {\n    await promisify(this[kOriginalClose])()\n    this[kConnected] = 0\n    this[kMockAgent][Symbols.kClients].delete(this[kOrigin])\n  }\n}\n\nmodule.exports = MockPool\n","'use strict'\n\nconst singulars = {\n  pronoun: 'it',\n  is: 'is',\n  was: 'was',\n  this: 'this'\n}\n\nconst plurals = {\n  pronoun: 'they',\n  is: 'are',\n  was: 'were',\n  this: 'these'\n}\n\nmodule.exports = class Pluralizer {\n  constructor (singular, plural) {\n    this.singular = singular\n    this.plural = plural\n  }\n\n  pluralize (count) {\n    const one = count === 1\n    const keys = one ? singulars : plurals\n    const noun = one ? this.singular : this.plural\n    return { ...keys, count, noun }\n  }\n}\n","'use strict'\n\nconst { Transform } = require('stream')\nconst { Console } = require('console')\n\n/**\n * Gets the output of `console.table(â€¦)` as a string.\n */\nmodule.exports = class PendingInterceptorsFormatter {\n  constructor ({ disableColors } = {}) {\n    this.transform = new Transform({\n      transform (chunk, _enc, cb) {\n        cb(null, chunk)\n      }\n    })\n\n    this.logger = new Console({\n      stdout: this.transform,\n      inspectOptions: {\n        colors: !disableColors && !process.env.CI\n      }\n    })\n  }\n\n  format (pendingInterceptors) {\n    const withPrettyHeaders = pendingInterceptors.map(\n      ({ method, path, data: { statusCode }, persist, times, timesInvoked, origin }) => ({\n        Method: method,\n        Origin: origin,\n        Path: path,\n        'Status code': statusCode,\n        Persistent: persist ? 'âœ…' : 'âŒ',\n        Invocations: timesInvoked,\n        Remaining: persist ? Infinity : times - timesInvoked\n      }))\n\n    this.logger.table(withPrettyHeaders)\n    return this.transform.read().toString()\n  }\n}\n","'use strict'\n\nconst { kClients } = require('../core/symbols')\nconst Agent = require('../agent')\nconst {\n  kAgent,\n  kMockAgentSet,\n  kMockAgentGet,\n  kDispatches,\n  kIsMockActive,\n  kNetConnect,\n  kGetNetConnect,\n  kOptions,\n  kFactory\n} = require('./mock-symbols')\nconst MockClient = require('./mock-client')\nconst MockPool = require('./mock-pool')\nconst { matchValue, buildMockOptions } = require('./mock-utils')\nconst { InvalidArgumentError, UndiciError } = require('../core/errors')\nconst Dispatcher = require('../dispatcher')\nconst Pluralizer = require('./pluralizer')\nconst PendingInterceptorsFormatter = require('./pending-interceptors-formatter')\n\nclass FakeWeakRef {\n  constructor (value) {\n    this.value = value\n  }\n\n  deref () {\n    return this.value\n  }\n}\n\nclass MockAgent extends Dispatcher {\n  constructor (opts) {\n    super(opts)\n\n    this[kNetConnect] = true\n    this[kIsMockActive] = true\n\n    // Instantiate Agent and encapsulate\n    if ((opts && opts.agent && typeof opts.agent.dispatch !== 'function')) {\n      throw new InvalidArgumentError('Argument opts.agent must implement Agent')\n    }\n    const agent = opts && opts.agent ? opts.agent : new Agent(opts)\n    this[kAgent] = agent\n\n    this[kClients] = agent[kClients]\n    this[kOptions] = buildMockOptions(opts)\n  }\n\n  get (origin) {\n    let dispatcher = this[kMockAgentGet](origin)\n\n    if (!dispatcher) {\n      dispatcher = this[kFactory](origin)\n      this[kMockAgentSet](origin, dispatcher)\n    }\n    return dispatcher\n  }\n\n  dispatch (opts, handler) {\n    // Call MockAgent.get to perform additional setup before dispatching as normal\n    this.get(opts.origin)\n    return this[kAgent].dispatch(opts, handler)\n  }\n\n  async close () {\n    await this[kAgent].close()\n    this[kClients].clear()\n  }\n\n  deactivate () {\n    this[kIsMockActive] = false\n  }\n\n  activate () {\n    this[kIsMockActive] = true\n  }\n\n  enableNetConnect (matcher) {\n    if (typeof matcher === 'string' || typeof matcher === 'function' || matcher instanceof RegExp) {\n      if (Array.isArray(this[kNetConnect])) {\n        this[kNetConnect].push(matcher)\n      } else {\n        this[kNetConnect] = [matcher]\n      }\n    } else if (typeof matcher === 'undefined') {\n      this[kNetConnect] = true\n    } else {\n      throw new InvalidArgumentError('Unsupported matcher. Must be one of String|Function|RegExp.')\n    }\n  }\n\n  disableNetConnect () {\n    this[kNetConnect] = false\n  }\n\n  // This is required to bypass issues caused by using global symbols - see:\n  // https://github.com/nodejs/undici/issues/1447\n  get isMockActive () {\n    return this[kIsMockActive]\n  }\n\n  [kMockAgentSet] (origin, dispatcher) {\n    this[kClients].set(origin, new FakeWeakRef(dispatcher))\n  }\n\n  [kFactory] (origin) {\n    const mockOptions = Object.assign({ agent: this }, this[kOptions])\n    return this[kOptions] && this[kOptions].connections === 1\n      ? new MockClient(origin, mockOptions)\n      : new MockPool(origin, mockOptions)\n  }\n\n  [kMockAgentGet] (origin) {\n    // First check if we can immediately find it\n    const ref = this[kClients].get(origin)\n    if (ref) {\n      return ref.deref()\n    }\n\n    // If the origin is not a string create a dummy parent pool and return to user\n    if (typeof origin !== 'string') {\n      const dispatcher = this[kFactory]('http://localhost:9999')\n      this[kMockAgentSet](origin, dispatcher)\n      return dispatcher\n    }\n\n    // If we match, create a pool and assign the same dispatches\n    for (const [keyMatcher, nonExplicitRef] of Array.from(this[kClients])) {\n      const nonExplicitDispatcher = nonExplicitRef.deref()\n      if (nonExplicitDispatcher && typeof keyMatcher !== 'string' && matchValue(keyMatcher, origin)) {\n        const dispatcher = this[kFactory](origin)\n        this[kMockAgentSet](origin, dispatcher)\n        dispatcher[kDispatches] = nonExplicitDispatcher[kDispatches]\n        return dispatcher\n      }\n    }\n  }\n\n  [kGetNetConnect] () {\n    return this[kNetConnect]\n  }\n\n  pendingInterceptors () {\n    const mockAgentClients = this[kClients]\n\n    return Array.from(mockAgentClients.entries())\n      .flatMap(([origin, scope]) => scope.deref()[kDispatches].map(dispatch => ({ ...dispatch, origin })))\n      .filter(({ pending }) => pending)\n  }\n\n  assertNoPendingInterceptors ({ pendingInterceptorsFormatter = new PendingInterceptorsFormatter() } = {}) {\n    const pending = this.pendingInterceptors()\n\n    if (pending.length === 0) {\n      return\n    }\n\n    const pluralizer = new Pluralizer('interceptor', 'interceptors').pluralize(pending.length)\n\n    throw new UndiciError(`\n${pluralizer.count} ${pluralizer.noun} ${pluralizer.is} pending:\n\n${pendingInterceptorsFormatter.format(pending)}\n`.trim())\n  }\n}\n\nmodule.exports = MockAgent\n","'use strict'\n\nconst { kProxy, kClose, kDestroy, kInterceptors } = require('./core/symbols')\nconst { URL } = require('url')\nconst Agent = require('./agent')\nconst Pool = require('./pool')\nconst DispatcherBase = require('./dispatcher-base')\nconst { InvalidArgumentError, RequestAbortedError } = require('./core/errors')\nconst buildConnector = require('./core/connect')\n\nconst kAgent = Symbol('proxy agent')\nconst kClient = Symbol('proxy client')\nconst kProxyHeaders = Symbol('proxy headers')\nconst kRequestTls = Symbol('request tls settings')\nconst kProxyTls = Symbol('proxy tls settings')\nconst kConnectEndpoint = Symbol('connect endpoint function')\n\nfunction defaultProtocolPort (protocol) {\n  return protocol === 'https:' ? 443 : 80\n}\n\nfunction buildProxyOptions (opts) {\n  if (typeof opts === 'string') {\n    opts = { uri: opts }\n  }\n\n  if (!opts || !opts.uri) {\n    throw new InvalidArgumentError('Proxy opts.uri is mandatory')\n  }\n\n  return {\n    uri: opts.uri,\n    protocol: opts.protocol || 'https'\n  }\n}\n\nfunction defaultFactory (origin, opts) {\n  return new Pool(origin, opts)\n}\n\nclass ProxyAgent extends DispatcherBase {\n  constructor (opts) {\n    super(opts)\n    this[kProxy] = buildProxyOptions(opts)\n    this[kAgent] = new Agent(opts)\n    this[kInterceptors] = opts.interceptors && opts.interceptors.ProxyAgent && Array.isArray(opts.interceptors.ProxyAgent)\n      ? opts.interceptors.ProxyAgent\n      : []\n\n    if (typeof opts === 'string') {\n      opts = { uri: opts }\n    }\n\n    if (!opts || !opts.uri) {\n      throw new InvalidArgumentError('Proxy opts.uri is mandatory')\n    }\n\n    const { clientFactory = defaultFactory } = opts\n\n    if (typeof clientFactory !== 'function') {\n      throw new InvalidArgumentError('Proxy opts.clientFactory must be a function.')\n    }\n\n    this[kRequestTls] = opts.requestTls\n    this[kProxyTls] = opts.proxyTls\n    this[kProxyHeaders] = opts.headers || {}\n\n    const resolvedUrl = new URL(opts.uri)\n    const { origin, port, host, username, password } = resolvedUrl\n\n    if (opts.auth && opts.token) {\n      throw new InvalidArgumentError('opts.auth cannot be used in combination with opts.token')\n    } else if (opts.auth) {\n      /* @deprecated in favour of opts.token */\n      this[kProxyHeaders]['proxy-authorization'] = `Basic ${opts.auth}`\n    } else if (opts.token) {\n      this[kProxyHeaders]['proxy-authorization'] = opts.token\n    } else if (username && password) {\n      this[kProxyHeaders]['proxy-authorization'] = `Basic ${Buffer.from(`${decodeURIComponent(username)}:${decodeURIComponent(password)}`).toString('base64')}`\n    }\n\n    const connect = buildConnector({ ...opts.proxyTls })\n    this[kConnectEndpoint] = buildConnector({ ...opts.requestTls })\n    this[kClient] = clientFactory(resolvedUrl, { connect })\n    this[kAgent] = new Agent({\n      ...opts,\n      connect: async (opts, callback) => {\n        let requestedHost = opts.host\n        if (!opts.port) {\n          requestedHost += `:${defaultProtocolPort(opts.protocol)}`\n        }\n        try {\n          const { socket, statusCode } = await this[kClient].connect({\n            origin,\n            port,\n            path: requestedHost,\n            signal: opts.signal,\n            headers: {\n              ...this[kProxyHeaders],\n              host\n            }\n          })\n          if (statusCode !== 200) {\n            socket.on('error', () => {}).destroy()\n            callback(new RequestAbortedError(`Proxy response (${statusCode}) !== 200 when HTTP Tunneling`))\n          }\n          if (opts.protocol !== 'https:') {\n            callback(null, socket)\n            return\n          }\n          let servername\n          if (this[kRequestTls]) {\n            servername = this[kRequestTls].servername\n          } else {\n            servername = opts.servername\n          }\n          this[kConnectEndpoint]({ ...opts, servername, httpSocket: socket }, callback)\n        } catch (err) {\n          callback(err)\n        }\n      }\n    })\n  }\n\n  dispatch (opts, handler) {\n    const { host } = new URL(opts.origin)\n    const headers = buildHeaders(opts.headers)\n    throwIfProxyAuthIsSent(headers)\n    return this[kAgent].dispatch(\n      {\n        ...opts,\n        headers: {\n          ...headers,\n          host\n        }\n      },\n      handler\n    )\n  }\n\n  async [kClose] () {\n    await this[kAgent].close()\n    await this[kClient].close()\n  }\n\n  async [kDestroy] () {\n    await this[kAgent].destroy()\n    await this[kClient].destroy()\n  }\n}\n\n/**\n * @param {string[] | Record<string, string>} headers\n * @returns {Record<string, string>}\n */\nfunction buildHeaders (headers) {\n  // When using undici.fetch, the headers list is stored\n  // as an array.\n  if (Array.isArray(headers)) {\n    /** @type {Record<string, string>} */\n    const headersPair = {}\n\n    for (let i = 0; i < headers.length; i += 2) {\n      headersPair[headers[i]] = headers[i + 1]\n    }\n\n    return headersPair\n  }\n\n  return headers\n}\n\n/**\n * @param {Record<string, string>} headers\n *\n * Previous versions of ProxyAgent suggests the Proxy-Authorization in request headers\n * Nevertheless, it was changed and to avoid a security vulnerability by end users\n * this check was created.\n * It should be removed in the next major version for performance reasons\n */\nfunction throwIfProxyAuthIsSent (headers) {\n  const existProxyAuth = headers && Object.keys(headers)\n    .find((key) => key.toLowerCase() === 'proxy-authorization')\n  if (existProxyAuth) {\n    throw new InvalidArgumentError('Proxy-Authorization should be sent in ProxyAgent constructor')\n  }\n}\n\nmodule.exports = ProxyAgent\n","const assert = require('assert')\n\nconst { kRetryHandlerDefaultRetry } = require('../core/symbols')\nconst { RequestRetryError } = require('../core/errors')\nconst { isDisturbed, parseHeaders, parseRangeHeader } = require('../core/util')\n\nfunction calculateRetryAfterHeader (retryAfter) {\n  const current = Date.now()\n  const diff = new Date(retryAfter).getTime() - current\n\n  return diff\n}\n\nclass RetryHandler {\n  constructor (opts, handlers) {\n    const { retryOptions, ...dispatchOpts } = opts\n    const {\n      // Retry scoped\n      retry: retryFn,\n      maxRetries,\n      maxTimeout,\n      minTimeout,\n      timeoutFactor,\n      // Response scoped\n      methods,\n      errorCodes,\n      retryAfter,\n      statusCodes\n    } = retryOptions ?? {}\n\n    this.dispatch = handlers.dispatch\n    this.handler = handlers.handler\n    this.opts = dispatchOpts\n    this.abort = null\n    this.aborted = false\n    this.retryOpts = {\n      retry: retryFn ?? RetryHandler[kRetryHandlerDefaultRetry],\n      retryAfter: retryAfter ?? true,\n      maxTimeout: maxTimeout ?? 30 * 1000, // 30s,\n      timeout: minTimeout ?? 500, // .5s\n      timeoutFactor: timeoutFactor ?? 2,\n      maxRetries: maxRetries ?? 5,\n      // What errors we should retry\n      methods: methods ?? ['GET', 'HEAD', 'OPTIONS', 'PUT', 'DELETE', 'TRACE'],\n      // Indicates which errors to retry\n      statusCodes: statusCodes ?? [500, 502, 503, 504, 429],\n      // List of errors to retry\n      errorCodes: errorCodes ?? [\n        'ECONNRESET',\n        'ECONNREFUSED',\n        'ENOTFOUND',\n        'ENETDOWN',\n        'ENETUNREACH',\n        'EHOSTDOWN',\n        'EHOSTUNREACH',\n        'EPIPE'\n      ]\n    }\n\n    this.retryCount = 0\n    this.start = 0\n    this.end = null\n    this.etag = null\n    this.resume = null\n\n    // Handle possible onConnect duplication\n    this.handler.onConnect(reason => {\n      this.aborted = true\n      if (this.abort) {\n        this.abort(reason)\n      } else {\n        this.reason = reason\n      }\n    })\n  }\n\n  onRequestSent () {\n    if (this.handler.onRequestSent) {\n      this.handler.onRequestSent()\n    }\n  }\n\n  onUpgrade (statusCode, headers, socket) {\n    if (this.handler.onUpgrade) {\n      this.handler.onUpgrade(statusCode, headers, socket)\n    }\n  }\n\n  onConnect (abort) {\n    if (this.aborted) {\n      abort(this.reason)\n    } else {\n      this.abort = abort\n    }\n  }\n\n  onBodySent (chunk) {\n    if (this.handler.onBodySent) return this.handler.onBodySent(chunk)\n  }\n\n  static [kRetryHandlerDefaultRetry] (err, { state, opts }, cb) {\n    const { statusCode, code, headers } = err\n    const { method, retryOptions } = opts\n    const {\n      maxRetries,\n      timeout,\n      maxTimeout,\n      timeoutFactor,\n      statusCodes,\n      errorCodes,\n      methods\n    } = retryOptions\n    let { counter, currentTimeout } = state\n\n    currentTimeout =\n      currentTimeout != null && currentTimeout > 0 ? currentTimeout : timeout\n\n    // Any code that is not a Undici's originated and allowed to retry\n    if (\n      code &&\n      code !== 'UND_ERR_REQ_RETRY' &&\n      code !== 'UND_ERR_SOCKET' &&\n      !errorCodes.includes(code)\n    ) {\n      cb(err)\n      return\n    }\n\n    // If a set of method are provided and the current method is not in the list\n    if (Array.isArray(methods) && !methods.includes(method)) {\n      cb(err)\n      return\n    }\n\n    // If a set of status code are provided and the current status code is not in the list\n    if (\n      statusCode != null &&\n      Array.isArray(statusCodes) &&\n      !statusCodes.includes(statusCode)\n    ) {\n      cb(err)\n      return\n    }\n\n    // If we reached the max number of retries\n    if (counter > maxRetries) {\n      cb(err)\n      return\n    }\n\n    let retryAfterHeader = headers != null && headers['retry-after']\n    if (retryAfterHeader) {\n      retryAfterHeader = Number(retryAfterHeader)\n      retryAfterHeader = isNaN(retryAfterHeader)\n        ? calculateRetryAfterHeader(retryAfterHeader)\n        : retryAfterHeader * 1e3 // Retry-After is in seconds\n    }\n\n    const retryTimeout =\n      retryAfterHeader > 0\n        ? Math.min(retryAfterHeader, maxTimeout)\n        : Math.min(currentTimeout * timeoutFactor ** counter, maxTimeout)\n\n    state.currentTimeout = retryTimeout\n\n    setTimeout(() => cb(null), retryTimeout)\n  }\n\n  onHeaders (statusCode, rawHeaders, resume, statusMessage) {\n    const headers = parseHeaders(rawHeaders)\n\n    this.retryCount += 1\n\n    if (statusCode >= 300) {\n      this.abort(\n        new RequestRetryError('Request failed', statusCode, {\n          headers,\n          count: this.retryCount\n        })\n      )\n      return false\n    }\n\n    // Checkpoint for resume from where we left it\n    if (this.resume != null) {\n      this.resume = null\n\n      if (statusCode !== 206) {\n        return true\n      }\n\n      const contentRange = parseRangeHeader(headers['content-range'])\n      // If no content range\n      if (!contentRange) {\n        this.abort(\n          new RequestRetryError('Content-Range mismatch', statusCode, {\n            headers,\n            count: this.retryCount\n          })\n        )\n        return false\n      }\n\n      // Let's start with a weak etag check\n      if (this.etag != null && this.etag !== headers.etag) {\n        this.abort(\n          new RequestRetryError('ETag mismatch', statusCode, {\n            headers,\n            count: this.retryCount\n          })\n        )\n        return false\n      }\n\n      const { start, size, end = size } = contentRange\n\n      assert(this.start === start, 'content-range mismatch')\n      assert(this.end == null || this.end === end, 'content-range mismatch')\n\n      this.resume = resume\n      return true\n    }\n\n    if (this.end == null) {\n      if (statusCode === 206) {\n        // First time we receive 206\n        const range = parseRangeHeader(headers['content-range'])\n\n        if (range == null) {\n          return this.handler.onHeaders(\n            statusCode,\n            rawHeaders,\n            resume,\n            statusMessage\n          )\n        }\n\n        const { start, size, end = size } = range\n\n        assert(\n          start != null && Number.isFinite(start) && this.start !== start,\n          'content-range mismatch'\n        )\n        assert(Number.isFinite(start))\n        assert(\n          end != null && Number.isFinite(end) && this.end !== end,\n          'invalid content-length'\n        )\n\n        this.start = start\n        this.end = end\n      }\n\n      // We make our best to checkpoint the body for further range headers\n      if (this.end == null) {\n        const contentLength = headers['content-length']\n        this.end = contentLength != null ? Number(contentLength) : null\n      }\n\n      assert(Number.isFinite(this.start))\n      assert(\n        this.end == null || Number.isFinite(this.end),\n        'invalid content-length'\n      )\n\n      this.resume = resume\n      this.etag = headers.etag != null ? headers.etag : null\n\n      return this.handler.onHeaders(\n        statusCode,\n        rawHeaders,\n        resume,\n        statusMessage\n      )\n    }\n\n    const err = new RequestRetryError('Request failed', statusCode, {\n      headers,\n      count: this.retryCount\n    })\n\n    this.abort(err)\n\n    return false\n  }\n\n  onData (chunk) {\n    this.start += chunk.length\n\n    return this.handler.onData(chunk)\n  }\n\n  onComplete (rawTrailers) {\n    this.retryCount = 0\n    return this.handler.onComplete(rawTrailers)\n  }\n\n  onError (err) {\n    if (this.aborted || isDisturbed(this.opts.body)) {\n      return this.handler.onError(err)\n    }\n\n    this.retryOpts.retry(\n      err,\n      {\n        state: { counter: this.retryCount++, currentTimeout: this.retryAfter },\n        opts: { retryOptions: this.retryOpts, ...this.opts }\n      },\n      onRetry.bind(this)\n    )\n\n    function onRetry (err) {\n      if (err != null || this.aborted || isDisturbed(this.opts.body)) {\n        return this.handler.onError(err)\n      }\n\n      if (this.start !== 0) {\n        this.opts = {\n          ...this.opts,\n          headers: {\n            ...this.opts.headers,\n            range: `bytes=${this.start}-${this.end ?? ''}`\n          }\n        }\n      }\n\n      try {\n        this.dispatch(this.opts, this)\n      } catch (err) {\n        this.handler.onError(err)\n      }\n    }\n  }\n}\n\nmodule.exports = RetryHandler\n","'use strict'\n\n// We include a version number for the Dispatcher API. In case of breaking changes,\n// this version number must be increased to avoid conflicts.\nconst globalDispatcher = Symbol.for('undici.globalDispatcher.1')\nconst { InvalidArgumentError } = require('./core/errors')\nconst Agent = require('./agent')\n\nif (getGlobalDispatcher() === undefined) {\n  setGlobalDispatcher(new Agent())\n}\n\nfunction setGlobalDispatcher (agent) {\n  if (!agent || typeof agent.dispatch !== 'function') {\n    throw new InvalidArgumentError('Argument agent must implement Agent')\n  }\n  Object.defineProperty(globalThis, globalDispatcher, {\n    value: agent,\n    writable: true,\n    enumerable: false,\n    configurable: false\n  })\n}\n\nfunction getGlobalDispatcher () {\n  return globalThis[globalDispatcher]\n}\n\nmodule.exports = {\n  setGlobalDispatcher,\n  getGlobalDispatcher\n}\n","'use strict'\n\nmodule.exports = class DecoratorHandler {\n  constructor (handler) {\n    this.handler = handler\n  }\n\n  onConnect (...args) {\n    return this.handler.onConnect(...args)\n  }\n\n  onError (...args) {\n    return this.handler.onError(...args)\n  }\n\n  onUpgrade (...args) {\n    return this.handler.onUpgrade(...args)\n  }\n\n  onHeaders (...args) {\n    return this.handler.onHeaders(...args)\n  }\n\n  onData (...args) {\n    return this.handler.onData(...args)\n  }\n\n  onComplete (...args) {\n    return this.handler.onComplete(...args)\n  }\n\n  onBodySent (...args) {\n    return this.handler.onBodySent(...args)\n  }\n}\n","// https://github.com/Ethan-Arrowood/undici-fetch\n\n'use strict'\n\nconst { kHeadersList, kConstruct } = require('../core/symbols')\nconst { kGuard } = require('./symbols')\nconst { kEnumerableProperty } = require('../core/util')\nconst {\n  makeIterator,\n  isValidHeaderName,\n  isValidHeaderValue\n} = require('./util')\nconst util = require('util')\nconst { webidl } = require('./webidl')\nconst assert = require('assert')\n\nconst kHeadersMap = Symbol('headers map')\nconst kHeadersSortedMap = Symbol('headers map sorted')\n\n/**\n * @param {number} code\n */\nfunction isHTTPWhiteSpaceCharCode (code) {\n  return code === 0x00a || code === 0x00d || code === 0x009 || code === 0x020\n}\n\n/**\n * @see https://fetch.spec.whatwg.org/#concept-header-value-normalize\n * @param {string} potentialValue\n */\nfunction headerValueNormalize (potentialValue) {\n  //  To normalize a byte sequence potentialValue, remove\n  //  any leading and trailing HTTP whitespace bytes from\n  //  potentialValue.\n  let i = 0; let j = potentialValue.length\n\n  while (j > i && isHTTPWhiteSpaceCharCode(potentialValue.charCodeAt(j - 1))) --j\n  while (j > i && isHTTPWhiteSpaceCharCode(potentialValue.charCodeAt(i))) ++i\n\n  return i === 0 && j === potentialValue.length ? potentialValue : potentialValue.substring(i, j)\n}\n\nfunction fill (headers, object) {\n  // To fill a Headers object headers with a given object object, run these steps:\n\n  // 1. If object is a sequence, then for each header in object:\n  // Note: webidl conversion to array has already been done.\n  if (Array.isArray(object)) {\n    for (let i = 0; i < object.length; ++i) {\n      const header = object[i]\n      // 1. If header does not contain exactly two items, then throw a TypeError.\n      if (header.length !== 2) {\n        throw webidl.errors.exception({\n          header: 'Headers constructor',\n          message: `expected name/value pair to be length 2, found ${header.length}.`\n        })\n      }\n\n      // 2. Append (headerâ€™s first item, headerâ€™s second item) to headers.\n      appendHeader(headers, header[0], header[1])\n    }\n  } else if (typeof object === 'object' && object !== null) {\n    // Note: null should throw\n\n    // 2. Otherwise, object is a record, then for each key â†’ value in object,\n    //    append (key, value) to headers\n    const keys = Object.keys(object)\n    for (let i = 0; i < keys.length; ++i) {\n      appendHeader(headers, keys[i], object[keys[i]])\n    }\n  } else {\n    throw webidl.errors.conversionFailed({\n      prefix: 'Headers constructor',\n      argument: 'Argument 1',\n      types: ['sequence<sequence<ByteString>>', 'record<ByteString, ByteString>']\n    })\n  }\n}\n\n/**\n * @see https://fetch.spec.whatwg.org/#concept-headers-append\n */\nfunction appendHeader (headers, name, value) {\n  // 1. Normalize value.\n  value = headerValueNormalize(value)\n\n  // 2. If name is not a header name or value is not a\n  //    header value, then throw a TypeError.\n  if (!isValidHeaderName(name)) {\n    throw webidl.errors.invalidArgument({\n      prefix: 'Headers.append',\n      value: name,\n      type: 'header name'\n    })\n  } else if (!isValidHeaderValue(value)) {\n    throw webidl.errors.invalidArgument({\n      prefix: 'Headers.append',\n      value,\n      type: 'header value'\n    })\n  }\n\n  // 3. If headersâ€™s guard is \"immutable\", then throw a TypeError.\n  // 4. Otherwise, if headersâ€™s guard is \"request\" and name is a\n  //    forbidden header name, return.\n  // Note: undici does not implement forbidden header names\n  if (headers[kGuard] === 'immutable') {\n    throw new TypeError('immutable')\n  } else if (headers[kGuard] === 'request-no-cors') {\n    // 5. Otherwise, if headersâ€™s guard is \"request-no-cors\":\n    // TODO\n  }\n\n  // 6. Otherwise, if headersâ€™s guard is \"response\" and name is a\n  //    forbidden response-header name, return.\n\n  // 7. Append (name, value) to headersâ€™s header list.\n  return headers[kHeadersList].append(name, value)\n\n  // 8. If headersâ€™s guard is \"request-no-cors\", then remove\n  //    privileged no-CORS request headers from headers\n}\n\nclass HeadersList {\n  /** @type {[string, string][]|null} */\n  cookies = null\n\n  constructor (init) {\n    if (init instanceof HeadersList) {\n      this[kHeadersMap] = new Map(init[kHeadersMap])\n      this[kHeadersSortedMap] = init[kHeadersSortedMap]\n      this.cookies = init.cookies === null ? null : [...init.cookies]\n    } else {\n      this[kHeadersMap] = new Map(init)\n      this[kHeadersSortedMap] = null\n    }\n  }\n\n  // https://fetch.spec.whatwg.org/#header-list-contains\n  contains (name) {\n    // A header list list contains a header name name if list\n    // contains a header whose name is a byte-case-insensitive\n    // match for name.\n    name = name.toLowerCase()\n\n    return this[kHeadersMap].has(name)\n  }\n\n  clear () {\n    this[kHeadersMap].clear()\n    this[kHeadersSortedMap] = null\n    this.cookies = null\n  }\n\n  // https://fetch.spec.whatwg.org/#concept-header-list-append\n  append (name, value) {\n    this[kHeadersSortedMap] = null\n\n    // 1. If list contains name, then set name to the first such\n    //    headerâ€™s name.\n    const lowercaseName = name.toLowerCase()\n    const exists = this[kHeadersMap].get(lowercaseName)\n\n    // 2. Append (name, value) to list.\n    if (exists) {\n      const delimiter = lowercaseName === 'cookie' ? '; ' : ', '\n      this[kHeadersMap].set(lowercaseName, {\n        name: exists.name,\n        value: `${exists.value}${delimiter}${value}`\n      })\n    } else {\n      this[kHeadersMap].set(lowercaseName, { name, value })\n    }\n\n    if (lowercaseName === 'set-cookie') {\n      this.cookies ??= []\n      this.cookies.push(value)\n    }\n  }\n\n  // https://fetch.spec.whatwg.org/#concept-header-list-set\n  set (name, value) {\n    this[kHeadersSortedMap] = null\n    const lowercaseName = name.toLowerCase()\n\n    if (lowercaseName === 'set-cookie') {\n      this.cookies = [value]\n    }\n\n    // 1. If list contains name, then set the value of\n    //    the first such header to value and remove the\n    //    others.\n    // 2. Otherwise, append header (name, value) to list.\n    this[kHeadersMap].set(lowercaseName, { name, value })\n  }\n\n  // https://fetch.spec.whatwg.org/#concept-header-list-delete\n  delete (name) {\n    this[kHeadersSortedMap] = null\n\n    name = name.toLowerCase()\n\n    if (name === 'set-cookie') {\n      this.cookies = null\n    }\n\n    this[kHeadersMap].delete(name)\n  }\n\n  // https://fetch.spec.whatwg.org/#concept-header-list-get\n  get (name) {\n    const value = this[kHeadersMap].get(name.toLowerCase())\n\n    // 1. If list does not contain name, then return null.\n    // 2. Return the values of all headers in list whose name\n    //    is a byte-case-insensitive match for name,\n    //    separated from each other by 0x2C 0x20, in order.\n    return value === undefined ? null : value.value\n  }\n\n  * [Symbol.iterator] () {\n    // use the lowercased name\n    for (const [name, { value }] of this[kHeadersMap]) {\n      yield [name, value]\n    }\n  }\n\n  get entries () {\n    const headers = {}\n\n    if (this[kHeadersMap].size) {\n      for (const { name, value } of this[kHeadersMap].values()) {\n        headers[name] = value\n      }\n    }\n\n    return headers\n  }\n}\n\n// https://fetch.spec.whatwg.org/#headers-class\nclass Headers {\n  constructor (init = undefined) {\n    if (init === kConstruct) {\n      return\n    }\n    this[kHeadersList] = new HeadersList()\n\n    // The new Headers(init) constructor steps are:\n\n    // 1. Set thisâ€™s guard to \"none\".\n    this[kGuard] = 'none'\n\n    // 2. If init is given, then fill this with init.\n    if (init !== undefined) {\n      init = webidl.converters.HeadersInit(init)\n      fill(this, init)\n    }\n  }\n\n  // https://fetch.spec.whatwg.org/#dom-headers-append\n  append (name, value) {\n    webidl.brandCheck(this, Headers)\n\n    webidl.argumentLengthCheck(arguments, 2, { header: 'Headers.append' })\n\n    name = webidl.converters.ByteString(name)\n    value = webidl.converters.ByteString(value)\n\n    return appendHeader(this, name, value)\n  }\n\n  // https://fetch.spec.whatwg.org/#dom-headers-delete\n  delete (name) {\n    webidl.brandCheck(this, Headers)\n\n    webidl.argumentLengthCheck(arguments, 1, { header: 'Headers.delete' })\n\n    name = webidl.converters.ByteString(name)\n\n    // 1. If name is not a header name, then throw a TypeError.\n    if (!isValidHeaderName(name)) {\n      throw webidl.errors.invalidArgument({\n        prefix: 'Headers.delete',\n        value: name,\n        type: 'header name'\n      })\n    }\n\n    // 2. If thisâ€™s guard is \"immutable\", then throw a TypeError.\n    // 3. Otherwise, if thisâ€™s guard is \"request\" and name is a\n    //    forbidden header name, return.\n    // 4. Otherwise, if thisâ€™s guard is \"request-no-cors\", name\n    //    is not a no-CORS-safelisted request-header name, and\n    //    name is not a privileged no-CORS request-header name,\n    //    return.\n    // 5. Otherwise, if thisâ€™s guard is \"response\" and name is\n    //    a forbidden response-header name, return.\n    // Note: undici does not implement forbidden header names\n    if (this[kGuard] === 'immutable') {\n      throw new TypeError('immutable')\n    } else if (this[kGuard] === 'request-no-cors') {\n      // TODO\n    }\n\n    // 6. If thisâ€™s header list does not contain name, then\n    //    return.\n    if (!this[kHeadersList].contains(name)) {\n      return\n    }\n\n    // 7. Delete name from thisâ€™s header list.\n    // 8. If thisâ€™s guard is \"request-no-cors\", then remove\n    //    privileged no-CORS request headers from this.\n    this[kHeadersList].delete(name)\n  }\n\n  // https://fetch.spec.whatwg.org/#dom-headers-get\n  get (name) {\n    webidl.brandCheck(this, Headers)\n\n    webidl.argumentLengthCheck(arguments, 1, { header: 'Headers.get' })\n\n    name = webidl.converters.ByteString(name)\n\n    // 1. If name is not a header name, then throw a TypeError.\n    if (!isValidHeaderName(name)) {\n      throw webidl.errors.invalidArgument({\n        prefix: 'Headers.get',\n        value: name,\n        type: 'header name'\n      })\n    }\n\n    // 2. Return the result of getting name from thisâ€™s header\n    //    list.\n    return this[kHeadersList].get(name)\n  }\n\n  // https://fetch.spec.whatwg.org/#dom-headers-has\n  has (name) {\n    webidl.brandCheck(this, Headers)\n\n    webidl.argumentLengthCheck(arguments, 1, { header: 'Headers.has' })\n\n    name = webidl.converters.ByteString(name)\n\n    // 1. If name is not a header name, then throw a TypeError.\n    if (!isValidHeaderName(name)) {\n      throw webidl.errors.invalidArgument({\n        prefix: 'Headers.has',\n        value: name,\n        type: 'header name'\n      })\n    }\n\n    // 2. Return true if thisâ€™s header list contains name;\n    //    otherwise false.\n    return this[kHeadersList].contains(name)\n  }\n\n  // https://fetch.spec.whatwg.org/#dom-headers-set\n  set (name, value) {\n    webidl.brandCheck(this, Headers)\n\n    webidl.argumentLengthCheck(arguments, 2, { header: 'Headers.set' })\n\n    name = webidl.converters.ByteString(name)\n    value = webidl.converters.ByteString(value)\n\n    // 1. Normalize value.\n    value = headerValueNormalize(value)\n\n    // 2. If name is not a header name or value is not a\n    //    header value, then throw a TypeError.\n    if (!isValidHeaderName(name)) {\n      throw webidl.errors.invalidArgument({\n        prefix: 'Headers.set',\n        value: name,\n        type: 'header name'\n      })\n    } else if (!isValidHeaderValue(value)) {\n      throw webidl.errors.invalidArgument({\n        prefix: 'Headers.set',\n        value,\n        type: 'header value'\n      })\n    }\n\n    // 3. If thisâ€™s guard is \"immutable\", then throw a TypeError.\n    // 4. Otherwise, if thisâ€™s guard is \"request\" and name is a\n    //    forbidden header name, return.\n    // 5. Otherwise, if thisâ€™s guard is \"request-no-cors\" and\n    //    name/value is not a no-CORS-safelisted request-header,\n    //    return.\n    // 6. Otherwise, if thisâ€™s guard is \"response\" and name is a\n    //    forbidden response-header name, return.\n    // Note: undici does not implement forbidden header names\n    if (this[kGuard] === 'immutable') {\n      throw new TypeError('immutable')\n    } else if (this[kGuard] === 'request-no-cors') {\n      // TODO\n    }\n\n    // 7. Set (name, value) in thisâ€™s header list.\n    // 8. If thisâ€™s guard is \"request-no-cors\", then remove\n    //    privileged no-CORS request headers from this\n    this[kHeadersList].set(name, value)\n  }\n\n  // https://fetch.spec.whatwg.org/#dom-headers-getsetcookie\n  getSetCookie () {\n    webidl.brandCheck(this, Headers)\n\n    // 1. If thisâ€™s header list does not contain `Set-Cookie`, then return Â« Â».\n    // 2. Return the values of all headers in thisâ€™s header list whose name is\n    //    a byte-case-insensitive match for `Set-Cookie`, in order.\n\n    const list = this[kHeadersList].cookies\n\n    if (list) {\n      return [...list]\n    }\n\n    return []\n  }\n\n  // https://fetch.spec.whatwg.org/#concept-header-list-sort-and-combine\n  get [kHeadersSortedMap] () {\n    if (this[kHeadersList][kHeadersSortedMap]) {\n      return this[kHeadersList][kHeadersSortedMap]\n    }\n\n    // 1. Let headers be an empty list of headers with the key being the name\n    //    and value the value.\n    const headers = []\n\n    // 2. Let names be the result of convert header names to a sorted-lowercase\n    //    set with all the names of the headers in list.\n    const names = [...this[kHeadersList]].sort((a, b) => a[0] < b[0] ? -1 : 1)\n    const cookies = this[kHeadersList].cookies\n\n    // 3. For each name of names:\n    for (let i = 0; i < names.length; ++i) {\n      const [name, value] = names[i]\n      // 1. If name is `set-cookie`, then:\n      if (name === 'set-cookie') {\n        // 1. Let values be a list of all values of headers in list whose name\n        //    is a byte-case-insensitive match for name, in order.\n\n        // 2. For each value of values:\n        // 1. Append (name, value) to headers.\n        for (let j = 0; j < cookies.length; ++j) {\n          headers.push([name, cookies[j]])\n        }\n      } else {\n        // 2. Otherwise:\n\n        // 1. Let value be the result of getting name from list.\n\n        // 2. Assert: value is non-null.\n        assert(value !== null)\n\n        // 3. Append (name, value) to headers.\n        headers.push([name, value])\n      }\n    }\n\n    this[kHeadersList][kHeadersSortedMap] = headers\n\n    // 4. Return headers.\n    return headers\n  }\n\n  keys () {\n    webidl.brandCheck(this, Headers)\n\n    if (this[kGuard] === 'immutable') {\n      const value = this[kHeadersSortedMap]\n      return makeIterator(() => value, 'Headers',\n        'key')\n    }\n\n    return makeIterator(\n      () => [...this[kHeadersSortedMap].values()],\n      'Headers',\n      'key'\n    )\n  }\n\n  values () {\n    webidl.brandCheck(this, Headers)\n\n    if (this[kGuard] === 'immutable') {\n      const value = this[kHeadersSortedMap]\n      return makeIterator(() => value, 'Headers',\n        'value')\n    }\n\n    return makeIterator(\n      () => [...this[kHeadersSortedMap].values()],\n      'Headers',\n      'value'\n    )\n  }\n\n  entries () {\n    webidl.brandCheck(this, Headers)\n\n    if (this[kGuard] === 'immutable') {\n      const value = this[kHeadersSortedMap]\n      return makeIterator(() => value, 'Headers',\n        'key+value')\n    }\n\n    return makeIterator(\n      () => [...this[kHeadersSortedMap].values()],\n      'Headers',\n      'key+value'\n    )\n  }\n\n  /**\n   * @param {(value: string, key: string, self: Headers) => void} callbackFn\n   * @param {unknown} thisArg\n   */\n  forEach (callbackFn, thisArg = globalThis) {\n    webidl.brandCheck(this, Headers)\n\n    webidl.argumentLengthCheck(arguments, 1, { header: 'Headers.forEach' })\n\n    if (typeof callbackFn !== 'function') {\n      throw new TypeError(\n        \"Failed to execute 'forEach' on 'Headers': parameter 1 is not of type 'Function'.\"\n      )\n    }\n\n    for (const [key, value] of this) {\n      callbackFn.apply(thisArg, [value, key, this])\n    }\n  }\n\n  [Symbol.for('nodejs.util.inspect.custom')] () {\n    webidl.brandCheck(this, Headers)\n\n    return this[kHeadersList]\n  }\n}\n\nHeaders.prototype[Symbol.iterator] = Headers.prototype.entries\n\nObject.defineProperties(Headers.prototype, {\n  append: kEnumerableProperty,\n  delete: kEnumerableProperty,\n  get: kEnumerableProperty,\n  has: kEnumerableProperty,\n  set: kEnumerableProperty,\n  getSetCookie: kEnumerableProperty,\n  keys: kEnumerableProperty,\n  values: kEnumerableProperty,\n  entries: kEnumerableProperty,\n  forEach: kEnumerableProperty,\n  [Symbol.iterator]: { enumerable: false },\n  [Symbol.toStringTag]: {\n    value: 'Headers',\n    configurable: true\n  },\n  [util.inspect.custom]: {\n    enumerable: false\n  }\n})\n\nwebidl.converters.HeadersInit = function (V) {\n  if (webidl.util.Type(V) === 'Object') {\n    if (V[Symbol.iterator]) {\n      return webidl.converters['sequence<sequence<ByteString>>'](V)\n    }\n\n    return webidl.converters['record<ByteString, ByteString>'](V)\n  }\n\n  throw webidl.errors.conversionFailed({\n    prefix: 'Headers constructor',\n    argument: 'Argument 1',\n    types: ['sequence<sequence<ByteString>>', 'record<ByteString, ByteString>']\n  })\n}\n\nmodule.exports = {\n  fill,\n  Headers,\n  HeadersList\n}\n","'use strict'\n\nconst { Headers, HeadersList, fill } = require('./headers')\nconst { extractBody, cloneBody, mixinBody } = require('./body')\nconst util = require('../core/util')\nconst { kEnumerableProperty } = util\nconst {\n  isValidReasonPhrase,\n  isCancelled,\n  isAborted,\n  isBlobLike,\n  serializeJavascriptValueToJSONString,\n  isErrorLike,\n  isomorphicEncode\n} = require('./util')\nconst {\n  redirectStatusSet,\n  nullBodyStatus,\n  DOMException\n} = require('./constants')\nconst { kState, kHeaders, kGuard, kRealm } = require('./symbols')\nconst { webidl } = require('./webidl')\nconst { FormData } = require('./formdata')\nconst { getGlobalOrigin } = require('./global')\nconst { URLSerializer } = require('./dataURL')\nconst { kHeadersList, kConstruct } = require('../core/symbols')\nconst assert = require('assert')\nconst { types } = require('util')\n\nconst ReadableStream = globalThis.ReadableStream || require('stream/web').ReadableStream\nconst textEncoder = new TextEncoder('utf-8')\n\n// https://fetch.spec.whatwg.org/#response-class\nclass Response {\n  // Creates network error Response.\n  static error () {\n    // TODO\n    const relevantRealm = { settingsObject: {} }\n\n    // The static error() method steps are to return the result of creating a\n    // Response object, given a new network error, \"immutable\", and thisâ€™s\n    // relevant Realm.\n    const responseObject = new Response()\n    responseObject[kState] = makeNetworkError()\n    responseObject[kRealm] = relevantRealm\n    responseObject[kHeaders][kHeadersList] = responseObject[kState].headersList\n    responseObject[kHeaders][kGuard] = 'immutable'\n    responseObject[kHeaders][kRealm] = relevantRealm\n    return responseObject\n  }\n\n  // https://fetch.spec.whatwg.org/#dom-response-json\n  static json (data, init = {}) {\n    webidl.argumentLengthCheck(arguments, 1, { header: 'Response.json' })\n\n    if (init !== null) {\n      init = webidl.converters.ResponseInit(init)\n    }\n\n    // 1. Let bytes the result of running serialize a JavaScript value to JSON bytes on data.\n    const bytes = textEncoder.encode(\n      serializeJavascriptValueToJSONString(data)\n    )\n\n    // 2. Let body be the result of extracting bytes.\n    const body = extractBody(bytes)\n\n    // 3. Let responseObject be the result of creating a Response object, given a new response,\n    //    \"response\", and thisâ€™s relevant Realm.\n    const relevantRealm = { settingsObject: {} }\n    const responseObject = new Response()\n    responseObject[kRealm] = relevantRealm\n    responseObject[kHeaders][kGuard] = 'response'\n    responseObject[kHeaders][kRealm] = relevantRealm\n\n    // 4. Perform initialize a response given responseObject, init, and (body, \"application/json\").\n    initializeResponse(responseObject, init, { body: body[0], type: 'application/json' })\n\n    // 5. Return responseObject.\n    return responseObject\n  }\n\n  // Creates a redirect Response that redirects to url with status status.\n  static redirect (url, status = 302) {\n    const relevantRealm = { settingsObject: {} }\n\n    webidl.argumentLengthCheck(arguments, 1, { header: 'Response.redirect' })\n\n    url = webidl.converters.USVString(url)\n    status = webidl.converters['unsigned short'](status)\n\n    // 1. Let parsedURL be the result of parsing url with current settings\n    // objectâ€™s API base URL.\n    // 2. If parsedURL is failure, then throw a TypeError.\n    // TODO: base-URL?\n    let parsedURL\n    try {\n      parsedURL = new URL(url, getGlobalOrigin())\n    } catch (err) {\n      throw Object.assign(new TypeError('Failed to parse URL from ' + url), {\n        cause: err\n      })\n    }\n\n    // 3. If status is not a redirect status, then throw a RangeError.\n    if (!redirectStatusSet.has(status)) {\n      throw new RangeError('Invalid status code ' + status)\n    }\n\n    // 4. Let responseObject be the result of creating a Response object,\n    // given a new response, \"immutable\", and thisâ€™s relevant Realm.\n    const responseObject = new Response()\n    responseObject[kRealm] = relevantRealm\n    responseObject[kHeaders][kGuard] = 'immutable'\n    responseObject[kHeaders][kRealm] = relevantRealm\n\n    // 5. Set responseObjectâ€™s responseâ€™s status to status.\n    responseObject[kState].status = status\n\n    // 6. Let value be parsedURL, serialized and isomorphic encoded.\n    const value = isomorphicEncode(URLSerializer(parsedURL))\n\n    // 7. Append `Location`/value to responseObjectâ€™s responseâ€™s header list.\n    responseObject[kState].headersList.append('location', value)\n\n    // 8. Return responseObject.\n    return responseObject\n  }\n\n  // https://fetch.spec.whatwg.org/#dom-response\n  constructor (body = null, init = {}) {\n    if (body !== null) {\n      body = webidl.converters.BodyInit(body)\n    }\n\n    init = webidl.converters.ResponseInit(init)\n\n    // TODO\n    this[kRealm] = { settingsObject: {} }\n\n    // 1. Set thisâ€™s response to a new response.\n    this[kState] = makeResponse({})\n\n    // 2. Set thisâ€™s headers to a new Headers object with thisâ€™s relevant\n    // Realm, whose header list is thisâ€™s responseâ€™s header list and guard\n    // is \"response\".\n    this[kHeaders] = new Headers(kConstruct)\n    this[kHeaders][kGuard] = 'response'\n    this[kHeaders][kHeadersList] = this[kState].headersList\n    this[kHeaders][kRealm] = this[kRealm]\n\n    // 3. Let bodyWithType be null.\n    let bodyWithType = null\n\n    // 4. If body is non-null, then set bodyWithType to the result of extracting body.\n    if (body != null) {\n      const [extractedBody, type] = extractBody(body)\n      bodyWithType = { body: extractedBody, type }\n    }\n\n    // 5. Perform initialize a response given this, init, and bodyWithType.\n    initializeResponse(this, init, bodyWithType)\n  }\n\n  // Returns responseâ€™s type, e.g., \"cors\".\n  get type () {\n    webidl.brandCheck(this, Response)\n\n    // The type getter steps are to return thisâ€™s responseâ€™s type.\n    return this[kState].type\n  }\n\n  // Returns responseâ€™s URL, if it has one; otherwise the empty string.\n  get url () {\n    webidl.brandCheck(this, Response)\n\n    const urlList = this[kState].urlList\n\n    // The url getter steps are to return the empty string if thisâ€™s\n    // responseâ€™s URL is null; otherwise thisâ€™s responseâ€™s URL,\n    // serialized with exclude fragment set to true.\n    const url = urlList[urlList.length - 1] ?? null\n\n    if (url === null) {\n      return ''\n    }\n\n    return URLSerializer(url, true)\n  }\n\n  // Returns whether response was obtained through a redirect.\n  get redirected () {\n    webidl.brandCheck(this, Response)\n\n    // The redirected getter steps are to return true if thisâ€™s responseâ€™s URL\n    // list has more than one item; otherwise false.\n    return this[kState].urlList.length > 1\n  }\n\n  // Returns responseâ€™s status.\n  get status () {\n    webidl.brandCheck(this, Response)\n\n    // The status getter steps are to return thisâ€™s responseâ€™s status.\n    return this[kState].status\n  }\n\n  // Returns whether responseâ€™s status is an ok status.\n  get ok () {\n    webidl.brandCheck(this, Response)\n\n    // The ok getter steps are to return true if thisâ€™s responseâ€™s status is an\n    // ok status; otherwise false.\n    return this[kState].status >= 200 && this[kState].status <= 299\n  }\n\n  // Returns responseâ€™s status message.\n  get statusText () {\n    webidl.brandCheck(this, Response)\n\n    // The statusText getter steps are to return thisâ€™s responseâ€™s status\n    // message.\n    return this[kState].statusText\n  }\n\n  // Returns responseâ€™s headers as Headers.\n  get headers () {\n    webidl.brandCheck(this, Response)\n\n    // The headers getter steps are to return thisâ€™s headers.\n    return this[kHeaders]\n  }\n\n  get body () {\n    webidl.brandCheck(this, Response)\n\n    return this[kState].body ? this[kState].body.stream : null\n  }\n\n  get bodyUsed () {\n    webidl.brandCheck(this, Response)\n\n    return !!this[kState].body && util.isDisturbed(this[kState].body.stream)\n  }\n\n  // Returns a clone of response.\n  clone () {\n    webidl.brandCheck(this, Response)\n\n    // 1. If this is unusable, then throw a TypeError.\n    if (this.bodyUsed || (this.body && this.body.locked)) {\n      throw webidl.errors.exception({\n        header: 'Response.clone',\n        message: 'Body has already been consumed.'\n      })\n    }\n\n    // 2. Let clonedResponse be the result of cloning thisâ€™s response.\n    const clonedResponse = cloneResponse(this[kState])\n\n    // 3. Return the result of creating a Response object, given\n    // clonedResponse, thisâ€™s headersâ€™s guard, and thisâ€™s relevant Realm.\n    const clonedResponseObject = new Response()\n    clonedResponseObject[kState] = clonedResponse\n    clonedResponseObject[kRealm] = this[kRealm]\n    clonedResponseObject[kHeaders][kHeadersList] = clonedResponse.headersList\n    clonedResponseObject[kHeaders][kGuard] = this[kHeaders][kGuard]\n    clonedResponseObject[kHeaders][kRealm] = this[kHeaders][kRealm]\n\n    return clonedResponseObject\n  }\n}\n\nmixinBody(Response)\n\nObject.defineProperties(Response.prototype, {\n  type: kEnumerableProperty,\n  url: kEnumerableProperty,\n  status: kEnumerableProperty,\n  ok: kEnumerableProperty,\n  redirected: kEnumerableProperty,\n  statusText: kEnumerableProperty,\n  headers: kEnumerableProperty,\n  clone: kEnumerableProperty,\n  body: kEnumerableProperty,\n  bodyUsed: kEnumerableProperty,\n  [Symbol.toStringTag]: {\n    value: 'Response',\n    configurable: true\n  }\n})\n\nObject.defineProperties(Response, {\n  json: kEnumerableProperty,\n  redirect: kEnumerableProperty,\n  error: kEnumerableProperty\n})\n\n// https://fetch.spec.whatwg.org/#concept-response-clone\nfunction cloneResponse (response) {\n  // To clone a response response, run these steps:\n\n  // 1. If response is a filtered response, then return a new identical\n  // filtered response whose internal response is a clone of responseâ€™s\n  // internal response.\n  if (response.internalResponse) {\n    return filterResponse(\n      cloneResponse(response.internalResponse),\n      response.type\n    )\n  }\n\n  // 2. Let newResponse be a copy of response, except for its body.\n  const newResponse = makeResponse({ ...response, body: null })\n\n  // 3. If responseâ€™s body is non-null, then set newResponseâ€™s body to the\n  // result of cloning responseâ€™s body.\n  if (response.body != null) {\n    newResponse.body = cloneBody(response.body)\n  }\n\n  // 4. Return newResponse.\n  return newResponse\n}\n\nfunction makeResponse (init) {\n  return {\n    aborted: false,\n    rangeRequested: false,\n    timingAllowPassed: false,\n    requestIncludesCredentials: false,\n    type: 'default',\n    status: 200,\n    timingInfo: null,\n    cacheState: '',\n    statusText: '',\n    ...init,\n    headersList: init.headersList\n      ? new HeadersList(init.headersList)\n      : new HeadersList(),\n    urlList: init.urlList ? [...init.urlList] : []\n  }\n}\n\nfunction makeNetworkError (reason) {\n  const isError = isErrorLike(reason)\n  return makeResponse({\n    type: 'error',\n    status: 0,\n    error: isError\n      ? reason\n      : new Error(reason ? String(reason) : reason),\n    aborted: reason && reason.name === 'AbortError'\n  })\n}\n\nfunction makeFilteredResponse (response, state) {\n  state = {\n    internalResponse: response,\n    ...state\n  }\n\n  return new Proxy(response, {\n    get (target, p) {\n      return p in state ? state[p] : target[p]\n    },\n    set (target, p, value) {\n      assert(!(p in state))\n      target[p] = value\n      return true\n    }\n  })\n}\n\n// https://fetch.spec.whatwg.org/#concept-filtered-response\nfunction filterResponse (response, type) {\n  // Set response to the following filtered response with response as its\n  // internal response, depending on requestâ€™s response tainting:\n  if (type === 'basic') {\n    // A basic filtered response is a filtered response whose type is \"basic\"\n    // and header list excludes any headers in internal responseâ€™s header list\n    // whose name is a forbidden response-header name.\n\n    // Note: undici does not implement forbidden response-header names\n    return makeFilteredResponse(response, {\n      type: 'basic',\n      headersList: response.headersList\n    })\n  } else if (type === 'cors') {\n    // A CORS filtered response is a filtered response whose type is \"cors\"\n    // and header list excludes any headers in internal responseâ€™s header\n    // list whose name is not a CORS-safelisted response-header name, given\n    // internal responseâ€™s CORS-exposed header-name list.\n\n    // Note: undici does not implement CORS-safelisted response-header names\n    return makeFilteredResponse(response, {\n      type: 'cors',\n      headersList: response.headersList\n    })\n  } else if (type === 'opaque') {\n    // An opaque filtered response is a filtered response whose type is\n    // \"opaque\", URL list is the empty list, status is 0, status message\n    // is the empty byte sequence, header list is empty, and body is null.\n\n    return makeFilteredResponse(response, {\n      type: 'opaque',\n      urlList: Object.freeze([]),\n      status: 0,\n      statusText: '',\n      body: null\n    })\n  } else if (type === 'opaqueredirect') {\n    // An opaque-redirect filtered response is a filtered response whose type\n    // is \"opaqueredirect\", status is 0, status message is the empty byte\n    // sequence, header list is empty, and body is null.\n\n    return makeFilteredResponse(response, {\n      type: 'opaqueredirect',\n      status: 0,\n      statusText: '',\n      headersList: [],\n      body: null\n    })\n  } else {\n    assert(false)\n  }\n}\n\n// https://fetch.spec.whatwg.org/#appropriate-network-error\nfunction makeAppropriateNetworkError (fetchParams, err = null) {\n  // 1. Assert: fetchParams is canceled.\n  assert(isCancelled(fetchParams))\n\n  // 2. Return an aborted network error if fetchParams is aborted;\n  // otherwise return a network error.\n  return isAborted(fetchParams)\n    ? makeNetworkError(Object.assign(new DOMException('The operation was aborted.', 'AbortError'), { cause: err }))\n    : makeNetworkError(Object.assign(new DOMException('Request was cancelled.'), { cause: err }))\n}\n\n// https://whatpr.org/fetch/1392.html#initialize-a-response\nfunction initializeResponse (response, init, body) {\n  // 1. If init[\"status\"] is not in the range 200 to 599, inclusive, then\n  //    throw a RangeError.\n  if (init.status !== null && (init.status < 200 || init.status > 599)) {\n    throw new RangeError('init[\"status\"] must be in the range of 200 to 599, inclusive.')\n  }\n\n  // 2. If init[\"statusText\"] does not match the reason-phrase token production,\n  //    then throw a TypeError.\n  if ('statusText' in init && init.statusText != null) {\n    // See, https://datatracker.ietf.org/doc/html/rfc7230#section-3.1.2:\n    //   reason-phrase  = *( HTAB / SP / VCHAR / obs-text )\n    if (!isValidReasonPhrase(String(init.statusText))) {\n      throw new TypeError('Invalid statusText')\n    }\n  }\n\n  // 3. Set responseâ€™s responseâ€™s status to init[\"status\"].\n  if ('status' in init && init.status != null) {\n    response[kState].status = init.status\n  }\n\n  // 4. Set responseâ€™s responseâ€™s status message to init[\"statusText\"].\n  if ('statusText' in init && init.statusText != null) {\n    response[kState].statusText = init.statusText\n  }\n\n  // 5. If init[\"headers\"] exists, then fill responseâ€™s headers with init[\"headers\"].\n  if ('headers' in init && init.headers != null) {\n    fill(response[kHeaders], init.headers)\n  }\n\n  // 6. If body was given, then:\n  if (body) {\n    // 1. If response's status is a null body status, then throw a TypeError.\n    if (nullBodyStatus.includes(response.status)) {\n      throw webidl.errors.exception({\n        header: 'Response constructor',\n        message: 'Invalid response status code ' + response.status\n      })\n    }\n\n    // 2. Set response's body to body's body.\n    response[kState].body = body.body\n\n    // 3. If body's type is non-null and response's header list does not contain\n    //    `Content-Type`, then append (`Content-Type`, body's type) to response's header list.\n    if (body.type != null && !response[kState].headersList.contains('Content-Type')) {\n      response[kState].headersList.append('content-type', body.type)\n    }\n  }\n}\n\nwebidl.converters.ReadableStream = webidl.interfaceConverter(\n  ReadableStream\n)\n\nwebidl.converters.FormData = webidl.interfaceConverter(\n  FormData\n)\n\nwebidl.converters.URLSearchParams = webidl.interfaceConverter(\n  URLSearchParams\n)\n\n// https://fetch.spec.whatwg.org/#typedefdef-xmlhttprequestbodyinit\nwebidl.converters.XMLHttpRequestBodyInit = function (V) {\n  if (typeof V === 'string') {\n    return webidl.converters.USVString(V)\n  }\n\n  if (isBlobLike(V)) {\n    return webidl.converters.Blob(V, { strict: false })\n  }\n\n  if (types.isArrayBuffer(V) || types.isTypedArray(V) || types.isDataView(V)) {\n    return webidl.converters.BufferSource(V)\n  }\n\n  if (util.isFormDataLike(V)) {\n    return webidl.converters.FormData(V, { strict: false })\n  }\n\n  if (V instanceof URLSearchParams) {\n    return webidl.converters.URLSearchParams(V)\n  }\n\n  return webidl.converters.DOMString(V)\n}\n\n// https://fetch.spec.whatwg.org/#bodyinit\nwebidl.converters.BodyInit = function (V) {\n  if (V instanceof ReadableStream) {\n    return webidl.converters.ReadableStream(V)\n  }\n\n  // Note: the spec doesn't include async iterables,\n  // this is an undici extension.\n  if (V?.[Symbol.asyncIterator]) {\n    return V\n  }\n\n  return webidl.converters.XMLHttpRequestBodyInit(V)\n}\n\nwebidl.converters.ResponseInit = webidl.dictionaryConverter([\n  {\n    key: 'status',\n    converter: webidl.converters['unsigned short'],\n    defaultValue: 200\n  },\n  {\n    key: 'statusText',\n    converter: webidl.converters.ByteString,\n    defaultValue: ''\n  },\n  {\n    key: 'headers',\n    converter: webidl.converters.HeadersInit\n  }\n])\n\nmodule.exports = {\n  makeNetworkError,\n  makeResponse,\n  makeAppropriateNetworkError,\n  filterResponse,\n  Response,\n  cloneResponse\n}\n","/* globals AbortController */\n\n'use strict'\n\nconst { extractBody, mixinBody, cloneBody } = require('./body')\nconst { Headers, fill: fillHeaders, HeadersList } = require('./headers')\nconst { FinalizationRegistry } = require('../compat/dispatcher-weakref')()\nconst util = require('../core/util')\nconst {\n  isValidHTTPToken,\n  sameOrigin,\n  normalizeMethod,\n  makePolicyContainer,\n  normalizeMethodRecord\n} = require('./util')\nconst {\n  forbiddenMethodsSet,\n  corsSafeListedMethodsSet,\n  referrerPolicy,\n  requestRedirect,\n  requestMode,\n  requestCredentials,\n  requestCache,\n  requestDuplex\n} = require('./constants')\nconst { kEnumerableProperty } = util\nconst { kHeaders, kSignal, kState, kGuard, kRealm } = require('./symbols')\nconst { webidl } = require('./webidl')\nconst { getGlobalOrigin } = require('./global')\nconst { URLSerializer } = require('./dataURL')\nconst { kHeadersList, kConstruct } = require('../core/symbols')\nconst assert = require('assert')\nconst { getMaxListeners, setMaxListeners, getEventListeners, defaultMaxListeners } = require('events')\n\nlet TransformStream = globalThis.TransformStream\n\nconst kAbortController = Symbol('abortController')\n\nconst requestFinalizer = new FinalizationRegistry(({ signal, abort }) => {\n  signal.removeEventListener('abort', abort)\n})\n\n// https://fetch.spec.whatwg.org/#request-class\nclass Request {\n  // https://fetch.spec.whatwg.org/#dom-request\n  constructor (input, init = {}) {\n    if (input === kConstruct) {\n      return\n    }\n\n    webidl.argumentLengthCheck(arguments, 1, { header: 'Request constructor' })\n\n    input = webidl.converters.RequestInfo(input)\n    init = webidl.converters.RequestInit(init)\n\n    // https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\n    this[kRealm] = {\n      settingsObject: {\n        baseUrl: getGlobalOrigin(),\n        get origin () {\n          return this.baseUrl?.origin\n        },\n        policyContainer: makePolicyContainer()\n      }\n    }\n\n    // 1. Let request be null.\n    let request = null\n\n    // 2. Let fallbackMode be null.\n    let fallbackMode = null\n\n    // 3. Let baseURL be thisâ€™s relevant settings objectâ€™s API base URL.\n    const baseUrl = this[kRealm].settingsObject.baseUrl\n\n    // 4. Let signal be null.\n    let signal = null\n\n    // 5. If input is a string, then:\n    if (typeof input === 'string') {\n      // 1. Let parsedURL be the result of parsing input with baseURL.\n      // 2. If parsedURL is failure, then throw a TypeError.\n      let parsedURL\n      try {\n        parsedURL = new URL(input, baseUrl)\n      } catch (err) {\n        throw new TypeError('Failed to parse URL from ' + input, { cause: err })\n      }\n\n      // 3. If parsedURL includes credentials, then throw a TypeError.\n      if (parsedURL.username || parsedURL.password) {\n        throw new TypeError(\n          'Request cannot be constructed from a URL that includes credentials: ' +\n            input\n        )\n      }\n\n      // 4. Set request to a new request whose URL is parsedURL.\n      request = makeRequest({ urlList: [parsedURL] })\n\n      // 5. Set fallbackMode to \"cors\".\n      fallbackMode = 'cors'\n    } else {\n      // 6. Otherwise:\n\n      // 7. Assert: input is a Request object.\n      assert(input instanceof Request)\n\n      // 8. Set request to inputâ€™s request.\n      request = input[kState]\n\n      // 9. Set signal to inputâ€™s signal.\n      signal = input[kSignal]\n    }\n\n    // 7. Let origin be thisâ€™s relevant settings objectâ€™s origin.\n    const origin = this[kRealm].settingsObject.origin\n\n    // 8. Let window be \"client\".\n    let window = 'client'\n\n    // 9. If requestâ€™s window is an environment settings object and its origin\n    // is same origin with origin, then set window to requestâ€™s window.\n    if (\n      request.window?.constructor?.name === 'EnvironmentSettingsObject' &&\n      sameOrigin(request.window, origin)\n    ) {\n      window = request.window\n    }\n\n    // 10. If init[\"window\"] exists and is non-null, then throw a TypeError.\n    if (init.window != null) {\n      throw new TypeError(`'window' option '${window}' must be null`)\n    }\n\n    // 11. If init[\"window\"] exists, then set window to \"no-window\".\n    if ('window' in init) {\n      window = 'no-window'\n    }\n\n    // 12. Set request to a new request with the following properties:\n    request = makeRequest({\n      // URL requestâ€™s URL.\n      // undici implementation note: this is set as the first item in request's urlList in makeRequest\n      // method requestâ€™s method.\n      method: request.method,\n      // header list A copy of requestâ€™s header list.\n      // undici implementation note: headersList is cloned in makeRequest\n      headersList: request.headersList,\n      // unsafe-request flag Set.\n      unsafeRequest: request.unsafeRequest,\n      // client Thisâ€™s relevant settings object.\n      client: this[kRealm].settingsObject,\n      // window window.\n      window,\n      // priority requestâ€™s priority.\n      priority: request.priority,\n      // origin requestâ€™s origin. The propagation of the origin is only significant for navigation requests\n      // being handled by a service worker. In this scenario a request can have an origin that is different\n      // from the current client.\n      origin: request.origin,\n      // referrer requestâ€™s referrer.\n      referrer: request.referrer,\n      // referrer policy requestâ€™s referrer policy.\n      referrerPolicy: request.referrerPolicy,\n      // mode requestâ€™s mode.\n      mode: request.mode,\n      // credentials mode requestâ€™s credentials mode.\n      credentials: request.credentials,\n      // cache mode requestâ€™s cache mode.\n      cache: request.cache,\n      // redirect mode requestâ€™s redirect mode.\n      redirect: request.redirect,\n      // integrity metadata requestâ€™s integrity metadata.\n      integrity: request.integrity,\n      // keepalive requestâ€™s keepalive.\n      keepalive: request.keepalive,\n      // reload-navigation flag requestâ€™s reload-navigation flag.\n      reloadNavigation: request.reloadNavigation,\n      // history-navigation flag requestâ€™s history-navigation flag.\n      historyNavigation: request.historyNavigation,\n      // URL list A clone of requestâ€™s URL list.\n      urlList: [...request.urlList]\n    })\n\n    const initHasKey = Object.keys(init).length !== 0\n\n    // 13. If init is not empty, then:\n    if (initHasKey) {\n      // 1. If requestâ€™s mode is \"navigate\", then set it to \"same-origin\".\n      if (request.mode === 'navigate') {\n        request.mode = 'same-origin'\n      }\n\n      // 2. Unset requestâ€™s reload-navigation flag.\n      request.reloadNavigation = false\n\n      // 3. Unset requestâ€™s history-navigation flag.\n      request.historyNavigation = false\n\n      // 4. Set requestâ€™s origin to \"client\".\n      request.origin = 'client'\n\n      // 5. Set requestâ€™s referrer to \"client\"\n      request.referrer = 'client'\n\n      // 6. Set requestâ€™s referrer policy to the empty string.\n      request.referrerPolicy = ''\n\n      // 7. Set requestâ€™s URL to requestâ€™s current URL.\n      request.url = request.urlList[request.urlList.length - 1]\n\n      // 8. Set requestâ€™s URL list to Â« requestâ€™s URL Â».\n      request.urlList = [request.url]\n    }\n\n    // 14. If init[\"referrer\"] exists, then:\n    if (init.referrer !== undefined) {\n      // 1. Let referrer be init[\"referrer\"].\n      const referrer = init.referrer\n\n      // 2. If referrer is the empty string, then set requestâ€™s referrer to \"no-referrer\".\n      if (referrer === '') {\n        request.referrer = 'no-referrer'\n      } else {\n        // 1. Let parsedReferrer be the result of parsing referrer with\n        // baseURL.\n        // 2. If parsedReferrer is failure, then throw a TypeError.\n        let parsedReferrer\n        try {\n          parsedReferrer = new URL(referrer, baseUrl)\n        } catch (err) {\n          throw new TypeError(`Referrer \"${referrer}\" is not a valid URL.`, { cause: err })\n        }\n\n        // 3. If one of the following is true\n        // - parsedReferrerâ€™s scheme is \"about\" and path is the string \"client\"\n        // - parsedReferrerâ€™s origin is not same origin with origin\n        // then set requestâ€™s referrer to \"client\".\n        if (\n          (parsedReferrer.protocol === 'about:' && parsedReferrer.hostname === 'client') ||\n          (origin && !sameOrigin(parsedReferrer, this[kRealm].settingsObject.baseUrl))\n        ) {\n          request.referrer = 'client'\n        } else {\n          // 4. Otherwise, set requestâ€™s referrer to parsedReferrer.\n          request.referrer = parsedReferrer\n        }\n      }\n    }\n\n    // 15. If init[\"referrerPolicy\"] exists, then set requestâ€™s referrer policy\n    // to it.\n    if (init.referrerPolicy !== undefined) {\n      request.referrerPolicy = init.referrerPolicy\n    }\n\n    // 16. Let mode be init[\"mode\"] if it exists, and fallbackMode otherwise.\n    let mode\n    if (init.mode !== undefined) {\n      mode = init.mode\n    } else {\n      mode = fallbackMode\n    }\n\n    // 17. If mode is \"navigate\", then throw a TypeError.\n    if (mode === 'navigate') {\n      throw webidl.errors.exception({\n        header: 'Request constructor',\n        message: 'invalid request mode navigate.'\n      })\n    }\n\n    // 18. If mode is non-null, set requestâ€™s mode to mode.\n    if (mode != null) {\n      request.mode = mode\n    }\n\n    // 19. If init[\"credentials\"] exists, then set requestâ€™s credentials mode\n    // to it.\n    if (init.credentials !== undefined) {\n      request.credentials = init.credentials\n    }\n\n    // 18. If init[\"cache\"] exists, then set requestâ€™s cache mode to it.\n    if (init.cache !== undefined) {\n      request.cache = init.cache\n    }\n\n    // 21. If requestâ€™s cache mode is \"only-if-cached\" and requestâ€™s mode is\n    // not \"same-origin\", then throw a TypeError.\n    if (request.cache === 'only-if-cached' && request.mode !== 'same-origin') {\n      throw new TypeError(\n        \"'only-if-cached' can be set only with 'same-origin' mode\"\n      )\n    }\n\n    // 22. If init[\"redirect\"] exists, then set requestâ€™s redirect mode to it.\n    if (init.redirect !== undefined) {\n      request.redirect = init.redirect\n    }\n\n    // 23. If init[\"integrity\"] exists, then set requestâ€™s integrity metadata to it.\n    if (init.integrity != null) {\n      request.integrity = String(init.integrity)\n    }\n\n    // 24. If init[\"keepalive\"] exists, then set requestâ€™s keepalive to it.\n    if (init.keepalive !== undefined) {\n      request.keepalive = Boolean(init.keepalive)\n    }\n\n    // 25. If init[\"method\"] exists, then:\n    if (init.method !== undefined) {\n      // 1. Let method be init[\"method\"].\n      let method = init.method\n\n      // 2. If method is not a method or method is a forbidden method, then\n      // throw a TypeError.\n      if (!isValidHTTPToken(method)) {\n        throw new TypeError(`'${method}' is not a valid HTTP method.`)\n      }\n\n      if (forbiddenMethodsSet.has(method.toUpperCase())) {\n        throw new TypeError(`'${method}' HTTP method is unsupported.`)\n      }\n\n      // 3. Normalize method.\n      method = normalizeMethodRecord[method] ?? normalizeMethod(method)\n\n      // 4. Set requestâ€™s method to method.\n      request.method = method\n    }\n\n    // 26. If init[\"signal\"] exists, then set signal to it.\n    if (init.signal !== undefined) {\n      signal = init.signal\n    }\n\n    // 27. Set thisâ€™s request to request.\n    this[kState] = request\n\n    // 28. Set thisâ€™s signal to a new AbortSignal object with thisâ€™s relevant\n    // Realm.\n    // TODO: could this be simplified with AbortSignal.any\n    // (https://dom.spec.whatwg.org/#dom-abortsignal-any)\n    const ac = new AbortController()\n    this[kSignal] = ac.signal\n    this[kSignal][kRealm] = this[kRealm]\n\n    // 29. If signal is not null, then make thisâ€™s signal follow signal.\n    if (signal != null) {\n      if (\n        !signal ||\n        typeof signal.aborted !== 'boolean' ||\n        typeof signal.addEventListener !== 'function'\n      ) {\n        throw new TypeError(\n          \"Failed to construct 'Request': member signal is not of type AbortSignal.\"\n        )\n      }\n\n      if (signal.aborted) {\n        ac.abort(signal.reason)\n      } else {\n        // Keep a strong ref to ac while request object\n        // is alive. This is needed to prevent AbortController\n        // from being prematurely garbage collected.\n        // See, https://github.com/nodejs/undici/issues/1926.\n        this[kAbortController] = ac\n\n        const acRef = new WeakRef(ac)\n        const abort = function () {\n          const ac = acRef.deref()\n          if (ac !== undefined) {\n            ac.abort(this.reason)\n          }\n        }\n\n        // Third-party AbortControllers may not work with these.\n        // See, https://github.com/nodejs/undici/pull/1910#issuecomment-1464495619.\n        try {\n          // If the max amount of listeners is equal to the default, increase it\n          // This is only available in node >= v19.9.0\n          if (typeof getMaxListeners === 'function' && getMaxListeners(signal) === defaultMaxListeners) {\n            setMaxListeners(100, signal)\n          } else if (getEventListeners(signal, 'abort').length >= defaultMaxListeners) {\n            setMaxListeners(100, signal)\n          }\n        } catch {}\n\n        util.addAbortListener(signal, abort)\n        requestFinalizer.register(ac, { signal, abort })\n      }\n    }\n\n    // 30. Set thisâ€™s headers to a new Headers object with thisâ€™s relevant\n    // Realm, whose header list is requestâ€™s header list and guard is\n    // \"request\".\n    this[kHeaders] = new Headers(kConstruct)\n    this[kHeaders][kHeadersList] = request.headersList\n    this[kHeaders][kGuard] = 'request'\n    this[kHeaders][kRealm] = this[kRealm]\n\n    // 31. If thisâ€™s requestâ€™s mode is \"no-cors\", then:\n    if (mode === 'no-cors') {\n      // 1. If thisâ€™s requestâ€™s method is not a CORS-safelisted method,\n      // then throw a TypeError.\n      if (!corsSafeListedMethodsSet.has(request.method)) {\n        throw new TypeError(\n          `'${request.method} is unsupported in no-cors mode.`\n        )\n      }\n\n      // 2. Set thisâ€™s headersâ€™s guard to \"request-no-cors\".\n      this[kHeaders][kGuard] = 'request-no-cors'\n    }\n\n    // 32. If init is not empty, then:\n    if (initHasKey) {\n      /** @type {HeadersList} */\n      const headersList = this[kHeaders][kHeadersList]\n      // 1. Let headers be a copy of thisâ€™s headers and its associated header\n      // list.\n      // 2. If init[\"headers\"] exists, then set headers to init[\"headers\"].\n      const headers = init.headers !== undefined ? init.headers : new HeadersList(headersList)\n\n      // 3. Empty thisâ€™s headersâ€™s header list.\n      headersList.clear()\n\n      // 4. If headers is a Headers object, then for each header in its header\n      // list, append headerâ€™s name/headerâ€™s value to thisâ€™s headers.\n      if (headers instanceof HeadersList) {\n        for (const [key, val] of headers) {\n          headersList.append(key, val)\n        }\n        // Note: Copy the `set-cookie` meta-data.\n        headersList.cookies = headers.cookies\n      } else {\n        // 5. Otherwise, fill thisâ€™s headers with headers.\n        fillHeaders(this[kHeaders], headers)\n      }\n    }\n\n    // 33. Let inputBody be inputâ€™s requestâ€™s body if input is a Request\n    // object; otherwise null.\n    const inputBody = input instanceof Request ? input[kState].body : null\n\n    // 34. If either init[\"body\"] exists and is non-null or inputBody is\n    // non-null, and requestâ€™s method is `GET` or `HEAD`, then throw a\n    // TypeError.\n    if (\n      (init.body != null || inputBody != null) &&\n      (request.method === 'GET' || request.method === 'HEAD')\n    ) {\n      throw new TypeError('Request with GET/HEAD method cannot have body.')\n    }\n\n    // 35. Let initBody be null.\n    let initBody = null\n\n    // 36. If init[\"body\"] exists and is non-null, then:\n    if (init.body != null) {\n      // 1. Let Content-Type be null.\n      // 2. Set initBody and Content-Type to the result of extracting\n      // init[\"body\"], with keepalive set to requestâ€™s keepalive.\n      const [extractedBody, contentType] = extractBody(\n        init.body,\n        request.keepalive\n      )\n      initBody = extractedBody\n\n      // 3, If Content-Type is non-null and thisâ€™s headersâ€™s header list does\n      // not contain `Content-Type`, then append `Content-Type`/Content-Type to\n      // thisâ€™s headers.\n      if (contentType && !this[kHeaders][kHeadersList].contains('content-type')) {\n        this[kHeaders].append('content-type', contentType)\n      }\n    }\n\n    // 37. Let inputOrInitBody be initBody if it is non-null; otherwise\n    // inputBody.\n    const inputOrInitBody = initBody ?? inputBody\n\n    // 38. If inputOrInitBody is non-null and inputOrInitBodyâ€™s source is\n    // null, then:\n    if (inputOrInitBody != null && inputOrInitBody.source == null) {\n      // 1. If initBody is non-null and init[\"duplex\"] does not exist,\n      //    then throw a TypeError.\n      if (initBody != null && init.duplex == null) {\n        throw new TypeError('RequestInit: duplex option is required when sending a body.')\n      }\n\n      // 2. If thisâ€™s requestâ€™s mode is neither \"same-origin\" nor \"cors\",\n      // then throw a TypeError.\n      if (request.mode !== 'same-origin' && request.mode !== 'cors') {\n        throw new TypeError(\n          'If request is made from ReadableStream, mode should be \"same-origin\" or \"cors\"'\n        )\n      }\n\n      // 3. Set thisâ€™s requestâ€™s use-CORS-preflight flag.\n      request.useCORSPreflightFlag = true\n    }\n\n    // 39. Let finalBody be inputOrInitBody.\n    let finalBody = inputOrInitBody\n\n    // 40. If initBody is null and inputBody is non-null, then:\n    if (initBody == null && inputBody != null) {\n      // 1. If input is unusable, then throw a TypeError.\n      if (util.isDisturbed(inputBody.stream) || inputBody.stream.locked) {\n        throw new TypeError(\n          'Cannot construct a Request with a Request object that has already been used.'\n        )\n      }\n\n      // 2. Set finalBody to the result of creating a proxy for inputBody.\n      if (!TransformStream) {\n        TransformStream = require('stream/web').TransformStream\n      }\n\n      // https://streams.spec.whatwg.org/#readablestream-create-a-proxy\n      const identityTransform = new TransformStream()\n      inputBody.stream.pipeThrough(identityTransform)\n      finalBody = {\n        source: inputBody.source,\n        length: inputBody.length,\n        stream: identityTransform.readable\n      }\n    }\n\n    // 41. Set thisâ€™s requestâ€™s body to finalBody.\n    this[kState].body = finalBody\n  }\n\n  // Returns requestâ€™s HTTP method, which is \"GET\" by default.\n  get method () {\n    webidl.brandCheck(this, Request)\n\n    // The method getter steps are to return thisâ€™s requestâ€™s method.\n    return this[kState].method\n  }\n\n  // Returns the URL of request as a string.\n  get url () {\n    webidl.brandCheck(this, Request)\n\n    // The url getter steps are to return thisâ€™s requestâ€™s URL, serialized.\n    return URLSerializer(this[kState].url)\n  }\n\n  // Returns a Headers object consisting of the headers associated with request.\n  // Note that headers added in the network layer by the user agent will not\n  // be accounted for in this object, e.g., the \"Host\" header.\n  get headers () {\n    webidl.brandCheck(this, Request)\n\n    // The headers getter steps are to return thisâ€™s headers.\n    return this[kHeaders]\n  }\n\n  // Returns the kind of resource requested by request, e.g., \"document\"\n  // or \"script\".\n  get destination () {\n    webidl.brandCheck(this, Request)\n\n    // The destination getter are to return thisâ€™s requestâ€™s destination.\n    return this[kState].destination\n  }\n\n  // Returns the referrer of request. Its value can be a same-origin URL if\n  // explicitly set in init, the empty string to indicate no referrer, and\n  // \"about:client\" when defaulting to the globalâ€™s default. This is used\n  // during fetching to determine the value of the `Referer` header of the\n  // request being made.\n  get referrer () {\n    webidl.brandCheck(this, Request)\n\n    // 1. If thisâ€™s requestâ€™s referrer is \"no-referrer\", then return the\n    // empty string.\n    if (this[kState].referrer === 'no-referrer') {\n      return ''\n    }\n\n    // 2. If thisâ€™s requestâ€™s referrer is \"client\", then return\n    // \"about:client\".\n    if (this[kState].referrer === 'client') {\n      return 'about:client'\n    }\n\n    // Return thisâ€™s requestâ€™s referrer, serialized.\n    return this[kState].referrer.toString()\n  }\n\n  // Returns the referrer policy associated with request.\n  // This is used during fetching to compute the value of the requestâ€™s\n  // referrer.\n  get referrerPolicy () {\n    webidl.brandCheck(this, Request)\n\n    // The referrerPolicy getter steps are to return thisâ€™s requestâ€™s referrer policy.\n    return this[kState].referrerPolicy\n  }\n\n  // Returns the mode associated with request, which is a string indicating\n  // whether the request will use CORS, or will be restricted to same-origin\n  // URLs.\n  get mode () {\n    webidl.brandCheck(this, Request)\n\n    // The mode getter steps are to return thisâ€™s requestâ€™s mode.\n    return this[kState].mode\n  }\n\n  // Returns the credentials mode associated with request,\n  // which is a string indicating whether credentials will be sent with the\n  // request always, never, or only when sent to a same-origin URL.\n  get credentials () {\n    // The credentials getter steps are to return thisâ€™s requestâ€™s credentials mode.\n    return this[kState].credentials\n  }\n\n  // Returns the cache mode associated with request,\n  // which is a string indicating how the request will\n  // interact with the browserâ€™s cache when fetching.\n  get cache () {\n    webidl.brandCheck(this, Request)\n\n    // The cache getter steps are to return thisâ€™s requestâ€™s cache mode.\n    return this[kState].cache\n  }\n\n  // Returns the redirect mode associated with request,\n  // which is a string indicating how redirects for the\n  // request will be handled during fetching. A request\n  // will follow redirects by default.\n  get redirect () {\n    webidl.brandCheck(this, Request)\n\n    // The redirect getter steps are to return thisâ€™s requestâ€™s redirect mode.\n    return this[kState].redirect\n  }\n\n  // Returns requestâ€™s subresource integrity metadata, which is a\n  // cryptographic hash of the resource being fetched. Its value\n  // consists of multiple hashes separated by whitespace. [SRI]\n  get integrity () {\n    webidl.brandCheck(this, Request)\n\n    // The integrity getter steps are to return thisâ€™s requestâ€™s integrity\n    // metadata.\n    return this[kState].integrity\n  }\n\n  // Returns a boolean indicating whether or not request can outlive the\n  // global in which it was created.\n  get keepalive () {\n    webidl.brandCheck(this, Request)\n\n    // The keepalive getter steps are to return thisâ€™s requestâ€™s keepalive.\n    return this[kState].keepalive\n  }\n\n  // Returns a boolean indicating whether or not request is for a reload\n  // navigation.\n  get isReloadNavigation () {\n    webidl.brandCheck(this, Request)\n\n    // The isReloadNavigation getter steps are to return true if thisâ€™s\n    // requestâ€™s reload-navigation flag is set; otherwise false.\n    return this[kState].reloadNavigation\n  }\n\n  // Returns a boolean indicating whether or not request is for a history\n  // navigation (a.k.a. back-foward navigation).\n  get isHistoryNavigation () {\n    webidl.brandCheck(this, Request)\n\n    // The isHistoryNavigation getter steps are to return true if thisâ€™s requestâ€™s\n    // history-navigation flag is set; otherwise false.\n    return this[kState].historyNavigation\n  }\n\n  // Returns the signal associated with request, which is an AbortSignal\n  // object indicating whether or not request has been aborted, and its\n  // abort event handler.\n  get signal () {\n    webidl.brandCheck(this, Request)\n\n    // The signal getter steps are to return thisâ€™s signal.\n    return this[kSignal]\n  }\n\n  get body () {\n    webidl.brandCheck(this, Request)\n\n    return this[kState].body ? this[kState].body.stream : null\n  }\n\n  get bodyUsed () {\n    webidl.brandCheck(this, Request)\n\n    return !!this[kState].body && util.isDisturbed(this[kState].body.stream)\n  }\n\n  get duplex () {\n    webidl.brandCheck(this, Request)\n\n    return 'half'\n  }\n\n  // Returns a clone of request.\n  clone () {\n    webidl.brandCheck(this, Request)\n\n    // 1. If this is unusable, then throw a TypeError.\n    if (this.bodyUsed || this.body?.locked) {\n      throw new TypeError('unusable')\n    }\n\n    // 2. Let clonedRequest be the result of cloning thisâ€™s request.\n    const clonedRequest = cloneRequest(this[kState])\n\n    // 3. Let clonedRequestObject be the result of creating a Request object,\n    // given clonedRequest, thisâ€™s headersâ€™s guard, and thisâ€™s relevant Realm.\n    const clonedRequestObject = new Request(kConstruct)\n    clonedRequestObject[kState] = clonedRequest\n    clonedRequestObject[kRealm] = this[kRealm]\n    clonedRequestObject[kHeaders] = new Headers(kConstruct)\n    clonedRequestObject[kHeaders][kHeadersList] = clonedRequest.headersList\n    clonedRequestObject[kHeaders][kGuard] = this[kHeaders][kGuard]\n    clonedRequestObject[kHeaders][kRealm] = this[kHeaders][kRealm]\n\n    // 4. Make clonedRequestObjectâ€™s signal follow thisâ€™s signal.\n    const ac = new AbortController()\n    if (this.signal.aborted) {\n      ac.abort(this.signal.reason)\n    } else {\n      util.addAbortListener(\n        this.signal,\n        () => {\n          ac.abort(this.signal.reason)\n        }\n      )\n    }\n    clonedRequestObject[kSignal] = ac.signal\n\n    // 4. Return clonedRequestObject.\n    return clonedRequestObject\n  }\n}\n\nmixinBody(Request)\n\nfunction makeRequest (init) {\n  // https://fetch.spec.whatwg.org/#requests\n  const request = {\n    method: 'GET',\n    localURLsOnly: false,\n    unsafeRequest: false,\n    body: null,\n    client: null,\n    reservedClient: null,\n    replacesClientId: '',\n    window: 'client',\n    keepalive: false,\n    serviceWorkers: 'all',\n    initiator: '',\n    destination: '',\n    priority: null,\n    origin: 'client',\n    policyContainer: 'client',\n    referrer: 'client',\n    referrerPolicy: '',\n    mode: 'no-cors',\n    useCORSPreflightFlag: false,\n    credentials: 'same-origin',\n    useCredentials: false,\n    cache: 'default',\n    redirect: 'follow',\n    integrity: '',\n    cryptoGraphicsNonceMetadata: '',\n    parserMetadata: '',\n    reloadNavigation: false,\n    historyNavigation: false,\n    userActivation: false,\n    taintedOrigin: false,\n    redirectCount: 0,\n    responseTainting: 'basic',\n    preventNoCacheCacheControlHeaderModification: false,\n    done: false,\n    timingAllowFailed: false,\n    ...init,\n    headersList: init.headersList\n      ? new HeadersList(init.headersList)\n      : new HeadersList()\n  }\n  request.url = request.urlList[0]\n  return request\n}\n\n// https://fetch.spec.whatwg.org/#concept-request-clone\nfunction cloneRequest (request) {\n  // To clone a request request, run these steps:\n\n  // 1. Let newRequest be a copy of request, except for its body.\n  const newRequest = makeRequest({ ...request, body: null })\n\n  // 2. If requestâ€™s body is non-null, set newRequestâ€™s body to the\n  // result of cloning requestâ€™s body.\n  if (request.body != null) {\n    newRequest.body = cloneBody(request.body)\n  }\n\n  // 3. Return newRequest.\n  return newRequest\n}\n\nObject.defineProperties(Request.prototype, {\n  method: kEnumerableProperty,\n  url: kEnumerableProperty,\n  headers: kEnumerableProperty,\n  redirect: kEnumerableProperty,\n  clone: kEnumerableProperty,\n  signal: kEnumerableProperty,\n  duplex: kEnumerableProperty,\n  destination: kEnumerableProperty,\n  body: kEnumerableProperty,\n  bodyUsed: kEnumerableProperty,\n  isHistoryNavigation: kEnumerableProperty,\n  isReloadNavigation: kEnumerableProperty,\n  keepalive: kEnumerableProperty,\n  integrity: kEnumerableProperty,\n  cache: kEnumerableProperty,\n  credentials: kEnumerableProperty,\n  attribute: kEnumerableProperty,\n  referrerPolicy: kEnumerableProperty,\n  referrer: kEnumerableProperty,\n  mode: kEnumerableProperty,\n  [Symbol.toStringTag]: {\n    value: 'Request',\n    configurable: true\n  }\n})\n\nwebidl.converters.Request = webidl.interfaceConverter(\n  Request\n)\n\n// https://fetch.spec.whatwg.org/#requestinfo\nwebidl.converters.RequestInfo = function (V) {\n  if (typeof V === 'string') {\n    return webidl.converters.USVString(V)\n  }\n\n  if (V instanceof Request) {\n    return webidl.converters.Request(V)\n  }\n\n  return webidl.converters.USVString(V)\n}\n\nwebidl.converters.AbortSignal = webidl.interfaceConverter(\n  AbortSignal\n)\n\n// https://fetch.spec.whatwg.org/#requestinit\nwebidl.converters.RequestInit = webidl.dictionaryConverter([\n  {\n    key: 'method',\n    converter: webidl.converters.ByteString\n  },\n  {\n    key: 'headers',\n    converter: webidl.converters.HeadersInit\n  },\n  {\n    key: 'body',\n    converter: webidl.nullableConverter(\n      webidl.converters.BodyInit\n    )\n  },\n  {\n    key: 'referrer',\n    converter: webidl.converters.USVString\n  },\n  {\n    key: 'referrerPolicy',\n    converter: webidl.converters.DOMString,\n    // https://w3c.github.io/webappsec-referrer-policy/#referrer-policy\n    allowedValues: referrerPolicy\n  },\n  {\n    key: 'mode',\n    converter: webidl.converters.DOMString,\n    // https://fetch.spec.whatwg.org/#concept-request-mode\n    allowedValues: requestMode\n  },\n  {\n    key: 'credentials',\n    converter: webidl.converters.DOMString,\n    // https://fetch.spec.whatwg.org/#requestcredentials\n    allowedValues: requestCredentials\n  },\n  {\n    key: 'cache',\n    converter: webidl.converters.DOMString,\n    // https://fetch.spec.whatwg.org/#requestcache\n    allowedValues: requestCache\n  },\n  {\n    key: 'redirect',\n    converter: webidl.converters.DOMString,\n    // https://fetch.spec.whatwg.org/#requestredirect\n    allowedValues: requestRedirect\n  },\n  {\n    key: 'integrity',\n    converter: webidl.converters.DOMString\n  },\n  {\n    key: 'keepalive',\n    converter: webidl.converters.boolean\n  },\n  {\n    key: 'signal',\n    converter: webidl.nullableConverter(\n      (signal) => webidl.converters.AbortSignal(\n        signal,\n        { strict: false }\n      )\n    )\n  },\n  {\n    key: 'window',\n    converter: webidl.converters.any\n  },\n  {\n    key: 'duplex',\n    converter: webidl.converters.DOMString,\n    allowedValues: requestDuplex\n  }\n])\n\nmodule.exports = { Request, makeRequest }\n","// https://github.com/Ethan-Arrowood/undici-fetch\n\n'use strict'\n\nconst {\n  Response,\n  makeNetworkError,\n  makeAppropriateNetworkError,\n  filterResponse,\n  makeResponse\n} = require('./response')\nconst { Headers } = require('./headers')\nconst { Request, makeRequest } = require('./request')\nconst zlib = require('zlib')\nconst {\n  bytesMatch,\n  makePolicyContainer,\n  clonePolicyContainer,\n  requestBadPort,\n  TAOCheck,\n  appendRequestOriginHeader,\n  responseLocationURL,\n  requestCurrentURL,\n  setRequestReferrerPolicyOnRedirect,\n  tryUpgradeRequestToAPotentiallyTrustworthyURL,\n  createOpaqueTimingInfo,\n  appendFetchMetadata,\n  corsCheck,\n  crossOriginResourcePolicyCheck,\n  determineRequestsReferrer,\n  coarsenedSharedCurrentTime,\n  createDeferredPromise,\n  isBlobLike,\n  sameOrigin,\n  isCancelled,\n  isAborted,\n  isErrorLike,\n  fullyReadBody,\n  readableStreamClose,\n  isomorphicEncode,\n  urlIsLocal,\n  urlIsHttpHttpsScheme,\n  urlHasHttpsScheme\n} = require('./util')\nconst { kState, kHeaders, kGuard, kRealm } = require('./symbols')\nconst assert = require('assert')\nconst { safelyExtractBody } = require('./body')\nconst {\n  redirectStatusSet,\n  nullBodyStatus,\n  safeMethodsSet,\n  requestBodyHeader,\n  subresourceSet,\n  DOMException\n} = require('./constants')\nconst { kHeadersList } = require('../core/symbols')\nconst EE = require('events')\nconst { Readable, pipeline } = require('stream')\nconst { addAbortListener, isErrored, isReadable, nodeMajor, nodeMinor } = require('../core/util')\nconst { dataURLProcessor, serializeAMimeType } = require('./dataURL')\nconst { TransformStream } = require('stream/web')\nconst { getGlobalDispatcher } = require('../global')\nconst { webidl } = require('./webidl')\nconst { STATUS_CODES } = require('http')\nconst GET_OR_HEAD = ['GET', 'HEAD']\n\n/** @type {import('buffer').resolveObjectURL} */\nlet resolveObjectURL\nlet ReadableStream = globalThis.ReadableStream\n\nclass Fetch extends EE {\n  constructor (dispatcher) {\n    super()\n\n    this.dispatcher = dispatcher\n    this.connection = null\n    this.dump = false\n    this.state = 'ongoing'\n    // 2 terminated listeners get added per request,\n    // but only 1 gets removed. If there are 20 redirects,\n    // 21 listeners will be added.\n    // See https://github.com/nodejs/undici/issues/1711\n    // TODO (fix): Find and fix root cause for leaked listener.\n    this.setMaxListeners(21)\n  }\n\n  terminate (reason) {\n    if (this.state !== 'ongoing') {\n      return\n    }\n\n    this.state = 'terminated'\n    this.connection?.destroy(reason)\n    this.emit('terminated', reason)\n  }\n\n  // https://fetch.spec.whatwg.org/#fetch-controller-abort\n  abort (error) {\n    if (this.state !== 'ongoing') {\n      return\n    }\n\n    // 1. Set controllerâ€™s state to \"aborted\".\n    this.state = 'aborted'\n\n    // 2. Let fallbackError be an \"AbortError\" DOMException.\n    // 3. Set error to fallbackError if it is not given.\n    if (!error) {\n      error = new DOMException('The operation was aborted.', 'AbortError')\n    }\n\n    // 4. Let serializedError be StructuredSerialize(error).\n    //    If that threw an exception, catch it, and let\n    //    serializedError be StructuredSerialize(fallbackError).\n\n    // 5. Set controllerâ€™s serialized abort reason to serializedError.\n    this.serializedAbortReason = error\n\n    this.connection?.destroy(error)\n    this.emit('terminated', error)\n  }\n}\n\n// https://fetch.spec.whatwg.org/#fetch-method\nfunction fetch (input, init = {}) {\n  webidl.argumentLengthCheck(arguments, 1, { header: 'globalThis.fetch' })\n\n  // 1. Let p be a new promise.\n  const p = createDeferredPromise()\n\n  // 2. Let requestObject be the result of invoking the initial value of\n  // Request as constructor with input and init as arguments. If this throws\n  // an exception, reject p with it and return p.\n  let requestObject\n\n  try {\n    requestObject = new Request(input, init)\n  } catch (e) {\n    p.reject(e)\n    return p.promise\n  }\n\n  // 3. Let request be requestObjectâ€™s request.\n  const request = requestObject[kState]\n\n  // 4. If requestObjectâ€™s signalâ€™s aborted flag is set, then:\n  if (requestObject.signal.aborted) {\n    // 1. Abort the fetch() call with p, request, null, and\n    //    requestObjectâ€™s signalâ€™s abort reason.\n    abortFetch(p, request, null, requestObject.signal.reason)\n\n    // 2. Return p.\n    return p.promise\n  }\n\n  // 5. Let globalObject be requestâ€™s clientâ€™s global object.\n  const globalObject = request.client.globalObject\n\n  // 6. If globalObject is a ServiceWorkerGlobalScope object, then set\n  // requestâ€™s service-workers mode to \"none\".\n  if (globalObject?.constructor?.name === 'ServiceWorkerGlobalScope') {\n    request.serviceWorkers = 'none'\n  }\n\n  // 7. Let responseObject be null.\n  let responseObject = null\n\n  // 8. Let relevantRealm be thisâ€™s relevant Realm.\n  const relevantRealm = null\n\n  // 9. Let locallyAborted be false.\n  let locallyAborted = false\n\n  // 10. Let controller be null.\n  let controller = null\n\n  // 11. Add the following abort steps to requestObjectâ€™s signal:\n  addAbortListener(\n    requestObject.signal,\n    () => {\n      // 1. Set locallyAborted to true.\n      locallyAborted = true\n\n      // 2. Assert: controller is non-null.\n      assert(controller != null)\n\n      // 3. Abort controller with requestObjectâ€™s signalâ€™s abort reason.\n      controller.abort(requestObject.signal.reason)\n\n      // 4. Abort the fetch() call with p, request, responseObject,\n      //    and requestObjectâ€™s signalâ€™s abort reason.\n      abortFetch(p, request, responseObject, requestObject.signal.reason)\n    }\n  )\n\n  // 12. Let handleFetchDone given response response be to finalize and\n  // report timing with response, globalObject, and \"fetch\".\n  const handleFetchDone = (response) =>\n    finalizeAndReportTiming(response, 'fetch')\n\n  // 13. Set controller to the result of calling fetch given request,\n  // with processResponseEndOfBody set to handleFetchDone, and processResponse\n  // given response being these substeps:\n\n  const processResponse = (response) => {\n    // 1. If locallyAborted is true, terminate these substeps.\n    if (locallyAborted) {\n      return Promise.resolve()\n    }\n\n    // 2. If responseâ€™s aborted flag is set, then:\n    if (response.aborted) {\n      // 1. Let deserializedError be the result of deserialize a serialized\n      //    abort reason given controllerâ€™s serialized abort reason and\n      //    relevantRealm.\n\n      // 2. Abort the fetch() call with p, request, responseObject, and\n      //    deserializedError.\n\n      abortFetch(p, request, responseObject, controller.serializedAbortReason)\n      return Promise.resolve()\n    }\n\n    // 3. If response is a network error, then reject p with a TypeError\n    // and terminate these substeps.\n    if (response.type === 'error') {\n      p.reject(\n        Object.assign(new TypeError('fetch failed'), { cause: response.error })\n      )\n      return Promise.resolve()\n    }\n\n    // 4. Set responseObject to the result of creating a Response object,\n    // given response, \"immutable\", and relevantRealm.\n    responseObject = new Response()\n    responseObject[kState] = response\n    responseObject[kRealm] = relevantRealm\n    responseObject[kHeaders][kHeadersList] = response.headersList\n    responseObject[kHeaders][kGuard] = 'immutable'\n    responseObject[kHeaders][kRealm] = relevantRealm\n\n    // 5. Resolve p with responseObject.\n    p.resolve(responseObject)\n  }\n\n  controller = fetching({\n    request,\n    processResponseEndOfBody: handleFetchDone,\n    processResponse,\n    dispatcher: init.dispatcher ?? getGlobalDispatcher() // undici\n  })\n\n  // 14. Return p.\n  return p.promise\n}\n\n// https://fetch.spec.whatwg.org/#finalize-and-report-timing\nfunction finalizeAndReportTiming (response, initiatorType = 'other') {\n  // 1. If response is an aborted network error, then return.\n  if (response.type === 'error' && response.aborted) {\n    return\n  }\n\n  // 2. If responseâ€™s URL list is null or empty, then return.\n  if (!response.urlList?.length) {\n    return\n  }\n\n  // 3. Let originalURL be responseâ€™s URL list[0].\n  const originalURL = response.urlList[0]\n\n  // 4. Let timingInfo be responseâ€™s timing info.\n  let timingInfo = response.timingInfo\n\n  // 5. Let cacheState be responseâ€™s cache state.\n  let cacheState = response.cacheState\n\n  // 6. If originalURLâ€™s scheme is not an HTTP(S) scheme, then return.\n  if (!urlIsHttpHttpsScheme(originalURL)) {\n    return\n  }\n\n  // 7. If timingInfo is null, then return.\n  if (timingInfo === null) {\n    return\n  }\n\n  // 8. If responseâ€™s timing allow passed flag is not set, then:\n  if (!response.timingAllowPassed) {\n    //  1. Set timingInfo to a the result of creating an opaque timing info for timingInfo.\n    timingInfo = createOpaqueTimingInfo({\n      startTime: timingInfo.startTime\n    })\n\n    //  2. Set cacheState to the empty string.\n    cacheState = ''\n  }\n\n  // 9. Set timingInfoâ€™s end time to the coarsened shared current time\n  // given globalâ€™s relevant settings objectâ€™s cross-origin isolated\n  // capability.\n  // TODO: given globalâ€™s relevant settings objectâ€™s cross-origin isolated\n  // capability?\n  timingInfo.endTime = coarsenedSharedCurrentTime()\n\n  // 10. Set responseâ€™s timing info to timingInfo.\n  response.timingInfo = timingInfo\n\n  // 11. Mark resource timing for timingInfo, originalURL, initiatorType,\n  // global, and cacheState.\n  markResourceTiming(\n    timingInfo,\n    originalURL,\n    initiatorType,\n    globalThis,\n    cacheState\n  )\n}\n\n// https://w3c.github.io/resource-timing/#dfn-mark-resource-timing\nfunction markResourceTiming (timingInfo, originalURL, initiatorType, globalThis, cacheState) {\n  if (nodeMajor > 18 || (nodeMajor === 18 && nodeMinor >= 2)) {\n    performance.markResourceTiming(timingInfo, originalURL.href, initiatorType, globalThis, cacheState)\n  }\n}\n\n// https://fetch.spec.whatwg.org/#abort-fetch\nfunction abortFetch (p, request, responseObject, error) {\n  // Note: AbortSignal.reason was added in node v17.2.0\n  // which would give us an undefined error to reject with.\n  // Remove this once node v16 is no longer supported.\n  if (!error) {\n    error = new DOMException('The operation was aborted.', 'AbortError')\n  }\n\n  // 1. Reject promise with error.\n  p.reject(error)\n\n  // 2. If requestâ€™s body is not null and is readable, then cancel requestâ€™s\n  // body with error.\n  if (request.body != null && isReadable(request.body?.stream)) {\n    request.body.stream.cancel(error).catch((err) => {\n      if (err.code === 'ERR_INVALID_STATE') {\n        // Node bug?\n        return\n      }\n      throw err\n    })\n  }\n\n  // 3. If responseObject is null, then return.\n  if (responseObject == null) {\n    return\n  }\n\n  // 4. Let response be responseObjectâ€™s response.\n  const response = responseObject[kState]\n\n  // 5. If responseâ€™s body is not null and is readable, then error responseâ€™s\n  // body with error.\n  if (response.body != null && isReadable(response.body?.stream)) {\n    response.body.stream.cancel(error).catch((err) => {\n      if (err.code === 'ERR_INVALID_STATE') {\n        // Node bug?\n        return\n      }\n      throw err\n    })\n  }\n}\n\n// https://fetch.spec.whatwg.org/#fetching\nfunction fetching ({\n  request,\n  processRequestBodyChunkLength,\n  processRequestEndOfBody,\n  processResponse,\n  processResponseEndOfBody,\n  processResponseConsumeBody,\n  useParallelQueue = false,\n  dispatcher // undici\n}) {\n  // 1. Let taskDestination be null.\n  let taskDestination = null\n\n  // 2. Let crossOriginIsolatedCapability be false.\n  let crossOriginIsolatedCapability = false\n\n  // 3. If requestâ€™s client is non-null, then:\n  if (request.client != null) {\n    // 1. Set taskDestination to requestâ€™s clientâ€™s global object.\n    taskDestination = request.client.globalObject\n\n    // 2. Set crossOriginIsolatedCapability to requestâ€™s clientâ€™s cross-origin\n    // isolated capability.\n    crossOriginIsolatedCapability =\n      request.client.crossOriginIsolatedCapability\n  }\n\n  // 4. If useParallelQueue is true, then set taskDestination to the result of\n  // starting a new parallel queue.\n  // TODO\n\n  // 5. Let timingInfo be a new fetch timing info whose start time and\n  // post-redirect start time are the coarsened shared current time given\n  // crossOriginIsolatedCapability.\n  const currenTime = coarsenedSharedCurrentTime(crossOriginIsolatedCapability)\n  const timingInfo = createOpaqueTimingInfo({\n    startTime: currenTime\n  })\n\n  // 6. Let fetchParams be a new fetch params whose\n  // request is request,\n  // timing info is timingInfo,\n  // process request body chunk length is processRequestBodyChunkLength,\n  // process request end-of-body is processRequestEndOfBody,\n  // process response is processResponse,\n  // process response consume body is processResponseConsumeBody,\n  // process response end-of-body is processResponseEndOfBody,\n  // task destination is taskDestination,\n  // and cross-origin isolated capability is crossOriginIsolatedCapability.\n  const fetchParams = {\n    controller: new Fetch(dispatcher),\n    request,\n    timingInfo,\n    processRequestBodyChunkLength,\n    processRequestEndOfBody,\n    processResponse,\n    processResponseConsumeBody,\n    processResponseEndOfBody,\n    taskDestination,\n    crossOriginIsolatedCapability\n  }\n\n  // 7. If requestâ€™s body is a byte sequence, then set requestâ€™s body to\n  //    requestâ€™s body as a body.\n  // NOTE: Since fetching is only called from fetch, body should already be\n  // extracted.\n  assert(!request.body || request.body.stream)\n\n  // 8. If requestâ€™s window is \"client\", then set requestâ€™s window to requestâ€™s\n  // client, if requestâ€™s clientâ€™s global object is a Window object; otherwise\n  // \"no-window\".\n  if (request.window === 'client') {\n    // TODO: What if request.client is null?\n    request.window =\n      request.client?.globalObject?.constructor?.name === 'Window'\n        ? request.client\n        : 'no-window'\n  }\n\n  // 9. If requestâ€™s origin is \"client\", then set requestâ€™s origin to requestâ€™s\n  // clientâ€™s origin.\n  if (request.origin === 'client') {\n    // TODO: What if request.client is null?\n    request.origin = request.client?.origin\n  }\n\n  // 10. If all of the following conditions are true:\n  // TODO\n\n  // 11. If requestâ€™s policy container is \"client\", then:\n  if (request.policyContainer === 'client') {\n    // 1. If requestâ€™s client is non-null, then set requestâ€™s policy\n    // container to a clone of requestâ€™s clientâ€™s policy container. [HTML]\n    if (request.client != null) {\n      request.policyContainer = clonePolicyContainer(\n        request.client.policyContainer\n      )\n    } else {\n      // 2. Otherwise, set requestâ€™s policy container to a new policy\n      // container.\n      request.policyContainer = makePolicyContainer()\n    }\n  }\n\n  // 12. If requestâ€™s header list does not contain `Accept`, then:\n  if (!request.headersList.contains('accept')) {\n    // 1. Let value be `*/*`.\n    const value = '*/*'\n\n    // 2. A user agent should set value to the first matching statement, if\n    // any, switching on requestâ€™s destination:\n    // \"document\"\n    // \"frame\"\n    // \"iframe\"\n    // `text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8`\n    // \"image\"\n    // `image/png,image/svg+xml,image/*;q=0.8,*/*;q=0.5`\n    // \"style\"\n    // `text/css,*/*;q=0.1`\n    // TODO\n\n    // 3. Append `Accept`/value to requestâ€™s header list.\n    request.headersList.append('accept', value)\n  }\n\n  // 13. If requestâ€™s header list does not contain `Accept-Language`, then\n  // user agents should append `Accept-Language`/an appropriate value to\n  // requestâ€™s header list.\n  if (!request.headersList.contains('accept-language')) {\n    request.headersList.append('accept-language', '*')\n  }\n\n  // 14. If requestâ€™s priority is null, then use requestâ€™s initiator and\n  // destination appropriately in setting requestâ€™s priority to a\n  // user-agent-defined object.\n  if (request.priority === null) {\n    // TODO\n  }\n\n  // 15. If request is a subresource request, then:\n  if (subresourceSet.has(request.destination)) {\n    // TODO\n  }\n\n  // 16. Run main fetch given fetchParams.\n  mainFetch(fetchParams)\n    .catch(err => {\n      fetchParams.controller.terminate(err)\n    })\n\n  // 17. Return fetchParam's controller\n  return fetchParams.controller\n}\n\n// https://fetch.spec.whatwg.org/#concept-main-fetch\nasync function mainFetch (fetchParams, recursive = false) {\n  // 1. Let request be fetchParamsâ€™s request.\n  const request = fetchParams.request\n\n  // 2. Let response be null.\n  let response = null\n\n  // 3. If requestâ€™s local-URLs-only flag is set and requestâ€™s current URL is\n  // not local, then set response to a network error.\n  if (request.localURLsOnly && !urlIsLocal(requestCurrentURL(request))) {\n    response = makeNetworkError('local URLs only')\n  }\n\n  // 4. Run report Content Security Policy violations for request.\n  // TODO\n\n  // 5. Upgrade request to a potentially trustworthy URL, if appropriate.\n  tryUpgradeRequestToAPotentiallyTrustworthyURL(request)\n\n  // 6. If should request be blocked due to a bad port, should fetching request\n  // be blocked as mixed content, or should request be blocked by Content\n  // Security Policy returns blocked, then set response to a network error.\n  if (requestBadPort(request) === 'blocked') {\n    response = makeNetworkError('bad port')\n  }\n  // TODO: should fetching request be blocked as mixed content?\n  // TODO: should request be blocked by Content Security Policy?\n\n  // 7. If requestâ€™s referrer policy is the empty string, then set requestâ€™s\n  // referrer policy to requestâ€™s policy containerâ€™s referrer policy.\n  if (request.referrerPolicy === '') {\n    request.referrerPolicy = request.policyContainer.referrerPolicy\n  }\n\n  // 8. If requestâ€™s referrer is not \"no-referrer\", then set requestâ€™s\n  // referrer to the result of invoking determine requestâ€™s referrer.\n  if (request.referrer !== 'no-referrer') {\n    request.referrer = determineRequestsReferrer(request)\n  }\n\n  // 9. Set requestâ€™s current URLâ€™s scheme to \"https\" if all of the following\n  // conditions are true:\n  // - requestâ€™s current URLâ€™s scheme is \"http\"\n  // - requestâ€™s current URLâ€™s host is a domain\n  // - Matching requestâ€™s current URLâ€™s host per Known HSTS Host Domain Name\n  //   Matching results in either a superdomain match with an asserted\n  //   includeSubDomains directive or a congruent match (with or without an\n  //   asserted includeSubDomains directive). [HSTS]\n  // TODO\n\n  // 10. If recursive is false, then run the remaining steps in parallel.\n  // TODO\n\n  // 11. If response is null, then set response to the result of running\n  // the steps corresponding to the first matching statement:\n  if (response === null) {\n    response = await (async () => {\n      const currentURL = requestCurrentURL(request)\n\n      if (\n        // - requestâ€™s current URLâ€™s origin is same origin with requestâ€™s origin,\n        //   and requestâ€™s response tainting is \"basic\"\n        (sameOrigin(currentURL, request.url) && request.responseTainting === 'basic') ||\n        // requestâ€™s current URLâ€™s scheme is \"data\"\n        (currentURL.protocol === 'data:') ||\n        // - requestâ€™s mode is \"navigate\" or \"websocket\"\n        (request.mode === 'navigate' || request.mode === 'websocket')\n      ) {\n        // 1. Set requestâ€™s response tainting to \"basic\".\n        request.responseTainting = 'basic'\n\n        // 2. Return the result of running scheme fetch given fetchParams.\n        return await schemeFetch(fetchParams)\n      }\n\n      // requestâ€™s mode is \"same-origin\"\n      if (request.mode === 'same-origin') {\n        // 1. Return a network error.\n        return makeNetworkError('request mode cannot be \"same-origin\"')\n      }\n\n      // requestâ€™s mode is \"no-cors\"\n      if (request.mode === 'no-cors') {\n        // 1. If requestâ€™s redirect mode is not \"follow\", then return a network\n        // error.\n        if (request.redirect !== 'follow') {\n          return makeNetworkError(\n            'redirect mode cannot be \"follow\" for \"no-cors\" request'\n          )\n        }\n\n        // 2. Set requestâ€™s response tainting to \"opaque\".\n        request.responseTainting = 'opaque'\n\n        // 3. Return the result of running scheme fetch given fetchParams.\n        return await schemeFetch(fetchParams)\n      }\n\n      // requestâ€™s current URLâ€™s scheme is not an HTTP(S) scheme\n      if (!urlIsHttpHttpsScheme(requestCurrentURL(request))) {\n        // Return a network error.\n        return makeNetworkError('URL scheme must be a HTTP(S) scheme')\n      }\n\n      // - requestâ€™s use-CORS-preflight flag is set\n      // - requestâ€™s unsafe-request flag is set and either requestâ€™s method is\n      //   not a CORS-safelisted method or CORS-unsafe request-header names with\n      //   requestâ€™s header list is not empty\n      //    1. Set requestâ€™s response tainting to \"cors\".\n      //    2. Let corsWithPreflightResponse be the result of running HTTP fetch\n      //    given fetchParams and true.\n      //    3. If corsWithPreflightResponse is a network error, then clear cache\n      //    entries using request.\n      //    4. Return corsWithPreflightResponse.\n      // TODO\n\n      // Otherwise\n      //    1. Set requestâ€™s response tainting to \"cors\".\n      request.responseTainting = 'cors'\n\n      //    2. Return the result of running HTTP fetch given fetchParams.\n      return await httpFetch(fetchParams)\n    })()\n  }\n\n  // 12. If recursive is true, then return response.\n  if (recursive) {\n    return response\n  }\n\n  // 13. If response is not a network error and response is not a filtered\n  // response, then:\n  if (response.status !== 0 && !response.internalResponse) {\n    // If requestâ€™s response tainting is \"cors\", then:\n    if (request.responseTainting === 'cors') {\n      // 1. Let headerNames be the result of extracting header list values\n      // given `Access-Control-Expose-Headers` and responseâ€™s header list.\n      // TODO\n      // 2. If requestâ€™s credentials mode is not \"include\" and headerNames\n      // contains `*`, then set responseâ€™s CORS-exposed header-name list to\n      // all unique header names in responseâ€™s header list.\n      // TODO\n      // 3. Otherwise, if headerNames is not null or failure, then set\n      // responseâ€™s CORS-exposed header-name list to headerNames.\n      // TODO\n    }\n\n    // Set response to the following filtered response with response as its\n    // internal response, depending on requestâ€™s response tainting:\n    if (request.responseTainting === 'basic') {\n      response = filterResponse(response, 'basic')\n    } else if (request.responseTainting === 'cors') {\n      response = filterResponse(response, 'cors')\n    } else if (request.responseTainting === 'opaque') {\n      response = filterResponse(response, 'opaque')\n    } else {\n      assert(false)\n    }\n  }\n\n  // 14. Let internalResponse be response, if response is a network error,\n  // and responseâ€™s internal response otherwise.\n  let internalResponse =\n    response.status === 0 ? response : response.internalResponse\n\n  // 15. If internalResponseâ€™s URL list is empty, then set it to a clone of\n  // requestâ€™s URL list.\n  if (internalResponse.urlList.length === 0) {\n    internalResponse.urlList.push(...request.urlList)\n  }\n\n  // 16. If requestâ€™s timing allow failed flag is unset, then set\n  // internalResponseâ€™s timing allow passed flag.\n  if (!request.timingAllowFailed) {\n    response.timingAllowPassed = true\n  }\n\n  // 17. If response is not a network error and any of the following returns\n  // blocked\n  // - should internalResponse to request be blocked as mixed content\n  // - should internalResponse to request be blocked by Content Security Policy\n  // - should internalResponse to request be blocked due to its MIME type\n  // - should internalResponse to request be blocked due to nosniff\n  // TODO\n\n  // 18. If responseâ€™s type is \"opaque\", internalResponseâ€™s status is 206,\n  // internalResponseâ€™s range-requested flag is set, and requestâ€™s header\n  // list does not contain `Range`, then set response and internalResponse\n  // to a network error.\n  if (\n    response.type === 'opaque' &&\n    internalResponse.status === 206 &&\n    internalResponse.rangeRequested &&\n    !request.headers.contains('range')\n  ) {\n    response = internalResponse = makeNetworkError()\n  }\n\n  // 19. If response is not a network error and either requestâ€™s method is\n  // `HEAD` or `CONNECT`, or internalResponseâ€™s status is a null body status,\n  // set internalResponseâ€™s body to null and disregard any enqueuing toward\n  // it (if any).\n  if (\n    response.status !== 0 &&\n    (request.method === 'HEAD' ||\n      request.method === 'CONNECT' ||\n      nullBodyStatus.includes(internalResponse.status))\n  ) {\n    internalResponse.body = null\n    fetchParams.controller.dump = true\n  }\n\n  // 20. If requestâ€™s integrity metadata is not the empty string, then:\n  if (request.integrity) {\n    // 1. Let processBodyError be this step: run fetch finale given fetchParams\n    // and a network error.\n    const processBodyError = (reason) =>\n      fetchFinale(fetchParams, makeNetworkError(reason))\n\n    // 2. If requestâ€™s response tainting is \"opaque\", or responseâ€™s body is null,\n    // then run processBodyError and abort these steps.\n    if (request.responseTainting === 'opaque' || response.body == null) {\n      processBodyError(response.error)\n      return\n    }\n\n    // 3. Let processBody given bytes be these steps:\n    const processBody = (bytes) => {\n      // 1. If bytes do not match requestâ€™s integrity metadata,\n      // then run processBodyError and abort these steps. [SRI]\n      if (!bytesMatch(bytes, request.integrity)) {\n        processBodyError('integrity mismatch')\n        return\n      }\n\n      // 2. Set responseâ€™s body to bytes as a body.\n      response.body = safelyExtractBody(bytes)[0]\n\n      // 3. Run fetch finale given fetchParams and response.\n      fetchFinale(fetchParams, response)\n    }\n\n    // 4. Fully read responseâ€™s body given processBody and processBodyError.\n    await fullyReadBody(response.body, processBody, processBodyError)\n  } else {\n    // 21. Otherwise, run fetch finale given fetchParams and response.\n    fetchFinale(fetchParams, response)\n  }\n}\n\n// https://fetch.spec.whatwg.org/#concept-scheme-fetch\n// given a fetch params fetchParams\nfunction schemeFetch (fetchParams) {\n  // Note: since the connection is destroyed on redirect, which sets fetchParams to a\n  // cancelled state, we do not want this condition to trigger *unless* there have been\n  // no redirects. See https://github.com/nodejs/undici/issues/1776\n  // 1. If fetchParams is canceled, then return the appropriate network error for fetchParams.\n  if (isCancelled(fetchParams) && fetchParams.request.redirectCount === 0) {\n    return Promise.resolve(makeAppropriateNetworkError(fetchParams))\n  }\n\n  // 2. Let request be fetchParamsâ€™s request.\n  const { request } = fetchParams\n\n  const { protocol: scheme } = requestCurrentURL(request)\n\n  // 3. Switch on requestâ€™s current URLâ€™s scheme and run the associated steps:\n  switch (scheme) {\n    case 'about:': {\n      // If requestâ€™s current URLâ€™s path is the string \"blank\", then return a new response\n      // whose status message is `OK`, header list is Â« (`Content-Type`, `text/html;charset=utf-8`) Â»,\n      // and body is the empty byte sequence as a body.\n\n      // Otherwise, return a network error.\n      return Promise.resolve(makeNetworkError('about scheme is not supported'))\n    }\n    case 'blob:': {\n      if (!resolveObjectURL) {\n        resolveObjectURL = require('buffer').resolveObjectURL\n      }\n\n      // 1. Let blobURLEntry be requestâ€™s current URLâ€™s blob URL entry.\n      const blobURLEntry = requestCurrentURL(request)\n\n      // https://github.com/web-platform-tests/wpt/blob/7b0ebaccc62b566a1965396e5be7bb2bc06f841f/FileAPI/url/resources/fetch-tests.js#L52-L56\n      // Buffer.resolveObjectURL does not ignore URL queries.\n      if (blobURLEntry.search.length !== 0) {\n        return Promise.resolve(makeNetworkError('NetworkError when attempting to fetch resource.'))\n      }\n\n      const blobURLEntryObject = resolveObjectURL(blobURLEntry.toString())\n\n      // 2. If requestâ€™s method is not `GET`, blobURLEntry is null, or blobURLEntryâ€™s\n      //    object is not a Blob object, then return a network error.\n      if (request.method !== 'GET' || !isBlobLike(blobURLEntryObject)) {\n        return Promise.resolve(makeNetworkError('invalid method'))\n      }\n\n      // 3. Let bodyWithType be the result of safely extracting blobURLEntryâ€™s object.\n      const bodyWithType = safelyExtractBody(blobURLEntryObject)\n\n      // 4. Let body be bodyWithTypeâ€™s body.\n      const body = bodyWithType[0]\n\n      // 5. Let length be bodyâ€™s length, serialized and isomorphic encoded.\n      const length = isomorphicEncode(`${body.length}`)\n\n      // 6. Let type be bodyWithTypeâ€™s type if it is non-null; otherwise the empty byte sequence.\n      const type = bodyWithType[1] ?? ''\n\n      // 7. Return a new response whose status message is `OK`, header list is\n      //    Â« (`Content-Length`, length), (`Content-Type`, type) Â», and body is body.\n      const response = makeResponse({\n        statusText: 'OK',\n        headersList: [\n          ['content-length', { name: 'Content-Length', value: length }],\n          ['content-type', { name: 'Content-Type', value: type }]\n        ]\n      })\n\n      response.body = body\n\n      return Promise.resolve(response)\n    }\n    case 'data:': {\n      // 1. Let dataURLStruct be the result of running the\n      //    data: URL processor on requestâ€™s current URL.\n      const currentURL = requestCurrentURL(request)\n      const dataURLStruct = dataURLProcessor(currentURL)\n\n      // 2. If dataURLStruct is failure, then return a\n      //    network error.\n      if (dataURLStruct === 'failure') {\n        return Promise.resolve(makeNetworkError('failed to fetch the data URL'))\n      }\n\n      // 3. Let mimeType be dataURLStructâ€™s MIME type, serialized.\n      const mimeType = serializeAMimeType(dataURLStruct.mimeType)\n\n      // 4. Return a response whose status message is `OK`,\n      //    header list is Â« (`Content-Type`, mimeType) Â»,\n      //    and body is dataURLStructâ€™s body as a body.\n      return Promise.resolve(makeResponse({\n        statusText: 'OK',\n        headersList: [\n          ['content-type', { name: 'Content-Type', value: mimeType }]\n        ],\n        body: safelyExtractBody(dataURLStruct.body)[0]\n      }))\n    }\n    case 'file:': {\n      // For now, unfortunate as it is, file URLs are left as an exercise for the reader.\n      // When in doubt, return a network error.\n      return Promise.resolve(makeNetworkError('not implemented... yet...'))\n    }\n    case 'http:':\n    case 'https:': {\n      // Return the result of running HTTP fetch given fetchParams.\n\n      return httpFetch(fetchParams)\n        .catch((err) => makeNetworkError(err))\n    }\n    default: {\n      return Promise.resolve(makeNetworkError('unknown scheme'))\n    }\n  }\n}\n\n// https://fetch.spec.whatwg.org/#finalize-response\nfunction finalizeResponse (fetchParams, response) {\n  // 1. Set fetchParamsâ€™s requestâ€™s done flag.\n  fetchParams.request.done = true\n\n  // 2, If fetchParamsâ€™s process response done is not null, then queue a fetch\n  // task to run fetchParamsâ€™s process response done given response, with\n  // fetchParamsâ€™s task destination.\n  if (fetchParams.processResponseDone != null) {\n    queueMicrotask(() => fetchParams.processResponseDone(response))\n  }\n}\n\n// https://fetch.spec.whatwg.org/#fetch-finale\nfunction fetchFinale (fetchParams, response) {\n  // 1. If response is a network error, then:\n  if (response.type === 'error') {\n    // 1. Set responseâ€™s URL list to Â« fetchParamsâ€™s requestâ€™s URL list[0] Â».\n    response.urlList = [fetchParams.request.urlList[0]]\n\n    // 2. Set responseâ€™s timing info to the result of creating an opaque timing\n    // info for fetchParamsâ€™s timing info.\n    response.timingInfo = createOpaqueTimingInfo({\n      startTime: fetchParams.timingInfo.startTime\n    })\n  }\n\n  // 2. Let processResponseEndOfBody be the following steps:\n  const processResponseEndOfBody = () => {\n    // 1. Set fetchParamsâ€™s requestâ€™s done flag.\n    fetchParams.request.done = true\n\n    // If fetchParamsâ€™s process response end-of-body is not null,\n    // then queue a fetch task to run fetchParamsâ€™s process response\n    // end-of-body given response with fetchParamsâ€™s task destination.\n    if (fetchParams.processResponseEndOfBody != null) {\n      queueMicrotask(() => fetchParams.processResponseEndOfBody(response))\n    }\n  }\n\n  // 3. If fetchParamsâ€™s process response is non-null, then queue a fetch task\n  // to run fetchParamsâ€™s process response given response, with fetchParamsâ€™s\n  // task destination.\n  if (fetchParams.processResponse != null) {\n    queueMicrotask(() => fetchParams.processResponse(response))\n  }\n\n  // 4. If responseâ€™s body is null, then run processResponseEndOfBody.\n  if (response.body == null) {\n    processResponseEndOfBody()\n  } else {\n  // 5. Otherwise:\n\n    // 1. Let transformStream be a new a TransformStream.\n\n    // 2. Let identityTransformAlgorithm be an algorithm which, given chunk,\n    // enqueues chunk in transformStream.\n    const identityTransformAlgorithm = (chunk, controller) => {\n      controller.enqueue(chunk)\n    }\n\n    // 3. Set up transformStream with transformAlgorithm set to identityTransformAlgorithm\n    // and flushAlgorithm set to processResponseEndOfBody.\n    const transformStream = new TransformStream({\n      start () {},\n      transform: identityTransformAlgorithm,\n      flush: processResponseEndOfBody\n    }, {\n      size () {\n        return 1\n      }\n    }, {\n      size () {\n        return 1\n      }\n    })\n\n    // 4. Set responseâ€™s body to the result of piping responseâ€™s body through transformStream.\n    response.body = { stream: response.body.stream.pipeThrough(transformStream) }\n  }\n\n  // 6. If fetchParamsâ€™s process response consume body is non-null, then:\n  if (fetchParams.processResponseConsumeBody != null) {\n    // 1. Let processBody given nullOrBytes be this step: run fetchParamsâ€™s\n    // process response consume body given response and nullOrBytes.\n    const processBody = (nullOrBytes) => fetchParams.processResponseConsumeBody(response, nullOrBytes)\n\n    // 2. Let processBodyError be this step: run fetchParamsâ€™s process\n    // response consume body given response and failure.\n    const processBodyError = (failure) => fetchParams.processResponseConsumeBody(response, failure)\n\n    // 3. If responseâ€™s body is null, then queue a fetch task to run processBody\n    // given null, with fetchParamsâ€™s task destination.\n    if (response.body == null) {\n      queueMicrotask(() => processBody(null))\n    } else {\n      // 4. Otherwise, fully read responseâ€™s body given processBody, processBodyError,\n      // and fetchParamsâ€™s task destination.\n      return fullyReadBody(response.body, processBody, processBodyError)\n    }\n    return Promise.resolve()\n  }\n}\n\n// https://fetch.spec.whatwg.org/#http-fetch\nasync function httpFetch (fetchParams) {\n  // 1. Let request be fetchParamsâ€™s request.\n  const request = fetchParams.request\n\n  // 2. Let response be null.\n  let response = null\n\n  // 3. Let actualResponse be null.\n  let actualResponse = null\n\n  // 4. Let timingInfo be fetchParamsâ€™s timing info.\n  const timingInfo = fetchParams.timingInfo\n\n  // 5. If requestâ€™s service-workers mode is \"all\", then:\n  if (request.serviceWorkers === 'all') {\n    // TODO\n  }\n\n  // 6. If response is null, then:\n  if (response === null) {\n    // 1. If makeCORSPreflight is true and one of these conditions is true:\n    // TODO\n\n    // 2. If requestâ€™s redirect mode is \"follow\", then set requestâ€™s\n    // service-workers mode to \"none\".\n    if (request.redirect === 'follow') {\n      request.serviceWorkers = 'none'\n    }\n\n    // 3. Set response and actualResponse to the result of running\n    // HTTP-network-or-cache fetch given fetchParams.\n    actualResponse = response = await httpNetworkOrCacheFetch(fetchParams)\n\n    // 4. If requestâ€™s response tainting is \"cors\" and a CORS check\n    // for request and response returns failure, then return a network error.\n    if (\n      request.responseTainting === 'cors' &&\n      corsCheck(request, response) === 'failure'\n    ) {\n      return makeNetworkError('cors failure')\n    }\n\n    // 5. If the TAO check for request and response returns failure, then set\n    // requestâ€™s timing allow failed flag.\n    if (TAOCheck(request, response) === 'failure') {\n      request.timingAllowFailed = true\n    }\n  }\n\n  // 7. If either requestâ€™s response tainting or responseâ€™s type\n  // is \"opaque\", and the cross-origin resource policy check with\n  // requestâ€™s origin, requestâ€™s client, requestâ€™s destination,\n  // and actualResponse returns blocked, then return a network error.\n  if (\n    (request.responseTainting === 'opaque' || response.type === 'opaque') &&\n    crossOriginResourcePolicyCheck(\n      request.origin,\n      request.client,\n      request.destination,\n      actualResponse\n    ) === 'blocked'\n  ) {\n    return makeNetworkError('blocked')\n  }\n\n  // 8. If actualResponseâ€™s status is a redirect status, then:\n  if (redirectStatusSet.has(actualResponse.status)) {\n    // 1. If actualResponseâ€™s status is not 303, requestâ€™s body is not null,\n    // and the connection uses HTTP/2, then user agents may, and are even\n    // encouraged to, transmit an RST_STREAM frame.\n    // See, https://github.com/whatwg/fetch/issues/1288\n    if (request.redirect !== 'manual') {\n      fetchParams.controller.connection.destroy()\n    }\n\n    // 2. Switch on requestâ€™s redirect mode:\n    if (request.redirect === 'error') {\n      // Set response to a network error.\n      response = makeNetworkError('unexpected redirect')\n    } else if (request.redirect === 'manual') {\n      // Set response to an opaque-redirect filtered response whose internal\n      // response is actualResponse.\n      // NOTE(spec): On the web this would return an `opaqueredirect` response,\n      // but that doesn't make sense server side.\n      // See https://github.com/nodejs/undici/issues/1193.\n      response = actualResponse\n    } else if (request.redirect === 'follow') {\n      // Set response to the result of running HTTP-redirect fetch given\n      // fetchParams and response.\n      response = await httpRedirectFetch(fetchParams, response)\n    } else {\n      assert(false)\n    }\n  }\n\n  // 9. Set responseâ€™s timing info to timingInfo.\n  response.timingInfo = timingInfo\n\n  // 10. Return response.\n  return response\n}\n\n// https://fetch.spec.whatwg.org/#http-redirect-fetch\nfunction httpRedirectFetch (fetchParams, response) {\n  // 1. Let request be fetchParamsâ€™s request.\n  const request = fetchParams.request\n\n  // 2. Let actualResponse be response, if response is not a filtered response,\n  // and responseâ€™s internal response otherwise.\n  const actualResponse = response.internalResponse\n    ? response.internalResponse\n    : response\n\n  // 3. Let locationURL be actualResponseâ€™s location URL given requestâ€™s current\n  // URLâ€™s fragment.\n  let locationURL\n\n  try {\n    locationURL = responseLocationURL(\n      actualResponse,\n      requestCurrentURL(request).hash\n    )\n\n    // 4. If locationURL is null, then return response.\n    if (locationURL == null) {\n      return response\n    }\n  } catch (err) {\n    // 5. If locationURL is failure, then return a network error.\n    return Promise.resolve(makeNetworkError(err))\n  }\n\n  // 6. If locationURLâ€™s scheme is not an HTTP(S) scheme, then return a network\n  // error.\n  if (!urlIsHttpHttpsScheme(locationURL)) {\n    return Promise.resolve(makeNetworkError('URL scheme must be a HTTP(S) scheme'))\n  }\n\n  // 7. If requestâ€™s redirect count is 20, then return a network error.\n  if (request.redirectCount === 20) {\n    return Promise.resolve(makeNetworkError('redirect count exceeded'))\n  }\n\n  // 8. Increase requestâ€™s redirect count by 1.\n  request.redirectCount += 1\n\n  // 9. If requestâ€™s mode is \"cors\", locationURL includes credentials, and\n  // requestâ€™s origin is not same origin with locationURLâ€™s origin, then return\n  //  a network error.\n  if (\n    request.mode === 'cors' &&\n    (locationURL.username || locationURL.password) &&\n    !sameOrigin(request, locationURL)\n  ) {\n    return Promise.resolve(makeNetworkError('cross origin not allowed for request mode \"cors\"'))\n  }\n\n  // 10. If requestâ€™s response tainting is \"cors\" and locationURL includes\n  // credentials, then return a network error.\n  if (\n    request.responseTainting === 'cors' &&\n    (locationURL.username || locationURL.password)\n  ) {\n    return Promise.resolve(makeNetworkError(\n      'URL cannot contain credentials for request mode \"cors\"'\n    ))\n  }\n\n  // 11. If actualResponseâ€™s status is not 303, requestâ€™s body is non-null,\n  // and requestâ€™s bodyâ€™s source is null, then return a network error.\n  if (\n    actualResponse.status !== 303 &&\n    request.body != null &&\n    request.body.source == null\n  ) {\n    return Promise.resolve(makeNetworkError())\n  }\n\n  // 12. If one of the following is true\n  // - actualResponseâ€™s status is 301 or 302 and requestâ€™s method is `POST`\n  // - actualResponseâ€™s status is 303 and requestâ€™s method is not `GET` or `HEAD`\n  if (\n    ([301, 302].includes(actualResponse.status) && request.method === 'POST') ||\n    (actualResponse.status === 303 &&\n      !GET_OR_HEAD.includes(request.method))\n  ) {\n    // then:\n    // 1. Set requestâ€™s method to `GET` and requestâ€™s body to null.\n    request.method = 'GET'\n    request.body = null\n\n    // 2. For each headerName of request-body-header name, delete headerName from\n    // requestâ€™s header list.\n    for (const headerName of requestBodyHeader) {\n      request.headersList.delete(headerName)\n    }\n  }\n\n  // 13. If requestâ€™s current URLâ€™s origin is not same origin with locationURLâ€™s\n  //     origin, then for each headerName of CORS non-wildcard request-header name,\n  //     delete headerName from requestâ€™s header list.\n  if (!sameOrigin(requestCurrentURL(request), locationURL)) {\n    // https://fetch.spec.whatwg.org/#cors-non-wildcard-request-header-name\n    request.headersList.delete('authorization')\n\n    // https://fetch.spec.whatwg.org/#authentication-entries\n    request.headersList.delete('proxy-authorization', true)\n\n    // \"Cookie\" and \"Host\" are forbidden request-headers, which undici doesn't implement.\n    request.headersList.delete('cookie')\n    request.headersList.delete('host')\n  }\n\n  // 14. If requestâ€™s body is non-null, then set requestâ€™s body to the first return\n  // value of safely extracting requestâ€™s bodyâ€™s source.\n  if (request.body != null) {\n    assert(request.body.source != null)\n    request.body = safelyExtractBody(request.body.source)[0]\n  }\n\n  // 15. Let timingInfo be fetchParamsâ€™s timing info.\n  const timingInfo = fetchParams.timingInfo\n\n  // 16. Set timingInfoâ€™s redirect end time and post-redirect start time to the\n  // coarsened shared current time given fetchParamsâ€™s cross-origin isolated\n  // capability.\n  timingInfo.redirectEndTime = timingInfo.postRedirectStartTime =\n    coarsenedSharedCurrentTime(fetchParams.crossOriginIsolatedCapability)\n\n  // 17. If timingInfoâ€™s redirect start time is 0, then set timingInfoâ€™s\n  //  redirect start time to timingInfoâ€™s start time.\n  if (timingInfo.redirectStartTime === 0) {\n    timingInfo.redirectStartTime = timingInfo.startTime\n  }\n\n  // 18. Append locationURL to requestâ€™s URL list.\n  request.urlList.push(locationURL)\n\n  // 19. Invoke set requestâ€™s referrer policy on redirect on request and\n  // actualResponse.\n  setRequestReferrerPolicyOnRedirect(request, actualResponse)\n\n  // 20. Return the result of running main fetch given fetchParams and true.\n  return mainFetch(fetchParams, true)\n}\n\n// https://fetch.spec.whatwg.org/#http-network-or-cache-fetch\nasync function httpNetworkOrCacheFetch (\n  fetchParams,\n  isAuthenticationFetch = false,\n  isNewConnectionFetch = false\n) {\n  // 1. Let request be fetchParamsâ€™s request.\n  const request = fetchParams.request\n\n  // 2. Let httpFetchParams be null.\n  let httpFetchParams = null\n\n  // 3. Let httpRequest be null.\n  let httpRequest = null\n\n  // 4. Let response be null.\n  let response = null\n\n  // 5. Let storedResponse be null.\n  // TODO: cache\n\n  // 6. Let httpCache be null.\n  const httpCache = null\n\n  // 7. Let the revalidatingFlag be unset.\n  const revalidatingFlag = false\n\n  // 8. Run these steps, but abort when the ongoing fetch is terminated:\n\n  //    1. If requestâ€™s window is \"no-window\" and requestâ€™s redirect mode is\n  //    \"error\", then set httpFetchParams to fetchParams and httpRequest to\n  //    request.\n  if (request.window === 'no-window' && request.redirect === 'error') {\n    httpFetchParams = fetchParams\n    httpRequest = request\n  } else {\n    // Otherwise:\n\n    // 1. Set httpRequest to a clone of request.\n    httpRequest = makeRequest(request)\n\n    // 2. Set httpFetchParams to a copy of fetchParams.\n    httpFetchParams = { ...fetchParams }\n\n    // 3. Set httpFetchParamsâ€™s request to httpRequest.\n    httpFetchParams.request = httpRequest\n  }\n\n  //    3. Let includeCredentials be true if one of\n  const includeCredentials =\n    request.credentials === 'include' ||\n    (request.credentials === 'same-origin' &&\n      request.responseTainting === 'basic')\n\n  //    4. Let contentLength be httpRequestâ€™s bodyâ€™s length, if httpRequestâ€™s\n  //    body is non-null; otherwise null.\n  const contentLength = httpRequest.body ? httpRequest.body.length : null\n\n  //    5. Let contentLengthHeaderValue be null.\n  let contentLengthHeaderValue = null\n\n  //    6. If httpRequestâ€™s body is null and httpRequestâ€™s method is `POST` or\n  //    `PUT`, then set contentLengthHeaderValue to `0`.\n  if (\n    httpRequest.body == null &&\n    ['POST', 'PUT'].includes(httpRequest.method)\n  ) {\n    contentLengthHeaderValue = '0'\n  }\n\n  //    7. If contentLength is non-null, then set contentLengthHeaderValue to\n  //    contentLength, serialized and isomorphic encoded.\n  if (contentLength != null) {\n    contentLengthHeaderValue = isomorphicEncode(`${contentLength}`)\n  }\n\n  //    8. If contentLengthHeaderValue is non-null, then append\n  //    `Content-Length`/contentLengthHeaderValue to httpRequestâ€™s header\n  //    list.\n  if (contentLengthHeaderValue != null) {\n    httpRequest.headersList.append('content-length', contentLengthHeaderValue)\n  }\n\n  //    9. If contentLengthHeaderValue is non-null, then append (`Content-Length`,\n  //    contentLengthHeaderValue) to httpRequestâ€™s header list.\n\n  //    10. If contentLength is non-null and httpRequestâ€™s keepalive is true,\n  //    then:\n  if (contentLength != null && httpRequest.keepalive) {\n    // NOTE: keepalive is a noop outside of browser context.\n  }\n\n  //    11. If httpRequestâ€™s referrer is a URL, then append\n  //    `Referer`/httpRequestâ€™s referrer, serialized and isomorphic encoded,\n  //     to httpRequestâ€™s header list.\n  if (httpRequest.referrer instanceof URL) {\n    httpRequest.headersList.append('referer', isomorphicEncode(httpRequest.referrer.href))\n  }\n\n  //    12. Append a request `Origin` header for httpRequest.\n  appendRequestOriginHeader(httpRequest)\n\n  //    13. Append the Fetch metadata headers for httpRequest. [FETCH-METADATA]\n  appendFetchMetadata(httpRequest)\n\n  //    14. If httpRequestâ€™s header list does not contain `User-Agent`, then\n  //    user agents should append `User-Agent`/default `User-Agent` value to\n  //    httpRequestâ€™s header list.\n  if (!httpRequest.headersList.contains('user-agent')) {\n    httpRequest.headersList.append('user-agent', typeof esbuildDetection === 'undefined' ? 'undici' : 'node')\n  }\n\n  //    15. If httpRequestâ€™s cache mode is \"default\" and httpRequestâ€™s header\n  //    list contains `If-Modified-Since`, `If-None-Match`,\n  //    `If-Unmodified-Since`, `If-Match`, or `If-Range`, then set\n  //    httpRequestâ€™s cache mode to \"no-store\".\n  if (\n    httpRequest.cache === 'default' &&\n    (httpRequest.headersList.contains('if-modified-since') ||\n      httpRequest.headersList.contains('if-none-match') ||\n      httpRequest.headersList.contains('if-unmodified-since') ||\n      httpRequest.headersList.contains('if-match') ||\n      httpRequest.headersList.contains('if-range'))\n  ) {\n    httpRequest.cache = 'no-store'\n  }\n\n  //    16. If httpRequestâ€™s cache mode is \"no-cache\", httpRequestâ€™s prevent\n  //    no-cache cache-control header modification flag is unset, and\n  //    httpRequestâ€™s header list does not contain `Cache-Control`, then append\n  //    `Cache-Control`/`max-age=0` to httpRequestâ€™s header list.\n  if (\n    httpRequest.cache === 'no-cache' &&\n    !httpRequest.preventNoCacheCacheControlHeaderModification &&\n    !httpRequest.headersList.contains('cache-control')\n  ) {\n    httpRequest.headersList.append('cache-control', 'max-age=0')\n  }\n\n  //    17. If httpRequestâ€™s cache mode is \"no-store\" or \"reload\", then:\n  if (httpRequest.cache === 'no-store' || httpRequest.cache === 'reload') {\n    // 1. If httpRequestâ€™s header list does not contain `Pragma`, then append\n    // `Pragma`/`no-cache` to httpRequestâ€™s header list.\n    if (!httpRequest.headersList.contains('pragma')) {\n      httpRequest.headersList.append('pragma', 'no-cache')\n    }\n\n    // 2. If httpRequestâ€™s header list does not contain `Cache-Control`,\n    // then append `Cache-Control`/`no-cache` to httpRequestâ€™s header list.\n    if (!httpRequest.headersList.contains('cache-control')) {\n      httpRequest.headersList.append('cache-control', 'no-cache')\n    }\n  }\n\n  //    18. If httpRequestâ€™s header list contains `Range`, then append\n  //    `Accept-Encoding`/`identity` to httpRequestâ€™s header list.\n  if (httpRequest.headersList.contains('range')) {\n    httpRequest.headersList.append('accept-encoding', 'identity')\n  }\n\n  //    19. Modify httpRequestâ€™s header list per HTTP. Do not append a given\n  //    header if httpRequestâ€™s header list contains that headerâ€™s name.\n  //    TODO: https://github.com/whatwg/fetch/issues/1285#issuecomment-896560129\n  if (!httpRequest.headersList.contains('accept-encoding')) {\n    if (urlHasHttpsScheme(requestCurrentURL(httpRequest))) {\n      httpRequest.headersList.append('accept-encoding', 'br, gzip, deflate')\n    } else {\n      httpRequest.headersList.append('accept-encoding', 'gzip, deflate')\n    }\n  }\n\n  httpRequest.headersList.delete('host')\n\n  //    20. If includeCredentials is true, then:\n  if (includeCredentials) {\n    // 1. If the user agent is not configured to block cookies for httpRequest\n    // (see section 7 of [COOKIES]), then:\n    // TODO: credentials\n    // 2. If httpRequestâ€™s header list does not contain `Authorization`, then:\n    // TODO: credentials\n  }\n\n  //    21. If thereâ€™s a proxy-authentication entry, use it as appropriate.\n  //    TODO: proxy-authentication\n\n  //    22. Set httpCache to the result of determining the HTTP cache\n  //    partition, given httpRequest.\n  //    TODO: cache\n\n  //    23. If httpCache is null, then set httpRequestâ€™s cache mode to\n  //    \"no-store\".\n  if (httpCache == null) {\n    httpRequest.cache = 'no-store'\n  }\n\n  //    24. If httpRequestâ€™s cache mode is neither \"no-store\" nor \"reload\",\n  //    then:\n  if (httpRequest.mode !== 'no-store' && httpRequest.mode !== 'reload') {\n    // TODO: cache\n  }\n\n  // 9. If aborted, then return the appropriate network error for fetchParams.\n  // TODO\n\n  // 10. If response is null, then:\n  if (response == null) {\n    // 1. If httpRequestâ€™s cache mode is \"only-if-cached\", then return a\n    // network error.\n    if (httpRequest.mode === 'only-if-cached') {\n      return makeNetworkError('only if cached')\n    }\n\n    // 2. Let forwardResponse be the result of running HTTP-network fetch\n    // given httpFetchParams, includeCredentials, and isNewConnectionFetch.\n    const forwardResponse = await httpNetworkFetch(\n      httpFetchParams,\n      includeCredentials,\n      isNewConnectionFetch\n    )\n\n    // 3. If httpRequestâ€™s method is unsafe and forwardResponseâ€™s status is\n    // in the range 200 to 399, inclusive, invalidate appropriate stored\n    // responses in httpCache, as per the \"Invalidation\" chapter of HTTP\n    // Caching, and set storedResponse to null. [HTTP-CACHING]\n    if (\n      !safeMethodsSet.has(httpRequest.method) &&\n      forwardResponse.status >= 200 &&\n      forwardResponse.status <= 399\n    ) {\n      // TODO: cache\n    }\n\n    // 4. If the revalidatingFlag is set and forwardResponseâ€™s status is 304,\n    // then:\n    if (revalidatingFlag && forwardResponse.status === 304) {\n      // TODO: cache\n    }\n\n    // 5. If response is null, then:\n    if (response == null) {\n      // 1. Set response to forwardResponse.\n      response = forwardResponse\n\n      // 2. Store httpRequest and forwardResponse in httpCache, as per the\n      // \"Storing Responses in Caches\" chapter of HTTP Caching. [HTTP-CACHING]\n      // TODO: cache\n    }\n  }\n\n  // 11. Set responseâ€™s URL list to a clone of httpRequestâ€™s URL list.\n  response.urlList = [...httpRequest.urlList]\n\n  // 12. If httpRequestâ€™s header list contains `Range`, then set responseâ€™s\n  // range-requested flag.\n  if (httpRequest.headersList.contains('range')) {\n    response.rangeRequested = true\n  }\n\n  // 13. Set responseâ€™s request-includes-credentials to includeCredentials.\n  response.requestIncludesCredentials = includeCredentials\n\n  // 14. If responseâ€™s status is 401, httpRequestâ€™s response tainting is not\n  // \"cors\", includeCredentials is true, and requestâ€™s window is an environment\n  // settings object, then:\n  // TODO\n\n  // 15. If responseâ€™s status is 407, then:\n  if (response.status === 407) {\n    // 1. If requestâ€™s window is \"no-window\", then return a network error.\n    if (request.window === 'no-window') {\n      return makeNetworkError()\n    }\n\n    // 2. ???\n\n    // 3. If fetchParams is canceled, then return the appropriate network error for fetchParams.\n    if (isCancelled(fetchParams)) {\n      return makeAppropriateNetworkError(fetchParams)\n    }\n\n    // 4. Prompt the end user as appropriate in requestâ€™s window and store\n    // the result as a proxy-authentication entry. [HTTP-AUTH]\n    // TODO: Invoke some kind of callback?\n\n    // 5. Set response to the result of running HTTP-network-or-cache fetch given\n    // fetchParams.\n    // TODO\n    return makeNetworkError('proxy authentication required')\n  }\n\n  // 16. If all of the following are true\n  if (\n    // responseâ€™s status is 421\n    response.status === 421 &&\n    // isNewConnectionFetch is false\n    !isNewConnectionFetch &&\n    // requestâ€™s body is null, or requestâ€™s body is non-null and requestâ€™s bodyâ€™s source is non-null\n    (request.body == null || request.body.source != null)\n  ) {\n    // then:\n\n    // 1. If fetchParams is canceled, then return the appropriate network error for fetchParams.\n    if (isCancelled(fetchParams)) {\n      return makeAppropriateNetworkError(fetchParams)\n    }\n\n    // 2. Set response to the result of running HTTP-network-or-cache\n    // fetch given fetchParams, isAuthenticationFetch, and true.\n\n    // TODO (spec): The spec doesn't specify this but we need to cancel\n    // the active response before we can start a new one.\n    // https://github.com/whatwg/fetch/issues/1293\n    fetchParams.controller.connection.destroy()\n\n    response = await httpNetworkOrCacheFetch(\n      fetchParams,\n      isAuthenticationFetch,\n      true\n    )\n  }\n\n  // 17. If isAuthenticationFetch is true, then create an authentication entry\n  if (isAuthenticationFetch) {\n    // TODO\n  }\n\n  // 18. Return response.\n  return response\n}\n\n// https://fetch.spec.whatwg.org/#http-network-fetch\nasync function httpNetworkFetch (\n  fetchParams,\n  includeCredentials = false,\n  forceNewConnection = false\n) {\n  assert(!fetchParams.controller.connection || fetchParams.controller.connection.destroyed)\n\n  fetchParams.controller.connection = {\n    abort: null,\n    destroyed: false,\n    destroy (err) {\n      if (!this.destroyed) {\n        this.destroyed = true\n        this.abort?.(err ?? new DOMException('The operation was aborted.', 'AbortError'))\n      }\n    }\n  }\n\n  // 1. Let request be fetchParamsâ€™s request.\n  const request = fetchParams.request\n\n  // 2. Let response be null.\n  let response = null\n\n  // 3. Let timingInfo be fetchParamsâ€™s timing info.\n  const timingInfo = fetchParams.timingInfo\n\n  // 4. Let httpCache be the result of determining the HTTP cache partition,\n  // given request.\n  // TODO: cache\n  const httpCache = null\n\n  // 5. If httpCache is null, then set requestâ€™s cache mode to \"no-store\".\n  if (httpCache == null) {\n    request.cache = 'no-store'\n  }\n\n  // 6. Let networkPartitionKey be the result of determining the network\n  // partition key given request.\n  // TODO\n\n  // 7. Let newConnection be \"yes\" if forceNewConnection is true; otherwise\n  // \"no\".\n  const newConnection = forceNewConnection ? 'yes' : 'no' // eslint-disable-line no-unused-vars\n\n  // 8. Switch on requestâ€™s mode:\n  if (request.mode === 'websocket') {\n    // Let connection be the result of obtaining a WebSocket connection,\n    // given requestâ€™s current URL.\n    // TODO\n  } else {\n    // Let connection be the result of obtaining a connection, given\n    // networkPartitionKey, requestâ€™s current URLâ€™s origin,\n    // includeCredentials, and forceNewConnection.\n    // TODO\n  }\n\n  // 9. Run these steps, but abort when the ongoing fetch is terminated:\n\n  //    1. If connection is failure, then return a network error.\n\n  //    2. Set timingInfoâ€™s final connection timing info to the result of\n  //    calling clamp and coarsen connection timing info with connectionâ€™s\n  //    timing info, timingInfoâ€™s post-redirect start time, and fetchParamsâ€™s\n  //    cross-origin isolated capability.\n\n  //    3. If connection is not an HTTP/2 connection, requestâ€™s body is non-null,\n  //    and requestâ€™s bodyâ€™s source is null, then append (`Transfer-Encoding`,\n  //    `chunked`) to requestâ€™s header list.\n\n  //    4. Set timingInfoâ€™s final network-request start time to the coarsened\n  //    shared current time given fetchParamsâ€™s cross-origin isolated\n  //    capability.\n\n  //    5. Set response to the result of making an HTTP request over connection\n  //    using request with the following caveats:\n\n  //        - Follow the relevant requirements from HTTP. [HTTP] [HTTP-SEMANTICS]\n  //        [HTTP-COND] [HTTP-CACHING] [HTTP-AUTH]\n\n  //        - If requestâ€™s body is non-null, and requestâ€™s bodyâ€™s source is null,\n  //        then the user agent may have a buffer of up to 64 kibibytes and store\n  //        a part of requestâ€™s body in that buffer. If the user agent reads from\n  //        requestâ€™s body beyond that bufferâ€™s size and the user agent needs to\n  //        resend request, then instead return a network error.\n\n  //        - Set timingInfoâ€™s final network-response start time to the coarsened\n  //        shared current time given fetchParamsâ€™s cross-origin isolated capability,\n  //        immediately after the user agentâ€™s HTTP parser receives the first byte\n  //        of the response (e.g., frame header bytes for HTTP/2 or response status\n  //        line for HTTP/1.x).\n\n  //        - Wait until all the headers are transmitted.\n\n  //        - Any responses whose status is in the range 100 to 199, inclusive,\n  //        and is not 101, are to be ignored, except for the purposes of setting\n  //        timingInfoâ€™s final network-response start time above.\n\n  //    - If requestâ€™s header list contains `Transfer-Encoding`/`chunked` and\n  //    response is transferred via HTTP/1.0 or older, then return a network\n  //    error.\n\n  //    - If the HTTP request results in a TLS client certificate dialog, then:\n\n  //        1. If requestâ€™s window is an environment settings object, make the\n  //        dialog available in requestâ€™s window.\n\n  //        2. Otherwise, return a network error.\n\n  // To transmit requestâ€™s body body, run these steps:\n  let requestBody = null\n  // 1. If body is null and fetchParamsâ€™s process request end-of-body is\n  // non-null, then queue a fetch task given fetchParamsâ€™s process request\n  // end-of-body and fetchParamsâ€™s task destination.\n  if (request.body == null && fetchParams.processRequestEndOfBody) {\n    queueMicrotask(() => fetchParams.processRequestEndOfBody())\n  } else if (request.body != null) {\n    // 2. Otherwise, if body is non-null:\n\n    //    1. Let processBodyChunk given bytes be these steps:\n    const processBodyChunk = async function * (bytes) {\n      // 1. If the ongoing fetch is terminated, then abort these steps.\n      if (isCancelled(fetchParams)) {\n        return\n      }\n\n      // 2. Run this step in parallel: transmit bytes.\n      yield bytes\n\n      // 3. If fetchParamsâ€™s process request body is non-null, then run\n      // fetchParamsâ€™s process request body given bytesâ€™s length.\n      fetchParams.processRequestBodyChunkLength?.(bytes.byteLength)\n    }\n\n    // 2. Let processEndOfBody be these steps:\n    const processEndOfBody = () => {\n      // 1. If fetchParams is canceled, then abort these steps.\n      if (isCancelled(fetchParams)) {\n        return\n      }\n\n      // 2. If fetchParamsâ€™s process request end-of-body is non-null,\n      // then run fetchParamsâ€™s process request end-of-body.\n      if (fetchParams.processRequestEndOfBody) {\n        fetchParams.processRequestEndOfBody()\n      }\n    }\n\n    // 3. Let processBodyError given e be these steps:\n    const processBodyError = (e) => {\n      // 1. If fetchParams is canceled, then abort these steps.\n      if (isCancelled(fetchParams)) {\n        return\n      }\n\n      // 2. If e is an \"AbortError\" DOMException, then abort fetchParamsâ€™s controller.\n      if (e.name === 'AbortError') {\n        fetchParams.controller.abort()\n      } else {\n        fetchParams.controller.terminate(e)\n      }\n    }\n\n    // 4. Incrementally read requestâ€™s body given processBodyChunk, processEndOfBody,\n    // processBodyError, and fetchParamsâ€™s task destination.\n    requestBody = (async function * () {\n      try {\n        for await (const bytes of request.body.stream) {\n          yield * processBodyChunk(bytes)\n        }\n        processEndOfBody()\n      } catch (err) {\n        processBodyError(err)\n      }\n    })()\n  }\n\n  try {\n    // socket is only provided for websockets\n    const { body, status, statusText, headersList, socket } = await dispatch({ body: requestBody })\n\n    if (socket) {\n      response = makeResponse({ status, statusText, headersList, socket })\n    } else {\n      const iterator = body[Symbol.asyncIterator]()\n      fetchParams.controller.next = () => iterator.next()\n\n      response = makeResponse({ status, statusText, headersList })\n    }\n  } catch (err) {\n    // 10. If aborted, then:\n    if (err.name === 'AbortError') {\n      // 1. If connection uses HTTP/2, then transmit an RST_STREAM frame.\n      fetchParams.controller.connection.destroy()\n\n      // 2. Return the appropriate network error for fetchParams.\n      return makeAppropriateNetworkError(fetchParams, err)\n    }\n\n    return makeNetworkError(err)\n  }\n\n  // 11. Let pullAlgorithm be an action that resumes the ongoing fetch\n  // if it is suspended.\n  const pullAlgorithm = () => {\n    fetchParams.controller.resume()\n  }\n\n  // 12. Let cancelAlgorithm be an algorithm that aborts fetchParamsâ€™s\n  // controller with reason, given reason.\n  const cancelAlgorithm = (reason) => {\n    fetchParams.controller.abort(reason)\n  }\n\n  // 13. Let highWaterMark be a non-negative, non-NaN number, chosen by\n  // the user agent.\n  // TODO\n\n  // 14. Let sizeAlgorithm be an algorithm that accepts a chunk object\n  // and returns a non-negative, non-NaN, non-infinite number, chosen by the user agent.\n  // TODO\n\n  // 15. Let stream be a new ReadableStream.\n  // 16. Set up stream with pullAlgorithm set to pullAlgorithm,\n  // cancelAlgorithm set to cancelAlgorithm, highWaterMark set to\n  // highWaterMark, and sizeAlgorithm set to sizeAlgorithm.\n  if (!ReadableStream) {\n    ReadableStream = require('stream/web').ReadableStream\n  }\n\n  const stream = new ReadableStream(\n    {\n      async start (controller) {\n        fetchParams.controller.controller = controller\n      },\n      async pull (controller) {\n        await pullAlgorithm(controller)\n      },\n      async cancel (reason) {\n        await cancelAlgorithm(reason)\n      }\n    },\n    {\n      highWaterMark: 0,\n      size () {\n        return 1\n      }\n    }\n  )\n\n  // 17. Run these steps, but abort when the ongoing fetch is terminated:\n\n  //    1. Set responseâ€™s body to a new body whose stream is stream.\n  response.body = { stream }\n\n  //    2. If response is not a network error and requestâ€™s cache mode is\n  //    not \"no-store\", then update response in httpCache for request.\n  //    TODO\n\n  //    3. If includeCredentials is true and the user agent is not configured\n  //    to block cookies for request (see section 7 of [COOKIES]), then run the\n  //    \"set-cookie-string\" parsing algorithm (see section 5.2 of [COOKIES]) on\n  //    the value of each header whose name is a byte-case-insensitive match for\n  //    `Set-Cookie` in responseâ€™s header list, if any, and requestâ€™s current URL.\n  //    TODO\n\n  // 18. If aborted, then:\n  // TODO\n\n  // 19. Run these steps in parallel:\n\n  //    1. Run these steps, but abort when fetchParams is canceled:\n  fetchParams.controller.on('terminated', onAborted)\n  fetchParams.controller.resume = async () => {\n    // 1. While true\n    while (true) {\n      // 1-3. See onData...\n\n      // 4. Set bytes to the result of handling content codings given\n      // codings and bytes.\n      let bytes\n      let isFailure\n      try {\n        const { done, value } = await fetchParams.controller.next()\n\n        if (isAborted(fetchParams)) {\n          break\n        }\n\n        bytes = done ? undefined : value\n      } catch (err) {\n        if (fetchParams.controller.ended && !timingInfo.encodedBodySize) {\n          // zlib doesn't like empty streams.\n          bytes = undefined\n        } else {\n          bytes = err\n\n          // err may be propagated from the result of calling readablestream.cancel,\n          // which might not be an error. https://github.com/nodejs/undici/issues/2009\n          isFailure = true\n        }\n      }\n\n      if (bytes === undefined) {\n        // 2. Otherwise, if the bytes transmission for responseâ€™s message\n        // body is done normally and stream is readable, then close\n        // stream, finalize response for fetchParams and response, and\n        // abort these in-parallel steps.\n        readableStreamClose(fetchParams.controller.controller)\n\n        finalizeResponse(fetchParams, response)\n\n        return\n      }\n\n      // 5. Increase timingInfoâ€™s decoded body size by bytesâ€™s length.\n      timingInfo.decodedBodySize += bytes?.byteLength ?? 0\n\n      // 6. If bytes is failure, then terminate fetchParamsâ€™s controller.\n      if (isFailure) {\n        fetchParams.controller.terminate(bytes)\n        return\n      }\n\n      // 7. Enqueue a Uint8Array wrapping an ArrayBuffer containing bytes\n      // into stream.\n      fetchParams.controller.controller.enqueue(new Uint8Array(bytes))\n\n      // 8. If stream is errored, then terminate the ongoing fetch.\n      if (isErrored(stream)) {\n        fetchParams.controller.terminate()\n        return\n      }\n\n      // 9. If stream doesnâ€™t need more data ask the user agent to suspend\n      // the ongoing fetch.\n      if (!fetchParams.controller.controller.desiredSize) {\n        return\n      }\n    }\n  }\n\n  //    2. If aborted, then:\n  function onAborted (reason) {\n    // 2. If fetchParams is aborted, then:\n    if (isAborted(fetchParams)) {\n      // 1. Set responseâ€™s aborted flag.\n      response.aborted = true\n\n      // 2. If stream is readable, then error stream with the result of\n      //    deserialize a serialized abort reason given fetchParamsâ€™s\n      //    controllerâ€™s serialized abort reason and an\n      //    implementation-defined realm.\n      if (isReadable(stream)) {\n        fetchParams.controller.controller.error(\n          fetchParams.controller.serializedAbortReason\n        )\n      }\n    } else {\n      // 3. Otherwise, if stream is readable, error stream with a TypeError.\n      if (isReadable(stream)) {\n        fetchParams.controller.controller.error(new TypeError('terminated', {\n          cause: isErrorLike(reason) ? reason : undefined\n        }))\n      }\n    }\n\n    // 4. If connection uses HTTP/2, then transmit an RST_STREAM frame.\n    // 5. Otherwise, the user agent should close connection unless it would be bad for performance to do so.\n    fetchParams.controller.connection.destroy()\n  }\n\n  // 20. Return response.\n  return response\n\n  async function dispatch ({ body }) {\n    const url = requestCurrentURL(request)\n    /** @type {import('../..').Agent} */\n    const agent = fetchParams.controller.dispatcher\n\n    return new Promise((resolve, reject) => agent.dispatch(\n      {\n        path: url.pathname + url.search,\n        origin: url.origin,\n        method: request.method,\n        body: fetchParams.controller.dispatcher.isMockActive ? request.body && (request.body.source || request.body.stream) : body,\n        headers: request.headersList.entries,\n        maxRedirections: 0,\n        upgrade: request.mode === 'websocket' ? 'websocket' : undefined\n      },\n      {\n        body: null,\n        abort: null,\n\n        onConnect (abort) {\n          // TODO (fix): Do we need connection here?\n          const { connection } = fetchParams.controller\n\n          if (connection.destroyed) {\n            abort(new DOMException('The operation was aborted.', 'AbortError'))\n          } else {\n            fetchParams.controller.on('terminated', abort)\n            this.abort = connection.abort = abort\n          }\n        },\n\n        onHeaders (status, headersList, resume, statusText) {\n          if (status < 200) {\n            return\n          }\n\n          let codings = []\n          let location = ''\n\n          const headers = new Headers()\n\n          // For H2, the headers are a plain JS object\n          // We distinguish between them and iterate accordingly\n          if (Array.isArray(headersList)) {\n            for (let n = 0; n < headersList.length; n += 2) {\n              const key = headersList[n + 0].toString('latin1')\n              const val = headersList[n + 1].toString('latin1')\n              if (key.toLowerCase() === 'content-encoding') {\n                // https://www.rfc-editor.org/rfc/rfc7231#section-3.1.2.1\n                // \"All content-coding values are case-insensitive...\"\n                codings = val.toLowerCase().split(',').map((x) => x.trim())\n              } else if (key.toLowerCase() === 'location') {\n                location = val\n              }\n\n              headers[kHeadersList].append(key, val)\n            }\n          } else {\n            const keys = Object.keys(headersList)\n            for (const key of keys) {\n              const val = headersList[key]\n              if (key.toLowerCase() === 'content-encoding') {\n                // https://www.rfc-editor.org/rfc/rfc7231#section-3.1.2.1\n                // \"All content-coding values are case-insensitive...\"\n                codings = val.toLowerCase().split(',').map((x) => x.trim()).reverse()\n              } else if (key.toLowerCase() === 'location') {\n                location = val\n              }\n\n              headers[kHeadersList].append(key, val)\n            }\n          }\n\n          this.body = new Readable({ read: resume })\n\n          const decoders = []\n\n          const willFollow = request.redirect === 'follow' &&\n            location &&\n            redirectStatusSet.has(status)\n\n          // https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Encoding\n          if (request.method !== 'HEAD' && request.method !== 'CONNECT' && !nullBodyStatus.includes(status) && !willFollow) {\n            for (const coding of codings) {\n              // https://www.rfc-editor.org/rfc/rfc9112.html#section-7.2\n              if (coding === 'x-gzip' || coding === 'gzip') {\n                decoders.push(zlib.createGunzip({\n                  // Be less strict when decoding compressed responses, since sometimes\n                  // servers send slightly invalid responses that are still accepted\n                  // by common browsers.\n                  // Always using Z_SYNC_FLUSH is what cURL does.\n                  flush: zlib.constants.Z_SYNC_FLUSH,\n                  finishFlush: zlib.constants.Z_SYNC_FLUSH\n                }))\n              } else if (coding === 'deflate') {\n                decoders.push(zlib.createInflate())\n              } else if (coding === 'br') {\n                decoders.push(zlib.createBrotliDecompress())\n              } else {\n                decoders.length = 0\n                break\n              }\n            }\n          }\n\n          resolve({\n            status,\n            statusText,\n            headersList: headers[kHeadersList],\n            body: decoders.length\n              ? pipeline(this.body, ...decoders, () => { })\n              : this.body.on('error', () => {})\n          })\n\n          return true\n        },\n\n        onData (chunk) {\n          if (fetchParams.controller.dump) {\n            return\n          }\n\n          // 1. If one or more bytes have been transmitted from responseâ€™s\n          // message body, then:\n\n          //  1. Let bytes be the transmitted bytes.\n          const bytes = chunk\n\n          //  2. Let codings be the result of extracting header list values\n          //  given `Content-Encoding` and responseâ€™s header list.\n          //  See pullAlgorithm.\n\n          //  3. Increase timingInfoâ€™s encoded body size by bytesâ€™s length.\n          timingInfo.encodedBodySize += bytes.byteLength\n\n          //  4. See pullAlgorithm...\n\n          return this.body.push(bytes)\n        },\n\n        onComplete () {\n          if (this.abort) {\n            fetchParams.controller.off('terminated', this.abort)\n          }\n\n          fetchParams.controller.ended = true\n\n          this.body.push(null)\n        },\n\n        onError (error) {\n          if (this.abort) {\n            fetchParams.controller.off('terminated', this.abort)\n          }\n\n          this.body?.destroy(error)\n\n          fetchParams.controller.terminate(error)\n\n          reject(error)\n        },\n\n        onUpgrade (status, headersList, socket) {\n          if (status !== 101) {\n            return\n          }\n\n          const headers = new Headers()\n\n          for (let n = 0; n < headersList.length; n += 2) {\n            const key = headersList[n + 0].toString('latin1')\n            const val = headersList[n + 1].toString('latin1')\n\n            headers[kHeadersList].append(key, val)\n          }\n\n          resolve({\n            status,\n            statusText: STATUS_CODES[status],\n            headersList: headers[kHeadersList],\n            socket\n          })\n\n          return true\n        }\n      }\n    ))\n  }\n}\n\nmodule.exports = {\n  fetch,\n  Fetch,\n  fetching,\n  finalizeAndReportTiming\n}\n","'use strict'\n\nmodule.exports = {\n  kState: Symbol('FileReader state'),\n  kResult: Symbol('FileReader result'),\n  kError: Symbol('FileReader error'),\n  kLastProgressEventFired: Symbol('FileReader last progress event fired timestamp'),\n  kEvents: Symbol('FileReader events'),\n  kAborted: Symbol('FileReader aborted')\n}\n","'use strict'\n\nconst { webidl } = require('../fetch/webidl')\n\nconst kState = Symbol('ProgressEvent state')\n\n/**\n * @see https://xhr.spec.whatwg.org/#progressevent\n */\nclass ProgressEvent extends Event {\n  constructor (type, eventInitDict = {}) {\n    type = webidl.converters.DOMString(type)\n    eventInitDict = webidl.converters.ProgressEventInit(eventInitDict ?? {})\n\n    super(type, eventInitDict)\n\n    this[kState] = {\n      lengthComputable: eventInitDict.lengthComputable,\n      loaded: eventInitDict.loaded,\n      total: eventInitDict.total\n    }\n  }\n\n  get lengthComputable () {\n    webidl.brandCheck(this, ProgressEvent)\n\n    return this[kState].lengthComputable\n  }\n\n  get loaded () {\n    webidl.brandCheck(this, ProgressEvent)\n\n    return this[kState].loaded\n  }\n\n  get total () {\n    webidl.brandCheck(this, ProgressEvent)\n\n    return this[kState].total\n  }\n}\n\nwebidl.converters.ProgressEventInit = webidl.dictionaryConverter([\n  {\n    key: 'lengthComputable',\n    converter: webidl.converters.boolean,\n    defaultValue: false\n  },\n  {\n    key: 'loaded',\n    converter: webidl.converters['unsigned long long'],\n    defaultValue: 0\n  },\n  {\n    key: 'total',\n    converter: webidl.converters['unsigned long long'],\n    defaultValue: 0\n  },\n  {\n    key: 'bubbles',\n    converter: webidl.converters.boolean,\n    defaultValue: false\n  },\n  {\n    key: 'cancelable',\n    converter: webidl.converters.boolean,\n    defaultValue: false\n  },\n  {\n    key: 'composed',\n    converter: webidl.converters.boolean,\n    defaultValue: false\n  }\n])\n\nmodule.exports = {\n  ProgressEvent\n}\n","'use strict'\n\n/**\n * @see https://encoding.spec.whatwg.org/#concept-encoding-get\n * @param {string|undefined} label\n */\nfunction getEncoding (label) {\n  if (!label) {\n    return 'failure'\n  }\n\n  // 1. Remove any leading and trailing ASCII whitespace from label.\n  // 2. If label is an ASCII case-insensitive match for any of the\n  //    labels listed in the table below, then return the\n  //    corresponding encoding; otherwise return failure.\n  switch (label.trim().toLowerCase()) {\n    case 'unicode-1-1-utf-8':\n    case 'unicode11utf8':\n    case 'unicode20utf8':\n    case 'utf-8':\n    case 'utf8':\n    case 'x-unicode20utf8':\n      return 'UTF-8'\n    case '866':\n    case 'cp866':\n    case 'csibm866':\n    case 'ibm866':\n      return 'IBM866'\n    case 'csisolatin2':\n    case 'iso-8859-2':\n    case 'iso-ir-101':\n    case 'iso8859-2':\n    case 'iso88592':\n    case 'iso_8859-2':\n    case 'iso_8859-2:1987':\n    case 'l2':\n    case 'latin2':\n      return 'ISO-8859-2'\n    case 'csisolatin3':\n    case 'iso-8859-3':\n    case 'iso-ir-109':\n    case 'iso8859-3':\n    case 'iso88593':\n    case 'iso_8859-3':\n    case 'iso_8859-3:1988':\n    case 'l3':\n    case 'latin3':\n      return 'ISO-8859-3'\n    case 'csisolatin4':\n    case 'iso-8859-4':\n    case 'iso-ir-110':\n    case 'iso8859-4':\n    case 'iso88594':\n    case 'iso_8859-4':\n    case 'iso_8859-4:1988':\n    case 'l4':\n    case 'latin4':\n      return 'ISO-8859-4'\n    case 'csisolatincyrillic':\n    case 'cyrillic':\n    case 'iso-8859-5':\n    case 'iso-ir-144':\n    case 'iso8859-5':\n    case 'iso88595':\n    case 'iso_8859-5':\n    case 'iso_8859-5:1988':\n      return 'ISO-8859-5'\n    case 'arabic':\n    case 'asmo-708':\n    case 'csiso88596e':\n    case 'csiso88596i':\n    case 'csisolatinarabic':\n    case 'ecma-114':\n    case 'iso-8859-6':\n    case 'iso-8859-6-e':\n    case 'iso-8859-6-i':\n    case 'iso-ir-127':\n    case 'iso8859-6':\n    case 'iso88596':\n    case 'iso_8859-6':\n    case 'iso_8859-6:1987':\n      return 'ISO-8859-6'\n    case 'csisolatingreek':\n    case 'ecma-118':\n    case 'elot_928':\n    case 'greek':\n    case 'greek8':\n    case 'iso-8859-7':\n    case 'iso-ir-126':\n    case 'iso8859-7':\n    case 'iso88597':\n    case 'iso_8859-7':\n    case 'iso_8859-7:1987':\n    case 'sun_eu_greek':\n      return 'ISO-8859-7'\n    case 'csiso88598e':\n    case 'csisolatinhebrew':\n    case 'hebrew':\n    case 'iso-8859-8':\n    case 'iso-8859-8-e':\n    case 'iso-ir-138':\n    case 'iso8859-8':\n    case 'iso88598':\n    case 'iso_8859-8':\n    case 'iso_8859-8:1988':\n    case 'visual':\n      return 'ISO-8859-8'\n    case 'csiso88598i':\n    case 'iso-8859-8-i':\n    case 'logical':\n      return 'ISO-8859-8-I'\n    case 'csisolatin6':\n    case 'iso-8859-10':\n    case 'iso-ir-157':\n    case 'iso8859-10':\n    case 'iso885910':\n    case 'l6':\n    case 'latin6':\n      return 'ISO-8859-10'\n    case 'iso-8859-13':\n    case 'iso8859-13':\n    case 'iso885913':\n      return 'ISO-8859-13'\n    case 'iso-8859-14':\n    case 'iso8859-14':\n    case 'iso885914':\n      return 'ISO-8859-14'\n    case 'csisolatin9':\n    case 'iso-8859-15':\n    case 'iso8859-15':\n    case 'iso885915':\n    case 'iso_8859-15':\n    case 'l9':\n      return 'ISO-8859-15'\n    case 'iso-8859-16':\n      return 'ISO-8859-16'\n    case 'cskoi8r':\n    case 'koi':\n    case 'koi8':\n    case 'koi8-r':\n    case 'koi8_r':\n      return 'KOI8-R'\n    case 'koi8-ru':\n    case 'koi8-u':\n      return 'KOI8-U'\n    case 'csmacintosh':\n    case 'mac':\n    case 'macintosh':\n    case 'x-mac-roman':\n      return 'macintosh'\n    case 'iso-8859-11':\n    case 'iso8859-11':\n    case 'iso885911':\n    case 'tis-620':\n    case 'windows-874':\n      return 'windows-874'\n    case 'cp1250':\n    case 'windows-1250':\n    case 'x-cp1250':\n      return 'windows-1250'\n    case 'cp1251':\n    case 'windows-1251':\n    case 'x-cp1251':\n      return 'windows-1251'\n    case 'ansi_x3.4-1968':\n    case 'ascii':\n    case 'cp1252':\n    case 'cp819':\n    case 'csisolatin1':\n    case 'ibm819':\n    case 'iso-8859-1':\n    case 'iso-ir-100':\n    case 'iso8859-1':\n    case 'iso88591':\n    case 'iso_8859-1':\n    case 'iso_8859-1:1987':\n    case 'l1':\n    case 'latin1':\n    case 'us-ascii':\n    case 'windows-1252':\n    case 'x-cp1252':\n      return 'windows-1252'\n    case 'cp1253':\n    case 'windows-1253':\n    case 'x-cp1253':\n      return 'windows-1253'\n    case 'cp1254':\n    case 'csisolatin5':\n    case 'iso-8859-9':\n    case 'iso-ir-148':\n    case 'iso8859-9':\n    case 'iso88599':\n    case 'iso_8859-9':\n    case 'iso_8859-9:1989':\n    case 'l5':\n    case 'latin5':\n    case 'windows-1254':\n    case 'x-cp1254':\n      return 'windows-1254'\n    case 'cp1255':\n    case 'windows-1255':\n    case 'x-cp1255':\n      return 'windows-1255'\n    case 'cp1256':\n    case 'windows-1256':\n    case 'x-cp1256':\n      return 'windows-1256'\n    case 'cp1257':\n    case 'windows-1257':\n    case 'x-cp1257':\n      return 'windows-1257'\n    case 'cp1258':\n    case 'windows-1258':\n    case 'x-cp1258':\n      return 'windows-1258'\n    case 'x-mac-cyrillic':\n    case 'x-mac-ukrainian':\n      return 'x-mac-cyrillic'\n    case 'chinese':\n    case 'csgb2312':\n    case 'csiso58gb231280':\n    case 'gb2312':\n    case 'gb_2312':\n    case 'gb_2312-80':\n    case 'gbk':\n    case 'iso-ir-58':\n    case 'x-gbk':\n      return 'GBK'\n    case 'gb18030':\n      return 'gb18030'\n    case 'big5':\n    case 'big5-hkscs':\n    case 'cn-big5':\n    case 'csbig5':\n    case 'x-x-big5':\n      return 'Big5'\n    case 'cseucpkdfmtjapanese':\n    case 'euc-jp':\n    case 'x-euc-jp':\n      return 'EUC-JP'\n    case 'csiso2022jp':\n    case 'iso-2022-jp':\n      return 'ISO-2022-JP'\n    case 'csshiftjis':\n    case 'ms932':\n    case 'ms_kanji':\n    case 'shift-jis':\n    case 'shift_jis':\n    case 'sjis':\n    case 'windows-31j':\n    case 'x-sjis':\n      return 'Shift_JIS'\n    case 'cseuckr':\n    case 'csksc56011987':\n    case 'euc-kr':\n    case 'iso-ir-149':\n    case 'korean':\n    case 'ks_c_5601-1987':\n    case 'ks_c_5601-1989':\n    case 'ksc5601':\n    case 'ksc_5601':\n    case 'windows-949':\n      return 'EUC-KR'\n    case 'csiso2022kr':\n    case 'hz-gb-2312':\n    case 'iso-2022-cn':\n    case 'iso-2022-cn-ext':\n    case 'iso-2022-kr':\n    case 'replacement':\n      return 'replacement'\n    case 'unicodefffe':\n    case 'utf-16be':\n      return 'UTF-16BE'\n    case 'csunicode':\n    case 'iso-10646-ucs-2':\n    case 'ucs-2':\n    case 'unicode':\n    case 'unicodefeff':\n    case 'utf-16':\n    case 'utf-16le':\n      return 'UTF-16LE'\n    case 'x-user-defined':\n      return 'x-user-defined'\n    default: return 'failure'\n  }\n}\n\nmodule.exports = {\n  getEncoding\n}\n","'use strict'\n\nconst {\n  kState,\n  kError,\n  kResult,\n  kAborted,\n  kLastProgressEventFired\n} = require('./symbols')\nconst { ProgressEvent } = require('./progressevent')\nconst { getEncoding } = require('./encoding')\nconst { DOMException } = require('../fetch/constants')\nconst { serializeAMimeType, parseMIMEType } = require('../fetch/dataURL')\nconst { types } = require('util')\nconst { StringDecoder } = require('string_decoder')\nconst { btoa } = require('buffer')\n\n/** @type {PropertyDescriptor} */\nconst staticPropertyDescriptors = {\n  enumerable: true,\n  writable: false,\n  configurable: false\n}\n\n/**\n * @see https://w3c.github.io/FileAPI/#readOperation\n * @param {import('./filereader').FileReader} fr\n * @param {import('buffer').Blob} blob\n * @param {string} type\n * @param {string?} encodingName\n */\nfunction readOperation (fr, blob, type, encodingName) {\n  // 1. If frâ€™s state is \"loading\", throw an InvalidStateError\n  //    DOMException.\n  if (fr[kState] === 'loading') {\n    throw new DOMException('Invalid state', 'InvalidStateError')\n  }\n\n  // 2. Set frâ€™s state to \"loading\".\n  fr[kState] = 'loading'\n\n  // 3. Set frâ€™s result to null.\n  fr[kResult] = null\n\n  // 4. Set frâ€™s error to null.\n  fr[kError] = null\n\n  // 5. Let stream be the result of calling get stream on blob.\n  /** @type {import('stream/web').ReadableStream} */\n  const stream = blob.stream()\n\n  // 6. Let reader be the result of getting a reader from stream.\n  const reader = stream.getReader()\n\n  // 7. Let bytes be an empty byte sequence.\n  /** @type {Uint8Array[]} */\n  const bytes = []\n\n  // 8. Let chunkPromise be the result of reading a chunk from\n  //    stream with reader.\n  let chunkPromise = reader.read()\n\n  // 9. Let isFirstChunk be true.\n  let isFirstChunk = true\n\n  // 10. In parallel, while true:\n  // Note: \"In parallel\" just means non-blocking\n  // Note 2: readOperation itself cannot be async as double\n  // reading the body would then reject the promise, instead\n  // of throwing an error.\n  ;(async () => {\n    while (!fr[kAborted]) {\n      // 1. Wait for chunkPromise to be fulfilled or rejected.\n      try {\n        const { done, value } = await chunkPromise\n\n        // 2. If chunkPromise is fulfilled, and isFirstChunk is\n        //    true, queue a task to fire a progress event called\n        //    loadstart at fr.\n        if (isFirstChunk && !fr[kAborted]) {\n          queueMicrotask(() => {\n            fireAProgressEvent('loadstart', fr)\n          })\n        }\n\n        // 3. Set isFirstChunk to false.\n        isFirstChunk = false\n\n        // 4. If chunkPromise is fulfilled with an object whose\n        //    done property is false and whose value property is\n        //    a Uint8Array object, run these steps:\n        if (!done && types.isUint8Array(value)) {\n          // 1. Let bs be the byte sequence represented by the\n          //    Uint8Array object.\n\n          // 2. Append bs to bytes.\n          bytes.push(value)\n\n          // 3. If roughly 50ms have passed since these steps\n          //    were last invoked, queue a task to fire a\n          //    progress event called progress at fr.\n          if (\n            (\n              fr[kLastProgressEventFired] === undefined ||\n              Date.now() - fr[kLastProgressEventFired] >= 50\n            ) &&\n            !fr[kAborted]\n          ) {\n            fr[kLastProgressEventFired] = Date.now()\n            queueMicrotask(() => {\n              fireAProgressEvent('progress', fr)\n            })\n          }\n\n          // 4. Set chunkPromise to the result of reading a\n          //    chunk from stream with reader.\n          chunkPromise = reader.read()\n        } else if (done) {\n          // 5. Otherwise, if chunkPromise is fulfilled with an\n          //    object whose done property is true, queue a task\n          //    to run the following steps and abort this algorithm:\n          queueMicrotask(() => {\n            // 1. Set frâ€™s state to \"done\".\n            fr[kState] = 'done'\n\n            // 2. Let result be the result of package data given\n            //    bytes, type, blobâ€™s type, and encodingName.\n            try {\n              const result = packageData(bytes, type, blob.type, encodingName)\n\n              // 4. Else:\n\n              if (fr[kAborted]) {\n                return\n              }\n\n              // 1. Set frâ€™s result to result.\n              fr[kResult] = result\n\n              // 2. Fire a progress event called load at the fr.\n              fireAProgressEvent('load', fr)\n            } catch (error) {\n              // 3. If package data threw an exception error:\n\n              // 1. Set frâ€™s error to error.\n              fr[kError] = error\n\n              // 2. Fire a progress event called error at fr.\n              fireAProgressEvent('error', fr)\n            }\n\n            // 5. If frâ€™s state is not \"loading\", fire a progress\n            //    event called loadend at the fr.\n            if (fr[kState] !== 'loading') {\n              fireAProgressEvent('loadend', fr)\n            }\n          })\n\n          break\n        }\n      } catch (error) {\n        if (fr[kAborted]) {\n          return\n        }\n\n        // 6. Otherwise, if chunkPromise is rejected with an\n        //    error error, queue a task to run the following\n        //    steps and abort this algorithm:\n        queueMicrotask(() => {\n          // 1. Set frâ€™s state to \"done\".\n          fr[kState] = 'done'\n\n          // 2. Set frâ€™s error to error.\n          fr[kError] = error\n\n          // 3. Fire a progress event called error at fr.\n          fireAProgressEvent('error', fr)\n\n          // 4. If frâ€™s state is not \"loading\", fire a progress\n          //    event called loadend at fr.\n          if (fr[kState] !== 'loading') {\n            fireAProgressEvent('loadend', fr)\n          }\n        })\n\n        break\n      }\n    }\n  })()\n}\n\n/**\n * @see https://w3c.github.io/FileAPI/#fire-a-progress-event\n * @see https://dom.spec.whatwg.org/#concept-event-fire\n * @param {string} e The name of the event\n * @param {import('./filereader').FileReader} reader\n */\nfunction fireAProgressEvent (e, reader) {\n  // The progress event e does not bubble. e.bubbles must be false\n  // The progress event e is NOT cancelable. e.cancelable must be false\n  const event = new ProgressEvent(e, {\n    bubbles: false,\n    cancelable: false\n  })\n\n  reader.dispatchEvent(event)\n}\n\n/**\n * @see https://w3c.github.io/FileAPI/#blob-package-data\n * @param {Uint8Array[]} bytes\n * @param {string} type\n * @param {string?} mimeType\n * @param {string?} encodingName\n */\nfunction packageData (bytes, type, mimeType, encodingName) {\n  // 1. A Blob has an associated package data algorithm, given\n  //    bytes, a type, a optional mimeType, and a optional\n  //    encodingName, which switches on type and runs the\n  //    associated steps:\n\n  switch (type) {\n    case 'DataURL': {\n      // 1. Return bytes as a DataURL [RFC2397] subject to\n      //    the considerations below:\n      //  * Use mimeType as part of the Data URL if it is\n      //    available in keeping with the Data URL\n      //    specification [RFC2397].\n      //  * If mimeType is not available return a Data URL\n      //    without a media-type. [RFC2397].\n\n      // https://datatracker.ietf.org/doc/html/rfc2397#section-3\n      // dataurl    := \"data:\" [ mediatype ] [ \";base64\" ] \",\" data\n      // mediatype  := [ type \"/\" subtype ] *( \";\" parameter )\n      // data       := *urlchar\n      // parameter  := attribute \"=\" value\n      let dataURL = 'data:'\n\n      const parsed = parseMIMEType(mimeType || 'application/octet-stream')\n\n      if (parsed !== 'failure') {\n        dataURL += serializeAMimeType(parsed)\n      }\n\n      dataURL += ';base64,'\n\n      const decoder = new StringDecoder('latin1')\n\n      for (const chunk of bytes) {\n        dataURL += btoa(decoder.write(chunk))\n      }\n\n      dataURL += btoa(decoder.end())\n\n      return dataURL\n    }\n    case 'Text': {\n      // 1. Let encoding be failure\n      let encoding = 'failure'\n\n      // 2. If the encodingName is present, set encoding to the\n      //    result of getting an encoding from encodingName.\n      if (encodingName) {\n        encoding = getEncoding(encodingName)\n      }\n\n      // 3. If encoding is failure, and mimeType is present:\n      if (encoding === 'failure' && mimeType) {\n        // 1. Let type be the result of parse a MIME type\n        //    given mimeType.\n        const type = parseMIMEType(mimeType)\n\n        // 2. If type is not failure, set encoding to the result\n        //    of getting an encoding from typeâ€™s parameters[\"charset\"].\n        if (type !== 'failure') {\n          encoding = getEncoding(type.parameters.get('charset'))\n        }\n      }\n\n      // 4. If encoding is failure, then set encoding to UTF-8.\n      if (encoding === 'failure') {\n        encoding = 'UTF-8'\n      }\n\n      // 5. Decode bytes using fallback encoding encoding, and\n      //    return the result.\n      return decode(bytes, encoding)\n    }\n    case 'ArrayBuffer': {\n      // Return a new ArrayBuffer whose contents are bytes.\n      const sequence = combineByteSequences(bytes)\n\n      return sequence.buffer\n    }\n    case 'BinaryString': {\n      // Return bytes as a binary string, in which every byte\n      //  is represented by a code unit of equal value [0..255].\n      let binaryString = ''\n\n      const decoder = new StringDecoder('latin1')\n\n      for (const chunk of bytes) {\n        binaryString += decoder.write(chunk)\n      }\n\n      binaryString += decoder.end()\n\n      return binaryString\n    }\n  }\n}\n\n/**\n * @see https://encoding.spec.whatwg.org/#decode\n * @param {Uint8Array[]} ioQueue\n * @param {string} encoding\n */\nfunction decode (ioQueue, encoding) {\n  const bytes = combineByteSequences(ioQueue)\n\n  // 1. Let BOMEncoding be the result of BOM sniffing ioQueue.\n  const BOMEncoding = BOMSniffing(bytes)\n\n  let slice = 0\n\n  // 2. If BOMEncoding is non-null:\n  if (BOMEncoding !== null) {\n    // 1. Set encoding to BOMEncoding.\n    encoding = BOMEncoding\n\n    // 2. Read three bytes from ioQueue, if BOMEncoding is\n    //    UTF-8; otherwise read two bytes.\n    //    (Do nothing with those bytes.)\n    slice = BOMEncoding === 'UTF-8' ? 3 : 2\n  }\n\n  // 3. Process a queue with an instance of encodingâ€™s\n  //    decoder, ioQueue, output, and \"replacement\".\n\n  // 4. Return output.\n\n  const sliced = bytes.slice(slice)\n  return new TextDecoder(encoding).decode(sliced)\n}\n\n/**\n * @see https://encoding.spec.whatwg.org/#bom-sniff\n * @param {Uint8Array} ioQueue\n */\nfunction BOMSniffing (ioQueue) {\n  // 1. Let BOM be the result of peeking 3 bytes from ioQueue,\n  //    converted to a byte sequence.\n  const [a, b, c] = ioQueue\n\n  // 2. For each of the rows in the table below, starting with\n  //    the first one and going down, if BOM starts with the\n  //    bytes given in the first column, then return the\n  //    encoding given in the cell in the second column of that\n  //    row. Otherwise, return null.\n  if (a === 0xEF && b === 0xBB && c === 0xBF) {\n    return 'UTF-8'\n  } else if (a === 0xFE && b === 0xFF) {\n    return 'UTF-16BE'\n  } else if (a === 0xFF && b === 0xFE) {\n    return 'UTF-16LE'\n  }\n\n  return null\n}\n\n/**\n * @param {Uint8Array[]} sequences\n */\nfunction combineByteSequences (sequences) {\n  const size = sequences.reduce((a, b) => {\n    return a + b.byteLength\n  }, 0)\n\n  let offset = 0\n\n  return sequences.reduce((a, b) => {\n    a.set(b, offset)\n    offset += b.byteLength\n    return a\n  }, new Uint8Array(size))\n}\n\nmodule.exports = {\n  staticPropertyDescriptors,\n  readOperation,\n  fireAProgressEvent\n}\n","'use strict'\n\nconst {\n  staticPropertyDescriptors,\n  readOperation,\n  fireAProgressEvent\n} = require('./util')\nconst {\n  kState,\n  kError,\n  kResult,\n  kEvents,\n  kAborted\n} = require('./symbols')\nconst { webidl } = require('../fetch/webidl')\nconst { kEnumerableProperty } = require('../core/util')\n\nclass FileReader extends EventTarget {\n  constructor () {\n    super()\n\n    this[kState] = 'empty'\n    this[kResult] = null\n    this[kError] = null\n    this[kEvents] = {\n      loadend: null,\n      error: null,\n      abort: null,\n      load: null,\n      progress: null,\n      loadstart: null\n    }\n  }\n\n  /**\n   * @see https://w3c.github.io/FileAPI/#dfn-readAsArrayBuffer\n   * @param {import('buffer').Blob} blob\n   */\n  readAsArrayBuffer (blob) {\n    webidl.brandCheck(this, FileReader)\n\n    webidl.argumentLengthCheck(arguments, 1, { header: 'FileReader.readAsArrayBuffer' })\n\n    blob = webidl.converters.Blob(blob, { strict: false })\n\n    // The readAsArrayBuffer(blob) method, when invoked,\n    // must initiate a read operation for blob with ArrayBuffer.\n    readOperation(this, blob, 'ArrayBuffer')\n  }\n\n  /**\n   * @see https://w3c.github.io/FileAPI/#readAsBinaryString\n   * @param {import('buffer').Blob} blob\n   */\n  readAsBinaryString (blob) {\n    webidl.brandCheck(this, FileReader)\n\n    webidl.argumentLengthCheck(arguments, 1, { header: 'FileReader.readAsBinaryString' })\n\n    blob = webidl.converters.Blob(blob, { strict: false })\n\n    // The readAsBinaryString(blob) method, when invoked,\n    // must initiate a read operation for blob with BinaryString.\n    readOperation(this, blob, 'BinaryString')\n  }\n\n  /**\n   * @see https://w3c.github.io/FileAPI/#readAsDataText\n   * @param {import('buffer').Blob} blob\n   * @param {string?} encoding\n   */\n  readAsText (blob, encoding = undefined) {\n    webidl.brandCheck(this, FileReader)\n\n    webidl.argumentLengthCheck(arguments, 1, { header: 'FileReader.readAsText' })\n\n    blob = webidl.converters.Blob(blob, { strict: false })\n\n    if (encoding !== undefined) {\n      encoding = webidl.converters.DOMString(encoding)\n    }\n\n    // The readAsText(blob, encoding) method, when invoked,\n    // must initiate a read operation for blob with Text and encoding.\n    readOperation(this, blob, 'Text', encoding)\n  }\n\n  /**\n   * @see https://w3c.github.io/FileAPI/#dfn-readAsDataURL\n   * @param {import('buffer').Blob} blob\n   */\n  readAsDataURL (blob) {\n    webidl.brandCheck(this, FileReader)\n\n    webidl.argumentLengthCheck(arguments, 1, { header: 'FileReader.readAsDataURL' })\n\n    blob = webidl.converters.Blob(blob, { strict: false })\n\n    // The readAsDataURL(blob) method, when invoked, must\n    // initiate a read operation for blob with DataURL.\n    readOperation(this, blob, 'DataURL')\n  }\n\n  /**\n   * @see https://w3c.github.io/FileAPI/#dfn-abort\n   */\n  abort () {\n    // 1. If this's state is \"empty\" or if this's state is\n    //    \"done\" set this's result to null and terminate\n    //    this algorithm.\n    if (this[kState] === 'empty' || this[kState] === 'done') {\n      this[kResult] = null\n      return\n    }\n\n    // 2. If this's state is \"loading\" set this's state to\n    //    \"done\" and set this's result to null.\n    if (this[kState] === 'loading') {\n      this[kState] = 'done'\n      this[kResult] = null\n    }\n\n    // 3. If there are any tasks from this on the file reading\n    //    task source in an affiliated task queue, then remove\n    //    those tasks from that task queue.\n    this[kAborted] = true\n\n    // 4. Terminate the algorithm for the read method being processed.\n    // TODO\n\n    // 5. Fire a progress event called abort at this.\n    fireAProgressEvent('abort', this)\n\n    // 6. If this's state is not \"loading\", fire a progress\n    //    event called loadend at this.\n    if (this[kState] !== 'loading') {\n      fireAProgressEvent('loadend', this)\n    }\n  }\n\n  /**\n   * @see https://w3c.github.io/FileAPI/#dom-filereader-readystate\n   */\n  get readyState () {\n    webidl.brandCheck(this, FileReader)\n\n    switch (this[kState]) {\n      case 'empty': return this.EMPTY\n      case 'loading': return this.LOADING\n      case 'done': return this.DONE\n    }\n  }\n\n  /**\n   * @see https://w3c.github.io/FileAPI/#dom-filereader-result\n   */\n  get result () {\n    webidl.brandCheck(this, FileReader)\n\n    // The result attributeâ€™s getter, when invoked, must return\n    // this's result.\n    return this[kResult]\n  }\n\n  /**\n   * @see https://w3c.github.io/FileAPI/#dom-filereader-error\n   */\n  get error () {\n    webidl.brandCheck(this, FileReader)\n\n    // The error attributeâ€™s getter, when invoked, must return\n    // this's error.\n    return this[kError]\n  }\n\n  get onloadend () {\n    webidl.brandCheck(this, FileReader)\n\n    return this[kEvents].loadend\n  }\n\n  set onloadend (fn) {\n    webidl.brandCheck(this, FileReader)\n\n    if (this[kEvents].loadend) {\n      this.removeEventListener('loadend', this[kEvents].loadend)\n    }\n\n    if (typeof fn === 'function') {\n      this[kEvents].loadend = fn\n      this.addEventListener('loadend', fn)\n    } else {\n      this[kEvents].loadend = null\n    }\n  }\n\n  get onerror () {\n    webidl.brandCheck(this, FileReader)\n\n    return this[kEvents].error\n  }\n\n  set onerror (fn) {\n    webidl.brandCheck(this, FileReader)\n\n    if (this[kEvents].error) {\n      this.removeEventListener('error', this[kEvents].error)\n    }\n\n    if (typeof fn === 'function') {\n      this[kEvents].error = fn\n      this.addEventListener('error', fn)\n    } else {\n      this[kEvents].error = null\n    }\n  }\n\n  get onloadstart () {\n    webidl.brandCheck(this, FileReader)\n\n    return this[kEvents].loadstart\n  }\n\n  set onloadstart (fn) {\n    webidl.brandCheck(this, FileReader)\n\n    if (this[kEvents].loadstart) {\n      this.removeEventListener('loadstart', this[kEvents].loadstart)\n    }\n\n    if (typeof fn === 'function') {\n      this[kEvents].loadstart = fn\n      this.addEventListener('loadstart', fn)\n    } else {\n      this[kEvents].loadstart = null\n    }\n  }\n\n  get onprogress () {\n    webidl.brandCheck(this, FileReader)\n\n    return this[kEvents].progress\n  }\n\n  set onprogress (fn) {\n    webidl.brandCheck(this, FileReader)\n\n    if (this[kEvents].progress) {\n      this.removeEventListener('progress', this[kEvents].progress)\n    }\n\n    if (typeof fn === 'function') {\n      this[kEvents].progress = fn\n      this.addEventListener('progress', fn)\n    } else {\n      this[kEvents].progress = null\n    }\n  }\n\n  get onload () {\n    webidl.brandCheck(this, FileReader)\n\n    return this[kEvents].load\n  }\n\n  set onload (fn) {\n    webidl.brandCheck(this, FileReader)\n\n    if (this[kEvents].load) {\n      this.removeEventListener('load', this[kEvents].load)\n    }\n\n    if (typeof fn === 'function') {\n      this[kEvents].load = fn\n      this.addEventListener('load', fn)\n    } else {\n      this[kEvents].load = null\n    }\n  }\n\n  get onabort () {\n    webidl.brandCheck(this, FileReader)\n\n    return this[kEvents].abort\n  }\n\n  set onabort (fn) {\n    webidl.brandCheck(this, FileReader)\n\n    if (this[kEvents].abort) {\n      this.removeEventListener('abort', this[kEvents].abort)\n    }\n\n    if (typeof fn === 'function') {\n      this[kEvents].abort = fn\n      this.addEventListener('abort', fn)\n    } else {\n      this[kEvents].abort = null\n    }\n  }\n}\n\n// https://w3c.github.io/FileAPI/#dom-filereader-empty\nFileReader.EMPTY = FileReader.prototype.EMPTY = 0\n// https://w3c.github.io/FileAPI/#dom-filereader-loading\nFileReader.LOADING = FileReader.prototype.LOADING = 1\n// https://w3c.github.io/FileAPI/#dom-filereader-done\nFileReader.DONE = FileReader.prototype.DONE = 2\n\nObject.defineProperties(FileReader.prototype, {\n  EMPTY: staticPropertyDescriptors,\n  LOADING: staticPropertyDescriptors,\n  DONE: staticPropertyDescriptors,\n  readAsArrayBuffer: kEnumerableProperty,\n  readAsBinaryString: kEnumerableProperty,\n  readAsText: kEnumerableProperty,\n  readAsDataURL: kEnumerableProperty,\n  abort: kEnumerableProperty,\n  readyState: kEnumerableProperty,\n  result: kEnumerableProperty,\n  error: kEnumerableProperty,\n  onloadstart: kEnumerableProperty,\n  onprogress: kEnumerableProperty,\n  onload: kEnumerableProperty,\n  onabort: kEnumerableProperty,\n  onerror: kEnumerableProperty,\n  onloadend: kEnumerableProperty,\n  [Symbol.toStringTag]: {\n    value: 'FileReader',\n    writable: false,\n    enumerable: false,\n    configurable: true\n  }\n})\n\nObject.defineProperties(FileReader, {\n  EMPTY: staticPropertyDescriptors,\n  LOADING: staticPropertyDescriptors,\n  DONE: staticPropertyDescriptors\n})\n\nmodule.exports = {\n  FileReader\n}\n","'use strict'\n\nmodule.exports = {\n  kConstruct: require('../core/symbols').kConstruct\n}\n","'use strict'\n\nconst assert = require('assert')\nconst { URLSerializer } = require('../fetch/dataURL')\nconst { isValidHeaderName } = require('../fetch/util')\n\n/**\n * @see https://url.spec.whatwg.org/#concept-url-equals\n * @param {URL} A\n * @param {URL} B\n * @param {boolean | undefined} excludeFragment\n * @returns {boolean}\n */\nfunction urlEquals (A, B, excludeFragment = false) {\n  const serializedA = URLSerializer(A, excludeFragment)\n\n  const serializedB = URLSerializer(B, excludeFragment)\n\n  return serializedA === serializedB\n}\n\n/**\n * @see https://github.com/chromium/chromium/blob/694d20d134cb553d8d89e5500b9148012b1ba299/content/browser/cache_storage/cache_storage_cache.cc#L260-L262\n * @param {string} header\n */\nfunction fieldValues (header) {\n  assert(header !== null)\n\n  const values = []\n\n  for (let value of header.split(',')) {\n    value = value.trim()\n\n    if (!value.length) {\n      continue\n    } else if (!isValidHeaderName(value)) {\n      continue\n    }\n\n    values.push(value)\n  }\n\n  return values\n}\n\nmodule.exports = {\n  urlEquals,\n  fieldValues\n}\n","'use strict'\n\nconst { kConstruct } = require('./symbols')\nconst { urlEquals, fieldValues: getFieldValues } = require('./util')\nconst { kEnumerableProperty, isDisturbed } = require('../core/util')\nconst { kHeadersList } = require('../core/symbols')\nconst { webidl } = require('../fetch/webidl')\nconst { Response, cloneResponse } = require('../fetch/response')\nconst { Request } = require('../fetch/request')\nconst { kState, kHeaders, kGuard, kRealm } = require('../fetch/symbols')\nconst { fetching } = require('../fetch/index')\nconst { urlIsHttpHttpsScheme, createDeferredPromise, readAllBytes } = require('../fetch/util')\nconst assert = require('assert')\nconst { getGlobalDispatcher } = require('../global')\n\n/**\n * @see https://w3c.github.io/ServiceWorker/#dfn-cache-batch-operation\n * @typedef {Object} CacheBatchOperation\n * @property {'delete' | 'put'} type\n * @property {any} request\n * @property {any} response\n * @property {import('../../types/cache').CacheQueryOptions} options\n */\n\n/**\n * @see https://w3c.github.io/ServiceWorker/#dfn-request-response-list\n * @typedef {[any, any][]} requestResponseList\n */\n\nclass Cache {\n  /**\n   * @see https://w3c.github.io/ServiceWorker/#dfn-relevant-request-response-list\n   * @type {requestResponseList}\n   */\n  #relevantRequestResponseList\n\n  constructor () {\n    if (arguments[0] !== kConstruct) {\n      webidl.illegalConstructor()\n    }\n\n    this.#relevantRequestResponseList = arguments[1]\n  }\n\n  async match (request, options = {}) {\n    webidl.brandCheck(this, Cache)\n    webidl.argumentLengthCheck(arguments, 1, { header: 'Cache.match' })\n\n    request = webidl.converters.RequestInfo(request)\n    options = webidl.converters.CacheQueryOptions(options)\n\n    const p = await this.matchAll(request, options)\n\n    if (p.length === 0) {\n      return\n    }\n\n    return p[0]\n  }\n\n  async matchAll (request = undefined, options = {}) {\n    webidl.brandCheck(this, Cache)\n\n    if (request !== undefined) request = webidl.converters.RequestInfo(request)\n    options = webidl.converters.CacheQueryOptions(options)\n\n    // 1.\n    let r = null\n\n    // 2.\n    if (request !== undefined) {\n      if (request instanceof Request) {\n        // 2.1.1\n        r = request[kState]\n\n        // 2.1.2\n        if (r.method !== 'GET' && !options.ignoreMethod) {\n          return []\n        }\n      } else if (typeof request === 'string') {\n        // 2.2.1\n        r = new Request(request)[kState]\n      }\n    }\n\n    // 5.\n    // 5.1\n    const responses = []\n\n    // 5.2\n    if (request === undefined) {\n      // 5.2.1\n      for (const requestResponse of this.#relevantRequestResponseList) {\n        responses.push(requestResponse[1])\n      }\n    } else { // 5.3\n      // 5.3.1\n      const requestResponses = this.#queryCache(r, options)\n\n      // 5.3.2\n      for (const requestResponse of requestResponses) {\n        responses.push(requestResponse[1])\n      }\n    }\n\n    // 5.4\n    // We don't implement CORs so we don't need to loop over the responses, yay!\n\n    // 5.5.1\n    const responseList = []\n\n    // 5.5.2\n    for (const response of responses) {\n      // 5.5.2.1\n      const responseObject = new Response(response.body?.source ?? null)\n      const body = responseObject[kState].body\n      responseObject[kState] = response\n      responseObject[kState].body = body\n      responseObject[kHeaders][kHeadersList] = response.headersList\n      responseObject[kHeaders][kGuard] = 'immutable'\n\n      responseList.push(responseObject)\n    }\n\n    // 6.\n    return Object.freeze(responseList)\n  }\n\n  async add (request) {\n    webidl.brandCheck(this, Cache)\n    webidl.argumentLengthCheck(arguments, 1, { header: 'Cache.add' })\n\n    request = webidl.converters.RequestInfo(request)\n\n    // 1.\n    const requests = [request]\n\n    // 2.\n    const responseArrayPromise = this.addAll(requests)\n\n    // 3.\n    return await responseArrayPromise\n  }\n\n  async addAll (requests) {\n    webidl.brandCheck(this, Cache)\n    webidl.argumentLengthCheck(arguments, 1, { header: 'Cache.addAll' })\n\n    requests = webidl.converters['sequence<RequestInfo>'](requests)\n\n    // 1.\n    const responsePromises = []\n\n    // 2.\n    const requestList = []\n\n    // 3.\n    for (const request of requests) {\n      if (typeof request === 'string') {\n        continue\n      }\n\n      // 3.1\n      const r = request[kState]\n\n      // 3.2\n      if (!urlIsHttpHttpsScheme(r.url) || r.method !== 'GET') {\n        throw webidl.errors.exception({\n          header: 'Cache.addAll',\n          message: 'Expected http/s scheme when method is not GET.'\n        })\n      }\n    }\n\n    // 4.\n    /** @type {ReturnType<typeof fetching>[]} */\n    const fetchControllers = []\n\n    // 5.\n    for (const request of requests) {\n      // 5.1\n      const r = new Request(request)[kState]\n\n      // 5.2\n      if (!urlIsHttpHttpsScheme(r.url)) {\n        throw webidl.errors.exception({\n          header: 'Cache.addAll',\n          message: 'Expected http/s scheme.'\n        })\n      }\n\n      // 5.4\n      r.initiator = 'fetch'\n      r.destination = 'subresource'\n\n      // 5.5\n      requestList.push(r)\n\n      // 5.6\n      const responsePromise = createDeferredPromise()\n\n      // 5.7\n      fetchControllers.push(fetching({\n        request: r,\n        dispatcher: getGlobalDispatcher(),\n        processResponse (response) {\n          // 1.\n          if (response.type === 'error' || response.status === 206 || response.status < 200 || response.status > 299) {\n            responsePromise.reject(webidl.errors.exception({\n              header: 'Cache.addAll',\n              message: 'Received an invalid status code or the request failed.'\n            }))\n          } else if (response.headersList.contains('vary')) { // 2.\n            // 2.1\n            const fieldValues = getFieldValues(response.headersList.get('vary'))\n\n            // 2.2\n            for (const fieldValue of fieldValues) {\n              // 2.2.1\n              if (fieldValue === '*') {\n                responsePromise.reject(webidl.errors.exception({\n                  header: 'Cache.addAll',\n                  message: 'invalid vary field value'\n                }))\n\n                for (const controller of fetchControllers) {\n                  controller.abort()\n                }\n\n                return\n              }\n            }\n          }\n        },\n        processResponseEndOfBody (response) {\n          // 1.\n          if (response.aborted) {\n            responsePromise.reject(new DOMException('aborted', 'AbortError'))\n            return\n          }\n\n          // 2.\n          responsePromise.resolve(response)\n        }\n      }))\n\n      // 5.8\n      responsePromises.push(responsePromise.promise)\n    }\n\n    // 6.\n    const p = Promise.all(responsePromises)\n\n    // 7.\n    const responses = await p\n\n    // 7.1\n    const operations = []\n\n    // 7.2\n    let index = 0\n\n    // 7.3\n    for (const response of responses) {\n      // 7.3.1\n      /** @type {CacheBatchOperation} */\n      const operation = {\n        type: 'put', // 7.3.2\n        request: requestList[index], // 7.3.3\n        response // 7.3.4\n      }\n\n      operations.push(operation) // 7.3.5\n\n      index++ // 7.3.6\n    }\n\n    // 7.5\n    const cacheJobPromise = createDeferredPromise()\n\n    // 7.6.1\n    let errorData = null\n\n    // 7.6.2\n    try {\n      this.#batchCacheOperations(operations)\n    } catch (e) {\n      errorData = e\n    }\n\n    // 7.6.3\n    queueMicrotask(() => {\n      // 7.6.3.1\n      if (errorData === null) {\n        cacheJobPromise.resolve(undefined)\n      } else {\n        // 7.6.3.2\n        cacheJobPromise.reject(errorData)\n      }\n    })\n\n    // 7.7\n    return cacheJobPromise.promise\n  }\n\n  async put (request, response) {\n    webidl.brandCheck(this, Cache)\n    webidl.argumentLengthCheck(arguments, 2, { header: 'Cache.put' })\n\n    request = webidl.converters.RequestInfo(request)\n    response = webidl.converters.Response(response)\n\n    // 1.\n    let innerRequest = null\n\n    // 2.\n    if (request instanceof Request) {\n      innerRequest = request[kState]\n    } else { // 3.\n      innerRequest = new Request(request)[kState]\n    }\n\n    // 4.\n    if (!urlIsHttpHttpsScheme(innerRequest.url) || innerRequest.method !== 'GET') {\n      throw webidl.errors.exception({\n        header: 'Cache.put',\n        message: 'Expected an http/s scheme when method is not GET'\n      })\n    }\n\n    // 5.\n    const innerResponse = response[kState]\n\n    // 6.\n    if (innerResponse.status === 206) {\n      throw webidl.errors.exception({\n        header: 'Cache.put',\n        message: 'Got 206 status'\n      })\n    }\n\n    // 7.\n    if (innerResponse.headersList.contains('vary')) {\n      // 7.1.\n      const fieldValues = getFieldValues(innerResponse.headersList.get('vary'))\n\n      // 7.2.\n      for (const fieldValue of fieldValues) {\n        // 7.2.1\n        if (fieldValue === '*') {\n          throw webidl.errors.exception({\n            header: 'Cache.put',\n            message: 'Got * vary field value'\n          })\n        }\n      }\n    }\n\n    // 8.\n    if (innerResponse.body && (isDisturbed(innerResponse.body.stream) || innerResponse.body.stream.locked)) {\n      throw webidl.errors.exception({\n        header: 'Cache.put',\n        message: 'Response body is locked or disturbed'\n      })\n    }\n\n    // 9.\n    const clonedResponse = cloneResponse(innerResponse)\n\n    // 10.\n    const bodyReadPromise = createDeferredPromise()\n\n    // 11.\n    if (innerResponse.body != null) {\n      // 11.1\n      const stream = innerResponse.body.stream\n\n      // 11.2\n      const reader = stream.getReader()\n\n      // 11.3\n      readAllBytes(reader).then(bodyReadPromise.resolve, bodyReadPromise.reject)\n    } else {\n      bodyReadPromise.resolve(undefined)\n    }\n\n    // 12.\n    /** @type {CacheBatchOperation[]} */\n    const operations = []\n\n    // 13.\n    /** @type {CacheBatchOperation} */\n    const operation = {\n      type: 'put', // 14.\n      request: innerRequest, // 15.\n      response: clonedResponse // 16.\n    }\n\n    // 17.\n    operations.push(operation)\n\n    // 19.\n    const bytes = await bodyReadPromise.promise\n\n    if (clonedResponse.body != null) {\n      clonedResponse.body.source = bytes\n    }\n\n    // 19.1\n    const cacheJobPromise = createDeferredPromise()\n\n    // 19.2.1\n    let errorData = null\n\n    // 19.2.2\n    try {\n      this.#batchCacheOperations(operations)\n    } catch (e) {\n      errorData = e\n    }\n\n    // 19.2.3\n    queueMicrotask(() => {\n      // 19.2.3.1\n      if (errorData === null) {\n        cacheJobPromise.resolve()\n      } else { // 19.2.3.2\n        cacheJobPromise.reject(errorData)\n      }\n    })\n\n    return cacheJobPromise.promise\n  }\n\n  async delete (request, options = {}) {\n    webidl.brandCheck(this, Cache)\n    webidl.argumentLengthCheck(arguments, 1, { header: 'Cache.delete' })\n\n    request = webidl.converters.RequestInfo(request)\n    options = webidl.converters.CacheQueryOptions(options)\n\n    /**\n     * @type {Request}\n     */\n    let r = null\n\n    if (request instanceof Request) {\n      r = request[kState]\n\n      if (r.method !== 'GET' && !options.ignoreMethod) {\n        return false\n      }\n    } else {\n      assert(typeof request === 'string')\n\n      r = new Request(request)[kState]\n    }\n\n    /** @type {CacheBatchOperation[]} */\n    const operations = []\n\n    /** @type {CacheBatchOperation} */\n    const operation = {\n      type: 'delete',\n      request: r,\n      options\n    }\n\n    operations.push(operation)\n\n    const cacheJobPromise = createDeferredPromise()\n\n    let errorData = null\n    let requestResponses\n\n    try {\n      requestResponses = this.#batchCacheOperations(operations)\n    } catch (e) {\n      errorData = e\n    }\n\n    queueMicrotask(() => {\n      if (errorData === null) {\n        cacheJobPromise.resolve(!!requestResponses?.length)\n      } else {\n        cacheJobPromise.reject(errorData)\n      }\n    })\n\n    return cacheJobPromise.promise\n  }\n\n  /**\n   * @see https://w3c.github.io/ServiceWorker/#dom-cache-keys\n   * @param {any} request\n   * @param {import('../../types/cache').CacheQueryOptions} options\n   * @returns {readonly Request[]}\n   */\n  async keys (request = undefined, options = {}) {\n    webidl.brandCheck(this, Cache)\n\n    if (request !== undefined) request = webidl.converters.RequestInfo(request)\n    options = webidl.converters.CacheQueryOptions(options)\n\n    // 1.\n    let r = null\n\n    // 2.\n    if (request !== undefined) {\n      // 2.1\n      if (request instanceof Request) {\n        // 2.1.1\n        r = request[kState]\n\n        // 2.1.2\n        if (r.method !== 'GET' && !options.ignoreMethod) {\n          return []\n        }\n      } else if (typeof request === 'string') { // 2.2\n        r = new Request(request)[kState]\n      }\n    }\n\n    // 4.\n    const promise = createDeferredPromise()\n\n    // 5.\n    // 5.1\n    const requests = []\n\n    // 5.2\n    if (request === undefined) {\n      // 5.2.1\n      for (const requestResponse of this.#relevantRequestResponseList) {\n        // 5.2.1.1\n        requests.push(requestResponse[0])\n      }\n    } else { // 5.3\n      // 5.3.1\n      const requestResponses = this.#queryCache(r, options)\n\n      // 5.3.2\n      for (const requestResponse of requestResponses) {\n        // 5.3.2.1\n        requests.push(requestResponse[0])\n      }\n    }\n\n    // 5.4\n    queueMicrotask(() => {\n      // 5.4.1\n      const requestList = []\n\n      // 5.4.2\n      for (const request of requests) {\n        const requestObject = new Request('https://a')\n        requestObject[kState] = request\n        requestObject[kHeaders][kHeadersList] = request.headersList\n        requestObject[kHeaders][kGuard] = 'immutable'\n        requestObject[kRealm] = request.client\n\n        // 5.4.2.1\n        requestList.push(requestObject)\n      }\n\n      // 5.4.3\n      promise.resolve(Object.freeze(requestList))\n    })\n\n    return promise.promise\n  }\n\n  /**\n   * @see https://w3c.github.io/ServiceWorker/#batch-cache-operations-algorithm\n   * @param {CacheBatchOperation[]} operations\n   * @returns {requestResponseList}\n   */\n  #batchCacheOperations (operations) {\n    // 1.\n    const cache = this.#relevantRequestResponseList\n\n    // 2.\n    const backupCache = [...cache]\n\n    // 3.\n    const addedItems = []\n\n    // 4.1\n    const resultList = []\n\n    try {\n      // 4.2\n      for (const operation of operations) {\n        // 4.2.1\n        if (operation.type !== 'delete' && operation.type !== 'put') {\n          throw webidl.errors.exception({\n            header: 'Cache.#batchCacheOperations',\n            message: 'operation type does not match \"delete\" or \"put\"'\n          })\n        }\n\n        // 4.2.2\n        if (operation.type === 'delete' && operation.response != null) {\n          throw webidl.errors.exception({\n            header: 'Cache.#batchCacheOperations',\n            message: 'delete operation should not have an associated response'\n          })\n        }\n\n        // 4.2.3\n        if (this.#queryCache(operation.request, operation.options, addedItems).length) {\n          throw new DOMException('???', 'InvalidStateError')\n        }\n\n        // 4.2.4\n        let requestResponses\n\n        // 4.2.5\n        if (operation.type === 'delete') {\n          // 4.2.5.1\n          requestResponses = this.#queryCache(operation.request, operation.options)\n\n          // TODO: the spec is wrong, this is needed to pass WPTs\n          if (requestResponses.length === 0) {\n            return []\n          }\n\n          // 4.2.5.2\n          for (const requestResponse of requestResponses) {\n            const idx = cache.indexOf(requestResponse)\n            assert(idx !== -1)\n\n            // 4.2.5.2.1\n            cache.splice(idx, 1)\n          }\n        } else if (operation.type === 'put') { // 4.2.6\n          // 4.2.6.1\n          if (operation.response == null) {\n            throw webidl.errors.exception({\n              header: 'Cache.#batchCacheOperations',\n              message: 'put operation should have an associated response'\n            })\n          }\n\n          // 4.2.6.2\n          const r = operation.request\n\n          // 4.2.6.3\n          if (!urlIsHttpHttpsScheme(r.url)) {\n            throw webidl.errors.exception({\n              header: 'Cache.#batchCacheOperations',\n              message: 'expected http or https scheme'\n            })\n          }\n\n          // 4.2.6.4\n          if (r.method !== 'GET') {\n            throw webidl.errors.exception({\n              header: 'Cache.#batchCacheOperations',\n              message: 'not get method'\n            })\n          }\n\n          // 4.2.6.5\n          if (operation.options != null) {\n            throw webidl.errors.exception({\n              header: 'Cache.#batchCacheOperations',\n              message: 'options must not be defined'\n            })\n          }\n\n          // 4.2.6.6\n          requestResponses = this.#queryCache(operation.request)\n\n          // 4.2.6.7\n          for (const requestResponse of requestResponses) {\n            const idx = cache.indexOf(requestResponse)\n            assert(idx !== -1)\n\n            // 4.2.6.7.1\n            cache.splice(idx, 1)\n          }\n\n          // 4.2.6.8\n          cache.push([operation.request, operation.response])\n\n          // 4.2.6.10\n          addedItems.push([operation.request, operation.response])\n        }\n\n        // 4.2.7\n        resultList.push([operation.request, operation.response])\n      }\n\n      // 4.3\n      return resultList\n    } catch (e) { // 5.\n      // 5.1\n      this.#relevantRequestResponseList.length = 0\n\n      // 5.2\n      this.#relevantRequestResponseList = backupCache\n\n      // 5.3\n      throw e\n    }\n  }\n\n  /**\n   * @see https://w3c.github.io/ServiceWorker/#query-cache\n   * @param {any} requestQuery\n   * @param {import('../../types/cache').CacheQueryOptions} options\n   * @param {requestResponseList} targetStorage\n   * @returns {requestResponseList}\n   */\n  #queryCache (requestQuery, options, targetStorage) {\n    /** @type {requestResponseList} */\n    const resultList = []\n\n    const storage = targetStorage ?? this.#relevantRequestResponseList\n\n    for (const requestResponse of storage) {\n      const [cachedRequest, cachedResponse] = requestResponse\n      if (this.#requestMatchesCachedItem(requestQuery, cachedRequest, cachedResponse, options)) {\n        resultList.push(requestResponse)\n      }\n    }\n\n    return resultList\n  }\n\n  /**\n   * @see https://w3c.github.io/ServiceWorker/#request-matches-cached-item-algorithm\n   * @param {any} requestQuery\n   * @param {any} request\n   * @param {any | null} response\n   * @param {import('../../types/cache').CacheQueryOptions | undefined} options\n   * @returns {boolean}\n   */\n  #requestMatchesCachedItem (requestQuery, request, response = null, options) {\n    // if (options?.ignoreMethod === false && request.method === 'GET') {\n    //   return false\n    // }\n\n    const queryURL = new URL(requestQuery.url)\n\n    const cachedURL = new URL(request.url)\n\n    if (options?.ignoreSearch) {\n      cachedURL.search = ''\n\n      queryURL.search = ''\n    }\n\n    if (!urlEquals(queryURL, cachedURL, true)) {\n      return false\n    }\n\n    if (\n      response == null ||\n      options?.ignoreVary ||\n      !response.headersList.contains('vary')\n    ) {\n      return true\n    }\n\n    const fieldValues = getFieldValues(response.headersList.get('vary'))\n\n    for (const fieldValue of fieldValues) {\n      if (fieldValue === '*') {\n        return false\n      }\n\n      const requestValue = request.headersList.get(fieldValue)\n      const queryValue = requestQuery.headersList.get(fieldValue)\n\n      // If one has the header and the other doesn't, or one has\n      // a different value than the other, return false\n      if (requestValue !== queryValue) {\n        return false\n      }\n    }\n\n    return true\n  }\n}\n\nObject.defineProperties(Cache.prototype, {\n  [Symbol.toStringTag]: {\n    value: 'Cache',\n    configurable: true\n  },\n  match: kEnumerableProperty,\n  matchAll: kEnumerableProperty,\n  add: kEnumerableProperty,\n  addAll: kEnumerableProperty,\n  put: kEnumerableProperty,\n  delete: kEnumerableProperty,\n  keys: kEnumerableProperty\n})\n\nconst cacheQueryOptionConverters = [\n  {\n    key: 'ignoreSearch',\n    converter: webidl.converters.boolean,\n    defaultValue: false\n  },\n  {\n    key: 'ignoreMethod',\n    converter: webidl.converters.boolean,\n    defaultValue: false\n  },\n  {\n    key: 'ignoreVary',\n    converter: webidl.converters.boolean,\n    defaultValue: false\n  }\n]\n\nwebidl.converters.CacheQueryOptions = webidl.dictionaryConverter(cacheQueryOptionConverters)\n\nwebidl.converters.MultiCacheQueryOptions = webidl.dictionaryConverter([\n  ...cacheQueryOptionConverters,\n  {\n    key: 'cacheName',\n    converter: webidl.converters.DOMString\n  }\n])\n\nwebidl.converters.Response = webidl.interfaceConverter(Response)\n\nwebidl.converters['sequence<RequestInfo>'] = webidl.sequenceConverter(\n  webidl.converters.RequestInfo\n)\n\nmodule.exports = {\n  Cache\n}\n","'use strict'\n\nconst { kConstruct } = require('./symbols')\nconst { Cache } = require('./cache')\nconst { webidl } = require('../fetch/webidl')\nconst { kEnumerableProperty } = require('../core/util')\n\nclass CacheStorage {\n  /**\n   * @see https://w3c.github.io/ServiceWorker/#dfn-relevant-name-to-cache-map\n   * @type {Map<string, import('./cache').requestResponseList}\n   */\n  #caches = new Map()\n\n  constructor () {\n    if (arguments[0] !== kConstruct) {\n      webidl.illegalConstructor()\n    }\n  }\n\n  async match (request, options = {}) {\n    webidl.brandCheck(this, CacheStorage)\n    webidl.argumentLengthCheck(arguments, 1, { header: 'CacheStorage.match' })\n\n    request = webidl.converters.RequestInfo(request)\n    options = webidl.converters.MultiCacheQueryOptions(options)\n\n    // 1.\n    if (options.cacheName != null) {\n      // 1.1.1.1\n      if (this.#caches.has(options.cacheName)) {\n        // 1.1.1.1.1\n        const cacheList = this.#caches.get(options.cacheName)\n        const cache = new Cache(kConstruct, cacheList)\n\n        return await cache.match(request, options)\n      }\n    } else { // 2.\n      // 2.2\n      for (const cacheList of this.#caches.values()) {\n        const cache = new Cache(kConstruct, cacheList)\n\n        // 2.2.1.2\n        const response = await cache.match(request, options)\n\n        if (response !== undefined) {\n          return response\n        }\n      }\n    }\n  }\n\n  /**\n   * @see https://w3c.github.io/ServiceWorker/#cache-storage-has\n   * @param {string} cacheName\n   * @returns {Promise<boolean>}\n   */\n  async has (cacheName) {\n    webidl.brandCheck(this, CacheStorage)\n    webidl.argumentLengthCheck(arguments, 1, { header: 'CacheStorage.has' })\n\n    cacheName = webidl.converters.DOMString(cacheName)\n\n    // 2.1.1\n    // 2.2\n    return this.#caches.has(cacheName)\n  }\n\n  /**\n   * @see https://w3c.github.io/ServiceWorker/#dom-cachestorage-open\n   * @param {string} cacheName\n   * @returns {Promise<Cache>}\n   */\n  async open (cacheName) {\n    webidl.brandCheck(this, CacheStorage)\n    webidl.argumentLengthCheck(arguments, 1, { header: 'CacheStorage.open' })\n\n    cacheName = webidl.converters.DOMString(cacheName)\n\n    // 2.1\n    if (this.#caches.has(cacheName)) {\n      // await caches.open('v1') !== await caches.open('v1')\n\n      // 2.1.1\n      const cache = this.#caches.get(cacheName)\n\n      // 2.1.1.1\n      return new Cache(kConstruct, cache)\n    }\n\n    // 2.2\n    const cache = []\n\n    // 2.3\n    this.#caches.set(cacheName, cache)\n\n    // 2.4\n    return new Cache(kConstruct, cache)\n  }\n\n  /**\n   * @see https://w3c.github.io/ServiceWorker/#cache-storage-delete\n   * @param {string} cacheName\n   * @returns {Promise<boolean>}\n   */\n  async delete (cacheName) {\n    webidl.brandCheck(this, CacheStorage)\n    webidl.argumentLengthCheck(arguments, 1, { header: 'CacheStorage.delete' })\n\n    cacheName = webidl.converters.DOMString(cacheName)\n\n    return this.#caches.delete(cacheName)\n  }\n\n  /**\n   * @see https://w3c.github.io/ServiceWorker/#cache-storage-keys\n   * @returns {string[]}\n   */\n  async keys () {\n    webidl.brandCheck(this, CacheStorage)\n\n    // 2.1\n    const keys = this.#caches.keys()\n\n    // 2.2\n    return [...keys]\n  }\n}\n\nObject.defineProperties(CacheStorage.prototype, {\n  [Symbol.toStringTag]: {\n    value: 'CacheStorage',\n    configurable: true\n  },\n  match: kEnumerableProperty,\n  has: kEnumerableProperty,\n  open: kEnumerableProperty,\n  delete: kEnumerableProperty,\n  keys: kEnumerableProperty\n})\n\nmodule.exports = {\n  CacheStorage\n}\n","'use strict'\n\n// https://wicg.github.io/cookie-store/#cookie-maximum-attribute-value-size\nconst maxAttributeValueSize = 1024\n\n// https://wicg.github.io/cookie-store/#cookie-maximum-name-value-pair-size\nconst maxNameValuePairSize = 4096\n\nmodule.exports = {\n  maxAttributeValueSize,\n  maxNameValuePairSize\n}\n","'use strict'\n\n/**\n * @param {string} value\n * @returns {boolean}\n */\nfunction isCTLExcludingHtab (value) {\n  if (value.length === 0) {\n    return false\n  }\n\n  for (const char of value) {\n    const code = char.charCodeAt(0)\n\n    if (\n      (code >= 0x00 || code <= 0x08) ||\n      (code >= 0x0A || code <= 0x1F) ||\n      code === 0x7F\n    ) {\n      return false\n    }\n  }\n}\n\n/**\n CHAR           = <any US-ASCII character (octets 0 - 127)>\n token          = 1*<any CHAR except CTLs or separators>\n separators     = \"(\" | \")\" | \"<\" | \">\" | \"@\"\n                | \",\" | \";\" | \":\" | \"\\\" | <\">\n                | \"/\" | \"[\" | \"]\" | \"?\" | \"=\"\n                | \"{\" | \"}\" | SP | HT\n * @param {string} name\n */\nfunction validateCookieName (name) {\n  for (const char of name) {\n    const code = char.charCodeAt(0)\n\n    if (\n      (code <= 0x20 || code > 0x7F) ||\n      char === '(' ||\n      char === ')' ||\n      char === '>' ||\n      char === '<' ||\n      char === '@' ||\n      char === ',' ||\n      char === ';' ||\n      char === ':' ||\n      char === '\\\\' ||\n      char === '\"' ||\n      char === '/' ||\n      char === '[' ||\n      char === ']' ||\n      char === '?' ||\n      char === '=' ||\n      char === '{' ||\n      char === '}'\n    ) {\n      throw new Error('Invalid cookie name')\n    }\n  }\n}\n\n/**\n cookie-value      = *cookie-octet / ( DQUOTE *cookie-octet DQUOTE )\n cookie-octet      = %x21 / %x23-2B / %x2D-3A / %x3C-5B / %x5D-7E\n                       ; US-ASCII characters excluding CTLs,\n                       ; whitespace DQUOTE, comma, semicolon,\n                       ; and backslash\n * @param {string} value\n */\nfunction validateCookieValue (value) {\n  for (const char of value) {\n    const code = char.charCodeAt(0)\n\n    if (\n      code < 0x21 || // exclude CTLs (0-31)\n      code === 0x22 ||\n      code === 0x2C ||\n      code === 0x3B ||\n      code === 0x5C ||\n      code > 0x7E // non-ascii\n    ) {\n      throw new Error('Invalid header value')\n    }\n  }\n}\n\n/**\n * path-value        = <any CHAR except CTLs or \";\">\n * @param {string} path\n */\nfunction validateCookiePath (path) {\n  for (const char of path) {\n    const code = char.charCodeAt(0)\n\n    if (code < 0x21 || char === ';') {\n      throw new Error('Invalid cookie path')\n    }\n  }\n}\n\n/**\n * I have no idea why these values aren't allowed to be honest,\n * but Deno tests these. - Khafra\n * @param {string} domain\n */\nfunction validateCookieDomain (domain) {\n  if (\n    domain.startsWith('-') ||\n    domain.endsWith('.') ||\n    domain.endsWith('-')\n  ) {\n    throw new Error('Invalid cookie domain')\n  }\n}\n\n/**\n * @see https://www.rfc-editor.org/rfc/rfc7231#section-7.1.1.1\n * @param {number|Date} date\n  IMF-fixdate  = day-name \",\" SP date1 SP time-of-day SP GMT\n  ; fixed length/zone/capitalization subset of the format\n  ; see Section 3.3 of [RFC5322]\n\n  day-name     = %x4D.6F.6E ; \"Mon\", case-sensitive\n              / %x54.75.65 ; \"Tue\", case-sensitive\n              / %x57.65.64 ; \"Wed\", case-sensitive\n              / %x54.68.75 ; \"Thu\", case-sensitive\n              / %x46.72.69 ; \"Fri\", case-sensitive\n              / %x53.61.74 ; \"Sat\", case-sensitive\n              / %x53.75.6E ; \"Sun\", case-sensitive\n  date1        = day SP month SP year\n                  ; e.g., 02 Jun 1982\n\n  day          = 2DIGIT\n  month        = %x4A.61.6E ; \"Jan\", case-sensitive\n              / %x46.65.62 ; \"Feb\", case-sensitive\n              / %x4D.61.72 ; \"Mar\", case-sensitive\n              / %x41.70.72 ; \"Apr\", case-sensitive\n              / %x4D.61.79 ; \"May\", case-sensitive\n              / %x4A.75.6E ; \"Jun\", case-sensitive\n              / %x4A.75.6C ; \"Jul\", case-sensitive\n              / %x41.75.67 ; \"Aug\", case-sensitive\n              / %x53.65.70 ; \"Sep\", case-sensitive\n              / %x4F.63.74 ; \"Oct\", case-sensitive\n              / %x4E.6F.76 ; \"Nov\", case-sensitive\n              / %x44.65.63 ; \"Dec\", case-sensitive\n  year         = 4DIGIT\n\n  GMT          = %x47.4D.54 ; \"GMT\", case-sensitive\n\n  time-of-day  = hour \":\" minute \":\" second\n              ; 00:00:00 - 23:59:60 (leap second)\n\n  hour         = 2DIGIT\n  minute       = 2DIGIT\n  second       = 2DIGIT\n */\nfunction toIMFDate (date) {\n  if (typeof date === 'number') {\n    date = new Date(date)\n  }\n\n  const days = [\n    'Sun', 'Mon', 'Tue', 'Wed',\n    'Thu', 'Fri', 'Sat'\n  ]\n\n  const months = [\n    'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',\n    'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'\n  ]\n\n  const dayName = days[date.getUTCDay()]\n  const day = date.getUTCDate().toString().padStart(2, '0')\n  const month = months[date.getUTCMonth()]\n  const year = date.getUTCFullYear()\n  const hour = date.getUTCHours().toString().padStart(2, '0')\n  const minute = date.getUTCMinutes().toString().padStart(2, '0')\n  const second = date.getUTCSeconds().toString().padStart(2, '0')\n\n  return `${dayName}, ${day} ${month} ${year} ${hour}:${minute}:${second} GMT`\n}\n\n/**\n max-age-av        = \"Max-Age=\" non-zero-digit *DIGIT\n                       ; In practice, both expires-av and max-age-av\n                       ; are limited to dates representable by the\n                       ; user agent.\n * @param {number} maxAge\n */\nfunction validateCookieMaxAge (maxAge) {\n  if (maxAge < 0) {\n    throw new Error('Invalid cookie max-age')\n  }\n}\n\n/**\n * @see https://www.rfc-editor.org/rfc/rfc6265#section-4.1.1\n * @param {import('./index').Cookie} cookie\n */\nfunction stringify (cookie) {\n  if (cookie.name.length === 0) {\n    return null\n  }\n\n  validateCookieName(cookie.name)\n  validateCookieValue(cookie.value)\n\n  const out = [`${cookie.name}=${cookie.value}`]\n\n  // https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-cookie-prefixes-00#section-3.1\n  // https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-cookie-prefixes-00#section-3.2\n  if (cookie.name.startsWith('__Secure-')) {\n    cookie.secure = true\n  }\n\n  if (cookie.name.startsWith('__Host-')) {\n    cookie.secure = true\n    cookie.domain = null\n    cookie.path = '/'\n  }\n\n  if (cookie.secure) {\n    out.push('Secure')\n  }\n\n  if (cookie.httpOnly) {\n    out.push('HttpOnly')\n  }\n\n  if (typeof cookie.maxAge === 'number') {\n    validateCookieMaxAge(cookie.maxAge)\n    out.push(`Max-Age=${cookie.maxAge}`)\n  }\n\n  if (cookie.domain) {\n    validateCookieDomain(cookie.domain)\n    out.push(`Domain=${cookie.domain}`)\n  }\n\n  if (cookie.path) {\n    validateCookiePath(cookie.path)\n    out.push(`Path=${cookie.path}`)\n  }\n\n  if (cookie.expires && cookie.expires.toString() !== 'Invalid Date') {\n    out.push(`Expires=${toIMFDate(cookie.expires)}`)\n  }\n\n  if (cookie.sameSite) {\n    out.push(`SameSite=${cookie.sameSite}`)\n  }\n\n  for (const part of cookie.unparsed) {\n    if (!part.includes('=')) {\n      throw new Error('Invalid unparsed')\n    }\n\n    const [key, ...value] = part.split('=')\n\n    out.push(`${key.trim()}=${value.join('=')}`)\n  }\n\n  return out.join('; ')\n}\n\nmodule.exports = {\n  isCTLExcludingHtab,\n  validateCookieName,\n  validateCookiePath,\n  validateCookieValue,\n  toIMFDate,\n  stringify\n}\n","'use strict'\n\nconst { maxNameValuePairSize, maxAttributeValueSize } = require('./constants')\nconst { isCTLExcludingHtab } = require('./util')\nconst { collectASequenceOfCodePointsFast } = require('../fetch/dataURL')\nconst assert = require('assert')\n\n/**\n * @description Parses the field-value attributes of a set-cookie header string.\n * @see https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis#section-5.4\n * @param {string} header\n * @returns if the header is invalid, null will be returned\n */\nfunction parseSetCookie (header) {\n  // 1. If the set-cookie-string contains a %x00-08 / %x0A-1F / %x7F\n  //    character (CTL characters excluding HTAB): Abort these steps and\n  //    ignore the set-cookie-string entirely.\n  if (isCTLExcludingHtab(header)) {\n    return null\n  }\n\n  let nameValuePair = ''\n  let unparsedAttributes = ''\n  let name = ''\n  let value = ''\n\n  // 2. If the set-cookie-string contains a %x3B (\";\") character:\n  if (header.includes(';')) {\n    // 1. The name-value-pair string consists of the characters up to,\n    //    but not including, the first %x3B (\";\"), and the unparsed-\n    //    attributes consist of the remainder of the set-cookie-string\n    //    (including the %x3B (\";\") in question).\n    const position = { position: 0 }\n\n    nameValuePair = collectASequenceOfCodePointsFast(';', header, position)\n    unparsedAttributes = header.slice(position.position)\n  } else {\n    // Otherwise:\n\n    // 1. The name-value-pair string consists of all the characters\n    //    contained in the set-cookie-string, and the unparsed-\n    //    attributes is the empty string.\n    nameValuePair = header\n  }\n\n  // 3. If the name-value-pair string lacks a %x3D (\"=\") character, then\n  //    the name string is empty, and the value string is the value of\n  //    name-value-pair.\n  if (!nameValuePair.includes('=')) {\n    value = nameValuePair\n  } else {\n    //    Otherwise, the name string consists of the characters up to, but\n    //    not including, the first %x3D (\"=\") character, and the (possibly\n    //    empty) value string consists of the characters after the first\n    //    %x3D (\"=\") character.\n    const position = { position: 0 }\n    name = collectASequenceOfCodePointsFast(\n      '=',\n      nameValuePair,\n      position\n    )\n    value = nameValuePair.slice(position.position + 1)\n  }\n\n  // 4. Remove any leading or trailing WSP characters from the name\n  //    string and the value string.\n  name = name.trim()\n  value = value.trim()\n\n  // 5. If the sum of the lengths of the name string and the value string\n  //    is more than 4096 octets, abort these steps and ignore the set-\n  //    cookie-string entirely.\n  if (name.length + value.length > maxNameValuePairSize) {\n    return null\n  }\n\n  // 6. The cookie-name is the name string, and the cookie-value is the\n  //    value string.\n  return {\n    name, value, ...parseUnparsedAttributes(unparsedAttributes)\n  }\n}\n\n/**\n * Parses the remaining attributes of a set-cookie header\n * @see https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis#section-5.4\n * @param {string} unparsedAttributes\n * @param {[Object.<string, unknown>]={}} cookieAttributeList\n */\nfunction parseUnparsedAttributes (unparsedAttributes, cookieAttributeList = {}) {\n  // 1. If the unparsed-attributes string is empty, skip the rest of\n  //    these steps.\n  if (unparsedAttributes.length === 0) {\n    return cookieAttributeList\n  }\n\n  // 2. Discard the first character of the unparsed-attributes (which\n  //    will be a %x3B (\";\") character).\n  assert(unparsedAttributes[0] === ';')\n  unparsedAttributes = unparsedAttributes.slice(1)\n\n  let cookieAv = ''\n\n  // 3. If the remaining unparsed-attributes contains a %x3B (\";\")\n  //    character:\n  if (unparsedAttributes.includes(';')) {\n    // 1. Consume the characters of the unparsed-attributes up to, but\n    //    not including, the first %x3B (\";\") character.\n    cookieAv = collectASequenceOfCodePointsFast(\n      ';',\n      unparsedAttributes,\n      { position: 0 }\n    )\n    unparsedAttributes = unparsedAttributes.slice(cookieAv.length)\n  } else {\n    // Otherwise:\n\n    // 1. Consume the remainder of the unparsed-attributes.\n    cookieAv = unparsedAttributes\n    unparsedAttributes = ''\n  }\n\n  // Let the cookie-av string be the characters consumed in this step.\n\n  let attributeName = ''\n  let attributeValue = ''\n\n  // 4. If the cookie-av string contains a %x3D (\"=\") character:\n  if (cookieAv.includes('=')) {\n    // 1. The (possibly empty) attribute-name string consists of the\n    //    characters up to, but not including, the first %x3D (\"=\")\n    //    character, and the (possibly empty) attribute-value string\n    //    consists of the characters after the first %x3D (\"=\")\n    //    character.\n    const position = { position: 0 }\n\n    attributeName = collectASequenceOfCodePointsFast(\n      '=',\n      cookieAv,\n      position\n    )\n    attributeValue = cookieAv.slice(position.position + 1)\n  } else {\n    // Otherwise:\n\n    // 1. The attribute-name string consists of the entire cookie-av\n    //    string, and the attribute-value string is empty.\n    attributeName = cookieAv\n  }\n\n  // 5. Remove any leading or trailing WSP characters from the attribute-\n  //    name string and the attribute-value string.\n  attributeName = attributeName.trim()\n  attributeValue = attributeValue.trim()\n\n  // 6. If the attribute-value is longer than 1024 octets, ignore the\n  //    cookie-av string and return to Step 1 of this algorithm.\n  if (attributeValue.length > maxAttributeValueSize) {\n    return parseUnparsedAttributes(unparsedAttributes, cookieAttributeList)\n  }\n\n  // 7. Process the attribute-name and attribute-value according to the\n  //    requirements in the following subsections.  (Notice that\n  //    attributes with unrecognized attribute-names are ignored.)\n  const attributeNameLowercase = attributeName.toLowerCase()\n\n  // https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis#section-5.4.1\n  // If the attribute-name case-insensitively matches the string\n  // \"Expires\", the user agent MUST process the cookie-av as follows.\n  if (attributeNameLowercase === 'expires') {\n    // 1. Let the expiry-time be the result of parsing the attribute-value\n    //    as cookie-date (see Section 5.1.1).\n    const expiryTime = new Date(attributeValue)\n\n    // 2. If the attribute-value failed to parse as a cookie date, ignore\n    //    the cookie-av.\n\n    cookieAttributeList.expires = expiryTime\n  } else if (attributeNameLowercase === 'max-age') {\n    // https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis#section-5.4.2\n    // If the attribute-name case-insensitively matches the string \"Max-\n    // Age\", the user agent MUST process the cookie-av as follows.\n\n    // 1. If the first character of the attribute-value is not a DIGIT or a\n    //    \"-\" character, ignore the cookie-av.\n    const charCode = attributeValue.charCodeAt(0)\n\n    if ((charCode < 48 || charCode > 57) && attributeValue[0] !== '-') {\n      return parseUnparsedAttributes(unparsedAttributes, cookieAttributeList)\n    }\n\n    // 2. If the remainder of attribute-value contains a non-DIGIT\n    //    character, ignore the cookie-av.\n    if (!/^\\d+$/.test(attributeValue)) {\n      return parseUnparsedAttributes(unparsedAttributes, cookieAttributeList)\n    }\n\n    // 3. Let delta-seconds be the attribute-value converted to an integer.\n    const deltaSeconds = Number(attributeValue)\n\n    // 4. Let cookie-age-limit be the maximum age of the cookie (which\n    //    SHOULD be 400 days or less, see Section 4.1.2.2).\n\n    // 5. Set delta-seconds to the smaller of its present value and cookie-\n    //    age-limit.\n    // deltaSeconds = Math.min(deltaSeconds * 1000, maxExpiresMs)\n\n    // 6. If delta-seconds is less than or equal to zero (0), let expiry-\n    //    time be the earliest representable date and time.  Otherwise, let\n    //    the expiry-time be the current date and time plus delta-seconds\n    //    seconds.\n    // const expiryTime = deltaSeconds <= 0 ? Date.now() : Date.now() + deltaSeconds\n\n    // 7. Append an attribute to the cookie-attribute-list with an\n    //    attribute-name of Max-Age and an attribute-value of expiry-time.\n    cookieAttributeList.maxAge = deltaSeconds\n  } else if (attributeNameLowercase === 'domain') {\n    // https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis#section-5.4.3\n    // If the attribute-name case-insensitively matches the string \"Domain\",\n    // the user agent MUST process the cookie-av as follows.\n\n    // 1. Let cookie-domain be the attribute-value.\n    let cookieDomain = attributeValue\n\n    // 2. If cookie-domain starts with %x2E (\".\"), let cookie-domain be\n    //    cookie-domain without its leading %x2E (\".\").\n    if (cookieDomain[0] === '.') {\n      cookieDomain = cookieDomain.slice(1)\n    }\n\n    // 3. Convert the cookie-domain to lower case.\n    cookieDomain = cookieDomain.toLowerCase()\n\n    // 4. Append an attribute to the cookie-attribute-list with an\n    //    attribute-name of Domain and an attribute-value of cookie-domain.\n    cookieAttributeList.domain = cookieDomain\n  } else if (attributeNameLowercase === 'path') {\n    // https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis#section-5.4.4\n    // If the attribute-name case-insensitively matches the string \"Path\",\n    // the user agent MUST process the cookie-av as follows.\n\n    // 1. If the attribute-value is empty or if the first character of the\n    //    attribute-value is not %x2F (\"/\"):\n    let cookiePath = ''\n    if (attributeValue.length === 0 || attributeValue[0] !== '/') {\n      // 1. Let cookie-path be the default-path.\n      cookiePath = '/'\n    } else {\n      // Otherwise:\n\n      // 1. Let cookie-path be the attribute-value.\n      cookiePath = attributeValue\n    }\n\n    // 2. Append an attribute to the cookie-attribute-list with an\n    //    attribute-name of Path and an attribute-value of cookie-path.\n    cookieAttributeList.path = cookiePath\n  } else if (attributeNameLowercase === 'secure') {\n    // https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis#section-5.4.5\n    // If the attribute-name case-insensitively matches the string \"Secure\",\n    // the user agent MUST append an attribute to the cookie-attribute-list\n    // with an attribute-name of Secure and an empty attribute-value.\n\n    cookieAttributeList.secure = true\n  } else if (attributeNameLowercase === 'httponly') {\n    // https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis#section-5.4.6\n    // If the attribute-name case-insensitively matches the string\n    // \"HttpOnly\", the user agent MUST append an attribute to the cookie-\n    // attribute-list with an attribute-name of HttpOnly and an empty\n    // attribute-value.\n\n    cookieAttributeList.httpOnly = true\n  } else if (attributeNameLowercase === 'samesite') {\n    // https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis#section-5.4.7\n    // If the attribute-name case-insensitively matches the string\n    // \"SameSite\", the user agent MUST process the cookie-av as follows:\n\n    // 1. Let enforcement be \"Default\".\n    let enforcement = 'Default'\n\n    const attributeValueLowercase = attributeValue.toLowerCase()\n    // 2. If cookie-av's attribute-value is a case-insensitive match for\n    //    \"None\", set enforcement to \"None\".\n    if (attributeValueLowercase.includes('none')) {\n      enforcement = 'None'\n    }\n\n    // 3. If cookie-av's attribute-value is a case-insensitive match for\n    //    \"Strict\", set enforcement to \"Strict\".\n    if (attributeValueLowercase.includes('strict')) {\n      enforcement = 'Strict'\n    }\n\n    // 4. If cookie-av's attribute-value is a case-insensitive match for\n    //    \"Lax\", set enforcement to \"Lax\".\n    if (attributeValueLowercase.includes('lax')) {\n      enforcement = 'Lax'\n    }\n\n    // 5. Append an attribute to the cookie-attribute-list with an\n    //    attribute-name of \"SameSite\" and an attribute-value of\n    //    enforcement.\n    cookieAttributeList.sameSite = enforcement\n  } else {\n    cookieAttributeList.unparsed ??= []\n\n    cookieAttributeList.unparsed.push(`${attributeName}=${attributeValue}`)\n  }\n\n  // 8. Return to Step 1 of this algorithm.\n  return parseUnparsedAttributes(unparsedAttributes, cookieAttributeList)\n}\n\nmodule.exports = {\n  parseSetCookie,\n  parseUnparsedAttributes\n}\n","'use strict'\n\nconst { parseSetCookie } = require('./parse')\nconst { stringify } = require('./util')\nconst { webidl } = require('../fetch/webidl')\nconst { Headers } = require('../fetch/headers')\n\n/**\n * @typedef {Object} Cookie\n * @property {string} name\n * @property {string} value\n * @property {Date|number|undefined} expires\n * @property {number|undefined} maxAge\n * @property {string|undefined} domain\n * @property {string|undefined} path\n * @property {boolean|undefined} secure\n * @property {boolean|undefined} httpOnly\n * @property {'Strict'|'Lax'|'None'} sameSite\n * @property {string[]} unparsed\n */\n\n/**\n * @param {Headers} headers\n * @returns {Record<string, string>}\n */\nfunction getCookies (headers) {\n  webidl.argumentLengthCheck(arguments, 1, { header: 'getCookies' })\n\n  webidl.brandCheck(headers, Headers, { strict: false })\n\n  const cookie = headers.get('cookie')\n  const out = {}\n\n  if (!cookie) {\n    return out\n  }\n\n  for (const piece of cookie.split(';')) {\n    const [name, ...value] = piece.split('=')\n\n    out[name.trim()] = value.join('=')\n  }\n\n  return out\n}\n\n/**\n * @param {Headers} headers\n * @param {string} name\n * @param {{ path?: string, domain?: string }|undefined} attributes\n * @returns {void}\n */\nfunction deleteCookie (headers, name, attributes) {\n  webidl.argumentLengthCheck(arguments, 2, { header: 'deleteCookie' })\n\n  webidl.brandCheck(headers, Headers, { strict: false })\n\n  name = webidl.converters.DOMString(name)\n  attributes = webidl.converters.DeleteCookieAttributes(attributes)\n\n  // Matches behavior of\n  // https://github.com/denoland/deno_std/blob/63827b16330b82489a04614027c33b7904e08be5/http/cookie.ts#L278\n  setCookie(headers, {\n    name,\n    value: '',\n    expires: new Date(0),\n    ...attributes\n  })\n}\n\n/**\n * @param {Headers} headers\n * @returns {Cookie[]}\n */\nfunction getSetCookies (headers) {\n  webidl.argumentLengthCheck(arguments, 1, { header: 'getSetCookies' })\n\n  webidl.brandCheck(headers, Headers, { strict: false })\n\n  const cookies = headers.getSetCookie()\n\n  if (!cookies) {\n    return []\n  }\n\n  return cookies.map((pair) => parseSetCookie(pair))\n}\n\n/**\n * @param {Headers} headers\n * @param {Cookie} cookie\n * @returns {void}\n */\nfunction setCookie (headers, cookie) {\n  webidl.argumentLengthCheck(arguments, 2, { header: 'setCookie' })\n\n  webidl.brandCheck(headers, Headers, { strict: false })\n\n  cookie = webidl.converters.Cookie(cookie)\n\n  const str = stringify(cookie)\n\n  if (str) {\n    headers.append('Set-Cookie', stringify(cookie))\n  }\n}\n\nwebidl.converters.DeleteCookieAttributes = webidl.dictionaryConverter([\n  {\n    converter: webidl.nullableConverter(webidl.converters.DOMString),\n    key: 'path',\n    defaultValue: null\n  },\n  {\n    converter: webidl.nullableConverter(webidl.converters.DOMString),\n    key: 'domain',\n    defaultValue: null\n  }\n])\n\nwebidl.converters.Cookie = webidl.dictionaryConverter([\n  {\n    converter: webidl.converters.DOMString,\n    key: 'name'\n  },\n  {\n    converter: webidl.converters.DOMString,\n    key: 'value'\n  },\n  {\n    converter: webidl.nullableConverter((value) => {\n      if (typeof value === 'number') {\n        return webidl.converters['unsigned long long'](value)\n      }\n\n      return new Date(value)\n    }),\n    key: 'expires',\n    defaultValue: null\n  },\n  {\n    converter: webidl.nullableConverter(webidl.converters['long long']),\n    key: 'maxAge',\n    defaultValue: null\n  },\n  {\n    converter: webidl.nullableConverter(webidl.converters.DOMString),\n    key: 'domain',\n    defaultValue: null\n  },\n  {\n    converter: webidl.nullableConverter(webidl.converters.DOMString),\n    key: 'path',\n    defaultValue: null\n  },\n  {\n    converter: webidl.nullableConverter(webidl.converters.boolean),\n    key: 'secure',\n    defaultValue: null\n  },\n  {\n    converter: webidl.nullableConverter(webidl.converters.boolean),\n    key: 'httpOnly',\n    defaultValue: null\n  },\n  {\n    converter: webidl.converters.USVString,\n    key: 'sameSite',\n    allowedValues: ['Strict', 'Lax', 'None']\n  },\n  {\n    converter: webidl.sequenceConverter(webidl.converters.DOMString),\n    key: 'unparsed',\n    defaultValue: []\n  }\n])\n\nmodule.exports = {\n  getCookies,\n  deleteCookie,\n  getSetCookies,\n  setCookie\n}\n","'use strict'\n\n// This is a Globally Unique Identifier unique used\n// to validate that the endpoint accepts websocket\n// connections.\n// See https://www.rfc-editor.org/rfc/rfc6455.html#section-1.3\nconst uid = '258EAFA5-E914-47DA-95CA-C5AB0DC85B11'\n\n/** @type {PropertyDescriptor} */\nconst staticPropertyDescriptors = {\n  enumerable: true,\n  writable: false,\n  configurable: false\n}\n\nconst states = {\n  CONNECTING: 0,\n  OPEN: 1,\n  CLOSING: 2,\n  CLOSED: 3\n}\n\nconst opcodes = {\n  CONTINUATION: 0x0,\n  TEXT: 0x1,\n  BINARY: 0x2,\n  CLOSE: 0x8,\n  PING: 0x9,\n  PONG: 0xA\n}\n\nconst maxUnsigned16Bit = 2 ** 16 - 1 // 65535\n\nconst parserStates = {\n  INFO: 0,\n  PAYLOADLENGTH_16: 2,\n  PAYLOADLENGTH_64: 3,\n  READ_DATA: 4\n}\n\nconst emptyBuffer = Buffer.allocUnsafe(0)\n\nmodule.exports = {\n  uid,\n  staticPropertyDescriptors,\n  states,\n  opcodes,\n  maxUnsigned16Bit,\n  parserStates,\n  emptyBuffer\n}\n","'use strict'\n\nmodule.exports = {\n  kWebSocketURL: Symbol('url'),\n  kReadyState: Symbol('ready state'),\n  kController: Symbol('controller'),\n  kResponse: Symbol('response'),\n  kBinaryType: Symbol('binary type'),\n  kSentClose: Symbol('sent close'),\n  kReceivedClose: Symbol('received close'),\n  kByteParser: Symbol('byte parser')\n}\n","'use strict'\n\nconst { webidl } = require('../fetch/webidl')\nconst { kEnumerableProperty } = require('../core/util')\nconst { MessagePort } = require('worker_threads')\n\n/**\n * @see https://html.spec.whatwg.org/multipage/comms.html#messageevent\n */\nclass MessageEvent extends Event {\n  #eventInit\n\n  constructor (type, eventInitDict = {}) {\n    webidl.argumentLengthCheck(arguments, 1, { header: 'MessageEvent constructor' })\n\n    type = webidl.converters.DOMString(type)\n    eventInitDict = webidl.converters.MessageEventInit(eventInitDict)\n\n    super(type, eventInitDict)\n\n    this.#eventInit = eventInitDict\n  }\n\n  get data () {\n    webidl.brandCheck(this, MessageEvent)\n\n    return this.#eventInit.data\n  }\n\n  get origin () {\n    webidl.brandCheck(this, MessageEvent)\n\n    return this.#eventInit.origin\n  }\n\n  get lastEventId () {\n    webidl.brandCheck(this, MessageEvent)\n\n    return this.#eventInit.lastEventId\n  }\n\n  get source () {\n    webidl.brandCheck(this, MessageEvent)\n\n    return this.#eventInit.source\n  }\n\n  get ports () {\n    webidl.brandCheck(this, MessageEvent)\n\n    if (!Object.isFrozen(this.#eventInit.ports)) {\n      Object.freeze(this.#eventInit.ports)\n    }\n\n    return this.#eventInit.ports\n  }\n\n  initMessageEvent (\n    type,\n    bubbles = false,\n    cancelable = false,\n    data = null,\n    origin = '',\n    lastEventId = '',\n    source = null,\n    ports = []\n  ) {\n    webidl.brandCheck(this, MessageEvent)\n\n    webidl.argumentLengthCheck(arguments, 1, { header: 'MessageEvent.initMessageEvent' })\n\n    return new MessageEvent(type, {\n      bubbles, cancelable, data, origin, lastEventId, source, ports\n    })\n  }\n}\n\n/**\n * @see https://websockets.spec.whatwg.org/#the-closeevent-interface\n */\nclass CloseEvent extends Event {\n  #eventInit\n\n  constructor (type, eventInitDict = {}) {\n    webidl.argumentLengthCheck(arguments, 1, { header: 'CloseEvent constructor' })\n\n    type = webidl.converters.DOMString(type)\n    eventInitDict = webidl.converters.CloseEventInit(eventInitDict)\n\n    super(type, eventInitDict)\n\n    this.#eventInit = eventInitDict\n  }\n\n  get wasClean () {\n    webidl.brandCheck(this, CloseEvent)\n\n    return this.#eventInit.wasClean\n  }\n\n  get code () {\n    webidl.brandCheck(this, CloseEvent)\n\n    return this.#eventInit.code\n  }\n\n  get reason () {\n    webidl.brandCheck(this, CloseEvent)\n\n    return this.#eventInit.reason\n  }\n}\n\n// https://html.spec.whatwg.org/multipage/webappapis.html#the-errorevent-interface\nclass ErrorEvent extends Event {\n  #eventInit\n\n  constructor (type, eventInitDict) {\n    webidl.argumentLengthCheck(arguments, 1, { header: 'ErrorEvent constructor' })\n\n    super(type, eventInitDict)\n\n    type = webidl.converters.DOMString(type)\n    eventInitDict = webidl.converters.ErrorEventInit(eventInitDict ?? {})\n\n    this.#eventInit = eventInitDict\n  }\n\n  get message () {\n    webidl.brandCheck(this, ErrorEvent)\n\n    return this.#eventInit.message\n  }\n\n  get filename () {\n    webidl.brandCheck(this, ErrorEvent)\n\n    return this.#eventInit.filename\n  }\n\n  get lineno () {\n    webidl.brandCheck(this, ErrorEvent)\n\n    return this.#eventInit.lineno\n  }\n\n  get colno () {\n    webidl.brandCheck(this, ErrorEvent)\n\n    return this.#eventInit.colno\n  }\n\n  get error () {\n    webidl.brandCheck(this, ErrorEvent)\n\n    return this.#eventInit.error\n  }\n}\n\nObject.defineProperties(MessageEvent.prototype, {\n  [Symbol.toStringTag]: {\n    value: 'MessageEvent',\n    configurable: true\n  },\n  data: kEnumerableProperty,\n  origin: kEnumerableProperty,\n  lastEventId: kEnumerableProperty,\n  source: kEnumerableProperty,\n  ports: kEnumerableProperty,\n  initMessageEvent: kEnumerableProperty\n})\n\nObject.defineProperties(CloseEvent.prototype, {\n  [Symbol.toStringTag]: {\n    value: 'CloseEvent',\n    configurable: true\n  },\n  reason: kEnumerableProperty,\n  code: kEnumerableProperty,\n  wasClean: kEnumerableProperty\n})\n\nObject.defineProperties(ErrorEvent.prototype, {\n  [Symbol.toStringTag]: {\n    value: 'ErrorEvent',\n    configurable: true\n  },\n  message: kEnumerableProperty,\n  filename: kEnumerableProperty,\n  lineno: kEnumerableProperty,\n  colno: kEnumerableProperty,\n  error: kEnumerableProperty\n})\n\nwebidl.converters.MessagePort = webidl.interfaceConverter(MessagePort)\n\nwebidl.converters['sequence<MessagePort>'] = webidl.sequenceConverter(\n  webidl.converters.MessagePort\n)\n\nconst eventInit = [\n  {\n    key: 'bubbles',\n    converter: webidl.converters.boolean,\n    defaultValue: false\n  },\n  {\n    key: 'cancelable',\n    converter: webidl.converters.boolean,\n    defaultValue: false\n  },\n  {\n    key: 'composed',\n    converter: webidl.converters.boolean,\n    defaultValue: false\n  }\n]\n\nwebidl.converters.MessageEventInit = webidl.dictionaryConverter([\n  ...eventInit,\n  {\n    key: 'data',\n    converter: webidl.converters.any,\n    defaultValue: null\n  },\n  {\n    key: 'origin',\n    converter: webidl.converters.USVString,\n    defaultValue: ''\n  },\n  {\n    key: 'lastEventId',\n    converter: webidl.converters.DOMString,\n    defaultValue: ''\n  },\n  {\n    key: 'source',\n    // Node doesn't implement WindowProxy or ServiceWorker, so the only\n    // valid value for source is a MessagePort.\n    converter: webidl.nullableConverter(webidl.converters.MessagePort),\n    defaultValue: null\n  },\n  {\n    key: 'ports',\n    converter: webidl.converters['sequence<MessagePort>'],\n    get defaultValue () {\n      return []\n    }\n  }\n])\n\nwebidl.converters.CloseEventInit = webidl.dictionaryConverter([\n  ...eventInit,\n  {\n    key: 'wasClean',\n    converter: webidl.converters.boolean,\n    defaultValue: false\n  },\n  {\n    key: 'code',\n    converter: webidl.converters['unsigned short'],\n    defaultValue: 0\n  },\n  {\n    key: 'reason',\n    converter: webidl.converters.USVString,\n    defaultValue: ''\n  }\n])\n\nwebidl.converters.ErrorEventInit = webidl.dictionaryConverter([\n  ...eventInit,\n  {\n    key: 'message',\n    converter: webidl.converters.DOMString,\n    defaultValue: ''\n  },\n  {\n    key: 'filename',\n    converter: webidl.converters.USVString,\n    defaultValue: ''\n  },\n  {\n    key: 'lineno',\n    converter: webidl.converters['unsigned long'],\n    defaultValue: 0\n  },\n  {\n    key: 'colno',\n    converter: webidl.converters['unsigned long'],\n    defaultValue: 0\n  },\n  {\n    key: 'error',\n    converter: webidl.converters.any\n  }\n])\n\nmodule.exports = {\n  MessageEvent,\n  CloseEvent,\n  ErrorEvent\n}\n","'use strict'\n\nconst { kReadyState, kController, kResponse, kBinaryType, kWebSocketURL } = require('./symbols')\nconst { states, opcodes } = require('./constants')\nconst { MessageEvent, ErrorEvent } = require('./events')\n\n/* globals Blob */\n\n/**\n * @param {import('./websocket').WebSocket} ws\n */\nfunction isEstablished (ws) {\n  // If the server's response is validated as provided for above, it is\n  // said that _The WebSocket Connection is Established_ and that the\n  // WebSocket Connection is in the OPEN state.\n  return ws[kReadyState] === states.OPEN\n}\n\n/**\n * @param {import('./websocket').WebSocket} ws\n */\nfunction isClosing (ws) {\n  // Upon either sending or receiving a Close control frame, it is said\n  // that _The WebSocket Closing Handshake is Started_ and that the\n  // WebSocket connection is in the CLOSING state.\n  return ws[kReadyState] === states.CLOSING\n}\n\n/**\n * @param {import('./websocket').WebSocket} ws\n */\nfunction isClosed (ws) {\n  return ws[kReadyState] === states.CLOSED\n}\n\n/**\n * @see https://dom.spec.whatwg.org/#concept-event-fire\n * @param {string} e\n * @param {EventTarget} target\n * @param {EventInit | undefined} eventInitDict\n */\nfunction fireEvent (e, target, eventConstructor = Event, eventInitDict) {\n  // 1. If eventConstructor is not given, then let eventConstructor be Event.\n\n  // 2. Let event be the result of creating an event given eventConstructor,\n  //    in the relevant realm of target.\n  // 3. Initialize eventâ€™s type attribute to e.\n  const event = new eventConstructor(e, eventInitDict) // eslint-disable-line new-cap\n\n  // 4. Initialize any other IDL attributes of event as described in the\n  //    invocation of this algorithm.\n\n  // 5. Return the result of dispatching event at target, with legacy target\n  //    override flag set if set.\n  target.dispatchEvent(event)\n}\n\n/**\n * @see https://websockets.spec.whatwg.org/#feedback-from-the-protocol\n * @param {import('./websocket').WebSocket} ws\n * @param {number} type Opcode\n * @param {Buffer} data application data\n */\nfunction websocketMessageReceived (ws, type, data) {\n  // 1. If ready state is not OPEN (1), then return.\n  if (ws[kReadyState] !== states.OPEN) {\n    return\n  }\n\n  // 2. Let dataForEvent be determined by switching on type and binary type:\n  let dataForEvent\n\n  if (type === opcodes.TEXT) {\n    // -> type indicates that the data is Text\n    //      a new DOMString containing data\n    try {\n      dataForEvent = new TextDecoder('utf-8', { fatal: true }).decode(data)\n    } catch {\n      failWebsocketConnection(ws, 'Received invalid UTF-8 in text frame.')\n      return\n    }\n  } else if (type === opcodes.BINARY) {\n    if (ws[kBinaryType] === 'blob') {\n      // -> type indicates that the data is Binary and binary type is \"blob\"\n      //      a new Blob object, created in the relevant Realm of the WebSocket\n      //      object, that represents data as its raw data\n      dataForEvent = new Blob([data])\n    } else {\n      // -> type indicates that the data is Binary and binary type is \"arraybuffer\"\n      //      a new ArrayBuffer object, created in the relevant Realm of the\n      //      WebSocket object, whose contents are data\n      dataForEvent = new Uint8Array(data).buffer\n    }\n  }\n\n  // 3. Fire an event named message at the WebSocket object, using MessageEvent,\n  //    with the origin attribute initialized to the serialization of the WebSocket\n  //    objectâ€™s url's origin, and the data attribute initialized to dataForEvent.\n  fireEvent('message', ws, MessageEvent, {\n    origin: ws[kWebSocketURL].origin,\n    data: dataForEvent\n  })\n}\n\n/**\n * @see https://datatracker.ietf.org/doc/html/rfc6455\n * @see https://datatracker.ietf.org/doc/html/rfc2616\n * @see https://bugs.chromium.org/p/chromium/issues/detail?id=398407\n * @param {string} protocol\n */\nfunction isValidSubprotocol (protocol) {\n  // If present, this value indicates one\n  // or more comma-separated subprotocol the client wishes to speak,\n  // ordered by preference.  The elements that comprise this value\n  // MUST be non-empty strings with characters in the range U+0021 to\n  // U+007E not including separator characters as defined in\n  // [RFC2616] and MUST all be unique strings.\n  if (protocol.length === 0) {\n    return false\n  }\n\n  for (const char of protocol) {\n    const code = char.charCodeAt(0)\n\n    if (\n      code < 0x21 ||\n      code > 0x7E ||\n      char === '(' ||\n      char === ')' ||\n      char === '<' ||\n      char === '>' ||\n      char === '@' ||\n      char === ',' ||\n      char === ';' ||\n      char === ':' ||\n      char === '\\\\' ||\n      char === '\"' ||\n      char === '/' ||\n      char === '[' ||\n      char === ']' ||\n      char === '?' ||\n      char === '=' ||\n      char === '{' ||\n      char === '}' ||\n      code === 32 || // SP\n      code === 9 // HT\n    ) {\n      return false\n    }\n  }\n\n  return true\n}\n\n/**\n * @see https://datatracker.ietf.org/doc/html/rfc6455#section-7-4\n * @param {number} code\n */\nfunction isValidStatusCode (code) {\n  if (code >= 1000 && code < 1015) {\n    return (\n      code !== 1004 && // reserved\n      code !== 1005 && // \"MUST NOT be set as a status code\"\n      code !== 1006 // \"MUST NOT be set as a status code\"\n    )\n  }\n\n  return code >= 3000 && code <= 4999\n}\n\n/**\n * @param {import('./websocket').WebSocket} ws\n * @param {string|undefined} reason\n */\nfunction failWebsocketConnection (ws, reason) {\n  const { [kController]: controller, [kResponse]: response } = ws\n\n  controller.abort()\n\n  if (response?.socket && !response.socket.destroyed) {\n    response.socket.destroy()\n  }\n\n  if (reason) {\n    fireEvent('error', ws, ErrorEvent, {\n      error: new Error(reason)\n    })\n  }\n}\n\nmodule.exports = {\n  isEstablished,\n  isClosing,\n  isClosed,\n  fireEvent,\n  isValidSubprotocol,\n  isValidStatusCode,\n  failWebsocketConnection,\n  websocketMessageReceived\n}\n","'use strict'\n\nconst diagnosticsChannel = require('diagnostics_channel')\nconst { uid, states } = require('./constants')\nconst {\n  kReadyState,\n  kSentClose,\n  kByteParser,\n  kReceivedClose\n} = require('./symbols')\nconst { fireEvent, failWebsocketConnection } = require('./util')\nconst { CloseEvent } = require('./events')\nconst { makeRequest } = require('../fetch/request')\nconst { fetching } = require('../fetch/index')\nconst { Headers } = require('../fetch/headers')\nconst { getGlobalDispatcher } = require('../global')\nconst { kHeadersList } = require('../core/symbols')\n\nconst channels = {}\nchannels.open = diagnosticsChannel.channel('undici:websocket:open')\nchannels.close = diagnosticsChannel.channel('undici:websocket:close')\nchannels.socketError = diagnosticsChannel.channel('undici:websocket:socket_error')\n\n/** @type {import('crypto')} */\nlet crypto\ntry {\n  crypto = require('crypto')\n} catch {\n\n}\n\n/**\n * @see https://websockets.spec.whatwg.org/#concept-websocket-establish\n * @param {URL} url\n * @param {string|string[]} protocols\n * @param {import('./websocket').WebSocket} ws\n * @param {(response: any) => void} onEstablish\n * @param {Partial<import('../../types/websocket').WebSocketInit>} options\n */\nfunction establishWebSocketConnection (url, protocols, ws, onEstablish, options) {\n  // 1. Let requestURL be a copy of url, with its scheme set to \"http\", if urlâ€™s\n  //    scheme is \"ws\", and to \"https\" otherwise.\n  const requestURL = url\n\n  requestURL.protocol = url.protocol === 'ws:' ? 'http:' : 'https:'\n\n  // 2. Let request be a new request, whose URL is requestURL, client is client,\n  //    service-workers mode is \"none\", referrer is \"no-referrer\", mode is\n  //    \"websocket\", credentials mode is \"include\", cache mode is \"no-store\" ,\n  //    and redirect mode is \"error\".\n  const request = makeRequest({\n    urlList: [requestURL],\n    serviceWorkers: 'none',\n    referrer: 'no-referrer',\n    mode: 'websocket',\n    credentials: 'include',\n    cache: 'no-store',\n    redirect: 'error'\n  })\n\n  // Note: undici extension, allow setting custom headers.\n  if (options.headers) {\n    const headersList = new Headers(options.headers)[kHeadersList]\n\n    request.headersList = headersList\n  }\n\n  // 3. Append (`Upgrade`, `websocket`) to requestâ€™s header list.\n  // 4. Append (`Connection`, `Upgrade`) to requestâ€™s header list.\n  // Note: both of these are handled by undici currently.\n  // https://github.com/nodejs/undici/blob/68c269c4144c446f3f1220951338daef4a6b5ec4/lib/client.js#L1397\n\n  // 5. Let keyValue be a nonce consisting of a randomly selected\n  //    16-byte value that has been forgiving-base64-encoded and\n  //    isomorphic encoded.\n  const keyValue = crypto.randomBytes(16).toString('base64')\n\n  // 6. Append (`Sec-WebSocket-Key`, keyValue) to requestâ€™s\n  //    header list.\n  request.headersList.append('sec-websocket-key', keyValue)\n\n  // 7. Append (`Sec-WebSocket-Version`, `13`) to requestâ€™s\n  //    header list.\n  request.headersList.append('sec-websocket-version', '13')\n\n  // 8. For each protocol in protocols, combine\n  //    (`Sec-WebSocket-Protocol`, protocol) in requestâ€™s header\n  //    list.\n  for (const protocol of protocols) {\n    request.headersList.append('sec-websocket-protocol', protocol)\n  }\n\n  // 9. Let permessageDeflate be a user-agent defined\n  //    \"permessage-deflate\" extension header value.\n  // https://github.com/mozilla/gecko-dev/blob/ce78234f5e653a5d3916813ff990f053510227bc/netwerk/protocol/websocket/WebSocketChannel.cpp#L2673\n  // TODO: enable once permessage-deflate is supported\n  const permessageDeflate = '' // 'permessage-deflate; 15'\n\n  // 10. Append (`Sec-WebSocket-Extensions`, permessageDeflate) to\n  //     requestâ€™s header list.\n  // request.headersList.append('sec-websocket-extensions', permessageDeflate)\n\n  // 11. Fetch request with useParallelQueue set to true, and\n  //     processResponse given response being these steps:\n  const controller = fetching({\n    request,\n    useParallelQueue: true,\n    dispatcher: options.dispatcher ?? getGlobalDispatcher(),\n    processResponse (response) {\n      // 1. If response is a network error or its status is not 101,\n      //    fail the WebSocket connection.\n      if (response.type === 'error' || response.status !== 101) {\n        failWebsocketConnection(ws, 'Received network error or non-101 status code.')\n        return\n      }\n\n      // 2. If protocols is not the empty list and extracting header\n      //    list values given `Sec-WebSocket-Protocol` and responseâ€™s\n      //    header list results in null, failure, or the empty byte\n      //    sequence, then fail the WebSocket connection.\n      if (protocols.length !== 0 && !response.headersList.get('Sec-WebSocket-Protocol')) {\n        failWebsocketConnection(ws, 'Server did not respond with sent protocols.')\n        return\n      }\n\n      // 3. Follow the requirements stated step 2 to step 6, inclusive,\n      //    of the last set of steps in section 4.1 of The WebSocket\n      //    Protocol to validate response. This either results in fail\n      //    the WebSocket connection or the WebSocket connection is\n      //    established.\n\n      // 2. If the response lacks an |Upgrade| header field or the |Upgrade|\n      //    header field contains a value that is not an ASCII case-\n      //    insensitive match for the value \"websocket\", the client MUST\n      //    _Fail the WebSocket Connection_.\n      if (response.headersList.get('Upgrade')?.toLowerCase() !== 'websocket') {\n        failWebsocketConnection(ws, 'Server did not set Upgrade header to \"websocket\".')\n        return\n      }\n\n      // 3. If the response lacks a |Connection| header field or the\n      //    |Connection| header field doesn't contain a token that is an\n      //    ASCII case-insensitive match for the value \"Upgrade\", the client\n      //    MUST _Fail the WebSocket Connection_.\n      if (response.headersList.get('Connection')?.toLowerCase() !== 'upgrade') {\n        failWebsocketConnection(ws, 'Server did not set Connection header to \"upgrade\".')\n        return\n      }\n\n      // 4. If the response lacks a |Sec-WebSocket-Accept| header field or\n      //    the |Sec-WebSocket-Accept| contains a value other than the\n      //    base64-encoded SHA-1 of the concatenation of the |Sec-WebSocket-\n      //    Key| (as a string, not base64-decoded) with the string \"258EAFA5-\n      //    E914-47DA-95CA-C5AB0DC85B11\" but ignoring any leading and\n      //    trailing whitespace, the client MUST _Fail the WebSocket\n      //    Connection_.\n      const secWSAccept = response.headersList.get('Sec-WebSocket-Accept')\n      const digest = crypto.createHash('sha1').update(keyValue + uid).digest('base64')\n      if (secWSAccept !== digest) {\n        failWebsocketConnection(ws, 'Incorrect hash received in Sec-WebSocket-Accept header.')\n        return\n      }\n\n      // 5. If the response includes a |Sec-WebSocket-Extensions| header\n      //    field and this header field indicates the use of an extension\n      //    that was not present in the client's handshake (the server has\n      //    indicated an extension not requested by the client), the client\n      //    MUST _Fail the WebSocket Connection_.  (The parsing of this\n      //    header field to determine which extensions are requested is\n      //    discussed in Section 9.1.)\n      const secExtension = response.headersList.get('Sec-WebSocket-Extensions')\n\n      if (secExtension !== null && secExtension !== permessageDeflate) {\n        failWebsocketConnection(ws, 'Received different permessage-deflate than the one set.')\n        return\n      }\n\n      // 6. If the response includes a |Sec-WebSocket-Protocol| header field\n      //    and this header field indicates the use of a subprotocol that was\n      //    not present in the client's handshake (the server has indicated a\n      //    subprotocol not requested by the client), the client MUST _Fail\n      //    the WebSocket Connection_.\n      const secProtocol = response.headersList.get('Sec-WebSocket-Protocol')\n\n      if (secProtocol !== null && secProtocol !== request.headersList.get('Sec-WebSocket-Protocol')) {\n        failWebsocketConnection(ws, 'Protocol was not set in the opening handshake.')\n        return\n      }\n\n      response.socket.on('data', onSocketData)\n      response.socket.on('close', onSocketClose)\n      response.socket.on('error', onSocketError)\n\n      if (channels.open.hasSubscribers) {\n        channels.open.publish({\n          address: response.socket.address(),\n          protocol: secProtocol,\n          extensions: secExtension\n        })\n      }\n\n      onEstablish(response)\n    }\n  })\n\n  return controller\n}\n\n/**\n * @param {Buffer} chunk\n */\nfunction onSocketData (chunk) {\n  if (!this.ws[kByteParser].write(chunk)) {\n    this.pause()\n  }\n}\n\n/**\n * @see https://websockets.spec.whatwg.org/#feedback-from-the-protocol\n * @see https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.4\n */\nfunction onSocketClose () {\n  const { ws } = this\n\n  // If the TCP connection was closed after the\n  // WebSocket closing handshake was completed, the WebSocket connection\n  // is said to have been closed _cleanly_.\n  const wasClean = ws[kSentClose] && ws[kReceivedClose]\n\n  let code = 1005\n  let reason = ''\n\n  const result = ws[kByteParser].closingInfo\n\n  if (result) {\n    code = result.code ?? 1005\n    reason = result.reason\n  } else if (!ws[kSentClose]) {\n    // If _The WebSocket\n    // Connection is Closed_ and no Close control frame was received by the\n    // endpoint (such as could occur if the underlying transport connection\n    // is lost), _The WebSocket Connection Close Code_ is considered to be\n    // 1006.\n    code = 1006\n  }\n\n  // 1. Change the ready state to CLOSED (3).\n  ws[kReadyState] = states.CLOSED\n\n  // 2. If the user agent was required to fail the WebSocket\n  //    connection, or if the WebSocket connection was closed\n  //    after being flagged as full, fire an event named error\n  //    at the WebSocket object.\n  // TODO\n\n  // 3. Fire an event named close at the WebSocket object,\n  //    using CloseEvent, with the wasClean attribute\n  //    initialized to true if the connection closed cleanly\n  //    and false otherwise, the code attribute initialized to\n  //    the WebSocket connection close code, and the reason\n  //    attribute initialized to the result of applying UTF-8\n  //    decode without BOM to the WebSocket connection close\n  //    reason.\n  fireEvent('close', ws, CloseEvent, {\n    wasClean, code, reason\n  })\n\n  if (channels.close.hasSubscribers) {\n    channels.close.publish({\n      websocket: ws,\n      code,\n      reason\n    })\n  }\n}\n\nfunction onSocketError (error) {\n  const { ws } = this\n\n  ws[kReadyState] = states.CLOSING\n\n  if (channels.socketError.hasSubscribers) {\n    channels.socketError.publish(error)\n  }\n\n  this.destroy()\n}\n\nmodule.exports = {\n  establishWebSocketConnection\n}\n","'use strict'\n\nconst { maxUnsigned16Bit } = require('./constants')\n\n/** @type {import('crypto')} */\nlet crypto\ntry {\n  crypto = require('crypto')\n} catch {\n\n}\n\nclass WebsocketFrameSend {\n  /**\n   * @param {Buffer|undefined} data\n   */\n  constructor (data) {\n    this.frameData = data\n    this.maskKey = crypto.randomBytes(4)\n  }\n\n  createFrame (opcode) {\n    const bodyLength = this.frameData?.byteLength ?? 0\n\n    /** @type {number} */\n    let payloadLength = bodyLength // 0-125\n    let offset = 6\n\n    if (bodyLength > maxUnsigned16Bit) {\n      offset += 8 // payload length is next 8 bytes\n      payloadLength = 127\n    } else if (bodyLength > 125) {\n      offset += 2 // payload length is next 2 bytes\n      payloadLength = 126\n    }\n\n    const buffer = Buffer.allocUnsafe(bodyLength + offset)\n\n    // Clear first 2 bytes, everything else is overwritten\n    buffer[0] = buffer[1] = 0\n    buffer[0] |= 0x80 // FIN\n    buffer[0] = (buffer[0] & 0xF0) + opcode // opcode\n\n    /*! ws. MIT License. Einar Otto Stangvik <einaros@gmail.com> */\n    buffer[offset - 4] = this.maskKey[0]\n    buffer[offset - 3] = this.maskKey[1]\n    buffer[offset - 2] = this.maskKey[2]\n    buffer[offset - 1] = this.maskKey[3]\n\n    buffer[1] = payloadLength\n\n    if (payloadLength === 126) {\n      buffer.writeUInt16BE(bodyLength, 2)\n    } else if (payloadLength === 127) {\n      // Clear extended payload length\n      buffer[2] = buffer[3] = 0\n      buffer.writeUIntBE(bodyLength, 4, 6)\n    }\n\n    buffer[1] |= 0x80 // MASK\n\n    // mask body\n    for (let i = 0; i < bodyLength; i++) {\n      buffer[offset + i] = this.frameData[i] ^ this.maskKey[i % 4]\n    }\n\n    return buffer\n  }\n}\n\nmodule.exports = {\n  WebsocketFrameSend\n}\n","'use strict'\n\nconst { Writable } = require('stream')\nconst diagnosticsChannel = require('diagnostics_channel')\nconst { parserStates, opcodes, states, emptyBuffer } = require('./constants')\nconst { kReadyState, kSentClose, kResponse, kReceivedClose } = require('./symbols')\nconst { isValidStatusCode, failWebsocketConnection, websocketMessageReceived } = require('./util')\nconst { WebsocketFrameSend } = require('./frame')\n\n// This code was influenced by ws released under the MIT license.\n// Copyright (c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n// Copyright (c) 2013 Arnout Kazemier and contributors\n// Copyright (c) 2016 Luigi Pinca and contributors\n\nconst channels = {}\nchannels.ping = diagnosticsChannel.channel('undici:websocket:ping')\nchannels.pong = diagnosticsChannel.channel('undici:websocket:pong')\n\nclass ByteParser extends Writable {\n  #buffers = []\n  #byteOffset = 0\n\n  #state = parserStates.INFO\n\n  #info = {}\n  #fragments = []\n\n  constructor (ws) {\n    super()\n\n    this.ws = ws\n  }\n\n  /**\n   * @param {Buffer} chunk\n   * @param {() => void} callback\n   */\n  _write (chunk, _, callback) {\n    this.#buffers.push(chunk)\n    this.#byteOffset += chunk.length\n\n    this.run(callback)\n  }\n\n  /**\n   * Runs whenever a new chunk is received.\n   * Callback is called whenever there are no more chunks buffering,\n   * or not enough bytes are buffered to parse.\n   */\n  run (callback) {\n    while (true) {\n      if (this.#state === parserStates.INFO) {\n        // If there aren't enough bytes to parse the payload length, etc.\n        if (this.#byteOffset < 2) {\n          return callback()\n        }\n\n        const buffer = this.consume(2)\n\n        this.#info.fin = (buffer[0] & 0x80) !== 0\n        this.#info.opcode = buffer[0] & 0x0F\n\n        // If we receive a fragmented message, we use the type of the first\n        // frame to parse the full message as binary/text, when it's terminated\n        this.#info.originalOpcode ??= this.#info.opcode\n\n        this.#info.fragmented = !this.#info.fin && this.#info.opcode !== opcodes.CONTINUATION\n\n        if (this.#info.fragmented && this.#info.opcode !== opcodes.BINARY && this.#info.opcode !== opcodes.TEXT) {\n          // Only text and binary frames can be fragmented\n          failWebsocketConnection(this.ws, 'Invalid frame type was fragmented.')\n          return\n        }\n\n        const payloadLength = buffer[1] & 0x7F\n\n        if (payloadLength <= 125) {\n          this.#info.payloadLength = payloadLength\n          this.#state = parserStates.READ_DATA\n        } else if (payloadLength === 126) {\n          this.#state = parserStates.PAYLOADLENGTH_16\n        } else if (payloadLength === 127) {\n          this.#state = parserStates.PAYLOADLENGTH_64\n        }\n\n        if (this.#info.fragmented && payloadLength > 125) {\n          // A fragmented frame can't be fragmented itself\n          failWebsocketConnection(this.ws, 'Fragmented frame exceeded 125 bytes.')\n          return\n        } else if (\n          (this.#info.opcode === opcodes.PING ||\n            this.#info.opcode === opcodes.PONG ||\n            this.#info.opcode === opcodes.CLOSE) &&\n          payloadLength > 125\n        ) {\n          // Control frames can have a payload length of 125 bytes MAX\n          failWebsocketConnection(this.ws, 'Payload length for control frame exceeded 125 bytes.')\n          return\n        } else if (this.#info.opcode === opcodes.CLOSE) {\n          if (payloadLength === 1) {\n            failWebsocketConnection(this.ws, 'Received close frame with a 1-byte body.')\n            return\n          }\n\n          const body = this.consume(payloadLength)\n\n          this.#info.closeInfo = this.parseCloseBody(false, body)\n\n          if (!this.ws[kSentClose]) {\n            // If an endpoint receives a Close frame and did not previously send a\n            // Close frame, the endpoint MUST send a Close frame in response.  (When\n            // sending a Close frame in response, the endpoint typically echos the\n            // status code it received.)\n            const body = Buffer.allocUnsafe(2)\n            body.writeUInt16BE(this.#info.closeInfo.code, 0)\n            const closeFrame = new WebsocketFrameSend(body)\n\n            this.ws[kResponse].socket.write(\n              closeFrame.createFrame(opcodes.CLOSE),\n              (err) => {\n                if (!err) {\n                  this.ws[kSentClose] = true\n                }\n              }\n            )\n          }\n\n          // Upon either sending or receiving a Close control frame, it is said\n          // that _The WebSocket Closing Handshake is Started_ and that the\n          // WebSocket connection is in the CLOSING state.\n          this.ws[kReadyState] = states.CLOSING\n          this.ws[kReceivedClose] = true\n\n          this.end()\n\n          return\n        } else if (this.#info.opcode === opcodes.PING) {\n          // Upon receipt of a Ping frame, an endpoint MUST send a Pong frame in\n          // response, unless it already received a Close frame.\n          // A Pong frame sent in response to a Ping frame must have identical\n          // \"Application data\"\n\n          const body = this.consume(payloadLength)\n\n          if (!this.ws[kReceivedClose]) {\n            const frame = new WebsocketFrameSend(body)\n\n            this.ws[kResponse].socket.write(frame.createFrame(opcodes.PONG))\n\n            if (channels.ping.hasSubscribers) {\n              channels.ping.publish({\n                payload: body\n              })\n            }\n          }\n\n          this.#state = parserStates.INFO\n\n          if (this.#byteOffset > 0) {\n            continue\n          } else {\n            callback()\n            return\n          }\n        } else if (this.#info.opcode === opcodes.PONG) {\n          // A Pong frame MAY be sent unsolicited.  This serves as a\n          // unidirectional heartbeat.  A response to an unsolicited Pong frame is\n          // not expected.\n\n          const body = this.consume(payloadLength)\n\n          if (channels.pong.hasSubscribers) {\n            channels.pong.publish({\n              payload: body\n            })\n          }\n\n          if (this.#byteOffset > 0) {\n            continue\n          } else {\n            callback()\n            return\n          }\n        }\n      } else if (this.#state === parserStates.PAYLOADLENGTH_16) {\n        if (this.#byteOffset < 2) {\n          return callback()\n        }\n\n        const buffer = this.consume(2)\n\n        this.#info.payloadLength = buffer.readUInt16BE(0)\n        this.#state = parserStates.READ_DATA\n      } else if (this.#state === parserStates.PAYLOADLENGTH_64) {\n        if (this.#byteOffset < 8) {\n          return callback()\n        }\n\n        const buffer = this.consume(8)\n        const upper = buffer.readUInt32BE(0)\n\n        // 2^31 is the maxinimum bytes an arraybuffer can contain\n        // on 32-bit systems. Although, on 64-bit systems, this is\n        // 2^53-1 bytes.\n        // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Errors/Invalid_array_length\n        // https://source.chromium.org/chromium/chromium/src/+/main:v8/src/common/globals.h;drc=1946212ac0100668f14eb9e2843bdd846e510a1e;bpv=1;bpt=1;l=1275\n        // https://source.chromium.org/chromium/chromium/src/+/main:v8/src/objects/js-array-buffer.h;l=34;drc=1946212ac0100668f14eb9e2843bdd846e510a1e\n        if (upper > 2 ** 31 - 1) {\n          failWebsocketConnection(this.ws, 'Received payload length > 2^31 bytes.')\n          return\n        }\n\n        const lower = buffer.readUInt32BE(4)\n\n        this.#info.payloadLength = (upper << 8) + lower\n        this.#state = parserStates.READ_DATA\n      } else if (this.#state === parserStates.READ_DATA) {\n        if (this.#byteOffset < this.#info.payloadLength) {\n          // If there is still more data in this chunk that needs to be read\n          return callback()\n        } else if (this.#byteOffset >= this.#info.payloadLength) {\n          // If the server sent multiple frames in a single chunk\n\n          const body = this.consume(this.#info.payloadLength)\n\n          this.#fragments.push(body)\n\n          // If the frame is unfragmented, or a fragmented frame was terminated,\n          // a message was received\n          if (!this.#info.fragmented || (this.#info.fin && this.#info.opcode === opcodes.CONTINUATION)) {\n            const fullMessage = Buffer.concat(this.#fragments)\n\n            websocketMessageReceived(this.ws, this.#info.originalOpcode, fullMessage)\n\n            this.#info = {}\n            this.#fragments.length = 0\n          }\n\n          this.#state = parserStates.INFO\n        }\n      }\n\n      if (this.#byteOffset > 0) {\n        continue\n      } else {\n        callback()\n        break\n      }\n    }\n  }\n\n  /**\n   * Take n bytes from the buffered Buffers\n   * @param {number} n\n   * @returns {Buffer|null}\n   */\n  consume (n) {\n    if (n > this.#byteOffset) {\n      return null\n    } else if (n === 0) {\n      return emptyBuffer\n    }\n\n    if (this.#buffers[0].length === n) {\n      this.#byteOffset -= this.#buffers[0].length\n      return this.#buffers.shift()\n    }\n\n    const buffer = Buffer.allocUnsafe(n)\n    let offset = 0\n\n    while (offset !== n) {\n      const next = this.#buffers[0]\n      const { length } = next\n\n      if (length + offset === n) {\n        buffer.set(this.#buffers.shift(), offset)\n        break\n      } else if (length + offset > n) {\n        buffer.set(next.subarray(0, n - offset), offset)\n        this.#buffers[0] = next.subarray(n - offset)\n        break\n      } else {\n        buffer.set(this.#buffers.shift(), offset)\n        offset += next.length\n      }\n    }\n\n    this.#byteOffset -= n\n\n    return buffer\n  }\n\n  parseCloseBody (onlyCode, data) {\n    // https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.5\n    /** @type {number|undefined} */\n    let code\n\n    if (data.length >= 2) {\n      // _The WebSocket Connection Close Code_ is\n      // defined as the status code (Section 7.4) contained in the first Close\n      // control frame received by the application\n      code = data.readUInt16BE(0)\n    }\n\n    if (onlyCode) {\n      if (!isValidStatusCode(code)) {\n        return null\n      }\n\n      return { code }\n    }\n\n    // https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.6\n    /** @type {Buffer} */\n    let reason = data.subarray(2)\n\n    // Remove BOM\n    if (reason[0] === 0xEF && reason[1] === 0xBB && reason[2] === 0xBF) {\n      reason = reason.subarray(3)\n    }\n\n    if (code !== undefined && !isValidStatusCode(code)) {\n      return null\n    }\n\n    try {\n      // TODO: optimize this\n      reason = new TextDecoder('utf-8', { fatal: true }).decode(reason)\n    } catch {\n      return null\n    }\n\n    return { code, reason }\n  }\n\n  get closingInfo () {\n    return this.#info.closeInfo\n  }\n}\n\nmodule.exports = {\n  ByteParser\n}\n","'use strict'\n\nconst { webidl } = require('../fetch/webidl')\nconst { DOMException } = require('../fetch/constants')\nconst { URLSerializer } = require('../fetch/dataURL')\nconst { getGlobalOrigin } = require('../fetch/global')\nconst { staticPropertyDescriptors, states, opcodes, emptyBuffer } = require('./constants')\nconst {\n  kWebSocketURL,\n  kReadyState,\n  kController,\n  kBinaryType,\n  kResponse,\n  kSentClose,\n  kByteParser\n} = require('./symbols')\nconst { isEstablished, isClosing, isValidSubprotocol, failWebsocketConnection, fireEvent } = require('./util')\nconst { establishWebSocketConnection } = require('./connection')\nconst { WebsocketFrameSend } = require('./frame')\nconst { ByteParser } = require('./receiver')\nconst { kEnumerableProperty, isBlobLike } = require('../core/util')\nconst { getGlobalDispatcher } = require('../global')\nconst { types } = require('util')\n\nlet experimentalWarned = false\n\n// https://websockets.spec.whatwg.org/#interface-definition\nclass WebSocket extends EventTarget {\n  #events = {\n    open: null,\n    error: null,\n    close: null,\n    message: null\n  }\n\n  #bufferedAmount = 0\n  #protocol = ''\n  #extensions = ''\n\n  /**\n   * @param {string} url\n   * @param {string|string[]} protocols\n   */\n  constructor (url, protocols = []) {\n    super()\n\n    webidl.argumentLengthCheck(arguments, 1, { header: 'WebSocket constructor' })\n\n    if (!experimentalWarned) {\n      experimentalWarned = true\n      process.emitWarning('WebSockets are experimental, expect them to change at any time.', {\n        code: 'UNDICI-WS'\n      })\n    }\n\n    const options = webidl.converters['DOMString or sequence<DOMString> or WebSocketInit'](protocols)\n\n    url = webidl.converters.USVString(url)\n    protocols = options.protocols\n\n    // 1. Let baseURL be this's relevant settings object's API base URL.\n    const baseURL = getGlobalOrigin()\n\n    // 1. Let urlRecord be the result of applying the URL parser to url with baseURL.\n    let urlRecord\n\n    try {\n      urlRecord = new URL(url, baseURL)\n    } catch (e) {\n      // 3. If urlRecord is failure, then throw a \"SyntaxError\" DOMException.\n      throw new DOMException(e, 'SyntaxError')\n    }\n\n    // 4. If urlRecordâ€™s scheme is \"http\", then set urlRecordâ€™s scheme to \"ws\".\n    if (urlRecord.protocol === 'http:') {\n      urlRecord.protocol = 'ws:'\n    } else if (urlRecord.protocol === 'https:') {\n      // 5. Otherwise, if urlRecordâ€™s scheme is \"https\", set urlRecordâ€™s scheme to \"wss\".\n      urlRecord.protocol = 'wss:'\n    }\n\n    // 6. If urlRecordâ€™s scheme is not \"ws\" or \"wss\", then throw a \"SyntaxError\" DOMException.\n    if (urlRecord.protocol !== 'ws:' && urlRecord.protocol !== 'wss:') {\n      throw new DOMException(\n        `Expected a ws: or wss: protocol, got ${urlRecord.protocol}`,\n        'SyntaxError'\n      )\n    }\n\n    // 7. If urlRecordâ€™s fragment is non-null, then throw a \"SyntaxError\"\n    //    DOMException.\n    if (urlRecord.hash || urlRecord.href.endsWith('#')) {\n      throw new DOMException('Got fragment', 'SyntaxError')\n    }\n\n    // 8. If protocols is a string, set protocols to a sequence consisting\n    //    of just that string.\n    if (typeof protocols === 'string') {\n      protocols = [protocols]\n    }\n\n    // 9. If any of the values in protocols occur more than once or otherwise\n    //    fail to match the requirements for elements that comprise the value\n    //    of `Sec-WebSocket-Protocol` fields as defined by The WebSocket\n    //    protocol, then throw a \"SyntaxError\" DOMException.\n    if (protocols.length !== new Set(protocols.map(p => p.toLowerCase())).size) {\n      throw new DOMException('Invalid Sec-WebSocket-Protocol value', 'SyntaxError')\n    }\n\n    if (protocols.length > 0 && !protocols.every(p => isValidSubprotocol(p))) {\n      throw new DOMException('Invalid Sec-WebSocket-Protocol value', 'SyntaxError')\n    }\n\n    // 10. Set this's url to urlRecord.\n    this[kWebSocketURL] = new URL(urlRecord.href)\n\n    // 11. Let client be this's relevant settings object.\n\n    // 12. Run this step in parallel:\n\n    //    1. Establish a WebSocket connection given urlRecord, protocols,\n    //       and client.\n    this[kController] = establishWebSocketConnection(\n      urlRecord,\n      protocols,\n      this,\n      (response) => this.#onConnectionEstablished(response),\n      options\n    )\n\n    // Each WebSocket object has an associated ready state, which is a\n    // number representing the state of the connection. Initially it must\n    // be CONNECTING (0).\n    this[kReadyState] = WebSocket.CONNECTING\n\n    // The extensions attribute must initially return the empty string.\n\n    // The protocol attribute must initially return the empty string.\n\n    // Each WebSocket object has an associated binary type, which is a\n    // BinaryType. Initially it must be \"blob\".\n    this[kBinaryType] = 'blob'\n  }\n\n  /**\n   * @see https://websockets.spec.whatwg.org/#dom-websocket-close\n   * @param {number|undefined} code\n   * @param {string|undefined} reason\n   */\n  close (code = undefined, reason = undefined) {\n    webidl.brandCheck(this, WebSocket)\n\n    if (code !== undefined) {\n      code = webidl.converters['unsigned short'](code, { clamp: true })\n    }\n\n    if (reason !== undefined) {\n      reason = webidl.converters.USVString(reason)\n    }\n\n    // 1. If code is present, but is neither an integer equal to 1000 nor an\n    //    integer in the range 3000 to 4999, inclusive, throw an\n    //    \"InvalidAccessError\" DOMException.\n    if (code !== undefined) {\n      if (code !== 1000 && (code < 3000 || code > 4999)) {\n        throw new DOMException('invalid code', 'InvalidAccessError')\n      }\n    }\n\n    let reasonByteLength = 0\n\n    // 2. If reason is present, then run these substeps:\n    if (reason !== undefined) {\n      // 1. Let reasonBytes be the result of encoding reason.\n      // 2. If reasonBytes is longer than 123 bytes, then throw a\n      //    \"SyntaxError\" DOMException.\n      reasonByteLength = Buffer.byteLength(reason)\n\n      if (reasonByteLength > 123) {\n        throw new DOMException(\n          `Reason must be less than 123 bytes; received ${reasonByteLength}`,\n          'SyntaxError'\n        )\n      }\n    }\n\n    // 3. Run the first matching steps from the following list:\n    if (this[kReadyState] === WebSocket.CLOSING || this[kReadyState] === WebSocket.CLOSED) {\n      // If this's ready state is CLOSING (2) or CLOSED (3)\n      // Do nothing.\n    } else if (!isEstablished(this)) {\n      // If the WebSocket connection is not yet established\n      // Fail the WebSocket connection and set this's ready state\n      // to CLOSING (2).\n      failWebsocketConnection(this, 'Connection was closed before it was established.')\n      this[kReadyState] = WebSocket.CLOSING\n    } else if (!isClosing(this)) {\n      // If the WebSocket closing handshake has not yet been started\n      // Start the WebSocket closing handshake and set this's ready\n      // state to CLOSING (2).\n      // - If neither code nor reason is present, the WebSocket Close\n      //   message must not have a body.\n      // - If code is present, then the status code to use in the\n      //   WebSocket Close message must be the integer given by code.\n      // - If reason is also present, then reasonBytes must be\n      //   provided in the Close message after the status code.\n\n      const frame = new WebsocketFrameSend()\n\n      // If neither code nor reason is present, the WebSocket Close\n      // message must not have a body.\n\n      // If code is present, then the status code to use in the\n      // WebSocket Close message must be the integer given by code.\n      if (code !== undefined && reason === undefined) {\n        frame.frameData = Buffer.allocUnsafe(2)\n        frame.frameData.writeUInt16BE(code, 0)\n      } else if (code !== undefined && reason !== undefined) {\n        // If reason is also present, then reasonBytes must be\n        // provided in the Close message after the status code.\n        frame.frameData = Buffer.allocUnsafe(2 + reasonByteLength)\n        frame.frameData.writeUInt16BE(code, 0)\n        // the body MAY contain UTF-8-encoded data with value /reason/\n        frame.frameData.write(reason, 2, 'utf-8')\n      } else {\n        frame.frameData = emptyBuffer\n      }\n\n      /** @type {import('stream').Duplex} */\n      const socket = this[kResponse].socket\n\n      socket.write(frame.createFrame(opcodes.CLOSE), (err) => {\n        if (!err) {\n          this[kSentClose] = true\n        }\n      })\n\n      // Upon either sending or receiving a Close control frame, it is said\n      // that _The WebSocket Closing Handshake is Started_ and that the\n      // WebSocket connection is in the CLOSING state.\n      this[kReadyState] = states.CLOSING\n    } else {\n      // Otherwise\n      // Set this's ready state to CLOSING (2).\n      this[kReadyState] = WebSocket.CLOSING\n    }\n  }\n\n  /**\n   * @see https://websockets.spec.whatwg.org/#dom-websocket-send\n   * @param {NodeJS.TypedArray|ArrayBuffer|Blob|string} data\n   */\n  send (data) {\n    webidl.brandCheck(this, WebSocket)\n\n    webidl.argumentLengthCheck(arguments, 1, { header: 'WebSocket.send' })\n\n    data = webidl.converters.WebSocketSendData(data)\n\n    // 1. If this's ready state is CONNECTING, then throw an\n    //    \"InvalidStateError\" DOMException.\n    if (this[kReadyState] === WebSocket.CONNECTING) {\n      throw new DOMException('Sent before connected.', 'InvalidStateError')\n    }\n\n    // 2. Run the appropriate set of steps from the following list:\n    // https://datatracker.ietf.org/doc/html/rfc6455#section-6.1\n    // https://datatracker.ietf.org/doc/html/rfc6455#section-5.2\n\n    if (!isEstablished(this) || isClosing(this)) {\n      return\n    }\n\n    /** @type {import('stream').Duplex} */\n    const socket = this[kResponse].socket\n\n    // If data is a string\n    if (typeof data === 'string') {\n      // If the WebSocket connection is established and the WebSocket\n      // closing handshake has not yet started, then the user agent\n      // must send a WebSocket Message comprised of the data argument\n      // using a text frame opcode; if the data cannot be sent, e.g.\n      // because it would need to be buffered but the buffer is full,\n      // the user agent must flag the WebSocket as full and then close\n      // the WebSocket connection. Any invocation of this method with a\n      // string argument that does not throw an exception must increase\n      // the bufferedAmount attribute by the number of bytes needed to\n      // express the argument as UTF-8.\n\n      const value = Buffer.from(data)\n      const frame = new WebsocketFrameSend(value)\n      const buffer = frame.createFrame(opcodes.TEXT)\n\n      this.#bufferedAmount += value.byteLength\n      socket.write(buffer, () => {\n        this.#bufferedAmount -= value.byteLength\n      })\n    } else if (types.isArrayBuffer(data)) {\n      // If the WebSocket connection is established, and the WebSocket\n      // closing handshake has not yet started, then the user agent must\n      // send a WebSocket Message comprised of data using a binary frame\n      // opcode; if the data cannot be sent, e.g. because it would need\n      // to be buffered but the buffer is full, the user agent must flag\n      // the WebSocket as full and then close the WebSocket connection.\n      // The data to be sent is the data stored in the buffer described\n      // by the ArrayBuffer object. Any invocation of this method with an\n      // ArrayBuffer argument that does not throw an exception must\n      // increase the bufferedAmount attribute by the length of the\n      // ArrayBuffer in bytes.\n\n      const value = Buffer.from(data)\n      const frame = new WebsocketFrameSend(value)\n      const buffer = frame.createFrame(opcodes.BINARY)\n\n      this.#bufferedAmount += value.byteLength\n      socket.write(buffer, () => {\n        this.#bufferedAmount -= value.byteLength\n      })\n    } else if (ArrayBuffer.isView(data)) {\n      // If the WebSocket connection is established, and the WebSocket\n      // closing handshake has not yet started, then the user agent must\n      // send a WebSocket Message comprised of data using a binary frame\n      // opcode; if the data cannot be sent, e.g. because it would need to\n      // be buffered but the buffer is full, the user agent must flag the\n      // WebSocket as full and then close the WebSocket connection. The\n      // data to be sent is the data stored in the section of the buffer\n      // described by the ArrayBuffer object that data references. Any\n      // invocation of this method with this kind of argument that does\n      // not throw an exception must increase the bufferedAmount attribute\n      // by the length of dataâ€™s buffer in bytes.\n\n      const ab = Buffer.from(data, data.byteOffset, data.byteLength)\n\n      const frame = new WebsocketFrameSend(ab)\n      const buffer = frame.createFrame(opcodes.BINARY)\n\n      this.#bufferedAmount += ab.byteLength\n      socket.write(buffer, () => {\n        this.#bufferedAmount -= ab.byteLength\n      })\n    } else if (isBlobLike(data)) {\n      // If the WebSocket connection is established, and the WebSocket\n      // closing handshake has not yet started, then the user agent must\n      // send a WebSocket Message comprised of data using a binary frame\n      // opcode; if the data cannot be sent, e.g. because it would need to\n      // be buffered but the buffer is full, the user agent must flag the\n      // WebSocket as full and then close the WebSocket connection. The data\n      // to be sent is the raw data represented by the Blob object. Any\n      // invocation of this method with a Blob argument that does not throw\n      // an exception must increase the bufferedAmount attribute by the size\n      // of the Blob objectâ€™s raw data, in bytes.\n\n      const frame = new WebsocketFrameSend()\n\n      data.arrayBuffer().then((ab) => {\n        const value = Buffer.from(ab)\n        frame.frameData = value\n        const buffer = frame.createFrame(opcodes.BINARY)\n\n        this.#bufferedAmount += value.byteLength\n        socket.write(buffer, () => {\n          this.#bufferedAmount -= value.byteLength\n        })\n      })\n    }\n  }\n\n  get readyState () {\n    webidl.brandCheck(this, WebSocket)\n\n    // The readyState getter steps are to return this's ready state.\n    return this[kReadyState]\n  }\n\n  get bufferedAmount () {\n    webidl.brandCheck(this, WebSocket)\n\n    return this.#bufferedAmount\n  }\n\n  get url () {\n    webidl.brandCheck(this, WebSocket)\n\n    // The url getter steps are to return this's url, serialized.\n    return URLSerializer(this[kWebSocketURL])\n  }\n\n  get extensions () {\n    webidl.brandCheck(this, WebSocket)\n\n    return this.#extensions\n  }\n\n  get protocol () {\n    webidl.brandCheck(this, WebSocket)\n\n    return this.#protocol\n  }\n\n  get onopen () {\n    webidl.brandCheck(this, WebSocket)\n\n    return this.#events.open\n  }\n\n  set onopen (fn) {\n    webidl.brandCheck(this, WebSocket)\n\n    if (this.#events.open) {\n      this.removeEventListener('open', this.#events.open)\n    }\n\n    if (typeof fn === 'function') {\n      this.#events.open = fn\n      this.addEventListener('open', fn)\n    } else {\n      this.#events.open = null\n    }\n  }\n\n  get onerror () {\n    webidl.brandCheck(this, WebSocket)\n\n    return this.#events.error\n  }\n\n  set onerror (fn) {\n    webidl.brandCheck(this, WebSocket)\n\n    if (this.#events.error) {\n      this.removeEventListener('error', this.#events.error)\n    }\n\n    if (typeof fn === 'function') {\n      this.#events.error = fn\n      this.addEventListener('error', fn)\n    } else {\n      this.#events.error = null\n    }\n  }\n\n  get onclose () {\n    webidl.brandCheck(this, WebSocket)\n\n    return this.#events.close\n  }\n\n  set onclose (fn) {\n    webidl.brandCheck(this, WebSocket)\n\n    if (this.#events.close) {\n      this.removeEventListener('close', this.#events.close)\n    }\n\n    if (typeof fn === 'function') {\n      this.#events.close = fn\n      this.addEventListener('close', fn)\n    } else {\n      this.#events.close = null\n    }\n  }\n\n  get onmessage () {\n    webidl.brandCheck(this, WebSocket)\n\n    return this.#events.message\n  }\n\n  set onmessage (fn) {\n    webidl.brandCheck(this, WebSocket)\n\n    if (this.#events.message) {\n      this.removeEventListener('message', this.#events.message)\n    }\n\n    if (typeof fn === 'function') {\n      this.#events.message = fn\n      this.addEventListener('message', fn)\n    } else {\n      this.#events.message = null\n    }\n  }\n\n  get binaryType () {\n    webidl.brandCheck(this, WebSocket)\n\n    return this[kBinaryType]\n  }\n\n  set binaryType (type) {\n    webidl.brandCheck(this, WebSocket)\n\n    if (type !== 'blob' && type !== 'arraybuffer') {\n      this[kBinaryType] = 'blob'\n    } else {\n      this[kBinaryType] = type\n    }\n  }\n\n  /**\n   * @see https://websockets.spec.whatwg.org/#feedback-from-the-protocol\n   */\n  #onConnectionEstablished (response) {\n    // processResponse is called when the \"responseâ€™s header list has been received and initialized.\"\n    // once this happens, the connection is open\n    this[kResponse] = response\n\n    const parser = new ByteParser(this)\n    parser.on('drain', function onParserDrain () {\n      this.ws[kResponse].socket.resume()\n    })\n\n    response.socket.ws = this\n    this[kByteParser] = parser\n\n    // 1. Change the ready state to OPEN (1).\n    this[kReadyState] = states.OPEN\n\n    // 2. Change the extensions attributeâ€™s value to the extensions in use, if\n    //    it is not the null value.\n    // https://datatracker.ietf.org/doc/html/rfc6455#section-9.1\n    const extensions = response.headersList.get('sec-websocket-extensions')\n\n    if (extensions !== null) {\n      this.#extensions = extensions\n    }\n\n    // 3. Change the protocol attributeâ€™s value to the subprotocol in use, if\n    //    it is not the null value.\n    // https://datatracker.ietf.org/doc/html/rfc6455#section-1.9\n    const protocol = response.headersList.get('sec-websocket-protocol')\n\n    if (protocol !== null) {\n      this.#protocol = protocol\n    }\n\n    // 4. Fire an event named open at the WebSocket object.\n    fireEvent('open', this)\n  }\n}\n\n// https://websockets.spec.whatwg.org/#dom-websocket-connecting\nWebSocket.CONNECTING = WebSocket.prototype.CONNECTING = states.CONNECTING\n// https://websockets.spec.whatwg.org/#dom-websocket-open\nWebSocket.OPEN = WebSocket.prototype.OPEN = states.OPEN\n// https://websockets.spec.whatwg.org/#dom-websocket-closing\nWebSocket.CLOSING = WebSocket.prototype.CLOSING = states.CLOSING\n// https://websockets.spec.whatwg.org/#dom-websocket-closed\nWebSocket.CLOSED = WebSocket.prototype.CLOSED = states.CLOSED\n\nObject.defineProperties(WebSocket.prototype, {\n  CONNECTING: staticPropertyDescriptors,\n  OPEN: staticPropertyDescriptors,\n  CLOSING: staticPropertyDescriptors,\n  CLOSED: staticPropertyDescriptors,\n  url: kEnumerableProperty,\n  readyState: kEnumerableProperty,\n  bufferedAmount: kEnumerableProperty,\n  onopen: kEnumerableProperty,\n  onerror: kEnumerableProperty,\n  onclose: kEnumerableProperty,\n  close: kEnumerableProperty,\n  onmessage: kEnumerableProperty,\n  binaryType: kEnumerableProperty,\n  send: kEnumerableProperty,\n  extensions: kEnumerableProperty,\n  protocol: kEnumerableProperty,\n  [Symbol.toStringTag]: {\n    value: 'WebSocket',\n    writable: false,\n    enumerable: false,\n    configurable: true\n  }\n})\n\nObject.defineProperties(WebSocket, {\n  CONNECTING: staticPropertyDescriptors,\n  OPEN: staticPropertyDescriptors,\n  CLOSING: staticPropertyDescriptors,\n  CLOSED: staticPropertyDescriptors\n})\n\nwebidl.converters['sequence<DOMString>'] = webidl.sequenceConverter(\n  webidl.converters.DOMString\n)\n\nwebidl.converters['DOMString or sequence<DOMString>'] = function (V) {\n  if (webidl.util.Type(V) === 'Object' && Symbol.iterator in V) {\n    return webidl.converters['sequence<DOMString>'](V)\n  }\n\n  return webidl.converters.DOMString(V)\n}\n\n// This implements the propsal made in https://github.com/whatwg/websockets/issues/42\nwebidl.converters.WebSocketInit = webidl.dictionaryConverter([\n  {\n    key: 'protocols',\n    converter: webidl.converters['DOMString or sequence<DOMString>'],\n    get defaultValue () {\n      return []\n    }\n  },\n  {\n    key: 'dispatcher',\n    converter: (V) => V,\n    get defaultValue () {\n      return getGlobalDispatcher()\n    }\n  },\n  {\n    key: 'headers',\n    converter: webidl.nullableConverter(webidl.converters.HeadersInit)\n  }\n])\n\nwebidl.converters['DOMString or sequence<DOMString> or WebSocketInit'] = function (V) {\n  if (webidl.util.Type(V) === 'Object' && !(Symbol.iterator in V)) {\n    return webidl.converters.WebSocketInit(V)\n  }\n\n  return { protocols: webidl.converters['DOMString or sequence<DOMString>'](V) }\n}\n\nwebidl.converters.WebSocketSendData = function (V) {\n  if (webidl.util.Type(V) === 'Object') {\n    if (isBlobLike(V)) {\n      return webidl.converters.Blob(V, { strict: false })\n    }\n\n    if (ArrayBuffer.isView(V) || types.isAnyArrayBuffer(V)) {\n      return webidl.converters.BufferSource(V)\n    }\n  }\n\n  return webidl.converters.USVString(V)\n}\n\nmodule.exports = {\n  WebSocket\n}\n","'use strict'\n\nconst Client = require('./lib/client')\nconst Dispatcher = require('./lib/dispatcher')\nconst errors = require('./lib/core/errors')\nconst Pool = require('./lib/pool')\nconst BalancedPool = require('./lib/balanced-pool')\nconst Agent = require('./lib/agent')\nconst util = require('./lib/core/util')\nconst { InvalidArgumentError } = errors\nconst api = require('./lib/api')\nconst buildConnector = require('./lib/core/connect')\nconst MockClient = require('./lib/mock/mock-client')\nconst MockAgent = require('./lib/mock/mock-agent')\nconst MockPool = require('./lib/mock/mock-pool')\nconst mockErrors = require('./lib/mock/mock-errors')\nconst ProxyAgent = require('./lib/proxy-agent')\nconst RetryHandler = require('./lib/handler/RetryHandler')\nconst { getGlobalDispatcher, setGlobalDispatcher } = require('./lib/global')\nconst DecoratorHandler = require('./lib/handler/DecoratorHandler')\nconst RedirectHandler = require('./lib/handler/RedirectHandler')\nconst createRedirectInterceptor = require('./lib/interceptor/redirectInterceptor')\n\nlet hasCrypto\ntry {\n  require('crypto')\n  hasCrypto = true\n} catch {\n  hasCrypto = false\n}\n\nObject.assign(Dispatcher.prototype, api)\n\nmodule.exports.Dispatcher = Dispatcher\nmodule.exports.Client = Client\nmodule.exports.Pool = Pool\nmodule.exports.BalancedPool = BalancedPool\nmodule.exports.Agent = Agent\nmodule.exports.ProxyAgent = ProxyAgent\nmodule.exports.RetryHandler = RetryHandler\n\nmodule.exports.DecoratorHandler = DecoratorHandler\nmodule.exports.RedirectHandler = RedirectHandler\nmodule.exports.createRedirectInterceptor = createRedirectInterceptor\n\nmodule.exports.buildConnector = buildConnector\nmodule.exports.errors = errors\n\nfunction makeDispatcher (fn) {\n  return (url, opts, handler) => {\n    if (typeof opts === 'function') {\n      handler = opts\n      opts = null\n    }\n\n    if (!url || (typeof url !== 'string' && typeof url !== 'object' && !(url instanceof URL))) {\n      throw new InvalidArgumentError('invalid url')\n    }\n\n    if (opts != null && typeof opts !== 'object') {\n      throw new InvalidArgumentError('invalid opts')\n    }\n\n    if (opts && opts.path != null) {\n      if (typeof opts.path !== 'string') {\n        throw new InvalidArgumentError('invalid opts.path')\n      }\n\n      let path = opts.path\n      if (!opts.path.startsWith('/')) {\n        path = `/${path}`\n      }\n\n      url = new URL(util.parseOrigin(url).origin + path)\n    } else {\n      if (!opts) {\n        opts = typeof url === 'object' ? url : {}\n      }\n\n      url = util.parseURL(url)\n    }\n\n    const { agent, dispatcher = getGlobalDispatcher() } = opts\n\n    if (agent) {\n      throw new InvalidArgumentError('unsupported opts.agent. Did you mean opts.client?')\n    }\n\n    return fn.call(dispatcher, {\n      ...opts,\n      origin: url.origin,\n      path: url.search ? `${url.pathname}${url.search}` : url.pathname,\n      method: opts.method || (opts.body ? 'PUT' : 'GET')\n    }, handler)\n  }\n}\n\nmodule.exports.setGlobalDispatcher = setGlobalDispatcher\nmodule.exports.getGlobalDispatcher = getGlobalDispatcher\n\nif (util.nodeMajor > 16 || (util.nodeMajor === 16 && util.nodeMinor >= 8)) {\n  let fetchImpl = null\n  module.exports.fetch = async function fetch (resource) {\n    if (!fetchImpl) {\n      fetchImpl = require('./lib/fetch').fetch\n    }\n\n    try {\n      return await fetchImpl(...arguments)\n    } catch (err) {\n      if (typeof err === 'object') {\n        Error.captureStackTrace(err, this)\n      }\n\n      throw err\n    }\n  }\n  module.exports.Headers = require('./lib/fetch/headers').Headers\n  module.exports.Response = require('./lib/fetch/response').Response\n  module.exports.Request = require('./lib/fetch/request').Request\n  module.exports.FormData = require('./lib/fetch/formdata').FormData\n  module.exports.File = require('./lib/fetch/file').File\n  module.exports.FileReader = require('./lib/fileapi/filereader').FileReader\n\n  const { setGlobalOrigin, getGlobalOrigin } = require('./lib/fetch/global')\n\n  module.exports.setGlobalOrigin = setGlobalOrigin\n  module.exports.getGlobalOrigin = getGlobalOrigin\n\n  const { CacheStorage } = require('./lib/cache/cachestorage')\n  const { kConstruct } = require('./lib/cache/symbols')\n\n  // Cache & CacheStorage are tightly coupled with fetch. Even if it may run\n  // in an older version of Node, it doesn't have any use without fetch.\n  module.exports.caches = new CacheStorage(kConstruct)\n}\n\nif (util.nodeMajor >= 16) {\n  const { deleteCookie, getCookies, getSetCookies, setCookie } = require('./lib/cookies')\n\n  module.exports.deleteCookie = deleteCookie\n  module.exports.getCookies = getCookies\n  module.exports.getSetCookies = getSetCookies\n  module.exports.setCookie = setCookie\n\n  const { parseMIMEType, serializeAMimeType } = require('./lib/fetch/dataURL')\n\n  module.exports.parseMIMEType = parseMIMEType\n  module.exports.serializeAMimeType = serializeAMimeType\n}\n\nif (util.nodeMajor >= 18 && hasCrypto) {\n  const { WebSocket } = require('./lib/websocket/websocket')\n\n  module.exports.WebSocket = WebSocket\n}\n\nmodule.exports.request = makeDispatcher(api.request)\nmodule.exports.stream = makeDispatcher(api.stream)\nmodule.exports.pipeline = makeDispatcher(api.pipeline)\nmodule.exports.connect = makeDispatcher(api.connect)\nmodule.exports.upgrade = makeDispatcher(api.upgrade)\n\nmodule.exports.MockClient = MockClient\nmodule.exports.MockPool = MockPool\nmodule.exports.MockAgent = MockAgent\nmodule.exports.mockErrors = mockErrors\n","import { CheckProvider, CheckProviderConfig } from './check-provider.interface';\nimport { PRInfo } from '../pr-analyzer';\nimport { ReviewSummary, ReviewIssue } from '../reviewer';\nimport { logger } from '../logger';\nimport { Liquid } from 'liquidjs';\nimport { createExtendedLiquid } from '../liquid-extensions';\nimport { Client } from '@modelcontextprotocol/sdk/client/index.js';\nimport { StdioClientTransport } from '@modelcontextprotocol/sdk/client/stdio.js';\nimport { SSEClientTransport } from '@modelcontextprotocol/sdk/client/sse.js';\nimport { StreamableHTTPClientTransport } from '@modelcontextprotocol/sdk/client/streamableHttp.js';\nimport Sandbox from '@nyariv/sandboxjs';\nimport { createSecureSandbox, compileAndRun } from '../utils/sandbox';\nimport { EnvironmentResolver } from '../utils/env-resolver';\nimport { CustomToolExecutor } from './custom-tool-executor';\nimport { CustomToolDefinition } from '../types/config';\nimport { Agent } from 'undici';\n\nconst parseTimeoutMs = (value: string | undefined, fallback: number): number => {\n  if (value === undefined || value === '') {\n    return fallback;\n  }\n  const parsed = Number(value);\n  if (Number.isNaN(parsed) || parsed < 0) {\n    return fallback;\n  }\n  return parsed;\n};\n\nconst parseRetryValue = (value: string | undefined, fallback: number): number => {\n  if (value === undefined || value === '') {\n    return fallback;\n  }\n  const parsed = Number(value);\n  if (Number.isNaN(parsed) || parsed < 0) {\n    return fallback;\n  }\n  return Math.floor(parsed);\n};\n\n// Create a custom fetch with longer timeouts for SSE connections\n// Default undici headers timeout is 30s which is too short for long-running MCP tools\nconst sseAgent = new Agent({\n  headersTimeout: parseTimeoutMs(process.env.VISOR_MCP_SSE_HEADERS_TIMEOUT_MS, 300000), // 5 minutes\n  bodyTimeout: parseTimeoutMs(process.env.VISOR_MCP_SSE_BODY_TIMEOUT_MS, 600000), // 10 minutes\n  keepAliveTimeout: parseTimeoutMs(process.env.VISOR_MCP_SSE_KEEP_ALIVE_TIMEOUT_MS, 600000), // 10 minutes\n});\n\nconst sseFetch: typeof fetch = (input, init) => {\n  return fetch(input, {\n    ...init,\n    // @ts-expect-error - dispatcher is a Node.js specific option\n    dispatcher: sseAgent,\n  });\n};\n\n/**\n * MCP Check Provider Configuration\n */\nexport interface McpCheckConfig extends CheckProviderConfig {\n  /** Transport type: stdio (default), sse (legacy), http (streamable HTTP), or custom (YAML-defined tools) */\n  transport?: 'stdio' | 'sse' | 'http' | 'custom';\n  /** Command to execute (for stdio transport) */\n  command?: string;\n  /** Command arguments (for stdio transport) */\n  args?: string[];\n  /** Environment variables (for stdio transport) */\n  env?: Record<string, string>;\n  /** Working directory (for stdio transport) */\n  workingDirectory?: string;\n  /** URL for SSE/HTTP transport */\n  url?: string;\n  /** HTTP headers (for SSE/HTTP transport) */\n  headers?: Record<string, string>;\n  /** Session ID for HTTP transport (optional, server may generate one) */\n  sessionId?: string;\n  /** MCP method/tool to call */\n  method: string;\n  /** Arguments to pass to the MCP method (supports Liquid templates) */\n  methodArgs?: Record<string, unknown>;\n  /** Transform template for method arguments (Liquid) */\n  argsTransform?: string;\n  /** Transform template for output (Liquid) */\n  transform?: string;\n  /** Transform using JavaScript expressions */\n  transform_js?: string;\n  /** Timeout in seconds */\n  timeout?: number;\n}\n\n/**\n * Check provider that calls MCP tools directly\n * Supports stdio, SSE (legacy), Streamable HTTP transports, and custom YAML-defined tools\n */\nexport class McpCheckProvider extends CheckProvider {\n  private liquid: Liquid;\n  private sandbox?: Sandbox;\n  private customToolExecutor?: CustomToolExecutor;\n\n  private isRetryableError(error: unknown): boolean {\n    const err = error as { message?: unknown; code?: unknown; cause?: unknown };\n    const message = typeof err?.message === 'string' ? err.message.toLowerCase() : '';\n    const code = typeof err?.code === 'string' ? err.code.toLowerCase() : '';\n    const cause = err?.cause as { message?: unknown; code?: unknown } | undefined;\n    const causeMessage = typeof cause?.message === 'string' ? cause.message.toLowerCase() : '';\n    const causeCode = typeof cause?.code === 'string' ? cause.code.toLowerCase() : '';\n\n    if (this.isTimeoutError(error)) {\n      return true;\n    }\n\n    const tokens = [\n      'fetch failed',\n      'econnreset',\n      'econnrefused',\n      'ehostunreach',\n      'enotfound',\n      'socket hang up',\n      'connection closed',\n      'connection terminated',\n    ];\n    return (\n      tokens.some(t => message.includes(t)) ||\n      tokens.some(t => causeMessage.includes(t)) ||\n      tokens.some(t => code.includes(t)) ||\n      tokens.some(t => causeCode.includes(t))\n    );\n  }\n\n  private isTimeoutError(error: unknown): boolean {\n    const err = error as { message?: unknown; code?: unknown; cause?: unknown };\n    const message = typeof err?.message === 'string' ? err.message.toLowerCase() : '';\n    const code = typeof err?.code === 'string' ? err.code.toLowerCase() : '';\n    const cause = err?.cause as { message?: unknown; code?: unknown } | undefined;\n    const causeMessage = typeof cause?.message === 'string' ? cause.message.toLowerCase() : '';\n    const causeCode = typeof cause?.code === 'string' ? cause.code.toLowerCase() : '';\n    return (\n      message.includes('timeout') ||\n      code.includes('timeout') ||\n      causeMessage.includes('timeout') ||\n      causeCode.includes('timeout')\n    );\n  }\n\n  private getTimeoutSeverity(): ReviewIssue['severity'] {\n    const raw = (process.env.VISOR_MCP_TIMEOUT_SEVERITY || '').trim().toLowerCase();\n    if (raw === 'info' || raw === 'warning' || raw === 'error' || raw === 'critical') {\n      return raw;\n    }\n    return 'error';\n  }\n\n  constructor() {\n    super();\n    this.liquid = createExtendedLiquid({\n      cache: false,\n      strictFilters: false,\n      strictVariables: false,\n    });\n  }\n\n  /**\n   * Set custom tools for this provider\n   */\n  setCustomTools(tools: Record<string, CustomToolDefinition>): void {\n    if (!this.customToolExecutor) {\n      this.customToolExecutor = new CustomToolExecutor(tools);\n    } else {\n      this.customToolExecutor.registerTools(tools);\n    }\n  }\n\n  /**\n   * Create a secure sandbox for JavaScript execution\n   * - Uses Sandbox.SAFE_GLOBALS which excludes: Function, eval, require, process, etc.\n   * - Only allows explicitly whitelisted prototype methods\n   * - No access to filesystem, network, or system resources\n   */\n  private createSecureSandbox(): Sandbox {\n    return createSecureSandbox();\n  }\n\n  getName(): string {\n    return 'mcp';\n  }\n\n  getDescription(): string {\n    return 'Call MCP tools directly using stdio, SSE, HTTP, or custom YAML-defined tools';\n  }\n\n  async validateConfig(config: unknown): Promise<boolean> {\n    if (!config || typeof config !== 'object') {\n      return false;\n    }\n\n    const cfg = config as McpCheckConfig;\n\n    // Method is required\n    if (!cfg.method || typeof cfg.method !== 'string') {\n      logger.error('MCP check requires a method name');\n      return false;\n    }\n\n    const transport = cfg.transport || 'stdio';\n\n    // Validate transport-specific requirements\n    if (transport === 'stdio') {\n      if (!cfg.command || typeof cfg.command !== 'string') {\n        logger.error('MCP stdio transport requires a command');\n        return false;\n      }\n\n      // Basic command injection prevention - check for shell metacharacters\n      // Allow common safe commands like 'npx', 'node', 'python', etc.\n      if (/[;&|`$(){}[\\]]/.test(cfg.command)) {\n        logger.error('MCP stdio command contains potentially unsafe characters');\n        return false;\n      }\n    } else if (transport === 'sse' || transport === 'http') {\n      if (!cfg.url || typeof cfg.url !== 'string') {\n        logger.error(`MCP ${transport} transport requires a URL`);\n        return false;\n      }\n\n      // Validate URL format\n      try {\n        const parsedUrl = new URL(cfg.url);\n        // Only allow http and https protocols\n        if (parsedUrl.protocol !== 'http:' && parsedUrl.protocol !== 'https:') {\n          logger.error(\n            `Invalid URL protocol for MCP ${transport} transport: ${parsedUrl.protocol}. Only http: and https: are allowed.`\n          );\n          return false;\n        }\n      } catch {\n        logger.error(`Invalid URL format for MCP ${transport} transport: ${cfg.url}`);\n        return false;\n      }\n    } else if (transport === 'custom') {\n      // For custom transport, validation is delegated to CustomToolExecutor\n      // The tool must exist in the configuration's tools section\n      // This will be validated at execution time when the tool is looked up\n      logger.debug(`MCP custom transport will validate tool '${cfg.method}' at execution time`);\n    } else {\n      logger.error(\n        `Invalid MCP transport: ${transport}. Must be 'stdio', 'sse', 'http', or 'custom'`\n      );\n      return false;\n    }\n\n    return true;\n  }\n\n  async execute(\n    prInfo: PRInfo,\n    config: CheckProviderConfig,\n    dependencyResults?: Map<string, ReviewSummary>,\n    sessionInfo?: any\n  ): Promise<ReviewSummary> {\n    const cfg = config as McpCheckConfig;\n\n    // Policy engine: MCP method filtering\n    const policyEngine = (sessionInfo as any)?._parentContext?.policyEngine;\n    if (policyEngine && cfg.method) {\n      try {\n        const serverName = (config as any).checkName || cfg.server || 'unknown';\n        const decision = await policyEngine.evaluateToolInvocation(\n          serverName,\n          cfg.method,\n          cfg.transport\n        );\n        if (!decision.allowed) {\n          return {\n            issues: [\n              {\n                file: 'mcp',\n                line: 0,\n                ruleId: 'policy/tool_denied',\n                message: `MCP method '${cfg.method}' blocked by policy: ${decision.reason || 'denied'}`,\n                severity: 'error',\n                category: 'security',\n              },\n            ],\n          };\n        }\n      } catch (err) {\n        // Policy evaluation failed â€” continue without filtering\n        try {\n          const { logger } = require('../logger');\n          logger.warn(\n            `[PolicyEngine] Tool invocation evaluation failed: ${err instanceof Error ? err.message : err}`\n          );\n        } catch {}\n      }\n    }\n\n    try {\n      // Prepare template context\n      const templateContext = {\n        pr: {\n          number: prInfo.number,\n          title: prInfo.title,\n          author: prInfo.author,\n          branch: prInfo.head,\n          base: prInfo.base,\n        },\n        files: prInfo.files,\n        fileCount: prInfo.files.length,\n        outputs: this.buildOutputContext(dependencyResults),\n        args: sessionInfo?.args || {},\n        env: this.getSafeEnvironmentVariables(),\n      };\n\n      // Render method arguments if needed\n      let methodArgs = cfg.methodArgs || {};\n      if (cfg.argsTransform) {\n        const rendered = await this.liquid.parseAndRender(cfg.argsTransform, templateContext);\n        try {\n          methodArgs = JSON.parse(rendered);\n        } catch (error) {\n          logger.error(`Failed to parse argsTransform as JSON: ${error}`);\n          return {\n            issues: [\n              {\n                file: 'mcp',\n                line: 0,\n                ruleId: 'mcp/args_transform_error',\n                message: `Failed to parse argsTransform: ${error instanceof Error ? error.message : 'Unknown error'}`,\n                severity: 'error',\n                category: 'logic',\n              },\n            ],\n          };\n        }\n      }\n\n      // Create MCP client and execute method\n      const result = await this.executeMcpMethod(cfg, methodArgs, prInfo, dependencyResults);\n\n      // Apply transforms if specified\n      let finalOutput = result;\n\n      // Apply Liquid transform\n      if (cfg.transform) {\n        try {\n          const transformContext = {\n            ...templateContext,\n            output: result,\n          };\n          const rendered = await this.liquid.parseAndRender(cfg.transform, transformContext);\n          try {\n            finalOutput = JSON.parse(rendered.trim());\n          } catch {\n            finalOutput = rendered.trim();\n          }\n        } catch (error) {\n          logger.error(`Failed to apply Liquid transform: ${error}`);\n          return {\n            issues: [\n              {\n                file: 'mcp',\n                line: 0,\n                ruleId: 'mcp/transform_error',\n                message: `Failed to apply transform: ${error instanceof Error ? error.message : 'Unknown error'}`,\n                severity: 'error',\n                category: 'logic',\n              },\n            ],\n          };\n        }\n      }\n\n      // Apply JavaScript transform using secure sandbox\n      if (cfg.transform_js) {\n        try {\n          this.sandbox = this.createSecureSandbox();\n\n          // Build scope with all context variables\n          const scope = {\n            output: finalOutput,\n            pr: templateContext.pr,\n            files: templateContext.files,\n            outputs: templateContext.outputs,\n            env: templateContext.env,\n          };\n\n          // Compile and execute the transform in sandboxed environment\n          finalOutput = compileAndRun<unknown>(\n            this.sandbox,\n            `return (${cfg.transform_js});`,\n            scope,\n            { injectLog: true, wrapFunction: false, logPrefix: '[mcp:transform_js]' }\n          );\n        } catch (error) {\n          logger.error(`Failed to apply JavaScript transform: ${error}`);\n          return {\n            issues: [\n              {\n                file: 'mcp',\n                line: 0,\n                ruleId: 'mcp/transform_js_error',\n                message: `Failed to apply JavaScript transform: ${error instanceof Error ? error.message : 'Unknown error'}`,\n                severity: 'error',\n                category: 'logic',\n              },\n            ],\n          };\n        }\n      }\n\n      // Extract issues from output\n      const extracted = this.extractIssuesFromOutput(finalOutput);\n      if (extracted) {\n        return {\n          issues: extracted.issues,\n          ...(extracted.remainingOutput ? { output: extracted.remainingOutput } : {}),\n        } as ReviewSummary;\n      }\n\n      // Return output directly\n      return {\n        issues: [],\n        ...(finalOutput ? { output: finalOutput } : {}),\n      } as ReviewSummary;\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      const isTimeout = this.isTimeoutError(error);\n      const timeoutSeverity = this.getTimeoutSeverity();\n      const severity: ReviewIssue['severity'] = isTimeout ? timeoutSeverity : 'error';\n      const ruleId = isTimeout ? 'mcp/timeout' : 'mcp/execution_error';\n\n      if (isTimeout && severity !== 'error' && severity !== 'critical') {\n        logger.warn(`MCP check timed out (non-fatal): ${errorMessage}`);\n      } else {\n        logger.error(`MCP check failed: ${errorMessage}`);\n      }\n\n      return {\n        issues: [\n          {\n            file: 'mcp',\n            line: 0,\n            ruleId,\n            message: isTimeout\n              ? `MCP check timed out: ${errorMessage}`\n              : `MCP check failed: ${errorMessage}`,\n            severity,\n            category: 'logic',\n          },\n        ],\n      };\n    }\n  }\n\n  /**\n   * Execute an MCP method using the configured transport\n   */\n  private async executeMcpMethod(\n    config: McpCheckConfig,\n    methodArgs: Record<string, unknown>,\n    prInfo?: PRInfo,\n    dependencyResults?: Map<string, ReviewSummary>\n  ): Promise<unknown> {\n    const transport = config.transport || 'stdio';\n    const timeout = (config.timeout || 60) * 1000; // Convert to milliseconds\n\n    if (transport === 'custom') {\n      // Execute custom YAML-defined tool\n      if (!this.customToolExecutor) {\n        throw new Error(\n          'No custom tools available. Define tools in the \"tools\" section of your configuration.'\n        );\n      }\n\n      const tool = this.customToolExecutor.getTool(config.method);\n      if (!tool) {\n        throw new Error(\n          `Custom tool not found: ${config.method}. Available tools: ${this.customToolExecutor\n            .getTools()\n            .map(t => t.name)\n            .join(', ')}`\n        );\n      }\n\n      // Build context for custom tool execution\n      const context = {\n        pr: prInfo\n          ? {\n              number: prInfo.number,\n              title: prInfo.title,\n              author: prInfo.author,\n              branch: prInfo.head,\n              base: prInfo.base,\n            }\n          : undefined,\n        files: prInfo?.files,\n        outputs: this.buildOutputContext(dependencyResults),\n        env: this.getSafeEnvironmentVariables(),\n      };\n\n      return await this.customToolExecutor.execute(config.method, methodArgs, context);\n    } else if (transport === 'stdio') {\n      return await this.executeStdioMethod(config, methodArgs, timeout);\n    } else if (transport === 'sse') {\n      return await this.executeSseMethod(config, methodArgs, timeout);\n    } else if (transport === 'http') {\n      return await this.executeHttpMethod(config, methodArgs, timeout);\n    } else {\n      throw new Error(`Unsupported transport: ${transport}`);\n    }\n  }\n\n  /**\n   * Generic method to execute MCP method with any transport\n   */\n  private async executeWithTransport(\n    createTransport: () =>\n      | StdioClientTransport\n      | SSEClientTransport\n      | StreamableHTTPClientTransport,\n    config: McpCheckConfig,\n    methodArgs: Record<string, unknown>,\n    timeout: number,\n    transportName: string\n  ): Promise<unknown> {\n    const maxRetries = parseRetryValue(process.env.VISOR_MCP_RETRY_COUNT, 0);\n    const baseDelayMs = parseRetryValue(process.env.VISOR_MCP_RETRY_DELAY_MS, 1000);\n    const backoffMs = parseRetryValue(process.env.VISOR_MCP_RETRY_BACKOFF_MS, 0);\n\n    let attempt = 0;\n    while (true) {\n      const client = new Client(\n        {\n          name: 'visor-mcp-client',\n          version: '1.0.0',\n        },\n        {\n          capabilities: {},\n        }\n      );\n\n      const transport = createTransport();\n\n      try {\n        // Connect with timeout\n        let timeoutId: NodeJS.Timeout | undefined;\n        try {\n          await Promise.race([\n            client.connect(transport),\n            new Promise((_, reject) => {\n              timeoutId = setTimeout(() => reject(new Error('Connection timeout')), timeout);\n            }),\n          ]);\n        } finally {\n          if (timeoutId) {\n            clearTimeout(timeoutId);\n          }\n        }\n\n        logger.debug(`Connected to MCP server via ${transportName}`);\n\n        // Log session ID for HTTP transport\n        if (transport instanceof StreamableHTTPClientTransport && transport.sessionId) {\n          logger.debug(`MCP Session ID: ${transport.sessionId}`);\n        }\n\n        // List available tools (for debugging)\n        try {\n          const toolsResult = await client.listTools();\n          logger.debug(`Available MCP tools: ${JSON.stringify(toolsResult?.tools || [])}`);\n        } catch (error) {\n          logger.debug(`Could not list MCP tools: ${error}`);\n        }\n\n        // Call the tool with timeout\n        let callTimeoutId: NodeJS.Timeout | undefined;\n        try {\n          const result = await Promise.race([\n            client.callTool({\n              name: config.method,\n              arguments: methodArgs,\n            }),\n            new Promise((_, reject) => {\n              callTimeoutId = setTimeout(() => reject(new Error('Request timeout')), timeout);\n            }),\n          ]);\n\n          logger.debug(`MCP method result: ${JSON.stringify(result)}`);\n          return result;\n        } finally {\n          if (callTimeoutId) {\n            clearTimeout(callTimeoutId);\n          }\n        }\n      } catch (error) {\n        const retryable = this.isRetryableError(error);\n        if (!retryable || attempt >= maxRetries) {\n          throw error;\n        }\n        const delay = baseDelayMs + backoffMs * attempt;\n        logger.warn(\n          `MCP ${transportName} failed (attempt ${attempt + 1}/${maxRetries + 1}), retrying in ${delay}ms: ${\n            error instanceof Error ? error.message : String(error)\n          }`\n        );\n        await new Promise(resolve => setTimeout(resolve, delay));\n        attempt += 1;\n      } finally {\n        try {\n          await client.close();\n        } catch (error) {\n          logger.debug(`Error closing MCP client: ${error}`);\n        }\n      }\n    }\n  }\n\n  /**\n   * Execute MCP method using stdio transport\n   */\n  private async executeStdioMethod(\n    config: McpCheckConfig,\n    methodArgs: Record<string, unknown>,\n    timeout: number\n  ): Promise<unknown> {\n    return this.executeWithTransport(\n      () =>\n        new StdioClientTransport({\n          command: config.command!,\n          args: config.command_args as string[] | undefined,\n          env: config.env,\n          cwd: config.workingDirectory,\n          stderr: 'pipe', // Prevent child stderr from corrupting TUI\n        }),\n      config,\n      methodArgs,\n      timeout,\n      `stdio: ${config.command}`\n    );\n  }\n\n  /**\n   * Execute MCP method using SSE transport\n   */\n  private async executeSseMethod(\n    config: McpCheckConfig,\n    methodArgs: Record<string, unknown>,\n    timeout: number\n  ): Promise<unknown> {\n    const requestInit: RequestInit = {};\n    if (config.headers) {\n      requestInit.headers = EnvironmentResolver.resolveHeaders(config.headers);\n    }\n\n    return this.executeWithTransport(\n      () =>\n        new SSEClientTransport(new URL(config.url!), {\n          requestInit,\n          fetch: sseFetch, // Use custom fetch with longer timeouts\n        }),\n      config,\n      methodArgs,\n      timeout,\n      `SSE: ${config.url}`\n    );\n  }\n\n  /**\n   * Execute MCP method using Streamable HTTP transport\n   */\n  private async executeHttpMethod(\n    config: McpCheckConfig,\n    methodArgs: Record<string, unknown>,\n    timeout: number\n  ): Promise<unknown> {\n    const requestInit: RequestInit = {};\n    if (config.headers) {\n      requestInit.headers = EnvironmentResolver.resolveHeaders(config.headers);\n    }\n\n    return this.executeWithTransport(\n      () =>\n        new StreamableHTTPClientTransport(new URL(config.url!), {\n          requestInit,\n          sessionId: config.sessionId,\n          fetch: sseFetch, // Use custom fetch with longer timeouts\n        }),\n      config,\n      methodArgs,\n      timeout,\n      `Streamable HTTP: ${config.url}`\n    );\n  }\n\n  /**\n   * Build output context from dependency results\n   */\n  private buildOutputContext(\n    dependencyResults?: Map<string, ReviewSummary>\n  ): Record<string, unknown> {\n    if (!dependencyResults) {\n      return {};\n    }\n\n    const outputs: Record<string, unknown> = {};\n    for (const [checkName, result] of dependencyResults) {\n      const summary = result as ReviewSummary & { output?: unknown };\n      outputs[checkName] = summary.output !== undefined ? summary.output : summary;\n    }\n\n    return outputs;\n  }\n\n  /**\n   * Get safe environment variables\n   */\n  private getSafeEnvironmentVariables(): Record<string, string> {\n    const safeVars: Record<string, string> = {};\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    const allowedPrefixes: string[] = []; // replaced by buildSandboxEnv\n\n    const { buildSandboxEnv } = require('../utils/env-exposure');\n    const merged = buildSandboxEnv(process.env);\n    for (const [key, value] of Object.entries(merged)) {\n      safeVars[key] = String(value);\n    }\n    safeVars['PWD'] = process.cwd();\n    return safeVars;\n  }\n\n  /**\n   * Extract issues from MCP output\n   */\n  private extractIssuesFromOutput(\n    output: unknown\n  ): { issues: ReviewIssue[]; remainingOutput: unknown } | null {\n    if (output === null || output === undefined) {\n      return null;\n    }\n\n    // If output is a string, try to parse as JSON\n    if (typeof output === 'string') {\n      try {\n        const parsed = JSON.parse(output);\n        return this.extractIssuesFromOutput(parsed);\n      } catch {\n        return null;\n      }\n    }\n\n    // If output is an array of issues\n    if (Array.isArray(output)) {\n      const issues = this.normalizeIssueArray(output);\n      if (issues) {\n        return { issues, remainingOutput: undefined };\n      }\n      return null;\n    }\n\n    // If output is an object with issues property\n    if (typeof output === 'object') {\n      const record = output as Record<string, unknown>;\n\n      if (Array.isArray(record.issues)) {\n        const issues = this.normalizeIssueArray(record.issues);\n        if (!issues) {\n          return null;\n        }\n\n        const remaining = { ...record };\n        delete (remaining as { issues?: unknown }).issues;\n\n        return {\n          issues,\n          remainingOutput: Object.keys(remaining).length > 0 ? remaining : undefined,\n        };\n      }\n\n      // Check if output itself is a single issue\n      const singleIssue = this.normalizeIssue(record);\n      if (singleIssue) {\n        return { issues: [singleIssue], remainingOutput: undefined };\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Normalize an array of issues\n   */\n  private normalizeIssueArray(values: unknown[]): ReviewIssue[] | null {\n    const normalized: ReviewIssue[] = [];\n\n    for (const value of values) {\n      const issue = this.normalizeIssue(value);\n      if (!issue) {\n        return null;\n      }\n      normalized.push(issue);\n    }\n\n    return normalized;\n  }\n\n  /**\n   * Normalize a single issue\n   */\n  private normalizeIssue(raw: unknown): ReviewIssue | null {\n    if (!raw || typeof raw !== 'object') {\n      return null;\n    }\n\n    const data = raw as Record<string, unknown>;\n\n    const message = this.toTrimmedString(\n      data.message || data.text || data.description || data.summary\n    );\n    if (!message) {\n      return null;\n    }\n\n    const allowedSeverities = new Set(['info', 'warning', 'error', 'critical']);\n    const severityRaw = this.toTrimmedString(data.severity || data.level || data.priority);\n    let severity: ReviewIssue['severity'] = 'warning';\n    if (severityRaw) {\n      const lower = severityRaw.toLowerCase();\n      if (allowedSeverities.has(lower)) {\n        severity = lower as ReviewIssue['severity'];\n      }\n    }\n\n    const allowedCategories = new Set([\n      'security',\n      'performance',\n      'style',\n      'logic',\n      'documentation',\n    ]);\n    const categoryRaw = this.toTrimmedString(data.category || data.type || data.group);\n    let category: ReviewIssue['category'] = 'logic';\n    if (categoryRaw && allowedCategories.has(categoryRaw.toLowerCase())) {\n      category = categoryRaw.toLowerCase() as ReviewIssue['category'];\n    }\n\n    const file = this.toTrimmedString(data.file || data.path || data.filename) || 'system';\n    const line = this.toNumber(data.line || data.startLine || data.lineNumber) ?? 0;\n    const endLine = this.toNumber(data.endLine || data.end_line || data.stopLine);\n    const suggestion = this.toTrimmedString(data.suggestion);\n    const replacement = this.toTrimmedString(data.replacement);\n    const ruleId = this.toTrimmedString(data.ruleId || data.rule || data.id || data.check) || 'mcp';\n\n    return {\n      file,\n      line,\n      endLine: endLine ?? undefined,\n      ruleId,\n      message,\n      severity,\n      category,\n      suggestion: suggestion || undefined,\n      replacement: replacement || undefined,\n    };\n  }\n\n  private toTrimmedString(value: unknown): string | null {\n    if (typeof value === 'string') {\n      const trimmed = value.trim();\n      return trimmed.length > 0 ? trimmed : null;\n    }\n    if (value !== null && value !== undefined && typeof value.toString === 'function') {\n      const converted = String(value).trim();\n      return converted.length > 0 ? converted : null;\n    }\n    return null;\n  }\n\n  private toNumber(value: unknown): number | null {\n    if (value === null || value === undefined) {\n      return null;\n    }\n    const num = Number(value);\n    if (Number.isFinite(num)) {\n      return Math.trunc(num);\n    }\n    return null;\n  }\n\n  getSupportedConfigKeys(): string[] {\n    return [\n      'type',\n      'transport',\n      'command',\n      'command_args',\n      'env',\n      'workingDirectory',\n      'url',\n      'headers',\n      'sessionId',\n      'method',\n      'methodArgs',\n      'argsTransform',\n      'transform',\n      'transform_js',\n      'timeout',\n      'depends_on',\n      'on',\n      'if',\n      'group',\n    ];\n  }\n\n  async isAvailable(): Promise<boolean> {\n    // MCP SDK is now a required dependency, so always available\n    return true;\n  }\n\n  getRequirements(): string[] {\n    return ['MCP method name specified', 'Transport configuration (stdio: command, sse/http: url)'];\n  }\n}\n","/**\n * Interactive terminal prompting (minimal TTY UI)\n */\n\nimport * as readline from 'readline';\n\n// Global, process-wide guard to ensure we never open two readline prompts at once.\n// This is crucial because the engine may (due to routing) attempt to schedule\n// a second human-input step while the first is still waiting. Two concurrent\n// readline instances on the same TTY cause duplicated keystrokes and other\n// erratic behavior. We serialize prompts with a tiny async mutex.\nlet activePrompt = false;\nconst waiters: Array<() => void> = [];\n\nasync function acquirePromptLock(): Promise<void> {\n  if (!activePrompt) {\n    activePrompt = true;\n    return;\n  }\n  await new Promise<void>(resolve => waiters.push(resolve));\n  activePrompt = true;\n}\n\nfunction releasePromptLock(): void {\n  activePrompt = false;\n  const next = waiters.shift();\n  if (next) next();\n}\n\nexport interface PromptOptions {\n  /** The prompt text to display */\n  prompt: string;\n  /** Placeholder text (shown in dim color) */\n  placeholder?: string;\n  /** Allow multiline input (Ctrl+D to finish) */\n  multiline?: boolean;\n  /** Timeout in milliseconds */\n  timeout?: number;\n  /** Default value if timeout occurs */\n  defaultValue?: string;\n  /** Allow empty input */\n  allowEmpty?: boolean;\n}\n/**\n * Prompt user for input with a beautiful interactive UI\n */\nexport async function interactivePrompt(options: PromptOptions): Promise<string> {\n  await acquirePromptLock();\n  return new Promise((resolve, reject) => {\n    const dbg = process.env.VISOR_DEBUG === 'true';\n    try {\n      if (dbg) {\n        const counts: Record<string, number> = {\n          data: process.stdin.listenerCount('data'),\n          end: process.stdin.listenerCount('end'),\n          error: process.stdin.listenerCount('error'),\n          readable: process.stdin.listenerCount('readable'),\n          close: process.stdin.listenerCount('close'),\n        } as any;\n        console.error(\n          `[human-input] starting prompt: isTTY=${!!process.stdin.isTTY} active=${activePrompt} waiters=${waiters.length} listeners=${JSON.stringify(counts)}`\n        );\n      }\n    } catch {}\n    // Ensure stdin is in a sane state for a fresh interactive session\n    try {\n      if (process.stdin.isTTY && typeof (process.stdin as any).setRawMode === 'function') {\n        // We use line-based input; disable raw mode just in case\n        (process.stdin as any).setRawMode(false);\n      }\n      // Always resume stdin before creating the interface\n      process.stdin.resume();\n    } catch {}\n\n    // Ensure encoding is set for predictable behavior\n    try {\n      process.stdin.setEncoding('utf8');\n    } catch {}\n\n    let rl: readline.Interface | undefined;\n\n    const allowEmpty = options.allowEmpty ?? false;\n    const multiline = options.multiline ?? false;\n    const defaultValue = options.defaultValue;\n\n    let timeoutId: NodeJS.Timeout | undefined;\n    const cleanup = () => {\n      if (timeoutId) clearTimeout(timeoutId);\n      try {\n        rl?.removeAllListeners();\n      } catch {}\n      try {\n        rl?.close();\n      } catch {}\n      // Hardening: make sure no stray listeners remain on stdin between loops\n      // Do not blanket-remove listeners from process.stdin; a fresh readline\n      // instance will manage its own listeners. Over-removing here can leave\n      // the next interface in a bad state (no keypress events).\n      try {\n        if (process.stdin.isTTY && typeof (process.stdin as any).setRawMode === 'function') {\n          (process.stdin as any).setRawMode(false);\n        }\n      } catch {}\n      try {\n        process.stdin.pause();\n      } catch {}\n      // Release the global lock so a queued prompt (if any) may proceed\n      try {\n        releasePromptLock();\n      } catch {}\n      // If stdout/stderr were temporarily wrapped by the question handler, restore them now\n      try {\n        if ((process.stdout as any).__restoreWrites) {\n          (process.stdout as any).__restoreWrites();\n        }\n      } catch {}\n      try {\n        if ((process.stderr as any).__restoreWrites) {\n          (process.stderr as any).__restoreWrites();\n        }\n      } catch {}\n      try {\n        if (dbg) {\n          const counts: Record<string, number> = {\n            data: process.stdin.listenerCount('data'),\n            end: process.stdin.listenerCount('end'),\n            error: process.stdin.listenerCount('error'),\n            readable: process.stdin.listenerCount('readable'),\n            close: process.stdin.listenerCount('close'),\n          } as any;\n          console.error(\n            `[human-input] cleanup: isTTY=${!!process.stdin.isTTY} active=false waiters=${waiters.length} listeners=${JSON.stringify(counts)}`\n          );\n        }\n      } catch {}\n    };\n    const finish = (value: string) => {\n      cleanup();\n      resolve(value);\n    };\n\n    // Optional timeout (no default)\n    if (options.timeout && options.timeout > 0) {\n      timeoutId = setTimeout(() => {\n        cleanup();\n        if (defaultValue !== undefined) return resolve(defaultValue);\n        return reject(new Error('Input timeout'));\n      }, options.timeout);\n    }\n\n    // Print minimal header with dashed separators\n    const header: string[] = [];\n    if (options.prompt && options.prompt.trim()) header.push(options.prompt.trim());\n    if (multiline) header.push('(Ctrl+D to submit)');\n    if (options.placeholder && !multiline) header.push(options.placeholder);\n    const width = Math.max(\n      20,\n      Math.min((process.stdout && (process.stdout as any).columns) || 80, 100)\n    );\n    const dash = '-'.repeat(width);\n    try {\n      console.log('\\n' + dash);\n      if (header.length) console.log(header.join('\\n'));\n      console.log(dash);\n    } catch {}\n\n    // No echo-suppression hacks â€” we fix the root cause below by using raw-mode\n    // input for single-line prompts, so the terminal never replays the line.\n\n    if (multiline) {\n      rl = readline.createInterface({\n        input: process.stdin,\n        output: process.stdout,\n        terminal: true,\n      });\n      let buf = '';\n      process.stdout.write('> ');\n      rl.on('line', line => {\n        buf += (buf ? '\\n' : '') + line;\n        process.stdout.write('> ');\n      });\n      rl.on('close', () => {\n        const trimmed = buf.trim();\n        if (!trimmed && !allowEmpty && defaultValue === undefined) {\n          return reject(new Error('Empty input not allowed'));\n        }\n        return finish(trimmed || defaultValue || '');\n      });\n      rl.on('SIGINT', () => {\n        try {\n          // Print a clean newline and exit immediately with 130 (SIGINT)\n          process.stdout.write('\\n');\n        } catch {}\n        cleanup();\n        process.exit(130);\n      });\n    } else {\n      // Root cause fix: raw-mode single-line input without readline echo.\n      const readLineRaw = async (): Promise<string> => {\n        return new Promise<string>(resolveRaw => {\n          let buf = '';\n          const onData = (chunk: Buffer) => {\n            const s = chunk.toString('utf8');\n            for (let i = 0; i < s.length; i++) {\n              const ch = s[i];\n              const code = s.charCodeAt(i);\n              if (ch === '\\n' || ch === '\\r') {\n                try {\n                  process.stdout.write('\\n');\n                } catch {}\n                teardown();\n                resolveRaw(buf);\n                return;\n              }\n              if (ch === '\\b' || code === 127) {\n                if (buf.length > 0) {\n                  buf = buf.slice(0, -1);\n                  try {\n                    process.stdout.write('\\b \\b');\n                  } catch {}\n                }\n                continue;\n              }\n              if (code === 3) {\n                // Ctrl+C\n                try {\n                  process.stdout.write('\\n');\n                } catch {}\n                teardown();\n                process.exit(130);\n              }\n              if (code >= 32) {\n                buf += ch;\n                try {\n                  process.stdout.write(ch);\n                } catch {}\n              }\n            }\n          };\n          const teardown = () => {\n            try {\n              process.stdin.off('data', onData);\n            } catch {}\n            try {\n              if (process.stdin.isTTY && typeof (process.stdin as any).setRawMode === 'function') {\n                (process.stdin as any).setRawMode(false);\n              }\n            } catch {}\n          };\n          try {\n            if (process.stdin.isTTY && typeof (process.stdin as any).setRawMode === 'function') {\n              (process.stdin as any).setRawMode(true);\n            }\n          } catch {}\n          process.stdin.on('data', onData);\n          try {\n            process.stdout.write('> ');\n          } catch {}\n        });\n      };\n      (async () => {\n        const answer = await readLineRaw();\n        const trimmed = (answer || '').trim();\n        if (!trimmed && !allowEmpty && defaultValue === undefined) {\n          cleanup();\n          return reject(new Error('Empty input not allowed'));\n        }\n        return finish(trimmed || defaultValue || '');\n      })().catch(err => {\n        cleanup();\n        reject(err);\n      });\n    }\n  });\n}\n\n/**\n * Simple prompt without fancy UI (for non-TTY environments)\n */\nexport async function simplePrompt(prompt: string): Promise<string> {\n  return new Promise(resolve => {\n    const rl = readline.createInterface({\n      input: process.stdin,\n      output: process.stdout,\n    });\n\n    rl.on('SIGINT', () => {\n      try {\n        process.stdout.write('\\n');\n      } catch {}\n      rl.close();\n      process.exit(130);\n    });\n\n    rl.question(`${prompt}\\n> `, answer => {\n      rl.close();\n      resolve(answer.trim());\n    });\n  });\n}\n","/**\n * Utilities for reading from stdin\n */\n\n/**\n * Check if stdin has data available (is being piped)\n */\nexport function isStdinAvailable(): boolean {\n  // Check if stdin is a TTY (interactive terminal)\n  // If it's not a TTY, it means data is being piped\n  return !process.stdin.isTTY;\n}\n\n/**\n * Read all data from stdin\n * @param timeout Optional timeout in milliseconds\n * @param maxSize Maximum size in bytes (default: 1MB)\n * @returns Promise that resolves with the stdin content\n */\nexport async function readStdin(timeout?: number, maxSize: number = 1024 * 1024): Promise<string> {\n  return new Promise((resolve, reject) => {\n    let data = '';\n    let timeoutId: NodeJS.Timeout | undefined;\n\n    if (timeout) {\n      timeoutId = setTimeout(() => {\n        cleanup();\n        reject(new Error(`Stdin read timeout after ${timeout}ms`));\n      }, timeout);\n    }\n\n    const cleanup = () => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      process.stdin.removeListener('data', onData);\n      process.stdin.removeListener('end', onEnd);\n      process.stdin.removeListener('error', onError);\n      // Pause stdin to prevent resource leaks\n      process.stdin.pause();\n    };\n\n    const onData = (chunk: Buffer) => {\n      data += chunk.toString();\n      // Security: Prevent DoS through large input\n      if (data.length > maxSize) {\n        cleanup();\n        reject(new Error(`Input exceeds maximum size of ${maxSize} bytes`));\n      }\n    };\n\n    const onEnd = () => {\n      cleanup();\n      resolve(data.trim());\n    };\n\n    const onError = (err: Error) => {\n      cleanup();\n      reject(err);\n    };\n\n    process.stdin.setEncoding('utf8');\n    process.stdin.on('data', onData);\n    process.stdin.on('end', onEnd);\n    process.stdin.on('error', onError);\n\n    // Resume stdin in case it's paused\n    process.stdin.resume();\n  });\n}\n\n/**\n * Try to read from stdin if available, otherwise return null\n * @param timeout Optional timeout in milliseconds\n * @param maxSize Maximum size in bytes (default: 1MB)\n * @returns Promise that resolves with stdin content or null if not available\n */\nexport async function tryReadStdin(\n  timeout?: number,\n  maxSize: number = 1024 * 1024\n): Promise<string | null> {\n  if (!isStdinAvailable()) {\n    return null;\n  }\n\n  try {\n    return await readStdin(timeout, maxSize);\n  } catch {\n    // If reading fails, return null\n    return null;\n  }\n}\n","import { CheckProvider, CheckProviderConfig, ExecutionContext } from './check-provider.interface';\nimport { PRInfo } from '../pr-analyzer';\nimport { ReviewSummary } from '../reviewer';\nimport { HumanInputRequest } from '../types/config';\nimport { interactivePrompt, simplePrompt } from '../utils/interactive-prompt';\nimport { getPromptStateManager } from '../slack/prompt-state';\nimport { createExtendedLiquid } from '../liquid-extensions';\nimport { tryReadStdin } from '../utils/stdin-reader';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\n/**\n * Human input check provider that pauses workflow to request user input.\n *\n * Supports four modes:\n * 1. CLI with --message argument (inline or file path)\n * 2. CLI with piped stdin\n * 3. CLI interactive mode (beautiful terminal UI)\n * 4. SDK mode with onHumanInput hook\n *\n * Example config:\n * ```yaml\n * checks:\n *   approval:\n *     type: human-input\n *     prompt: \"Do you approve? (yes/no)\"\n *     allow_empty: false\n *     timeout: 300000\n * ```\n */\nexport class HumanInputCheckProvider extends CheckProvider {\n  private liquid?: ReturnType<typeof createExtendedLiquid>;\n  /**\n   * @deprecated Use ExecutionContext.cliMessage instead\n   * Kept for backward compatibility\n   */\n  private static cliMessage: string | undefined;\n\n  /**\n   * @deprecated Use ExecutionContext.hooks instead\n   * Kept for backward compatibility\n   */\n  private static hooks: { onHumanInput?: (request: HumanInputRequest) => Promise<string> } = {};\n\n  /**\n   * Set the CLI message value (from --message argument)\n   * @deprecated Use ExecutionContext.cliMessage instead\n   */\n  static setCLIMessage(message: string | undefined): void {\n    HumanInputCheckProvider.cliMessage = message;\n  }\n\n  /**\n   * Get the current CLI message value\n   * @deprecated Use ExecutionContext.cliMessage instead\n   */\n  static getCLIMessage(): string | undefined {\n    return HumanInputCheckProvider.cliMessage;\n  }\n\n  /**\n   * Set hooks for SDK mode\n   * @deprecated Use ExecutionContext.hooks instead\n   */\n  static setHooks(hooks: { onHumanInput?: (request: HumanInputRequest) => Promise<string> }): void {\n    HumanInputCheckProvider.hooks = hooks;\n  }\n\n  getName(): string {\n    return 'human-input';\n  }\n\n  getDescription(): string {\n    return 'Prompts for human input during workflow execution (CLI interactive or SDK hook)';\n  }\n\n  async validateConfig(config: unknown): Promise<boolean> {\n    if (!config || typeof config !== 'object') {\n      return false;\n    }\n\n    const cfg = config as CheckProviderConfig;\n\n    // Type must be 'human-input'\n    if (cfg.type !== 'human-input') {\n      return false;\n    }\n\n    // Prompt is required\n    if (!cfg.prompt || typeof cfg.prompt !== 'string') {\n      console.error('human-input check requires a \"prompt\" field');\n      return false;\n    }\n\n    return true;\n  }\n\n  /** Build a template context for Liquid rendering */\n  private buildTemplateContext(\n    prInfo: PRInfo,\n    dependencyResults?: Map<string, ReviewSummary>,\n    outputHistory?: Map<string, unknown[]>,\n    _context?: ExecutionContext\n  ): Record<string, unknown> {\n    const ctx: Record<string, unknown> = {};\n    // pr context\n    try {\n      ctx.pr = {\n        number: prInfo.number,\n        title: prInfo.title,\n        body: prInfo.body,\n        author: prInfo.author,\n        base: prInfo.base,\n        head: prInfo.head,\n        files: (prInfo.files || []).map(f => ({\n          filename: f.filename,\n          status: f.status,\n          additions: f.additions,\n          deletions: f.deletions,\n          changes: f.changes,\n        })),\n      };\n    } catch {}\n    // event + env\n    try {\n      const safeEnv = (() => {\n        try {\n          const { buildSandboxEnv } = require('../utils/env-exposure');\n          return buildSandboxEnv(process.env);\n        } catch {\n          return {} as Record<string, string>;\n        }\n      })();\n      (ctx as any).event = { event_name: (prInfo as any)?.eventType || 'manual' };\n      (ctx as any).env = safeEnv;\n    } catch {}\n    // utils helpers\n    (ctx as any).utils = {\n      now: new Date().toISOString(),\n      today: new Date().toISOString().split('T')[0],\n    };\n    // outputs: expose raw outputs from dependency results\n    const outputs: Record<string, unknown> = {};\n    const outputsRaw: Record<string, unknown> = {};\n    if (dependencyResults) {\n      for (const [name, res] of dependencyResults.entries()) {\n        const summary = res as ReviewSummary & { output?: unknown };\n        if (typeof name === 'string' && name.endsWith('-raw')) {\n          outputsRaw[name.slice(0, -4)] = summary.output !== undefined ? summary.output : summary;\n        } else {\n          outputs[name] = summary.output !== undefined ? summary.output : summary;\n        }\n      }\n    }\n    ctx.outputs = outputs;\n    (ctx as any).outputs_raw = outputsRaw;\n    // outputs_history: expose full history if available\n    const hist: Record<string, unknown[]> = {};\n    if (outputHistory) {\n      for (const [k, v] of outputHistory.entries()) hist[k] = Array.isArray(v) ? v : [];\n    }\n    (ctx as any).outputs_history = hist;\n\n    // Optional: expose checks metadata for helpers like chat_history\n    try {\n      const anyCtx = _context as any;\n      const checksMeta = anyCtx?.checksMeta;\n      if (checksMeta && typeof checksMeta === 'object') {\n        (ctx as any).checks_meta = checksMeta;\n      }\n    } catch {\n      // Best-effort only\n    }\n    return ctx;\n  }\n\n  /**\n   * Check if a string looks like a file path\n   */\n  private looksLikePath(str: string): boolean {\n    return str.includes('/') || str.includes('\\\\');\n  }\n\n  /**\n   * Sanitize user input to prevent injection attacks in dependent checks\n   * Removes potentially dangerous characters while preserving useful input\n   */\n  private sanitizeInput(input: string): string {\n    // Heuristic: collapse accidental per-character duplication (\"stutter\") often caused by\n    // TTY echo races. We only apply this when most adjacent ASCII chars are doubled.\n    const collapseStutter = (s: string): string => {\n      if (!s || s.length < 4) return s;\n      let dupPairs = 0;\n      let pairs = 0;\n      for (let i = 0; i + 1 < s.length; i++) {\n        const a = s[i];\n        const b = s[i + 1];\n        if (/^[\\x20-\\x7E]$/.test(a) && /^[\\x20-\\x7E]$/.test(b)) {\n          pairs++;\n          if (a === b) dupPairs++;\n        }\n      }\n      const ratio = pairs > 0 ? dupPairs / pairs : 0;\n      if (ratio < 0.5) return s; // keep as-is unless roughly half of pairs are doubled\n      let out = '';\n      for (let i = 0; i < s.length; i++) {\n        const a = s[i];\n        const b = i + 1 < s.length ? s[i + 1] : '';\n        if (b && a === b) {\n          out += a;\n          i++; // skip the duplicate\n        } else {\n          out += a;\n        }\n      }\n      return out;\n    };\n\n    input = collapseStutter(input);\n    // Remove null bytes (C-string injection)\n    let sanitized = input.replace(/\\0/g, '');\n\n    // Remove control characters except newlines and tabs\n    sanitized = sanitized.replace(/[\\x00-\\x08\\x0B-\\x0C\\x0E-\\x1F\\x7F]/g, '');\n\n    // Limit length to prevent memory issues (100KB max)\n    const maxLength = 100 * 1024;\n    if (sanitized.length > maxLength) {\n      sanitized = sanitized.substring(0, maxLength);\n    }\n\n    return sanitized;\n  }\n\n  /**\n   * Try to read message from file if it exists\n   * Validates path to prevent directory traversal attacks\n   */\n  private async tryReadFile(filePath: string): Promise<string | null> {\n    try {\n      // Handle both absolute and relative paths\n      const absolutePath = path.isAbsolute(filePath)\n        ? filePath\n        : path.resolve(process.cwd(), filePath);\n\n      // Normalize path to resolve .. and . components\n      const normalizedPath = path.normalize(absolutePath);\n\n      // Security: Prevent path traversal attacks\n      // Only allow files within current working directory or its subdirectories\n      const cwd = process.cwd();\n      if (!normalizedPath.startsWith(cwd + path.sep) && normalizedPath !== cwd) {\n        // Path is outside working directory\n        return null;\n      }\n\n      // Use async file access check instead of sync existsSync\n      try {\n        await fs.promises.access(normalizedPath, fs.constants.R_OK);\n        const stats = await fs.promises.stat(normalizedPath);\n\n        // Only read regular files, not directories or special files\n        if (!stats.isFile()) {\n          return null;\n        }\n\n        const content = await fs.promises.readFile(normalizedPath, 'utf-8');\n        return content.trim();\n      } catch {\n        // File doesn't exist or isn't readable\n        return null;\n      }\n    } catch {\n      // If file read fails, treat as literal string\n    }\n    return null;\n  }\n\n  /**\n   * Get user input through various methods\n   */\n  private async getUserInput(\n    checkName: string,\n    config: CheckProviderConfig,\n    context?: ExecutionContext\n  ): Promise<string> {\n    // Slack event-bus path: if this run comes from a Slack event, support pause/resume via PromptState\n    try {\n      const payload = context?.webhookContext?.webhookData?.get(\n        ((config as any)?.endpoint as string) || '/bots/slack/support'\n      ) as any;\n      const ev: any = payload && payload.event;\n      const channel = ev && String(ev.channel || '');\n      const threadTs = ev && String(ev.thread_ts || ev.ts || ev.event_ts || '');\n      const text = ev && String(ev.text || '');\n      if (channel && threadTs) {\n        const mgr = getPromptStateManager();\n        // First-run optimization: consume the first message only if no prompts were posted yet\n        // and the thread has an unconsumed first message captured by the socket.\n        try {\n          const waiting = mgr.getWaiting(channel, threadTs);\n          const promptsPosted = waiting?.promptsPosted || 0;\n          if (promptsPosted === 0 && mgr.hasUnconsumedFirstMessage(channel, threadTs)) {\n            const first = mgr.consumeFirstMessage(channel, threadTs);\n            if (first && first.trim().length > 0) {\n              return first;\n            }\n          }\n        } catch {}\n        const waiting = mgr.getWaiting(channel, threadTs);\n        if (waiting && waiting.checkName === checkName) {\n          // Resume: consume current Slack message as the answer\n          const answer = text.replace(/<@[A-Z0-9]+>/gi, '').trim();\n          mgr.clear(channel, threadTs);\n          if (!answer && (config.allow_empty as boolean | undefined) !== true) {\n            // fall through to CLI path if empty not allowed\n          } else {\n            return answer || (config.default as string) || '';\n          }\n        } else {\n          // First time: request human input via event bus; Slack frontend will post and mark waiting\n          const prompt = String((config.prompt as string) || 'Please provide input:');\n          try {\n            await context?.eventBus?.emit({\n              type: 'HumanInputRequested',\n              checkId: checkName,\n              prompt,\n              channel,\n              threadTs,\n              threadKey: `${channel}:${threadTs}`,\n            });\n          } catch {}\n          // Return a fatal error so the run pauses and relies on snapshot/resume.\n          // This prevents the router from immediately looping back to `ask` while\n          // we wait for the next Slack message in the same thread.\n          throw this.buildAwaitingError(checkName, prompt);\n        }\n      }\n    } catch (e) {\n      // If we constructed an awaiting error, bubble it so the caller can treat it as fatal\n      if (e && (e as any).issues) throw e;\n      // Otherwise swallow and continue to CLI fallbacks\n    }\n    // Test runner mock support: if a mock is provided for this step, use it\n    try {\n      const mockVal = context?.hooks?.mockForStep?.(checkName);\n      if (mockVal !== undefined && mockVal !== null) {\n        const s = String(mockVal);\n        return s;\n      }\n    } catch {}\n    const prompt = (config.prompt as string) || 'Please provide input:';\n    const placeholder = (config.placeholder as string | undefined) || 'Enter your response...';\n    const allowEmpty = (config.allow_empty as boolean | undefined) ?? false;\n    const multiline = (config.multiline as boolean | undefined) ?? false;\n    const timeout = config.timeout ? config.timeout * 1000 : undefined; // Convert to ms\n    const defaultValue = config.default as string | undefined;\n\n    // In test/CI modes, never block for input. Use default or empty string.\n    const testMode = String(process.env.VISOR_TEST_MODE || '').toLowerCase() === 'true';\n    const ciMode =\n      String(process.env.CI || '').toLowerCase() === 'true' ||\n      String(process.env.GITHUB_ACTIONS || '').toLowerCase() === 'true';\n    if (testMode || ciMode) {\n      const val = (config.default as string | undefined) || '';\n      return val;\n    }\n\n    // Get cliMessage from context (new way) or static property (backward compat)\n    const cliMessage = context?.cliMessage ?? HumanInputCheckProvider.cliMessage;\n\n    // Priority 1: Check for --message CLI argument\n    if (cliMessage !== undefined) {\n      const message = cliMessage;\n\n      // Check if it looks like a path and try to read the file\n      if (this.looksLikePath(message)) {\n        const fileContent = await this.tryReadFile(message);\n        if (fileContent !== null) {\n          return fileContent;\n        }\n      }\n\n      // Otherwise, use as literal message\n      return message;\n    }\n\n    // Priority 2: Check for piped stdin\n    const stdinInput = await tryReadStdin(timeout);\n    if (stdinInput !== null && stdinInput.length > 0) {\n      return stdinInput;\n    }\n\n    // Priority 3: SDK hook mode\n    // Get hooks from context (new way) or static property (backward compat)\n    const hooks = context?.hooks ?? HumanInputCheckProvider.hooks;\n\n    if (hooks?.onHumanInput) {\n      const request: HumanInputRequest = {\n        checkId: checkName,\n        prompt,\n        placeholder,\n        allowEmpty,\n        multiline,\n        timeout,\n        default: defaultValue,\n      };\n\n      try {\n        const result = await hooks.onHumanInput(request);\n        return result;\n      } catch (error) {\n        throw new Error(\n          `Hook onHumanInput failed: ${error instanceof Error ? error.message : String(error)}`\n        );\n      }\n    }\n\n    // Priority 4: Interactive terminal prompt (if TTY available)\n    if (process.stdin.isTTY) {\n      try {\n        const result = await interactivePrompt({\n          prompt,\n          placeholder,\n          multiline,\n          timeout,\n          defaultValue,\n          allowEmpty,\n        });\n        return result;\n      } catch (error) {\n        throw new Error(\n          `Interactive prompt failed: ${error instanceof Error ? error.message : String(error)}`\n        );\n      }\n    }\n\n    // Priority 5: Simple prompt (fallback for non-TTY)\n    try {\n      const result = await simplePrompt(prompt);\n      if (!result && !allowEmpty && !defaultValue) {\n        throw new Error('Empty input not allowed');\n      }\n      return result || defaultValue || '';\n    } catch (error) {\n      throw new Error(\n        `Simple prompt failed: ${error instanceof Error ? error.message : String(error)}`\n      );\n    }\n  }\n\n  /** Build a deterministic, fatal error used to pause Slack-driven runs. */\n  private buildAwaitingError(checkName: string, prompt: string): Error {\n    const err = new Error(`awaiting human input for ${checkName}`);\n    (err as any).issues = [\n      {\n        file: 'system',\n        line: 0,\n        ruleId: `${checkName}/execution_error`,\n        message: `Awaiting human input (Slack thread): ${prompt.slice(0, 80)}`,\n        severity: 'error',\n        category: 'logic',\n      },\n    ] as ReviewSummary['issues'];\n    return err;\n  }\n\n  async execute(\n    _prInfo: PRInfo,\n    config: CheckProviderConfig,\n    _dependencyResults?: Map<string, ReviewSummary>,\n    context?: ExecutionContext\n  ): Promise<ReviewSummary> {\n    const checkName = config.checkName || 'human-input';\n\n    try {\n      // Render Liquid templates in prompt/placeholder if any\n      try {\n        this.liquid =\n          this.liquid || createExtendedLiquid({ strictVariables: false, strictFilters: false });\n        const tctx = this.buildTemplateContext(\n          _prInfo,\n          _dependencyResults,\n          (config as any).__outputHistory as Map<string, unknown[]> | undefined,\n          context\n        );\n        if (typeof config.prompt === 'string') {\n          let rendered = await this.liquid.parseAndRender(config.prompt, tctx);\n          // If Liquid markers remain (e.g., due to nested/guarded templates), try a second pass\n          if (/\\{\\{|\\{%/.test(rendered)) {\n            try {\n              rendered = await this.liquid.parseAndRender(rendered, tctx);\n            } catch {}\n          }\n          // Expose the final rendered prompt to the test runner (like AI provider does)\n          try {\n            const stepName = (config as any).checkName || 'unknown';\n            context?.hooks?.onPromptCaptured?.({\n              step: String(stepName),\n              provider: 'human-input',\n              prompt: rendered,\n            });\n          } catch {}\n          config = { ...config, prompt: rendered };\n        }\n        if (typeof config.placeholder === 'string') {\n          let ph = await this.liquid.parseAndRender(config.placeholder as string, tctx);\n          if (/\\{\\{|\\{%/.test(ph)) {\n            try {\n              ph = await this.liquid.parseAndRender(ph, tctx);\n            } catch {}\n          }\n          (config as any).placeholder = ph;\n        }\n      } catch (e) {\n        // Always show Liquid errors with a helpful snippet and caret\n        const err: any = e || {};\n        const raw = String((config as any)?.prompt || '');\n        const lines = raw.split(/\\r?\\n/);\n        const lineNum: number = Number(err.line || err?.token?.line || err?.location?.line || 0);\n        const colNum: number = Number(err.col || err?.token?.col || err?.location?.col || 0);\n        let snippet = '';\n        if (lineNum > 0) {\n          const start = Math.max(1, lineNum - 3);\n          const end = Math.max(lineNum + 2, lineNum);\n          const width = String(end).length;\n          for (let i = start; i <= Math.min(end, lines.length); i++) {\n            const ln = `${String(i).padStart(width, ' ')} | ${lines[i - 1] ?? ''}`;\n            snippet += ln + '\\n';\n            if (i === lineNum) {\n              const caretPad = ' '.repeat(Math.max(0, colNum > 1 ? colNum - 1 : 0) + width + 3);\n              snippet += caretPad + '^\\n';\n            }\n          }\n        }\n        try {\n          console.error(\n            `âš ï¸  human-input: Liquid render failed: ${\n              e instanceof Error ? e.message : String(e)\n            }\\n${snippet}`\n          );\n        } catch {}\n        // Continue with raw strings as a fallback\n      }\n      // Get user input (pass context for non-static state)\n      const userInput = await this.getUserInput(checkName, config, context);\n\n      // Sanitize input to prevent injection attacks in dependent checks\n      const sanitizedInput = this.sanitizeInput(userInput);\n\n      // Return structured output with timestamp for consistent history/merging\n      return {\n        issues: [],\n        output: { text: sanitizedInput, ts: Date.now() },\n      } as ReviewSummary & { output: { text: string; ts: number } };\n    } catch (error) {\n      // If slack pause/resume threw a fatal error with issues, surface as-is\n      if (error && (error as any).issues) {\n        // Mark this summary as \"awaiting human input\" so the engine can\n        // treat it as a pause point and avoid running downstream checks\n        // in the same wave (especially for Slack SocketMode flows).\n        const summary: ReviewSummary & { awaitingHumanInput?: boolean } = {\n          issues: (error as any).issues,\n        } as ReviewSummary & { awaitingHumanInput?: boolean };\n        (summary as any).awaitingHumanInput = true;\n        return summary;\n      }\n      // Otherwise, return a generic error issue\n      return {\n        issues: [\n          {\n            file: '',\n            line: 0,\n            ruleId: 'human-input-error',\n            message: `Failed to get user input: ${\n              error instanceof Error ? error.message : String(error)\n            }`,\n            severity: 'error',\n            category: 'logic',\n          },\n        ],\n      };\n    }\n  }\n\n  getSupportedConfigKeys(): string[] {\n    return [\n      'type',\n      'prompt',\n      'placeholder',\n      'allow_empty',\n      'multiline',\n      'timeout',\n      'default',\n      'depends_on',\n      'on',\n      'if',\n      'group',\n    ];\n  }\n\n  async isAvailable(): Promise<boolean> {\n    // Human input provider is always available\n    // It will fall back to simple prompts if interactive mode isn't available\n    return true;\n  }\n\n  getRequirements(): string[] {\n    return [\n      'No external dependencies required',\n      'Works in CLI mode with --message argument, piped stdin, or interactive prompts',\n      'SDK mode requires onHumanInput hook to be configured',\n    ];\n  }\n}\n","import { CheckProvider, CheckProviderConfig } from './check-provider.interface';\nimport { PRInfo } from '../pr-analyzer';\nimport { ReviewSummary } from '../reviewer';\nimport Sandbox from '@nyariv/sandboxjs';\nimport { createExtendedLiquid } from '../liquid-extensions';\nimport { logger } from '../logger';\nimport { MemoryStore } from '../memory-store';\nimport { createSecureSandbox, compileAndRun } from '../utils/sandbox';\nimport { buildProviderTemplateContext } from '../utils/template-context';\nimport { createSyncMemoryOps } from '../utils/script-memory-ops';\n\n/**\n * Provider that executes JavaScript in a secure sandbox using\n * a first-class step: `type: 'script'` + `content: | ...`.\n */\nexport class ScriptCheckProvider extends CheckProvider {\n  private liquid: ReturnType<typeof createExtendedLiquid>;\n\n  constructor() {\n    super();\n    this.liquid = createExtendedLiquid({\n      strictVariables: false,\n      strictFilters: false,\n    });\n  }\n\n  private createSecureSandbox(): Sandbox {\n    return createSecureSandbox();\n  }\n\n  getName(): string {\n    return 'script';\n  }\n\n  getDescription(): string {\n    return 'Execute JavaScript with access to PR context, dependency outputs, and memory.';\n  }\n\n  async validateConfig(config: unknown): Promise<boolean> {\n    if (!config || typeof config !== 'object') return false;\n    const cfg = config as CheckProviderConfig & { content?: string };\n    if (typeof cfg.content !== 'string') return false;\n    const trimmed = cfg.content.trim();\n    if (trimmed.length === 0) return false;\n    try {\n      const bytes = Buffer.byteLength(cfg.content, 'utf8');\n      if (bytes > 1024 * 1024) return false; // 1MB cap\n    } catch {}\n    if (cfg.content.indexOf('\\u0000') >= 0) return false;\n    return true;\n  }\n\n  async execute(\n    prInfo: PRInfo,\n    config: CheckProviderConfig & { content?: string },\n    dependencyResults?: Map<string, ReviewSummary>,\n    _sessionInfo?: {\n      parentSessionId?: string;\n      reuseSession?: boolean;\n    } & import('./check-provider.interface').ExecutionContext\n  ): Promise<ReviewSummary> {\n    // Test hook: mock output for this step (short-circuit execution)\n    try {\n      const stepName = (config as any).checkName || 'unknown';\n      const mock = _sessionInfo?.hooks?.mockForStep?.(String(stepName));\n      if (mock !== undefined) {\n        // Return mock directly as step output\n        return { issues: [], output: mock } as ReviewSummary & { output: unknown };\n      }\n    } catch {}\n\n    const script = String(config.content || '');\n    const memoryStore = MemoryStore.getInstance();\n    const ctx = buildProviderTemplateContext(\n      prInfo,\n      dependencyResults,\n      memoryStore,\n      (config as any).__outputHistory as Map<string, unknown[]> | undefined,\n      (_sessionInfo as any)?.stageHistoryBase as Record<string, number> | undefined,\n      { attachMemoryReadHelpers: false, args: _sessionInfo?.args }\n    );\n    // Keep provider quiet by default; no step-specific debug\n    // (historical ad-hoc logs removed to avoid hardcoding step names).\n\n    // Add workflow inputs to the context\n    const inputs = (config as any).workflowInputs || _sessionInfo?.workflowInputs || {};\n    (ctx as any).inputs = inputs;\n\n    // Add environment variables to context (consistent with http-client-provider)\n    (ctx as any).env = process.env;\n\n    // Attach synchronous memory ops consistent with memory provider\n    const { ops, needsSave } = createSyncMemoryOps(memoryStore);\n    (ctx as any).memory = ops as unknown as Record<string, unknown>;\n\n    // Add helper functions to the context\n    (ctx as any).escapeXml = (str: unknown): string => {\n      if (str == null) return '';\n      return String(str)\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&apos;');\n    };\n\n    // Add btoa/atob for base64 encoding/decoding (browser API polyfill)\n    (ctx as any).btoa = (str: unknown): string => {\n      return Buffer.from(String(str), 'binary').toString('base64');\n    };\n    (ctx as any).atob = (str: unknown): string => {\n      return Buffer.from(String(str), 'base64').toString('binary');\n    };\n\n    // Evaluate the script in a secure sandbox (per-execution instance)\n    const sandbox = this.createSecureSandbox();\n    let result: unknown;\n    try {\n      result = compileAndRun<unknown>(\n        sandbox,\n        script,\n        { ...ctx },\n        {\n          injectLog: true,\n          wrapFunction: true,\n          logPrefix: '[script]',\n        }\n      );\n    } catch (error) {\n      const msg = error instanceof Error ? error.message : 'Unknown error';\n      logger.error(`[script] execution error: ${msg}`);\n      return {\n        issues: [\n          {\n            file: 'script',\n            line: 0,\n            ruleId: 'script/execution_error',\n            message: msg,\n            severity: 'error',\n            category: 'logic',\n          },\n        ],\n        output: null,\n      } as ReviewSummary;\n    }\n\n    // Persist file-backed memory once if needed\n    try {\n      if (\n        needsSave() &&\n        memoryStore.getConfig().storage === 'file' &&\n        memoryStore.getConfig().auto_save\n      ) {\n        await memoryStore.save();\n      }\n    } catch (e) {\n      logger.warn(`[script] memory save failed: ${e instanceof Error ? e.message : String(e)}`);\n    }\n\n    try {\n      if (process.env.VISOR_DEBUG === 'true') {\n        const name = String((config as any).checkName || '');\n        const t = typeof result;\n        // Generic, step-agnostic debug\n        console.error(\n          `[script-return] ${name} outputType=${t} hasArray=${Array.isArray(result)} hasObj=${\n            result && typeof result === 'object'\n          }`\n        );\n      }\n    } catch {}\n    const out: any = { issues: [], output: result } as ReviewSummary & { output: unknown };\n    try {\n      (out as any).__histTracked = true;\n    } catch {}\n    return out;\n  }\n\n  getSupportedConfigKeys(): string[] {\n    return [\n      'type',\n      'content',\n      'depends_on',\n      'group',\n      'on',\n      'if',\n      'fail_if',\n      'on_fail',\n      'on_success',\n    ];\n  }\n\n  async isAvailable(): Promise<boolean> {\n    return true;\n  }\n\n  getRequirements(): string[] {\n    return ['No external dependencies required'];\n  }\n\n  // No local buildTemplateContext; uses shared builder above\n}\n","/**\n * Git Worktree Manager\n *\n * Manages git worktrees for efficient multi-workflow execution.\n * Uses a bare repository cache to share git objects between worktrees.\n */\n\nimport * as fs from 'fs';\nimport * as fsp from 'fs/promises';\nimport * as path from 'path';\nimport * as crypto from 'crypto';\nimport { commandExecutor } from './command-executor';\nimport { logger } from '../logger';\nimport type {\n  WorktreeMetadata,\n  WorktreeCacheConfig,\n  WorktreeInfo,\n  GitCommandResult,\n} from '../types/git-checkout';\n\nexport class WorktreeManager {\n  private static instance: WorktreeManager;\n  private config: WorktreeCacheConfig;\n  private activeWorktrees: Map<string, WorktreeMetadata>;\n  private cleanupHandlersRegistered: boolean = false;\n\n  private constructor() {\n    // Default configuration - use project-local .visor/worktrees/ by default\n    // Handle test environment where process.cwd() may be undefined or return undefined\n    let cwd: string;\n    try {\n      cwd = process.cwd() || '/tmp';\n    } catch {\n      cwd = '/tmp';\n    }\n    const defaultBasePath =\n      process.env.VISOR_WORKTREE_PATH || path.join(cwd, '.visor', 'worktrees');\n\n    this.config = {\n      enabled: true,\n      base_path: defaultBasePath,\n      cleanup_on_exit: true,\n      max_age_hours: 24,\n    };\n    this.activeWorktrees = new Map();\n    this.ensureDirectories();\n    this.registerCleanupHandlers();\n  }\n\n  static getInstance(): WorktreeManager {\n    if (!WorktreeManager.instance) {\n      WorktreeManager.instance = new WorktreeManager();\n    }\n    return WorktreeManager.instance;\n  }\n\n  /**\n   * Update configuration\n   */\n  configure(config: Partial<WorktreeCacheConfig>): void {\n    this.config = { ...this.config, ...config };\n    this.ensureDirectories();\n  }\n\n  getConfig(): WorktreeCacheConfig {\n    return { ...this.config };\n  }\n\n  /**\n   * Ensure base directories exist\n   */\n  private ensureDirectories(): void {\n    // Skip directory creation if base_path is not properly initialized\n    // (can happen in test environments)\n    if (!this.config.base_path) {\n      logger.debug('Skipping directory creation: base_path not initialized');\n      return;\n    }\n\n    const reposDir = this.getReposDir();\n    const worktreesDir = this.getWorktreesDir();\n\n    if (!fs.existsSync(reposDir)) {\n      fs.mkdirSync(reposDir, { recursive: true });\n      logger.debug(`Created repos directory: ${reposDir}`);\n    }\n\n    if (!fs.existsSync(worktreesDir)) {\n      fs.mkdirSync(worktreesDir, { recursive: true });\n      logger.debug(`Created worktrees directory: ${worktreesDir}`);\n    }\n  }\n\n  private getReposDir(): string {\n    return path.join(this.config.base_path, 'repos');\n  }\n\n  private getWorktreesDir(): string {\n    return path.join(this.config.base_path, 'worktrees');\n  }\n\n  /**\n   * Generate a deterministic worktree ID based on repository and ref.\n   * This allows worktrees to be reused when the same repo+ref is requested again.\n   */\n  private generateWorktreeId(repository: string, ref: string): string {\n    const sanitizedRepo = repository.replace(/[^a-zA-Z0-9-]/g, '-');\n    const sanitizedRef = ref.replace(/[^a-zA-Z0-9-]/g, '-');\n    // Use deterministic hash (no Date.now()) so same repo+ref produces same ID\n    // This enables worktree reuse across multiple calls\n    const hash = crypto\n      .createHash('md5')\n      .update(`${repository}:${ref}`)\n      .digest('hex')\n      .substring(0, 8);\n    return `${sanitizedRepo}-${sanitizedRef}-${hash}`;\n  }\n\n  /**\n   * Get or create bare repository\n   */\n  async getOrCreateBareRepo(\n    repository: string,\n    repoUrl: string,\n    token?: string,\n    fetchDepth?: number,\n    cloneTimeoutMs?: number\n  ): Promise<string> {\n    const reposDir = this.getReposDir();\n    const repoName = repository.replace(/\\//g, '-');\n    const bareRepoPath = path.join(reposDir, `${repoName}.git`);\n\n    // Check if bare repo exists\n    if (fs.existsSync(bareRepoPath)) {\n      logger.debug(`Bare repository already exists: ${bareRepoPath}`);\n\n      // Verify the bare repo has the correct remote URL to prevent using corrupted repos\n      const verifyResult = await this.verifyBareRepoRemote(bareRepoPath, repoUrl);\n      if (verifyResult === 'timeout') {\n        // Timeout during verification - use stale cache to avoid hanging on re-clone\n        logger.info(`Using stale bare repository (verification timed out): ${bareRepoPath}`);\n        return bareRepoPath;\n      } else if (verifyResult === false) {\n        logger.warn(\n          `Bare repository at ${bareRepoPath} has incorrect remote, removing and re-cloning`\n        );\n        await fsp.rm(bareRepoPath, { recursive: true, force: true });\n        // Fall through to clone below\n      } else {\n        // Update remote refs\n        await this.updateBareRepo(bareRepoPath);\n        return bareRepoPath;\n      }\n    }\n\n    // Clone as bare repository\n    const cloneUrl = this.buildAuthenticatedUrl(repoUrl, token);\n    const redactedUrl = this.redactUrl(cloneUrl);\n\n    logger.info(\n      `Cloning bare repository: ${redactedUrl}${fetchDepth ? ` (depth: ${fetchDepth})` : ''}`\n    );\n\n    // Build clone command with optional depth\n    let cloneCmd = `git clone --bare`;\n    if (fetchDepth && fetchDepth > 0) {\n      const depth = parseInt(String(fetchDepth), 10);\n      if (isNaN(depth) || depth < 1) {\n        throw new Error('fetch_depth must be a positive integer');\n      }\n      cloneCmd += ` --depth ${depth}`;\n    }\n    cloneCmd += ` ${this.escapeShellArg(cloneUrl)} ${this.escapeShellArg(bareRepoPath)}`;\n\n    const result = await this.executeGitCommand(cloneCmd, {\n      timeout: cloneTimeoutMs || 300000, // default 5 minutes\n    });\n\n    if (result.exitCode !== 0) {\n      // Redact tokens from error messages\n      const redactedStderr = this.redactUrl(result.stderr);\n      throw new Error(`Failed to clone bare repository: ${redactedStderr}`);\n    }\n\n    logger.info(`Successfully cloned bare repository to ${bareRepoPath}`);\n    return bareRepoPath;\n  }\n\n  /**\n   * Update bare repository refs\n   */\n  private async updateBareRepo(bareRepoPath: string): Promise<void> {\n    logger.debug(`Updating bare repository: ${bareRepoPath}`);\n\n    try {\n      const updateCmd = `git -C ${this.escapeShellArg(bareRepoPath)} remote update --prune`;\n      const result = await this.executeGitCommand(updateCmd, { timeout: 60000 }); // 1 minute timeout\n\n      if (result.exitCode !== 0) {\n        logger.warn(`Failed to update bare repository: ${result.stderr}`);\n        // Don't throw - we can continue with stale refs\n      } else {\n        logger.debug(`Successfully updated bare repository`);\n      }\n    } catch (error) {\n      // Handle timeout or other errors gracefully - we can continue with stale refs\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      logger.warn(`Failed to update bare repository (will use stale refs): ${errorMessage}`);\n    }\n  }\n\n  /**\n   * Verify that a bare repository has the correct remote URL.\n   * This prevents reusing corrupted repos that were cloned from a different repository.\n   * Returns: true (valid), false (invalid - should re-clone), or 'timeout' (use stale cache)\n   */\n  private async verifyBareRepoRemote(\n    bareRepoPath: string,\n    expectedUrl: string\n  ): Promise<boolean | 'timeout'> {\n    try {\n      const cmd = `git -C ${this.escapeShellArg(bareRepoPath)} remote get-url origin`;\n      const result = await this.executeGitCommand(cmd, { timeout: 10000 });\n\n      if (result.exitCode !== 0) {\n        logger.warn(`Failed to get remote URL for ${bareRepoPath}: ${result.stderr}`);\n        return false;\n      }\n\n      const actualUrl = result.stdout.trim();\n\n      // Normalize URLs for comparison:\n      // - remove credentials (tokens/username)\n      // - remove .git suffix if present\n      // - trim trailing slash\n      // - lowercase for caseâ€‘insensitive match\n      const normalizeUrl = (url: string): string => {\n        // Convert common SSH form to https for comparison\n        if (url.startsWith('git@github.com:')) {\n          url = url.replace('git@github.com:', 'https://github.com/');\n        }\n        return (\n          url\n            // strip userinfo part to avoid mismatches when the cached bare\n            // repo was cloned with an access token but the expected URL is\n            // tokenless (or viceâ€‘versa)\n            .replace(/:\\/\\/[^@]+@/, '://')\n            .replace(/\\.git$/, '')\n            .replace(/\\/$/, '')\n            .toLowerCase()\n        );\n      };\n\n      const normalizedExpected = normalizeUrl(expectedUrl);\n      const normalizedActual = normalizeUrl(actualUrl);\n\n      if (normalizedExpected !== normalizedActual) {\n        logger.warn(`Bare repo remote mismatch: expected ${expectedUrl}, got ${actualUrl}`);\n        return false;\n      }\n\n      logger.debug(`Bare repo remote verified: ${actualUrl}`);\n      return true;\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      // If it's a timeout, return 'timeout' so caller can use stale cache instead of re-cloning\n      if (errorMessage.includes('timed out')) {\n        logger.warn(`Timeout verifying bare repo remote (will use stale cache): ${errorMessage}`);\n        return 'timeout';\n      }\n      logger.warn(`Error verifying bare repo remote: ${error}`);\n      return false;\n    }\n  }\n\n  /**\n   * Create a new worktree for the given repository/ref.\n   *\n   * Important: we always create worktrees in a detached HEAD state pinned\n   * to a specific commit SHA rather than a named branch like \"main\". Git\n   * only allows a branch to be checked out in a single worktree at a time;\n   * using the raw commit (plus --detach) lets multiple workflows safely\n   * create independent worktrees for the same branch without hitting\n   * errors like:\n   *\n   *   fatal: 'main' is already used by worktree at '.../TykTechnologies-tyk-docs-main-XXXX'\n   */\n  async createWorktree(\n    repository: string,\n    repoUrl: string,\n    ref: string,\n    options: {\n      token?: string;\n      workingDirectory?: string;\n      clean?: boolean;\n      workflowId?: string;\n      fetchDepth?: number;\n      cloneTimeoutMs?: number;\n    } = {}\n  ): Promise<WorktreeInfo> {\n    // Validate ref to prevent command injection\n    this.validateRef(ref);\n\n    // Get or create bare repository\n    const bareRepoPath = await this.getOrCreateBareRepo(\n      repository,\n      repoUrl,\n      options.token,\n      options.fetchDepth,\n      options.cloneTimeoutMs\n    );\n\n    // Generate worktree ID and path\n    const worktreeId = this.generateWorktreeId(repository, ref);\n    let worktreePath = options.workingDirectory || path.join(this.getWorktreesDir(), worktreeId);\n\n    // Validate path if user-provided\n    if (options.workingDirectory) {\n      worktreePath = this.validatePath(options.workingDirectory);\n    }\n\n    // Check if worktree already exists\n    if (fs.existsSync(worktreePath)) {\n      logger.debug(`Worktree already exists: ${worktreePath}`);\n\n      // Load existing metadata\n      const metadata = await this.loadMetadata(worktreePath);\n      if (metadata) {\n        // Check if the requested ref matches the existing ref\n        if (metadata.ref === ref) {\n          // Same ref - refresh commit in case the branch moved\n          try {\n            const bareRepoPath =\n              metadata.bare_repo_path ||\n              (await this.getOrCreateBareRepo(\n                repository,\n                repoUrl,\n                options.token,\n                options.fetchDepth,\n                options.cloneTimeoutMs\n              ));\n            const fetched = await this.fetchRef(bareRepoPath, ref);\n            if (fetched) {\n              const latestCommit = await this.getCommitShaForRef(bareRepoPath, ref);\n              if (latestCommit && latestCommit !== metadata.commit) {\n                logger.info(\n                  `Worktree ref ${ref} advanced (${metadata.commit} -> ${latestCommit}), updating...`\n                );\n                const checkoutCmd = `git -C ${this.escapeShellArg(worktreePath)} checkout --detach ${this.escapeShellArg(latestCommit)}`;\n                const checkoutResult = await this.executeGitCommand(checkoutCmd, {\n                  timeout: 60000,\n                });\n                if (checkoutResult.exitCode !== 0) {\n                  throw new Error(`Failed to checkout updated ref: ${checkoutResult.stderr}`);\n                }\n\n                const updatedMetadata: WorktreeMetadata = {\n                  ...metadata,\n                  commit: latestCommit,\n                  created_at: new Date().toISOString(),\n                };\n                await this.saveMetadata(worktreePath, updatedMetadata);\n                if (options.clean) {\n                  logger.debug(`Cleaning updated worktree`);\n                  await this.cleanWorktree(worktreePath);\n                }\n                this.activeWorktrees.set(worktreeId, updatedMetadata);\n                return {\n                  id: worktreeId,\n                  path: worktreePath,\n                  ref: updatedMetadata.ref,\n                  commit: updatedMetadata.commit,\n                  metadata: updatedMetadata,\n                  locked: false,\n                };\n              }\n            }\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : String(error);\n            logger.warn(`Failed to refresh worktree, will reuse existing: ${errorMessage}`);\n          }\n\n          // Same ref - reuse existing worktree (already up to date or refresh failed)\n          if (options.clean) {\n            logger.debug(`Cleaning existing worktree`);\n            await this.cleanWorktree(worktreePath);\n          }\n          this.activeWorktrees.set(worktreeId, metadata);\n          return {\n            id: worktreeId,\n            path: worktreePath,\n            ref: metadata.ref,\n            commit: metadata.commit,\n            metadata,\n            locked: false,\n          };\n        } else {\n          // Different ref requested - update the worktree to the new ref\n          logger.info(\n            `Worktree exists with different ref (${metadata.ref} -> ${ref}), updating...`\n          );\n\n          try {\n            // Get or ensure bare repo exists\n            const bareRepoPath =\n              metadata.bare_repo_path ||\n              (await this.getOrCreateBareRepo(\n                repository,\n                repoUrl,\n                options.token,\n                options.fetchDepth,\n                options.cloneTimeoutMs\n              ));\n\n            // Fetch the new ref and get its commit SHA\n            const fetched = await this.fetchRef(bareRepoPath, ref);\n            const newCommit = await this.getCommitShaForRef(bareRepoPath, ref);\n            if (!fetched) {\n              logger.warn(`Using cached ref ${ref} for update; fetch failed`);\n            }\n\n            // Checkout the new commit in the worktree (detached HEAD)\n            const checkoutCmd = `git -C ${this.escapeShellArg(worktreePath)} checkout --detach ${this.escapeShellArg(newCommit)}`;\n            const checkoutResult = await this.executeGitCommand(checkoutCmd, { timeout: 60000 });\n\n            if (checkoutResult.exitCode !== 0) {\n              throw new Error(`Failed to checkout new ref: ${checkoutResult.stderr}`);\n            }\n\n            // Update metadata with new ref/commit\n            const updatedMetadata: WorktreeMetadata = {\n              ...metadata,\n              ref,\n              commit: newCommit,\n              created_at: new Date().toISOString(),\n            };\n\n            await this.saveMetadata(worktreePath, updatedMetadata);\n\n            if (options.clean) {\n              logger.debug(`Cleaning updated worktree`);\n              await this.cleanWorktree(worktreePath);\n            }\n\n            this.activeWorktrees.set(worktreeId, updatedMetadata);\n            logger.info(`Successfully updated worktree to ${ref} (${newCommit})`);\n\n            return {\n              id: worktreeId,\n              path: worktreePath,\n              ref,\n              commit: newCommit,\n              metadata: updatedMetadata,\n              locked: false,\n            };\n          } catch (error) {\n            // If update fails, remove and recreate\n            const errorMessage = error instanceof Error ? error.message : String(error);\n            logger.warn(`Failed to update worktree, will recreate: ${errorMessage}`);\n            await fsp.rm(worktreePath, { recursive: true, force: true });\n            // Fall through to create new worktree below\n          }\n        }\n      } else {\n        // Directory exists but is not a valid worktree (no metadata)\n        // Remove it so we can create a fresh worktree\n        logger.info(`Removing stale directory (no metadata): ${worktreePath}`);\n        await fsp.rm(worktreePath, { recursive: true, force: true });\n      }\n    }\n\n    // Fetch the ref if needed, then resolve it to a concrete commit SHA.\n    // We use the commit (detached HEAD) instead of the branch name so we\n    // can have multiple worktrees for the same branch without git refusing\n    // with \"branch X is already checked out\".\n    const fetched = await this.fetchRef(bareRepoPath, ref);\n    const commit = await this.getCommitShaForRef(bareRepoPath, ref);\n    if (!fetched) {\n      logger.warn(`Using cached ref ${ref}; fetch failed`);\n    }\n\n    // Prune stale worktree entries before creating a new one.\n    // This handles the case where a worktree directory was manually deleted\n    // but git still has it registered in its metadata.\n    await this.pruneWorktrees(bareRepoPath);\n\n    // Create worktree in detached HEAD state at the resolved commit\n    logger.info(`Creating worktree for ${repository}@${ref} (${commit})`);\n    const createCmd = `git -C ${this.escapeShellArg(\n      bareRepoPath\n    )} worktree add --detach ${this.escapeShellArg(worktreePath)} ${this.escapeShellArg(commit)}`;\n    const result = await this.executeGitCommand(createCmd, { timeout: 60000 });\n\n    if (result.exitCode !== 0) {\n      throw new Error(`Failed to create worktree: ${result.stderr}`);\n    }\n\n    // Create metadata\n    const metadata: WorktreeMetadata = {\n      worktree_id: worktreeId,\n      created_at: new Date().toISOString(),\n      workflow_id: options.workflowId,\n      ref,\n      commit,\n      repository,\n      pid: process.pid,\n      cleanup_on_exit: true,\n      bare_repo_path: bareRepoPath,\n      worktree_path: worktreePath,\n    };\n\n    // Save metadata\n    await this.saveMetadata(worktreePath, metadata);\n\n    // Track active worktree\n    this.activeWorktrees.set(worktreeId, metadata);\n\n    logger.info(`Successfully created worktree: ${worktreePath}`);\n\n    return {\n      id: worktreeId,\n      path: worktreePath,\n      ref,\n      commit,\n      metadata,\n      locked: false,\n    };\n  }\n\n  /**\n   * Prune stale worktree entries from a bare repository.\n   * This removes entries for worktrees whose directories no longer exist.\n   */\n  private async pruneWorktrees(bareRepoPath: string): Promise<void> {\n    logger.debug(`Pruning stale worktrees for ${bareRepoPath}`);\n    const pruneCmd = `git -C ${this.escapeShellArg(bareRepoPath)} worktree prune`;\n    const result = await this.executeGitCommand(pruneCmd, { timeout: 10000 });\n\n    if (result.exitCode !== 0) {\n      logger.warn(`Failed to prune worktrees: ${result.stderr}`);\n      // Don't throw - we can try to continue anyway\n    } else {\n      logger.debug(`Successfully pruned stale worktrees`);\n    }\n  }\n\n  /**\n   * Fetch a specific ref in bare repository\n   */\n  private async fetchRef(bareRepoPath: string, ref: string): Promise<boolean> {\n    // Validate ref (already validated in createWorktree, but double-check for safety)\n    this.validateRef(ref);\n\n    logger.debug(`Fetching ref: ${ref}`);\n\n    // Try to fetch the ref (might be a PR ref or branch)\n    const fetchCmd = `git -C ${this.escapeShellArg(bareRepoPath)} fetch origin ${this.escapeShellArg(ref + ':' + ref)} 2>&1`;\n    const result = await this.executeGitCommand(fetchCmd, { timeout: 60000 });\n    if (result.exitCode !== 0) {\n      logger.warn(`Failed to fetch ref ${ref}: ${result.stderr}`);\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Clean worktree (reset and remove untracked files)\n   */\n  private async cleanWorktree(worktreePath: string): Promise<void> {\n    // Reset to HEAD\n    const resetCmd = `git -C ${this.escapeShellArg(worktreePath)} reset --hard HEAD`;\n    await this.executeGitCommand(resetCmd);\n\n    // Clean untracked files\n    const cleanCmd = `git -C ${this.escapeShellArg(worktreePath)} clean -fdx`;\n    await this.executeGitCommand(cleanCmd);\n  }\n\n  /**\n   * Get commit SHA for a given ref inside a bare repository.\n   *\n   * This runs after fetchRef so that <ref> should resolve to either a\n   * local branch, tag, or remote-tracking ref.\n   *\n   * If the ref is \"main\" or \"master\" and doesn't exist, automatically\n   * falls back to the other common default branch name.\n   */\n  private async getCommitShaForRef(bareRepoPath: string, ref: string): Promise<string> {\n    const cmd = `git -C ${this.escapeShellArg(bareRepoPath)} rev-parse ${this.escapeShellArg(ref)}`;\n    const result = await this.executeGitCommand(cmd);\n\n    if (result.exitCode !== 0) {\n      // If main/master doesn't exist, try the other common default branch\n      const fallbackRefs: Record<string, string> = {\n        main: 'master',\n        master: 'main',\n      };\n\n      const fallbackRef = fallbackRefs[ref];\n      if (fallbackRef) {\n        logger.debug(`Ref '${ref}' not found, trying fallback '${fallbackRef}'`);\n\n        // Fetch the fallback ref\n        await this.fetchRef(bareRepoPath, fallbackRef);\n\n        const fallbackCmd = `git -C ${this.escapeShellArg(bareRepoPath)} rev-parse ${this.escapeShellArg(fallbackRef)}`;\n        const fallbackResult = await this.executeGitCommand(fallbackCmd);\n\n        if (fallbackResult.exitCode === 0) {\n          logger.info(`Using fallback branch '${fallbackRef}' instead of '${ref}'`);\n          return fallbackResult.stdout.trim();\n        }\n      }\n\n      throw new Error(`Failed to get commit SHA for ref ${ref}: ${result.stderr}`);\n    }\n\n    return result.stdout.trim();\n  }\n\n  /**\n   * Remove a worktree\n   */\n  async removeWorktree(worktreeId: string): Promise<void> {\n    const metadata = this.activeWorktrees.get(worktreeId);\n\n    if (!metadata) {\n      logger.warn(`Worktree not found in active list: ${worktreeId}`);\n      return;\n    }\n\n    const { bare_repo_path, worktree_path } = metadata;\n\n    logger.info(`Removing worktree: ${worktree_path}`);\n\n    // Remove worktree via git\n    const removeCmd = `git -C ${this.escapeShellArg(bare_repo_path)} worktree remove ${this.escapeShellArg(worktree_path)} --force`;\n    const result = await this.executeGitCommand(removeCmd, { timeout: 30000 });\n\n    if (result.exitCode !== 0) {\n      logger.warn(`Failed to remove worktree via git: ${result.stderr}`);\n\n      // Fallback: manually remove directory\n      if (fs.existsSync(worktree_path)) {\n        logger.debug(`Manually removing worktree directory`);\n        fs.rmSync(worktree_path, { recursive: true, force: true });\n      }\n    }\n\n    // Remove from active list\n    this.activeWorktrees.delete(worktreeId);\n\n    logger.info(`Successfully removed worktree: ${worktreeId}`);\n  }\n\n  /**\n   * Save worktree metadata\n   */\n  private async saveMetadata(worktreePath: string, metadata: WorktreeMetadata): Promise<void> {\n    const metadataPath = path.join(worktreePath, '.visor-metadata.json');\n    fs.writeFileSync(metadataPath, JSON.stringify(metadata, null, 2), 'utf8');\n  }\n\n  /**\n   * Load worktree metadata\n   */\n  private async loadMetadata(worktreePath: string): Promise<WorktreeMetadata | null> {\n    const metadataPath = path.join(worktreePath, '.visor-metadata.json');\n\n    if (!fs.existsSync(metadataPath)) {\n      return null;\n    }\n\n    try {\n      const content = fs.readFileSync(metadataPath, 'utf8');\n      return JSON.parse(content);\n    } catch (error) {\n      logger.warn(`Failed to load metadata: ${error}`);\n      return null;\n    }\n  }\n\n  /**\n   * List all worktrees\n   */\n  async listWorktrees(): Promise<WorktreeInfo[]> {\n    const worktreesDir = this.getWorktreesDir();\n\n    if (!fs.existsSync(worktreesDir)) {\n      return [];\n    }\n\n    const entries = fs.readdirSync(worktreesDir, { withFileTypes: true });\n    const worktrees: WorktreeInfo[] = [];\n\n    for (const entry of entries) {\n      if (!entry.isDirectory()) continue;\n\n      const worktreePath = path.join(worktreesDir, entry.name);\n      const metadata = await this.loadMetadata(worktreePath);\n\n      if (metadata) {\n        worktrees.push({\n          id: metadata.worktree_id,\n          path: worktreePath,\n          ref: metadata.ref,\n          commit: metadata.commit,\n          metadata,\n          locked: this.isProcessAlive(metadata.pid),\n        });\n      }\n    }\n\n    return worktrees;\n  }\n\n  /**\n   * Cleanup stale worktrees\n   */\n  async cleanupStaleWorktrees(): Promise<void> {\n    logger.debug('Cleaning up stale worktrees');\n\n    const worktrees = await this.listWorktrees();\n    const now = new Date();\n    const maxAgeMs = this.config.max_age_hours * 60 * 60 * 1000;\n\n    for (const worktree of worktrees) {\n      const createdAt = new Date(worktree.metadata.created_at);\n      const ageMs = now.getTime() - createdAt.getTime();\n\n      // Skip if process is still alive\n      if (worktree.locked) {\n        continue;\n      }\n\n      // Remove if too old\n      if (ageMs > maxAgeMs) {\n        logger.info(\n          `Removing stale worktree: ${worktree.id} (age: ${Math.round(ageMs / 1000 / 60)} minutes)`\n        );\n        await this.removeWorktree(worktree.id);\n      }\n    }\n  }\n\n  /**\n   * Cleanup all worktrees for current process\n   */\n  async cleanupProcessWorktrees(): Promise<void> {\n    logger.debug('Cleaning up worktrees for current process');\n\n    const currentPid = process.pid;\n    const worktrees = await this.listWorktrees();\n\n    for (const worktree of worktrees) {\n      if (worktree.metadata.pid === currentPid && worktree.metadata.cleanup_on_exit) {\n        logger.info(`Cleaning up worktree: ${worktree.id}`);\n        await this.removeWorktree(worktree.id);\n      }\n    }\n  }\n\n  /**\n   * Check if a process is alive\n   */\n  private isProcessAlive(pid: number): boolean {\n    try {\n      process.kill(pid, 0);\n      return true;\n    } catch (_error) {\n      return false;\n    }\n  }\n\n  /**\n   * Register cleanup handlers\n   */\n  private registerCleanupHandlers(): void {\n    if (this.cleanupHandlersRegistered) {\n      return;\n    }\n\n    if (this.config.cleanup_on_exit) {\n      // Cleanup on normal exit\n      process.on('exit', () => {\n        // Synchronous cleanup\n        logger.debug('Process exiting, cleanup handler triggered');\n      });\n\n      // Cleanup on SIGINT (Ctrl+C)\n      process.on('SIGINT', async () => {\n        logger.info('SIGINT received, cleaning up worktrees');\n        await this.cleanupProcessWorktrees();\n        process.exit(130);\n      });\n\n      // Cleanup on SIGTERM\n      process.on('SIGTERM', async () => {\n        logger.info('SIGTERM received, cleaning up worktrees');\n        await this.cleanupProcessWorktrees();\n        process.exit(143);\n      });\n\n      // Cleanup on uncaught exception\n      process.on('uncaughtException', async error => {\n        logger.error(`Uncaught exception, cleaning up worktrees: ${error}`);\n        await this.cleanupProcessWorktrees();\n        process.exit(1);\n      });\n    }\n\n    this.cleanupHandlersRegistered = true;\n  }\n\n  /**\n   * Escape shell argument to prevent command injection\n   *\n   * Uses POSIX-standard single-quote escaping which prevents ALL shell metacharacter\n   * interpretation (including $, `, \\, \", ;, &, |, etc.)\n   *\n   * How it works:\n   * - Everything is wrapped in single quotes: 'arg'\n   * - Single quotes within are escaped as: ' â†’ '\\''\n   *   (close quote, literal escaped quote, open quote)\n   *\n   * This is safer than double quotes which still allow $expansion and `backticks`\n   *\n   * Example: \"foo'bar\" â†’ 'foo'\\''bar'\n   */\n  private escapeShellArg(arg: string): string {\n    // POSIX shell escaping: wrap in single quotes, escape embedded single quotes\n    return `'${arg.replace(/'/g, \"'\\\\''\")}'`;\n  }\n\n  /**\n   * Validate git ref to prevent command injection\n   */\n  private validateRef(ref: string): void {\n    // Restrictive pattern for git refs in our use case\n    // Allow: alphanumeric, dots, underscores, slashes, hyphens\n    // Allow: colons for refspecs like \"refs/pull/123/head:pr-123\"\n    // Disallow: @, ^, ~, and other special characters to minimize attack surface\n    const safeRefPattern = /^[a-zA-Z0-9._/:-]+$/;\n\n    if (!safeRefPattern.test(ref)) {\n      throw new Error(\n        `Invalid git ref: ${ref}. Refs must only contain alphanumeric characters, dots, underscores, slashes, colons, and hyphens.`\n      );\n    }\n\n    // Additional checks for dangerous patterns\n    if (ref.includes('..') || ref.startsWith('-') || ref.endsWith('.lock')) {\n      throw new Error(\n        `Invalid git ref: ${ref}. Refs cannot contain '..', start with '-', or end with '.lock'.`\n      );\n    }\n\n    // Length check to prevent DoS\n    if (ref.length > 256) {\n      throw new Error(`Invalid git ref: ${ref}. Refs cannot exceed 256 characters.`);\n    }\n  }\n\n  /**\n   * Validate path to prevent directory traversal\n   */\n  private validatePath(userPath: string): string {\n    const resolvedPath = path.resolve(userPath);\n\n    // Ensure path is absolute and resolved\n    // For working_directory, users can specify absolute paths outside base_path\n    if (!path.isAbsolute(resolvedPath)) {\n      throw new Error('Path must be absolute');\n    }\n\n    // Additional security: prevent access to sensitive system directories\n    const sensitivePatterns = [\n      '/etc',\n      '/root',\n      '/boot',\n      '/sys',\n      '/proc',\n      '/dev',\n      'C:\\\\Windows\\\\System32',\n      'C:\\\\Program Files',\n    ];\n\n    for (const pattern of sensitivePatterns) {\n      if (resolvedPath.startsWith(pattern)) {\n        throw new Error(`Access to system directory ${pattern} is not allowed`);\n      }\n    }\n\n    return resolvedPath;\n  }\n\n  /**\n   * Redact sensitive tokens from URLs for logging\n   */\n  private redactUrl(url: string): string {\n    return url\n      .replace(/x-access-token:[^@]+@/g, 'x-access-token:[REDACTED]@')\n      .replace(/:\\/\\/[^:]+:[^@]+@/g, '://[REDACTED]:[REDACTED]@');\n  }\n\n  /**\n   * Execute a git command\n   */\n  private async executeGitCommand(\n    command: string,\n    options: { timeout?: number; env?: Record<string, string> } = {}\n  ): Promise<GitCommandResult> {\n    // Merge provided env with process.env and add git-specific settings\n    // These settings prevent git from hanging on interactive prompts while\n    // still allowing OS-level credential helpers to work:\n    // - GIT_TERMINAL_PROMPT=0: Prevents terminal credential prompts\n    // - GIT_SSH_COMMAND: Disables SSH password prompts (BatchMode)\n    const gitEnv = {\n      ...process.env,\n      ...options.env,\n      GIT_TERMINAL_PROMPT: '0',\n      GIT_SSH_COMMAND: 'ssh -o BatchMode=yes -o StrictHostKeyChecking=no',\n    };\n\n    const result = await commandExecutor.execute(command, {\n      timeout: options.timeout || 30000,\n      env: gitEnv,\n    } as any);\n\n    return {\n      stdout: result.stdout,\n      stderr: result.stderr,\n      exitCode: result.exitCode,\n    };\n  }\n\n  /**\n   * Build authenticated URL with token\n   */\n  private buildAuthenticatedUrl(repoUrl: string, token?: string): string {\n    if (!token) {\n      return repoUrl;\n    }\n\n    // Handle GitHub URLs\n    if (repoUrl.includes('github.com')) {\n      // Convert SSH to HTTPS if needed\n      if (repoUrl.startsWith('git@github.com:')) {\n        repoUrl = repoUrl.replace('git@github.com:', 'https://github.com/');\n      }\n\n      // Add token\n      if (repoUrl.startsWith('https://')) {\n        return repoUrl.replace('https://', `https://x-access-token:${token}@`);\n      }\n    }\n\n    return repoUrl;\n  }\n\n  /**\n   * Get repository URL from repository identifier\n   */\n  getRepositoryUrl(repository: string, _token?: string): string {\n    // If it looks like a URL, return as-is\n    if (\n      repository.startsWith('http://') ||\n      repository.startsWith('https://') ||\n      repository.startsWith('git@')\n    ) {\n      return repository;\n    }\n\n    // Assume it's a GitHub repository (owner/repo format)\n    return `https://github.com/${repository}.git`;\n  }\n}\n\n// Export singleton instance\nexport const worktreeManager = WorktreeManager.getInstance();\n","/**\n * Git Checkout Provider\n *\n * Provides git checkout functionality using worktrees for efficient\n * multi-workflow execution.\n */\n\nimport { CheckProvider } from './check-provider.interface';\nimport { worktreeManager } from '../utils/worktree-manager';\nimport { logger } from '../logger';\nimport { createExtendedLiquid } from '../liquid-extensions';\nimport { buildSandboxEnv } from '../utils/env-exposure';\nimport type { PRInfo } from '../pr-analyzer';\nimport type { ReviewSummary, ReviewIssue } from '../reviewer';\nimport type { CheckProviderConfig, ExecutionContext } from './check-provider.interface';\nimport type { GitCheckoutConfig, GitCheckoutOutput } from '../types/git-checkout';\n\nexport class GitCheckoutProvider extends CheckProvider {\n  private liquid = createExtendedLiquid();\n\n  getName(): string {\n    return 'git-checkout';\n  }\n\n  getDescription(): string {\n    return 'Checkout code from git repositories using worktrees for efficient multi-workflow execution';\n  }\n\n  async validateConfig(config: unknown): Promise<boolean> {\n    if (!config || typeof config !== 'object') {\n      logger.error('Invalid config: must be an object');\n      return false;\n    }\n\n    const checkoutConfig = config as GitCheckoutConfig;\n\n    // Required: ref\n    if (!checkoutConfig.ref || typeof checkoutConfig.ref !== 'string') {\n      logger.error('Invalid config: ref is required and must be a string');\n      return false;\n    }\n\n    // Optional validations\n    if (checkoutConfig.fetch_depth !== undefined) {\n      if (typeof checkoutConfig.fetch_depth !== 'number' || checkoutConfig.fetch_depth < 0) {\n        logger.error('Invalid config: fetch_depth must be a non-negative number');\n        return false;\n      }\n    }\n\n    if (checkoutConfig.fetch_tags !== undefined && typeof checkoutConfig.fetch_tags !== 'boolean') {\n      logger.error('Invalid config: fetch_tags must be a boolean');\n      return false;\n    }\n\n    if (checkoutConfig.submodules !== undefined) {\n      const validSubmoduleValues = [true, false, 'recursive'];\n      if (!validSubmoduleValues.includes(checkoutConfig.submodules as any)) {\n        logger.error('Invalid config: submodules must be true, false, or \"recursive\"');\n        return false;\n      }\n    }\n\n    if (\n      checkoutConfig.sparse_checkout !== undefined &&\n      !Array.isArray(checkoutConfig.sparse_checkout)\n    ) {\n      logger.error('Invalid config: sparse_checkout must be an array');\n      return false;\n    }\n\n    if (checkoutConfig.clone_timeout_ms !== undefined) {\n      if (\n        typeof checkoutConfig.clone_timeout_ms !== 'number' ||\n        checkoutConfig.clone_timeout_ms <= 0\n      ) {\n        logger.error('Invalid config: clone_timeout_ms must be a positive number (milliseconds)');\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  async execute(\n    prInfo: PRInfo,\n    config: CheckProviderConfig,\n    dependencyResults?: Map<string, ReviewSummary>,\n    context?: ExecutionContext\n  ): Promise<ReviewSummary> {\n    const checkoutConfig = config as unknown as GitCheckoutConfig;\n    const issues: ReviewIssue[] = [];\n\n    // Test hook: mock output for this step (short-circuit execution)\n    try {\n      const stepName = (config as any).checkName || 'git-checkout';\n      if (process.env.VISOR_DEBUG === 'true') {\n        logger.debug(\n          `[GitCheckout] Mock check: stepName=${stepName}, context=${!!context}, hooks=${!!context?.hooks}, mockForStep=${!!context?.hooks?.mockForStep}`\n        );\n      }\n      const mock = context?.hooks?.mockForStep?.(String(stepName));\n      if (process.env.VISOR_DEBUG === 'true') {\n        logger.debug(\n          `[GitCheckout] Mock result: ${mock !== undefined ? 'found' : 'not found'}, value=${JSON.stringify(mock)}`\n        );\n      }\n      if (mock !== undefined) {\n        // If mock is a GitCheckoutOutput-like object, use it directly\n        if (mock && typeof mock === 'object') {\n          const mockOutput = mock as Record<string, unknown>;\n          // Handle error/failure mocks\n          if (mockOutput.success === false) {\n            const errorMsg = String(mockOutput.error || 'Mocked checkout failure');\n            if (process.env.VISOR_DEBUG === 'true') {\n              logger.debug(`[GitCheckout] Returning mock failure: ${errorMsg}`);\n            }\n            return {\n              issues: [\n                {\n                  file: 'git-checkout',\n                  line: 0,\n                  ruleId: 'git-checkout/error',\n                  message: `Failed to checkout code: ${errorMsg}`,\n                  severity: 'error',\n                  category: 'logic',\n                },\n              ],\n              output: mockOutput,\n            } as any;\n          }\n          // Success mock\n          if (process.env.VISOR_DEBUG === 'true') {\n            logger.debug(`[GitCheckout] Returning mock success: ${JSON.stringify(mockOutput)}`);\n          }\n          return { issues: [], output: mockOutput } as any;\n        }\n        // Primitive mock - treat as success with path\n        if (process.env.VISOR_DEBUG === 'true') {\n          logger.debug(`[GitCheckout] Returning primitive mock: ${String(mock)}`);\n        }\n        return { issues: [], output: { success: true, path: String(mock) } } as any;\n      }\n    } catch {}\n\n    try {\n      // Build template context\n      const templateContext = this.buildTemplateContext(\n        prInfo,\n        dependencyResults,\n        context,\n        checkoutConfig\n      );\n\n      // Resolve dynamic variables\n      let resolvedRef = await this.liquid.parseAndRender(checkoutConfig.ref, templateContext);\n      // If ref resolves to an empty string, fall back to HEAD so we rely on\n      // the repository's default branch. This keeps downstream git commands\n      // well-defined and matches existing expectations/tests.\n      if (!resolvedRef || resolvedRef.trim().length === 0) {\n        resolvedRef = 'HEAD';\n      }\n      const resolvedRepository = checkoutConfig.repository\n        ? await this.liquid.parseAndRender(checkoutConfig.repository, templateContext)\n        : process.env.GITHUB_REPOSITORY || 'unknown/unknown';\n      const resolvedToken = checkoutConfig.token\n        ? await this.liquid.parseAndRender(checkoutConfig.token, templateContext)\n        : undefined;\n      const resolvedWorkingDirectory = checkoutConfig.working_directory\n        ? await this.liquid.parseAndRender(checkoutConfig.working_directory, templateContext)\n        : undefined;\n\n      logger.info(`Checking out repository: ${resolvedRepository}@${resolvedRef}`);\n\n      // Get repository URL\n      const repoUrl = worktreeManager.getRepositoryUrl(resolvedRepository, resolvedToken);\n\n      // Create worktree\n      const worktree = await worktreeManager.createWorktree(\n        resolvedRepository,\n        repoUrl,\n        resolvedRef,\n        {\n          token: resolvedToken,\n          workingDirectory: resolvedWorkingDirectory,\n          clean: checkoutConfig.clean !== false, // Default: true\n          workflowId: (context as any)?.workflowId,\n          fetchDepth: checkoutConfig.fetch_depth,\n          cloneTimeoutMs: checkoutConfig.clone_timeout_ms,\n        }\n      );\n\n      // Build output\n      const output: GitCheckoutOutput = {\n        success: true,\n        path: worktree.path,\n        ref: resolvedRef,\n        commit: worktree.commit,\n        worktree_id: worktree.id,\n        repository: resolvedRepository,\n        is_worktree: true,\n      };\n\n      // Add project to workspace if workspace isolation is enabled\n      const workspace = (context as any)?._parentContext?.workspace;\n\n      // Enhanced debug logging for workspace project addition diagnosis\n      const checkName = (config as any)?.checkName || 'unknown';\n      logger.info(`[GitCheckout] Workspace check for '${checkName}':`);\n      logger.info(`[GitCheckout]   _parentContext exists: ${!!(context as any)?._parentContext}`);\n      logger.info(`[GitCheckout]   workspace exists: ${!!workspace}`);\n      logger.info(`[GitCheckout]   workspace.isEnabled(): ${workspace?.isEnabled?.() ?? 'N/A'}`);\n      if (workspace) {\n        const projectCountBefore = workspace.listProjects?.()?.length ?? 'N/A';\n        logger.debug(`[GitCheckout]   projects before addProject: ${projectCountBefore}`);\n      }\n\n      if (workspace?.isEnabled()) {\n        try {\n          // Don't pass checkName as description - let workspace use repo name\n          // This results in human-readable names like \"tyk-docs\" instead of \"checkout-tyk-docs\"\n          const workspacePath = await workspace.addProject(resolvedRepository, worktree.path);\n          output.workspace_path = workspacePath;\n          const projectCountAfter = workspace.listProjects?.()?.length ?? 'N/A';\n          logger.debug(`[GitCheckout] Added project to workspace: ${workspacePath}`);\n          logger.debug(`[GitCheckout]   projects after addProject: ${projectCountAfter}`);\n        } catch (error) {\n          logger.warn(`Failed to add project to workspace: ${error}`);\n        }\n      } else {\n        logger.debug(`[GitCheckout] Workspace not enabled, skipping addProject`);\n      }\n\n      logger.info(\n        `Successfully checked out ${resolvedRepository}@${resolvedRef} to ${worktree.path}`\n      );\n\n      return {\n        issues,\n        output,\n      } as any;\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      logger.error(`Git checkout failed: ${errorMessage}`);\n\n      // Add error issue\n      issues.push({\n        file: 'git-checkout',\n        line: 0,\n        ruleId: 'git-checkout/error',\n        message: `Failed to checkout code: ${errorMessage}`,\n        severity: 'error',\n        category: 'logic',\n      });\n\n      // Build error output\n      const output: GitCheckoutOutput = {\n        success: false,\n        error: errorMessage,\n      };\n\n      return {\n        issues,\n        output,\n      } as any;\n    }\n  }\n\n  /**\n   * Build template context for variable resolution\n   */\n  private buildTemplateContext(\n    prInfo: PRInfo,\n    dependencyResults?: Map<string, ReviewSummary>,\n    context?: ExecutionContext,\n    config?: GitCheckoutConfig\n  ): Record<string, any> {\n    // Build outputs object from dependency results\n    const outputsObj: Record<string, any> = {};\n    if (dependencyResults) {\n      for (const [checkName, result] of dependencyResults.entries()) {\n        outputsObj[checkName] =\n          (result as any).output !== undefined ? (result as any).output : result;\n      }\n    }\n\n    // Build outputs history\n    const outputHistory = config?.__outputHistory;\n    const historyObj: Record<string, any[]> = {};\n    if (outputHistory) {\n      for (const [checkName, history] of outputHistory.entries()) {\n        historyObj[checkName] = history;\n      }\n    }\n\n    // Safe environment variables\n    const safeEnv = buildSandboxEnv(process.env);\n\n    // Template context\n    return {\n      pr: {\n        number: prInfo.number,\n        title: prInfo.title,\n        author: prInfo.author,\n        head: prInfo.head,\n        base: prInfo.base,\n        repo: process.env.GITHUB_REPOSITORY || '',\n        files: prInfo.files,\n      },\n      files: prInfo.files,\n      outputs: outputsObj,\n      outputs_history: historyObj,\n      env: safeEnv,\n      // Check config first (set by projectWorkflowToGraph), then fall back to context\n      inputs: (config as any)?.workflowInputs || context?.workflowInputs,\n    };\n  }\n\n  getSupportedConfigKeys(): string[] {\n    return [\n      'type',\n      'ref',\n      'repository',\n      'token',\n      'fetch_depth',\n      'fetch_tags',\n      'submodules',\n      'working_directory',\n      'use_worktree',\n      'clean',\n      'sparse_checkout',\n      'lfs',\n      'timeout',\n      'criticality',\n      'assume',\n      'guarantee',\n      'cleanup_on_failure',\n      'persist_worktree',\n      'depends_on',\n      'if',\n      'fail_if',\n      'on',\n    ];\n  }\n\n  async isAvailable(): Promise<boolean> {\n    // Check if git is available\n    try {\n      const { commandExecutor } = await import('../utils/command-executor');\n      const result = await commandExecutor.execute('git --version', { timeout: 5000 });\n      return result.exitCode === 0;\n    } catch (_error) {\n      return false;\n    }\n  }\n\n  getRequirements(): string[] {\n    return ['git'];\n  }\n}\n","import { CheckProvider } from './check-provider.interface';\nimport { AICheckProvider } from './ai-check-provider';\nimport { HttpCheckProvider } from './http-check-provider';\nimport { HttpInputProvider } from './http-input-provider';\nimport { HttpClientProvider } from './http-client-provider';\nimport { NoopCheckProvider } from './noop-check-provider';\nimport { LogCheckProvider } from './log-check-provider';\nimport { GitHubOpsProvider } from './github-ops-provider';\nimport { ClaudeCodeCheckProvider } from './claude-code-check-provider';\nimport { CommandCheckProvider } from './command-check-provider';\nimport { MemoryCheckProvider } from './memory-check-provider';\nimport { McpCheckProvider } from './mcp-check-provider';\nimport { HumanInputCheckProvider } from './human-input-check-provider';\nimport { ScriptCheckProvider } from './script-check-provider';\nimport { WorkflowCheckProvider } from './workflow-check-provider';\nimport { GitCheckoutProvider } from './git-checkout-provider';\nimport { CustomToolDefinition } from '../types/config';\n\n/**\n * Registry for managing check providers\n */\nexport class CheckProviderRegistry {\n  private providers: Map<string, CheckProvider> = new Map();\n  private static instance: CheckProviderRegistry;\n  private customTools?: Record<string, CustomToolDefinition>;\n\n  private constructor() {\n    // Register default providers\n    this.registerDefaultProviders();\n  }\n\n  /**\n   * Get singleton instance\n   */\n  static getInstance(): CheckProviderRegistry {\n    if (!CheckProviderRegistry.instance) {\n      CheckProviderRegistry.instance = new CheckProviderRegistry();\n    }\n    return CheckProviderRegistry.instance;\n  }\n\n  /**\n   * Register default built-in providers\n   */\n  private registerDefaultProviders(): void {\n    // Register all built-in providers\n    this.register(new AICheckProvider());\n    this.register(new CommandCheckProvider());\n    this.register(new ScriptCheckProvider());\n    this.register(new HttpCheckProvider());\n    this.register(new HttpInputProvider());\n    this.register(new HttpClientProvider());\n    this.register(new NoopCheckProvider());\n    this.register(new LogCheckProvider());\n    this.register(new MemoryCheckProvider());\n    this.register(new GitHubOpsProvider());\n    this.register(new HumanInputCheckProvider());\n    this.register(new WorkflowCheckProvider());\n    this.register(new GitCheckoutProvider());\n\n    // Try to register ClaudeCodeCheckProvider - it may fail if dependencies are missing\n    try {\n      this.register(new ClaudeCodeCheckProvider());\n    } catch (error) {\n      console.error(\n        `Warning: Failed to register ClaudeCodeCheckProvider: ${\n          error instanceof Error ? error.message : 'Unknown error'\n        }`\n      );\n    }\n\n    // Try to register McpCheckProvider - it may fail if dependencies are missing\n    try {\n      const mcpProvider = new McpCheckProvider();\n      // Set custom tools if available\n      if (this.customTools) {\n        mcpProvider.setCustomTools(this.customTools);\n      }\n      this.register(mcpProvider);\n    } catch (error) {\n      console.error(\n        `Warning: Failed to register McpCheckProvider: ${\n          error instanceof Error ? error.message : 'Unknown error'\n        }`\n      );\n    }\n  }\n\n  /**\n   * Register a check provider\n   */\n  register(provider: CheckProvider): void {\n    const name = provider.getName();\n    if (this.providers.has(name)) {\n      throw new Error(`Provider '${name}' is already registered`);\n    }\n    this.providers.set(name, provider);\n    // Only log provider registration in debug mode to avoid contaminating output\n    if (process.env.VISOR_DEBUG === 'true') {\n      console.error(`Registered check provider: ${name}`);\n    }\n  }\n\n  /**\n   * Unregister a check provider\n   */\n  unregister(name: string): void {\n    if (!this.providers.has(name)) {\n      throw new Error(`Provider '${name}' not found`);\n    }\n    this.providers.delete(name);\n    // Send provider unregistration messages to stderr to avoid contaminating JSON output\n    console.error(`Unregistered check provider: ${name}`);\n  }\n\n  /**\n   * Get a provider by name\n   */\n  getProvider(name: string): CheckProvider | undefined {\n    return this.providers.get(name);\n  }\n\n  /**\n   * Get provider or throw if not found\n   */\n  getProviderOrThrow(name: string): CheckProvider {\n    const provider = this.providers.get(name);\n    if (!provider) {\n      throw new Error(\n        `Check provider '${name}' not found. Available providers: ${this.getAvailableProviders().join(', ')}`\n      );\n    }\n    return provider;\n  }\n\n  /**\n   * Check if a provider exists\n   */\n  hasProvider(name: string): boolean {\n    return this.providers.has(name);\n  }\n\n  /**\n   * Get all registered provider names\n   */\n  getAvailableProviders(): string[] {\n    return Array.from(this.providers.keys());\n  }\n\n  /**\n   * Get all providers\n   */\n  getAllProviders(): CheckProvider[] {\n    return Array.from(this.providers.values());\n  }\n\n  /**\n   * Set custom tools that can be used by the MCP provider\n   */\n  setCustomTools(tools: Record<string, CustomToolDefinition>): void {\n    this.customTools = tools;\n\n    // Update MCP provider if already registered\n    const mcpProvider = this.providers.get('mcp') as McpCheckProvider | undefined;\n    if (mcpProvider) {\n      mcpProvider.setCustomTools(tools);\n    }\n  }\n\n  /**\n   * Get providers that are currently available (have required dependencies)\n   */\n  async getActiveProviders(): Promise<CheckProvider[]> {\n    const providers = this.getAllProviders();\n    const activeProviders: CheckProvider[] = [];\n\n    for (const provider of providers) {\n      if (await provider.isAvailable()) {\n        activeProviders.push(provider);\n      }\n    }\n\n    return activeProviders;\n  }\n\n  /**\n   * List provider information\n   */\n  async listProviders(): Promise<\n    Array<{\n      name: string;\n      description: string;\n      available: boolean;\n      requirements: string[];\n    }>\n  > {\n    const providers = this.getAllProviders();\n    const info = [];\n\n    for (const provider of providers) {\n      info.push({\n        name: provider.getName(),\n        description: provider.getDescription(),\n        available: await provider.isAvailable(),\n        requirements: provider.getRequirements(),\n      });\n    }\n\n    return info;\n  }\n\n  /**\n   * Reset registry (mainly for testing)\n   */\n  reset(): void {\n    this.providers.clear();\n    this.registerDefaultProviders();\n  }\n\n  /**\n   * Clear singleton instance (for testing)\n   */\n  static clearInstance(): void {\n    CheckProviderRegistry.instance = undefined!;\n  }\n}\n","/**\n * Workflow executor for running workflow definitions\n */\n\nimport {\n  WorkflowDefinition,\n  WorkflowExecutionContext,\n  WorkflowStep,\n  WorkflowInputMapping,\n  WorkflowExecutionOptions,\n} from './types/workflow';\nimport { PRInfo } from './pr-analyzer';\nimport { ReviewSummary } from './reviewer';\nimport { CheckProviderRegistry } from './providers/check-provider-registry';\nimport { CheckProviderConfig, ExecutionContext } from './providers/check-provider.interface';\nimport { DependencyResolver } from './dependency-resolver';\nimport { logger } from './logger';\nimport { createSecureSandbox, compileAndRun } from './utils/sandbox';\n// eslint-disable-next-line no-restricted-imports -- needed for Liquid type\nimport { Liquid } from 'liquidjs';\nimport { createExtendedLiquid } from './liquid-extensions';\n\n/**\n * Workflow execution result\n */\nexport interface WorkflowExecutionResult {\n  success: boolean;\n  score?: number;\n  confidence?: 'high' | 'medium' | 'low';\n  issues?: any[];\n  comments?: any[];\n  output?: Record<string, unknown>;\n  status: 'completed' | 'failed' | 'skipped';\n  duration?: number;\n  error?: string;\n  stepSummaries?: Array<{\n    stepId: string;\n    status: 'success' | 'failed' | 'skipped';\n    issues?: any[];\n    output?: unknown;\n  }>;\n}\n\n/**\n * Execution options passed to workflow executor\n */\ninterface WorkflowRunOptions {\n  prInfo: PRInfo;\n  dependencyResults?: Map<string, ReviewSummary>;\n  context?: ExecutionContext;\n  options?: WorkflowExecutionOptions;\n}\n\n/**\n * Executes workflow definitions\n */\nexport class WorkflowExecutor {\n  private providerRegistry: CheckProviderRegistry | null = null;\n  private liquid: Liquid;\n\n  constructor() {\n    // Don't call CheckProviderRegistry.getInstance() here to avoid circular dependency\n    // during registry initialization (since WorkflowCheckProvider is registered in the registry)\n    this.liquid = createExtendedLiquid();\n  }\n\n  /**\n   * Lazy-load the provider registry to avoid circular dependency during initialization\n   */\n  private getProviderRegistry(): CheckProviderRegistry {\n    if (!this.providerRegistry) {\n      this.providerRegistry = CheckProviderRegistry.getInstance();\n    }\n    return this.providerRegistry;\n  }\n\n  /**\n   * Execute a workflow\n   */\n  public async execute(\n    workflow: WorkflowDefinition,\n    executionContext: WorkflowExecutionContext,\n    runOptions: WorkflowRunOptions\n  ): Promise<WorkflowExecutionResult> {\n    const startTime = Date.now();\n    executionContext.metadata = {\n      startTime,\n      status: 'running',\n    };\n\n    try {\n      // Resolve step execution order\n      const executionOrder = this.resolveExecutionOrder(workflow);\n      logger.debug(`Workflow ${workflow.id} execution order: ${executionOrder.join(' -> ')}`);\n\n      // Execute steps in order\n      const stepResults = new Map<string, ReviewSummary>();\n      const stepSummaries: Array<{\n        stepId: string;\n        status: 'success' | 'failed' | 'skipped';\n        issues?: any[];\n        output?: unknown;\n      }> = [];\n\n      for (const stepId of executionOrder) {\n        const step = workflow.steps[stepId];\n\n        // Check if step should be executed (evaluate 'if' condition)\n        if (step.if) {\n          const shouldRun = this.evaluateCondition(step.if, {\n            inputs: executionContext.inputs,\n            outputs: Object.fromEntries(stepResults),\n            pr: runOptions.prInfo,\n          });\n\n          if (!shouldRun) {\n            logger.info(`Skipping step '${stepId}' due to condition: ${step.if}`);\n            stepSummaries.push({\n              stepId,\n              status: 'skipped',\n            });\n            continue;\n          }\n        }\n\n        // Prepare step configuration\n        const stepConfig = await this.prepareStepConfig(\n          step,\n          stepId,\n          executionContext,\n          stepResults,\n          workflow\n        );\n\n        // Execute the step\n        try {\n          logger.info(`Executing workflow step '${stepId}'`);\n          // Extend context with workflow inputs\n          const stepContext: ExecutionContext = {\n            ...runOptions.context,\n            workflowInputs: executionContext.inputs,\n          };\n          const result = await this.executeStep(\n            stepConfig,\n            runOptions.prInfo,\n            stepResults,\n            stepContext\n          );\n\n          stepResults.set(stepId, result);\n          stepSummaries.push({\n            stepId,\n            status: 'success',\n            issues: result.issues,\n            output: (result as any).output,\n          });\n        } catch (error) {\n          const errorMessage = error instanceof Error ? error.message : String(error);\n          logger.error(`Step '${stepId}' failed: ${errorMessage}`);\n\n          stepSummaries.push({\n            stepId,\n            status: 'failed',\n            output: { error: errorMessage },\n          });\n\n          if (!runOptions.options?.continueOnError) {\n            throw new Error(`Workflow step '${stepId}' failed: ${errorMessage}`);\n          }\n        }\n      }\n\n      // Compute workflow outputs\n      const outputs = await this.computeOutputs(\n        workflow,\n        executionContext,\n        stepResults,\n        runOptions.prInfo\n      );\n      executionContext.outputs = outputs;\n\n      // Aggregate results\n      const aggregated = this.aggregateResults(stepResults);\n\n      const endTime = Date.now();\n      executionContext.metadata.endTime = endTime;\n      executionContext.metadata.duration = endTime - startTime;\n      executionContext.metadata.status = 'completed';\n\n      return {\n        success: true,\n        score: aggregated.score,\n        confidence: aggregated.confidence,\n        issues: aggregated.issues,\n        comments: aggregated.comments,\n        output: outputs,\n        status: 'completed',\n        duration: endTime - startTime,\n        stepSummaries,\n      };\n    } catch (error) {\n      const endTime = Date.now();\n      executionContext.metadata.endTime = endTime;\n      executionContext.metadata.duration = endTime - startTime;\n      executionContext.metadata.status = 'failed';\n      executionContext.metadata.error = error instanceof Error ? error.message : String(error);\n\n      return {\n        success: false,\n        status: 'failed',\n        duration: endTime - startTime,\n        error: error instanceof Error ? error.message : String(error),\n      };\n    }\n  }\n\n  /**\n   * Resolve step execution order based on dependencies\n   */\n  private resolveExecutionOrder(workflow: WorkflowDefinition): string[] {\n    // Build dependency map\n    const dependencies: Record<string, string[]> = {};\n    for (const [stepId, step] of Object.entries(workflow.steps)) {\n      // Normalize depends_on to array (supports string | string[])\n      const rawDeps = step.depends_on;\n      dependencies[stepId] = Array.isArray(rawDeps) ? rawDeps : rawDeps ? [rawDeps] : [];\n    }\n\n    // Use static DependencyResolver\n    const graph = DependencyResolver.buildDependencyGraph(dependencies);\n\n    if (graph.hasCycles) {\n      throw new Error(\n        `Circular dependency detected in workflow steps: ${graph.cycleNodes?.join(' -> ')}`\n      );\n    }\n\n    // Flatten execution groups to get linear order\n    const order: string[] = [];\n    for (const group of graph.executionOrder) {\n      order.push(...group.parallel);\n    }\n\n    return order;\n  }\n\n  /**\n   * Prepare step configuration with input mappings\n   */\n  private async prepareStepConfig(\n    step: WorkflowStep,\n    stepId: string,\n    executionContext: WorkflowExecutionContext,\n    stepResults: Map<string, ReviewSummary>,\n    workflow: WorkflowDefinition\n  ): Promise<CheckProviderConfig> {\n    const config: CheckProviderConfig = {\n      ...step,\n      type: step.type || 'ai',\n      checkName: `${executionContext.instanceId}:${stepId}`,\n    };\n\n    // Process input mappings\n    if (step.inputs) {\n      for (const [inputName, mapping] of Object.entries(step.inputs)) {\n        const value = await this.resolveInputMapping(\n          mapping,\n          executionContext,\n          stepResults,\n          workflow\n        );\n        (config as any)[inputName] = value;\n      }\n    }\n\n    return config;\n  }\n\n  /**\n   * Resolve input mapping to actual value\n   */\n  private async resolveInputMapping(\n    mapping: string | WorkflowInputMapping,\n    executionContext: WorkflowExecutionContext,\n    stepResults: Map<string, ReviewSummary>,\n    _workflow: WorkflowDefinition\n  ): Promise<unknown> {\n    // Simple string mapping - treat as parameter reference\n    if (typeof mapping === 'string') {\n      return executionContext.inputs[mapping];\n    }\n\n    // Complex mapping\n    if (typeof mapping === 'object' && mapping !== null && 'source' in mapping) {\n      const typedMapping = mapping as WorkflowInputMapping;\n\n      switch (typedMapping.source) {\n        case 'param':\n          // Reference to workflow input parameter\n          return executionContext.inputs[String(typedMapping.value)];\n\n        case 'step':\n          // Reference to another step's output\n          if (!typedMapping.stepId) {\n            throw new Error('Step input mapping requires stepId');\n          }\n          const stepResult = stepResults.get(typedMapping.stepId);\n          if (!stepResult) {\n            throw new Error(`Step '${typedMapping.stepId}' has not been executed yet`);\n          }\n          const output = (stepResult as any).output;\n          if (typedMapping.outputParam && output) {\n            return output[typedMapping.outputParam];\n          }\n          return output;\n\n        case 'constant':\n          // Constant value\n          return typedMapping.value;\n\n        case 'expression':\n          // JavaScript expression\n          if (!typedMapping.expression) {\n            throw new Error('Expression mapping requires expression field');\n          }\n          const sandbox = createSecureSandbox();\n          return compileAndRun(\n            sandbox,\n            typedMapping.expression,\n            {\n              inputs: executionContext.inputs,\n              outputs: Object.fromEntries(stepResults),\n              steps: Object.fromEntries(\n                Array.from(stepResults.entries()).map(([id, result]) => [\n                  id,\n                  (result as any).output,\n                ])\n              ),\n            },\n            { injectLog: true, logPrefix: 'workflow.input.expression' }\n          );\n\n        default:\n          throw new Error(`Unknown input mapping source: ${typedMapping.source}`);\n      }\n    }\n\n    // Handle Liquid template in mapping\n    if (typeof mapping === 'object' && mapping !== null && 'template' in mapping) {\n      const typedMapping = mapping as WorkflowInputMapping;\n      if (typedMapping.template) {\n        return await this.liquid.parseAndRender(typedMapping.template, {\n          inputs: executionContext.inputs,\n          outputs: Object.fromEntries(stepResults),\n        });\n      }\n    }\n\n    // Return as-is\n    return mapping;\n  }\n\n  /**\n   * Execute a single step\n   */\n  private async executeStep(\n    config: CheckProviderConfig,\n    prInfo: PRInfo,\n    dependencyResults: Map<string, ReviewSummary>,\n    context?: ExecutionContext\n  ): Promise<ReviewSummary> {\n    const provider = await this.getProviderRegistry().getProvider(config.type);\n    if (!provider) {\n      throw new Error(`Provider '${config.type}' not found`);\n    }\n\n    return await provider.execute(prInfo, config, dependencyResults, context);\n  }\n\n  /**\n   * Compute workflow outputs\n   */\n  private async computeOutputs(\n    workflow: WorkflowDefinition,\n    executionContext: WorkflowExecutionContext,\n    stepResults: Map<string, ReviewSummary>,\n    prInfo: PRInfo\n  ): Promise<Record<string, unknown>> {\n    const outputs: Record<string, unknown> = {};\n\n    if (!workflow.outputs) {\n      return outputs;\n    }\n\n    for (const output of workflow.outputs) {\n      if (output.value_js) {\n        // JavaScript expression\n        const sandbox = createSecureSandbox();\n        outputs[output.name] = compileAndRun(\n          sandbox,\n          output.value_js,\n          {\n            inputs: executionContext.inputs,\n            steps: Object.fromEntries(\n              Array.from(stepResults.entries()).map(([id, result]) => [id, (result as any).output])\n            ),\n            outputs: Object.fromEntries(stepResults),\n            pr: prInfo,\n          },\n          { injectLog: true, logPrefix: `workflow.output.${output.name}` }\n        );\n      } else if (output.value) {\n        // Liquid template\n        outputs[output.name] = await this.liquid.parseAndRender(output.value, {\n          inputs: executionContext.inputs,\n          steps: Object.fromEntries(\n            Array.from(stepResults.entries()).map(([id, result]) => [id, (result as any).output])\n          ),\n          outputs: Object.fromEntries(stepResults),\n          pr: prInfo,\n        });\n      }\n    }\n\n    return outputs;\n  }\n\n  /**\n   * Aggregate results from all steps\n   */\n  private aggregateResults(stepResults: Map<string, ReviewSummary>): {\n    score: number;\n    confidence: 'high' | 'medium' | 'low';\n    issues: any[];\n    comments: any[];\n  } {\n    let totalScore = 0;\n    let scoreCount = 0;\n    const allIssues: any[] = [];\n    const allComments: any[] = [];\n    let minConfidence: 'high' | 'medium' | 'low' = 'high';\n\n    for (const result of stepResults.values()) {\n      const extResult = result as any;\n      if (typeof extResult.score === 'number') {\n        totalScore += extResult.score;\n        scoreCount++;\n      }\n\n      if (result.issues) {\n        allIssues.push(...result.issues);\n      }\n\n      if (extResult.comments) {\n        allComments.push(...extResult.comments);\n      }\n\n      if (extResult.confidence) {\n        if (\n          extResult.confidence === 'low' ||\n          (extResult.confidence === 'medium' && minConfidence === 'high')\n        ) {\n          minConfidence = extResult.confidence;\n        }\n      }\n    }\n\n    return {\n      score: scoreCount > 0 ? Math.round(totalScore / scoreCount) : 0,\n      confidence: minConfidence,\n      issues: allIssues,\n      comments: allComments,\n    };\n  }\n\n  /**\n   * Evaluate a condition expression\n   */\n  private evaluateCondition(condition: string, context: any): boolean {\n    try {\n      const sandbox = createSecureSandbox();\n      const result = compileAndRun(sandbox, condition, context, {\n        injectLog: true,\n        logPrefix: 'workflow.condition',\n      });\n      return Boolean(result);\n    } catch (error) {\n      logger.warn(`Failed to evaluate condition '${condition}': ${error}`);\n      return false;\n    }\n  }\n}\n","/**\n * Workflow Projection - Convert WorkflowDefinition to DependencyGraph\n *\n * This module handles projecting workflow definitions into dependency graphs\n * that can be executed by the state machine engine.\n */\n\nimport type { WorkflowDefinition } from '../types/workflow';\nimport type { CheckMetadata } from '../types/engine';\nimport type { VisorConfig } from '../types/config';\nimport { logger } from '../logger';\n\n/**\n * Project a workflow definition into a dependency graph structure\n * that can be executed by the state machine\n */\nexport function projectWorkflowToGraph(\n  workflow: WorkflowDefinition,\n  workflowInputs: Record<string, unknown>,\n  _parentCheckId: string\n): {\n  config: VisorConfig;\n  checks: Record<string, CheckMetadata>;\n} {\n  if (!workflow.steps || Object.keys(workflow.steps).length === 0) {\n    throw new Error(`Workflow '${workflow.id}' has no steps`);\n  }\n\n  // Build a pseudo-config that represents the workflow as checks\n  const checks: Record<string, any> = {};\n  const checksMetadata: Record<string, CheckMetadata> = {};\n\n  for (const [stepId, step] of Object.entries(workflow.steps)) {\n    // Inside a nested workflow engine instance, step IDs do not need parent scoping.\n    // Keep them unscoped to provide a clean, blackâ€‘box view.\n    const scopedCheckId = stepId;\n\n    // Build check configuration from workflow step\n    checks[scopedCheckId] = {\n      type: step.type || 'ai',\n      ...step,\n      // Store workflow inputs in the check config so they're accessible\n      workflowInputs,\n      // Mark this as a workflow step\n      _workflowStep: true,\n      _workflowId: workflow.id,\n      _stepId: stepId,\n    };\n\n    // Build check metadata\n    checksMetadata[scopedCheckId] = {\n      tags: step.tags || workflow.tags || [],\n      triggers: step.on || workflow.on || [],\n      group: step.group,\n      providerType: step.type || 'ai',\n      // Normalize depends_on to array (supports string | string[])\n      dependencies: (Array.isArray(step.depends_on)\n        ? step.depends_on\n        : step.depends_on\n          ? [step.depends_on]\n          : []\n      ).map((dep: string) => dep),\n    };\n  }\n\n  // Create a synthetic config for this workflow\n  const config: VisorConfig = {\n    checks,\n    version: '1.0',\n    output: {\n      pr_comment: {\n        format: 'table',\n        group_by: 'check',\n        collapse: false,\n      },\n    },\n  };\n\n  if ((logger as any).isDebugEnabled?.()) {\n    logger.debug(\n      `[WorkflowProjection] Projected workflow '${workflow.id}' with ${Object.keys(checks).length} steps`\n    );\n  }\n\n  return { config, checks: checksMetadata };\n}\n\n/**\n * Validate workflow depth to prevent infinite recursion\n */\nexport function validateWorkflowDepth(\n  currentDepth: number,\n  maxDepth: number,\n  workflowId: string\n): void {\n  if (currentDepth >= maxDepth) {\n    throw new Error(\n      `Workflow nesting depth limit exceeded (${maxDepth}) for workflow '${workflowId}'. ` +\n        `This may indicate a circular workflow reference or excessive nesting.`\n    );\n  }\n}\n\n/**\n * Build a scoped path for workflow steps\n */\nexport function buildWorkflowScope(\n  parentScope: Array<{ check: string; index: number }> | undefined,\n  workflowCheckId: string,\n  stepId: string,\n  foreachIndex?: number\n): Array<{ check: string; index: number }> {\n  const scope = parentScope ? [...parentScope] : [];\n  scope.push({\n    check: `${workflowCheckId}:${stepId}`,\n    index: foreachIndex ?? 0,\n  });\n  return scope;\n}\n\n/**\n * Extract parent scope from a scoped check ID\n */\nexport function extractParentScope(\n  scopedCheckId: string\n): { parentCheckId: string; stepId: string } | null {\n  const lastColonIndex = scopedCheckId.lastIndexOf(':');\n  if (lastColonIndex === -1) {\n    return null; // Not a scoped check\n  }\n\n  return {\n    parentCheckId: scopedCheckId.substring(0, lastColonIndex),\n    stepId: scopedCheckId.substring(lastColonIndex + 1),\n  };\n}\n\n/**\n * Check if a check ID represents a workflow step\n */\nexport function isWorkflowStep(checkId: string): boolean {\n  return checkId.includes(':');\n}\n\n/**\n * Get the workflow ID from a scoped check ID\n */\nexport function getWorkflowIdFromScope(scopedCheckId: string): string | null {\n  const parts = scopedCheckId.split(':');\n  if (parts.length >= 2) {\n    return parts[0]; // First part is the parent workflow check ID\n  }\n  return null;\n}\n","/**\n * Workflow check provider - executes reusable workflows as checks\n */\n\nimport { CheckProvider, CheckProviderConfig, ExecutionContext } from './check-provider.interface';\nimport { PRInfo } from '../pr-analyzer';\nimport { ReviewSummary } from '../reviewer';\nimport { WorkflowRegistry } from '../workflow-registry';\nimport { WorkflowExecutor } from '../workflow-executor';\nimport { logger } from '../logger';\nimport { WorkflowDefinition, WorkflowExecutionContext } from '../types/workflow';\nimport { createSecureSandbox, compileAndRun } from '../utils/sandbox';\nimport { generateHumanId } from '../utils/human-id';\n// eslint-disable-next-line no-restricted-imports -- needed for Liquid type\nimport { Liquid } from 'liquidjs';\nimport { createExtendedLiquid } from '../liquid-extensions';\nimport * as path from 'path';\nimport * as yaml from 'js-yaml';\n\n/**\n * Provider that executes workflows as checks\n */\nexport class WorkflowCheckProvider extends CheckProvider {\n  private registry: WorkflowRegistry;\n  private executor: WorkflowExecutor;\n  private liquid: Liquid;\n\n  constructor() {\n    super();\n    this.registry = WorkflowRegistry.getInstance();\n    this.executor = new WorkflowExecutor();\n    this.liquid = createExtendedLiquid();\n  }\n\n  getName(): string {\n    return 'workflow';\n  }\n\n  getDescription(): string {\n    return 'Executes reusable workflow definitions as checks';\n  }\n\n  async validateConfig(config: unknown): Promise<boolean> {\n    const cfg = config as CheckProviderConfig & { workflow?: string; config?: string };\n\n    // Two supported modes:\n    // 1) workflow: <id> (pre-registered in WorkflowRegistry via imports)\n    // 2) config: <path|url> (load a Visor config file and execute its steps as a workflow)\n    if (!cfg.workflow && !cfg.config) {\n      logger.error('Workflow provider requires either \"workflow\" (id) or \"config\" (path)');\n      return false;\n    }\n\n    // If using workflow id, verify presence in registry now\n    if (cfg.workflow) {\n      if (!this.registry.has(cfg.workflow as string)) {\n        logger.error(`Workflow '${cfg.workflow}' not found in registry`);\n        return false;\n      }\n    }\n\n    // For config path mode we cannot fully validate existence here (no base path);\n    // execution will resolve it relative to the parent working directory and fail fast if missing.\n    return true;\n  }\n\n  async execute(\n    prInfo: PRInfo,\n    config: CheckProviderConfig,\n    dependencyResults?: Map<string, ReviewSummary>,\n    context?: ExecutionContext\n  ): Promise<ReviewSummary> {\n    const cfg = config as CheckProviderConfig & { workflow?: string; config?: string };\n    const isConfigPathMode = !!cfg.config && !cfg.workflow;\n    const stepName = (config as any).checkName || cfg.workflow || cfg.config || 'workflow';\n\n    // Resolve workflow definition FIRST (needed for input preparation and validation)\n    let workflow: WorkflowDefinition | undefined;\n    let workflowId = cfg.workflow as string | undefined;\n\n    if (isConfigPathMode) {\n      // Use originalWorkingDirectory for config file resolution - workflow configs\n      // should be loaded from the original project path, not the sandbox\n      const parentCwd = ((context as any)?._parentContext?.originalWorkingDirectory ||\n        (context as any)?._parentContext?.workingDirectory ||\n        (context as any)?.originalWorkingDirectory ||\n        (context as any)?.workingDirectory ||\n        process.cwd()) as string;\n      workflow = await this.loadWorkflowFromConfigPath(String(cfg.config), parentCwd);\n      workflowId = workflow.id;\n      logger.info(`Executing workflow from config '${cfg.config}' as '${workflowId}'`);\n    } else {\n      workflowId = String(cfg.workflow);\n      workflow = this.registry.get(workflowId);\n      if (!workflow) {\n        throw new Error(`Workflow '${workflowId}' not found in registry`);\n      }\n      logger.info(`Executing workflow '${workflowId}'`);\n    }\n\n    // Prepare inputs - do this BEFORE mock check so we can validate inputs even when mocked\n    // This allows tests to assert that the correct inputs were passed to workflow steps\n    const inputs = await this.prepareInputs(workflow, config, prInfo, dependencyResults);\n\n    // Capture resolved workflow inputs for testing assertions (reuse prompt capture infrastructure)\n    // This allows using `prompts` assertions with `provider: 'workflow'` to verify inputs\n    try {\n      // Serialize inputs to capture for assertions - specifically the context field\n      // which contains the rendered template with dependency outputs\n      const inputsCapture = Object.entries(inputs)\n        .map(([k, v]) => `${k}: ${typeof v === 'string' ? v : JSON.stringify(v)}`)\n        .join('\\n\\n');\n      (context as any)?.hooks?.onPromptCaptured?.({\n        step: String(stepName),\n        provider: 'workflow',\n        prompt: inputsCapture,\n      });\n    } catch {\n      // Ignore capture errors - this is only for testing\n    }\n\n    // Validate inputs\n    const validation = this.registry.validateInputs(workflow, inputs);\n    if (!validation.valid) {\n      const errors = validation.errors?.map(e => `${e.path}: ${e.message}`).join(', ');\n      throw new Error(`Invalid workflow inputs: ${errors}`);\n    }\n\n    // Test harness support: allow mocking workflow checks as a black box.\n    // If a mock is provided for this step, short-circuit nested execution and\n    // return a ReviewSummary with optional output field.\n    // NOTE: This happens AFTER input preparation/validation so tests can assert inputs are correct\n    try {\n      // test-runner passes hooks on execution context\n      const mock = (context as any)?.hooks?.mockForStep?.(String(stepName));\n      if (mock !== undefined) {\n        const ms = mock as any;\n        const issuesArr = Array.isArray(ms?.issues) ? (ms.issues as any[]) : [];\n        // Prefer explicit output if provided; otherwise treat the mock object itself as output\n        const out = ms && typeof ms === 'object' && 'output' in ms ? ms.output : ms;\n        const summary: ReviewSummary & { output?: unknown } = {\n          issues: issuesArr,\n          output: out,\n          ...(typeof ms?.content === 'string' ? { content: String(ms.content) } : {}),\n        } as any;\n        return summary;\n      }\n    } catch {}\n\n    // Apply overrides to workflow steps if specified\n    const modifiedWorkflow = this.applyOverrides(workflow, config);\n\n    // M3: Check if we're in state-machine mode and should delegate to engine\n    const engineMode = (context as any)?._engineMode;\n    if (engineMode === 'state-machine') {\n      // Delegate to state machine engine for nested workflow execution\n      logger.info(`[WorkflowProvider] Delegating workflow '${workflowId}' to state machine engine`);\n      return await this.executeViaStateMachine(\n        modifiedWorkflow,\n        inputs,\n        config,\n        prInfo,\n        dependencyResults,\n        context\n      );\n    }\n\n    // Legacy mode: Execute the workflow using WorkflowExecutor\n    const executionContext: WorkflowExecutionContext = {\n      instanceId: `${workflowId}-${Date.now()}`,\n      parentCheckId: config.checkName,\n      inputs,\n      stepResults: new Map(),\n    };\n\n    const result = await this.executor.execute(modifiedWorkflow, executionContext, {\n      prInfo,\n      dependencyResults,\n      context,\n    });\n\n    // Map outputs\n    const outputs = this.mapOutputs(result, config.output_mapping as Record<string, string>);\n\n    // Return the review summary with extended fields\n    // Note: These extra fields are used by the execution engine but not part of the base interface\n    const summary: ReviewSummary = {\n      issues: result.issues || [],\n    };\n\n    // Add extended fields as needed by the engine\n    (summary as any).score = result.score || 0;\n    (summary as any).confidence = result.confidence || 'medium';\n    (summary as any).comments = result.comments || [];\n    (summary as any).output = outputs;\n    (summary as any).content = this.formatWorkflowResult(workflow, result, outputs);\n\n    return summary;\n  }\n\n  getSupportedConfigKeys(): string[] {\n    return [\n      'workflow',\n      'config',\n      'args',\n      'overrides',\n      'output_mapping',\n      'timeout',\n      'env',\n      'checkName',\n    ];\n  }\n\n  async isAvailable(): Promise<boolean> {\n    return true; // Always available\n  }\n\n  getRequirements(): string[] {\n    return [];\n  }\n\n  /**\n   * Prepare inputs for workflow execution\n   */\n  private async prepareInputs(\n    workflow: WorkflowDefinition,\n    config: CheckProviderConfig,\n    prInfo: PRInfo,\n    dependencyResults?: Map<string, ReviewSummary>\n  ): Promise<Record<string, unknown>> {\n    const inputs: Record<string, unknown> = {};\n\n    // Start with default values from workflow definition\n    if (workflow.inputs) {\n      for (const param of workflow.inputs) {\n        if (param.default !== undefined) {\n          inputs[param.name] = param.default;\n        }\n      }\n    }\n\n    // Extract eventContext for slack/conversation\n    const eventContext = config.eventContext || {};\n\n    // Debug logging for conversation context\n    logger.debug(`[WorkflowProvider] prepareInputs for ${workflow.id}`);\n    logger.debug(\n      `[WorkflowProvider] eventContext keys: ${Object.keys(eventContext).join(', ') || 'none'}`\n    );\n    logger.debug(\n      `[WorkflowProvider] eventContext.slack: ${eventContext.slack ? 'present' : 'absent'}`\n    );\n    logger.debug(\n      `[WorkflowProvider] eventContext.conversation: ${(eventContext as any).conversation ? 'present' : 'absent'}`\n    );\n\n    // Extract slack context (if provided via eventContext.slack)\n    const slack = (() => {\n      try {\n        const anyCtx = eventContext as any;\n        const slackCtx = anyCtx?.slack;\n        if (slackCtx && typeof slackCtx === 'object') return slackCtx;\n      } catch {\n        // ignore\n      }\n      return undefined;\n    })();\n\n    // Extract unified conversation context across transports (Slack & GitHub)\n    const conversation = (() => {\n      try {\n        const anyCtx = eventContext as any;\n        if (anyCtx?.slack?.conversation) return anyCtx.slack.conversation;\n        if (anyCtx?.github?.conversation) return anyCtx.github.conversation;\n        if (anyCtx?.conversation) return anyCtx.conversation;\n      } catch {\n        // ignore\n      }\n      return undefined;\n    })();\n\n    // Debug logging for extracted context\n    logger.debug(`[WorkflowProvider] slack extracted: ${slack ? 'present' : 'absent'}`);\n    logger.debug(\n      `[WorkflowProvider] conversation extracted: ${conversation ? 'present' : 'absent'}`\n    );\n    if (conversation) {\n      logger.debug(\n        `[WorkflowProvider] conversation.messages count: ${Array.isArray((conversation as any).messages) ? (conversation as any).messages.length : 0}`\n      );\n    }\n\n    // Extract output history from config (passed via __outputHistory)\n    const outputHistory = (config as any).__outputHistory as Map<string, unknown[]> | undefined;\n    const outputs_history: Record<string, unknown[]> = {};\n    if (outputHistory) {\n      for (const [k, v] of outputHistory.entries()) {\n        outputs_history[k] = v;\n      }\n    }\n\n    // Build template context with all available data\n    // Extract .output from each dependency result so that outputs['step-name'].field works naturally\n    // (not outputs['step-name'].output.field)\n    const outputsMap: Record<string, unknown> = {};\n    logger.debug(\n      `[WorkflowProvider] dependencyResults: ${dependencyResults ? dependencyResults.size : 'undefined'} entries`\n    );\n    if (dependencyResults) {\n      for (const [key, result] of dependencyResults.entries()) {\n        // Extract the output property, or use the whole result if output is undefined\n        const extracted = (result as any).output ?? result;\n        outputsMap[key] = extracted;\n        // Debug: log what we extracted for each dependency\n        const extractedKeys =\n          extracted && typeof extracted === 'object'\n            ? Object.keys(extracted).join(', ')\n            : 'not-object';\n        logger.debug(`[WorkflowProvider] outputs['${key}']: keys=[${extractedKeys}]`);\n      }\n    }\n    // Get parent workflow inputs from config (for nested workflow template access)\n    const parentInputs = (config as any).workflowInputs || {};\n\n    // Get base path for loadConfig helper - resolve relative paths from workflow's directory\n    const basePath =\n      (config as any).basePath ||\n      (config as any)._parentContext?.originalWorkingDirectory ||\n      (config as any)._parentContext?.workingDirectory ||\n      process.cwd();\n\n    // Create a Liquid engine for loadConfig that supports {% readfile %} with basePath\n    const loadConfigLiquid = createExtendedLiquid();\n\n    // loadConfig helper - synchronously reads, renders Liquid templates, and parses YAML/JSON\n    // Usage in expressions: loadConfig('config/intents.yaml')\n    // Supports {% readfile \"path\" %} directives that resolve relative to the config file's directory\n    const loadConfig = (filePath: string): unknown => {\n      try {\n        // Normalize basePath for security validation\n        const normalizedBasePath = path.normalize(basePath);\n\n        // Resolve path relative to basePath (or use absolute path)\n        const resolvedPath = path.isAbsolute(filePath)\n          ? path.normalize(filePath)\n          : path.normalize(path.resolve(basePath, filePath));\n\n        // Security: Validate that resolved path stays within basePath\n        // This prevents path traversal attacks (e.g., ../../../etc/passwd)\n        const basePathWithSep = normalizedBasePath.endsWith(path.sep)\n          ? normalizedBasePath\n          : normalizedBasePath + path.sep;\n        if (!resolvedPath.startsWith(basePathWithSep) && resolvedPath !== normalizedBasePath) {\n          throw new Error(`Path '${filePath}' escapes base directory`);\n        }\n\n        // Get the directory of the config file for resolving relative paths in {% readfile %}\n        const configDir = path.dirname(resolvedPath);\n        // Use sync read for sandbox expression context (expressions can't be async)\n        const rawContent = require('fs').readFileSync(resolvedPath, 'utf-8');\n        // Render Liquid templates (e.g., {% readfile \"docs/file.md\" %}) with basePath context\n        // This allows {% readfile %} to resolve paths relative to the config file's directory\n        const renderedContent = loadConfigLiquid.parseAndRenderSync(rawContent, {\n          basePath: configDir,\n        });\n        // Parse as YAML with JSON_SCHEMA for security (prevents custom type execution)\n        // JSON_SCHEMA is safer than DEFAULT but still parses basic types (numbers, booleans, null)\n        return yaml.load(renderedContent, { schema: yaml.JSON_SCHEMA });\n      } catch (error) {\n        const msg = error instanceof Error ? error.message : String(error);\n        logger.error(`[WorkflowProvider] loadConfig failed for '${filePath}': ${msg}`);\n        throw new Error(`loadConfig('${filePath}') failed: ${msg}`);\n      }\n    };\n\n    const templateContext = {\n      pr: prInfo,\n      outputs: outputsMap,\n      env: process.env,\n      slack,\n      conversation,\n      outputs_history,\n      // Include parent workflow inputs for templates like {{ inputs.question }}\n      inputs: parentInputs,\n      // Helper to load external YAML/JSON config files\n      loadConfig,\n    };\n\n    // Apply user-provided inputs (args)\n    const userInputs = config.args || config.workflow_inputs; // Support both for compatibility\n    if (userInputs) {\n      for (const [key, value] of Object.entries(userInputs)) {\n        // Process value if it's a template or expression\n        if (typeof value === 'string') {\n          // Check if it's a Liquid template\n          if (value.includes('{{') || value.includes('{%')) {\n            inputs[key] = await this.liquid.parseAndRender(value, templateContext);\n            // Debug: log rendered template value for important inputs\n            if (key === 'text' || key === 'question' || key === 'context') {\n              const rendered = String(inputs[key]);\n              logger.info(\n                `[WorkflowProvider] Rendered '${key}' input (${rendered.length} chars): ${rendered.substring(0, 500)}${rendered.length > 500 ? '...' : ''}`\n              );\n            }\n          } else {\n            inputs[key] = value;\n          }\n        } else if (typeof value === 'object' && value !== null && 'expression' in value) {\n          // JavaScript expression\n          const exprValue = value as { expression: string };\n          const sandbox = createSecureSandbox();\n          inputs[key] = compileAndRun(sandbox, exprValue.expression, templateContext, {\n            injectLog: true,\n            logPrefix: `workflow.input.${key}`,\n          });\n        } else {\n          inputs[key] = value;\n          // Debug: log non-string inputs like arrays\n          if (Array.isArray(value)) {\n            logger.debug(`[WorkflowProvider] Input '${key}' is array with ${value.length} items`);\n          } else if (typeof value === 'object') {\n            logger.debug(\n              `[WorkflowProvider] Input '${key}' is object with keys: ${Object.keys(value).join(', ')}`\n            );\n          }\n        }\n      }\n    }\n\n    // Debug: log all input keys and types for troubleshooting\n    const inputSummary = Object.entries(inputs)\n      .map(([k, v]) => `${k}:${Array.isArray(v) ? `array[${v.length}]` : typeof v}`)\n      .join(', ');\n    logger.debug(`[WorkflowProvider] Final inputs: ${inputSummary}`);\n\n    return inputs;\n  }\n\n  /**\n   * Apply overrides to workflow steps\n   */\n  private applyOverrides(\n    workflow: WorkflowDefinition,\n    config: CheckProviderConfig\n  ): WorkflowDefinition {\n    const overrideConfig = config.overrides || config.workflow_overrides; // Support both for compatibility\n    if (!overrideConfig) {\n      return workflow;\n    }\n\n    // Deep clone the workflow\n    const modified = JSON.parse(JSON.stringify(workflow));\n\n    // Apply overrides\n    for (const [stepId, overrides] of Object.entries(overrideConfig)) {\n      if (modified.steps[stepId]) {\n        // Merge overrides with existing step config\n        modified.steps[stepId] = {\n          ...modified.steps[stepId],\n          ...overrides,\n        };\n      } else {\n        logger.warn(`Cannot override non-existent step '${stepId}' in workflow '${workflow.id}'`);\n      }\n    }\n\n    return modified;\n  }\n\n  /**\n   * Map workflow outputs to check outputs\n   */\n  private mapOutputs(result: any, outputMapping?: Record<string, string>): Record<string, unknown> {\n    if (!outputMapping) {\n      return result.output || {};\n    }\n\n    const mapped: Record<string, unknown> = {};\n    const workflowOutputs = result.output || {};\n\n    for (const [checkOutput, workflowOutput] of Object.entries(outputMapping)) {\n      if (workflowOutput in workflowOutputs) {\n        mapped[checkOutput] = workflowOutputs[workflowOutput];\n      } else if (workflowOutput.includes('.')) {\n        // Handle nested paths\n        const parts = workflowOutput.split('.');\n        let value = workflowOutputs;\n        for (const part of parts) {\n          value = value?.[part];\n          if (value === undefined) break;\n        }\n        mapped[checkOutput] = value;\n      }\n    }\n\n    return mapped;\n  }\n\n  /**\n   * Format workflow execution result for display\n   */\n  /**\n   * Execute workflow via state machine engine (M3: nested workflows)\n   */\n  private async executeViaStateMachine(\n    workflow: WorkflowDefinition,\n    inputs: Record<string, unknown>,\n    config: CheckProviderConfig,\n    prInfo: PRInfo,\n    dependencyResults?: Map<string, ReviewSummary>,\n    context?: ExecutionContext\n  ): Promise<ReviewSummary> {\n    // Import state machine components\n    const {\n      projectWorkflowToGraph,\n      validateWorkflowDepth,\n    } = require('../state-machine/workflow-projection');\n    const { StateMachineRunner } = require('../state-machine/runner');\n    const { ExecutionJournal } = require('../snapshot-store');\n    const { MemoryStore } = require('../memory-store');\n\n    // Extract parent context if available\n    const parentContext = (context as any)?._parentContext;\n    const parentState = (context as any)?._parentState;\n\n    // Validate workflow depth\n    const currentDepth = parentState?.flags?.currentWorkflowDepth || 0;\n    // Prefer parent state's configured limit; fall back to config.limits if present; else default 3\n    const maxDepth =\n      parentState?.flags?.maxWorkflowDepth ??\n      parentContext?.config?.limits?.max_workflow_depth ??\n      3;\n    validateWorkflowDepth(currentDepth, maxDepth, workflow.id);\n\n    // Project workflow to dependency graph\n    const { config: workflowConfig, checks: checksMetadata } = projectWorkflowToGraph(\n      workflow,\n      inputs,\n      config.checkName || workflow.id\n    );\n\n    // Build isolated child engine context (separate journal/memory to avoid state contamination)\n    // Reuse parent's memory config if available, but never the instance\n    const parentMemoryCfg =\n      (parentContext?.memory &&\n        parentContext.memory.getConfig &&\n        parentContext.memory.getConfig()) ||\n      parentContext?.config?.memory;\n\n    const childJournal = new ExecutionJournal();\n    const childMemory = MemoryStore.createIsolated(parentMemoryCfg);\n    try {\n      await childMemory.initialize();\n    } catch {}\n    // Enhanced debug logging for workspace propagation diagnosis\n    const parentWorkspace = parentContext?.workspace;\n    logger.info(`[WorkflowProvider] Workspace propagation for nested workflow '${workflow.id}':`);\n    logger.info(`[WorkflowProvider]   parentContext exists: ${!!parentContext}`);\n    logger.info(`[WorkflowProvider]   parentContext.workspace exists: ${!!parentWorkspace}`);\n    if (parentWorkspace) {\n      logger.info(\n        `[WorkflowProvider]   parentWorkspace.isEnabled(): ${parentWorkspace.isEnabled?.() ?? 'N/A'}`\n      );\n      const projectCount = parentWorkspace.listProjects?.()?.length ?? 'N/A';\n      logger.info(`[WorkflowProvider]   parentWorkspace project count: ${projectCount}`);\n    } else {\n      logger.warn(\n        `[WorkflowProvider]   NO WORKSPACE from parent - nested checkouts won't be added to workspace!`\n      );\n    }\n\n    // Wrap execution hooks so nested steps are captured/mocked with dotted prefix\n    // e.g. step \"classify\" inside parent step \"route-intent\" â†’ \"route-intent.classify\"\n    const stepPrefix = config.checkName || workflow.id;\n    const parentExecCtx = (parentContext as any)?.executionContext;\n    let childExecCtx = parentExecCtx;\n    if (parentExecCtx?.hooks) {\n      const parentHooks = parentExecCtx.hooks;\n      childExecCtx = {\n        ...parentExecCtx,\n        hooks: {\n          ...parentHooks,\n          // Wrap onPromptCaptured: emit with prefixed step name so parent sees \"route-intent.classify\"\n          onPromptCaptured: parentHooks.onPromptCaptured\n            ? (info: { step: string; provider: string; prompt: string }) => {\n                parentHooks.onPromptCaptured({\n                  ...info,\n                  step: `${stepPrefix}.${info.step}`,\n                });\n              }\n            : undefined,\n          // Wrap mockForStep: try prefixed name first, fall back to unprefixed for backward compat\n          mockForStep: parentHooks.mockForStep\n            ? (step: string) => {\n                const prefixed = parentHooks.mockForStep(`${stepPrefix}.${step}`);\n                if (prefixed !== undefined) return prefixed;\n                return parentHooks.mockForStep(step);\n              }\n            : undefined,\n        },\n      };\n    }\n\n    const childContext = {\n      mode: 'state-machine' as const,\n      config: workflowConfig,\n      checks: checksMetadata,\n      journal: childJournal,\n      memory: childMemory,\n      // For nested workflows we continue to execute inside the same logical\n      // working directory as the parent run. When workspace isolation is\n      // enabled on the parent engine, its WorkspaceManager is also propagated\n      // so that nested checks (AI, git-checkout, etc.) see the same isolated\n      // workspace and project symlinks instead of falling back to the Visor\n      // repository root.\n      workingDirectory: parentContext?.workingDirectory || process.cwd(),\n      originalWorkingDirectory:\n        parentContext?.originalWorkingDirectory || parentContext?.workingDirectory || process.cwd(),\n      workspace: parentWorkspace,\n      // Always use a fresh session for nested workflows to isolate history\n      sessionId: generateHumanId(),\n      event: parentContext?.event || prInfo.eventType,\n      debug: parentContext?.debug || false,\n      maxParallelism: parentContext?.maxParallelism,\n      failFast: parentContext?.failFast,\n      // Propagate wrapped execution hooks (mocks, octokit, etc.) into the child so\n      // nested steps can be mocked/observed by the YAML test runner with dotted prefixes.\n      executionContext: childExecCtx,\n      // Ensure all workflow steps are considered requested to avoid tag/event filtering surprises\n      requestedChecks: Object.keys(checksMetadata),\n    };\n\n    // Create child runner with inherited context\n    const runner = new StateMachineRunner(childContext);\n    const childState = runner.getState();\n\n    // Set workflow depth for child\n    childState.flags.currentWorkflowDepth = currentDepth + 1;\n    childState.flags.maxWorkflowDepth = maxDepth;\n\n    // Set parent references\n    childState.parentContext = parentContext;\n    childState.parentScope = parentState?.parentScope;\n\n    // Execute the child workflow\n    logger.info(\n      `[WorkflowProvider] Executing nested workflow '${workflow.id}' at depth ${currentDepth + 1}`\n    );\n    const result = await runner.run();\n\n    // Propagate child journal entries to parent journal with prefixed checkIds\n    // so nested step outputs are visible via dotted-path addressing (e.g. \"route-intent.classify\")\n    if (parentContext?.journal && parentContext?.sessionId) {\n      const parentJournal = parentContext.journal as InstanceType<typeof ExecutionJournal>;\n      const childSnapshot = childJournal.beginSnapshot();\n      const childSessionId = childContext.sessionId;\n      const childEntries = childJournal.readVisible(childSessionId, childSnapshot, undefined);\n      for (const entry of childEntries) {\n        parentJournal.commitEntry({\n          sessionId: parentContext.sessionId,\n          scope: entry.scope,\n          checkId: `${stepPrefix}.${entry.checkId}`,\n          result: entry.result,\n          event: entry.event,\n        });\n      }\n      if (childEntries.length > 0) {\n        logger.debug(\n          `[WorkflowProvider] Propagated ${childEntries.length} child journal entries to parent with prefix '${stepPrefix}.'`\n        );\n      }\n    }\n\n    // M3: Check for bubbled events and propagate them to parent\n    const bubbledEvents = (childContext as any)._bubbledEvents || [];\n    if (bubbledEvents.length > 0 && parentContext) {\n      if (parentContext.debug) {\n        logger.info(`[WorkflowProvider] Bubbling ${bubbledEvents.length} events to parent context`);\n      }\n\n      // Propagate bubbled events to parent\n      if (!parentContext._bubbledEvents) {\n        (parentContext as any)._bubbledEvents = [];\n      }\n      (parentContext as any)._bubbledEvents.push(...bubbledEvents);\n    }\n\n    // Aggregate results from all workflow steps\n    const allIssues: any[] = [];\n    let totalScore = 0;\n    let scoreCount = 0;\n\n    for (const stepResult of Object.values(result.results)) {\n      const typedResult = stepResult as any;\n      if (typedResult.issues) {\n        allIssues.push(...typedResult.issues);\n      }\n      if (typedResult.score) {\n        totalScore += typedResult.score;\n        scoreCount++;\n      }\n    }\n\n    // Compute workflow outputs\n    const outputs = await this.computeWorkflowOutputsFromState(\n      workflow,\n      inputs,\n      result.results,\n      prInfo\n    );\n\n    // Map outputs if output_mapping is specified\n    const mappedOutputs = this.mapOutputs(\n      { output: outputs },\n      config.output_mapping as Record<string, string>\n    );\n\n    // Build aggregated summary\n    const summary: ReviewSummary = {\n      issues: allIssues,\n    };\n\n    (summary as any).score = scoreCount > 0 ? Math.round(totalScore / scoreCount) : 0;\n    (summary as any).confidence = 'medium';\n    (summary as any).output = mappedOutputs;\n    (summary as any).content = this.formatWorkflowResultFromStateMachine(\n      workflow,\n      result,\n      mappedOutputs\n    );\n\n    return summary;\n  }\n\n  /**\n   * Compute workflow outputs from state machine execution results\n   */\n  private async computeWorkflowOutputsFromState(\n    workflow: WorkflowDefinition,\n    inputs: Record<string, unknown>,\n    groupedResults: Record<string, Array<{ checkName: string; output?: unknown; issues?: any[] }>>,\n    prInfo: PRInfo\n  ): Promise<Record<string, unknown>> {\n    const outputs: Record<string, unknown> = {};\n\n    // Flatten GroupedCheckResults (group -> CheckResult[]) to a simple map\n    // of checkName -> { output, issues } so workflow-level value_js can\n    // reference outputs[\"security\"].issues, etc.\n    const flat: Record<string, { output?: unknown; issues?: any[] }> = {};\n    try {\n      for (const arr of Object.values(groupedResults || {})) {\n        for (const item of arr || []) {\n          if (!item) continue;\n          const name = (item as any).checkName || (item as any).name;\n          if (typeof name === 'string' && name) {\n            flat[name] = { output: (item as any).output, issues: (item as any).issues };\n          }\n        }\n      }\n    } catch {}\n\n    // Create outputs map that directly exposes .output values (not wrapped in { output, issues })\n    // This makes {{ outputs['check-name'] }} work naturally without needing .output\n    const outputsMap = Object.fromEntries(\n      Object.entries(flat).map(([id, result]) => [id, (result as any).output])\n    );\n\n    // If no explicit outputs defined, propagate step outputs automatically\n    // This provides a simpler default - no value_js needed for simple passthrough\n    if (!workflow.outputs || workflow.outputs.length === 0) {\n      const stepNames = Object.keys(outputsMap);\n\n      // For single-step workflows, unwrap the step output to top level\n      // This makes { 'step-name': { answer: {...} } } become { answer: {...} }\n      if (stepNames.length === 1) {\n        const singleStepOutput = outputsMap[stepNames[0]];\n        logger.debug(\n          `[WorkflowProvider] No outputs defined for workflow '${workflow.id}', unwrapping single step '${stepNames[0]}' output to top level`\n        );\n        // Return the step's output directly if it's an object, otherwise wrap it\n        if (\n          singleStepOutput &&\n          typeof singleStepOutput === 'object' &&\n          !Array.isArray(singleStepOutput)\n        ) {\n          return singleStepOutput as Record<string, unknown>;\n        }\n        return { result: singleStepOutput };\n      }\n\n      // For multi-step workflows, keep outputs nested by step name\n      logger.debug(\n        `[WorkflowProvider] No outputs defined for workflow '${workflow.id}', propagating all step outputs: [${stepNames.join(', ')}]`\n      );\n      return outputsMap;\n    }\n\n    // Log available step outputs for debugging\n    const stepOutputKeys = Object.keys(outputsMap);\n    const stepOutputSummary = stepOutputKeys.map(k => {\n      const v = outputsMap[k];\n      const keys = v && typeof v === 'object' ? Object.keys(v) : [];\n      return `${k}:[${keys.join(',')}]`;\n    });\n    logger.debug(\n      `[WorkflowProvider] Computing outputs for '${workflow.id}'. Available steps: ${stepOutputSummary.join(', ') || '(none)'}`\n    );\n\n    for (const output of workflow.outputs) {\n      if (output.value_js) {\n        // JavaScript expression - wrap in try-catch for graceful degradation\n        try {\n          const sandbox = createSecureSandbox();\n          const result = compileAndRun(\n            sandbox,\n            output.value_js,\n            {\n              inputs,\n              outputs: outputsMap,\n              // Keep 'steps' as alias for backwards compatibility\n              steps: outputsMap,\n              pr: prInfo,\n            },\n            { injectLog: true, logPrefix: `workflow.output.${output.name}` }\n          );\n          outputs[output.name] = result;\n          // Log result for debugging\n          const resultType =\n            result === null ? 'null' : result === undefined ? 'undefined' : typeof result;\n          const resultPreview =\n            result && typeof result === 'object'\n              ? `{${Object.keys(result).join(',')}}`\n              : String(result).substring(0, 100);\n          logger.debug(\n            `[WorkflowProvider] Output '${output.name}' value_js result: type=${resultType}, preview=${resultPreview}`\n          );\n        } catch (valueJsError) {\n          // Log the error but don't crash - set output to null\n          const errorMsg =\n            valueJsError instanceof Error ? valueJsError.message : String(valueJsError);\n          logger.error(\n            `[WorkflowProvider] Output '${output.name}' value_js failed: ${errorMsg}. ` +\n              `Setting to null. Available step outputs: [${Object.keys(outputsMap).join(', ')}]`\n          );\n          outputs[output.name] = null;\n        }\n      } else if (output.value) {\n        // Liquid template\n        outputs[output.name] = await this.liquid.parseAndRender(output.value, {\n          inputs,\n          outputs: outputsMap,\n          // Keep 'steps' as alias for backwards compatibility\n          steps: outputsMap,\n          pr: prInfo,\n        });\n      }\n    }\n\n    // Log final outputs\n    const outputKeys = Object.keys(outputs);\n    const nullOutputs = outputKeys.filter(k => outputs[k] === null || outputs[k] === undefined);\n    if (nullOutputs.length > 0) {\n      logger.warn(\n        `[WorkflowProvider] Workflow '${workflow.id}' has null/undefined outputs: [${nullOutputs.join(', ')}]. ` +\n          `This may indicate value_js expressions are not finding expected data.`\n      );\n    }\n\n    return outputs;\n  }\n\n  /**\n   * Format workflow result from state machine execution\n   */\n  private formatWorkflowResultFromStateMachine(\n    workflow: WorkflowDefinition,\n    result: any,\n    outputs: Record<string, unknown>\n  ): string {\n    const lines: string[] = [];\n\n    lines.push(`Workflow: ${workflow.name}`);\n    if (workflow.description) {\n      lines.push(`Description: ${workflow.description}`);\n    }\n\n    lines.push('');\n    lines.push('Execution Summary (State Machine):');\n    lines.push(`- Total Steps: ${Object.keys(result.results || {}).length}`);\n    lines.push(`- Duration: ${result.statistics?.totalDuration || 0}ms`);\n\n    if (Object.keys(outputs).length > 0) {\n      lines.push('');\n      lines.push('Outputs:');\n      for (const [key, value] of Object.entries(outputs)) {\n        const formatted =\n          typeof value === 'object' ? JSON.stringify(value, null, 2) : String(value);\n        lines.push(`- ${key}: ${formatted}`);\n      }\n    }\n\n    return lines.join('\\n');\n  }\n\n  private formatWorkflowResult(\n    workflow: WorkflowDefinition,\n    result: any,\n    outputs: Record<string, unknown>\n  ): string {\n    const lines: string[] = [];\n\n    lines.push(`Workflow: ${workflow.name}`);\n    if (workflow.description) {\n      lines.push(`Description: ${workflow.description}`);\n    }\n\n    lines.push('');\n    lines.push('Execution Summary:');\n    lines.push(`- Status: ${result.status || 'completed'}`);\n    lines.push(`- Score: ${result.score || 0}`);\n    lines.push(`- Issues Found: ${result.issues?.length || 0}`);\n\n    if (result.duration) {\n      lines.push(`- Duration: ${result.duration}ms`);\n    }\n\n    if (Object.keys(outputs).length > 0) {\n      lines.push('');\n      lines.push('Outputs:');\n      for (const [key, value] of Object.entries(outputs)) {\n        const formatted =\n          typeof value === 'object' ? JSON.stringify(value, null, 2) : String(value);\n        lines.push(`- ${key}: ${formatted}`);\n      }\n    }\n\n    if (result.stepSummaries && result.stepSummaries.length > 0) {\n      lines.push('');\n      lines.push('Step Results:');\n      for (const summary of result.stepSummaries) {\n        lines.push(\n          `- ${summary.stepId}: ${summary.status} (${summary.issues?.length || 0} issues)`\n        );\n      }\n    }\n\n    return lines.join('\\n');\n  }\n\n  /**\n   * Load a Visor config file (with steps/checks) and wrap it as a WorkflowDefinition\n   * so it can be executed by the state machine as a nested workflow.\n   */\n  private async loadWorkflowFromConfigPath(\n    sourcePath: string,\n    baseDir: string\n  ): Promise<WorkflowDefinition> {\n    const path = require('node:path');\n    const fs = require('node:fs');\n    const yaml = require('js-yaml');\n    const resolved = path.isAbsolute(sourcePath) ? sourcePath : path.resolve(baseDir, sourcePath);\n    if (!fs.existsSync(resolved)) {\n      throw new Error(`Workflow config not found at: ${resolved}`);\n    }\n\n    // First, read raw YAML to check for imports\n    const rawContent = fs.readFileSync(resolved, 'utf8');\n    const rawData = yaml.load(rawContent) as Record<string, any>;\n\n    // Process imports if present (before loading the full config)\n    if (rawData.imports && Array.isArray(rawData.imports)) {\n      const configDir = path.dirname(resolved);\n      for (const source of rawData.imports) {\n        const results = await this.registry.import(source, {\n          basePath: configDir,\n          validate: true,\n        });\n        for (const result of results) {\n          if (!result.valid && result.errors) {\n            // Check if error is just \"already exists\" - skip silently\n            // This allows multiple workflows to import the same dependency\n            const isAlreadyExists = result.errors.every((e: any) =>\n              e.message.includes('already exists')\n            );\n            if (isAlreadyExists) {\n              logger.debug(`Workflow from '${source}' already imported, skipping`);\n              continue;\n            }\n            const errors = result.errors.map((e: any) => `  ${e.path}: ${e.message}`).join('\\n');\n            throw new Error(`Failed to import workflow from '${source}':\\n${errors}`);\n          }\n        }\n        logger.info(`Imported workflows from: ${source}`);\n      }\n    }\n\n    const { ConfigManager } = require('../config');\n    const mgr = new ConfigManager();\n    // Load as-is without merging bundled defaults; keep child config pure\n    const loaded = await mgr.loadConfig(resolved, { validate: false, mergeDefaults: false });\n\n    const steps: Record<string, any> = (loaded as any).steps || (loaded as any).checks || {};\n    if (!steps || Object.keys(steps).length === 0) {\n      throw new Error(`Config '${resolved}' does not contain any steps to execute as a workflow`);\n    }\n\n    const id = path.basename(resolved).replace(/\\.(ya?ml)$/i, '');\n    const name = (loaded as any).name || `Workflow from ${path.basename(resolved)}`;\n\n    const workflowDef: WorkflowDefinition = {\n      id,\n      name,\n      version: (loaded as any).version || '1.0',\n      steps,\n      description: (loaded as any).description,\n      // Inherit optional triggers if present (not required)\n      on: (loaded as any).on,\n      // Carry over optional inputs/outputs if present so callers can consume them\n      inputs: (loaded as any).inputs,\n      outputs: (loaded as any).outputs,\n    } as WorkflowDefinition;\n\n    return workflowDef;\n  }\n}\n"],"mappings":"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A,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO;AAAA,MACnE,OAAO;AAAA,MAAQ,OAAO;AAAA,MAAQ,OAAO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,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AACH,iBAAO;AAAA,QACT,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,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","names":["fs","context","triggeringComment","fs","path","agentAny","trimmed","result","resolve","path","content","lines","context","context","context","WorkflowCheckProvider","path","fs","fs","path","val","context","context","context","context","origin","fs","path","context","withActiveSpan","addEvent","readFileSync","writeFileSync","existsSync","join","withActiveSpan","context","CheckRunner","context","context","createExtendedLiquid","fs","path","context","iterationDurationMs","context","CheckProviderRegistry","buildOutputHistoryFromJournal","context","context","mapCheckNameToFocus","getHistoryLimit","buildOutputHistoryFromJournal","updateStats","executeSingleCheck","executeCheckWithForEachItems","buildDependencyResultsWithScope","handleOnInit","scope","hasFatalIssues","iterationDurationMs","Ajv","evaluateGoto","snapshotId","checkConfig","forEachItems","currentWaveCompletions","renderTemplateContent","createExtendedLiquid","fs","path","context","context","context","IssueFilter","writeFileSync","unlinkSync","join","randomUUID","withActiveSpan","addEvent","promisify","execFileCb","randomUUID","execFileAsync","EXEC_MAX_BUFFER","promisify","execFileCb","execFileAsync","EXEC_MAX_BUFFER","join","existsSync","withActiveSpan","addEvent","path","resolve","context","path","fs","MemoryStore","CheckProviderRegistry","context","initializeWorkspace","extractSlackContext","SessionRegistry","buildEngineContextForRun","convertToReviewSummary","FailureConditionEvaluator","addEvent","init_scheduler","init_scheduler","resolve","fs","path","context","aiAny","logger","emitNdjsonSpanWithEvents","SessionRegistry","context","key","fs","path","context","context","getGlobalRecorder","arr","fs","path","logger","context","emitNdjsonSpanWithEvents","captureLiquidEvaluation","arr","buildSandboxEnv","context","Blob","path","idx","stream","err","EventEmitter","EventEmitter","basename","path","basename","require_constants","DOMException","structuredClone","require_util","performance","crypto","resolve","kind","require_symbols","context","keys","atob","Blob","Blob","entry","DOMException","Blob","crypto","chunk","resolve","path","EventEmitter","resolve","err","session","onConnectTimeout","ERROR","TYPE","FLAGS","LENIENT_FLAGS","METHODS","FINISH","HEADER_STATE","path","http","http2","Client","connect","resolve","constants","exports","socket","request","path","headers","err","resolve","Client","origin","dispatcher","pool","dispatcher","Client","WeakRef","Agent","Blob","resolve","consume","require_util","context","resolve","context","callback","res","opaque","resolve","context","body","context","resolve","context","resolve","mockDispatch","path","statusCode","data","responseOptions","newMockDispatch","promisify","Client","promisify","path","Agent","URL","Agent","opts","err","require_global","Agent","DOMException","require_request","ac","DOMException","fetch","globalThis","resolve","require_symbols","require_util","DOMException","type","require_symbols","require_util","request","cache","require_constants","require_util","path","require_constants","require_symbols","require_util","crypto","crypto","body","DOMException","Client","Agent","path","fetch","logger","context","resolve","buildSandboxEnv","resolve","resolve","fs","path","buildSandboxEnv","context","waiting","prompt","fs","fsp","path","metadata","bareRepoPath","fetched","context","commandExecutor","context","path","context","summary","projectWorkflowToGraph","validateWorkflowDepth","StateMachineRunner","ExecutionJournal","MemoryStore","fs","yaml"]}