{"version":3,"sources":["../../src/event-bus/event-bus.ts"],"sourcesContent":["import type { EventEnvelope, AnyEvent } from './types';\n\nexport type EventHandler<T = AnyEvent> = (event: T | EventEnvelope<T>) => void | Promise<void>;\n\nexport interface Subscription {\n  unsubscribe(): void;\n}\n\nexport class EventBus {\n  private handlers: Map<string, Set<EventHandler>> = new Map();\n  private anyHandlers: Set<EventHandler> = new Set();\n\n  on<T = AnyEvent>(eventType: string, handler: EventHandler<T>): Subscription {\n    const set = this.handlers.get(eventType) || new Set<EventHandler>();\n    set.add(handler);\n    this.handlers.set(eventType, set);\n    return {\n      unsubscribe: () => {\n        set.delete(handler);\n      },\n    };\n  }\n\n  onAny(handler: EventHandler): Subscription {\n    this.anyHandlers.add(handler);\n    return { unsubscribe: () => this.anyHandlers.delete(handler) };\n  }\n\n  async emit(event: AnyEvent | EventEnvelope): Promise<void> {\n    const type = (event as any)?.payload?.type ?? (event as any)?.type ?? 'unknown';\n    const list: EventHandler[] = [\n      ...Array.from(this.anyHandlers),\n      ...Array.from(this.handlers.get(type) || []),\n    ];\n    for (const h of list) {\n      // Run sequentially to keep ordering guarantees per emit call\n      // Handlers themselves should fan out if they need concurrency\n      await h(event as any);\n    }\n  }\n}\n"],"mappings":";;;AAQO,IAAM,WAAN,MAAe;AAAA,EACZ,WAA2C,oBAAI,IAAI;AAAA,EACnD,cAAiC,oBAAI,IAAI;AAAA,EAEjD,GAAiB,WAAmB,SAAwC;AAC1E,UAAM,MAAM,KAAK,SAAS,IAAI,SAAS,KAAK,oBAAI,IAAkB;AAClE,QAAI,IAAI,OAAO;AACf,SAAK,SAAS,IAAI,WAAW,GAAG;AAChC,WAAO;AAAA,MACL,aAAa,MAAM;AACjB,YAAI,OAAO,OAAO;AAAA,MACpB;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,SAAqC;AACzC,SAAK,YAAY,IAAI,OAAO;AAC5B,WAAO,EAAE,aAAa,MAAM,KAAK,YAAY,OAAO,OAAO,EAAE;AAAA,EAC/D;AAAA,EAEA,MAAM,KAAK,OAAgD;AACzD,UAAM,OAAQ,OAAe,SAAS,QAAS,OAAe,QAAQ;AACtE,UAAM,OAAuB;AAAA,MAC3B,GAAG,MAAM,KAAK,KAAK,WAAW;AAAA,MAC9B,GAAG,MAAM,KAAK,KAAK,SAAS,IAAI,IAAI,KAAK,CAAC,CAAC;AAAA,IAC7C;AACA,eAAW,KAAK,MAAM;AAGpB,YAAM,EAAE,KAAY;AAAA,IACtB;AAAA,EACF;AACF;","names":[]}