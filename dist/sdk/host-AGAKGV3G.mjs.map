{"version":3,"sources":["../../src/frontends/host.ts"],"sourcesContent":["import { EventBus } from '../event-bus/event-bus';\n\nexport interface FrontendContext {\n  eventBus: EventBus;\n  logger: {\n    info: (...a: any[]) => void;\n    warn: (...a: any[]) => void;\n    error: (...a: any[]) => void;\n  };\n  config: unknown;\n  run: {\n    runId: string;\n    workflowId?: string;\n    repo?: { owner: string; name: string };\n    pr?: number;\n    headSha?: string;\n    event?: string;\n    actor?: string;\n  };\n  octokit?: any;\n}\n\nexport interface Frontend {\n  readonly name: string;\n  start(ctx: FrontendContext): Promise<void> | void;\n  stop(): Promise<void> | void;\n}\n\nexport interface FrontendSpec {\n  name: string; // e.g., 'ndjson-sink', 'github', 'slack'\n  package?: string; // external package name (future)\n  config?: unknown;\n}\n\nexport class FrontendsHost {\n  private bus: EventBus;\n  private log: FrontendContext['logger'];\n  private frontends: Frontend[] = [];\n\n  constructor(bus: EventBus, log: FrontendContext['logger']) {\n    this.bus = bus;\n    this.log = log;\n  }\n\n  async load(specs: FrontendSpec[]): Promise<void> {\n    this.frontends = [];\n    for (const spec of specs) {\n      if (spec.name === 'ndjson-sink') {\n        const { NdjsonSink } = await import('./ndjson-sink');\n        this.frontends.push(new NdjsonSink(spec.config));\n      } else if (spec.name === 'github') {\n        const { GitHubFrontend } = await import('./github-frontend');\n        this.frontends.push(new GitHubFrontend());\n      } else {\n        this.log.warn(`[FrontendsHost] Unknown frontend '${spec.name}', skipping`);\n      }\n    }\n  }\n\n  async startAll(ctxFactory: () => FrontendContext): Promise<void> {\n    for (const f of this.frontends) {\n      try {\n        await f.start(ctxFactory());\n        this.log.info(`[FrontendsHost] Started frontend '${f.name}'`);\n      } catch (err) {\n        this.log.error(`[FrontendsHost] Failed to start '${f.name}':`, err);\n      }\n    }\n  }\n\n  async stopAll(): Promise<void> {\n    for (const f of this.frontends) {\n      try {\n        await f.stop();\n      } catch (err) {\n        this.log.error(`[FrontendsHost] Failed to stop '${f.name}':`, err);\n      }\n    }\n  }\n}\n"],"mappings":";;;AAkCO,IAAM,gBAAN,MAAoB;AAAA,EACjB;AAAA,EACA;AAAA,EACA,YAAwB,CAAC;AAAA,EAEjC,YAAY,KAAe,KAAgC;AACzD,SAAK,MAAM;AACX,SAAK,MAAM;AAAA,EACb;AAAA,EAEA,MAAM,KAAK,OAAsC;AAC/C,SAAK,YAAY,CAAC;AAClB,eAAW,QAAQ,OAAO;AACxB,UAAI,KAAK,SAAS,eAAe;AAC/B,cAAM,EAAE,WAAW,IAAI,MAAM,OAAO,4BAAe;AACnD,aAAK,UAAU,KAAK,IAAI,WAAW,KAAK,MAAM,CAAC;AAAA,MACjD,WAAW,KAAK,SAAS,UAAU;AACjC,cAAM,EAAE,eAAe,IAAI,MAAM,OAAO,gCAAmB;AAC3D,aAAK,UAAU,KAAK,IAAI,eAAe,CAAC;AAAA,MAC1C,OAAO;AACL,aAAK,IAAI,KAAK,qCAAqC,KAAK,IAAI,aAAa;AAAA,MAC3E;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,SAAS,YAAkD;AAC/D,eAAW,KAAK,KAAK,WAAW;AAC9B,UAAI;AACF,cAAM,EAAE,MAAM,WAAW,CAAC;AAC1B,aAAK,IAAI,KAAK,qCAAqC,EAAE,IAAI,GAAG;AAAA,MAC9D,SAAS,KAAK;AACZ,aAAK,IAAI,MAAM,oCAAoC,EAAE,IAAI,MAAM,GAAG;AAAA,MACpE;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,UAAyB;AAC7B,eAAW,KAAK,KAAK,WAAW;AAC9B,UAAI;AACF,cAAM,EAAE,KAAK;AAAA,MACf,SAAS,KAAK;AACZ,aAAK,IAAI,MAAM,mCAAmC,EAAE,IAAI,MAAM,GAAG;AAAA,MACnE;AAAA,IACF;AAAA,EACF;AACF;","names":[]}