version: "1.0"
extends: "../defaults/override.yaml"

tests:
  defaults:
    strict: false
    ai_provider: mock
  cases:
    - name: override-appendPrompt-security
      event: pr_opened
      fixture: gh.pr_open.minimal
      mocks:
        overview:
          text: "Overview body"
          tags: { label: feature, review-effort: 2 }
        security: { issues: [] }
        readability: { issues: [] }
      expect:
        calls:
          - step: security
            exactly: 1
          - step: readability
            exactly: 1
        prompts:
          - step: security
            contains:
              - "hard-coded credentials"
              - "secret manager"
          - step: readability
            contains:
              - "readability review"
              - "naming"
