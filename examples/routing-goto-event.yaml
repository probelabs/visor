version: "2.0"

steps:
  # A typical PR overview step that runs on PR events
  overview:
    type: ai
    on: [pr_opened, pr_updated]
    schema: overview
    prompt: |
      Return JSON matching the `overview` schema with a concise markdown summary.

  # A downstream check that, after succeeding, wants to refresh overview as if a PR update occurred
  quality:
    type: ai
    depends_on: [overview]
    on: [pr_opened, pr_updated]
    prompt: |
      Analyze code quality aspects.
    on_success:
      goto: overview        # Jump to ancestor
      goto_event: pr_updated

  # A command demonstrating conditional jumps based on state
  validate:
    type: command
    depends_on: [quality]
    exec: |
      echo "validate"
    on_fail:
      goto_js: |
        // Demonstration: dynamically pick an ancestor once
        return attempt === 1 ? 'overview' : null
      goto_event: pr_updated

