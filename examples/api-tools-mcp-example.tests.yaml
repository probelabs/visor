version: "1.0"
extends: ./api-tools-mcp-example.yaml

tests:
  defaults:
    strict: true
  cases:
    - name: api-example-validates-generated-operation-input
      description: getUser requires path parameter id from the OpenAPI schema
      event: manual
      fixture: local.minimal
      expect:
        calls:
          - step: api-tool-missing-required-input
            exactly: 1
        outputs:
          - step: api-tool-missing-required-input
            path: issues[0].message
            matches: "(?i)required property 'id'"

    - name: api-example-enforces-operation-whitelist
      description: createUser is not exposed because api bundle whitelist is get*
      event: issue_comment
      fixture: gh.issue_comment.standard
      expect:
        calls:
          - step: api-tool-whitelist-enforced
            exactly: 1
        outputs:
          - step: api-tool-whitelist-enforced
            path: issues[0].message
            matches: "(?i)Custom tool not found: createUser"
