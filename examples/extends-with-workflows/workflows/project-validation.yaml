# Project-specific validation workflow
id: project-validation
name: Project Validation
description: Custom validation checks for this project
version: "1.0.0"

inputs:
  - name: strict_mode
    description: Enable strict validation rules
    schema:
      type: boolean
    default: false

  - name: check_tests
    description: Validate test coverage and quality
    schema:
      type: boolean
    default: true

outputs:
  - name: passed
    description: Whether validation passed
    value_js: |
      const licenseOk = steps.check_license?.output?.valid || false;
      const depsOk = steps.check_dependencies?.output?.valid || false;
      const testsOk = !inputs.check_tests || steps.check_tests?.output?.passed || false;
      return licenseOk && depsOk && testsOk;

  - name: issues
    description: List of validation issues
    value_js: |
      const issues = [];
      if (!steps.check_license?.output?.valid) {
        issues.push("License validation failed");
      }
      if (!steps.check_dependencies?.output?.valid) {
        issues.push("Dependency check failed");
      }
      if (inputs.check_tests && !steps.check_tests?.output?.passed) {
        issues.push("Test validation failed");
      }
      return issues;

# Steps at root level
steps:
  check_license:
    type: command
    exec: |
      # Check for license headers in source files
      if [ "{{ inputs.strict_mode }}" = "true" ]; then
        echo '{"valid": true, "files_checked": 25}'
      else
        echo '{"valid": true, "files_checked": 10}'
      fi

  check_dependencies:
    type: command
    exec: |
      # Validate dependencies are up to date
      npm outdated --json || echo '{"valid": true}'
    depends_on: [check_license]

  check_tests:
    type: command
    exec: |
      # Run test coverage check
      npm test -- --coverage --json || echo '{"passed": false}'
    if: inputs.check_tests === true
    depends_on: [check_dependencies]
    timeout: 300

  summarize:
    type: log
    message: |
      Project Validation Complete:
      - License Check: {{ steps.check_license.output.valid ? 'Passed' : 'Failed' }}
      - Dependencies: {{ steps.check_dependencies.output.valid ? 'OK' : 'Outdated' }}
      {% if inputs.check_tests %}
      - Tests: {{ steps.check_tests.output.passed ? 'Passed' : 'Failed' }}
      {% endif %}

      Overall: {{ outputs.passed ? 'PASSED' : 'FAILED' }}
    depends_on: [check_tests]