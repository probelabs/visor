version: "2.0"

# Success routing: run post-steps and jump back once to re-validate
routing:
  max_loops: 5

steps:
  unit-tests:
    type: command
    exec: "echo '[unit] ok'"

  build:
    type: command
    depends_on: [unit-tests]
    exec: "echo '[build] ok'"
    on_success:
      run: [notify]
      goto_js: |
        // Jump back only once to re-run unit-tests after build
        return attempt === 1 ? 'unit-tests' : null;

  notify:
    type: command
    exec: "echo '[notify] sent'"

