version: "1.0"

# Simple fail_if conditions - one line, easy to read!
# The check fails if the expression evaluates to true

# Global fail condition - applies to all checks
fail_if: "metadata.criticalIssues > 0"

checks:
  # Security check - zero tolerance
  security-check:
    type: ai
    schema: code-review
    prompt: "Analyze for security vulnerabilities"
    on: [pr_opened, pr_updated]
    # Fail if ANY security issues found
    fail_if: "metadata.totalIssues > 0"

  # Performance check - some tolerance
  performance-check:
    type: ai
    schema: code-review
    prompt: "Review for performance issues"
    on: [pr_opened, pr_updated]
    # Fail only if critical performance issues
    fail_if: "metadata.criticalIssues > 0 || metadata.errorIssues > 2"

  # Code style - lenient
  style-check:
    type: ai
    schema: code-review
    prompt: "Check code style and formatting"
    on: [pr_opened, pr_updated]
    # Only fail if too many style issues
    fail_if: "metadata.totalIssues > 20"

  # Using GitHub Actions-style functions
  quality-gate:
    type: ai
    schema: code-review
    prompt: "Overall code quality check"
    on: [pr_opened, pr_updated]
    # Using the success/failure transforms
    fail_if: "metadata|failure()"  # Fails if metadata indicates failure

  # With contains() function
  sensitive-files:
    type: ai
    schema: security
    prompt: "Check for exposed secrets"
    on: [pr_opened, pr_updated]
    # Fail if checking sensitive files with issues
    fail_if: "hasFileMatching(issues, '.env') || hasFileMatching(issues, 'secret')"

  # With startsWith() function
  api-check:
    type: ai
    schema: code-review
    prompt: "Review API endpoints"
    on: [pr_opened, pr_updated]
    # Stricter for API files
    fail_if: "startsWith(metadata.checkName, 'api') && metadata.totalIssues > 0"

  # Always pass example
  info-only:
    type: ai
    schema: plain
    prompt: "Informational analysis"
    on: [pr_opened]
    # Never fails - using always() returns true, ! makes it false
    fail_if: "!always()"

  # Complex single-line condition
  combined-check:
    type: ai
    schema: code-review
    prompt: "Combined quality check"
    on: [pr_opened, pr_updated]
    depends_on: [security-check, performance-check]
    # Fail if previous checks found issues OR current check has critical issues
    fail_if: |
      (outputs['security-check'] && outputs['security-check'].totalIssues > 0) ||
      (outputs['performance-check'] && outputs['performance-check'].criticalIssues > 0) ||
      metadata.criticalIssues > 0

output:
  pr_comment:
    format: markdown
    group_by: check
    collapse: true