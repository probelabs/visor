# üîí Security Review for PR {{ pr.number }}: {{ pr.title }}

## Context Information
- **Author**: {{ pr.author }}
- **Branch**: `{{ pr.headBranch }}` ‚Üí `{{ pr.baseBranch }}`
- **Files Changed**: {{ files.size }}
- **Total Changes**: +{{ pr.totalAdditions }}/-{{ pr.totalDeletions }}

{% if event.comment %}
**Triggered by comment**: "{{ event.comment.body }}" from {{ event.comment.author }}
{% endif %}

## File Analysis

{% assign tsFiles = utils.filesByExtension.ts %}
{% assign jsFiles = utils.filesByExtension.js %}
{% assign configFiles = utils.filesByExtension.json %}

{% if tsFiles.size > 0 %}
### TypeScript Files to Review ({{ tsFiles.size }})
{% for file in tsFiles %}
- `{{ file.filename }}` (+{{ file.additions }}/-{{ file.deletions }}) - {{ file.status }}
{% endfor %}
{% endif %}

{% if jsFiles.size > 0 %}
### JavaScript Files to Review ({{ jsFiles.size }})
{% for file in jsFiles %}
- `{{ file.filename }}` (+{{ file.additions }}/-{{ file.deletions }}) - {{ file.status }}
{% endfor %}
{% endif %}

{% if configFiles.size > 0 %}
### Configuration Files ({{ configFiles.size }})
{% for file in configFiles %}
- `{{ file.filename }}` - Pay special attention to security configurations
{% endfor %}
{% endif %}

## Previous Security Findings

{% if outputs.security %}
Previous security scan found {{ outputs.security.totalIssues }} issues:
- üî¥ **Critical**: {{ outputs.security.criticalIssues }}
- üü† **Errors**: {{ outputs.security.errorIssues }}  
- üü° **Warnings**: {{ outputs.security.warningIssues }}
- üîµ **Info**: {{ outputs.security.infoIssues }}

{% if outputs.security.securityIssues.size > 0 %}
### Existing Security Issues to Address:
{% for issue in outputs.security.securityIssues %}
- **{{ issue.severity | upcase }}** in `{{ issue.file }}:{{ issue.line }}`: {{ issue.message }}
  {% if issue.suggestion %}üí° *{{ issue.suggestion }}*{% endif %}
{% endfor %}
{% endif %}

{% else %}
No previous security analysis available - performing fresh security review.
{% endif %}

## Review Focus Areas

{% if utils.hasLargeChanges %}
‚ö†Ô∏è **Large Changes Detected** - This PR requires extra careful review due to significant modifications.
{% endif %}

Please perform a comprehensive security analysis focusing on:

### 1. Authentication & Authorization
- JWT token handling and validation
- Session management security
- Role-based access control implementation
- Authentication bypass possibilities

### 2. Input Validation & Sanitization  
- SQL injection vulnerabilities
- XSS attack vectors
- Command injection risks
- File upload security

### 3. Cryptography & Secrets
- Proper use of cryptographic functions
- Secret management and storage
- API key and token security
- Encryption at rest and in transit

### 4. Infrastructure Security
- Configuration security
- Dependency vulnerabilities
- Environment variable handling
- Error message information disclosure

### 5. Data Protection
- Sensitive data exposure
- Data validation and sanitization
- Privacy compliance considerations
- Audit logging security

## Analysis Instructions

Return results in JSON format matching the code-review schema with:
- Specific file locations and line numbers
- Clear severity classifications (critical/error/warning/info)
- Actionable remediation suggestions
- Reference to security best practices where applicable

Focus on newly added or modified code, but consider how changes interact with existing security measures.